<div cdkDropListGroup class="flex flex-col">
  <div class="flex flex-grow space-x-4 overflow-x-auto pb-4">

    <!-- Column: Nouveau -->
    <div class="flex w-64 flex-shrink-0 flex-col">
      <div class="flex items-center px-2 mb-3">
        <span class="font-display font-bold text-gray-700">ðŸ†• Nouveau</span>
        <span class="ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-family-sky/20 text-xs font-bold text-family-sky">{{new.length || 0}}</span>
        <button routerLink="/add-task" class="ml-auto text-family-pink hover:text-family-coral transition-colors">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v12m6-6H6"/></svg>
        </button>
      </div>
      <div id="newContainer" cdkDropList [cdkDropListData]="new" (cdkDropListDropped)="drop($event)" class="flex-1 space-y-3 min-h-[60px]">
        @for (itemNew of new; track itemNew) {
          <div cdkDrag>
            <div (click)="onEdit(itemNew.id)" class="card-fun p-4 cursor-pointer border-l-4 border-family-sky hover:shadow-card-hover transition-shadow">
              <span [ngClass]="getUrgencyClass(itemNew.urg)">{{itemNew.urg}}</span>
              <h4 class="mt-2 text-sm font-semibold text-gray-700">{{itemNew.title}}</h4>
              <div class="flex items-center gap-1.5 mt-1">
                @if (isForEveryone(itemNew)) {
                  <div class="flex -space-x-1.5">
                    @for (avatar of allUserAvatars; track avatar) {
                      <img [src]="avatar" class="w-5 h-5 rounded-full object-cover ring-1 ring-white" referrerpolicy="no-referrer" />
                    }
                  </div>
                } @else if (userAvatars[itemNew.name]) {
                  <img [src]="userAvatars[itemNew.name]" class="w-5 h-5 rounded-full object-cover" referrerpolicy="no-referrer" />
                }
                <span class="text-xs text-gray-400">{{itemNew.name}}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Column: En cours -->
    <div class="flex w-64 flex-shrink-0 flex-col">
      <div class="flex items-center px-2 mb-3">
        <span class="font-display font-bold text-gray-700">ðŸ”„ En cours</span>
        <span class="ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-family-orange/20 text-xs font-bold text-family-orange">{{en_cours.length}}</span>
      </div>
      <div id="inProgressContainer" cdkDropList [cdkDropListData]="en_cours" (cdkDropListDropped)="drop($event)" class="flex-1 space-y-3 min-h-[60px]">
        @for (itemEnCours of en_cours; track itemEnCours) {
          <div cdkDrag>
            <div (click)="onEdit(itemEnCours.id)" class="card-fun p-4 cursor-pointer border-l-4 border-family-orange hover:shadow-card-hover transition-shadow">
              <span [ngClass]="getUrgencyClass(itemEnCours.urg)">{{itemEnCours.urg}}</span>
              <h4 class="mt-2 text-sm font-semibold text-gray-700">{{itemEnCours.title}}</h4>
              <div class="flex items-center gap-1.5 mt-1">
                @if (isForEveryone(itemEnCours)) {
                  <div class="flex -space-x-1.5">
                    @for (avatar of allUserAvatars; track avatar) {
                      <img [src]="avatar" class="w-5 h-5 rounded-full object-cover ring-1 ring-white" referrerpolicy="no-referrer" />
                    }
                  </div>
                } @else if (userAvatars[itemEnCours.name]) {
                  <img [src]="userAvatars[itemEnCours.name]" class="w-5 h-5 rounded-full object-cover" referrerpolicy="no-referrer" />
                }
                <span class="text-xs text-gray-400">{{itemEnCours.name}}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Column: Fait -->
    <div class="flex w-64 flex-shrink-0 flex-col">
      <div class="flex items-center px-2 mb-3">
        <span class="font-display font-bold text-gray-700">âœ… Fait</span>
        <span class="ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-family-green/20 text-xs font-bold text-family-green">{{fait.length}}</span>
      </div>
      <div id="doneContainer" cdkDropList [cdkDropListData]="fait" (cdkDropListDropped)="drop($event)" class="flex-1 space-y-3 min-h-[60px]">
        @for (itemFait of fait; track itemFait) {
          <div cdkDrag>
            <div (click)="onEdit(itemFait.id)" class="card-fun p-4 cursor-pointer border-l-4 border-family-green hover:shadow-card-hover transition-shadow">
              <span [ngClass]="getUrgencyClass(itemFait.urg)">{{itemFait.urg}}</span>
              <h4 class="mt-2 text-sm font-semibold text-gray-700">{{itemFait.title}}</h4>
              <div class="flex items-center gap-1.5 mt-1">
                @if (isForEveryone(itemFait)) {
                  <div class="flex -space-x-1.5">
                    @for (avatar of allUserAvatars; track avatar) {
                      <img [src]="avatar" class="w-5 h-5 rounded-full object-cover ring-1 ring-white" referrerpolicy="no-referrer" />
                    }
                  </div>
                } @else if (userAvatars[itemFait.name]) {
                  <img [src]="userAvatars[itemFait.name]" class="w-5 h-5 rounded-full object-cover" referrerpolicy="no-referrer" />
                }
                <span class="text-xs text-gray-400">{{itemFait.name}}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Column: Bloque -->
    <div class="flex w-64 flex-shrink-0 flex-col">
      <div class="flex items-center px-2 mb-3">
        <span class="font-display font-bold text-gray-700">ðŸš« Bloque</span>
        <span class="ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-red-100 text-xs font-bold text-red-500">{{bloquer.length}}</span>
      </div>
      <div id="bloqueContainer" cdkDropList [cdkDropListData]="bloquer" (cdkDropListDropped)="drop($event)" class="flex-1 space-y-3 min-h-[60px]">
        @for (itemBloquer of bloquer; track itemBloquer) {
          <div cdkDrag>
            <div (click)="onEdit(itemBloquer.id)" class="card-fun p-4 cursor-pointer border-l-4 border-red-400 hover:shadow-card-hover transition-shadow">
              <span [ngClass]="getUrgencyClass(itemBloquer.urg)">{{itemBloquer.urg}}</span>
              <h4 class="mt-2 text-sm font-semibold text-gray-700">{{itemBloquer.title}}</h4>
              <div class="flex items-center gap-1.5 mt-1">
                @if (isForEveryone(itemBloquer)) {
                  <div class="flex -space-x-1.5">
                    @for (avatar of allUserAvatars; track avatar) {
                      <img [src]="avatar" class="w-5 h-5 rounded-full object-cover ring-1 ring-white" referrerpolicy="no-referrer" />
                    }
                  </div>
                } @else if (userAvatars[itemBloquer.name]) {
                  <img [src]="userAvatars[itemBloquer.name]" class="w-5 h-5 rounded-full object-cover" referrerpolicy="no-referrer" />
                }
                <span class="text-xs text-gray-400">{{itemBloquer.name}}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- Column: Archive -->
    <div class="flex w-64 flex-shrink-0 flex-col">
      <div class="flex items-center px-2 mb-3">
        <span class="font-display font-bold text-gray-700">ðŸ“¦ Archive</span>
        <span class="ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-family-purple/20 text-xs font-bold text-family-purple">{{archiver.length}}</span>
      </div>
      <div id="archiveContainer" cdkDropList [cdkDropListData]="archiver" (cdkDropListDropped)="drop($event)" class="flex-1 space-y-3 min-h-[60px]">
        @for (itemArchiver of archiver; track itemArchiver) {
          <div cdkDrag>
            <div (click)="onEdit(itemArchiver.id)" class="card-fun p-4 cursor-pointer border-l-4 border-family-purple hover:shadow-card-hover transition-shadow">
              <span [ngClass]="getUrgencyClass(itemArchiver.urg)">{{itemArchiver.urg}}</span>
              <h4 class="mt-2 text-sm font-semibold text-gray-700">{{itemArchiver.title}}</h4>
              <div class="flex items-center gap-1.5 mt-1">
                @if (isForEveryone(itemArchiver)) {
                  <div class="flex -space-x-1.5">
                    @for (avatar of allUserAvatars; track avatar) {
                      <img [src]="avatar" class="w-5 h-5 rounded-full object-cover ring-1 ring-white" referrerpolicy="no-referrer" />
                    }
                  </div>
                } @else if (userAvatars[itemArchiver.name]) {
                  <img [src]="userAvatars[itemArchiver.name]" class="w-5 h-5 rounded-full object-cover" referrerpolicy="no-referrer" />
                }
                <span class="text-xs text-gray-400">{{itemArchiver.name}}</span>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

  </div>
</div>
