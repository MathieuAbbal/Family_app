<div class="max-w-2xl mx-auto px-4">
  <!-- VUE LISTE -->
  @if (view === 'list') {
    <div class="text-center mb-6">
      <h1 class="font-display text-2xl font-bold text-gradient">üçΩÔ∏è Recettes</h1>
      <p class="text-sm text-gray-400 mt-1">{{recipes().length}} recette{{recipes().length > 1 ? 's' : ''}}</p>
    </div>

    <!-- Bouton nouvelle recette -->
    <button (click)="openCreateForm()"
      class="w-full card-fun p-4 mb-6 flex items-center justify-center gap-2 text-gray-500 hover:text-family-purple transition-colors">
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
      <span class="font-medium">Cr√©er une recette</span>
    </button>

    <!-- Liste des recettes -->
    @if (recipes().length > 0) {
      <div class="space-y-3">
        @for (recipe of recipes(); track recipe.id) {
          <div class="card-fun p-4 hover:shadow-md transition-shadow">
            <div class="flex items-start gap-3">
              <div class="text-3xl">{{recipe.icon}}</div>
              <div class="flex-1 min-w-0">
                <h3 class="font-display font-bold text-gray-800">{{recipe.name}}</h3>
                <p class="text-sm text-gray-500">
                  {{recipe.ingredients.length}} ingr√©dient{{recipe.ingredients.length > 1 ? 's' : ''}} ‚Ä¢ {{recipe.portions}} portion{{recipe.portions > 1 ? 's' : ''}}
                </p>
                @if (recipe.createdByName) {
                  <p class="text-xs text-gray-400 mt-1">par {{recipe.createdByName}}</p>
                }
              </div>
              <div class="flex items-center gap-1">
                <button (click)="openAddToListModal(recipe); $event.stopPropagation()"
                  class="p-2 rounded-lg text-gray-400 hover:text-family-green hover:bg-family-green/10 transition-colors"
                  title="Ajouter aux courses">
                  <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                </button>
                <button (click)="openDetail(recipe)"
                  class="p-2 rounded-lg text-gray-400 hover:text-family-purple hover:bg-family-purple/10 transition-colors"
                  title="Voir d√©tails">
                  <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="text-center py-12 text-gray-400">
        <div class="text-4xl mb-3">üë®‚Äçüç≥</div>
        <p class="font-medium">Aucune recette</p>
        <p class="text-sm">Cr√©e ta premi√®re recette familiale !</p>
      </div>
    }
  }

  <!-- VUE D√âTAIL -->
  @if (view === 'detail' && selectedRecipe) {
    <div class="mb-4">
      <button (click)="backToList()" class="flex items-center gap-1 text-gray-500 hover:text-gray-700 transition-colors">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Retour
      </button>
    </div>

    <div class="text-center mb-6">
      <div class="text-5xl mb-2">{{selectedRecipe.icon}}</div>
      <h1 class="font-display text-2xl font-bold text-gray-800">{{selectedRecipe.name}}</h1>
      <p class="text-sm text-gray-500 mt-1">{{selectedRecipe.portions}} portion{{selectedRecipe.portions > 1 ? 's' : ''}}</p>
    </div>

    <!-- Actions -->
    <div class="flex justify-center gap-3 mb-6">
      <button (click)="openAddToListModal(selectedRecipe)" class="btn-gradient text-sm px-4 py-2 flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
        Ajouter aux courses
      </button>
      <button (click)="openEditForm(selectedRecipe)" class="px-4 py-2 rounded-xl border border-gray-200 text-gray-600 hover:bg-gray-50 transition-colors text-sm font-medium flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
        Modifier
      </button>
      <button (click)="openDeleteModal(selectedRecipe)" class="px-4 py-2 rounded-xl border border-red-200 text-red-500 hover:bg-red-50 transition-colors text-sm font-medium">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
      </button>
    </div>

    <!-- Ingr√©dients -->
    <div class="card-fun p-4">
      <h2 class="font-display font-bold text-gray-700 mb-3">Ingr√©dients</h2>
      <div class="divide-y divide-gray-100">
        @for (ing of selectedRecipe.ingredients; track $index) {
          <div class="flex items-center gap-3 py-2">
            <span class="text-lg">{{getCategoryIcon(ing.category)}}</span>
            <span class="flex-1 text-gray-700">{{ing.nom}}</span>
            <span class="text-sm text-gray-500">{{ing.quantity}}</span>
          </div>
        }
      </div>
    </div>
  }

  <!-- VUE √âDITION -->
  @if (view === 'edit') {
    <div class="mb-4">
      <button (click)="backToList()" class="flex items-center gap-1 text-gray-500 hover:text-gray-700 transition-colors">
        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
        Annuler
      </button>
    </div>

    <div class="text-center mb-6">
      <h1 class="font-display text-2xl font-bold text-gradient">
        {{editMode === 'create' ? 'Nouvelle recette' : 'Modifier la recette'}}
      </h1>
    </div>

    <div class="space-y-6">
      <!-- Infos recette -->
      <div class="card-fun p-4 space-y-4">
        <input [(ngModel)]="recipeName" placeholder="Nom de la recette..." class="input-fun w-full text-lg font-medium" />

        <div class="flex gap-4">
          <div class="flex-1">
            <label class="text-sm text-gray-500 mb-2 block">Ic√¥ne</label>
            <div class="flex flex-wrap gap-2">
              @for (icon of recipeIcons; track icon) {
                <button (click)="recipeIcon = icon"
                  [class]="recipeIcon === icon
                    ? 'w-10 h-10 rounded-xl bg-family-purple/10 text-xl flex items-center justify-center ring-2 ring-family-purple'
                    : 'w-10 h-10 rounded-xl bg-gray-100 text-xl flex items-center justify-center hover:bg-gray-200 transition-colors'">
                  {{icon}}
                </button>
              }
            </div>
          </div>
          <div class="w-32">
            <label class="text-sm text-gray-500 mb-2 block">Portions</label>
            <input type="number" [(ngModel)]="recipePortions" min="1" max="20" class="input-fun w-full text-center" />
          </div>
        </div>
      </div>

      <!-- Ingr√©dients -->
      <div class="card-fun p-4">
        <h2 class="font-display font-bold text-gray-700 mb-3">Ingr√©dients</h2>

        <!-- Liste ingr√©dients existants -->
        @if (recipeIngredients.length > 0) {
          <div class="divide-y divide-gray-100 mb-4">
            @for (ing of recipeIngredients; track $index) {
              <div class="flex items-center gap-3 py-2">
                <span class="text-lg">{{getCategoryIcon(ing.category)}}</span>
                <span class="flex-1 text-gray-700">{{ing.nom}}</span>
                <span class="text-sm text-gray-500">{{ing.quantity}}</span>
                <button (click)="removeIngredient($index)" class="text-gray-300 hover:text-red-400 transition-colors">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
              </div>
            }
          </div>
        }

        <!-- Form nouvel ingr√©dient -->
        <div class="bg-gray-50 rounded-xl p-3 space-y-3">
          <input [(ngModel)]="newIngredientName" placeholder="Nom de l'ingr√©dient..."
            class="input-fun w-full" (keyup.enter)="addIngredient()" />
          <div class="flex gap-3">
            <input [(ngModel)]="newIngredientQuantity" placeholder="Quantit√© (ex: 200g, 2...)"
              class="input-fun flex-1" />
            <select [(ngModel)]="newIngredientCategory" class="input-fun flex-1">
              @for (cat of categories; track cat.key) {
                <option [value]="cat.key">{{cat.icon}} {{cat.label}}</option>
              }
            </select>
          </div>
          <button (click)="addIngredient()" [disabled]="!newIngredientName.trim()"
            class="w-full py-2 rounded-xl border-2 border-dashed border-gray-300 text-gray-500 font-medium hover:border-family-green hover:text-family-green transition-colors disabled:opacity-50">
            + Ajouter ingr√©dient
          </button>
        </div>
      </div>

      <!-- Bouton sauvegarder -->
      <button (click)="saveRecipe()"
        [disabled]="!recipeName.trim() || recipeIngredients.length === 0"
        class="w-full btn-gradient py-3 font-medium disabled:opacity-50">
        {{editMode === 'create' ? 'Cr√©er la recette' : 'Enregistrer'}}
      </button>
    </div>
  }
</div>

<!-- Modal ajouter aux courses -->
@if (showAddToListModal && selectedRecipe) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-sm w-full">
      <div class="p-6">
        <h2 class="font-display text-xl font-bold text-gray-800 mb-4">Ajouter aux courses</h2>

        <div class="space-y-4">
          <!-- Choix de la liste -->
          <div>
            <label class="text-sm text-gray-500 mb-2 block">Liste de courses</label>
            <select [(ngModel)]="selectedListId" class="input-fun w-full">
              @for (list of shoppingLists(); track list.id) {
                <option [value]="list.id">{{list.icon}} {{list.name}}</option>
              }
            </select>
          </div>

          <!-- Multiplicateur de portions -->
          <div>
            <label class="text-sm text-gray-500 mb-2 block">
              Portions (recette: {{selectedRecipe.portions}})
            </label>
            <div class="flex items-center gap-3">
              <button (click)="decreaseMultiplier()"
                class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4"/></svg>
              </button>
              <div class="flex-1 text-center">
                <span class="text-2xl font-bold text-gray-800">x{{portionMultiplier}}</span>
                <p class="text-xs text-gray-500">{{selectedRecipe.portions * portionMultiplier}} portions</p>
              </div>
              <button (click)="increaseMultiplier()"
                class="w-10 h-10 rounded-xl bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/></svg>
              </button>
            </div>
          </div>

          <p class="text-sm text-gray-500 text-center">
            {{selectedRecipe.ingredients.length}} ingr√©dient{{selectedRecipe.ingredients.length > 1 ? 's' : ''}} seront ajout√©s
          </p>
        </div>

        <div class="flex gap-3 mt-6">
          <button (click)="closeAddToListModal()"
            class="flex-1 px-4 py-2.5 rounded-xl border border-gray-200 text-gray-600 font-medium hover:bg-gray-50 transition-colors">
            Annuler
          </button>
          <button (click)="confirmAddToList()" [disabled]="!selectedListId"
            class="flex-1 btn-gradient py-2.5">
            Ajouter
          </button>
        </div>
      </div>
    </div>
  </div>
}

<!-- Modal suppression -->
@if (showDeleteModal && recipeToDelete) {
  <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-2xl shadow-xl max-w-sm w-full">
      <div class="p-6">
        <div class="text-center mb-4">
          <div class="text-4xl mb-2">üóëÔ∏è</div>
          <h2 class="font-display text-xl font-bold text-gray-800">Supprimer la recette ?</h2>
          <p class="text-sm text-gray-500 mt-2">
            "{{recipeToDelete.icon}} {{recipeToDelete.name}}" sera supprim√©e d√©finitivement.
          </p>
        </div>
        <div class="flex gap-3">
          <button (click)="closeDeleteModal()"
            class="flex-1 px-4 py-2.5 rounded-xl border border-gray-200 text-gray-600 font-medium hover:bg-gray-50 transition-colors">
            Annuler
          </button>
          <button (click)="confirmDelete()"
            class="flex-1 px-4 py-2.5 rounded-xl bg-red-500 text-white font-medium hover:bg-red-600 transition-colors">
            Supprimer
          </button>
        </div>
      </div>
    </div>
  </div>
}
