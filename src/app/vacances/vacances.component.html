<!-- LIST VIEW -->
@if (!selectedVacation) {
  <div class="max-w-2xl mx-auto px-4">
    <div class="text-center mb-6">
      <h1 class="font-display text-2xl font-bold"><span>üèñÔ∏è</span> <span class="text-gradient">Vacances</span></h1>
    </div>

    <!-- Add button -->
    <button (click)="openAdd()"
      class="w-full card-fun p-4 mb-6 flex items-center justify-center gap-2 text-gray-500 hover:text-family-pink transition-colors">
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
      </svg>
      <span class="font-medium">Planifier des vacances</span>
    </button>

    <!-- Ongoing -->
    @for (v of ongoing(); track v.id) {
      <div (click)="selectVacation(v)"
        class="card-fun p-4 mb-4 cursor-pointer hover:shadow-card-hover transition-shadow border-l-4 border-green-400">
        <div class="flex items-center gap-2 mb-1">
          <span class="bg-green-100 text-green-700 text-xs font-bold px-2 py-0.5 rounded-full">En cours</span>
          <span class="text-lg">‚úàÔ∏è</span>
        </div>
        <h3 class="font-display font-bold text-gray-700">{{v.title}}</h3>
        <p class="text-sm text-gray-500">{{v.destination}} ¬∑ {{durationDays(v)}} jours</p>
        <p class="text-xs text-gray-400 mt-1">{{formatDate(v.startDate)}} ‚Üí {{formatDate(v.endDate)}}</p>
      </div>
    }

    <!-- Upcoming -->
    @if (upcoming().length) {
      <h2 class="font-display font-bold text-sm text-gray-500 mb-2 mt-6">A venir</h2>
    }
    @for (v of upcoming(); track v.id) {
      <div (click)="selectVacation(v)"
        class="card-fun p-4 mb-4 cursor-pointer hover:shadow-card-hover transition-shadow">
        <div class="flex justify-between items-start">
          <div>
            <h3 class="font-display font-bold text-gray-700">{{v.title}}</h3>
            <p class="text-sm text-gray-500">{{v.destination}}</p>
            <p class="text-xs text-gray-400 mt-1">{{formatDate(v.startDate)}} ‚Üí {{formatDate(v.endDate)}}</p>
          </div>
          <div class="text-center flex-shrink-0 ml-4">
            <div class="text-2xl font-display font-extrabold text-family-pink">{{daysUntil(v.startDate)}}</div>
            <div class="text-[10px] text-gray-400 font-medium">jours</div>
          </div>
        </div>
      </div>
    }

    <!-- Past -->
    @if (past().length) {
      <h2 class="font-display font-bold text-sm text-gray-500 mb-2 mt-6">Souvenirs</h2>
    }
    @for (v of past(); track v.id) {
      <div (click)="selectVacation(v)"
        class="card-fun p-4 mb-4 cursor-pointer hover:shadow-card-hover transition-shadow opacity-80">
        <h3 class="font-display font-bold text-gray-700">{{v.title}}</h3>
        <p class="text-sm text-gray-500">{{v.destination}} ¬∑ {{durationDays(v)}} jours</p>
        <p class="text-xs text-gray-400 mt-1">{{formatDate(v.startDate)}} ‚Üí {{formatDate(v.endDate)}}</p>
      </div>
    }

    @if (!vacations().length) {
      <div class="text-center py-12 text-gray-400">
        <div class="text-4xl mb-3">üå¥</div>
        <p class="font-medium">Aucune vacance planifiee</p>
        <p class="text-sm">Planifie ton prochain voyage !</p>
      </div>
    }
  </div>
}

<!-- DETAIL VIEW -->
@if (selectedVacation) {
  <div class="max-w-2xl mx-auto px-4">
    <!-- Back + Header -->
    <button (click)="backToList()" class="flex items-center gap-1 text-gray-500 hover:text-gray-700 mb-4 text-sm font-medium">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
      </svg>
      Retour
    </button>

    <div class="card-fun p-5 mb-4">
      <div class="flex justify-between items-start">
        <div>
          <h1 class="font-display text-xl font-bold text-gray-700">{{selectedVacation.title}}</h1>
          <p class="text-sm text-gray-500 mt-1">üìç {{selectedVacation.destination}}</p>
          <p class="text-xs text-gray-400 mt-1">{{formatDate(selectedVacation.startDate)}} ‚Üí {{formatDate(selectedVacation.endDate)}} ¬∑ {{durationDays(selectedVacation)}} jours</p>
        </div>
        @if (daysUntil(selectedVacation.startDate) > 0) {
          <div class="text-center flex-shrink-0">
            <div class="text-3xl font-display font-extrabold text-family-pink">{{daysUntil(selectedVacation.startDate)}}</div>
            <div class="text-[10px] text-gray-400">jours</div>
          </div>
        }
      </div>
      @if (selectedVacation.description) {
        <p class="text-sm text-gray-600 mt-3">{{selectedVacation.description}}</p>
      }
    </div>

    <!-- Tabs -->
    <div class="flex gap-1 mb-4 bg-gray-100 rounded-xl p-1">
      <button (click)="onTabChange('checklist')"
        [class]="activeTab === 'checklist' ? 'flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-pink shadow-sm' : 'flex-1 py-2 rounded-lg text-sm font-medium text-gray-500'">
        Checklist
      </button>
      <button (click)="onTabChange('photos')"
        [class]="activeTab === 'photos' ? 'flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-coral shadow-sm' : 'flex-1 py-2 rounded-lg text-sm font-medium text-gray-500'">
        Photos
      </button>
      <button (click)="onTabChange('map')"
        [class]="activeTab === 'map' ? 'flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-sky shadow-sm' : 'flex-1 py-2 rounded-lg text-sm font-medium text-gray-500'">
        Carte
      </button>
    </div>

    <!-- CHECKLIST TAB -->
    @if (activeTab === 'checklist') {
      <!-- Progress -->
      @if (checklist.length) {
        <div class="mb-4">
          <div class="flex justify-between text-xs text-gray-500 mb-1">
            <span>{{checklistProgress}}% complete</span>
            <span>{{checklist.length}} elements</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2">
            <div class="bg-gradient-to-r from-family-pink to-family-coral h-2 rounded-full transition-all"
              [style.width.%]="checklistProgress"></div>
          </div>
        </div>
      }

      <!-- Add item -->
      <div class="flex gap-2 mb-4">
        <input [(ngModel)]="newItemText" (keyup.enter)="addItem()"
          placeholder="Ajouter un element..."
          class="flex-1 input-fun text-sm">
        <button (click)="addItem()" class="btn-gradient px-4 text-sm">+</button>
      </div>

      <!-- Items -->
      <div class="card-fun overflow-hidden divide-y divide-gray-100">
        @for (item of checklist; track item.id) {
          <div class="flex items-center gap-3 px-4 py-3">
            <input type="checkbox" [checked]="item.checked" (change)="toggleItem(item)"
              class="w-4 h-4 rounded border-gray-300 text-family-pink focus:ring-family-pink">
            <span [class]="item.checked ? 'flex-1 text-sm text-gray-400 line-through' : 'flex-1 text-sm text-gray-700'">
              {{item.text}}
            </span>
            <button (click)="deleteItem(item)" class="text-gray-300 hover:text-red-400 transition-colors">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        }
      </div>

      @if (!checklist.length) {
        <div class="text-center py-8 text-gray-400 text-sm">
          <div class="text-2xl mb-2">üìù</div>
          Ajoute des elements a ta checklist
        </div>
      }
    }

    <!-- PHOTOS TAB -->
    @if (activeTab === 'photos') {
      <label class="block card-fun p-4 mb-4 text-center cursor-pointer hover:shadow-card-hover transition-shadow">
        <input type="file" accept="image/*" (change)="onPhotoSelected($event)" class="hidden">
        @if (uploading) {
          <div class="flex items-center justify-center gap-2 text-sm text-gray-500">
            <div class="w-4 h-4 border-2 border-family-coral border-t-transparent rounded-full animate-spin"></div>
            Upload en cours...
          </div>
        } @else {
          <div class="text-gray-500 text-sm font-medium">üì∑ Ajouter une photo</div>
        }
      </label>

      <div class="grid grid-cols-2 gap-3">
        @for (photo of photos; track photo.id) {
          <div class="relative group">
            <img [src]="photo.url" loading="lazy"
              class="w-full aspect-square object-cover rounded-xl shadow-sm">
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/50 to-transparent p-2 rounded-b-xl">
              <p class="text-white text-xs truncate">{{photo.addedByName}}</p>
            </div>
            <button (click)="deletePhoto(photo)"
              class="absolute top-2 right-2 w-6 h-6 bg-white/80 rounded-full flex items-center justify-center opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity text-red-400">
              <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        }
      </div>

      @if (!photos.length && !uploading) {
        <div class="text-center py-8 text-gray-400 text-sm">
          <div class="text-2xl mb-2">üì∏</div>
          Ajoute des photos de tes vacances
        </div>
      }
    }

    <!-- MAP TAB -->
    @if (activeTab === 'map') {
      <div #detailMap class="w-full h-80 rounded-xl overflow-hidden shadow-sm"></div>
    }

    <!-- Delete vacation -->
    <div class="mt-8 mb-8 text-center">
      <button (click)="deleteVacation()" class="text-sm text-red-400 hover:text-red-600 transition-colors">
        Supprimer ce voyage
      </button>
    </div>
  </div>
}
