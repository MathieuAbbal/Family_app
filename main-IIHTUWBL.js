var TK=Object.create;var LI=Object.defineProperty,SK=Object.defineProperties,DK=Object.getOwnPropertyDescriptor,IK=Object.getOwnPropertyDescriptors,MK=Object.getOwnPropertyNames,Tx=Object.getOwnPropertySymbols,eV=Object.getPrototypeOf,BI=Object.prototype.hasOwnProperty,tV=Object.prototype.propertyIsEnumerable,AK=Reflect.get;var JB=(n,t,e)=>t in n?LI(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Be=(n,t)=>{for(var e in t||={})BI.call(t,e)&&JB(n,e,t[e]);if(Tx)for(var e of Tx(t))tV.call(t,e)&&JB(n,e,t[e]);return n},Mt=(n,t)=>SK(n,IK(t));var Ky=(n,t)=>{var e={};for(var i in n)BI.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&Tx)for(var i of Tx(n))t.indexOf(i)<0&&tV.call(n,i)&&(e[i]=n[i]);return e};var nV=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var kK=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of MK(t))!BI.call(n,r)&&r!==e&&LI(n,r,{get:()=>t[r],enumerable:!(i=DK(t,r))||i.enumerable});return n};var Sx=(n,t,e)=>(e=n!=null?TK(eV(n)):{},kK(t||!n||!n.__esModule?LI(e,"default",{value:n,enumerable:!0}):e,n));var vf=(n,t,e)=>AK(eV(n),e,t);var ae=(n,t,e)=>new Promise((i,r)=>{var o=b=>{try{m(e.next(b))}catch(T){r(T)}},d=b=>{try{m(e.throw(b))}catch(T){r(T)}},m=b=>b.done?i(b.value):Promise.resolve(b.value).then(o,d);m((e=e.apply(n,t)).next())});var jV=nV((S0e,Gx)=>{var bV,wV,xV,EV,CV,TV,SV,DV,IV,$x,aM,MV,AV,kV,eg,RV,PV,NV,OV,FV,LV,BV,VV,Hx;(function(n){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(i){n(e(t,e(i)))}):typeof Gx=="object"&&typeof Gx.exports=="object"?n(e(t,e(Gx.exports))):n(e(t));function e(i,r){return i!==t&&(typeof Object.create=="function"?Object.defineProperty(i,"__esModule",{value:!0}):i.__esModule=!0),function(o,d){return i[o]=r?r(o,d):d}}})(function(n){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])};bV=function(i,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(i,r);function o(){this.constructor=i}i.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)},wV=Object.assign||function(i){for(var r,o=1,d=arguments.length;o<d;o++){r=arguments[o];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(i[m]=r[m])}return i},xV=function(i,r){var o={};for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&r.indexOf(d)<0&&(o[d]=i[d]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,d=Object.getOwnPropertySymbols(i);m<d.length;m++)r.indexOf(d[m])<0&&Object.prototype.propertyIsEnumerable.call(i,d[m])&&(o[d[m]]=i[d[m]]);return o},EV=function(i,r,o,d){var m=arguments.length,b=m<3?r:d===null?d=Object.getOwnPropertyDescriptor(r,o):d,T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(i,r,o,d);else for(var A=i.length-1;A>=0;A--)(T=i[A])&&(b=(m<3?T(b):m>3?T(r,o,b):T(r,o))||b);return m>3&&b&&Object.defineProperty(r,o,b),b},CV=function(i,r){return function(o,d){r(o,d,i)}},TV=function(i,r){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,r)},SV=function(i,r,o,d){function m(b){return b instanceof o?b:new o(function(T){T(b)})}return new(o||(o=Promise))(function(b,T){function A(J){try{q(d.next(J))}catch(K){T(K)}}function N(J){try{q(d.throw(J))}catch(K){T(K)}}function q(J){J.done?b(J.value):m(J.value).then(A,N)}q((d=d.apply(i,r||[])).next())})},DV=function(i,r){var o={label:0,sent:function(){if(b[0]&1)throw b[1];return b[1]},trys:[],ops:[]},d,m,b,T;return T={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function A(q){return function(J){return N([q,J])}}function N(q){if(d)throw new TypeError("Generator is already executing.");for(;o;)try{if(d=1,m&&(b=q[0]&2?m.return:q[0]?m.throw||((b=m.return)&&b.call(m),0):m.next)&&!(b=b.call(m,q[1])).done)return b;switch(m=0,b&&(q=[q[0]&2,b.value]),q[0]){case 0:case 1:b=q;break;case 4:return o.label++,{value:q[1],done:!1};case 5:o.label++,m=q[1],q=[0];continue;case 7:q=o.ops.pop(),o.trys.pop();continue;default:if(b=o.trys,!(b=b.length>0&&b[b.length-1])&&(q[0]===6||q[0]===2)){o=0;continue}if(q[0]===3&&(!b||q[1]>b[0]&&q[1]<b[3])){o.label=q[1];break}if(q[0]===6&&o.label<b[1]){o.label=b[1],b=q;break}if(b&&o.label<b[2]){o.label=b[2],o.ops.push(q);break}b[2]&&o.ops.pop(),o.trys.pop();continue}q=r.call(i,o)}catch(J){q=[6,J],m=0}finally{d=b=0}if(q[0]&5)throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}},IV=function(i,r){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&Hx(r,i,o)},Hx=Object.create?function(i,r,o,d){d===void 0&&(d=o),Object.defineProperty(i,d,{enumerable:!0,get:function(){return r[o]}})}:function(i,r,o,d){d===void 0&&(d=o),i[d]=r[o]},$x=function(i){var r=typeof Symbol=="function"&&Symbol.iterator,o=r&&i[r],d=0;if(o)return o.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&d>=i.length&&(i=void 0),{value:i&&i[d++],done:!i}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},aM=function(i,r){var o=typeof Symbol=="function"&&i[Symbol.iterator];if(!o)return i;var d=o.call(i),m,b=[],T;try{for(;(r===void 0||r-- >0)&&!(m=d.next()).done;)b.push(m.value)}catch(A){T={error:A}}finally{try{m&&!m.done&&(o=d.return)&&o.call(d)}finally{if(T)throw T.error}}return b},MV=function(){for(var i=[],r=0;r<arguments.length;r++)i=i.concat(aM(arguments[r]));return i},AV=function(){for(var i=0,r=0,o=arguments.length;r<o;r++)i+=arguments[r].length;for(var d=Array(i),m=0,r=0;r<o;r++)for(var b=arguments[r],T=0,A=b.length;T<A;T++,m++)d[m]=b[T];return d},kV=function(i,r){for(var o=0,d=r.length,m=i.length;o<d;o++,m++)i[m]=r[o];return i},eg=function(i){return this instanceof eg?(this.v=i,this):new eg(i)},RV=function(i,r,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=o.apply(i,r||[]),m,b=[];return m={},T("next"),T("throw"),T("return"),m[Symbol.asyncIterator]=function(){return this},m;function T(xe){d[xe]&&(m[xe]=function(Te){return new Promise(function(Ge,Et){b.push([xe,Te,Ge,Et])>1||A(xe,Te)})})}function A(xe,Te){try{N(d[xe](Te))}catch(Ge){K(b[0][3],Ge)}}function N(xe){xe.value instanceof eg?Promise.resolve(xe.value.v).then(q,J):K(b[0][2],xe)}function q(xe){A("next",xe)}function J(xe){A("throw",xe)}function K(xe,Te){xe(Te),b.shift(),b.length&&A(b[0][0],b[0][1])}},PV=function(i){var r,o;return r={},d("next"),d("throw",function(m){throw m}),d("return"),r[Symbol.iterator]=function(){return this},r;function d(m,b){r[m]=i[m]?function(T){return(o=!o)?{value:eg(i[m](T)),done:m==="return"}:b?b(T):T}:b}},NV=function(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i[Symbol.asyncIterator],o;return r?r.call(i):(i=typeof $x=="function"?$x(i):i[Symbol.iterator](),o={},d("next"),d("throw"),d("return"),o[Symbol.asyncIterator]=function(){return this},o);function d(b){o[b]=i[b]&&function(T){return new Promise(function(A,N){T=i[b](T),m(A,N,T.done,T.value)})}}function m(b,T,A,N){Promise.resolve(N).then(function(q){b({value:q,done:A})},T)}},OV=function(i,r){return Object.defineProperty?Object.defineProperty(i,"raw",{value:r}):i.raw=r,i};var e=Object.create?function(i,r){Object.defineProperty(i,"default",{enumerable:!0,value:r})}:function(i,r){i.default=r};FV=function(i){if(i&&i.__esModule)return i;var r={};if(i!=null)for(var o in i)o!=="default"&&Object.prototype.hasOwnProperty.call(i,o)&&Hx(r,i,o);return e(r,i),r},LV=function(i){return i&&i.__esModule?i:{default:i}},BV=function(i,r){if(!r.has(i))throw new TypeError("attempted to get private field on non-instance");return r.get(i)},VV=function(i,r,o){if(!r.has(i))throw new TypeError("attempted to set private field on non-instance");return r.set(i,o),o},n("__extends",bV),n("__assign",wV),n("__rest",xV),n("__decorate",EV),n("__param",CV),n("__metadata",TV),n("__awaiter",SV),n("__generator",DV),n("__exportStar",IV),n("__createBinding",Hx),n("__values",$x),n("__read",aM),n("__spread",MV),n("__spreadArrays",AV),n("__spreadArray",kV),n("__await",eg),n("__asyncGenerator",RV),n("__asyncDelegator",PV),n("__asyncValues",NV),n("__makeTemplateObject",OV),n("__importStar",FV),n("__importDefault",LV),n("__classPrivateFieldGet",BV),n("__classPrivateFieldSet",VV)})});var rD=nV((MF,AF)=>{(function(n,t){typeof MF=="object"&&typeof AF<"u"?AF.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis<"u"?globalThis:n||self,n.maplibregl=t())})(MF,function(){"use strict";var n={},t={};function e(r,o,d){if(t[r]=d,r==="index"){var m="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",b={};return t.shared(b),t.index(n,b),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([m],{type:"text/javascript"}))),n}}e("shared",["exports"],function(r){"use strict";function o(c,s,l,h){return new(l||(l=Promise))(function(p,_){function y(D){try{C(h.next(D))}catch(M){_(M)}}function x(D){try{C(h.throw(D))}catch(M){_(M)}}function C(D){var M;D.done?p(D.value):(M=D.value,M instanceof l?M:new l(function(R){R(M)})).then(y,x)}C((h=h.apply(c,s||[])).next())})}function d(c,s){this.x=c,this.y=s}function m(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var b,T;typeof SuppressedError=="function"&&SuppressedError,d.prototype={clone(){return new d(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,s){return this.clone()._rotateAround(c,s)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){let s=c.x-this.x,l=c.y-this.y;return s*s+l*l},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,s){return Math.atan2(this.x*s-this.y*c,this.x*c+this.y*s)},_matMult(c){let s=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=s,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){let c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){let s=Math.cos(c),l=Math.sin(c),h=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=h,this},_rotateAround(c,s){let l=Math.cos(c),h=Math.sin(c),p=s.y+h*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-h*(this.y-s.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:d},d.convert=function(c){if(c instanceof d)return c;if(Array.isArray(c))return new d(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new d(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};var A=(function(){if(T)return b;function c(s,l,h,p){this.cx=3*s,this.bx=3*(h-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=h,this.p2y=p}return T=1,b=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var h=s,p=0;p<8;p++){var _=this.sampleCurveX(h)-s;if(Math.abs(_)<l)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var x=0,C=1;for(h=s,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-s)<l));p++)s>_?x=h:C=h,h=.5*(C-x)+x;return h},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},b})(),N=m(A);let q,J;function K(){return q==null&&(q=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),q}function xe(){if(J==null&&(J=!1,K())){let s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let h=0;h<25;h++){let p=4*h;s.fillStyle=`rgb(${p},${p+1},${p+2})`,s.fillRect(h%5,Math.floor(h/5),1,1)}let l=s.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&l[h]!==h){J=!0;break}}}return J||!1}var Te=1e-6,Ge=typeof Float32Array<"u"?Float32Array:Array;function Et(){var c=new Ge(9);return Ge!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function kt(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Ue(){var c=new Ge(3);return Ge!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function Oe(c){var s=c[0],l=c[1],h=c[2];return Math.sqrt(s*s+l*l+h*h)}function Qe(c,s,l){var h=new Ge(3);return h[0]=c,h[1]=s,h[2]=l,h}function ct(c,s,l){return c[0]=s[0]+l[0],c[1]=s[1]+l[1],c[2]=s[2]+l[2],c}function bt(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c}function Gt(c,s,l){var h=s[0],p=s[1],_=s[2],y=l[0],x=l[1],C=l[2];return c[0]=p*C-_*x,c[1]=_*y-h*C,c[2]=h*x-p*y,c}var Bt,jn=Oe;function $n(c,s,l){var h=s[0],p=s[1],_=s[2],y=s[3];return c[0]=l[0]*h+l[4]*p+l[8]*_+l[12]*y,c[1]=l[1]*h+l[5]*p+l[9]*_+l[13]*y,c[2]=l[2]*h+l[6]*p+l[10]*_+l[14]*y,c[3]=l[3]*h+l[7]*p+l[11]*_+l[15]*y,c}function Ji(){var c=new Ge(4);return Ge!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Ao(c,s,l,h){var p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",_=Math.PI/360;s*=_,h*=_,l*=_;var y=Math.sin(s),x=Math.cos(s),C=Math.sin(l),D=Math.cos(l),M=Math.sin(h),R=Math.cos(h);switch(p){case"xyz":c[0]=y*D*R+x*C*M,c[1]=x*C*R-y*D*M,c[2]=x*D*M+y*C*R,c[3]=x*D*R-y*C*M;break;case"xzy":c[0]=y*D*R-x*C*M,c[1]=x*C*R-y*D*M,c[2]=x*D*M+y*C*R,c[3]=x*D*R+y*C*M;break;case"yxz":c[0]=y*D*R+x*C*M,c[1]=x*C*R-y*D*M,c[2]=x*D*M-y*C*R,c[3]=x*D*R+y*C*M;break;case"yzx":c[0]=y*D*R+x*C*M,c[1]=x*C*R+y*D*M,c[2]=x*D*M-y*C*R,c[3]=x*D*R-y*C*M;break;case"zxy":c[0]=y*D*R-x*C*M,c[1]=x*C*R+y*D*M,c[2]=x*D*M+y*C*R,c[3]=x*D*R-y*C*M;break;case"zyx":c[0]=y*D*R-x*C*M,c[1]=x*C*R+y*D*M,c[2]=x*D*M-y*C*R,c[3]=x*D*R+y*C*M;break;default:throw new Error("Unknown angle order "+p)}return c}function zn(){var c=new Ge(2);return Ge!=Float32Array&&(c[0]=0,c[1]=0),c}function Ct(c,s){var l=new Ge(2);return l[0]=c,l[1]=s,l}Ue(),Bt=new Ge(4),Ge!=Float32Array&&(Bt[0]=0,Bt[1]=0,Bt[2]=0,Bt[3]=0),Ue(),Qe(1,0,0),Qe(0,1,0),Ji(),Ji(),Et(),zn();let ft=8192;function Lt(c,s,l){return s*(ft/(c.tileSize*Math.pow(2,l-c.tileID.overscaledZ)))}function hn(c,s){return(c%s+s)%s}function di(c,s,l){return c*(1-l)+s*l}function yr(c){if(c<=0)return 0;if(c>=1)return 1;let s=c*c,l=s*c;return 4*(c<.5?l:3*(c-s)+l-.75)}function _i(c,s,l,h){let p=new N(c,s,l,h);return _=>p.solve(_)}let cr=_i(.25,.1,.25,1);function ln(c,s,l){return Math.min(l,Math.max(s,c))}function ls(c,s,l){let h=l-s,p=((c-s)%h+h)%h+s;return p===s?l:p}function ur(c,...s){for(let l of s)for(let h in l)c[h]=l[h];return c}let mn=1;function Ti(c,s,l){let h={};for(let p in c)h[p]=s.call(this,c[p],p,c);return h}function Yn(c,s,l){let h={};for(let p in c)s.call(this,c[p],p,c)&&(h[p]=c[p]);return h}function Ar(c){return Array.isArray(c)?c.map(Ar):typeof c=="object"&&c?Ti(c,Ar):c}let Fl={};function zr(c){Fl[c]||(typeof console<"u"&&console.warn(c),Fl[c]=!0)}function As(c,s,l){return(l.y-c.y)*(s.x-c.x)>(s.y-c.y)*(l.x-c.x)}function Gs(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Ni=null;function Ja(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}let Vu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ju(c,s,l,h,p){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let _=new VideoFrame(c,{timestamp:0});try{let y=_?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);let x=y.startsWith("BGR"),C=new Uint8ClampedArray(h*p*4);if(yield _.copyTo(C,(function(D,M,R,O,F){let j=4*Math.max(-M,0),z=(Math.max(0,R)-R)*O*4+j,H=4*O,Q=Math.max(0,M),le=Math.max(0,R);return{rect:{x:Q,y:le,width:Math.min(D.width,M+O)-Q,height:Math.min(D.height,R+F)-le},layout:[{offset:z,stride:H}]}})(c,s,l,h,p)),x)for(let D=0;D<C.length;D+=4){let M=C[D];C[D]=C[D+2],C[D+2]=M}return C}finally{_.close()}})}let xa,el;function kc(c,s,l,h){return c.addEventListener(s,l,h),{unsubscribe:()=>{c.removeEventListener(s,l,h)}}}function zu(c){return c*Math.PI/180}function cs(c){return c/Math.PI*180}let Ll={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Eh={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Uu="AbortError";class $u extends Error{constructor(s=Uu){super(s instanceof Error?s.message:s),this.name=Uu,s instanceof Error&&s.stack&&(this.stack=s.stack)}}function Ee(c){return c.name===Uu}let G={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function W(c){return G.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}let X="global-dispatcher";class fe extends Error{constructor(s,l,h,p){super(`AJAXError: ${l} (${s}): ${h}`),this.status=s,this.statusText=l,this.url=h,this.body=p}}let ye=()=>Gs(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Me=function(c,s){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){let h=W(c.url);if(h)return h(c,s);if(Gs(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:X},s)}if(!(/^file:/.test(l=c.url)||/^file:/.test(ye())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(h,p){return o(this,void 0,void 0,function*(){let _=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:ye(),signal:p.signal}),y,x;h.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{y=yield fetch(_)}catch(D){throw Ee(D)?D:new fe(0,D.message,h.url,new Blob)}if(!y.ok){let D=yield y.blob();throw new fe(y.status,y.statusText,h.url,D)}x=h.type==="arrayBuffer"||h.type==="image"?y.arrayBuffer():h.type==="json"?y.json():y.text();let C=yield x;return p.signal.throwIfAborted(),{data:C,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}})})(c,s);if(Gs(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:X},s)}var l;return(function(h,p){return new Promise((_,y)=>{var x;let C=new XMLHttpRequest;C.open(h.method||"GET",h.url,!0),h.type!=="arrayBuffer"&&h.type!=="image"||(C.responseType="arraybuffer");for(let D in h.headers)C.setRequestHeader(D,h.headers[D]);h.type==="json"&&(C.responseType="text",!((x=h.headers)===null||x===void 0)&&x.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=h.credentials==="include",C.onerror=()=>{y(new Error(C.statusText))},C.onload=()=>{if(!p.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let D=C.response;if(h.type==="json")try{D=JSON.parse(C.response)}catch(M){return void y(M)}_({data:D,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{let D=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});y(new fe(C.status,C.statusText,h.url,D))}},p.signal.addEventListener("abort",()=>{C.abort(),y(new $u(p.signal.reason))}),C.send(h.body)})})(c,s)};function De(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;let s=new URL(c),l=window.location;return s.protocol===l.protocol&&s.host===l.host}function Ce(c,s,l){l[c]&&l[c].indexOf(s)!==-1||(l[c]=l[c]||[],l[c].push(s))}function Se(c,s,l){if(l&&l[c]){let h=l[c].indexOf(s);h!==-1&&l[c].splice(h,1)}}class Xe{constructor(s,l={}){ur(this,l),this.type=s}}class $e extends Xe{constructor(s,l={}){super("error",ur({error:s},l))}}class it{on(s,l){return this._listeners=this._listeners||{},Ce(s,l,this._listeners),{unsubscribe:()=>{this.off(s,l)}}}off(s,l){return Se(s,l,this._listeners),Se(s,l,this._oneTimeListeners),this}once(s,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Ce(s,l,this._oneTimeListeners),this):new Promise(h=>this.once(s,h))}fire(s,l){typeof s=="string"&&(s=new Xe(s,l||{}));let h=s.type;if(this.listens(h)){s.target=this;let p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(let x of p)x.call(this,s);let _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(let x of _)Se(h,x,this._oneTimeListeners),x.call(this,s);let y=this._eventedParent;y&&(ur(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(s))}else s instanceof $e&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,l){return this._eventedParent=s,this._eventedParentData=l,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number",length:2},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"filter"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible",expression:{interpolated:!1,parameters:["global-state"]},"property-type":"data-constant"}},filter:{type:"boolean",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"expression_name",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}},interpolation:{type:"array",value:"interpolation_name",minimum:1},interpolation_name:{type:"enum",values:{linear:{syntax:{overloads:[{parameters:[],"output-type":"interpolation"}],parameters:[]}},exponential:{syntax:{overloads:[{parameters:["base"],"output-type":"interpolation"}],parameters:[{name:"base",type:"number literal"}]}},"cubic-bezier":{syntax:{overloads:[{parameters:["x1","y1","x2","y2"],"output-type":"interpolation"}],parameters:[{name:"x1",type:"number literal"},{name:"y1",type:"number literal"},{name:"x2",type:"number literal"},{name:"y2",type:"number literal"}]}}}}};let Zt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Jn(c,s){let l={};for(let h in c)h!=="ref"&&(l[h]=c[h]);return Zt.forEach(h=>{h in s&&(l[h]=s[h])}),l}function St(c,s){if(Array.isArray(c)){if(!Array.isArray(s)||c.length!==s.length)return!1;for(let l=0;l<c.length;l++)if(!St(c[l],s[l]))return!1;return!0}if(typeof c=="object"&&c!==null&&s!==null){if(typeof s!="object"||Object.keys(c).length!==Object.keys(s).length)return!1;for(let l in c)if(!St(c[l],s[l]))return!1;return!0}return c===s}function Nt(c,s){c.push(s)}function cn(c,s,l){Nt(l,{command:"addSource",args:[c,s[c]]})}function Hi(c,s,l){Nt(s,{command:"removeSource",args:[c]}),l[c]=!0}function hi(c,s,l,h){Hi(c,l,h),cn(c,s,l)}function kr(c,s,l){let h;for(h in c[l])if(Object.prototype.hasOwnProperty.call(c[l],h)&&h!=="data"&&!St(c[l][h],s[l][h]))return!1;for(h in s[l])if(Object.prototype.hasOwnProperty.call(s[l],h)&&h!=="data"&&!St(c[l][h],s[l][h]))return!1;return!0}function Rr(c,s,l,h,p,_){c=c||{},s=s||{};for(let y in c)Object.prototype.hasOwnProperty.call(c,y)&&(St(c[y],s[y])||l.push({command:_,args:[h,y,s[y],p]}));for(let y in s)Object.prototype.hasOwnProperty.call(s,y)&&!Object.prototype.hasOwnProperty.call(c,y)&&(St(c[y],s[y])||l.push({command:_,args:[h,y,s[y],p]}))}function Gi(c){return c.id}function Pr(c,s){return c[s.id]=s,c}class Ke{constructor(s,l,h,p){this.message=(s?`${s}: `:"")+h,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function dr(c,...s){for(let l of s)for(let h in l)c[h]=l[h];return c}class qo extends Error{constructor(s,l){super(l),this.message=l,this.key=s}}class Rc{constructor(s,l=[]){this.parent=s,this.bindings={};for(let[h,p]of l)this.bindings[h]=p}concat(s){return new Rc(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}let er={kind:"null"},ut={kind:"number"},nn={kind:"string"},gn={kind:"boolean"},us={kind:"color"},Fp={kind:"projectionDefinition"},tl={kind:"object"},un={kind:"value"},Ch={kind:"collator"},Th={kind:"formatted"},Lp={kind:"padding"},Hu={kind:"colorArray"},Sh={kind:"numberArray"},Gu={kind:"resolvedImage"},Dh={kind:"variableAnchorOffsetCollection"};function ko(c,s){return{kind:"array",itemType:c,N:s}}function Wn(c){if(c.kind==="array"){let s=Wn(c.itemType);return typeof c.N=="number"?`array<${s}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${s}>`}return c.kind}let Bp=[er,ut,nn,gn,us,Fp,Th,tl,ko(un),Lp,Sh,Hu,Gu,Dh];function qu(c,s){if(s.kind==="error")return null;if(c.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!qu(c.itemType,s.itemType))&&(typeof c.N!="number"||c.N===s.N))return null}else{if(c.kind===s.kind)return null;if(c.kind==="value"){for(let l of Bp)if(!qu(l,s))return null}}return`Expected ${Wn(c)} but found ${Wn(s)} instead.`}function Ih(c,s){return s.some(l=>l.kind===c.kind)}function Pc(c,s){return s.some(l=>l==="null"?c===null:l==="array"?Array.isArray(c):l==="object"?c&&!Array.isArray(c)&&typeof c=="object":l===typeof c)}function qs(c,s){return c.kind==="array"&&s.kind==="array"?c.itemType.kind===s.itemType.kind&&typeof c.N=="number":c.kind===s.kind}let Yb=.96422,Nc=.82521,Vp=4/29,qi=6/29,Xb=3*qi*qi,Qb=qi*qi*qi,Mh=Math.PI/180,Jb=180/Math.PI;function ew(c){return(c%=360)<0&&(c+=360),c}function tw([c,s,l,h]){let p,_,y=N_((.2225045*(c=jp(c))+.7168786*(s=jp(s))+.0606169*(l=jp(l)))/1);c===s&&s===l?p=_=y:(p=N_((.4360747*c+.3850649*s+.1430804*l)/Yb),_=N_((.0139322*c+.0971045*s+.7141733*l)/Nc));let x=116*y-16;return[x<0?0:x,500*(p-y),200*(y-_),h]}function jp(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function N_(c){return c>Qb?Math.pow(c,1/3):c/Xb+Vp}function O_([c,s,l,h]){let p=(c+16)/116,_=isNaN(s)?p:p+s/500,y=isNaN(l)?p:p-l/200;return p=1*L_(p),_=Yb*L_(_),y=Nc*L_(y),[F_(3.1338561*_-1.6168667*p-.4906146*y),F_(-.9787684*_+1.9161415*p+.033454*y),F_(.0719453*_-.2289914*p+1.4052427*y),h]}function F_(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function L_(c){return c>qi?c*c*c:Xb*(c-Vp)}let fD=Object.hasOwn||function(c,s){return Object.prototype.hasOwnProperty.call(c,s)};function Ah(c,s){return fD(c,s)?c[s]:void 0}function zp(c){return parseInt(c.padEnd(2,c),16)/255}function nw(c,s){return Wu(s?c/100:c,0,1)}function Wu(c,s,l){return Math.min(Math.max(s,c),l)}function B_(c){return!c.some(Number.isNaN)}let kh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Bl(c,s,l){return c+l*(s-c)}function Zu(c,s,l){return c.map((h,p)=>Bl(h,s[p],l))}class _n{constructor(s,l,h,p=1,_=!0){this.r=s,this.g=l,this.b=h,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[s,l,h,p]))}static parse(s){if(s instanceof _n)return s;if(typeof s!="string")return;let l=(function(h){if((h=h.toLowerCase().trim())==="transparent")return[0,0,0,0];let p=Ah(kh,h);if(p){let[y,x,C]=p;return[y/255,x/255,C/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){let y=h.length<6?1:2,x=1;return[zp(h.slice(x,x+=y)),zp(h.slice(x,x+=y)),zp(h.slice(x,x+=y)),zp(h.slice(x,x+y)||"ff")]}if(h.startsWith("rgb")){let y=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[x,C,D,M,R,O,F,j,z,H,Q,le]=y,ee=[M||" ",F||" ",H].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){let ne=[D,O,z].join(""),de=ne==="%%%"?100:ne===""?255:0;if(de){let me=[Wu(+C/de,0,1),Wu(+R/de,0,1),Wu(+j/de,0,1),Q?nw(+Q,le):1];if(B_(me))return me}}return}}let _=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[y,x,C,D,M,R,O,F,j]=_,z=[C||" ",M||" ",O].join("");if(z==="  "||z==="  /"||z===",,"||z===",,,"){let H=[+x,Wu(+D,0,100),Wu(+R,0,100),F?nw(+F,j):1];if(B_(H))return(function([Q,le,ee,ne]){function de(me){let Ie=(me+Q/30)%12,qe=le*Math.min(ee,1-ee);return ee-qe*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return Q=ew(Q),le/=100,ee/=100,[de(0),de(8),de(4),ne]})(H)}}})(s);return l?new _n(...l,!1):void 0}get rgb(){let{r:s,g:l,b:h,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[s/_,l/_,h/_,p])}get hcl(){return this.overwriteGetter("hcl",(function(s){let[l,h,p,_]=tw(s),y=Math.sqrt(h*h+p*p);return[Math.round(1e4*y)?ew(Math.atan2(p,h)*Jb):NaN,y,l,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",tw(this.rgb))}overwriteGetter(s,l){return Object.defineProperty(this,s,{value:l}),l}toString(){let[s,l,h,p]=this.rgb;return`rgba(${[s,l,h].map(_=>Math.round(255*_)).join(",")},${p})`}static interpolate(s,l,h,p="rgb"){switch(p){case"rgb":{let[_,y,x,C]=Zu(s.rgb,l.rgb,h);return new _n(_,y,x,C,!1)}case"hcl":{let[_,y,x,C]=s.hcl,[D,M,R,O]=l.hcl,F,j;if(isNaN(_)||isNaN(D))isNaN(_)?isNaN(D)?F=NaN:(F=D,x!==1&&x!==0||(j=M)):(F=_,R!==1&&R!==0||(j=y));else{let ee=D-_;D>_&&ee>180?ee-=360:D<_&&_-D>180&&(ee+=360),F=_+h*ee}let[z,H,Q,le]=(function([ee,ne,de,me]){return ee=isNaN(ee)?0:ee*Mh,O_([de,Math.cos(ee)*ne,Math.sin(ee)*ne,me])})([F,j??Bl(y,M,h),Bl(x,R,h),Bl(C,O,h)]);return new _n(z,H,Q,le,!1)}case"lab":{let[_,y,x,C]=O_(Zu(s.lab,l.lab,h));return new _n(_,y,x,C,!1)}}}}_n.black=new _n(0,0,0,1),_n.white=new _n(1,1,1,1),_n.transparent=new _n(0,0,0,0),_n.red=new _n(1,0,0,1);class V_{constructor(s,l,h){this.sensitivity=s?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,l){return this.collator.compare(s,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let pD=["bottom","center","top"];class j_{constructor(s,l,h,p,_,y){this.text=s,this.image=l,this.scale=h,this.fontStack=p,this.textColor=_,this.verticalAlign=y}}class Wo{constructor(s){this.sections=s}static fromString(s){return new Wo([new j_(s,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Wo?s:Wo.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class yo{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof yo)return s;if(typeof s=="number")return new yo([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(let l of s)if(typeof l!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new yo(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,h){return new yo(Zu(s.values,l.values,h))}}class Oi{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Oi)return s;if(typeof s=="number")return new Oi([s]);if(Array.isArray(s)){for(let l of s)if(typeof l!="number")return;return new Oi(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,h){return new Oi(Zu(s.values,l.values,h))}}class $t{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof $t)return s;if(typeof s=="string"){let h=_n.parse(s);return h?new $t([h]):void 0}if(!Array.isArray(s))return;let l=[];for(let h of s){if(typeof h!="string")return;let p=_n.parse(h);if(!p)return;l.push(p)}return new $t(l)}toString(){return JSON.stringify(this.values)}static interpolate(s,l,h,p="rgb"){let _=[];if(s.values.length!=l.values.length)throw new Error(`colorArray: Arrays have mismatched length (${s.values.length} vs. ${l.values.length}), cannot interpolate.`);for(let y=0;y<s.values.length;y++)_.push(_n.interpolate(s.values[y],l.values[y],h,p));return new $t(_)}}class ei extends Error{constructor(s){super(s),this.name="RuntimeError"}toJSON(){return this.message}}let Vl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ro{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof Ro)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let l=0;l<s.length;l+=2){let h=s[l],p=s[l+1];if(typeof h!="string"||!Vl.has(h)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new Ro(s)}}toString(){return JSON.stringify(this.values)}static interpolate(s,l,h){let p=s.values,_=l.values;if(p.length!==_.length)throw new ei(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${l.toString()}`);let y=[];for(let x=0;x<p.length;x+=2){if(p[x]!==_[x])throw new ei(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${_[x]}`);y.push(p[x]);let[C,D]=p[x+1],[M,R]=_[x+1];y.push([Bl(C,M,h),Bl(D,R,h)])}return new Ro(y)}}class ds{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new ds({name:s,available:!1}):null}}class Po{constructor(s,l,h){this.from=s,this.to=l,this.transition=h}static interpolate(s,l,h){return new Po(s,l,h)}static parse(s){return s instanceof Po?s:Array.isArray(s)&&s.length===3&&typeof s[0]=="string"&&typeof s[1]=="string"&&typeof s[2]=="number"?new Po(s[0],s[1],s[2]):typeof s=="object"&&typeof s.from=="string"&&typeof s.to=="string"&&typeof s.transition=="number"?new Po(s.from,s.to,s.transition):typeof s=="string"?new Po(s,s,1):void 0}}function Ku(c,s,l,h){return typeof c=="number"&&c>=0&&c<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,s,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,s,l,h]:[c,s,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function jl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Po||c instanceof _n||c instanceof V_||c instanceof Wo||c instanceof yo||c instanceof Oi||c instanceof $t||c instanceof Ro||c instanceof ds)return!0;if(Array.isArray(c)){for(let s of c)if(!jl(s))return!1;return!0}if(typeof c=="object"){for(let s in c)if(!jl(c[s]))return!1;return!0}return!1}function tr(c){if(c===null)return er;if(typeof c=="string")return nn;if(typeof c=="boolean")return gn;if(typeof c=="number")return ut;if(c instanceof _n)return us;if(c instanceof Po)return Fp;if(c instanceof V_)return Ch;if(c instanceof Wo)return Th;if(c instanceof yo)return Lp;if(c instanceof Oi)return Sh;if(c instanceof $t)return Hu;if(c instanceof Ro)return Dh;if(c instanceof ds)return Gu;if(Array.isArray(c)){let s=c.length,l;for(let h of c){let p=tr(h);if(l){if(l===p)continue;l=un;break}l=p}return ko(l||un,s)}return tl}function Oc(c){let s=typeof c;return c===null?"":s==="string"||s==="number"||s==="boolean"?String(c):c instanceof _n||c instanceof Po||c instanceof Wo||c instanceof yo||c instanceof Oi||c instanceof $t||c instanceof Ro||c instanceof ds?c.toString():JSON.stringify(c)}class Ea{constructor(s,l){this.type=s,this.value=l}static parse(s,l){if(s.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!jl(s[1]))return l.error("invalid value");let h=s[1],p=tr(h),_=l.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Ea(p,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Up={string:nn,number:ut,boolean:gn,object:tl};class Zo{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let h,p=1,_=s[0];if(_==="array"){let x,C;if(s.length>2){let D=s[1];if(typeof D!="string"||!(D in Up)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);x=Up[D],p++}else x=un;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=s[2],p++}h=ko(x,C)}else{if(!Up[_])throw new Error(`Types doesn't contain name = ${_}`);h=Up[_]}let y=[];for(;p<s.length;p++){let x=l.parse(s[p],p,un);if(!x)return null;y.push(x)}return new Zo(h,y)}evaluate(s){for(let l=0;l<this.args.length;l++){let h=this.args[l].evaluate(s);if(!qu(this.type,tr(h)))return h;if(l===this.args.length-1)throw new ei(`Expected value to be of type ${Wn(this.type)}, but found ${Wn(tr(h))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}let Fc={"to-boolean":gn,"to-color":us,"to-number":ut,"to-string":nn};class nl{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let h=s[0];if(!Fc[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&s.length!==2)return l.error("Expected one argument.");let p=Fc[h],_=[];for(let y=1;y<s.length;y++){let x=l.parse(s[y],y,un);if(!x)return null;_.push(x)}return new nl(p,_)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let l,h;for(let p of this.args){if(l=p.evaluate(s),h=null,l instanceof _n)return l;if(typeof l=="string"){let _=s.parseColor(l);if(_)return _}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Ku(l[0],l[1],l[2],l[3]),!h))return new _n(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ei(h||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(let h of this.args){l=h.evaluate(s);let p=yo.parse(l);if(p)return p}throw new ei(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"numberArray":{let l;for(let h of this.args){l=h.evaluate(s);let p=Oi.parse(l);if(p)return p}throw new ei(`Could not parse numberArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"colorArray":{let l;for(let h of this.args){l=h.evaluate(s);let p=$t.parse(l);if(p)return p}throw new ei(`Could not parse colorArray from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(let h of this.args){l=h.evaluate(s);let p=Ro.parse(l);if(p)return p}throw new ei(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(let h of this.args){if(l=h.evaluate(s),l===null)return 0;let p=Number(l);if(!isNaN(p))return p}throw new ei(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Wo.fromString(Oc(this.args[0].evaluate(s)));case"resolvedImage":return ds.fromString(Oc(this.args[0].evaluate(s)));case"projectionDefinition":return this.args[0].evaluate(s);default:return Oc(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}let iw=["Unknown","Point","LineString","Polygon"];class z_{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?iw[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let l=this._parseColorCache.get(s);return l||(l=_n.parse(s),this._parseColorCache.set(s,l)),l}}class Lc{constructor(s,l,h=[],p,_=new Rc,y=[]){this.registry=s,this.path=h,this.key=h.map(x=>`[${x}]`).join(""),this.scope=_,this.errors=y,this.expectedType=p,this._isConstant=l}parse(s,l,h,p,_={}){return l?this.concat(l,h,p)._parse(s,_):this._parse(s,_)}_parse(s,l){function h(p,_,y){return y==="assert"?new Zo(_,[p]):y==="coerce"?new nl(_,[p]):p}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=s[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let _=this.registry[p];if(_){let y=_.parse(s,this);if(!y)return null;if(this.expectedType){let x=this.expectedType,C=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||C.kind!=="value"){if(x.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(x.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(x.kind)&&["value","number","array"].includes(C.kind)||x.kind==="colorArray"&&["value","string","array"].includes(C.kind)||x.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))y=h(y,x,l.typeAnnotation||"coerce");else if(this.checkSubtype(x,C))return null}else y=h(y,x,l.typeAnnotation||"assert")}if(!(y instanceof Ea)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){let x=new z_;try{y=new Ea(y.type,y.evaluate(x))}catch(C){return this.error(C.message),null}}return y}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,l,h){let p=typeof s=="number"?this.path.concat(s):this.path,_=h?this.scope.concat(h):this.scope;return new Lc(this.registry,this._isConstant,p,l||null,_,this.errors)}error(s,...l){let h=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new qo(h,s))}checkSubtype(s,l){let h=qu(s,l);return h&&this.error(h),h}}class ti{constructor(s,l){this.type=l.type,this.bindings=[].concat(s),this.result=l}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(let l of this.bindings)s(l[1]);s(this.result)}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);let h=[];for(let _=1;_<s.length-1;_+=2){let y=s[_];if(typeof y!="string")return l.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return l.error("Variable names must contain only alphanumeric characters or '_'.",_);let x=l.parse(s[_+1],_+1);if(!x)return null;h.push([y,x])}let p=l.parse(s[s.length-1],s.length-1,l.expectedType,h);return p?new ti(h,p):null}outputDefined(){return this.result.outputDefined()}}class Yu{constructor(s,l){this.type=l.type,this.name=s,this.boundExpression=l}static parse(s,l){if(s.length!==2||typeof s[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");let h=s[1];return l.scope.has(h)?new Yu(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Mn{constructor(s,l,h){this.type=s,this.index=l,this.input=h}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);let h=l.parse(s[1],1,ut),p=l.parse(s[2],2,ko(l.expectedType||un));return h&&p?new Mn(p.type.itemType,h,p):null}evaluate(s){let l=this.index.evaluate(s),h=this.input.evaluate(s);if(l<0)throw new ei(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new ei(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new ei(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class dn{constructor(s,l){this.type=gn,this.needle=s,this.haystack=l}static parse(s,l){if(s.length!==3)return l.error(`Expected 2 arguments, but found ${s.length-1} instead.`);let h=l.parse(s[1],1,un),p=l.parse(s[2],2,un);return h&&p?Ih(h.type,[gn,nn,ut,er,un])?new dn(h,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(h.type)} instead`):null}evaluate(s){let l=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!h)return!1;if(!Pc(l,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(tr(l))} instead.`);if(!Pc(h,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Wn(tr(h))} instead.`);return h.indexOf(l)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Xu{constructor(s,l,h){this.type=ut,this.needle=s,this.haystack=l,this.fromIndex=h}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);let h=l.parse(s[1],1,un),p=l.parse(s[2],2,un);if(!h||!p)return null;if(!Ih(h.type,[gn,nn,ut,er,un]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(h.type)} instead`);if(s.length===4){let _=l.parse(s[3],3,ut);return _?new Xu(h,p,_):null}return new Xu(h,p)}evaluate(s){let l=this.needle.evaluate(s),h=this.haystack.evaluate(s);if(!Pc(l,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(tr(l))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(s)),Pc(h,["string"])){let _=h.indexOf(l,p);return _===-1?-1:[...h.slice(0,_)].length}if(Pc(h,["array"]))return h.indexOf(l,p);throw new ei(`Expected second argument to be of type array or string, but found ${Wn(tr(h))} instead.`)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class Rn{constructor(s,l,h,p,_,y){this.inputType=s,this.type=l,this.input=h,this.cases=p,this.outputs=_,this.otherwise=y}static parse(s,l){if(s.length<5)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return l.error("Expected an even number of arguments.");let h,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);let _={},y=[];for(let D=2;D<s.length-1;D+=2){let M=s[D],R=s[D+1];Array.isArray(M)||(M=[M]);let O=l.concat(D);if(M.length===0)return O.error("Expected at least one branch label.");for(let j of M){if(typeof j!="number"&&typeof j!="string")return O.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return O.error("Numeric branch labels must be integer values.");if(h){if(O.checkSubtype(h,tr(j)))return null}else h=tr(j);if(_[String(j)]!==void 0)return O.error("Branch labels must be unique.");_[String(j)]=y.length}let F=l.parse(R,D,p);if(!F)return null;p=p||F.type,y.push(F)}let x=l.parse(s[1],1,un);if(!x)return null;let C=l.parse(s[s.length-1],s.length-1,p);return C?x.type.kind!=="value"&&l.concat(1).checkSubtype(h,x.type)?null:new Rn(h,p,x,_,y,C):null}evaluate(s){let l=this.input.evaluate(s);return(tr(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Rh{constructor(s,l,h){this.type=s,this.branches=l,this.otherwise=h}static parse(s,l){if(s.length<4)return l.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&l.expectedType.kind!=="value"&&(h=l.expectedType);let p=[];for(let y=1;y<s.length-1;y+=2){let x=l.parse(s[y],y,gn);if(!x)return null;let C=l.parse(s[y+1],y+1,h);if(!C)return null;p.push([x,C]),h=h||C.type}let _=l.parse(s[s.length-1],s.length-1,h);if(!_)return null;if(!h)throw new Error("Can't infer output type");return new Rh(h,p,_)}evaluate(s){for(let[l,h]of this.branches)if(l.evaluate(s))return h.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(let[l,h]of this.branches)s(l),s(h);s(this.otherwise)}outputDefined(){return this.branches.every(([s,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class ks{constructor(s,l,h,p){this.type=s,this.input=l,this.beginIndex=h,this.endIndex=p}static parse(s,l){if(s.length<=2||s.length>=5)return l.error(`Expected 2 or 3 arguments, but found ${s.length-1} instead.`);let h=l.parse(s[1],1,un),p=l.parse(s[2],2,ut);if(!h||!p)return null;if(!Ih(h.type,[ko(un),nn,un]))return l.error(`Expected first argument to be of type array or string, but found ${Wn(h.type)} instead`);if(s.length===4){let _=l.parse(s[3],3,ut);return _?new ks(h.type,h,p,_):null}return new ks(h.type,h,p)}evaluate(s){let l=this.input.evaluate(s),h=this.beginIndex.evaluate(s),p;if(this.endIndex&&(p=this.endIndex.evaluate(s)),Pc(l,["string"]))return[...l].slice(h,p).join("");if(Pc(l,["array"]))return l.slice(h,p);throw new ei(`Expected first argument to be of type array or string, but found ${Wn(tr(l))} instead.`)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Qu(c,s){let l=c.length-1,h,p,_=0,y=l,x=0;for(;_<=y;)if(x=Math.floor((_+y)/2),h=c[x],p=c[x+1],h<=s){if(x===l||s<p)return x;_=x+1}else{if(!(h>s))throw new ei("Input is not a number.");y=x-1}return 0}class zl{constructor(s,l,h){this.type=s,this.input=l,this.labels=[],this.outputs=[];for(let[p,_]of h)this.labels.push(p),this.outputs.push(_)}static parse(s,l){if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");let h=l.parse(s[1],1,ut);if(!h)return null;let p=[],_=null;l.expectedType&&l.expectedType.kind!=="value"&&(_=l.expectedType);for(let y=1;y<s.length;y+=2){let x=y===1?-1/0:s[y],C=s[y+1],D=y,M=y+1;if(typeof x!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=x)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);let R=l.parse(C,M,_);if(!R)return null;_=_||R.type,p.push([x,R])}return new zl(_,h,p)}evaluate(s){let l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(s);let p=this.input.evaluate(s);if(p<=l[0])return h[0].evaluate(s);let _=l.length;return p>=l[_-1]?h[_-1].evaluate(s):h[Qu(l,p)].evaluate(s)}eachChild(s){s(this.input);for(let l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function rw(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Ph,U_,mD=(function(){if(U_)return Ph;function c(s,l,h,p){this.cx=3*s,this.bx=3*(h-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=h,this.p2y=p}return U_=1,Ph=c,c.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,l){if(l===void 0&&(l=1e-6),s<0)return 0;if(s>1)return 1;for(var h=s,p=0;p<8;p++){var _=this.sampleCurveX(h)-s;if(Math.abs(_)<l)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var x=0,C=1;for(h=s,p=0;p<20&&(_=this.sampleCurveX(h),!(Math.abs(_-s)<l));p++)s>_?x=h:C=h,h=.5*(C-x)+x;return h},solve:function(s,l){return this.sampleCurveY(this.solveCurveX(s,l))}},Ph})(),ow=rw(mD);class No{constructor(s,l,h,p,_){this.type=s,this.operator=l,this.interpolation=h,this.input=p,this.labels=[],this.outputs=[];for(let[y,x]of _)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(s,l,h,p){let _=0;if(s.name==="exponential")_=Ca(l,s.base,h,p);else if(s.name==="linear")_=Ca(l,1,h,p);else if(s.name==="cubic-bezier"){let y=s.controlPoints;_=new ow(y[0],y[1],y[2],y[3]).solve(Ca(l,1,h,p))}return _}static parse(s,l){let[h,p,_,...y]=s;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let D=p[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:D}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let D=p.slice(1);if(D.length!==4||D.some(M=>typeof M!="number"||M<0||M>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:D}}}if(s.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(_=l.parse(_,2,ut),!_)return null;let x=[],C=null;h!=="interpolate-hcl"&&h!=="interpolate-lab"||l.expectedType==Hu?l.expectedType&&l.expectedType.kind!=="value"&&(C=l.expectedType):C=us;for(let D=0;D<y.length;D+=2){let M=y[D],R=y[D+1],O=D+3,F=D+4;if(typeof M!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(x.length&&x[x.length-1][0]>=M)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);let j=l.parse(R,F,C);if(!j)return null;C=C||j.type,x.push([M,j])}return qs(C,ut)||qs(C,Fp)||qs(C,us)||qs(C,Lp)||qs(C,Sh)||qs(C,Hu)||qs(C,Dh)||qs(C,ko(ut))?new No(C,h,p,_,x):l.error(`Type ${Wn(C)} is not interpolatable.`)}evaluate(s){let l=this.labels,h=this.outputs;if(l.length===1)return h[0].evaluate(s);let p=this.input.evaluate(s);if(p<=l[0])return h[0].evaluate(s);let _=l.length;if(p>=l[_-1])return h[_-1].evaluate(s);let y=Qu(l,p),x=No.interpolationFactor(this.interpolation,p,l[y],l[y+1]),C=h[y].evaluate(s),D=h[y+1].evaluate(s);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Bl(C,D,x);case"color":return _n.interpolate(C,D,x);case"padding":return yo.interpolate(C,D,x);case"colorArray":return $t.interpolate(C,D,x);case"numberArray":return Oi.interpolate(C,D,x);case"variableAnchorOffsetCollection":return Ro.interpolate(C,D,x);case"array":return Zu(C,D,x);case"projectionDefinition":return Po.interpolate(C,D,x)}case"interpolate-hcl":switch(this.type.kind){case"color":return _n.interpolate(C,D,x,"hcl");case"colorArray":return $t.interpolate(C,D,x,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return _n.interpolate(C,D,x,"lab");case"colorArray":return $t.interpolate(C,D,x,"lab")}}}eachChild(s){s(this.input);for(let l of this.outputs)s(l)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Ca(c,s,l,h){let p=h-l,_=c-l;return p===0?0:s===1?_/p:(Math.pow(s,_)-1)/(Math.pow(s,p)-1)}let Si={color:_n.interpolate,number:Bl,padding:yo.interpolate,numberArray:Oi.interpolate,colorArray:$t.interpolate,variableAnchorOffsetCollection:Ro.interpolate,array:Zu};class Bc{constructor(s,l){this.type=s,this.args=l}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let h=null,p=l.expectedType;p&&p.kind!=="value"&&(h=p);let _=[];for(let x of s.slice(1)){let C=l.parse(x,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!C)return null;h=h||C.type,_.push(C)}if(!h)throw new Error("No output type");let y=p&&_.some(x=>qu(p,x.type));return new Bc(y?un:h,_)}evaluate(s){let l,h=null,p=0;for(let _ of this.args)if(p++,h=_.evaluate(s),h&&h instanceof ds&&!h.available&&(l||(l=h.name),h=null,p===this.args.length&&(h=l)),h!==null)break;return h}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}function $_(c,s){return c==="=="||c==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function Nh(c,s,l,h){return h.compare(s,l)===0}function Wi(c,s,l){let h=c!=="=="&&c!=="!=";return class E7{constructor(_,y,x){this.type=gn,this.lhs=_,this.rhs=y,this.collator=x,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");let x=_[0],C=y.parse(_[1],1,un);if(!C)return null;if(!$_(x,C.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Wn(C.type)}'.`);let D=y.parse(_[2],2,un);if(!D)return null;if(!$_(x,D.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Wn(D.type)}'.`);if(C.type.kind!==D.type.kind&&C.type.kind!=="value"&&D.type.kind!=="value")return y.error(`Cannot compare types '${Wn(C.type)}' and '${Wn(D.type)}'.`);h&&(C.type.kind==="value"&&D.type.kind!=="value"?C=new Zo(D.type,[C]):C.type.kind!=="value"&&D.type.kind==="value"&&(D=new Zo(C.type,[D])));let M=null;if(_.length===4){if(C.type.kind!=="string"&&D.type.kind!=="string"&&C.type.kind!=="value"&&D.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(_[3],3,Ch),!M)return null}return new E7(C,D,M)}evaluate(_){let y=this.lhs.evaluate(_),x=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){let C=tr(y),D=tr(x);if(C.kind!==D.kind||C.kind!=="string"&&C.kind!=="number")throw new ei(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${C.kind}, ${D.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){let C=tr(y),D=tr(x);if(C.kind!=="string"||D.kind!=="string")return s(_,y,x)}return this.collator?l(_,y,x,this.collator.evaluate(_)):s(_,y,x)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}let sw=Wi("==",function(c,s,l){return s===l},Nh),H_=Wi("!=",function(c,s,l){return s!==l},function(c,s,l,h){return!Nh(0,s,l,h)}),aw=Wi("<",function(c,s,l){return s<l},function(c,s,l,h){return h.compare(s,l)<0}),gD=Wi(">",function(c,s,l){return s>l},function(c,s,l,h){return h.compare(s,l)>0}),Ju=Wi("<=",function(c,s,l){return s<=l},function(c,s,l,h){return h.compare(s,l)<=0}),$p=Wi(">=",function(c,s,l){return s>=l},function(c,s,l,h){return h.compare(s,l)>=0});class ed{constructor(s,l,h){this.type=Ch,this.locale=h,this.caseSensitive=s,this.diacriticSensitive=l}static parse(s,l){if(s.length!==2)return l.error("Expected one argument.");let h=s[1];if(typeof h!="object"||Array.isArray(h))return l.error("Collator options argument must be an object.");let p=l.parse(h["case-sensitive"]!==void 0&&h["case-sensitive"],1,gn);if(!p)return null;let _=l.parse(h["diacritic-sensitive"]!==void 0&&h["diacritic-sensitive"],1,gn);if(!_)return null;let y=null;return h.locale&&(y=l.parse(h.locale,1,nn),!y)?null:new ed(p,_,y)}evaluate(s){return new V_(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}class G_{constructor(s,l,h,p,_){this.type=nn,this.number=s,this.locale=l,this.currency=h,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(s,l){if(s.length!==3)return l.error("Expected two arguments.");let h=l.parse(s[1],1,ut);if(!h)return null;let p=s[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=l.parse(p.locale,1,nn),!_))return null;let y=null;if(p.currency&&(y=l.parse(p.currency,1,nn),!y))return null;let x=null;if(p["min-fraction-digits"]&&(x=l.parse(p["min-fraction-digits"],1,ut),!x))return null;let C=null;return p["max-fraction-digits"]&&(C=l.parse(p["max-fraction-digits"],1,ut),!C)?null:new G_(h,_,y,x,C)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Oh{constructor(s){this.type=Th,this.sections=s}static parse(s,l){if(s.length<2)return l.error("Expected at least one argument.");let h=s[1];if(!Array.isArray(h)&&typeof h=="object")return l.error("First argument must be an image or text section.");let p=[],_=!1;for(let y=1;y<=s.length-1;++y){let x=s[y];if(_&&typeof x=="object"&&!Array.isArray(x)){_=!1;let C=null;if(x["font-scale"]&&(C=l.parse(x["font-scale"],1,ut),!C))return null;let D=null;if(x["text-font"]&&(D=l.parse(x["text-font"],1,ko(nn)),!D))return null;let M=null;if(x["text-color"]&&(M=l.parse(x["text-color"],1,us),!M))return null;let R=null;if(x["vertical-align"]){if(typeof x["vertical-align"]=="string"&&!pD.includes(x["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${x["vertical-align"]}' instead.`);if(R=l.parse(x["vertical-align"],1,nn),!R)return null}let O=p[p.length-1];O.scale=C,O.font=D,O.textColor=M,O.verticalAlign=R}else{let C=l.parse(s[y],1,un);if(!C)return null;let D=C.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Oh(p)}evaluate(s){return new Wo(this.sections.map(l=>{let h=l.content.evaluate(s);return tr(h)===Gu?new j_("",h,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(s):null):new j_(Oc(h),null,l.scale?l.scale.evaluate(s):null,l.font?l.font.evaluate(s).join(","):null,l.textColor?l.textColor.evaluate(s):null,l.verticalAlign?l.verticalAlign.evaluate(s):null)}))}eachChild(s){for(let l of this.sections)s(l.content),l.scale&&s(l.scale),l.font&&s(l.font),l.textColor&&s(l.textColor),l.verticalAlign&&s(l.verticalAlign)}outputDefined(){return!1}}class td{constructor(s){this.type=Gu,this.input=s}static parse(s,l){if(s.length!==2)return l.error("Expected two arguments.");let h=l.parse(s[1],1,nn);return h?new td(h):l.error("No image name provided.")}evaluate(s){let l=this.input.evaluate(s),h=ds.fromString(l);return h&&s.availableImages&&(h.available=s.availableImages.indexOf(l)>-1),h}eachChild(s){s(this.input)}outputDefined(){return!1}}class nd{constructor(s){this.type=ut,this.input=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);let h=l.parse(s[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Wn(h.type)} instead.`):new nd(h):null}evaluate(s){let l=this.input.evaluate(s);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new ei(`Expected value to be of type string or array, but found ${Wn(tr(l))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}let vr=8192;function lw(c,s){let l=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,s.z);return[Math.round(l*p*vr),Math.round(h*p*vr)]}function id(c,s){let l=Math.pow(2,s.z);return[(p=(c[0]/vr+s.x)/l,360*p-180),(h=(c[1]/vr+s.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,p}function Fh(c,s){c[0]=Math.min(c[0],s[0]),c[1]=Math.min(c[1],s[1]),c[2]=Math.max(c[2],s[0]),c[3]=Math.max(c[3],s[1])}function Vc(c,s){return!(c[0]<=s[0]||c[2]>=s[2]||c[1]<=s[1]||c[3]>=s[3])}function _D(c,s,l){let h=c[0]-s[0],p=c[1]-s[1],_=c[0]-l[0],y=c[1]-l[1];return h*y-_*p==0&&h*_<=0&&p*y<=0}function Hp(c,s,l,h){return(p=[h[0]-l[0],h[1]-l[1]])[0]*(_=[s[0]-c[0],s[1]-c[1]])[1]-p[1]*_[0]!=0&&!(!q_(c,s,l,h)||!q_(l,h,c,s));var p,_}function yD(c,s,l){for(let h of l)for(let p=0;p<h.length-1;++p)if(Hp(c,s,h[p],h[p+1]))return!0;return!1}function rd(c,s,l=!1){let h=!1;for(let x of s)for(let C=0;C<x.length-1;C++){if(_D(c,x[C],x[C+1]))return l;(_=x[C])[1]>(p=c)[1]!=(y=x[C+1])[1]>p[1]&&p[0]<(y[0]-_[0])*(p[1]-_[1])/(y[1]-_[1])+_[0]&&(h=!h)}var p,_,y;return h}function Gp(c,s){for(let l of s)if(rd(c,l))return!0;return!1}function cw(c,s){for(let l of c)if(!rd(l,s))return!1;for(let l=0;l<c.length-1;++l)if(yD(c[l],c[l+1],s))return!1;return!0}function uw(c,s){for(let l of s)if(cw(c,l))return!0;return!1}function q_(c,s,l,h){let p=h[0]-l[0],_=h[1]-l[1],y=(c[0]-l[0])*_-p*(c[1]-l[1]),x=(s[0]-l[0])*_-p*(s[1]-l[1]);return y>0&&x<0||y<0&&x>0}function W_(c,s,l){let h=[];for(let p=0;p<c.length;p++){let _=[];for(let y=0;y<c[p].length;y++){let x=lw(c[p][y],l);Fh(s,x),_.push(x)}h.push(_)}return h}function Z_(c,s,l){let h=[];for(let p=0;p<c.length;p++){let _=W_(c[p],s,l);h.push(_)}return h}function dw(c,s,l,h){if(c[0]<l[0]||c[0]>l[2]){let p=.5*h,_=c[0]-l[0]>p?-h:l[0]-c[0]>p?h:0;_===0&&(_=c[0]-l[2]>p?-h:l[2]-c[0]>p?h:0),c[0]+=_}Fh(s,c)}function hw(c,s,l,h){let p=Math.pow(2,h.z)*vr,_=[h.x*vr,h.y*vr],y=[];for(let x of c)for(let C of x){let D=[C.x+_[0],C.y+_[1]];dw(D,s,l,p),y.push(D)}return y}function fw(c,s,l,h){let p=Math.pow(2,h.z)*vr,_=[h.x*vr,h.y*vr],y=[];for(let C of c){let D=[];for(let M of C){let R=[M.x+_[0],M.y+_[1]];Fh(s,R),D.push(R)}y.push(D)}if(s[2]-s[0]<=p/2){(x=s)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(let C of y)for(let D of C)dw(D,s,l,p)}var x;return y}class jc{constructor(s,l){this.type=gn,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(jl(s[1])){let h=s[1];if(h.type==="FeatureCollection"){let p=[];for(let _ of h.features){let{type:y,coordinates:x}=_.geometry;y==="Polygon"&&p.push(x),y==="MultiPolygon"&&p.push(...x)}if(p.length)return new jc(h,{type:"MultiPolygon",coordinates:p})}else if(h.type==="Feature"){let p=h.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new jc(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new jc(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,h){let p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(h.type==="Polygon"){let x=W_(h.coordinates,_,y),C=hw(l.geometry(),p,_,y);if(!Vc(p,_))return!1;for(let D of C)if(!rd(D,x))return!1}if(h.type==="MultiPolygon"){let x=Z_(h.coordinates,_,y),C=hw(l.geometry(),p,_,y);if(!Vc(p,_))return!1;for(let D of C)if(!Gp(D,x))return!1}return!0})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,h){let p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=l.canonicalID();if(h.type==="Polygon"){let x=W_(h.coordinates,_,y),C=fw(l.geometry(),p,_,y);if(!Vc(p,_))return!1;for(let D of C)if(!cw(D,x))return!1}if(h.type==="MultiPolygon"){let x=Z_(h.coordinates,_,y),C=fw(l.geometry(),p,_,y);if(!Vc(p,_))return!1;for(let D of C)if(!uw(D,x))return!1}return!0})(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pw=class{constructor(c=[],s=(l,h)=>l<h?-1:l>h?1:0){if(this.data=c,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;let c=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),c}peek(){return this.data[0]}_up(c){let{data:s,compare:l}=this,h=s[c];for(;c>0;){let p=c-1>>1,_=s[p];if(l(h,_)>=0)break;s[c]=_,c=p}s[c]=h}_down(c){let{data:s,compare:l}=this,h=this.length>>1,p=s[c];for(;c<h;){let _=1+(c<<1),y=_+1;if(y<this.length&&l(s[y],s[_])<0&&(_=y),l(s[_],p)>=0)break;s[c]=s[_],c=_}s[c]=p}};function K_(c,s,l=0,h=c.length-1,p=mw){for(;h>l;){if(h-l>600){let C=h-l+1,D=s-l+1,M=Math.log(C),R=.5*Math.exp(2*M/3),O=.5*Math.sqrt(M*R*(C-R)/C)*(D-C/2<0?-1:1);K_(c,s,Math.max(l,Math.floor(s-D*R/C+O)),Math.min(h,Math.floor(s+(C-D)*R/C+O)),p)}let _=c[s],y=l,x=h;for(od(c,l,s),p(c[h],_)>0&&od(c,l,h);y<x;){for(od(c,y,x),y++,x--;p(c[y],_)<0;)y++;for(;p(c[x],_)>0;)x--}p(c[l],_)===0?od(c,l,x):(x++,od(c,x,h)),x<=s&&(l=x+1),s<=x&&(h=x-1)}}function od(c,s,l){let h=c[s];c[s]=c[l],c[l]=h}function mw(c,s){return c<s?-1:c>s?1:0}function qp(c,s){if(c.length<=1)return[c];let l=[],h,p;for(let _ of c){let y=bD(_);y!==0&&(_.area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(h&&l.push(h),h=[_]):h.push(_))}if(h&&l.push(h),s>1)for(let _=0;_<l.length;_++)l[_].length<=s||(K_(l[_],s,1,l[_].length-1,vD),l[_]=l[_].slice(0,s));return l}function vD(c,s){return s.area-c.area}function bD(c){let s=0;for(let l,h,p=0,_=c.length,y=_-1;p<_;y=p++)l=c[p],h=c[y],s+=(h.x-l.x)*(l.y+h.y);return s}let gw=1/298.257223563,Lh=gw*(2-gw),_w=Math.PI/180;class Y_{constructor(s){let l=6378.137*_w*1e3,h=Math.cos(s*_w),p=1/(1-Lh*(1-h*h)),_=Math.sqrt(p);this.kx=l*_*h,this.ky=l*_*p*(1-Lh)}distance(s,l){let h=this.wrap(s[0]-l[0])*this.kx,p=(s[1]-l[1])*this.ky;return Math.sqrt(h*h+p*p)}pointOnLine(s,l){let h,p,_,y,x=1/0;for(let C=0;C<s.length-1;C++){let D=s[C][0],M=s[C][1],R=this.wrap(s[C+1][0]-D)*this.kx,O=(s[C+1][1]-M)*this.ky,F=0;R===0&&O===0||(F=(this.wrap(l[0]-D)*this.kx*R+(l[1]-M)*this.ky*O)/(R*R+O*O),F>1?(D=s[C+1][0],M=s[C+1][1]):F>0&&(D+=R/this.kx*F,M+=O/this.ky*F)),R=this.wrap(l[0]-D)*this.kx,O=(l[1]-M)*this.ky;let j=R*R+O*O;j<x&&(x=j,h=D,p=M,_=C,y=F)}return{point:[h,p],index:_,t:Math.max(0,Math.min(1,y))}}wrap(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}}function yw(c,s){return s[0]-c[0]}function Wp(c){return c[1]-c[0]+1}function Ws(c,s){return c[1]>=c[0]&&c[1]<s}function Zp(c,s){if(c[0]>c[1])return[null,null];let l=Wp(c);if(s){if(l===2)return[c,null];let p=Math.floor(l/2);return[[c[0],c[0]+p],[c[0]+p,c[1]]]}if(l===1)return[c,null];let h=Math.floor(l/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}function X_(c,s){if(!Ws(s,c.length))return[1/0,1/0,-1/0,-1/0];let l=[1/0,1/0,-1/0,-1/0];for(let h=s[0];h<=s[1];++h)Fh(l,c[h]);return l}function Q_(c){let s=[1/0,1/0,-1/0,-1/0];for(let l of c)for(let h of l)Fh(s,h);return s}function J_(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function Kp(c,s,l){if(!J_(c)||!J_(s))return NaN;let h=0,p=0;return c[2]<s[0]&&(h=s[0]-c[2]),c[0]>s[2]&&(h=c[0]-s[2]),c[1]>s[3]&&(p=c[1]-s[3]),c[3]<s[1]&&(p=s[1]-c[3]),l.distance([0,0],[h,p])}function zc(c,s,l){let h=l.pointOnLine(s,c);return l.distance(c,h.point)}function ey(c,s,l,h,p){let _=Math.min(zc(c,[l,h],p),zc(s,[l,h],p)),y=Math.min(zc(l,[c,s],p),zc(h,[c,s],p));return Math.min(_,y)}function wD(c,s,l,h,p){if(!Ws(s,c.length)||!Ws(h,l.length))return 1/0;let _=1/0;for(let y=s[0];y<s[1];++y){let x=c[y],C=c[y+1];for(let D=h[0];D<h[1];++D){let M=l[D],R=l[D+1];if(Hp(x,C,M,R))return 0;_=Math.min(_,ey(x,C,M,R,p))}}return _}function vw(c,s,l,h,p){if(!Ws(s,c.length)||!Ws(h,l.length))return NaN;let _=1/0;for(let y=s[0];y<=s[1];++y)for(let x=h[0];x<=h[1];++x)if(_=Math.min(_,p.distance(c[y],l[x])),_===0)return _;return _}function xD(c,s,l){if(rd(c,s,!0))return 0;let h=1/0;for(let p of s){let _=p[0],y=p[p.length-1];if(_!==y&&(h=Math.min(h,zc(c,[y,_],l)),h===0))return h;let x=l.pointOnLine(p,c);if(h=Math.min(h,l.distance(c,x.point)),h===0)return h}return h}function ED(c,s,l,h){if(!Ws(s,c.length))return NaN;for(let _=s[0];_<=s[1];++_)if(rd(c[_],l,!0))return 0;let p=1/0;for(let _=s[0];_<s[1];++_){let y=c[_],x=c[_+1];for(let C of l)for(let D=0,M=C.length,R=M-1;D<M;R=D++){let O=C[R],F=C[D];if(Hp(y,x,O,F))return 0;p=Math.min(p,ey(y,x,O,F,h))}}return p}function bw(c,s){for(let l of c)for(let h of l)if(rd(h,s,!0))return!0;return!1}function CD(c,s,l,h=1/0){let p=Q_(c),_=Q_(s);if(h!==1/0&&Kp(p,_,l)>=h)return h;if(Vc(p,_)){if(bw(c,s))return 0}else if(bw(s,c))return 0;let y=1/0;for(let x of c)for(let C=0,D=x.length,M=D-1;C<D;M=C++){let R=x[M],O=x[C];for(let F of s)for(let j=0,z=F.length,H=z-1;j<z;H=j++){let Q=F[H],le=F[j];if(Hp(R,O,Q,le))return 0;y=Math.min(y,ey(R,O,Q,le,l))}}return y}function Vn(c,s,l,h,p,_){if(!_)return;let y=Kp(X_(h,_),p,l);y<s&&c.push([y,_,[0,0]])}function Yp(c,s,l,h,p,_,y){if(!_||!y)return;let x=Kp(X_(h,_),X_(p,y),l);x<s&&c.push([x,_,y])}function Xp(c,s,l,h,p=1/0){let _=Math.min(h.distance(c[0],l[0][0]),p);if(_===0)return _;let y=new pw([[0,[0,c.length-1],[0,0]]],yw),x=Q_(l);for(;y.length>0;){let C=y.pop();if(C[0]>=_)continue;let D=C[1],M=s?50:100;if(Wp(D)<=M){if(!Ws(D,c.length))return NaN;if(s){let R=ED(c,D,l,h);if(isNaN(R)||R===0)return R;_=Math.min(_,R)}else for(let R=D[0];R<=D[1];++R){let O=xD(c[R],l,h);if(_=Math.min(_,O),_===0)return 0}}else{let R=Zp(D,s);Vn(y,_,h,c,x,R[0]),Vn(y,_,h,c,x,R[1])}}return _}function Qp(c,s,l,h,p,_=1/0){let y=Math.min(_,p.distance(c[0],l[0]));if(y===0)return y;let x=new pw([[0,[0,c.length-1],[0,l.length-1]]],yw);for(;x.length>0;){let C=x.pop();if(C[0]>=y)continue;let D=C[1],M=C[2],R=s?50:100,O=h?50:100;if(Wp(D)<=R&&Wp(M)<=O){if(!Ws(D,c.length)&&Ws(M,l.length))return NaN;let F;if(s&&h)F=wD(c,D,l,M,p),y=Math.min(y,F);else if(s&&!h){let j=c.slice(D[0],D[1]+1);for(let z=M[0];z<=M[1];++z)if(F=zc(l[z],j,p),y=Math.min(y,F),y===0)return y}else if(!s&&h){let j=l.slice(M[0],M[1]+1);for(let z=D[0];z<=D[1];++z)if(F=zc(c[z],j,p),y=Math.min(y,F),y===0)return y}else F=vw(c,D,l,M,p),y=Math.min(y,F)}else{let F=Zp(D,s),j=Zp(M,h);Yp(x,y,p,c,l,F[0],j[0]),Yp(x,y,p,c,l,F[0],j[1]),Yp(x,y,p,c,l,F[1],j[0]),Yp(x,y,p,c,l,F[1],j[1])}}return y}function ty(c){return c.type==="MultiPolygon"?c.coordinates.map(s=>({type:"Polygon",coordinates:s})):c.type==="MultiLineString"?c.coordinates.map(s=>({type:"LineString",coordinates:s})):c.type==="MultiPoint"?c.coordinates.map(s=>({type:"Point",coordinates:s})):[c]}class Uc{constructor(s,l){this.type=ut,this.geojson=s,this.geometries=l}static parse(s,l){if(s.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${s.length-1} instead.`);if(jl(s[1])){let h=s[1];if(h.type==="FeatureCollection")return new Uc(h,h.features.map(p=>ty(p.geometry)).flat());if(h.type==="Feature")return new Uc(h,ty(h.geometry));if("type"in h&&"coordinates"in h)return new Uc(h,ty(h))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return(function(l,h){let p=l.geometry(),_=p.flat().map(C=>id([C.x,C.y],l.canonical));if(p.length===0)return NaN;let y=new Y_(_[0][1]),x=1/0;for(let C of h){switch(C.type){case"Point":x=Math.min(x,Qp(_,!1,[C.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,Qp(_,!1,C.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,Xp(_,!1,C.coordinates,y,x))}if(x===0)return x}return x})(s,this.geometries);if(s.geometryType()==="LineString")return(function(l,h){let p=l.geometry(),_=p.flat().map(C=>id([C.x,C.y],l.canonical));if(p.length===0)return NaN;let y=new Y_(_[0][1]),x=1/0;for(let C of h){switch(C.type){case"Point":x=Math.min(x,Qp(_,!0,[C.coordinates],!1,y,x));break;case"LineString":x=Math.min(x,Qp(_,!0,C.coordinates,!0,y,x));break;case"Polygon":x=Math.min(x,Xp(_,!0,C.coordinates,y,x))}if(x===0)return x}return x})(s,this.geometries);if(s.geometryType()==="Polygon")return(function(l,h){let p=l.geometry();if(p.length===0||p[0].length===0)return NaN;let _=qp(p,0).map(C=>C.map(D=>D.map(M=>id([M.x,M.y],l.canonical)))),y=new Y_(_[0][0][0][1]),x=1/0;for(let C of h)for(let D of _){switch(C.type){case"Point":x=Math.min(x,Xp([C.coordinates],!1,D,y,x));break;case"LineString":x=Math.min(x,Xp(C.coordinates,!0,D,y,x));break;case"Polygon":x=Math.min(x,CD(D,C.coordinates,y,x))}if(x===0)return x}return x})(s,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Bh{constructor(s){this.type=un,this.key=s}static parse(s,l){if(s.length!==2)return l.error(`Expected 1 argument, but found ${s.length-1} instead.`);let h=s[1];return h==null?l.error("Global state property must be defined."):typeof h!="string"?l.error(`Global state property must be string, but found ${typeof s[1]} instead.`):new Bh(h)}evaluate(s){var l;let h=(l=s.globals)===null||l===void 0?void 0:l.globalState;return h&&Object.keys(h).length!==0?Ah(h,this.key):null}eachChild(){}outputDefined(){return!1}}let sd={"==":sw,"!=":H_,">":gD,"<":aw,">=":$p,"<=":Ju,array:Zo,at:Mn,boolean:Zo,case:Rh,coalesce:Bc,collator:ed,format:Oh,image:td,in:dn,"index-of":Xu,interpolate:No,"interpolate-hcl":No,"interpolate-lab":No,length:nd,let:ti,literal:Ea,match:Rn,number:Zo,"number-format":G_,object:Zo,slice:ks,step:zl,string:Zo,"to-boolean":nl,"to-color":nl,"to-number":nl,"to-string":nl,var:Yu,within:jc,distance:Uc,"global-state":Bh};class Rs{constructor(s,l,h,p){this.name=s,this.type=l,this._evaluate=h,this.args=p}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,l){let h=s[0],p=Rs.definitions[h];if(!p)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);let _=Array.isArray(p)?p[0]:p.type,y=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=y.filter(([D])=>!Array.isArray(D)||D.length===s.length-1),C=null;for(let[D,M]of x){C=new Lc(l.registry,Jp,l.path,null,l.scope);let R=[],O=!1;for(let F=1;F<s.length;F++){let j=s[F],z=Array.isArray(D)?D[F-1]:D.type,H=C.parse(j,1+R.length,z);if(!H){O=!0;break}R.push(H)}if(!O)if(Array.isArray(D)&&D.length!==R.length)C.error(`Expected ${D.length} arguments, but found ${R.length} instead.`);else{for(let F=0;F<R.length;F++){let j=Array.isArray(D)?D[F]:D.type,z=R[F];C.concat(F+1).checkSubtype(j,z.type)}if(C.errors.length===0)return new Rs(h,_,M,R)}}if(x.length===1)l.errors.push(...C.errors);else{let D=(x.length?x:y).map(([R])=>{return O=R,Array.isArray(O)?`(${O.map(Wn).join(", ")})`:`(${Wn(O.type)}...)`;var O}).join(" | "),M=[];for(let R=1;R<s.length;R++){let O=l.parse(s[R],1+M.length);if(!O)return null;M.push(Wn(O.type))}l.error(`Expected arguments of type ${D}, but found (${M.join(", ")}) instead.`)}return null}static register(s,l){Rs.definitions=l;for(let h in l)s[h]=Rs}}function ww(c,[s,l,h,p]){s=s.evaluate(c),l=l.evaluate(c),h=h.evaluate(c);let _=p?p.evaluate(c):1,y=Ku(s,l,h,_);if(y)throw new ei(y);return new _n(s/255,l/255,h/255,_,!1)}function xw(c,s){return c in s}function ny(c,s){let l=s[c];return l===void 0?null:l}function $c(c){return{type:c}}function Jp(c){if(c instanceof Yu)return Jp(c.boundExpression);if(c instanceof Rs&&c.name==="error"||c instanceof ed||c instanceof jc||c instanceof Uc||c instanceof Bh)return!1;let s=c instanceof nl||c instanceof Zo,l=!0;return c.eachChild(h=>{l=s?l&&Jp(h):l&&h instanceof Ea}),!!l&&em(c)&&tm(c,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function em(c){if(c instanceof Rs&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof jc||c instanceof Uc)return!1;let s=!0;return c.eachChild(l=>{s&&!em(l)&&(s=!1)}),s}function Vh(c){if(c instanceof Rs&&c.name==="feature-state")return!1;let s=!0;return c.eachChild(l=>{s&&!Vh(l)&&(s=!1)}),s}function tm(c,s){if(c instanceof Rs&&s.indexOf(c.name)>=0)return!1;let l=!0;return c.eachChild(h=>{l&&!tm(h,s)&&(l=!1)}),l}function Ew(c){return{result:"success",value:c}}function ad(c){return{result:"error",value:c}}function ld(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Cw(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function iy(c){return!!c.expression&&c.expression.interpolated}function yn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function nm(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)&&tr(c)===tl}function TD(c){return c}function Tw(c,s){let l=c.stops&&typeof c.stops[0][0]=="object",h=l||!(l||c.property!==void 0),p=c.type||(iy(s)?"exponential":"interval"),_=(function(M){switch(M.type){case"color":return _n.parse;case"padding":return yo.parse;case"numberArray":return Oi.parse;case"colorArray":return $t.parse;default:return null}})(s);if(_&&((c=dr({},c)).stops&&(c.stops=c.stops.map(M=>[M[0],_(M[1])])),c.default=_(c.default?c.default:s.default)),c.colorSpace&&(y=c.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var y;let x=(function(M){switch(M){case"exponential":return Sw;case"interval":return DD;case"categorical":return SD;case"identity":return ID;default:throw new Error(`Unknown function type "${M}"`)}})(p),C,D;if(p==="categorical"){C=Object.create(null);for(let M of c.stops)C[M[0]]=M[1];D=typeof c.stops[0][0]}if(l){let M={},R=[];for(let j=0;j<c.stops.length;j++){let z=c.stops[j],H=z[0].zoom;M[H]===void 0&&(M[H]={zoom:H,type:c.type,property:c.property,default:c.default,stops:[]},R.push(H)),M[H].stops.push([z[0].value,z[1]])}let O=[];for(let j of R)O.push([M[j].zoom,Tw(M[j],s)]);let F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:No.interpolationFactor.bind(void 0,F),zoomStops:O.map(j=>j[0]),evaluate:({zoom:j},z)=>Sw({stops:O,base:c.base},s,j).evaluate(j,z)}}if(h){let M=p==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:No.interpolationFactor.bind(void 0,M),zoomStops:c.stops.map(R=>R[0]),evaluate:({zoom:R})=>x(c,s,R,C,D)}}return{kind:"source",evaluate(M,R){let O=R&&R.properties?R.properties[c.property]:void 0;return O===void 0?jh(c.default,s.default):x(c,s,O,C,D)}}}function jh(c,s,l){return c!==void 0?c:s!==void 0?s:l!==void 0?l:void 0}function SD(c,s,l,h,p){return jh(typeof l===p?h[l]:void 0,c.default,s.default)}function DD(c,s,l){if(yn(l)!=="number")return jh(c.default,s.default);let h=c.stops.length;if(h===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[h-1][0])return c.stops[h-1][1];let p=Qu(c.stops.map(_=>_[0]),l);return c.stops[p][1]}function Sw(c,s,l){let h=c.base!==void 0?c.base:1;if(yn(l)!=="number")return jh(c.default,s.default);let p=c.stops.length;if(p===1||l<=c.stops[0][0])return c.stops[0][1];if(l>=c.stops[p-1][0])return c.stops[p-1][1];let _=Qu(c.stops.map(M=>M[0]),l),y=(function(M,R,O,F){let j=F-O,z=M-O;return j===0?0:R===1?z/j:(Math.pow(R,z)-1)/(Math.pow(R,j)-1)})(l,h,c.stops[_][0],c.stops[_+1][0]),x=c.stops[_][1],C=c.stops[_+1][1],D=Si[s.type]||TD;return typeof x.evaluate=="function"?{evaluate(...M){let R=x.evaluate.apply(void 0,M),O=C.evaluate.apply(void 0,M);if(R!==void 0&&O!==void 0)return D(R,O,y,c.colorSpace)}}:D(x,C,y,c.colorSpace)}function ID(c,s,l){switch(s.type){case"color":l=_n.parse(l);break;case"formatted":l=Wo.fromString(l.toString());break;case"resolvedImage":l=ds.fromString(l.toString());break;case"padding":l=yo.parse(l);break;case"colorArray":l=$t.parse(l);break;case"numberArray":l=Oi.parse(l);break;default:yn(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0)}return jh(l,c.default,s.default)}Rs.register(sd,{error:[{kind:"error"},[nn],(c,[s])=>{throw new ei(s.evaluate(c))}],typeof:[nn,[un],(c,[s])=>Wn(tr(s.evaluate(c)))],"to-rgba":[ko(ut,4),[us],(c,[s])=>{let[l,h,p,_]=s.evaluate(c).rgb;return[255*l,255*h,255*p,_]}],rgb:[us,[ut,ut,ut],ww],rgba:[us,[ut,ut,ut,ut],ww],has:{type:gn,overloads:[[[nn],(c,[s])=>xw(s.evaluate(c),c.properties())],[[nn,tl],(c,[s,l])=>xw(s.evaluate(c),l.evaluate(c))]]},get:{type:un,overloads:[[[nn],(c,[s])=>ny(s.evaluate(c),c.properties())],[[nn,tl],(c,[s,l])=>ny(s.evaluate(c),l.evaluate(c))]]},"feature-state":[un,[nn],(c,[s])=>ny(s.evaluate(c),c.featureState||{})],properties:[tl,[],c=>c.properties()],"geometry-type":[nn,[],c=>c.geometryType()],id:[un,[],c=>c.id()],zoom:[ut,[],c=>c.globals.zoom],"heatmap-density":[ut,[],c=>c.globals.heatmapDensity||0],elevation:[ut,[],c=>c.globals.elevation||0],"line-progress":[ut,[],c=>c.globals.lineProgress||0],accumulated:[un,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[ut,$c(ut),(c,s)=>{let l=0;for(let h of s)l+=h.evaluate(c);return l}],"*":[ut,$c(ut),(c,s)=>{let l=1;for(let h of s)l*=h.evaluate(c);return l}],"-":{type:ut,overloads:[[[ut,ut],(c,[s,l])=>s.evaluate(c)-l.evaluate(c)],[[ut],(c,[s])=>-s.evaluate(c)]]},"/":[ut,[ut,ut],(c,[s,l])=>s.evaluate(c)/l.evaluate(c)],"%":[ut,[ut,ut],(c,[s,l])=>s.evaluate(c)%l.evaluate(c)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(c,[s,l])=>Math.pow(s.evaluate(c),l.evaluate(c))],sqrt:[ut,[ut],(c,[s])=>Math.sqrt(s.evaluate(c))],log10:[ut,[ut],(c,[s])=>Math.log(s.evaluate(c))/Math.LN10],ln:[ut,[ut],(c,[s])=>Math.log(s.evaluate(c))],log2:[ut,[ut],(c,[s])=>Math.log(s.evaluate(c))/Math.LN2],sin:[ut,[ut],(c,[s])=>Math.sin(s.evaluate(c))],cos:[ut,[ut],(c,[s])=>Math.cos(s.evaluate(c))],tan:[ut,[ut],(c,[s])=>Math.tan(s.evaluate(c))],asin:[ut,[ut],(c,[s])=>Math.asin(s.evaluate(c))],acos:[ut,[ut],(c,[s])=>Math.acos(s.evaluate(c))],atan:[ut,[ut],(c,[s])=>Math.atan(s.evaluate(c))],min:[ut,$c(ut),(c,s)=>Math.min(...s.map(l=>l.evaluate(c)))],max:[ut,$c(ut),(c,s)=>Math.max(...s.map(l=>l.evaluate(c)))],abs:[ut,[ut],(c,[s])=>Math.abs(s.evaluate(c))],round:[ut,[ut],(c,[s])=>{let l=s.evaluate(c);return l<0?-Math.round(-l):Math.round(l)}],floor:[ut,[ut],(c,[s])=>Math.floor(s.evaluate(c))],ceil:[ut,[ut],(c,[s])=>Math.ceil(s.evaluate(c))],"filter-==":[gn,[nn,un],(c,[s,l])=>c.properties()[s.value]===l.value],"filter-id-==":[gn,[un],(c,[s])=>c.id()===s.value],"filter-type-==":[gn,[nn],(c,[s])=>c.geometryType()===s.value],"filter-<":[gn,[nn,un],(c,[s,l])=>{let h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h<p}],"filter-id-<":[gn,[un],(c,[s])=>{let l=c.id(),h=s.value;return typeof l==typeof h&&l<h}],"filter->":[gn,[nn,un],(c,[s,l])=>{let h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h>p}],"filter-id->":[gn,[un],(c,[s])=>{let l=c.id(),h=s.value;return typeof l==typeof h&&l>h}],"filter-<=":[gn,[nn,un],(c,[s,l])=>{let h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h<=p}],"filter-id-<=":[gn,[un],(c,[s])=>{let l=c.id(),h=s.value;return typeof l==typeof h&&l<=h}],"filter->=":[gn,[nn,un],(c,[s,l])=>{let h=c.properties()[s.value],p=l.value;return typeof h==typeof p&&h>=p}],"filter-id->=":[gn,[un],(c,[s])=>{let l=c.id(),h=s.value;return typeof l==typeof h&&l>=h}],"filter-has":[gn,[un],(c,[s])=>s.value in c.properties()],"filter-has-id":[gn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[gn,[ko(nn)],(c,[s])=>s.value.indexOf(c.geometryType())>=0],"filter-id-in":[gn,[ko(un)],(c,[s])=>s.value.indexOf(c.id())>=0],"filter-in-small":[gn,[nn,ko(un)],(c,[s,l])=>l.value.indexOf(c.properties()[s.value])>=0],"filter-in-large":[gn,[nn,ko(un)],(c,[s,l])=>(function(h,p,_,y){for(;_<=y;){let x=_+y>>1;if(p[x]===h)return!0;p[x]>h?y=x-1:_=x+1}return!1})(c.properties()[s.value],l.value,0,l.value.length-1)],all:{type:gn,overloads:[[[gn,gn],(c,[s,l])=>s.evaluate(c)&&l.evaluate(c)],[$c(gn),(c,s)=>{for(let l of s)if(!l.evaluate(c))return!1;return!0}]]},any:{type:gn,overloads:[[[gn,gn],(c,[s,l])=>s.evaluate(c)||l.evaluate(c)],[$c(gn),(c,s)=>{for(let l of s)if(l.evaluate(c))return!0;return!1}]]},"!":[gn,[gn],(c,[s])=>!s.evaluate(c)],"is-supported-script":[gn,[nn],(c,[s])=>{let l=c.globals&&c.globals.isSupportedScript;return!l||l(s.evaluate(c))}],upcase:[nn,[nn],(c,[s])=>s.evaluate(c).toUpperCase()],downcase:[nn,[nn],(c,[s])=>s.evaluate(c).toLowerCase()],concat:[nn,$c(un),(c,s)=>s.map(l=>Oc(l.evaluate(c))).join("")],"resolved-locale":[nn,[Ch],(c,[s])=>s.evaluate(c).resolvedLocale()]});class ry{constructor(s,l,h){this.expression=s,this._warningHistory={},this._evaluator=new z_,this._defaultValue=l?(function(p){if(p.type==="color"&&nm(p.default))return new _n(0,0,0,0);switch(p.type){case"color":return _n.parse(p.default)||null;case"padding":return yo.parse(p.default)||null;case"numberArray":return Oi.parse(p.default)||null;case"colorArray":return $t.parse(p.default)||null;case"variableAnchorOffsetCollection":return Ro.parse(p.default)||null;case"projectionDefinition":return Po.parse(p.default)||null;default:return p.default===void 0?null:p.default}})(l):null,this._enumValues=l&&l.type==="enum"?l.values:null,this._globalState=h}evaluateWithoutErrorHandling(s,l,h,p,_,y){return this._globalState&&(s=Hc(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(s,l,h,p,_,y){this._globalState&&(s=Hc(s,this._globalState)),this._evaluator.globals=s,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function cd(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in sd}function zh(c,s,l){let h=new Lc(sd,Jp,[],s?(function(_){let y={color:us,string:nn,number:ut,enum:nn,boolean:gn,formatted:Th,padding:Lp,numberArray:Sh,colorArray:Hu,projectionDefinition:Fp,resolvedImage:Gu,variableAnchorOffsetCollection:Dh};return _.type==="array"?ko(y[_.value]||un,_.length):y[_.type]})(s):void 0),p=h.parse(c,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Ew(new ry(p,s,l)):ad(h.errors)}class im{constructor(s,l,h){this.kind=s,this._styleExpression=l,this.isStateDependent=s!=="constant"&&!Vh(l.expression),this.globalStateRefs=Ul(l.expression),this._globalState=h}evaluateWithoutErrorHandling(s,l,h,p,_,y){return this._globalState&&(s=Hc(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,h,p,_,y)}evaluate(s,l,h,p,_,y){return this._globalState&&(s=Hc(s,this._globalState)),this._styleExpression.evaluate(s,l,h,p,_,y)}}class oy{constructor(s,l,h,p,_){this.kind=s,this.zoomStops=h,this._styleExpression=l,this.isStateDependent=s!=="camera"&&!Vh(l.expression),this.globalStateRefs=Ul(l.expression),this.interpolationType=p,this._globalState=_}evaluateWithoutErrorHandling(s,l,h,p,_,y){return this._globalState&&(s=Hc(s,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(s,l,h,p,_,y)}evaluate(s,l,h,p,_,y){return this._globalState&&(s=Hc(s,this._globalState)),this._styleExpression.evaluate(s,l,h,p,_,y)}interpolationFactor(s,l,h){return this.interpolationType?No.interpolationFactor(this.interpolationType,s,l,h):0}}function sy(c,s,l){let h=zh(c,s,l);if(h.result==="error")return h;let p=h.value.expression,_=em(p);if(!_&&!ld(s))return ad([new qo("","data expressions not supported")]);let y=tm(p,["zoom"]);if(!y&&!Cw(s))return ad([new qo("","zoom expressions not supported")]);let x=om(p);return x||y?x instanceof qo?ad([x]):x instanceof No&&!iy(s)?ad([new qo("",'"interpolate" expressions cannot be used with this property')]):Ew(x?new oy(_?"camera":"composite",h.value,x.labels,x instanceof No?x.interpolation:void 0,l):new im(_?"constant":"source",h.value,l)):ad([new qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rm{constructor(s,l){this._parameters=s,this._specification=l,dr(this,Tw(this._parameters,this._specification))}static deserialize(s){return new rm(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function om(c){let s=null;if(c instanceof ti)s=om(c.result);else if(c instanceof Bc){for(let l of c.args)if(s=om(l),s)break}else(c instanceof zl||c instanceof No)&&c.input instanceof Rs&&c.input.name==="zoom"&&(s=c);return s instanceof qo||c.eachChild(l=>{let h=om(l);h instanceof qo?s=h:!s&&h?s=new qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&h&&s!==h&&(s=new qo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Ul(c,s=new Set){return c instanceof Bh&&s.add(c.key),c.eachChild(l=>{Ul(l,s)}),s}function Hc(c,s){let{zoom:l,heatmapDensity:h,elevation:p,lineProgress:_,isSupportedScript:y,accumulated:x}=c??{};return{zoom:l,heatmapDensity:h,elevation:p,lineProgress:_,isSupportedScript:y,accumulated:x,globalState:s}}function ay(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(let s of c.slice(1))if(!ay(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}let MD={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Uh(c,s){if(c==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ay(c)||(c=$h(c));let l=zh(c,MD,s);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,p,_)=>l.value.evaluate(h,p,{},_),needGeometry:Dw(c),getGlobalStateRefs:()=>Ul(l.value.expression)}}function AD(c,s){return c<s?-1:c>s?1:0}function Dw(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let s=1;s<c.length;s++)if(Dw(c[s]))return!0;return!1}function $h(c){if(!c)return!0;let s=c[0];return c.length<=1?s!=="any":s==="=="?sm(c[1],c[2],"=="):s==="!="?Hh(sm(c[1],c[2],"==")):s==="<"||s===">"||s==="<="||s===">="?sm(c[1],c[2],s):s==="any"?(l=c.slice(1),["any"].concat(l.map($h))):s==="all"?["all"].concat(c.slice(1).map($h)):s==="none"?["all"].concat(c.slice(1).map($h).map(Hh)):s==="in"?Iw(c[1],c.slice(2)):s==="!in"?Hh(Iw(c[1],c.slice(2))):s==="has"?Mw(c[1]):s!=="!has"||Hh(Mw(c[1]));var l}function sm(c,s,l){switch(c){case"$type":return[`filter-type-${l}`,s];case"$id":return[`filter-id-${l}`,s];default:return[`filter-${l}`,c,s]}}function Iw(c,s){if(s.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(l=>typeof l!=typeof s[0])?["filter-in-large",c,["literal",s.sort(AD)]]:["filter-in-small",c,["literal",s]]}}function Mw(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Hh(c){return["!",c]}function am(c){let s=typeof c;if(s==="number"||s==="boolean"||s==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let p="[";for(let _ of c)p+=`${am(_)},`;return`${p}]`}let l=Object.keys(c).sort(),h="{";for(let p=0;p<l.length;p++)h+=`${JSON.stringify(l[p])}:${am(c[l[p]])},`;return`${h}}`}function Aw(c){let s="";for(let l of Zt)s+=`/${am(c[l])}`;return s}function kw(c){let s=c.value;return s?[new Ke(c.key,s,"constants have been deprecated as of v8")]:[]}function nr(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Gc(c){if(Array.isArray(c))return c.map(Gc);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){let s={};for(let l in c)s[l]=Gc(c[l]);return s}return nr(c)}function hs(c){let s=c.key,l=c.value,h=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,y=c.styleSpec,x=c.validateSpec,C=[],D=yn(l);if(D!=="object")return[new Ke(s,l,`object expected, ${D} found`)];for(let M in l){let R=M.split(".")[0],O=Ah(h,R)||h["*"],F;if(Ah(p,R))F=p[R];else if(Ah(h,R)){if(l[M]===void 0)continue;F=x}else if(p["*"])F=p["*"];else{if(!h["*"]){C.push(new Ke(s,l[M],`unknown property "${M}"`));continue}F=x}C=C.concat(F({key:(s&&`${s}.`)+M,value:l[M],valueSpec:O,style:_,styleSpec:y,object:l,objectKey:M,validateSpec:x},l))}for(let M in h)p[M]||h[M].required&&h[M].default===void 0&&l[M]===void 0&&C.push(new Ke(s,l,`missing required property "${M}"`));return C}function lm(c){let s=c.value,l=c.valueSpec,h=c.style,p=c.styleSpec,_=c.key,y=c.arrayElementValidator||c.validateSpec;if(yn(s)!=="array")return[new Ke(_,s,`array expected, ${yn(s)} found`)];if(l.length&&s.length!==l.length)return[new Ke(_,s,`array length ${l.length} expected, length ${s.length} found`)];let x={type:l.value,values:l.values};p.$version<7&&(x.function=l.function),yn(l.value)==="object"&&(x=l.value);let C=[];for(let D=0;D<s.length;D++)C=C.concat(y({array:s,arrayIndex:D,value:s[D],valueSpec:x,validateSpec:c.validateSpec,style:h,styleSpec:p,key:`${_}[${D}]`}));return C}function Gh(c){let s=c.key,l=c.value,h=c.valueSpec,p=yn(l);return p==="number"&&l!=l&&(p="NaN"),p!=="number"?[new Ke(s,l,`number expected, ${p} found`)]:"minimum"in h&&l<h.minimum?[new Ke(s,l,`${l} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&l>h.maximum?[new Ke(s,l,`${l} is greater than the maximum value ${h.maximum}`)]:[]}function cm(c){let s=c.valueSpec,l=nr(c.value.type),h,p,_,y={},x=l!=="categorical"&&c.value.property===void 0,C=!x,D=yn(c.value.stops)==="array"&&yn(c.value.stops[0])==="array"&&yn(c.value.stops[0][0])==="object",M=hs({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(F){if(l==="identity")return[new Ke(F.key,F.value,'identity function may not have a "stops" property')];let j=[],z=F.value;return j=j.concat(lm({key:F.key,value:z,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:R})),yn(z)==="array"&&z.length===0&&j.push(new Ke(F.key,z,"array must have at least one stop")),j},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:s,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return l==="identity"&&x&&M.push(new Ke(c.key,c.value,'missing required property "property"')),l==="identity"||c.value.stops||M.push(new Ke(c.key,c.value,'missing required property "stops"')),l==="exponential"&&c.valueSpec.expression&&!iy(c.valueSpec)&&M.push(new Ke(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(C&&!ld(c.valueSpec)?M.push(new Ke(c.key,c.value,"property functions not supported")):x&&!Cw(c.valueSpec)&&M.push(new Ke(c.key,c.value,"zoom functions not supported"))),l!=="categorical"&&!D||c.value.property!==void 0||M.push(new Ke(c.key,c.value,'"property" property is required')),M;function R(F){let j=[],z=F.value,H=F.key;if(yn(z)!=="array")return[new Ke(H,z,`array expected, ${yn(z)} found`)];if(z.length!==2)return[new Ke(H,z,`array length 2 expected, length ${z.length} found`)];if(D){if(yn(z[0])!=="object")return[new Ke(H,z,`object expected, ${yn(z[0])} found`)];if(z[0].zoom===void 0)return[new Ke(H,z,"object stop key must have zoom")];if(z[0].value===void 0)return[new Ke(H,z,"object stop key must have value")];if(_&&_>nr(z[0].zoom))return[new Ke(H,z[0].zoom,"stop zoom values must appear in ascending order")];nr(z[0].zoom)!==_&&(_=nr(z[0].zoom),p=void 0,y={}),j=j.concat(hs({key:`${H}[0]`,value:z[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Gh,value:O}}))}else j=j.concat(O({key:`${H}[0]`,value:z[0],validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},z));return cd(Gc(z[1]))?j.concat([new Ke(`${H}[1]`,z[1],"expressions are not allowed in function stops.")]):j.concat(F.validateSpec({key:`${H}[1]`,value:z[1],valueSpec:s,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function O(F,j){let z=yn(F.value),H=nr(F.value),Q=F.value!==null?F.value:j;if(h){if(z!==h)return[new Ke(F.key,Q,`${z} stop domain type must match previous stop domain type ${h}`)]}else h=z;if(z!=="number"&&z!=="string"&&z!=="boolean")return[new Ke(F.key,Q,"stop domain value must be a number, string, or boolean")];if(z!=="number"&&l!=="categorical"){let le=`number expected, ${z} found`;return ld(s)&&l===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(F.key,Q,le)]}return l!=="categorical"||z!=="number"||isFinite(H)&&Math.floor(H)===H?l!=="categorical"&&z==="number"&&p!==void 0&&H<p?[new Ke(F.key,Q,"stop domain values must appear in ascending order")]:(p=H,l==="categorical"&&H in y?[new Ke(F.key,Q,"stop domain values must be unique")]:(y[H]=!0,[])):[new Ke(F.key,Q,`integer expected, found ${H}`)]}}function $l(c){let s=(c.expressionContext==="property"?sy:zh)(Gc(c.value),c.valueSpec);if(s.result==="error")return s.value.map(h=>new Ke(`${c.key}${h.key}`,c.value,h.message));let l=s.value.expression||s.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!l.outputDefined())return[new Ke(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Vh(l))return[new Ke(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Vh(l))return[new Ke(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!tm(l,["zoom","feature-state"]))return[new Ke(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!em(l))return[new Ke(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function qh(c){let s=c.key,l=c.value,h=yn(l);return h!=="string"?[new Ke(s,l,`color expected, ${h} found`)]:_n.parse(String(l))?[]:[new Ke(s,l,`color expected, "${l}" found`)]}function qc(c){let s=c.key,l=c.value,h=c.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(nr(l))===-1&&p.push(new Ke(s,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(h.values).indexOf(nr(l))===-1&&p.push(new Ke(s,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function ud(c){return ay(Gc(c.value))?$l(dr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Rw(c)}function Rw(c){let s=c.value,l=c.key;if(yn(s)!=="array")return[new Ke(l,s,`array expected, ${yn(s)} found`)];let h=c.styleSpec,p,_=[];if(s.length<1)return[new Ke(l,s,"filter array must have at least 1 element")];switch(_=_.concat(qc({key:`${l}[0]`,value:s[0],valueSpec:h.filter_operator,style:c.style,styleSpec:c.styleSpec})),nr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&nr(s[1])==="$type"&&_.push(new Ke(l,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&_.push(new Ke(l,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(p=yn(s[1]),p!=="string"&&_.push(new Ke(`${l}[1]`,s[1],`string expected, ${p} found`)));for(let y=2;y<s.length;y++)p=yn(s[y]),nr(s[1])==="$type"?_=_.concat(qc({key:`${l}[${y}]`,value:s[y],valueSpec:h.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Ke(`${l}[${y}]`,s[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<s.length;y++)_=_.concat(Rw({key:`${l}[${y}]`,value:s[y],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=yn(s[1]),s.length!==2?_.push(new Ke(l,s,`filter array for "${s[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Ke(`${l}[1]`,s[1],`string expected, ${p} found`))}return _}function Pw(c,s){let l=c.key,h=c.validateSpec,p=c.style,_=c.styleSpec,y=c.value,x=c.objectKey,C=_[`${s}_${c.layerType}`];if(!C)return[];let D=x.match(/^(.*)-transition$/);if(s==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return h({key:l,value:y,valueSpec:_.transition,style:p,styleSpec:_});let M=c.valueSpec||C[x];if(!M)return[new Ke(l,y,`unknown property "${x}"`)];let R;if(yn(y)==="string"&&ld(M)&&!M.tokens&&(R=/^{([^}]+)}$/.exec(y)))return[new Ke(l,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];let O=[];return c.layerType==="symbol"&&x==="text-font"&&nm(Gc(y))&&nr(y.type)==="identity"&&O.push(new Ke(l,y,'"text-font" does not support identity functions')),O.concat(h({key:c.key,value:y,valueSpec:M,style:p,styleSpec:_,expressionContext:"property",propertyType:s,propertyKey:x}))}function Nw(c){return Pw(c,"paint")}function Ow(c){return Pw(c,"layout")}function Fw(c){let s=[],l=c.value,h=c.key,p=c.style,_=c.styleSpec;if(yn(l)!=="object")return[new Ke(h,l,`object expected, ${yn(l)} found`)];l.type||l.ref||s.push(new Ke(h,l,'either "type" or "ref" is required'));let y=nr(l.type),x=nr(l.ref);if(l.id){let C=nr(l.id);for(let D=0;D<c.arrayIndex;D++){let M=p.layers[D];nr(M.id)===C&&s.push(new Ke(h,l.id,`duplicate layer id "${l.id}", previously used at line ${M.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&s.push(new Ke(h,l[D],`"${D}" is prohibited for ref layers`))}),p.layers.forEach(D=>{nr(D.id)===x&&(C=D)}),C?C.ref?s.push(new Ke(h,l.ref,"ref cannot reference another ref layer")):y=nr(C.type):s.push(new Ke(h,l.ref,`ref layer "${x}" not found`))}else if(y!=="background")if(l.source){let C=p.sources&&p.sources[l.source],D=C&&nr(C.type);C?D==="vector"&&y==="raster"?s.push(new Ke(h,l.source,`layer "${l.id}" requires a raster source`)):D!=="raster-dem"&&y==="hillshade"||D!=="raster-dem"&&y==="color-relief"?s.push(new Ke(h,l.source,`layer "${l.id}" requires a raster-dem source`)):D==="raster"&&y!=="raster"?s.push(new Ke(h,l.source,`layer "${l.id}" requires a vector source`)):D!=="vector"||l["source-layer"]?D==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?s.push(new Ke(h,l.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!l.paint||!l.paint["line-gradient"]||D==="geojson"&&C.lineMetrics||s.push(new Ke(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new Ke(h,l,`layer "${l.id}" must specify a "source-layer"`)):s.push(new Ke(h,l.source,`source "${l.source}" not found`))}else s.push(new Ke(h,l,'missing required property "source"'));return s=s.concat(hs({key:h,value:l,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${h}.type`,value:l.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:l,objectKey:"type"}),filter:ud,layout:C=>hs({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":D=>Ow(dr({layerType:y},D))}}),paint:C=>hs({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":D=>Nw(dr({layerType:y},D))}})}})),s}function Hl(c){let s=c.value,l=c.key,h=yn(s);return h!=="string"?[new Ke(l,s,`string expected, ${h} found`)]:[]}let ly={promoteId:function({key:c,value:s}){if(yn(s)==="string")return Hl({key:c,value:s});{let l=[];for(let h in s)l.push(...Hl({key:`${c}.${h}`,value:s[h]}));return l}}};function cy(c){let s=c.value,l=c.key,h=c.styleSpec,p=c.style,_=c.validateSpec;if(!s.type)return[new Ke(l,s,'"type" is required')];let y=nr(s.type),x;switch(y){case"vector":case"raster":return x=hs({key:l,value:s,valueSpec:h[`source_${y.replace("-","_")}`],style:c.style,styleSpec:h,objectElementValidators:ly,validateSpec:_}),x;case"raster-dem":return x=(function(C){var D;let M=(D=C.sourceName)!==null&&D!==void 0?D:"",R=C.value,O=C.styleSpec,F=O.source_raster_dem,j=C.style,z=[],H=yn(R);if(R===void 0)return z;if(H!=="object")return z.push(new Ke("source_raster_dem",R,`object expected, ${H} found`)),z;let Q=nr(R.encoding)==="custom",le=["redFactor","greenFactor","blueFactor","baseShift"],ee=C.value.encoding?`"${C.value.encoding}"`:"Default";for(let ne in R)!Q&&le.includes(ne)?z.push(new Ke(ne,R[ne],`In "${M}": "${ne}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):F[ne]?z=z.concat(C.validateSpec({key:ne,value:R[ne],valueSpec:F[ne],validateSpec:C.validateSpec,style:j,styleSpec:O})):z.push(new Ke(ne,R[ne],`unknown property "${ne}"`));return z})({sourceName:l,value:s,style:c.style,styleSpec:h,validateSpec:_}),x;case"geojson":if(x=hs({key:l,value:s,valueSpec:h.source_geojson,style:p,styleSpec:h,validateSpec:_,objectElementValidators:ly}),s.cluster)for(let C in s.clusterProperties){let[D,M]=s.clusterProperties[C],R=typeof D=="string"?[D,["accumulated"],["get",C]]:D;x.push(...$l({key:`${l}.${C}.map`,value:M,expressionContext:"cluster-map"})),x.push(...$l({key:`${l}.${C}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return hs({key:l,value:s,valueSpec:h.source_video,style:p,validateSpec:_,styleSpec:h});case"image":return hs({key:l,value:s,valueSpec:h.source_image,style:p,validateSpec:_,styleSpec:h});case"canvas":return[new Ke(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qc({key:`${l}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Wh(c){let s=c.value,l=c.styleSpec,h=l.light,p=c.style,_=[],y=yn(s);if(s===void 0)return _;if(y!=="object")return _=_.concat([new Ke("light",s,`object expected, ${y} found`)]),_;for(let x in s){let C=x.match(/^(.*)-transition$/);_=_.concat(C&&h[C[1]]&&h[C[1]].transition?c.validateSpec({key:x,value:s[x],valueSpec:l.transition,validateSpec:c.validateSpec,style:p,styleSpec:l}):h[x]?c.validateSpec({key:x,value:s[x],valueSpec:h[x],validateSpec:c.validateSpec,style:p,styleSpec:l}):[new Ke(x,s[x],`unknown property "${x}"`)])}return _}function Lw(c){let s=c.value,l=c.styleSpec,h=l.sky,p=c.style,_=yn(s);if(s===void 0)return[];if(_!=="object")return[new Ke("sky",s,`object expected, ${_} found`)];let y=[];for(let x in s)y=y.concat(h[x]?c.validateSpec({key:x,value:s[x],valueSpec:h[x],style:p,styleSpec:l}):[new Ke(x,s[x],`unknown property "${x}"`)]);return y}function uy(c){let s=c.value,l=c.styleSpec,h=l.terrain,p=c.style,_=[],y=yn(s);if(s===void 0)return _;if(y!=="object")return _=_.concat([new Ke("terrain",s,`object expected, ${y} found`)]),_;for(let x in s)_=_.concat(h[x]?c.validateSpec({key:x,value:s[x],valueSpec:h[x],validateSpec:c.validateSpec,style:p,styleSpec:l}):[new Ke(x,s[x],`unknown property "${x}"`)]);return _}function dy(c){let s=[],l=c.value,h=c.key;if(Array.isArray(l)){let p=[],_=[];for(let y in l)l[y].id&&p.includes(l[y].id)&&s.push(new Ke(h,l,`all the sprites' ids must be unique, but ${l[y].id} is duplicated`)),p.push(l[y].id),l[y].url&&_.includes(l[y].url)&&s.push(new Ke(h,l,`all the sprites' URLs must be unique, but ${l[y].url} is duplicated`)),_.push(l[y].url),s=s.concat(hs({key:`${h}[${y}]`,value:l[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return s}return Hl({key:h,value:l})}function Bw(c){return!!c&&c.constructor===Object}function hy(c){return Bw(c.value)?[]:[new Ke(c.key,c.value,`object expected, ${yn(c.value)} found`)]}let fy={"*":()=>[],array:lm,boolean:function(c){let s=c.value,l=c.key,h=yn(s);return h!=="boolean"?[new Ke(l,s,`boolean expected, ${h} found`)]:[]},number:Gh,color:qh,constants:kw,enum:qc,filter:ud,function:cm,layer:Fw,object:hs,source:cy,light:Wh,sky:Lw,terrain:uy,projection:function(c){let s=c.value,l=c.styleSpec,h=l.projection,p=c.style,_=yn(s);if(s===void 0)return[];if(_!=="object")return[new Ke("projection",s,`object expected, ${_} found`)];let y=[];for(let x in s)y=y.concat(h[x]?c.validateSpec({key:x,value:s[x],valueSpec:h[x],style:p,styleSpec:l}):[new Ke(x,s[x],`unknown property "${x}"`)]);return y},projectionDefinition:function(c){let s=c.key,l=c.value;l=l instanceof String?l.valueOf():l;let h=yn(l);return h!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(l)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(l)?["array","string"].includes(h)?[]:[new Ke(s,l,`projection expected, invalid type "${h}" found`)]:[new Ke(s,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:Hl,formatted:function(c){return Hl(c).length===0?[]:$l(c)},resolvedImage:function(c){return Hl(c).length===0?[]:$l(c)},padding:function(c){let s=c.key,l=c.value;if(yn(l)==="array"){if(l.length<1||l.length>4)return[new Ke(s,l,`padding requires 1 to 4 values; ${l.length} values found`)];let h={type:"number"},p=[];for(let _=0;_<l.length;_++)p=p.concat(c.validateSpec({key:`${s}[${_}]`,value:l[_],validateSpec:c.validateSpec,valueSpec:h}));return p}return Gh({key:s,value:l,valueSpec:{}})},numberArray:function(c){let s=c.key,l=c.value;if(yn(l)==="array"){let h={type:"number"};if(l.length<1)return[new Ke(s,l,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<l.length;_++)p=p.concat(c.validateSpec({key:`${s}[${_}]`,value:l[_],validateSpec:c.validateSpec,valueSpec:h}));return p}return Gh({key:s,value:l,valueSpec:{}})},colorArray:function(c){let s=c.key,l=c.value;if(yn(l)==="array"){if(l.length<1)return[new Ke(s,l,"array length at least 1 expected, length 0 found")];let h=[];for(let p=0;p<l.length;p++)h=h.concat(qh({key:`${s}[${p}]`,value:l[p]}));return h}return qh({key:s,value:l})},variableAnchorOffsetCollection:function(c){let s=c.key,l=c.value,h=yn(l),p=c.styleSpec;if(h!=="array"||l.length<1||l.length%2!=0)return[new Ke(s,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<l.length;y+=2)_=_.concat(qc({key:`${s}[${y}]`,value:l[y],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(lm({key:`${s}[${y+1}]`,value:l[y+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:p}));return _},sprite:dy,state:hy,fontFaces:function(c){let s=c.key,l=c.value,h=c.validateSpec,p=c.styleSpec,_=c.style;if(!Bw(l))return[new Ke(s,l,`object expected, ${yn(l)} found`)];let y=[];for(let x in l){let C=l[x],D=yn(C);if(D==="string")y.push(...Hl({key:`${s}.${x}`,value:C}));else if(D==="array"){let M={url:{type:"string",required:!0},"unicode-range":{type:"array",value:"string"}};for(let[R,O]of C.entries())y.push(...hs({key:`${s}.${x}[${R}]`,value:O,valueSpec:M,styleSpec:p,style:_,validateSpec:h}))}else y.push(new Ke(`${s}.${x}`,C,`string or array expected, ${D} found`))}return y}};function Gl(c){let s=c.value,l=c.valueSpec,h=c.styleSpec;return c.validateSpec=Gl,l.expression&&nm(nr(s))?cm(c):l.expression&&cd(Gc(s))?$l(c):l.type&&fy[l.type]?fy[l.type](c):hs(dr({},c,{valueSpec:l.type?h[l.type]:l}))}function Vw(c){let s=c.value,l=c.key,h=Hl(c);return h.length||(s.indexOf("{fontstack}")===-1&&h.push(new Ke(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&h.push(new Ke(l,s,'"glyphs" url must include a "{range}" token'))),h}function Ps(c,s=we){let l=[];return l=l.concat(Gl({key:"",value:c,valueSpec:s.$root,styleSpec:s,style:c,validateSpec:Gl,objectElementValidators:{glyphs:Vw,"*":()=>[]}})),c.constants&&(l=l.concat(kw({key:"constants",value:c.constants}))),jw(l)}function Zs(c){return function(s){return c(Object.assign({},s,{validateSpec:Gl}))}}function jw(c){return[].concat(c).sort((s,l)=>s.line-l.line)}function Ks(c){return function(...s){return jw(c.apply(this,s))}}Ps.source=Ks(Zs(cy)),Ps.sprite=Ks(Zs(dy)),Ps.glyphs=Ks(Zs(Vw)),Ps.light=Ks(Zs(Wh)),Ps.sky=Ks(Zs(Lw)),Ps.terrain=Ks(Zs(uy)),Ps.state=Ks(Zs(hy)),Ps.layer=Ks(Zs(Fw)),Ps.filter=Ks(Zs(ud)),Ps.paintProperty=Ks(Zs(Nw)),Ps.layoutProperty=Ks(Zs(Ow));let kD={type:"enum","property-type":"data-constant",expression:{interpolated:!1,parameters:["global-state"]},values:{visible:{},none:{}},transition:!1,default:"visible"};class Zh{constructor(s,l){this._globalState=l,this.setValue(s)}evaluate(){var s;return(s=this._literalValue)!==null&&s!==void 0?s:this._compiledValue.evaluate({})}setValue(s){if(s==null||s==="visible"||s==="none")return this._literalValue=s==="none"?"none":"visible",this._compiledValue=void 0,void(this._globalStateRefs=new Set);let l=zh(s,kD,this._globalState);if(l.result==="error")throw this._literalValue="visible",this._compiledValue=void 0,new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));this._literalValue=void 0,this._compiledValue=l.value,this._globalStateRefs=Ul(l.value.expression)}getGlobalStateRefs(){return this._globalStateRefs}}let Kh=we,Ur=Ps,Yh=Ur.light,zw=Ur.sky,RD=Ur.paintProperty,PD=Ur.layoutProperty;function dd(c,s){let l=!1;if(s&&s.length)for(let h of s)c.fire(new $e(new Error(h.message))),l=!0;return l}class hd{constructor(s,l,h){let p=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;let y=new Int32Array(this.arrayBuffer);s=y[0],this.d=(l=y[1])+2*(h=y[2]);for(let C=0;C<this.d*this.d;C++){let D=y[3+C],M=y[3+C+1];p.push(D===M?null:y.subarray(D,M))}let x=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=l+2*h;for(let y=0;y<this.d*this.d;y++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=s,this.padding=h,this.scale=l/s,this.uid=0;let _=h/l*s;this.min=-_,this.max=s+_}insert(s,l,h,p,_){this._forEachCell(l,h,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,l,h,p,_,y){this.cells[_].push(y)}query(s,l,h,p,_){let y=this.min,x=this.max;if(s<=y&&l<=y&&x<=h&&x<=p&&!_)return Array.prototype.slice.call(this.keys);{let C=[];return this._forEachCell(s,l,h,p,this._queryCell,C,{},_),C}}_queryCell(s,l,h,p,_,y,x,C){let D=this.cells[_];if(D!==null){let M=this.keys,R=this.bboxes;for(let O=0;O<D.length;O++){let F=D[O];if(x[F]===void 0){let j=4*F;(C?C(R[j+0],R[j+1],R[j+2],R[j+3]):s<=R[j+2]&&l<=R[j+3]&&h>=R[j+0]&&p>=R[j+1])?(x[F]=!0,y.push(M[F])):x[F]=!1}}}}_forEachCell(s,l,h,p,_,y,x,C){let D=this._convertToCellCoord(s),M=this._convertToCellCoord(l),R=this._convertToCellCoord(h),O=this._convertToCellCoord(p);for(let F=D;F<=R;F++)for(let j=M;j<=O;j++){let z=this.d*j+F;if((!C||C(this._convertFromCellCoord(F),this._convertFromCellCoord(j),this._convertFromCellCoord(F+1),this._convertFromCellCoord(j+1)))&&_.call(this,s,l,h,p,z,y,x,C))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let s=this.cells,l=3+this.cells.length+1+1,h=0;for(let y=0;y<this.cells.length;y++)h+=this.cells[y].length;let p=new Int32Array(l+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=l;for(let y=0;y<s.length;y++){let x=s[y];p[3+y]=_,p.set(x,_),_+=x.length}return p[3+s.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+s.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(s,l){let h=s.toArrayBuffer();return l&&l.push(h),{buffer:h}}static deserialize(s){return new hd(s.buffer)}}let Ys={};function wt(c,s,l={}){if(Ys[c])throw new Error(`${c} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:c,writeable:!1}),Ys[c]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}wt("Object",Object),wt("Set",Set),wt("TransferableGridIndex",hd),wt("Color",_n),wt("Error",Error),wt("AJAXError",fe),wt("ResolvedImage",ds),wt("StylePropertyFunction",rm),wt("StyleExpression",ry,{omit:["_evaluator"]}),wt("ZoomDependentExpression",oy),wt("ZoomConstantExpression",im),wt("CompoundExpression",Rs,{omit:["_evaluate"]});for(let c in sd)sd[c]._classRegistryKey||wt(`Expression_${c}`,sd[c]);function um(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function py(c){return c.$name||c.constructor._classRegistryKey}function fd(c){return!(function(s){if(s===null||typeof s!="object")return!1;let l=py(s);return!(!l||l==="Object")})(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||um(c)||Ja(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function Xh(c,s){if(fd(c))return(um(c)||Ja(c))&&s&&s.push(c),ArrayBuffer.isView(c)&&s&&s.push(c.buffer),c instanceof ImageData&&s&&s.push(c.data.buffer),c;if(Array.isArray(c)){let _=[];for(let y of c)_.push(Xh(y,s));return _}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);let l=py(c);if(!l)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!Ys[l])throw new Error(`${l} is not registered.`);let{klass:h}=Ys[l],p=h.serialize?h.serialize(c,s):{};if(h.serialize){if(s&&p===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let _ in c){if(!c.hasOwnProperty(_)||Ys[l].omit.indexOf(_)>=0)continue;let y=c[_];p[_]=Ys[l].shallow.indexOf(_)>=0?y:Xh(y,s)}c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}function Qh(c){if(fd(c))return c;if(Array.isArray(c))return c.map(Qh);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);let s=py(c)||"Object";if(!Ys[s])throw new Error(`can't deserialize unregistered class ${s}`);let{klass:l}=Ys[s];if(!l)throw new Error(`can't deserialize unregistered class ${s}`);if(l.deserialize)return l.deserialize(c);let h=Object.create(l.prototype);for(let p of Object.keys(c)){if(p==="$name")continue;let _=c[p];h[p]=Ys[s].shallow.indexOf(p)>=0?_:Qh(_)}return h}class my{constructor(){this.first=!0}update(s,l){let h=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=h,!0))}}function Jh(c){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function gy(c){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))}function Uw(c){return/\s/u.test(String.fromCodePoint(c))}function pd(c){for(let s of c)if(gy(s.codePointAt(0)))return!0;return!1}function ND(c){for(let s of c)if(!$w(s.codePointAt(0)))return!1;return!0}function dm(c){let s=c.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch(h){return null}}).filter(l=>l);return new RegExp(s.join("|"),"u")}let hm=dm(["Arab","Dupl","Mong","Ougr","Syrc"]);function $w(c){return!hm.test(String.fromCodePoint(c))}function _y(c){return!(gy(c)||(s=c,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(s))));var s}let Hw=dm(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function yy(c){return Hw.test(String.fromCodePoint(c))}function vy(c,s){return!(!s&&yy(c)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(c)))}function Gw(c){for(let s of c)if(yy(s.codePointAt(0)))return!0;return!1}let ql=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){if(ql.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(c,s){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(c.pluginStatus!=="loading")return this.setState(c),c;let l=c.pluginURL,h=new Promise(_=>{this.loadScriptResolve=_});s(l);let p=new Promise(_=>setTimeout(()=>_(),this.TIMEOUT));if(yield Promise.race([h,p]),this.isParsed()){let _={pluginStatus:"loaded",pluginURL:l};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class Xn{constructor(s,l){this.isSupportedScript=OD,this.zoom=s,l?(this.now=l.now||0,this.fadeDuration=l.fadeDuration||0,this.zoomHistory=l.zoomHistory||new my,this.transition=l.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new my,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let s=this.zoom,l=s-Math.floor(s),h=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}function OD(c){return(function(s,l){for(let h of s)if(!vy(h.codePointAt(0),l))return!1;return!0})(c,ql.getRTLTextPluginStatus()==="loaded")}let ef="-transition";class fm{constructor(s,l,h){this.property=s,this.value=l,this.expression=(function(p,_,y){if(nm(p))return new rm(p,_);if(cd(p)){let x=sy(p,_,y);if(x.result==="error")throw new Error(x.value.map(C=>`${C.key}: ${C.message}`).join(", "));return x.value}{let x=p;return _.type==="color"&&typeof p=="string"?x=_n.parse(p):_.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?_.type!=="numberArray"||typeof p!="number"&&!Array.isArray(p)?_.type!=="colorArray"||typeof p!="string"&&!Array.isArray(p)?_.type==="variableAnchorOffsetCollection"&&Array.isArray(p)?x=Ro.parse(p):_.type==="projectionDefinition"&&typeof p=="string"&&(x=Po.parse(p)):x=$t.parse(p):x=Oi.parse(p):x=yo.parse(p),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>x}}})(l===void 0?s.specification.default:l,s.specification,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(s,l,h){return this.property.possiblyEvaluate(this,s,l,h)}}class pm{constructor(s,l){this.property=s,this.value=new fm(s,void 0,l)}transitioned(s,l){return new qw(this.property,this.value,l,ur({},s.transition,this.transition),s.now)}untransitioned(){return new qw(this.property,this.value,null,{},0)}}class by{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._globalState=l}getValue(s){return Ar(this._values[s].value.value)}setValue(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new pm(this._values[s].property,this._globalState)),this._values[s].value=new fm(this._values[s].property,l===null?void 0:Ar(l),this._globalState)}getTransition(s){return Ar(this._values[s].transition)}setTransition(s,l){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new pm(this._values[s].property,this._globalState)),this._values[s].transition=Ar(l)||void 0}serialize(){let s={};for(let l of Object.keys(this._values)){let h=this.getValue(l);h!==void 0&&(s[l]=h);let p=this.getTransition(l);p!==void 0&&(s[`${l}${ef}`]=p)}return s}transitioned(s,l){let h=new Ww(this._properties);for(let p of Object.keys(this._values))h._values[p]=this._values[p].transitioned(s,l._values[p]);return h}untransitioned(){let s=new Ww(this._properties);for(let l of Object.keys(this._values))s._values[l]=this._values[l].untransitioned();return s}}class qw{constructor(s,l,h,p,_){this.property=s,this.value=l,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,s.specification.transition&&(p.delay||p.duration)&&(this.prior=h)}possiblyEvaluate(s,l,h){let p=s.now||0,_=this.value.possiblyEvaluate(s,l,h),y=this.prior;if(y){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return y.possiblyEvaluate(s,l,h);{let x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(s,l,h),_,yr(x))}}return _}}class Ww{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,l,h){let p=new tf(this._properties);for(let _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(s,l,h);return p}hasTransition(){for(let s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Zw{constructor(s,l){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._globalState=l}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Ar(this._values[s].value)}setValue(s,l){this._values[s]=new fm(this._values[s].property,l===null?void 0:Ar(l),this._globalState)}serialize(){let s={};for(let l of Object.keys(this._values)){let h=this.getValue(l);h!==void 0&&(s[l]=h)}return s}possiblyEvaluate(s,l,h){let p=new tf(this._properties);for(let _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(s,l,h);return p}}class Xs{constructor(s,l,h){this.property=s,this.value=l,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,l,h,p){return this.property.evaluate(this.value,this.parameters,s,l,h,p)}}class tf{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class It{constructor(s){this.specification=s}possiblyEvaluate(s,l){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(l)}interpolate(s,l,h){let p=Si[this.specification.type];return p?p(s,l,h):s}}class Vt{constructor(s,l){this.specification=s,this.overrides=l}possiblyEvaluate(s,l,h,p){return new Xs(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(l,null,{},h,p)}:s.expression,l)}interpolate(s,l,h){if(s.value.kind!=="constant"||l.value.kind!=="constant")return s;if(s.value.value===void 0||l.value.value===void 0)return new Xs(this,{kind:"constant",value:void 0},s.parameters);let p=Si[this.specification.type];if(p){let _=p(s.value.value,l.value.value,h);return new Xs(this,{kind:"constant",value:_},s.parameters)}return s}evaluate(s,l,h,p,_,y){return s.kind==="constant"?s.value:s.evaluate(l,h,p,_,y)}}class nf extends Vt{possiblyEvaluate(s,l,h,p){if(s.value===void 0)return new Xs(this,{kind:"constant",value:void 0},l);if(s.expression.kind==="constant"){let _=s.expression.evaluate(l,null,{},h,p),y=s.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,x=this._calculate(y,y,y,l);return new Xs(this,{kind:"constant",value:x},l)}if(s.expression.kind==="camera"){let _=this._calculate(s.expression.evaluate({zoom:l.zoom-1}),s.expression.evaluate({zoom:l.zoom}),s.expression.evaluate({zoom:l.zoom+1}),l);return new Xs(this,{kind:"constant",value:_},l)}return new Xs(this,s.expression,l)}evaluate(s,l,h,p,_,y){if(s.kind==="source"){let x=s.evaluate(l,h,p,_,y);return this._calculate(x,x,x,l)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(l.zoom)-1},h,p),s.evaluate({zoom:Math.floor(l.zoom)},h,p),s.evaluate({zoom:Math.floor(l.zoom)+1},h,p),l):s.value}_calculate(s,l,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:h,to:l}}interpolate(s){return s}}class mm{constructor(s){this.specification=s}possiblyEvaluate(s,l,h,p){if(s.value!==void 0){if(s.expression.kind==="constant"){let _=s.expression.evaluate(l,null,{},h,p);return this._calculate(_,_,_,l)}return this._calculate(s.expression.evaluate(new Xn(Math.floor(l.zoom-1),l)),s.expression.evaluate(new Xn(Math.floor(l.zoom),l)),s.expression.evaluate(new Xn(Math.floor(l.zoom+1),l)),l)}}_calculate(s,l,h,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:s,to:l}:{from:h,to:l}}interpolate(s){return s}}class gm{constructor(s){this.specification=s}possiblyEvaluate(s,l,h,p){return!!s.expression.evaluate(l,null,{},h,p)}interpolate(){return!1}}class Oo{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let l in s){let h=s[l];h.specification.overridable&&this.overridableProperties.push(l);let p=this.defaultPropertyValues[l]=new fm(h,void 0,void 0),_=this.defaultTransitionablePropertyValues[l]=new pm(h,void 0);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate({})}}}wt("DataDrivenProperty",Vt),wt("DataConstantProperty",It),wt("CrossFadedDataDrivenProperty",nf),wt("CrossFadedProperty",mm),wt("ColorRampProperty",gm);class Ns extends it{constructor(s,l,h){if(super(),this.id=s.id,this.type=s.type,this._globalState=h,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},this._visibilityExpression=(function(p,_){return new Zh(p,_)})(this.visibility,h),s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter,this._featureFilter=Uh(s.filter,h)),l.layout&&(this._unevaluatedLayout=new Zw(l.layout,h)),l.paint)){this._transitionablePaint=new by(l.paint,h);for(let p in s.paint)this.setPaintProperty(p,s.paint[p],{validate:!1});for(let p in s.layout)this.setLayoutProperty(p,s.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tf(l.paint)}}setFilter(s){this.filter=s,this._featureFilter=Uh(s,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}getLayoutAffectingGlobalStateRefs(){let s=new Set;for(let l of this._visibilityExpression.getGlobalStateRefs())s.add(l);if(this._unevaluatedLayout)for(let l in this._unevaluatedLayout._values){let h=this._unevaluatedLayout._values[l];for(let p of h.getGlobalStateRefs())s.add(p)}for(let l of this._featureFilter.getGlobalStateRefs())s.add(l);return s}getPaintAffectingGlobalStateRefs(){var s;let l=new globalThis.Map;if(this._transitionablePaint)for(let h in this._transitionablePaint._values){let p=this._transitionablePaint._values[h].value;for(let _ of p.getGlobalStateRefs()){let y=(s=l.get(_))!==null&&s!==void 0?s:[];y.push({name:h,value:p.value}),l.set(_,y)}}return l}getVisibilityAffectingGlobalStateRefs(){return this._visibilityExpression.getGlobalStateRefs()}setLayoutProperty(s,l,h={}){if(l==null||!this._validate(PD,`layers.${this.id}.layout.${s}`,s,l,h))return s==="visibility"?(this.visibility=l,this._visibilityExpression.setValue(l),void this.recalculateVisibility()):void this._unevaluatedLayout.setValue(s,l)}getPaintProperty(s){return s.endsWith(ef)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,l,h={}){if(l!=null&&this._validate(RD,`layers.${this.id}.paint.${s}`,s,l,h))return!1;if(s.endsWith(ef))return this._transitionablePaint.setTransition(s.slice(0,-11),l||void 0),!1;{let p=this._transitionablePaint._values[s],_=p.property.specification["property-type"]==="cross-faded-data-driven",y=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(s,l),this._handleSpecialPaintPropertyUpdate(s);let C=this._transitionablePaint._values[s].value;return C.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(s,x,C)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,l,h){return!1}isHidden(s=this.minzoom,l=!1){return!!(this.minzoom&&s<(l?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&s>=this.maxzoom)||this._evaluatedVisibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculateVisibility(){this._evaluatedVisibility=this._visibilityExpression.evaluate()}recalculate(s,l){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,l)}serialize(){let s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Yn(s,(l,h)=>!(l===void 0||h==="layout"&&!Object.keys(l).length||h==="paint"&&!Object.keys(l).length))}_validate(s,l,h,p,_={}){return(!_||_.validate!==!1)&&dd(this,s.call(Ur,{key:l,layerType:this.type,objectKey:h,value:p,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let s in this.paint._values){let l=this.paint.get(s);if(l instanceof Xs&&ld(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}let wy;var Kw={get paint(){return wy=wy||new Oo({"raster-opacity":new It(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new It(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new It(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new It(we.paint_raster["raster-brightness-max"]),"raster-saturation":new It(we.paint_raster["raster-saturation"]),"raster-contrast":new It(we.paint_raster["raster-contrast"]),"raster-resampling":new It(we.paint_raster["raster-resampling"]),"raster-fade-duration":new It(we.paint_raster["raster-fade-duration"])})}};class FD extends Ns{constructor(s,l){super(s,Kw,l)}}let LD={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rf{constructor(s,l){this._structArray=s,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,l){return s._trim(),l&&(s.isTransferred=!0,l.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){let l=Object.create(this.prototype);return l.arrayBuffer=s.arrayBuffer,l.length=s.length,l.capacity=s.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ir(c,s=1){let l=0,h=0;return{members:c.map(p=>{let _=LD[p.type].BYTES_PER_ELEMENT,y=l=Wc(l,Math.max(s,_)),x=p.components||1;return h=Math.max(h,_),l+=_*x,{name:p.name,type:p.type,components:x,offset:y}}),size:Wc(l,Math.max(h,s)),alignment:s}}function Wc(c,s){return Math.ceil(c/s)*s}class of extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l){let h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){let p=2*s;return this.int16[p+0]=l,this.int16[p+1]=h,s}}of.prototype.bytesPerElement=4,wt("StructArrayLayout2i4",of);class _m extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h){let p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){let _=3*s;return this.int16[_+0]=l,this.int16[_+1]=h,this.int16[_+2]=p,s}}_m.prototype.bytesPerElement=6,wt("StructArrayLayout3i6",_m);class xy extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p){let _=this.length;return this.resize(_+1),this.emplace(_,s,l,h,p)}emplace(s,l,h,p,_){let y=4*s;return this.int16[y+0]=l,this.int16[y+1]=h,this.int16[y+2]=p,this.int16[y+3]=_,s}}xy.prototype.bytesPerElement=8,wt("StructArrayLayout4i8",xy);class ym extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y){let x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,_,y)}emplace(s,l,h,p,_,y,x){let C=6*s;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=p,this.int16[C+3]=_,this.int16[C+4]=y,this.int16[C+5]=x,s}}ym.prototype.bytesPerElement=12,wt("StructArrayLayout2i4i12",ym);class Ey extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y){let x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,_,y)}emplace(s,l,h,p,_,y,x){let C=4*s,D=8*s;return this.int16[C+0]=l,this.int16[C+1]=h,this.uint8[D+4]=p,this.uint8[D+5]=_,this.uint8[D+6]=y,this.uint8[D+7]=x,s}}Ey.prototype.bytesPerElement=8,wt("StructArrayLayout2i4ub8",Ey);class sf extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l){let h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){let p=2*s;return this.float32[p+0]=l,this.float32[p+1]=h,s}}sf.prototype.bytesPerElement=8,wt("StructArrayLayout2f8",sf);class il extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C,D,M){let R=this.length;return this.resize(R+1),this.emplace(R,s,l,h,p,_,y,x,C,D,M)}emplace(s,l,h,p,_,y,x,C,D,M,R){let O=10*s;return this.uint16[O+0]=l,this.uint16[O+1]=h,this.uint16[O+2]=p,this.uint16[O+3]=_,this.uint16[O+4]=y,this.uint16[O+5]=x,this.uint16[O+6]=C,this.uint16[O+7]=D,this.uint16[O+8]=M,this.uint16[O+9]=R,s}}il.prototype.bytesPerElement=20,wt("StructArrayLayout10ui20",il);class vm extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C){let D=this.length;return this.resize(D+1),this.emplace(D,s,l,h,p,_,y,x,C)}emplace(s,l,h,p,_,y,x,C,D){let M=8*s;return this.uint16[M+0]=l,this.uint16[M+1]=h,this.uint16[M+2]=p,this.uint16[M+3]=_,this.uint16[M+4]=y,this.uint16[M+5]=x,this.uint16[M+6]=C,this.uint16[M+7]=D,s}}vm.prototype.bytesPerElement=16,wt("StructArrayLayout8ui16",vm);class af extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C,D,M,R,O){let F=this.length;return this.resize(F+1),this.emplace(F,s,l,h,p,_,y,x,C,D,M,R,O)}emplace(s,l,h,p,_,y,x,C,D,M,R,O,F){let j=12*s;return this.int16[j+0]=l,this.int16[j+1]=h,this.int16[j+2]=p,this.int16[j+3]=_,this.uint16[j+4]=y,this.uint16[j+5]=x,this.uint16[j+6]=C,this.uint16[j+7]=D,this.int16[j+8]=M,this.int16[j+9]=R,this.int16[j+10]=O,this.int16[j+11]=F,s}}af.prototype.bytesPerElement=24,wt("StructArrayLayout4i4ui4i24",af);class bm extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h){let p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){let _=3*s;return this.float32[_+0]=l,this.float32[_+1]=h,this.float32[_+2]=p,s}}bm.prototype.bytesPerElement=12,wt("StructArrayLayout3f12",bm);class lf extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){let l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint32[1*s+0]=l,s}}lf.prototype.bytesPerElement=4,wt("StructArrayLayout1ul4",lf);class Cy extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C,D){let M=this.length;return this.resize(M+1),this.emplace(M,s,l,h,p,_,y,x,C,D)}emplace(s,l,h,p,_,y,x,C,D,M){let R=10*s,O=5*s;return this.int16[R+0]=l,this.int16[R+1]=h,this.int16[R+2]=p,this.int16[R+3]=_,this.int16[R+4]=y,this.int16[R+5]=x,this.uint32[O+3]=C,this.uint16[R+8]=D,this.uint16[R+9]=M,s}}Cy.prototype.bytesPerElement=20,wt("StructArrayLayout6i1ul2ui20",Cy);class md extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y){let x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,_,y)}emplace(s,l,h,p,_,y,x){let C=6*s;return this.int16[C+0]=l,this.int16[C+1]=h,this.int16[C+2]=p,this.int16[C+3]=_,this.int16[C+4]=y,this.int16[C+5]=x,s}}md.prototype.bytesPerElement=12,wt("StructArrayLayout2i2i2i12",md);class Zc extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,s,l,h,p,_)}emplace(s,l,h,p,_,y){let x=4*s,C=8*s;return this.float32[x+0]=l,this.float32[x+1]=h,this.float32[x+2]=p,this.int16[C+6]=_,this.int16[C+7]=y,s}}Zc.prototype.bytesPerElement=16,wt("StructArrayLayout2f1f2i16",Zc);class Ty extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y){let x=this.length;return this.resize(x+1),this.emplace(x,s,l,h,p,_,y)}emplace(s,l,h,p,_,y,x){let C=16*s,D=4*s,M=8*s;return this.uint8[C+0]=l,this.uint8[C+1]=h,this.float32[D+1]=p,this.float32[D+2]=_,this.int16[M+6]=y,this.int16[M+7]=x,s}}Ty.prototype.bytesPerElement=16,wt("StructArrayLayout2ub2f2i16",Ty);class cf extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h){let p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){let _=3*s;return this.uint16[_+0]=l,this.uint16[_+1]=h,this.uint16[_+2]=p,s}}cf.prototype.bytesPerElement=6,wt("StructArrayLayout3ui6",cf);class Kc extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q){let le=this.length;return this.resize(le+1),this.emplace(le,s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q)}emplace(s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q,le){let ee=24*s,ne=12*s,de=48*s;return this.int16[ee+0]=l,this.int16[ee+1]=h,this.uint16[ee+2]=p,this.uint16[ee+3]=_,this.uint32[ne+2]=y,this.uint32[ne+3]=x,this.uint32[ne+4]=C,this.uint16[ee+10]=D,this.uint16[ee+11]=M,this.uint16[ee+12]=R,this.float32[ne+7]=O,this.float32[ne+8]=F,this.uint8[de+36]=j,this.uint8[de+37]=z,this.uint8[de+38]=H,this.uint32[ne+10]=Q,this.int16[ee+22]=le,s}}Kc.prototype.bytesPerElement=48,wt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Kc);class Sy extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q,le,ee,ne,de,me,Ie,qe,He,We,lt,et){let Le=this.length;return this.resize(Le+1),this.emplace(Le,s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q,le,ee,ne,de,me,Ie,qe,He,We,lt,et)}emplace(s,l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q,le,ee,ne,de,me,Ie,qe,He,We,lt,et,Le){let Ne=32*s,_t=16*s;return this.int16[Ne+0]=l,this.int16[Ne+1]=h,this.int16[Ne+2]=p,this.int16[Ne+3]=_,this.int16[Ne+4]=y,this.int16[Ne+5]=x,this.int16[Ne+6]=C,this.int16[Ne+7]=D,this.uint16[Ne+8]=M,this.uint16[Ne+9]=R,this.uint16[Ne+10]=O,this.uint16[Ne+11]=F,this.uint16[Ne+12]=j,this.uint16[Ne+13]=z,this.uint16[Ne+14]=H,this.uint16[Ne+15]=Q,this.uint16[Ne+16]=le,this.uint16[Ne+17]=ee,this.uint16[Ne+18]=ne,this.uint16[Ne+19]=de,this.uint16[Ne+20]=me,this.uint16[Ne+21]=Ie,this.uint16[Ne+22]=qe,this.uint32[_t+12]=He,this.float32[_t+13]=We,this.float32[_t+14]=lt,this.uint16[Ne+30]=et,this.uint16[Ne+31]=Le,s}}Sy.prototype.bytesPerElement=64,wt("StructArrayLayout8i15ui1ul2f2ui64",Sy);class wm extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){let l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.float32[1*s+0]=l,s}}wm.prototype.bytesPerElement=4,wt("StructArrayLayout1f4",wm);class xm extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h){let p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){let _=3*s;return this.uint16[6*s+0]=l,this.float32[_+1]=h,this.float32[_+2]=p,s}}xm.prototype.bytesPerElement=12,wt("StructArrayLayout1ui2f12",xm);class Dy extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l,h){let p=this.length;return this.resize(p+1),this.emplace(p,s,l,h)}emplace(s,l,h,p){let _=4*s;return this.uint32[2*s+0]=l,this.uint16[_+2]=h,this.uint16[_+3]=p,s}}Dy.prototype.bytesPerElement=8,wt("StructArrayLayout1ul2ui8",Dy);class v extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,l){let h=this.length;return this.resize(h+1),this.emplace(h,s,l)}emplace(s,l,h){let p=2*s;return this.uint16[p+0]=l,this.uint16[p+1]=h,s}}v.prototype.bytesPerElement=4,wt("StructArrayLayout2ui4",v);class a extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){let l=this.length;return this.resize(l+1),this.emplace(l,s)}emplace(s,l){return this.uint16[1*s+0]=l,s}}a.prototype.bytesPerElement=2,wt("StructArrayLayout1ui2",a);class u extends Fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,l,h,p){let _=this.length;return this.resize(_+1),this.emplace(_,s,l,h,p)}emplace(s,l,h,p,_){let y=4*s;return this.float32[y+0]=l,this.float32[y+1]=h,this.float32[y+2]=p,this.float32[y+3]=_,s}}u.prototype.bytesPerElement=16,wt("StructArrayLayout4f16",u);class f extends rf{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new d(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class g extends Cy{get(s){return new f(this,s)}}wt("CollisionBoxArray",g);class w extends rf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class E extends Kc{get(s){return new w(this,s)}}wt("PlacedSymbolArray",E);class S extends rf{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}S.prototype.size=64;class I extends Sy{get(s){return new S(this,s)}}wt("SymbolInstanceArray",I);class k extends wm{getoffsetX(s){return this.float32[1*s+0]}}wt("GlyphOffsetArray",k);class P extends _m{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}wt("SymbolLineVertexArray",P);class B extends rf{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}B.prototype.size=12;class L extends xm{get(s){return new B(this,s)}}wt("TextAnchorOffsetArray",L);class $ extends rf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$.prototype.size=8;class Y extends Dy{get(s){return new $(this,s)}}wt("FeatureIndexArray",Y);class ie extends of{}class oe extends of{}class re extends of{}class ue extends ym{}class ge extends Ey{}class ce extends sf{}class pe extends il{}class ve extends vm{}class he extends af{}class be extends bm{}class Pe extends lf{}class Ae extends md{}class ke extends Ty{}class Re extends cf{}class ot extends v{}let at=ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ye}=at;class dt{constructor(s=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=s}prepareSegment(s,l,h,p){let _=this.segments[this.segments.length-1];return s>dt.MAX_VERTEX_ARRAY_LENGTH&&zr(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+s>dt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p?this.createNewSegment(l,h,p):_}createNewSegment(s,l,h){let p={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return h!==void 0&&(p.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(s,l,h){return this.prepareSegment(0,s,l,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let s of this.segments)for(let l in s.vaos)s.vaos[l].destroy()}static simpleSegment(s,l,h,p){return new dt([{vertexOffset:s,primitiveOffset:l,vertexLength:h,primitiveLength:p,vaos:{},sortKey:0}])}}function Yt(c,s){return 256*(c=ln(Math.floor(c),0,255))+ln(Math.floor(s),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wt("SegmentVector",dt);let Hn=ir([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),yi=ir([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ni,Di,ii,Zi={exports:{}},Ii={exports:{}},$r={exports:{}},hr=(function(){if(ii)return Zi.exports;ii=1;var c=(ni||(ni=1,Ii.exports=function(l,h){var p,_,y,x,C,D,M,R;for(_=l.length-(p=3&l.length),y=h,C=3432918353,D=461845907,R=0;R<_;)M=255&l.charCodeAt(R)|(255&l.charCodeAt(++R))<<8|(255&l.charCodeAt(++R))<<16|(255&l.charCodeAt(++R))<<24,++R,y=27492+(65535&(x=5*(65535&(y=(y^=M=(65535&(M=(M=(65535&M)*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,p){case 3:M^=(255&l.charCodeAt(R+2))<<16;case 2:M^=(255&l.charCodeAt(R+1))<<8;case 1:y^=M=(65535&(M=(M=(65535&(M^=255&l.charCodeAt(R)))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<15|M>>>17))*D+(((M>>>16)*D&65535)<<16)&4294967295}return y^=l.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Ii.exports),s=(Di||(Di=1,$r.exports=function(l,h){for(var p,_=l.length,y=h^_,x=0;_>=4;)p=1540483477*(65535&(p=255&l.charCodeAt(x)|(255&l.charCodeAt(++x))<<8|(255&l.charCodeAt(++x))<<16|(255&l.charCodeAt(++x))<<24))+((1540483477*(p>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++x;switch(_){case 3:y^=(255&l.charCodeAt(x+2))<<16;case 2:y^=(255&l.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&l.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),$r.exports);return Zi.exports=c,Zi.exports.murmur3=c,Zi.exports.murmur2=s,Zi.exports})(),rr=m(hr);class no{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,l,h,p){this.ids.push(Wl(s)),this.positions.push(l,h,p)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let l=Wl(s),h=0,p=this.ids.length-1;for(;h<p;){let y=h+p>>1;this.ids[y]>=l?p=y:h=y+1}let _=[];for(;this.ids[h]===l;)_.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return _}static serialize(s,l){let h=new Float64Array(s.ids),p=new Uint32Array(s.positions);return rl(h,p,0,h.length-1),l&&l.push(h.buffer,p.buffer),{ids:h,positions:p}}static deserialize(s){let l=new no;return l.ids=s.ids,l.positions=s.positions,l.indexed=!0,l}}function Wl(c){let s=+c;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:rr(String(c))}function rl(c,s,l,h){for(;l<h;){let p=c[l+h>>1],_=l-1,y=h+1;for(;;){do _++;while(c[_]<p);do y--;while(c[y]>p);if(_>=y)break;Ta(c,_,y),Ta(s,3*_,3*y),Ta(s,3*_+1,3*y+1),Ta(s,3*_+2,3*y+2)}y-l<h-y?(rl(c,s,l,y),l=y+1):(rl(c,s,y+1,h),h=y)}}function Ta(c,s,l){let h=c[s];c[s]=c[l],c[l]=h}wt("FeaturePositionMap",no);class Ko{constructor(s,l){this.gl=s.gl,this.location=l}}class Yc extends Ko{constructor(s,l){super(s,l),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class uf extends Ko{constructor(s,l){super(s,l),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class Xc extends Ko{constructor(s,l){super(s,l),this.current=_n.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}let Os=new Float32Array(16);function Sa(c){return[Yt(255*c.r,255*c.g),Yt(255*c.b,255*c.a)]}class Qs{constructor(s,l,h){this.value=s,this.uniformNames=l.map(p=>`u_${p}`),this.type=h}setUniform(s,l,h){s.set(h.constantOr(this.value))}getBinding(s,l,h){return this.type==="color"?new Xc(s,l):new Yc(s,l)}}class Js{constructor(s,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=s.tlbr}setConstantDashPositions(s,l){this.dashTo=[0,s.y,s.height,s.width],this.dashFrom=[0,l.y,l.height,l.width]}setUniform(s,l,h,p){let _=null;p==="u_pattern_to"?_=this.patternTo:p==="u_pattern_from"?_=this.patternFrom:p==="u_dasharray_to"?_=this.dashTo:p==="u_dasharray_from"?_=this.dashFrom:p==="u_pixel_ratio_to"?_=this.pixelRatioTo:p==="u_pixel_ratio_from"&&(_=this.pixelRatioFrom),_!==null&&s.set(_)}getBinding(s,l,h){return h.substr(0,9)==="u_pattern"||h.substr(0,12)==="u_dasharray_"?new uf(s,l):new Yc(s,l)}}class fi{constructor(s,l,h,p){this.expression=s,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(s,l,h){let p=this.paintVertexArray.length,_=this.expression.evaluate(new Xn(0,h),l,{},h.canonical,[],h.formattedSection);this.paintVertexArray.resize(s),this._setPaintValue(p,s,_)}updatePaintArray(s,l,h,p,_){let y=this.expression.evaluate(new Xn(0,_),h,p);this._setPaintValue(s,l,y)}_setPaintValue(s,l,h){if(this.type==="color"){let p=Sa(h);for(let _=s;_<l;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=s;p<l;p++)this.paintVertexArray.emplace(p,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ri{constructor(s,l,h,p,_,y){this.expression=s,this.uniformNames=l.map(x=>`u_${x}_t`),this.type=h,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(s,l,h){let p=this.expression.evaluate(new Xn(this.zoom,h),l,{},h.canonical,[],h.formattedSection),_=this.expression.evaluate(new Xn(this.zoom+1,h),l,{},h.canonical,[],h.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(y,s,p,_)}updatePaintArray(s,l,h,p,_){let y=this.expression.evaluate(new Xn(this.zoom,_),h,p),x=this.expression.evaluate(new Xn(this.zoom+1,_),h,p);this._setPaintValue(s,l,y,x)}_setPaintValue(s,l,h,p){if(this.type==="color"){let _=Sa(h),y=Sa(p);for(let x=s;x<l;x++)this.paintVertexArray.emplace(x,_[0],_[1],y[0],y[1])}else{for(let _=s;_<l;_++)this.paintVertexArray.emplace(_,h,p);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(p))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,l){let h=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,p=ln(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);s.set(p)}getBinding(s,l,h){return new Yc(s,l)}}class Nr{constructor(s,l,h,p,_,y){this.expression=s,this.type=l,this.useIntegerZoom=h,this.zoom=p,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(s,l,h){let p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(p,s,this.getPositionIds(l),h)}updatePaintArray(s,l,h,p,_){this._setPaintValues(s,l,this.getPositionIds(h),_)}_setPaintValues(s,l,h,p){let _=this.getPositions(p);if(!_||!h)return;let y=_[h.min],x=_[h.mid],C=_[h.max];if(y&&x&&C)for(let D=s;D<l;D++)this.emplace(this.zoomInPaintVertexArray,D,x,y),this.emplace(this.zoomOutPaintVertexArray,D,x,C)}upload(s){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){let l=this.getVertexAttributes();this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,l,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,l,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Or extends Nr{getPositions(s){return s.imagePositions}getPositionIds(s){return s.patterns&&s.patterns[this.layerId]}getVertexAttributes(){return Hn.members}emplace(s,l,h,p){s.emplace(l,h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],p.tlbr[0],p.tlbr[1],p.tlbr[2],p.tlbr[3],h.pixelRatio,p.pixelRatio)}}class Yw extends Nr{getPositions(s){return s.dashPositions}getPositionIds(s){return s.dashes&&s.dashes[this.layerId]}getVertexAttributes(){return yi.members}emplace(s,l,h,p){s.emplace(l,0,h.y,h.height,h.width,0,p.y,p.height,p.width)}}class Xw{constructor(s,l,h){this.binders={},this._buffers=[];let p=[];for(let _ in s.paint._values){if(!h(_))continue;let y=s.paint.get(_);if(!(y instanceof Xs&&ld(y.property.specification)))continue;let x=BD(_,s.type),C=y.value,D=y.property.specification.type,M=y.property.useIntegerZoom,R=y.property.specification["property-type"],O=R==="cross-faded"||R==="cross-faded-data-driven";if(C.kind==="constant")this.binders[_]=O?new Js(C.value,x):new Qs(C.value,x,D),p.push(`/u_${_}`);else if(C.kind==="source"||O){let F=Qw(_,D,"source");this.binders[_]=O?_==="line-dasharray"?new Yw(C,D,M,l,F,s.id):new Or(C,D,M,l,F,s.id):new fi(C,x,D,F),p.push(`/a_${_}`)}else{let F=Qw(_,D,"composite");this.binders[_]=new ri(C,x,D,M,l,F),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(s){let l=this.binders[s];return l instanceof fi||l instanceof ri?l.maxValue:0}populatePaintArrays(s,l,h){for(let p in this.binders){let _=this.binders[p];(_ instanceof fi||_ instanceof ri||_ instanceof Nr)&&_.populatePaintArray(s,l,h)}}setConstantPatternPositions(s,l){for(let h in this.binders){let p=this.binders[h];p instanceof Js&&p.setConstantPatternPositions(s,l)}}setConstantDashPositions(s,l){for(let h in this.binders){let p=this.binders[h];p instanceof Js&&p.setConstantDashPositions(s,l)}}updatePaintArrays(s,l,h,p,_){let y=!1;for(let x in s){let C=l.getPositions(x);for(let D of C){let M=h.feature(D.index);for(let R in this.binders){let O=this.binders[R];if((O instanceof fi||O instanceof ri||O instanceof Nr)&&O.expression.isStateDependent===!0){let F=p.paint.get(R);O.expression=F.value,O.updatePaintArray(D.start,D.end,M,s[x],_),y=!0}}}}return y}defines(){let s=[];for(let l in this.binders){let h=this.binders[l];(h instanceof Qs||h instanceof Js)&&s.push(...h.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return s}getBinderAttributes(){let s=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof fi||h instanceof ri)for(let p=0;p<h.paintVertexAttributes.length;p++)s.push(h.paintVertexAttributes[p].name);else if(h instanceof Nr){let p=h.getVertexAttributes();for(let _ of p)s.push(_.name)}}return s}getBinderUniforms(){let s=[];for(let l in this.binders){let h=this.binders[l];if(h instanceof Qs||h instanceof Js||h instanceof ri)for(let p of h.uniformNames)s.push(p)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,l){let h=[];for(let p in this.binders){let _=this.binders[p];if(_ instanceof Qs||_ instanceof Js||_ instanceof ri){for(let y of _.uniformNames)if(l[y]){let x=_.getBinding(s,l[y],y);h.push({name:y,property:p,binding:x})}}}return h}setUniforms(s,l,h,p){for(let{name:_,property:y,binding:x}of l)this.binders[y].setUniform(x,p,h.get(y),_)}updatePaintBuffers(s){this._buffers=[];for(let l in this.binders){let h=this.binders[l];if(s&&h instanceof Nr){let p=s.fromScale===2?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(h instanceof fi||h instanceof ri)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(s){for(let l in this.binders){let h=this.binders[l];(h instanceof fi||h instanceof ri||h instanceof Nr)&&h.upload(s)}this.updatePaintBuffers()}destroy(){for(let s in this.binders){let l=this.binders[s];(l instanceof fi||l instanceof ri||l instanceof Nr)&&l.destroy()}}}class Qc{constructor(s,l,h=()=>!0){this.programConfigurations={};for(let p of s)this.programConfigurations[p.id]=new Xw(p,l,h);this.needsUpload=!1,this._featureMap=new no,this._bufferOffset=0}populatePaintArrays(s,l,h,p){for(let _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(s,l,p);l.id!==void 0&&this._featureMap.add(l.id,h,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,l,h,p){for(let _ of h)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(s,this._featureMap,l,_,p)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(let l in this.programConfigurations)this.programConfigurations[l].upload(s);this.needsUpload=!1}}destroy(){for(let s in this.programConfigurations)this.programConfigurations[s].destroy()}}function BD(c,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${s}-`,"").replace(/-/g,"_")]}function Qw(c,s,l){let h={color:{source:sf,composite:u},number:{source:wm,composite:sf}},p=(function(_){return{"line-pattern":{source:pe,composite:pe},"fill-pattern":{source:pe,composite:pe},"fill-extrusion-pattern":{source:pe,composite:pe},"line-dasharray":{source:ve,composite:ve}}[_]})(c);return p&&p[l]||h[s][l]}wt("ConstantBinder",Qs),wt("CrossFadedConstantBinder",Js),wt("SourceExpressionBinder",fi),wt("CrossFadedPatternBinder",Or),wt("CrossFadedDasharrayBinder",Yw),wt("CompositeExpressionBinder",ri),wt("ProgramConfiguration",Xw,{omit:["_buffers"]}),wt("ProgramConfigurationSet",Qc);let Iy=Math.pow(2,14)-1,Zl=-Iy-1;function Kl(c){let s=ft/c.extent,l=c.loadGeometry();for(let h=0;h<l.length;h++){let p=l[h];for(let _=0;_<p.length;_++){let y=p[_],x=Math.round(y.x*s),C=Math.round(y.y*s);y.x=ln(x,Zl,Iy),y.y=ln(C,Zl,Iy),(x<y.x||x>y.x+1||C<y.y||C>y.y+1)&&zr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Yl(c,s){return{type:c.type,id:c.id,properties:c.properties,geometry:s?Kl(c):[]}}let My=-32768;function Ay(c,s,l,h,p){c.emplaceBack(My+8*s+h,My+8*l+p)}class Em{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new oe,this.indexArray=new Re,this.segments=new dt,this.programConfigurations=new Qc(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,h){let p=this.layers[0],_=[],y=null,x=!1,C=p.type==="heatmap";if(p.type==="circle"){let M=p;y=M.layout.get("circle-sort-key"),x=!y.isConstant(),C=C||M.paint.get("circle-pitch-alignment")==="map"}let D=C?l.subdivisionGranularity.circle:1;for(let{feature:M,id:R,index:O,sourceLayerIndex:F}of s){let j=this.layers[0]._featureFilter.needGeometry,z=Yl(M,j);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),z,h))continue;let H=x?y.evaluate(z,{},h):void 0,Q={id:R,properties:M.properties,type:M.type,sourceLayerIndex:F,index:O,geometry:j?z.geometry:Kl(M),patterns:{},sortKey:H};_.push(Q)}x&&_.sort((M,R)=>M.sortKey-R.sortKey);for(let M of _){let{geometry:R,index:O,sourceLayerIndex:F}=M,j=s[O].feature;this.addFeature(M,R,O,h,D),l.featureIndex.insert(j,R,O,F,this.index)}}update(s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ye),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,l,h,p,_=1){let y;switch(_){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}let x=y.length;for(let C of l)for(let D of C){let M=D.x,R=D.y;if(M<0||M>=ft||R<0||R>=ft)continue;let O=this.segments.prepareSegment(x*x,this.layoutVertexArray,this.indexArray,s.sortKey),F=O.vertexLength;for(let j=0;j<x;j++)for(let z=0;z<x;z++)Ay(this.layoutVertexArray,M,R,y[z],y[j]);for(let j=0;j<x-1;j++)for(let z=0;z<x-1;z++){let H=F+j*x+z,Q=F+(j+1)*x+z;this.indexArray.emplaceBack(H,Q+1,H+1),this.indexArray.emplaceBack(H,Q,Q+1)}O.vertexLength+=x*x,O.primitiveLength+=(x-1)*(x-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{imagePositions:{},canonical:p})}}function Cm(c,s){for(let l=0;l<c.length;l++)if(Tm(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(Tm(c,s[l]))return!0;return!!VD(c,s)}function Jw(c,s,l){return!!Tm(c,s)||!!jD(s,c,l)}function UF(c,s){if(c.length===1)return HF(s,c[0]);for(let l=0;l<s.length;l++){let h=s[l];for(let p=0;p<h.length;p++)if(Tm(c,h[p]))return!0}for(let l=0;l<c.length;l++)if(HF(s,c[l]))return!0;for(let l=0;l<s.length;l++)if(VD(c,s[l]))return!0;return!1}function t9(c,s,l){if(c.length>1){if(VD(c,s))return!0;for(let h=0;h<s.length;h++)if(jD(s[h],c,l))return!0}for(let h=0;h<c.length;h++)if(jD(c[h],s,l))return!0;return!1}function VD(c,s){if(c.length===0||s.length===0)return!1;for(let l=0;l<c.length-1;l++){let h=c[l],p=c[l+1];for(let _=0;_<s.length-1;_++)if(n9(h,p,s[_],s[_+1]))return!0}return!1}function n9(c,s,l,h){return As(c,l,h)!==As(s,l,h)&&As(c,s,l)!==As(c,s,h)}function jD(c,s,l){let h=l*l;if(s.length===1)return c.distSqr(s[0])<h;for(let p=1;p<s.length;p++)if($F(c,s[p-1],s[p])<h)return!0;return!1}function $F(c,s,l){let h=s.distSqr(l);if(h===0)return c.distSqr(s);let p=((c.x-s.x)*(l.x-s.x)+(c.y-s.y)*(l.y-s.y))/h;return c.distSqr(p<0?s:p>1?l:l.sub(s)._mult(p)._add(s))}function HF(c,s){let l,h,p,_=!1;for(let y=0;y<c.length;y++){l=c[y];for(let x=0,C=l.length-1;x<l.length;C=x++)h=l[x],p=l[C],h.y>s.y!=p.y>s.y&&s.x<(p.x-h.x)*(s.y-h.y)/(p.y-h.y)+h.x&&(_=!_)}return _}function Tm(c,s){let l=!1;for(let h=0,p=c.length-1;h<c.length;p=h++){let _=c[h],y=c[p];_.y>s.y!=y.y>s.y&&s.x<(y.x-_.x)*(s.y-_.y)/(y.y-_.y)+_.x&&(l=!l)}return l}function i9(c,s,l){let h=l[0],p=l[2];if(c.x<h.x&&s.x<h.x||c.x>p.x&&s.x>p.x||c.y<h.y&&s.y<h.y||c.y>p.y&&s.y>p.y)return!1;let _=As(c,s,l[0]);return _!==As(c,s,l[1])||_!==As(c,s,l[2])||_!==As(c,s,l[3])}function Sm(c,s,l){let h=s.paint.get(c).value;return h.kind==="constant"?h.value:l.programConfigurations.get(s.id).getMaxValue(c)}function ex(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function tx(c,s,l,h,p){if(!s[0]&&!s[1])return c;let _=d.convert(s)._mult(p);l==="viewport"&&_._rotate(-h);let y=[];for(let x=0;x<c.length;x++)y.push(c[x].sub(_));return y}function r9(c){let s=[];for(let l=0;l<c.length;l++){let h=c[l],p=s.at(-1);(l===0||p&&!h.equals(p))&&s.push(h)}return s}function o9({queryGeometry:c,size:s},l){return Jw(c,l,s)}function s9({queryGeometry:c,size:s,transform:l,unwrappedTileID:h,getElevation:p},_){return Jw(c,_,s*(l.projectTileCoordinates(_.x,_.y,h,p).signedDistanceFromCamera/l.cameraToCenterDistance))}function a9({queryGeometry:c,size:s,transform:l,unwrappedTileID:h,getElevation:p},_){let y=l.projectTileCoordinates(_.x,_.y,h,p).signedDistanceFromCamera,x=s*(l.cameraToCenterDistance/y);return Jw(c,zD(_,l,h,p),x)}function l9({queryGeometry:c,size:s,transform:l,unwrappedTileID:h,getElevation:p},_){return Jw(c,zD(_,l,h,p),s)}function GF({queryGeometry:c,size:s,transform:l,unwrappedTileID:h,getElevation:p,pitchAlignment:_="map",pitchScale:y="map"},x){let C=_==="map"?y==="map"?o9:s9:y==="map"?a9:l9,D={queryGeometry:c,size:s,transform:l,unwrappedTileID:h,getElevation:p};for(let M of x)for(let R of M)if(C(D,R))return!0;return!1}function zD(c,s,l,h){let p=s.projectTileCoordinates(c.x,c.y,l,h).point;return new d((.5*p.x+.5)*s.width,(.5*-p.y+.5)*s.height)}let qF,WF;wt("CircleBucket",Em,{omit:["layers"]});var c9={get paint(){return WF=WF||new Oo({"circle-radius":new Vt(we.paint_circle["circle-radius"]),"circle-color":new Vt(we.paint_circle["circle-color"]),"circle-blur":new Vt(we.paint_circle["circle-blur"]),"circle-opacity":new Vt(we.paint_circle["circle-opacity"]),"circle-translate":new It(we.paint_circle["circle-translate"]),"circle-translate-anchor":new It(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new It(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new It(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Vt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Vt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Vt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return qF=qF||new Oo({"circle-sort-key":new Vt(we.layout_circle["circle-sort-key"])})}};class u9 extends Ns{constructor(s,l){super(s,c9,l)}createBucket(s){return new Em(s)}queryRadius(s){let l=s;return Sm("circle-radius",this,l)+Sm("circle-stroke-width",this,l)+ex(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:h,geometry:p,transform:_,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:C}){let D=tx(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,y),M=this.paint.get("circle-radius").evaluate(l,h)+this.paint.get("circle-stroke-width").evaluate(l,h),R=this.paint.get("circle-pitch-scale"),O=this.paint.get("circle-pitch-alignment"),F,j;return O==="map"?(F=D,j=M*y):(F=(function(z,H,Q,le){return z.map(ee=>zD(ee,H,Q,le))})(D,_,x,C),j=M),GF({queryGeometry:F,size:j,transform:_,unwrappedTileID:x,getElevation:C,pitchAlignment:O,pitchScale:R},p)}}class ZF extends Em{}let KF;wt("HeatmapBucket",ZF,{omit:["layers"]});var d9={get paint(){return KF=KF||new Oo({"heatmap-radius":new Vt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Vt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new It(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gm(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new It(we.paint_heatmap["heatmap-opacity"])})}};function UD(c,{width:s,height:l},h,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==s*l*h)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${s*l*h}`)}else p=new Uint8Array(s*l*h);return c.width=s,c.height=l,c.data=p,c}function YF(c,{width:s,height:l},h){if(s===c.width&&l===c.height)return;let p=UD({},{width:s,height:l},h);$D(c,p,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,s),height:Math.min(c.height,l)},h),c.width=s,c.height=l,c.data=p.data}function $D(c,s,l,h,p,_){if(p.width===0||p.height===0)return s;if(p.width>c.width||p.height>c.height||l.x>c.width-p.width||l.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>s.width||p.height>s.height||h.x>s.width-p.width||h.y>s.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let y=c.data,x=s.data;if(y===x)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<p.height;C++){let D=((l.y+C)*c.width+l.x)*_,M=((h.y+C)*s.width+h.x)*_;for(let R=0;R<p.width*_;R++)x[M+R]=y[D+R]}return s}class ky{constructor(s,l){UD(this,s,1,l)}resize(s){YF(this,s,1)}clone(){return new ky({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,h,p,_){$D(s,l,h,p,_,1)}}class fs{constructor(s,l){UD(this,s,4,l)}resize(s){YF(this,s,4)}replace(s,l){l?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,l,h,p,_){$D(s,l,h,p,_,4)}setPixel(s,l,h){let p=4*(s*this.width+l);this.data[p+0]=Math.round(255*h.r/h.a),this.data[p+1]=Math.round(255*h.g/h.a),this.data[p+2]=Math.round(255*h.b/h.a),this.data[p+3]=Math.round(255*h.a)}}function XF(c){let s={},l=c.resolution||256,h=c.clips?c.clips.length:1,p=c.image||new fs({width:l,height:h});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);let _=(y,x,C)=>{s[c.evaluationKey]=C;let D=c.expression.evaluate(s);p.setPixel(y/4/l,x/4,D)};if(c.clips)for(let y=0,x=0;y<h;++y,x+=4*l)for(let C=0,D=0;C<l;C++,D+=4){let M=C/(l-1),{start:R,end:O}=c.clips[y];_(x,D,R*(1-M)+O*M)}else for(let y=0,x=0;y<l;y++,x+=4)_(0,x,y/(l-1));return p}wt("AlphaImage",ky),wt("RGBAImage",fs);let HD="big-fb";class h9 extends Ns{createBucket(s){return new ZF(s)}constructor(s,l){super(s,d9,l),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=XF({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(HD)&&this.heatmapFbos.delete(HD)}queryRadius(s){return Sm("heatmap-radius",this,s)}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:h,geometry:p,transform:_,pixelsToTileUnits:y,unwrappedTileID:x,getElevation:C}){return GF({queryGeometry:s,size:this.paint.get("heatmap-radius").evaluate(l,h)*y,transform:_,unwrappedTileID:x,getElevation:C},p)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&!this.isHidden()}}let QF;var f9={get paint(){return QF=QF||new Oo({"hillshade-illumination-direction":new It(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new It(we.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new It(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new It(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new It(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new It(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new It(we.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new It(we.paint_hillshade["hillshade-method"])})}};class p9 extends Ns{constructor(s,l){super(s,f9,l),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let s=this.paint.get("hillshade-illumination-direction").values,l=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values,_=Math.max(s.length,l.length,h.length,p.length);s=s.concat(Array(_-s.length).fill(s.at(-1))),l=l.concat(Array(_-l.length).fill(l.at(-1))),h=h.concat(Array(_-h.length).fill(h.at(-1))),p=p.concat(Array(_-p.length).fill(p.at(-1)));let y=l.map(zu);return{directionRadians:s.map(zu),altitudeRadians:y,shadowColor:p,highlightColor:h}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&!this.isHidden()}}let JF;var m9={get paint(){return JF=JF||new Oo({"color-relief-opacity":new It(we["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new gm(we["paint_color-relief"]["color-relief-color"])})}};class GD{constructor(s,l,h,p){this.context=s,this.format=h,this.texture=s.gl.createTexture(),this.update(l,p)}update(s,l,h){let{width:p,height:_}=s,y=!(this.size&&this.size[0]===p&&this.size[1]===_||h),{context:x}=this,{gl:C}=x;if(this.useMipmap=!!(l&&l.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||l.premultiply!==!1)),y)this.size=[p,_],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Ja(s)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,s):C.texImage2D(C.TEXTURE_2D,0,this.format,p,_,0,this.format,C.UNSIGNED_BYTE,s.data);else{let{x:D,y:M}=h||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||Ja(s)?C.texSubImage2D(C.TEXTURE_2D,0,D,M,C.RGBA,C.UNSIGNED_BYTE,s):C.texSubImage2D(C.TEXTURE_2D,0,D,M,p,_,C.RGBA,C.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D),x.pixelStoreUnpackFlipY.setDefault(),x.pixelStoreUnpack.setDefault(),x.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(s,l,h){let{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),h!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=_.LINEAR),s!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,s),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,h||s),this.filter=s),l!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,l),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class eL{constructor(s,l,h,p=1,_=1,y=1,x=0){if(this.uid=s,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void zr(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;let C=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=_,this.blueFactor=y,this.baseShift=x;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<C;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(C,D)]=this.data[this._idx(C-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,C)]=this.data[this._idx(D,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<C;D++)for(let M=0;M<C;M++){let R=this.get(D,M);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(s,l){let h=new Uint8Array(this.data.buffer),p=4*this._idx(s,l);return this.unpack(h[p],h[p+1],h[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,l){if(s<-1||s>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError(`Out of range source coordinates for DEM data. x: ${s}, y: ${l}, dim: ${this.dim}`);return(l+1)*this.stride+(s+1)}unpack(s,l,h){return s*this.redFactor+l*this.greenFactor+h*this.blueFactor-this.baseShift}pack(s){return tL(s,this.getUnpackVector())}getPixels(){return new fs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,l,h){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,_=l*this.dim+this.dim,y=h*this.dim,x=h*this.dim+this.dim;switch(l){case-1:p=_-1;break;case 1:_=p+1}switch(h){case-1:y=x-1;break;case 1:x=y+1}let C=-l*this.dim,D=-h*this.dim;for(let M=y;M<x;M++)for(let R=p;R<_;R++)this.data[this._idx(R,M)]=s.data[this._idx(R+C,M+D)]}}function tL(c,s){let l=s[0],h=s[1],p=s[2],_=s[3],y=Math.min(l,h,p),x=Math.round((c+_)/y);return{r:Math.floor(x*y/l)%256,g:Math.floor(x*y/h)%256,b:Math.floor(x*y/p)%256}}wt("DEMData",eL);class g9 extends Ns{constructor(s,l){super(s,m9,l)}_createColorRamp(s){let l={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof im&&h._styleExpression.expression instanceof No){this.colorRampExpression=h;let y=h._styleExpression.expression;l.elevationStops=y.labels,l.colorStops=[];for(let x of l.elevationStops)l.colorStops.push(y.evaluate({globals:{elevation:x}}))}if(l.elevationStops.length<1&&(l.elevationStops=[0],l.colorStops=[_n.transparent]),l.elevationStops.length<2&&(l.elevationStops.push(l.elevationStops[0]+1),l.colorStops.push(l.colorStops[0])),l.elevationStops.length<=s)return l;let p={elevationStops:[],colorStops:[]},_=(l.elevationStops.length-1)/(s-1);for(let y=0;y<l.elevationStops.length-.5;y+=_)p.elevationStops.push(l.elevationStops[Math.round(y)]),p.colorStops.push(l.colorStops[Math.round(y)]);return zr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${s}, provided: ${l.elevationStops.length}`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(s,l,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;let p=this._createColorRamp(l),_=new fs({width:p.colorStops.length,height:1}),y=new fs({width:p.colorStops.length,height:1});for(let x=0;x<p.elevationStops.length;x++){let C=tL(p.elevationStops[x],h);y.setPixel(0,x,new _n(C.r/255,C.g/255,C.b/255,1)),_.setPixel(0,x,p.colorStops[x])}return this.colorRampTextures={elevationTexture:new GD(s,y,s.gl.RGBA),colorTexture:new GD(s,_,s.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return!this.isHidden()&&!!this.colorRampTextures}}let _9=ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:y9}=_9;function nx(c,s,l){let h=l.patternDependencies,p=!1;for(let _ of s){let y=_.paint.get(`${c}-pattern`);y.isConstant()||(p=!0);let x=y.constantOr(null);x&&(p=!0,h[x.to]=!0,h[x.from]=!0)}return p}function qD(c,s,l,h,p){let{zoom:_}=h,y=p.patternDependencies;for(let x of s){let C=x.paint.get(`${c}-pattern`).value;if(C.kind!=="constant"){let D=C.evaluate({zoom:_-1},l,{},p.availableImages),M=C.evaluate({zoom:_},l,{},p.availableImages),R=C.evaluate({zoom:_+1},l,{},p.availableImages);D=D&&D.name?D.name:D,M=M&&M.name?M.name:M,R=R&&R.name?R.name:R,y[D]=!0,y[M]=!0,y[R]=!0,l.patterns[x.id]={min:D,mid:M,max:R}}}return l}function nL(c,s,l,h,p){let _;if(p===(function(y,x,C,D){let M=0;for(let R=x,O=C-D;R<C;R+=D)M+=(y[O]-y[R])*(y[R+1]+y[O+1]),O=R;return M})(c,s,l,h)>0)for(let y=s;y<l;y+=h)_=sL(y/h|0,c[y],c[y+1],_);else for(let y=l-h;y>=s;y-=h)_=sL(y/h|0,c[y],c[y+1],_);return _&&Dm(_,_.next)&&(Oy(_),_=_.next),_}function df(c,s){if(!c)return c;s||(s=c);let l,h=c;do if(l=!1,h.steiner||!Dm(h,h.next)&&fr(h.prev,h,h.next)!==0)h=h.next;else{if(Oy(h),h=s=h.prev,h===h.next)break;l=!0}while(l||h!==s);return s}function Ry(c,s,l,h,p,_,y){if(!c)return;!y&&_&&(function(C,D,M,R){let O=C;do O.z===0&&(O.z=WD(O.x,O.y,D,M,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==C);O.prevZ.nextZ=null,O.prevZ=null,(function(F){let j,z=1;do{let H,Q=F;F=null;let le=null;for(j=0;Q;){j++;let ee=Q,ne=0;for(let me=0;me<z&&(ne++,ee=ee.nextZ,ee);me++);let de=z;for(;ne>0||de>0&&ee;)ne!==0&&(de===0||!ee||Q.z<=ee.z)?(H=Q,Q=Q.nextZ,ne--):(H=ee,ee=ee.nextZ,de--),le?le.nextZ=H:F=H,H.prevZ=le,le=H;Q=ee}le.nextZ=null,z*=2}while(j>1)})(O)})(c,h,p,_);let x=c;for(;c.prev!==c.next;){let C=c.prev,D=c.next;if(_?b9(c,h,p,_):v9(c))s.push(C.i,c.i,D.i),Oy(c),c=D.next,x=D.next;else if((c=D)===x){y?y===1?Ry(c=w9(df(c),s),s,l,h,p,_,2):y===2&&x9(c,s,l,h,p,_):Ry(df(c),s,l,h,p,_,1);break}}}function v9(c){let s=c.prev,l=c,h=c.next;if(fr(s,l,h)>=0)return!1;let p=s.x,_=l.x,y=h.x,x=s.y,C=l.y,D=h.y,M=Math.min(p,_,y),R=Math.min(x,C,D),O=Math.max(p,_,y),F=Math.max(x,C,D),j=h.next;for(;j!==s;){if(j.x>=M&&j.x<=O&&j.y>=R&&j.y<=F&&Py(p,x,_,C,y,D,j.x,j.y)&&fr(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function b9(c,s,l,h){let p=c.prev,_=c,y=c.next;if(fr(p,_,y)>=0)return!1;let x=p.x,C=_.x,D=y.x,M=p.y,R=_.y,O=y.y,F=Math.min(x,C,D),j=Math.min(M,R,O),z=Math.max(x,C,D),H=Math.max(M,R,O),Q=WD(F,j,s,l,h),le=WD(z,H,s,l,h),ee=c.prevZ,ne=c.nextZ;for(;ee&&ee.z>=Q&&ne&&ne.z<=le;){if(ee.x>=F&&ee.x<=z&&ee.y>=j&&ee.y<=H&&ee!==p&&ee!==y&&Py(x,M,C,R,D,O,ee.x,ee.y)&&fr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ne.x>=F&&ne.x<=z&&ne.y>=j&&ne.y<=H&&ne!==p&&ne!==y&&Py(x,M,C,R,D,O,ne.x,ne.y)&&fr(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;ee&&ee.z>=Q;){if(ee.x>=F&&ee.x<=z&&ee.y>=j&&ee.y<=H&&ee!==p&&ee!==y&&Py(x,M,C,R,D,O,ee.x,ee.y)&&fr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ne&&ne.z<=le;){if(ne.x>=F&&ne.x<=z&&ne.y>=j&&ne.y<=H&&ne!==p&&ne!==y&&Py(x,M,C,R,D,O,ne.x,ne.y)&&fr(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function w9(c,s){let l=c;do{let h=l.prev,p=l.next.next;!Dm(h,p)&&rL(h,l,l.next,p)&&Ny(h,p)&&Ny(p,h)&&(s.push(h.i,l.i,p.i),Oy(l),Oy(l.next),l=c=p),l=l.next}while(l!==c);return df(l)}function x9(c,s,l,h,p,_){let y=c;do{let x=y.next.next;for(;x!==y.prev;){if(y.i!==x.i&&D9(y,x)){let C=oL(y,x);return y=df(y,y.next),C=df(C,C.next),Ry(y,s,l,h,p,_,0),void Ry(C,s,l,h,p,_,0)}x=x.next}y=y.next}while(y!==c)}function E9(c,s){let l=c.x-s.x;return l===0&&(l=c.y-s.y,l===0)&&(l=(c.next.y-c.y)/(c.next.x-c.x)-(s.next.y-s.y)/(s.next.x-s.x)),l}function C9(c,s){let l=(function(p,_){let y=_,x=p.x,C=p.y,D,M=-1/0;if(Dm(p,y))return y;do{if(Dm(p,y.next))return y.next;if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){let z=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(z<=x&&z>M&&(M=z,D=y.x<y.next.x?y:y.next,z===x))return D}y=y.next}while(y!==_);if(!D)return null;let R=D,O=D.x,F=D.y,j=1/0;y=D;do{if(x>=y.x&&y.x>=O&&x!==y.x&&iL(C<F?x:M,C,O,F,C<F?M:x,C,y.x,y.y)){let z=Math.abs(C-y.y)/(x-y.x);Ny(y,p)&&(z<j||z===j&&(y.x>D.x||y.x===D.x&&T9(D,y)))&&(D=y,j=z)}y=y.next}while(y!==R);return D})(c,s);if(!l)return s;let h=oL(l,c);return df(h,h.next),df(l,l.next)}function T9(c,s){return fr(c.prev,c,s.prev)<0&&fr(s.next,c,c.next)<0}function WD(c,s,l,h,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-l)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-h)*p|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function S9(c){let s=c,l=c;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==c);return l}function iL(c,s,l,h,p,_,y,x){return(p-y)*(s-x)>=(c-y)*(_-x)&&(c-y)*(h-x)>=(l-y)*(s-x)&&(l-y)*(_-x)>=(p-y)*(h-x)}function Py(c,s,l,h,p,_,y,x){return!(c===y&&s===x)&&iL(c,s,l,h,p,_,y,x)}function D9(c,s){return c.next.i!==s.i&&c.prev.i!==s.i&&!(function(l,h){let p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==h.i&&p.next.i!==h.i&&rL(p,p.next,l,h))return!0;p=p.next}while(p!==l);return!1})(c,s)&&(Ny(c,s)&&Ny(s,c)&&(function(l,h){let p=l,_=!1,y=(l.x+h.x)/2,x=(l.y+h.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&y<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==l);return _})(c,s)&&(fr(c.prev,c,s.prev)||fr(c,s.prev,s))||Dm(c,s)&&fr(c.prev,c,c.next)>0&&fr(s.prev,s,s.next)>0)}function fr(c,s,l){return(s.y-c.y)*(l.x-s.x)-(s.x-c.x)*(l.y-s.y)}function Dm(c,s){return c.x===s.x&&c.y===s.y}function rL(c,s,l,h){let p=rx(fr(c,s,l)),_=rx(fr(c,s,h)),y=rx(fr(l,h,c)),x=rx(fr(l,h,s));return p!==_&&y!==x||!(p!==0||!ix(c,l,s))||!(_!==0||!ix(c,h,s))||!(y!==0||!ix(l,c,h))||!(x!==0||!ix(l,s,h))}function ix(c,s,l){return s.x<=Math.max(c.x,l.x)&&s.x>=Math.min(c.x,l.x)&&s.y<=Math.max(c.y,l.y)&&s.y>=Math.min(c.y,l.y)}function rx(c){return c>0?1:c<0?-1:0}function Ny(c,s){return fr(c.prev,c,c.next)<0?fr(c,s,c.next)>=0&&fr(c,c.prev,s)>=0:fr(c,s,c.prev)<0||fr(c,c.next,s)<0}function oL(c,s){let l=ZD(c.i,c.x,c.y),h=ZD(s.i,s.x,s.y),p=c.next,_=s.prev;return c.next=s,s.prev=c,l.next=p,p.prev=l,h.next=l,l.prev=h,_.next=h,h.prev=_,h}function sL(c,s,l,h){let p=ZD(c,s,l);return h?(p.next=h.next,p.prev=h,h.next.prev=p,h.next=p):(p.prev=p,p.next=p),p}function Oy(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function ZD(c,s,l){return{i:c,x:s,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Im{constructor(s,l){if(l>s)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=s,this._minGranularity=l}getGranularityForZoomLevel(s){return Math.max(Math.floor(this._baseZoomGranularity/(1<<s)),this._minGranularity,1)}}class ox{constructor(s){this.fill=s.fill,this.line=s.line,this.tile=s.tile,this.stencil=s.stencil,this.circle=s.circle}}ox.noSubdivision=new ox({fill:new Im(0,0),line:new Im(0,0),tile:new Im(0,0),stencil:new Im(0,0),circle:1}),wt("SubdivisionGranularityExpression",Im),wt("SubdivisionGranularitySetting",ox);let Mm=-32768,Fy=32767;class I9{constructor(s,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=s,this._granularityCellSize=ft/s,this._canonical=l}_getKey(s,l){return(s+=32768)<<16|l+32768}_vertexToIndex(s,l){if(s<-32768||l<-32768||s>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let h=0|Math.round(s),p=0|Math.round(l),_=this._getKey(h,p);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);let y=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,y),this._vertexBuffer.push(h,p),y}_subdivideTrianglesScanline(s){if(this._granularity<2)return(function(p,_){let y=[];for(let x=0;x<_.length;x+=3){let C=_[x],D=_[x+1],M=_[x+2],R=p[2*C],O=p[2*C+1];(p[2*D]-R)*(p[2*M+1]-O)-(p[2*D+1]-O)*(p[2*M]-R)>0?(y.push(C),y.push(M),y.push(D)):(y.push(C),y.push(D),y.push(M))}return y})(this._vertexBuffer,s);let l=[],h=s.length;for(let p=0;p<h;p+=3){let _=[s[p+0],s[p+1],s[p+2]],y=[this._vertexBuffer[2*s[p+0]+0],this._vertexBuffer[2*s[p+0]+1],this._vertexBuffer[2*s[p+1]+0],this._vertexBuffer[2*s[p+1]+1],this._vertexBuffer[2*s[p+2]+0],this._vertexBuffer[2*s[p+2]+1]],x=1/0,C=1/0,D=-1/0,M=-1/0;for(let z=0;z<3;z++){let H=y[2*z],Q=y[2*z+1];x=Math.min(x,H),D=Math.max(D,H),C=Math.min(C,Q),M=Math.max(M,Q)}if(x===D||C===M)continue;let R=Math.floor(x/this._granularityCellSize),O=Math.ceil(D/this._granularityCellSize),F=Math.floor(C/this._granularityCellSize),j=Math.ceil(M/this._granularityCellSize);if(R!==O||F!==j)for(let z=F;z<j;z++){let H=this._scanlineGenerateVertexRingForCellRow(z,y,_);M9(this._vertexBuffer,H,l)}else l.push(..._)}return l}_scanlineGenerateVertexRingForCellRow(s,l,h){let p=s*this._granularityCellSize,_=p+this._granularityCellSize,y=[];for(let x=0;x<3;x++){let C=l[2*x],D=l[2*x+1],M=l[2*(x+1)%6],R=l[(2*(x+1)+1)%6],O=l[2*(x+2)%6],F=l[(2*(x+2)+1)%6],j=M-C,z=R-D,H=j===0,Q=z===0,le=(p-D)/z,ee=(_-D)/z,ne=Math.min(le,ee),de=Math.max(le,ee);if(!Q&&(ne>=1||de<=0)||Q&&(D<p||D>_)){R>=p&&R<=_&&y.push(h[(x+1)%3]);continue}!Q&&ne>0&&y.push(this._vertexToIndex(C+j*ne,D+z*ne));let me=C+j*Math.max(ne,0),Ie=C+j*Math.min(de,1);H||this._generateIntraEdgeVertices(y,C,D,M,R,me,Ie),!Q&&de<1&&y.push(this._vertexToIndex(C+j*de,D+z*de)),(Q||R>=p&&R<=_)&&y.push(h[(x+1)%3]),!Q&&(R<=p||R>=_)&&this._generateInterEdgeVertices(y,C,D,M,R,O,F,Ie,p,_)}return y}_generateIntraEdgeVertices(s,l,h,p,_,y,x){let C=p-l,D=_-h,M=D===0,R=M?Math.min(l,p):Math.min(y,x),O=M?Math.max(l,p):Math.max(y,x),F=Math.floor(R/this._granularityCellSize)+1,j=Math.ceil(O/this._granularityCellSize)-1;if(M?l<p:y<x)for(let z=F;z<=j;z++){let H=z*this._granularityCellSize;s.push(this._vertexToIndex(H,h+D*(H-l)/C))}else for(let z=j;z>=F;z--){let H=z*this._granularityCellSize;s.push(this._vertexToIndex(H,h+D*(H-l)/C))}}_generateInterEdgeVertices(s,l,h,p,_,y,x,C,D,M){let R=_-h,O=y-p,F=x-_,j=(D-_)/F,z=(M-_)/F,H=Math.min(j,z),Q=Math.max(j,z),le=p+O*H,ee=Math.floor(Math.min(le,C)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(le,C)/this._granularityCellSize)-1,de=C<le,me=F===0;if(me&&(x===D||x===M))return;if(me||H>=1||Q<=0){let qe=h-x,He=y+(l-y)*Math.min((D-x)/qe,(M-x)/qe);ee=Math.floor(Math.min(He,C)/this._granularityCellSize)+1,ne=Math.ceil(Math.max(He,C)/this._granularityCellSize)-1,de=C<He}let Ie=R>0?M:D;if(de)for(let qe=ee;qe<=ne;qe++)s.push(this._vertexToIndex(qe*this._granularityCellSize,Ie));else for(let qe=ne;qe>=ee;qe--)s.push(this._vertexToIndex(qe*this._granularityCellSize,Ie))}_generateOutline(s){let l=[];for(let h of s){let p=hf(h,this._granularity,!0),_=this._pointArrayToIndices(p),y=[];for(let x=1;x<_.length;x++)y.push(_[x-1]),y.push(_[x]);l.push(y)}return l}_handlePoles(s){let l=!1,h=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(l||h)&&this._fillPoles(s,l,h)}_ensureNoPoleVertices(){let s=this._vertexBuffer;for(let l=0;l<s.length;l+=2){let h=s[l+1];h===Mm&&(s[l+1]=-32767),h===Fy&&(s[l+1]=32766)}}_generatePoleQuad(s,l,h,p,_,y){p>_!=(y===Mm)?(s.push(l),s.push(h),s.push(this._vertexToIndex(p,y)),s.push(h),s.push(this._vertexToIndex(_,y)),s.push(this._vertexToIndex(p,y))):(s.push(h),s.push(l),s.push(this._vertexToIndex(p,y)),s.push(this._vertexToIndex(_,y)),s.push(h),s.push(this._vertexToIndex(p,y)))}_fillPoles(s,l,h){let p=this._vertexBuffer,_=ft,y=s.length;for(let x=2;x<y;x+=3){let C=s[x-2],D=s[x-1],M=s[x],R=p[2*C],O=p[2*C+1],F=p[2*D],j=p[2*D+1],z=p[2*M],H=p[2*M+1];l&&(O===0&&j===0&&this._generatePoleQuad(s,C,D,R,F,Mm),j===0&&H===0&&this._generatePoleQuad(s,D,M,F,z,Mm),H===0&&O===0&&this._generatePoleQuad(s,M,C,z,R,Mm)),h&&(O===_&&j===_&&this._generatePoleQuad(s,C,D,R,F,Fy),j===_&&H===_&&this._generatePoleQuad(s,D,M,F,z,Fy),H===_&&O===_&&this._generatePoleQuad(s,M,C,z,R,Fy))}}_initializeVertices(s){for(let l=0;l<s.length;l+=2)this._vertexToIndex(s[l],s[l+1])}subdividePolygonInternal(s,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:h,holeIndices:p}=(function(x){let C=[],D=[];for(let M of x)if(M.length!==0){M!==x[0]&&C.push(D.length/2);for(let R=0;R<M.length;R++)D.push(M[R].x),D.push(M[R].y)}return{flattened:D,holeIndices:C}})(s),_;this._initializeVertices(h);try{let x=(function(D,M,R=2){let O=M&&M.length,F=O?M[0]*R:D.length,j=nL(D,0,F,R,!0),z=[];if(!j||j.next===j.prev)return z;let H,Q,le;if(O&&(j=(function(ee,ne,de,me){let Ie=[];for(let qe=0,He=ne.length;qe<He;qe++){let We=nL(ee,ne[qe]*me,qe<He-1?ne[qe+1]*me:ee.length,me,!1);We===We.next&&(We.steiner=!0),Ie.push(S9(We))}Ie.sort(E9);for(let qe=0;qe<Ie.length;qe++)de=C9(Ie[qe],de);return de})(D,M,j,R)),D.length>80*R){H=D[0],Q=D[1];let ee=H,ne=Q;for(let de=R;de<F;de+=R){let me=D[de],Ie=D[de+1];me<H&&(H=me),Ie<Q&&(Q=Ie),me>ee&&(ee=me),Ie>ne&&(ne=Ie)}le=Math.max(ee-H,ne-Q),le=le!==0?32767/le:0}return Ry(j,z,R,H,Q,le,0),z})(h,p),C=this._convertIndices(h,x);_=this._subdivideTrianglesScanline(C)}catch(x){console.error(x)}let y=[];return l&&(y=this._generateOutline(s)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:y}}_convertIndices(s,l){let h=[];for(let p=0;p<l.length;p++)h.push(this._vertexToIndex(s[2*l[p]],s[2*l[p]+1]));return h}_pointArrayToIndices(s){let l=[];for(let h=0;h<s.length;h++){let p=s[h];l.push(this._vertexToIndex(p.x,p.y))}return l}}function aL(c,s,l,h=!0){return new I9(l,s).subdividePolygonInternal(c,h)}function hf(c,s,l=!1){if(!c||c.length<1)return[];if(c.length<2)return[];let h=c[0],p=c[c.length-1],_=l&&(h.x!==p.x||h.y!==p.y);if(s<2)return _?[...c,c[0]]:[...c];let y=Math.floor(ft/s),x=[];x.push(new d(c[0].x,c[0].y));let C=c.length,D=_?C:C-1;for(let M=0;M<D;M++){let R=c[M],O=M<C-1?c[M+1]:c[0],F=R.x,j=R.y,z=O.x,H=O.y,Q=F!==z,le=j!==H;if(!Q&&!le)continue;let ee=z-F,ne=H-j,de=Math.abs(ee),me=Math.abs(ne),Ie=F,qe=j;for(;;){let We=ee>0?(Math.floor(Ie/y)+1)*y:(Math.ceil(Ie/y)-1)*y,lt=ne>0?(Math.floor(qe/y)+1)*y:(Math.ceil(qe/y)-1)*y,et=Math.abs(Ie-We),Le=Math.abs(qe-lt),Ne=Math.abs(Ie-z),_t=Math.abs(qe-H),pt=Q?et/de:Number.POSITIVE_INFINITY,xt=le?Le/me:Number.POSITIVE_INFINITY;if((Ne<=et||!Q)&&(_t<=Le||!le))break;if(pt<xt&&Q||!le){Ie=We,qe+=ne*pt;let mt=new d(Ie,Math.round(qe));x[x.length-1].x===mt.x&&x[x.length-1].y===mt.y||x.push(mt)}else{Ie+=ee*xt,qe=lt;let mt=new d(Math.round(Ie),qe);x[x.length-1].x===mt.x&&x[x.length-1].y===mt.y||x.push(mt)}}let He=new d(z,H);x[x.length-1].x===He.x&&x[x.length-1].y===He.y||x.push(He)}return x}function M9(c,s,l){if(s.length===0)throw new Error("Subdivision vertex ring is empty.");let h=0,p=c[2*s[0]];for(let C=1;C<s.length;C++){let D=c[2*s[C]];D<p&&(p=D,h=C)}let _=s.length,y=h,x=(y+1)%_;for(;;){let C=y-1>=0?y-1:_-1,D=(x+1)%_,M=c[2*s[C]],R=c[2*s[D]],O=c[2*s[y]],F=c[2*s[y]+1],j=c[2*s[x]+1],z=!1;if(M<R)z=!0;else if(M>R)z=!1;else{let H=j-F,Q=-(c[2*s[x]]-O),le=F<j?1:-1;((M-O)*H+(c[2*s[C]+1]-F)*Q)*le>((R-O)*H+(c[2*s[D]+1]-F)*Q)*le&&(z=!0)}if(z){let H=s[C],Q=s[y],le=s[x];H!==Q&&H!==le&&Q!==le&&l.push(le,Q,H),y--,y<0&&(y=_-1)}else{let H=s[D],Q=s[y],le=s[x];H!==Q&&H!==le&&Q!==le&&l.push(le,Q,H),x++,x>=_&&(x=0)}if(C===D)break}}function lL(c,s,l,h,p,_,y,x,C){let D=p.length/2,M=y&&x&&C;if(D<dt.MAX_VERTEX_ARRAY_LENGTH){let R=s.prepareSegment(D,l,h),O=R.vertexLength;for(let z=0;z<_.length;z+=3)h.emplaceBack(O+_[z],O+_[z+1],O+_[z+2]);let F,j;R.vertexLength+=D,R.primitiveLength+=_.length/3,M&&(j=y.prepareSegment(D,l,x),F=j.vertexLength,j.vertexLength+=D);for(let z=0;z<p.length;z+=2)c(p[z],p[z+1]);if(M)for(let z=0;z<C.length;z++){let H=C[z];for(let Q=1;Q<H.length;Q+=2)x.emplaceBack(F+H[Q-1],F+H[Q]);j.primitiveLength+=H.length/2}}else(function(R,O,F,j,z,H){let Q=[];for(let me=0;me<j.length/2;me++)Q.push(-1);let le={count:0},ee=0,ne=R.getOrCreateLatestSegment(O,F),de=ne.vertexLength;for(let me=2;me<z.length;me+=3){let Ie=z[me-2],qe=z[me-1],He=z[me],We=Q[Ie]<ee,lt=Q[qe]<ee,et=Q[He]<ee;ne.vertexLength+((We?1:0)+(lt?1:0)+(et?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(ne=R.createNewSegment(O,F),ee=le.count,We=!0,lt=!0,et=!0,de=0);let Le=Ly(Q,j,H,le,Ie,We,ne),Ne=Ly(Q,j,H,le,qe,lt,ne),_t=Ly(Q,j,H,le,He,et,ne);F.emplaceBack(de+Le-ee,de+Ne-ee,de+_t-ee),ne.primitiveLength++}})(s,l,h,p,_,c),M&&(function(R,O,F,j,z,H){let Q=[];for(let me=0;me<j.length/2;me++)Q.push(-1);let le={count:0},ee=0,ne=R.getOrCreateLatestSegment(O,F),de=ne.vertexLength;for(let me=0;me<z.length;me++){let Ie=z[me];for(let qe=1;qe<z[me].length;qe+=2){let He=Ie[qe-1],We=Ie[qe],lt=Q[He]<ee,et=Q[We]<ee;ne.vertexLength+((lt?1:0)+(et?1:0))>dt.MAX_VERTEX_ARRAY_LENGTH&&(ne=R.createNewSegment(O,F),ee=le.count,lt=!0,et=!0,de=0);let Le=Ly(Q,j,H,le,He,lt,ne),Ne=Ly(Q,j,H,le,We,et,ne);F.emplaceBack(de+Le-ee,de+Ne-ee),ne.primitiveLength++}}})(y,l,x,p,C,c),s.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function Ly(c,s,l,h,p,_,y){if(_){let x=h.count;return l(s[2*p],s[2*p+1]),c[p]=h.count,h.count++,y.vertexLength++,x}return c[p]}class KD{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new re,this.indexArray=new Re,this.indexArray2=new ot,this.programConfigurations=new Qc(s.layers,s.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,h){this.hasDependencies=nx("fill",this.layers,l);let p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),y=[];for(let{feature:x,id:C,index:D,sourceLayerIndex:M}of s){let R=this.layers[0]._featureFilter.needGeometry,O=Yl(x,R);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),O,h))continue;let F=_?p.evaluate(O,{},h,l.availableImages):void 0,j={id:C,properties:x.properties,type:x.type,sourceLayerIndex:M,index:D,geometry:R?O.geometry:Kl(x),patterns:{},sortKey:F};y.push(j)}_&&y.sort((x,C)=>x.sortKey-C.sortKey);for(let x of y){let{geometry:C,index:D,sourceLayerIndex:M}=x;if(this.hasDependencies){let R=qD("fill",this.layers,x,{zoom:this.zoom},l);this.patternFeatures.push(R)}else this.addFeature(x,C,D,h,{},l.subdivisionGranularity);l.featureIndex.insert(s[D].feature,C,D,M,this.index)}}update(s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:h})}addFeatures(s,l,h){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,h,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,y9),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,l,h,p,_,y){for(let x of qp(l,500)){let C=aL(x,p,y.fill.getGranularityForZoomLevel(p.z)),D=this.layoutVertexArray;lL((M,R)=>{D.emplaceBack(M,R)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{imagePositions:_,canonical:p})}}let cL,uL;wt("FillBucket",KD,{omit:["layers","patternFeatures"]});var A9={get paint(){return uL=uL||new Oo({"fill-antialias":new It(we.paint_fill["fill-antialias"]),"fill-opacity":new Vt(we.paint_fill["fill-opacity"]),"fill-color":new Vt(we.paint_fill["fill-color"]),"fill-outline-color":new Vt(we.paint_fill["fill-outline-color"]),"fill-translate":new It(we.paint_fill["fill-translate"]),"fill-translate-anchor":new It(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new nf(we.paint_fill["fill-pattern"])})},get layout(){return cL=cL||new Oo({"fill-sort-key":new Vt(we.layout_fill["fill-sort-key"])})}};class k9 extends Ns{constructor(s,l){super(s,A9,l)}recalculate(s,l){super.recalculate(s,l);let h=this.paint._values["fill-outline-color"];h.value.kind==="constant"&&h.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new KD(s)}queryRadius(){return ex(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:s,geometry:l,transform:h,pixelsToTileUnits:p}){return UF(tx(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,p),l)}isTileClipped(){return!0}}let R9=ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),P9=ir([{name:"a_centroid",components:2,type:"Int16"}],4),{members:N9}=R9;class By{constructor(s,l,h,p,_){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=p,this._values=_,s.readFields(O9,this,l)}loadGeometry(){let s=this._pbf;s.pos=this._geometry;let l=s.readVarint()+s.pos,h=[],p,_=1,y=0,x=0,C=0;for(;s.pos<l;){if(y<=0){let D=s.readVarint();_=7&D,y=D>>3}if(y--,_===1||_===2)x+=s.readSVarint(),C+=s.readSVarint(),_===1&&(p&&h.push(p),p=[]),p&&p.push(new d(x,C));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&h.push(p),h}bbox(){let s=this._pbf;s.pos=this._geometry;let l=s.readVarint()+s.pos,h=1,p=0,_=0,y=0,x=1/0,C=-1/0,D=1/0,M=-1/0;for(;s.pos<l;){if(p<=0){let R=s.readVarint();h=7&R,p=R>>3}if(p--,h===1||h===2)_+=s.readSVarint(),y+=s.readSVarint(),_<x&&(x=_),_>C&&(C=_),y<D&&(D=y),y>M&&(M=y);else if(h!==7)throw new Error(`unknown command ${h}`)}return[x,D,C,M]}toGeoJSON(s,l,h){let p=this.extent*Math.pow(2,h),_=this.extent*s,y=this.extent*l,x=this.loadGeometry();function C(O){return[360*(O.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+y)/p)*Math.PI))-90]}function D(O){return O.map(C)}let M;if(this.type===1){let O=[];for(let j of x)O.push(j[0]);let F=D(O);M=O.length===1?{type:"Point",coordinates:F[0]}:{type:"MultiPoint",coordinates:F}}else if(this.type===2){let O=x.map(D);M=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{let O=dL(x),F=[];for(let j of O)F.push(j.map(D));M=F.length===1?{type:"Polygon",coordinates:F[0]}:{type:"MultiPolygon",coordinates:F}}}let R={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(R.id=this.id),R}}function O9(c,s,l){c===1?s.id=l.readVarint():c===2?(function(h,p){let _=h.readVarint()+h.pos;for(;h.pos<_;){let y=p._keys[h.readVarint()],x=p._values[h.readVarint()];p.properties[y]=x}})(l,s):c===3?s.type=l.readVarint():c===4&&(s._geometry=l.pos)}function dL(c){let s=c.length;if(s<=1)return[c];let l=[],h,p;for(let _=0;_<s;_++){let y=F9(c[_]);y!==0&&(p===void 0&&(p=y<0),p===y<0?(h&&l.push(h),h=[c[_]]):h&&h.push(c[_]))}return h&&l.push(h),l}function F9(c){let s=0;for(let l,h,p=0,_=c.length,y=_-1;p<_;y=p++)l=c[p],h=c[y],s+=(h.x-l.x)*(l.y+h.y);return s}By.types=["Unknown","Point","LineString","Polygon"];class L9{constructor(s,l){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(B9,this,l),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];let l=this._pbf.readVarint()+this._pbf.pos;return new By(this._pbf,l,this.extent,this._keys,this._values)}}function B9(c,s,l){c===15?s.version=l.readVarint():c===1?s.name=l.readString():c===5?s.extent=l.readVarint():c===2?s._features.push(l.pos):c===3?s._keys.push(l.readString()):c===4&&s._values.push((function(h){let p=null,_=h.readVarint()+h.pos;for(;h.pos<_;){let y=h.readVarint()>>3;p=y===1?h.readString():y===2?h.readFloat():y===3?h.readDouble():y===4?h.readVarint64():y===5?h.readVarint():y===6?h.readSVarint():y===7?h.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(l))}class hL{constructor(s,l){this.layers=s.readFields(V9,{},l)}}function V9(c,s,l){if(c===3){let h=new L9(l,l.readVarint()+l.pos);h.length&&(s[h.name]=h)}}let YD=Math.pow(2,13);function Vy(c,s,l,h,p,_,y,x){c.emplaceBack(s,l,2*Math.floor(h*YD)+y,p*YD*2,_*YD*2,Math.round(x))}class XD{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasDependencies=!1,this.layoutVertexArray=new ue,this.centroidVertexArray=new ie,this.indexArray=new Re,this.programConfigurations=new Qc(s.layers,s.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,h){this.features=[],this.hasDependencies=nx("fill-extrusion",this.layers,l);for(let{feature:p,id:_,index:y,sourceLayerIndex:x}of s){let C=this.layers[0]._featureFilter.needGeometry,D=Yl(p,C);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),D,h))continue;let M={id:_,sourceLayerIndex:x,index:y,geometry:C?D.geometry:Kl(p),properties:p.properties,type:p.type,patterns:{}};this.hasDependencies?this.features.push(qD("fill-extrusion",this.layers,M,{zoom:this.zoom},l)):this.addFeature(M,M.geometry,y,h,{},l.subdivisionGranularity),l.featureIndex.insert(p,M.geometry,y,x,this.index,!0)}}addFeatures(s,l,h){for(let p of this.features){let{geometry:_}=p;this.addFeature(p,_,p.index,l,h,s.subdivisionGranularity)}}update(s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,N9),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,P9.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,l,h,p,_,y){for(let x of qp(l,500)){let C={x:0,y:0,sampleCount:0},D=this.layoutVertexArray.length;this.processPolygon(C,p,s,x,y);let M=this.layoutVertexArray.length-D,R=Math.floor(C.x/C.sampleCount),O=Math.floor(C.y/C.sampleCount);for(let F=0;F<M;F++)this.centroidVertexArray.emplaceBack(R,O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{imagePositions:_,canonical:p})}processPolygon(s,l,h,p,_){if(p.length<1||fL(p[0]))return;for(let R of p)R.length!==0&&j9(s,R);let y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},x=_.fill.getGranularityForZoomLevel(l.z),C=By.types[h.type]==="Polygon";for(let R of p){if(R.length===0||fL(R))continue;let O=hf(R,x,C);this._generateSideFaces(O,y)}if(!C)return;let D=aL(p,l,x,!1),M=this.layoutVertexArray;lL((R,O)=>{Vy(M,R,O,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,D.verticesFlattened,D.indicesTriangles)}_generateSideFaces(s,l){let h=0;for(let p=1;p<s.length;p++){let _=s[p],y=s[p-1];if(z9(_,y))continue;l.segment.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let x=_.sub(y)._perp()._unit(),C=y.dist(_);h+C>32768&&(h=0),Vy(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,0,h),Vy(this.layoutVertexArray,_.x,_.y,x.x,x.y,0,1,h),h+=C,Vy(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,0,h),Vy(this.layoutVertexArray,y.x,y.y,x.x,x.y,0,1,h);let D=l.segment.vertexLength;this.indexArray.emplaceBack(D,D+2,D+1),this.indexArray.emplaceBack(D+1,D+2,D+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function j9(c,s){for(let l=0;l<s.length;l++){let h=s[l];l===s.length-1&&s[0].x===h.x&&s[0].y===h.y||(c.x+=h.x,c.y+=h.y,c.sampleCount++)}}function z9(c,s){return c.x===s.x&&(c.x<0||c.x>ft)||c.y===s.y&&(c.y<0||c.y>ft)}function fL(c){return c.every(s=>s.x<0)||c.every(s=>s.x>ft)||c.every(s=>s.y<0)||c.every(s=>s.y>ft)}let pL;wt("FillExtrusionBucket",XD,{omit:["layers","features"]});var U9={get paint(){return pL=pL||new Oo({"fill-extrusion-opacity":new It(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Vt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new It(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new It(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nf(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Vt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Vt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new It(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $9 extends Ns{constructor(s,l){super(s,U9,l)}createBucket(s){return new XD(s)}queryRadius(){return ex(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:h,geometry:p,transform:_,pixelsToTileUnits:y,pixelPosMatrix:x}){let C=tx(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,y),D=this.paint.get("fill-extrusion-height").evaluate(l,h),M=this.paint.get("fill-extrusion-base").evaluate(l,h),R=(function(F,j){let z=[];for(let H of F){let Q=[H.x,H.y,0,1];$n(Q,Q,j),z.push(new d(Q[0]/Q[3],Q[1]/Q[3]))}return z})(C,x),O=(function(F,j,z,H){let Q=[],le=[],ee=H[8]*j,ne=H[9]*j,de=H[10]*j,me=H[11]*j,Ie=H[8]*z,qe=H[9]*z,He=H[10]*z,We=H[11]*z;for(let lt of F){let et=[],Le=[];for(let Ne of lt){let _t=Ne.x,pt=Ne.y,xt=H[0]*_t+H[4]*pt+H[12],mt=H[1]*_t+H[5]*pt+H[13],Rt=H[2]*_t+H[6]*pt+H[14],Pn=H[3]*_t+H[7]*pt+H[15],bn=Rt+de,Mi=Pn+me,wo=xt+Ie,br=mt+qe,Ai=Rt+He,vi=Pn+We,Un=new d((xt+ee)/Mi,(mt+ne)/Mi);Un.z=bn/Mi,et.push(Un);let Ki=new d(wo/vi,br/vi);Ki.z=Ai/vi,Le.push(Ki)}Q.push(et),le.push(Le)}return[Q,le]})(p,M,D,x);return(function(F,j,z){let H=1/0;UF(z,j)&&(H=mL(z,j[0]));for(let Q=0;Q<j.length;Q++){let le=j[Q],ee=F[Q];for(let ne=0;ne<le.length-1;ne++){let de=le[ne],me=[de,le[ne+1],ee[ne+1],ee[ne],de];Cm(z,me)&&(H=Math.min(H,mL(z,me)))}}return H!==1/0&&H})(O[0],O[1],R)}}function jy(c,s){return c.x*s.x+c.y*s.y}function mL(c,s){if(c.length===1){let l=0,h=s[l++],p;for(;!p||h.equals(p);)if(p=s[l++],!p)return 1/0;for(;l<s.length;l++){let _=s[l],y=c[0],x=p.sub(h),C=_.sub(h),D=y.sub(h),M=jy(x,x),R=jy(x,C),O=jy(C,C),F=jy(D,x),j=jy(D,C),z=M*O-R*R,H=(O*F-R*j)/z,Q=(M*j-R*F)/z,le=h.z*(1-H-Q)+p.z*H+_.z*Q;if(isFinite(le))return le}return 1/0}{let l=1/0;for(let h of s)l=Math.min(l,h.z);return l}}let H9=ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:G9}=H9,q9=ir([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:W9}=q9,Z9=Math.cos(Math.PI/180*37.5),gL=Math.pow(2,14)/.5;class QD{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(l=>l.id),this.index=s.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new ge,this.layoutVertexArray2=new ce,this.indexArray=new Re,this.programConfigurations=new Qc(s.layers,s.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(s,l,h){this.hasDependencies=nx("line",this.layers,l)||this.hasLineDasharray(this.layers);let p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),y=[];for(let{feature:x,id:C,index:D,sourceLayerIndex:M}of s){let R=this.layers[0]._featureFilter.needGeometry,O=Yl(x,R);if(!this.layers[0]._featureFilter.filter(new Xn(this.zoom),O,h))continue;let F=_?p.evaluate(O,{},h):void 0,j={id:C,properties:x.properties,type:x.type,sourceLayerIndex:M,index:D,geometry:R?O.geometry:Kl(x),patterns:{},dashes:{},sortKey:F};y.push(j)}_&&y.sort((x,C)=>x.sortKey-C.sortKey);for(let x of y){let{geometry:C,index:D,sourceLayerIndex:M}=x;this.hasDependencies?(nx("line",this.layers,l)?qD("line",this.layers,x,{zoom:this.zoom},l):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,x,this.zoom,l),this.patternFeatures.push(x)):this.addFeature(x,C,D,h,{},{},l.subdivisionGranularity),l.featureIndex.insert(s[D].feature,C,D,M,this.index)}}update(s,l,h,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,l,this.stateDependentLayers,{imagePositions:h,dashPositions:p})}addFeatures(s,l,h,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,l,h,p,s.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,W9)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,G9),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,l,h,p,_,y,x){let C=this.layers[0].layout,D=C.get("line-join").evaluate(s,{}),M=C.get("line-cap"),R=C.get("line-miter-limit"),O=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(let F of l)this.addLine(F,s,D,M,R,O,p,x);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,h,{imagePositions:_,dashPositions:y,canonical:p})}addLine(s,l,h,p,_,y,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,s=hf(s,x?C.line.getGranularityForZoomLevel(x.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<s.length-1;ee++)this.totalDistance+=s[ee].dist(s[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let D=By.types[l.type]==="Polygon",M=s.length;for(;M>=2&&s[M-1].equals(s[M-2]);)M--;let R=0;for(;R<M-1&&s[R].equals(s[R+1]);)R++;if(M<(D?3:2))return;h==="bevel"&&(_=1.05);let O=this.overscaling<=16?122880/(512*this.overscaling):0,F=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray),j,z,H,Q,le;this.e1=this.e2=-1,D&&(j=s[M-2],le=s[R].sub(j)._unit()._perp());for(let ee=R;ee<M;ee++){if(H=ee===M-1?D?s[R+1]:void 0:s[ee+1],H&&s[ee].equals(H))continue;le&&(Q=le),j&&(z=j),j=s[ee],le=H?H.sub(j)._unit()._perp():Q,Q=Q||le;let ne=Q.add(le);ne.x===0&&ne.y===0||ne._unit();let de=Q.x*le.x+Q.y*le.y,me=ne.x*le.x+ne.y*le.y,Ie=me!==0?1/me:1/0,qe=2*Math.sqrt(2-2*me),He=me<Z9&&z&&H,We=Q.x*le.y-Q.y*le.x>0;if(He&&ee>R){let Le=j.dist(z);if(Le>2*O){let Ne=j.sub(j.sub(z)._mult(O/Le)._round());this.updateDistance(z,Ne),this.addCurrentVertex(Ne,Q,0,0,F),z=Ne}}let lt=z&&H,et=lt?h:D?"butt":p;if(lt&&et==="round"&&(Ie<y?et="miter":Ie<=2&&(et="fakeround")),et==="miter"&&Ie>_&&(et="bevel"),et==="bevel"&&(Ie>2&&(et="flipbevel"),Ie<_&&(et="miter")),z&&this.updateDistance(z,j),et==="miter")ne._mult(Ie),this.addCurrentVertex(j,ne,0,0,F);else if(et==="flipbevel"){if(Ie>100)ne=le.mult(-1);else{let Le=Ie*Q.add(le).mag()/Q.sub(le).mag();ne._perp()._mult(Le*(We?-1:1))}this.addCurrentVertex(j,ne,0,0,F),this.addCurrentVertex(j,ne.mult(-1),0,0,F)}else if(et==="bevel"||et==="fakeround"){let Le=-Math.sqrt(Ie*Ie-1),Ne=We?Le:0,_t=We?0:Le;if(z&&this.addCurrentVertex(j,Q,Ne,_t,F),et==="fakeround"){let pt=Math.round(180*qe/Math.PI/20);for(let xt=1;xt<pt;xt++){let mt=xt/pt;if(mt!==.5){let Pn=mt-.5;mt+=mt*Pn*(mt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Pn*Pn+(.848013+de*(.215638*de-1.06021)))}let Rt=le.sub(Q)._mult(mt)._add(Q)._unit()._mult(We?-1:1);this.addHalfVertex(j,Rt.x,Rt.y,!1,We,0,F)}}H&&this.addCurrentVertex(j,le,-Ne,-_t,F)}else if(et==="butt")this.addCurrentVertex(j,ne,0,0,F);else if(et==="square"){let Le=z?1:-1;this.addCurrentVertex(j,ne,Le,Le,F)}else et==="round"&&(z&&(this.addCurrentVertex(j,Q,0,0,F),this.addCurrentVertex(j,Q,1,1,F,!0)),H&&(this.addCurrentVertex(j,le,-1,-1,F,!0),this.addCurrentVertex(j,le,0,0,F)));if(He&&ee<M-1){let Le=j.dist(H);if(Le>2*O){let Ne=j.add(H.sub(j)._mult(O/Le)._round());this.updateDistance(j,Ne),this.addCurrentVertex(Ne,le,0,0,F),j=Ne}}}}addCurrentVertex(s,l,h,p,_,y=!1){let x=l.y*p-l.x,C=-l.y-l.x*p;this.addHalfVertex(s,l.x+l.y*h,l.y-l.x*h,y,!1,h,_),this.addHalfVertex(s,x,C,y,!0,-p,_),this.distance>gL/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,l,h,p,_,y))}addHalfVertex({x:s,y:l},h,p,_,y,x,C){let D=.5*(this.lineClips?this.scaledDistance*(gL-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(_?1:0),(l<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let M=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),C.primitiveLength++),y?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,l){this.distance+=s.dist(l),this.updateScaledDistance()}hasLineDasharray(s){for(let l of s){let h=l.paint.get("line-dasharray");if(h&&!h.isConstant())return!0}return!1}addLineDashDependencies(s,l,h,p){for(let _ of s){let y=_.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;let x=_.layout.get("line-cap")==="round",C={dasharray:y.value.evaluate({zoom:h-1},l,{}),round:x},D={dasharray:y.value.evaluate({zoom:h},l,{}),round:x},M={dasharray:y.value.evaluate({zoom:h+1},l,{}),round:x},R=`${C.dasharray.join(",")},${C.round}`,O=`${D.dasharray.join(",")},${D.round}`,F=`${M.dasharray.join(",")},${M.round}`;p.dashDependencies[R]=C,p.dashDependencies[O]=D,p.dashDependencies[F]=M,l.dashes[_.id]={min:R,mid:O,max:F}}}}let _L,yL;wt("LineBucket",QD,{omit:["layers","patternFeatures"]});var vL={get paint(){return yL=yL||new Oo({"line-opacity":new Vt(we.paint_line["line-opacity"]),"line-color":new Vt(we.paint_line["line-color"]),"line-translate":new It(we.paint_line["line-translate"]),"line-translate-anchor":new It(we.paint_line["line-translate-anchor"]),"line-width":new Vt(we.paint_line["line-width"]),"line-gap-width":new Vt(we.paint_line["line-gap-width"]),"line-offset":new Vt(we.paint_line["line-offset"]),"line-blur":new Vt(we.paint_line["line-blur"]),"line-dasharray":new nf(we.paint_line["line-dasharray"]),"line-pattern":new nf(we.paint_line["line-pattern"]),"line-gradient":new gm(we.paint_line["line-gradient"])})},get layout(){return _L=_L||new Oo({"line-cap":new It(we.layout_line["line-cap"]),"line-join":new Vt(we.layout_line["line-join"]),"line-miter-limit":new It(we.layout_line["line-miter-limit"]),"line-round-limit":new It(we.layout_line["line-round-limit"]),"line-sort-key":new Vt(we.layout_line["line-sort-key"])})}};class K9 extends Vt{possiblyEvaluate(s,l){return l=new Xn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(s,l)}evaluate(s,l,h,p){return l=ur({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(s,l,h,p)}}let sx;class Y9 extends Ns{constructor(s,l){super(s,vL,l),this.gradientVersion=0,sx||(sx=new K9(vL.paint.properties["line-width"].specification),sx.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){let l=this.gradientExpression();this.stepInterpolant=!!(function(h){return h._styleExpression!==void 0})(l)&&l._styleExpression.expression instanceof zl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,l){super.recalculate(s,l),this.paint._values["line-floorwidth"]=sx.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new QD(s)}queryRadius(s){let l=s,h=bL(Sm("line-width",this,l),Sm("line-gap-width",this,l)),p=Sm("line-offset",this,l);return h/2+Math.abs(p)+ex(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:s,feature:l,featureState:h,geometry:p,transform:_,pixelsToTileUnits:y}){let x=tx(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,y),C=y/2*bL(this.paint.get("line-width").evaluate(l,h),this.paint.get("line-gap-width").evaluate(l,h)),D=this.paint.get("line-offset").evaluate(l,h);return D&&(p=(function(M,R){let O=[];for(let F=0;F<M.length;F++){let j=r9(M[F]),z=[];for(let H=0;H<j.length;H++){let Q=j[H],le=j[H-1],ee=j[H+1],ne=H===0?new d(0,0):Q.sub(le)._unit()._perp(),de=H===j.length-1?new d(0,0):ee.sub(Q)._unit()._perp(),me=ne._add(de)._unit(),Ie=me.x*de.x+me.y*de.y;Ie!==0&&me._mult(1/Ie),z.push(me._mult(R)._add(Q))}O.push(z)}return O})(p,D*y)),(function(M,R,O){for(let F=0;F<R.length;F++){let j=R[F];if(M.length>=3){for(let z=0;z<j.length;z++)if(Tm(M,j[z]))return!0}if(t9(M,j,O))return!0}return!1})(x,p,C)}isTileClipped(){return!0}}function bL(c,s){return s>0?s+2*c:c}let X9=ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q9=ir([{name:"a_projected_pos",components:3,type:"Float32"}],4);ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let J9=ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ir([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let wL=ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eZ=ir([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function tZ(c,s,l){return c.sections.forEach(h=>{h.text=(function(p,_,y){let x=_.layout.get("text-transform").evaluate(y,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),ql.applyArabicShaping&&(p=ql.applyArabicShaping(p)),p})(h.text,s,l)}),c}ir([{name:"triangle",components:3,type:"Uint16"}]),ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ir([{type:"Float32",name:"offsetX"}]),ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ir([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Hr=24;let zy={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u22EF":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},nZ={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},iZ={40:!0};function xL(c,s,l,h,p,_){if("fontStack"in s){let y=l[s.fontStack],x=y&&y[c];return x?x.metrics.advance*s.scale+p:0}{let y=h[s.imageName];return y?y.displaySize[0]*s.scale*Hr/_+p:0}}function EL(c,s,l,h){let p=Math.pow(c-s,2);return h?c<s?p/2:2*p:p+Math.abs(l)*l}function rZ(c,s,l){let h=0;return c===10&&(h-=1e4),l&&(h+=150),c!==40&&c!==65288||(h+=50),s!==41&&s!==65289||(h+=50),h}function CL(c,s,l,h,p,_){let y=null,x=EL(s,l,p,_);for(let C of h){let D=EL(s-C.x,l,p,_)+C.badness;D<=x&&(y=C,x=D)}return{index:c,x:s,priorBreak:y,badness:x}}function TL(c){return c?TL(c.priorBreak).concat(c.index):[]}class Am{constructor(s="",l=[],h=[]){this.text=s,this.sections=l,this.sectionIndex=h,this.imageSectionID=null}static fromFeature(s,l){let h=new Am;for(let p=0;p<s.sections.length;p++){let _=s.sections[p];_.image?h.addImageSection(_):h.addTextSection(_,l)}return h}length(){return[...this.text].length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}verticalizePunctuation(){this.text=(function(s){let l="",h={premature:!0,value:void 0},p=s[Symbol.iterator](),_=p.next(),y=s[Symbol.iterator]();y.next();let x=y.next();for(;!_.done;)l+=!x.done&&_y(x.value.codePointAt(0))&&!zy[x.value]||!h.premature&&_y(h.value.codePointAt(0))&&!zy[h.value]||!zy[_.value]?_.value:zy[_.value],h={value:_.value,premature:!1},_=p.next(),x=y.next();return l})(this.text)}hasZeroWidthSpaces(){return this.text.includes("\u200B")}trim(){let s=this.text.match(/^\s*/),l=s?s[0].length:0,h=this.text.match(/\S\s*$/),p=h?h[0].length-1:0;this.text=this.text.substring(l,this.text.length-p),this.sectionIndex=this.sectionIndex.slice(l,this.sectionIndex.length-p)}substring(s,l){let h=[...this.text].slice(s,l).join(""),p=this.sectionIndex.slice(s,l);return new Am(h,this.sections,p)}toCodeUnitIndex(s){return[...this.text].slice(0,s).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,l)=>Math.max(s,this.sections[l].scale),0)}getMaxImageSize(s){let l=0,h=0;for(let p=0;p<this.length();p++){let _=this.getSection(p);if("imageName"in _){let y=s[_.imageName];if(!y)continue;let x=y.displaySize;l=Math.max(l,x[0]),h=Math.max(h,x[1])}}return{maxImageWidth:l,maxImageHeight:h}}addTextSection(s,l){this.text+=s.text,this.sections.push({scale:s.scale||1,verticalAlign:s.verticalAlign||"bottom",fontStack:s.fontStack||l});let h=this.sections.length-1;this.sectionIndex.push(...[...s.text].map(()=>h))}addImageSection(s){let l=s.image?s.image.name:"";if(l.length===0)return void zr("Can't add FormattedSection with an empty image.");let h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push({scale:1,verticalAlign:s.verticalAlign||"bottom",imageName:l}),this.sectionIndex.push(this.sections.length-1)):zr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(s,l,h,p,_){let y=[],x=this.determineAverageLineWidth(s,l,h,p,_),C=this.hasZeroWidthSpaces(),D=0,M=0,R=this.text[Symbol.iterator](),O=R.next(),F=this.text[Symbol.iterator]();F.next();let j=F.next(),z=this.text[Symbol.iterator]();z.next(),z.next();let H=z.next();for(;!O.done;){let Q=this.getSection(M),le=O.value.codePointAt(0);if(Uw(le)||(D+=xL(le,Q,h,p,s,_)),!j.done){let ee=Jh(le),ne=j.value.codePointAt(0);(nZ[le]||ee||"imageName"in Q||!H.done&&iZ[ne])&&y.push(CL(M+1,D,x,y,rZ(le,ne,ee&&C),!1))}M++,O=R.next(),j=F.next(),H=z.next()}return TL(CL(this.length(),D,x,y,0,!0))}determineAverageLineWidth(s,l,h,p,_){let y=0,x=0;for(let C of this.text){let D=this.getSection(x);y+=xL(C.codePointAt(0),D,h,p,s,_),x++}return y/Math.max(1,Math.ceil(y/l))}}let JD=4294967296,SL=1/JD,DL=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class ax{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,l,h=this.length){for(;this.pos<h;){let p=this.readVarint(),_=p>>3,y=this.pos;this.type=7&p,s(_,l,this),this.pos===y&&this.skip(p)}return l}readMessage(s,l){return this.readFields(s,l,this.readVarint()+this.pos)}readFixed32(){let s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){let s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){let s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*JD;return this.pos+=8,s}readSFixed64(){let s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*JD;return this.pos+=8,s}readFloat(){let s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){let s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){let l=this.buf,h,p;return p=l[this.pos++],h=127&p,p<128?h:(p=l[this.pos++],h|=(127&p)<<7,p<128?h:(p=l[this.pos++],h|=(127&p)<<14,p<128?h:(p=l[this.pos++],h|=(127&p)<<21,p<128?h:(p=l[this.pos],h|=(15&p)<<28,(function(_,y,x){let C=x.buf,D,M;if(M=C[x.pos++],D=(112&M)>>4,M<128||(M=C[x.pos++],D|=(127&M)<<3,M<128)||(M=C[x.pos++],D|=(127&M)<<10,M<128)||(M=C[x.pos++],D|=(127&M)<<17,M<128)||(M=C[x.pos++],D|=(127&M)<<24,M<128)||(M=C[x.pos++],D|=(1&M)<<31,M<128))return km(_,D,y);throw new Error("Expected varint not more than 10 bytes")})(h,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){let s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){let s=this.readVarint()+this.pos,l=this.pos;return this.pos=s,s-l>=12&&DL?DL.decode(this.buf.subarray(l,s)):(function(h,p,_){let y="",x=p;for(;x<_;){let C=h[x],D,M,R,O=null,F=C>239?4:C>223?3:C>191?2:1;if(x+F>_)break;F===1?C<128&&(O=C):F===2?(D=h[x+1],(192&D)==128&&(O=(31&C)<<6|63&D,O<=127&&(O=null))):F===3?(D=h[x+1],M=h[x+2],(192&D)==128&&(192&M)==128&&(O=(15&C)<<12|(63&D)<<6|63&M,(O<=2047||O>=55296&&O<=57343)&&(O=null))):F===4&&(D=h[x+1],M=h[x+2],R=h[x+3],(192&D)==128&&(192&M)==128&&(192&R)==128&&(O=(15&C)<<18|(63&D)<<12|(63&M)<<6|63&R,(O<=65535||O>=1114112)&&(O=null))),O===null?(O=65533,F=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),x+=F}return y})(this.buf,l,s)}readBytes(){let s=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,s);return this.pos=s,l}readPackedVarint(s=[],l){let h=this.readPackedEnd();for(;this.pos<h;)s.push(this.readVarint(l));return s}readPackedSVarint(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFloat());return s}readPackedDouble(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){let l=this.readPackedEnd();for(;this.pos<l;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){let l=7&s;if(l===0)for(;this.buf[this.pos++]>127;);else if(l===2)this.pos=this.readVarint()+this.pos;else if(l===5)this.pos+=4;else{if(l!==1)throw new Error(`Unimplemented type: ${l}`);this.pos+=8}}writeTag(s,l){this.writeVarint(s<<3|l)}realloc(s){let l=this.length||16;for(;l<this.pos+s;)l*=2;if(l!==this.length){let h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=l}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*SL),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*SL),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?(function(l,h){let p,_;if(l>=0?(p=l%4294967296|0,_=l/4294967296|0):(p=~(-l%4294967296),_=~(-l/4294967296),4294967295^p?p=p+1|0:(p=0,_=_+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),(function(y,x,C){C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,y>>>=7,C.buf[C.pos++]=127&y|128,C.buf[C.pos]=127&(y>>>=7)})(p,0,h),(function(y,x){let C=(7&y)<<4;x.buf[x.pos++]|=C|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))})(_,h)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;let l=this.pos;this.pos=(function(p,_,y){for(let x,C,D=0;D<_.length;D++){if(x=_.charCodeAt(D),x>55295&&x<57344){if(!C){x>56319||D+1===_.length?(p[y++]=239,p[y++]=191,p[y++]=189):C=x;continue}if(x<56320){p[y++]=239,p[y++]=191,p[y++]=189,C=x;continue}x=C-55296<<10|x-56320|65536,C=null}else C&&(p[y++]=239,p[y++]=191,p[y++]=189,C=null);x<128?p[y++]=x:(x<2048?p[y++]=x>>6|192:(x<65536?p[y++]=x>>12|224:(p[y++]=x>>18|240,p[y++]=x>>12&63|128),p[y++]=x>>6&63|128),p[y++]=63&x|128)}return y})(this.buf,s,this.pos);let h=this.pos-l;h>=128&&IL(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){let l=s.length;this.writeVarint(l),this.realloc(l);for(let h=0;h<l;h++)this.buf[this.pos++]=s[h]}writeRawMessage(s,l){this.pos++;let h=this.pos;s(l,this);let p=this.pos-h;p>=128&&IL(h,p,this),this.pos=h-1,this.writeVarint(p),this.pos+=p}writeMessage(s,l,h){this.writeTag(s,2),this.writeRawMessage(l,h)}writePackedVarint(s,l){l.length&&this.writeMessage(s,oZ,l)}writePackedSVarint(s,l){l.length&&this.writeMessage(s,sZ,l)}writePackedBoolean(s,l){l.length&&this.writeMessage(s,cZ,l)}writePackedFloat(s,l){l.length&&this.writeMessage(s,aZ,l)}writePackedDouble(s,l){l.length&&this.writeMessage(s,lZ,l)}writePackedFixed32(s,l){l.length&&this.writeMessage(s,uZ,l)}writePackedSFixed32(s,l){l.length&&this.writeMessage(s,dZ,l)}writePackedFixed64(s,l){l.length&&this.writeMessage(s,hZ,l)}writePackedSFixed64(s,l){l.length&&this.writeMessage(s,fZ,l)}writeBytesField(s,l){this.writeTag(s,2),this.writeBytes(l)}writeFixed32Field(s,l){this.writeTag(s,5),this.writeFixed32(l)}writeSFixed32Field(s,l){this.writeTag(s,5),this.writeSFixed32(l)}writeFixed64Field(s,l){this.writeTag(s,1),this.writeFixed64(l)}writeSFixed64Field(s,l){this.writeTag(s,1),this.writeSFixed64(l)}writeVarintField(s,l){this.writeTag(s,0),this.writeVarint(l)}writeSVarintField(s,l){this.writeTag(s,0),this.writeSVarint(l)}writeStringField(s,l){this.writeTag(s,2),this.writeString(l)}writeFloatField(s,l){this.writeTag(s,5),this.writeFloat(l)}writeDoubleField(s,l){this.writeTag(s,1),this.writeDouble(l)}writeBooleanField(s,l){this.writeVarintField(s,+l)}}function km(c,s,l){return l?4294967296*s+(c>>>0):4294967296*(s>>>0)+(c>>>0)}function IL(c,s,l){let h=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(h);for(let p=l.pos-1;p>=c;p--)l.buf[p+h]=l.buf[p]}function oZ(c,s){for(let l=0;l<c.length;l++)s.writeVarint(c[l])}function sZ(c,s){for(let l=0;l<c.length;l++)s.writeSVarint(c[l])}function aZ(c,s){for(let l=0;l<c.length;l++)s.writeFloat(c[l])}function lZ(c,s){for(let l=0;l<c.length;l++)s.writeDouble(c[l])}function cZ(c,s){for(let l=0;l<c.length;l++)s.writeBoolean(c[l])}function uZ(c,s){for(let l=0;l<c.length;l++)s.writeFixed32(c[l])}function dZ(c,s){for(let l=0;l<c.length;l++)s.writeSFixed32(c[l])}function hZ(c,s){for(let l=0;l<c.length;l++)s.writeFixed64(c[l])}function fZ(c,s){for(let l=0;l<c.length;l++)s.writeSFixed64(c[l])}function pZ(c,s,l){c===1&&l.readMessage(mZ,s)}function mZ(c,s,l){if(c===3){let{id:h,bitmap:p,width:_,height:y,left:x,top:C,advance:D}=l.readMessage(gZ,{});s.push({id:h,bitmap:new ky({width:_+6,height:y+6},p),metrics:{width:_,height:y,left:x,top:C,advance:D}})}}function gZ(c,s,l){c===1?s.id=l.readVarint():c===2?s.bitmap=l.readBytes():c===3?s.width=l.readVarint():c===4?s.height=l.readVarint():c===5?s.left=l.readSVarint():c===6?s.top=l.readSVarint():c===7&&(s.advance=l.readVarint())}function ML(c){let s=0,l=0;for(let y of c)s+=y.w*y.h,l=Math.max(l,y.w);c.sort((y,x)=>x.h-y.h);let h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],p=0,_=0;for(let y of c)for(let x=h.length-1;x>=0;x--){let C=h[x];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,_=Math.max(_,y.y+y.h),p=Math.max(p,y.x+y.w),y.w===C.w&&y.h===C.h){let D=h.pop();D&&x<h.length&&(h[x]=D)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(h.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:p,h:_,fill:s/(p*_)||0}}class eI{constructor(s,{pixelRatio:l,version:h,stretchX:p,stretchY:_,content:y,textFitWidth:x,textFitHeight:C}){this.paddedRect=s,this.pixelRatio=l,this.stretchX=p,this.stretchY=_,this.content=y,this.version=h,this.textFitWidth=x,this.textFitHeight=C}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class AL{constructor(s,l){let h={},p={};this.haveRenderCallbacks=[];let _=[];this.addImages(s,h,_),this.addImages(l,p,_);let{w:y,h:x}=ML(_),C=new fs({width:y||1,height:x||1});for(let D in s){let M=s[D],R=h[D].paddedRect;fs.copy(M.data,C,{x:0,y:0},{x:R.x+1,y:R.y+1},M.data)}for(let D in l){let M=l[D],R=p[D].paddedRect,O=R.x+1,F=R.y+1,j=M.data.width,z=M.data.height;fs.copy(M.data,C,{x:0,y:0},{x:O,y:F},M.data),fs.copy(M.data,C,{x:0,y:z-1},{x:O,y:F-1},{width:j,height:1}),fs.copy(M.data,C,{x:0,y:0},{x:O,y:F+z},{width:j,height:1}),fs.copy(M.data,C,{x:j-1,y:0},{x:O-1,y:F},{width:1,height:z}),fs.copy(M.data,C,{x:0,y:0},{x:O+j,y:F},{width:1,height:z})}this.image=C,this.iconPositions=h,this.patternPositions=p}addImages(s,l,h){for(let p in s){let _=s[p],y={x:0,y:0,w:_.data.width+2,h:_.data.height+2};h.push(y),l[p]=new eI(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(s,l){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let h in s.updatedImages)this.patchUpdatedImage(this.iconPositions[h],s.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],s.getImage(h),l)}patchUpdatedImage(s,l,h){if(!s||!l||s.version===l.version)return;s.version=l.version;let[p,_]=s.tl;h.update(l.data,void 0,{x:p,y:_})}}var gd;function lx(c,s,l,h,p,_,y,x,C,D,M,R,O,F,j){let z=Am.fromFeature(c,p),H;R===r.az.vertical&&z.verticalizePunctuation();let Q=z.determineLineBreaks(D,_,s,h,F),{processBidirectionalText:le,processStyledBidirectionalText:ee}=ql;if(le&&z.sections.length===1){H=[],Q=Q.map(Ie=>z.toCodeUnitIndex(Ie));let me=le(z.toString(),Q);for(let Ie of me){let qe=[...Ie].map(()=>0);H.push(new Am(Ie,z.sections,qe))}}else if(ee){H=[],Q=Q.map(He=>z.toCodeUnitIndex(He));let me=0,Ie=[];for(let He of z.text)Ie.push(...Array(He.length).fill(z.sectionIndex[me])),me++;let qe=ee(z.text,Ie,Q);for(let He of qe){let We=[],lt="";for(let et of He[0])We.push(He[1][lt.length]),lt+=et;H.push(new Am(He[0],z.sections,We))}}else H=(function(me,Ie){let qe=[],He=0;for(let We of Ie)qe.push(me.substring(He,We)),He=We;return He<me.length()&&qe.push(me.substring(He,me.length())),qe})(z,Q);let ne=[],de={positionedLines:ne,text:z.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:R,iconsInText:!1,verticalizable:!1};return(function(me,Ie,qe,He,We,lt,et,Le,Ne,_t,pt,xt){let mt=0,Rt=0,Pn=0,bn=0,Mi=Le==="right"?1:Le==="left"?0:.5,wo=Hr/xt,br=0;for(let Un of We){Un.trim();let Ki=Un.getMaxScale(),or={positionedGlyphs:[],lineOffset:0};me.positionedLines[br]=or;let pi=or.positionedGlyphs,ps=0;if(!Un.length()){Rt+=lt,++br;continue}let xo=_Z(He,Un,wo),ms=0;for(let Wr of Un.text){let Li=Un.getSection(ms),wr=Wr.codePointAt(0),Yi=yZ(Ne,pt,wr),Zr={glyph:wr,imageName:null,x:mt,y:Rt+-17,vertical:Yi,scale:1,fontStack:"",sectionIndex:Un.getSectionIndex(ms),metrics:null,rect:null},tu;if("fontStack"in Li){if(tu=vZ(Li,wr,Yi,xo,Ie,qe),!tu)continue;Zr.fontStack=Li.fontStack}else{if(me.iconsInText=!0,Li.scale*=wo,tu=bZ(Li,Yi,Ki,xo,He),!tu)continue;ps=Math.max(ps,tu.imageOffset),Zr.imageName=Li.imageName}let{rect:al,metrics:Zy,baselineOffset:wd}=tu;Zr.y+=wd,Zr.scale=Li.scale,Zr.metrics=Zy,Zr.rect=al,pi.push(Zr),Yi?(me.verticalizable=!0,mt+=("imageName"in Li?Zy.advance:Hr)*Li.scale+_t):mt+=Zy.advance*Li.scale+_t,ms++}pi.length!==0&&(Pn=Math.max(mt-_t,Pn),wZ(pi,0,pi.length-1,Mi)),mt=0,or.lineOffset=Math.max(ps,(Ki-1)*Hr);let Da=lt*Ki+ps;Rt+=Da,bn=Math.max(Da,bn),++br}let{horizontalAlign:Ai,verticalAlign:vi}=tI(et);(function(Un,Ki,or,pi,ps,xo,ms,Da,Wr){let Li=(Ki-or)*ps,wr=0;wr=xo!==ms?-Da*pi- -17:-pi*Wr*ms+.5*ms;for(let Yi of Un)for(let Zr of Yi.positionedGlyphs)Zr.x+=Li,Zr.y+=wr})(me.positionedLines,Mi,Ai,vi,Pn,bn,lt,Rt,We.length),me.top+=-vi*Rt,me.bottom=me.top+Rt,me.left+=-Ai*Pn,me.right=me.left+Pn})(de,s,l,h,H,y,x,C,R,D,O,j),!(function(me){for(let Ie of me)if(Ie.positionedGlyphs.length!==0)return!1;return!0})(ne)&&de}function tI(c){let s=.5,l=.5;switch(c){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function _Z(c,s,l){let h=s.getMaxScale()*Hr,{maxImageWidth:p,maxImageHeight:_}=s.getMaxImageSize(c),y=Math.max(h,_*l);return{verticalLineContentWidth:Math.max(h,p*l),horizontalLineContentHeight:y}}function kL(c){switch(c){case"top":return 0;case"center":return .5;default:return 1}}function yZ(c,s,l){return!(c===r.az.horizontal||!s&&!gy(l)||s&&(Uw(l)||(h=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function vZ(c,s,l,h,p,_){let y=_[c.fontStack],x=(function(D,M,R,O){if(D&&D.rect)return D;let F=M[R.fontStack],j=F&&F[O];return j?{rect:null,metrics:j.metrics}:null})(y&&y[s],p,c,s);if(x===null)return null;let C;if(l)C=h.verticalLineContentWidth-c.scale*Hr;else{let D=kL(c.verticalAlign);C=(h.horizontalLineContentHeight-c.scale*Hr)*D}return{rect:x.rect,metrics:x.metrics,baselineOffset:C}}function bZ(c,s,l,h,p){let _=p[c.imageName];if(!_)return null;let y=_.paddedRect,x=_.displaySize,C={width:x[0],height:x[1],left:1,top:-3,advance:s?x[1]:x[0]},D;if(s)D=h.verticalLineContentWidth-x[1]*c.scale;else{let M=kL(c.verticalAlign);D=(h.horizontalLineContentHeight-x[1]*c.scale)*M}return{rect:y,metrics:C,baselineOffset:D,imageOffset:(s?x[0]:x[1])*c.scale-Hr*l}}function wZ(c,s,l,h){if(h===0)return;let p=c[l],_=(c[l].x+p.metrics.advance*p.scale)*h;for(let y=s;y<=l;y++)c[y].x-=_}function xZ(c,s,l){let{horizontalAlign:h,verticalAlign:p}=tI(l),_=s[0]-c.displaySize[0]*h,y=s[1]-c.displaySize[1]*p;return{image:c,top:y,bottom:y+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function RL(c){var s,l;let h=c.left,p=c.top,_=c.right-h,y=c.bottom-p,x=(s=c.image.textFitWidth)!==null&&s!==void 0?s:"stretchOrShrink",C=(l=c.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",D=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(C==="proportional"){if(x==="stretchOnly"&&_/y<D||x==="proportional"){let M=Math.ceil(y*D);h*=M/_,_=M}}else if(x==="proportional"&&C==="stretchOnly"&&D!==0&&_/y>D){let M=Math.ceil(_/D);p*=M/y,y=M}return{x1:h,y1:p,x2:h+_,y2:p+y}}function PL(c,s,l,h,p,_){let y=c.image,x;if(y.content){let H=y.content,Q=y.pixelRatio||1;x=[H[0]/Q,H[1]/Q,y.displaySize[0]-H[2]/Q,y.displaySize[1]-H[3]/Q]}let C=s.left*_,D=s.right*_,M,R,O,F;l==="width"||l==="both"?(F=p[0]+C-h[3],R=p[0]+D+h[1]):(F=p[0]+(C+D-y.displaySize[0])/2,R=F+y.displaySize[0]);let j=s.top*_,z=s.bottom*_;return l==="height"||l==="both"?(M=p[1]+j-h[0],O=p[1]+z+h[2]):(M=p[1]+(j+z-y.displaySize[1])/2,O=M+y.displaySize[1]),{image:y,top:M,right:R,bottom:O,left:F,collisionPadding:x}}wt("ImagePosition",eI),wt("ImageAtlas",AL),r.az=void 0,(gd=r.az||(r.az={}))[gd.none=0]="none",gd[gd.horizontal=1]="horizontal",gd[gd.vertical=2]="vertical",gd[gd.horizontalOnly=3]="horizontalOnly";let Jc=128,_d=32640;function NL(c,s){let{expression:l}=s;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Xn(c+1))};if(l.kind==="source")return{kind:"source"};{let{zoomStops:h,interpolationType:p}=l,_=0;for(;_<h.length&&h[_]<=c;)_++;_=Math.max(0,_-1);let y=_;for(;y<h.length&&h[y]<c+1;)y++;y=Math.min(h.length-1,y);let x=h[_],C=h[y];return l.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:C,minSize:l.evaluate(new Xn(x)),maxSize:l.evaluate(new Xn(C)),interpolationType:p}}}function nI(c,s,l){let h="never",p=c.get(s);return p?h=p:c.get(l)&&(h="always"),h}let EZ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cx(c,s,l,h,p,_,y,x,C,D,M,R,O){let F=x?Math.min(_d,Math.round(x[0])):0,j=x?Math.min(_d,Math.round(x[1])):0;c.emplaceBack(s,l,Math.round(32*h),Math.round(32*p),_,y,(F<<1)+(C?1:0),j,16*D,16*M,256*R,256*O)}function iI(c,s,l){c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l),c.emplaceBack(s.x,s.y,l)}function CZ(c){for(let s of c.sections)if(Gw(s.text))return!0;return!1}class rI{constructor(s){this.layoutVertexArray=new he,this.indexArray=new Re,this.programConfigurations=s,this.segments=new dt,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Pe,this.hasVisibleVertices=!1,this.placedSymbolArray=new E}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,l,h,p){this.isEmpty()||(h&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,X9.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Q9.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,EZ,!0),this.opacityVertexBuffer.itemSize=1),(h||p)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}wt("SymbolBuffers",rI);class oI{constructor(s,l,h){this.layoutVertexArray=new s,this.layoutAttributes=l,this.indexArray=new h,this.segments=new dt,this.collisionVertexArray=new ke}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,J9.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}wt("CollisionBuffers",oI);class Rm{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(y=>y.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=NL(this.zoom,l["text-size"]),this.iconSizeData=NL(this.zoom,l["icon-size"]);let h=this.layers[0].layout,p=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=nI(h,"text-overlap","text-allow-overlap")!=="never"||nI(h,"icon-overlap","icon-allow-overlap")!=="never"||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,h.get("symbol-placement")==="point"&&(this.writingModes=h.get("text-writing-mode").map(y=>r.az[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=s.sourceID}createArrays(){this.text=new rI(new Qc(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new rI(new Qc(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new k,this.lineVertexArray=new P,this.symbolInstances=new I,this.textAnchorOffsets=new L}calculateGlyphDependencies(s,l,h,p,_){for(let y of s)if(l[y.codePointAt(0)]=!0,(h||p)&&_){let x=zy[y];x&&(l[x.codePointAt(0)]=!0)}}populate(s,l,h){let p=this.layers[0],_=p.layout,y=_.get("text-font"),x=_.get("text-field"),C=_.get("icon-image"),D=(x.value.kind!=="constant"||x.value.value instanceof Wo&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),M=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,R=_.get("symbol-sort-key");if(this.features=[],!D&&!M)return;let O=l.iconDependencies,F=l.glyphDependencies,j=l.availableImages,z=new Xn(this.zoom);for(let{feature:H,id:Q,index:le,sourceLayerIndex:ee}of s){let ne=p._featureFilter.needGeometry,de=Yl(H,ne);if(!p._featureFilter.filter(z,de,h))continue;let me,Ie;if(ne||(de.geometry=Kl(H)),D){let He=p.getValueAndResolveTokens("text-field",de,h,j),We=Wo.factory(He),lt=this.hasRTLText=this.hasRTLText||CZ(We);(!lt||ql.getRTLTextPluginStatus()==="unavailable"||lt&&ql.isParsed())&&(me=tZ(We,p,de))}if(M){let He=p.getValueAndResolveTokens("icon-image",de,h,j);Ie=He instanceof ds?He:ds.fromString(He)}if(!me&&!Ie)continue;let qe=this.sortFeaturesByKey?R.evaluate(de,{},h):void 0;if(this.features.push({id:Q,text:me,icon:Ie,index:le,sourceLayerIndex:ee,geometry:de.geometry,properties:H.properties,type:By.types[H.type],sortKey:qe}),Ie&&(O[Ie.name]=!0),me){let He=y.evaluate(de,{},h).join(","),We=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(r.az.vertical)>=0;for(let lt of me.sections)if(lt.image)O[lt.image.name]=!0;else{let et=pd(me.toString()),Le=lt.fontStack||He,Ne=F[Le]=F[Le]||{};this.calculateGlyphDependencies(lt.text,Ne,We,this.allowVerticalPlacement,et)}}}_.get("symbol-placement")==="line"&&(this.features=(function(H){let Q={},le={},ee=[],ne=0;function de(He){ee.push(H[He]),ne++}function me(He,We,lt){let et=le[He];return delete le[He],le[We]=et,ee[et].geometry[0].pop(),ee[et].geometry[0]=ee[et].geometry[0].concat(lt[0]),et}function Ie(He,We,lt){let et=Q[We];return delete Q[We],Q[He]=et,ee[et].geometry[0].shift(),ee[et].geometry[0]=lt[0].concat(ee[et].geometry[0]),et}function qe(He,We,lt){let et=lt?We[0][We[0].length-1]:We[0][0];return`${He}:${et.x}:${et.y}`}for(let He=0;He<H.length;He++){let We=H[He],lt=We.geometry,et=We.text?We.text.toString():null;if(!et){de(He);continue}let Le=qe(et,lt),Ne=qe(et,lt,!0);if(Le in le&&Ne in Q&&le[Le]!==Q[Ne]){let _t=Ie(Le,Ne,lt),pt=me(Le,Ne,ee[_t].geometry);delete Q[Le],delete le[Ne],le[qe(et,ee[pt].geometry,!0)]=pt,ee[_t].geometry=null}else Le in le?me(Le,Ne,lt):Ne in Q?Ie(Le,Ne,lt):(de(He),Q[Le]=ne-1,le[Ne]=ne-1)}return ee.filter(He=>He.geometry)})(this.features)),this.sortFeaturesByKey&&this.features.sort((H,Q)=>H.sortKey-Q.sortKey)}update(s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:h}),this.icon.programConfigurations.updatePaintArrays(s,l,this.layers,{imagePositions:h}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,l){let h=this.lineVertexArray.length;if(s.segment!==void 0){let p=s.dist(l[s.segment+1]),_=s.dist(l[s.segment]),y={};for(let x=s.segment+1;x<l.length;x++)y[x]={x:l[x].x,y:l[x].y,tileUnitDistanceFromAnchor:p},x<l.length-1&&(p+=l[x+1].dist(l[x]));for(let x=s.segment||0;x>=0;x--)y[x]={x:l[x].x,y:l[x].y,tileUnitDistanceFromAnchor:_},x>0&&(_+=l[x-1].dist(l[x]));for(let x=0;x<l.length;x++){let C=y[x];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(s,l,h,p,_,y,x,C,D,M,R,O){let F=s.indexArray,j=s.layoutVertexArray,z=s.segments.prepareSegment(4*l.length,j,F,this.canOverlap?y.sortKey:void 0),H=this.glyphOffsetArray.length,Q=z.vertexLength,le=this.allowVerticalPlacement&&x===r.az.vertical?Math.PI/2:0,ee=y.text&&y.text.sections;for(let ne=0;ne<l.length;ne++){let{tl:de,tr:me,bl:Ie,br:qe,tex:He,pixelOffsetTL:We,pixelOffsetBR:lt,minFontScaleX:et,minFontScaleY:Le,glyphOffset:Ne,isSDF:_t,sectionIndex:pt}=l[ne],xt=z.vertexLength,mt=Ne[1];cx(j,C.x,C.y,de.x,mt+de.y,He.x,He.y,h,_t,We.x,We.y,et,Le),cx(j,C.x,C.y,me.x,mt+me.y,He.x+He.w,He.y,h,_t,lt.x,We.y,et,Le),cx(j,C.x,C.y,Ie.x,mt+Ie.y,He.x,He.y+He.h,h,_t,We.x,lt.y,et,Le),cx(j,C.x,C.y,qe.x,mt+qe.y,He.x+He.w,He.y+He.h,h,_t,lt.x,lt.y,et,Le),iI(s.dynamicLayoutVertexArray,C,le),F.emplaceBack(xt,xt+2,xt+1),F.emplaceBack(xt+1,xt+2,xt+3),z.vertexLength+=4,z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),ne!==l.length-1&&pt===l[ne+1].sectionIndex||s.programConfigurations.populatePaintArrays(j.length,y,y.index,{imagePositions:{},canonical:O,formattedSection:ee&&ee[pt]})}s.placedSymbolArray.emplaceBack(C.x,C.y,H,this.glyphOffsetArray.length-H,Q,D,M,C.segment,h?h[0]:0,h?h[1]:0,p[0],p[1],x,0,!1,0,R)}_addCollisionDebugVertex(s,l,h,p,_,y){return l.emplaceBack(0,0),s.emplaceBack(h.x,h.y,p,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(s,l,h,p,_,y,x){let C=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),D=C.vertexLength,M=_.layoutVertexArray,R=_.collisionVertexArray,O=x.anchorX,F=x.anchorY;this._addCollisionDebugVertex(M,R,y,O,F,new d(s,l)),this._addCollisionDebugVertex(M,R,y,O,F,new d(h,l)),this._addCollisionDebugVertex(M,R,y,O,F,new d(h,p)),this._addCollisionDebugVertex(M,R,y,O,F,new d(s,p)),C.vertexLength+=4;let j=_.indexArray;j.emplaceBack(D,D+1),j.emplaceBack(D+1,D+2),j.emplaceBack(D+2,D+3),j.emplaceBack(D+3,D),C.primitiveLength+=4}addDebugCollisionBoxes(s,l,h,p){for(let _=s;_<l;_++){let y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,p?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new oI(Ae,wL.members,ot),this.iconCollisionBox=new oI(Ae,wL.members,ot);for(let s=0;s<this.symbolInstances.length;s++){let l=this.symbolInstances.get(s);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(s,l,h,p,_,y,x,C,D){let M={};for(let R=l;R<h;R++){let O=s.get(R);M.textBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.textFeatureIndex=O.featureIndex;break}for(let R=p;R<_;R++){let O=s.get(R);M.verticalTextBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.verticalTextFeatureIndex=O.featureIndex;break}for(let R=y;R<x;R++){let O=s.get(R);M.iconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.iconFeatureIndex=O.featureIndex;break}for(let R=C;R<D;R++){let O=s.get(R);M.verticalIconBox={x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2,anchorPointX:O.anchorPointX,anchorPointY:O.anchorPointY},M.verticalIconFeatureIndex=O.featureIndex;break}return M}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){let h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,l){let h=s.placedSymbolArray.get(l),p=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<p;_+=4)s.indexArray.emplaceBack(_,_+2,_+1),s.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let l=Math.sin(s),h=Math.cos(s),p=[],_=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);let C=this.symbolInstances.get(x);p.push(0|Math.round(l*C.anchorX+h*C.anchorY)),_.push(C.featureIndex)}return y.sort((x,C)=>p[x]-p[C]||_[C]-_[x]),y}addToSortKeyRanges(s,l){let h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let l of this.symbolInstanceIndexes){let h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((p,_,y)=>{p>=0&&y.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let OL,FL;wt("SymbolBucket",Rm,{omit:["layers","collisionBoxArray","features","compareText"]}),Rm.MAX_GLYPHS=65535,Rm.addDynamicAttributes=iI;var sI={get paint(){return FL=FL||new Oo({"icon-opacity":new Vt(we.paint_symbol["icon-opacity"]),"icon-color":new Vt(we.paint_symbol["icon-color"]),"icon-halo-color":new Vt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Vt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Vt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new It(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new It(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Vt(we.paint_symbol["text-opacity"]),"text-color":new Vt(we.paint_symbol["text-color"],{runtimeType:us,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Vt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Vt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Vt(we.paint_symbol["text-halo-blur"]),"text-translate":new It(we.paint_symbol["text-translate"]),"text-translate-anchor":new It(we.paint_symbol["text-translate-anchor"])})},get layout(){return OL=OL||new Oo({"symbol-placement":new It(we.layout_symbol["symbol-placement"]),"symbol-spacing":new It(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new It(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Vt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new It(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new It(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new It(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new It(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new It(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new It(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Vt(we.layout_symbol["icon-size"]),"icon-text-fit":new It(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new It(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Vt(we.layout_symbol["icon-image"]),"icon-rotate":new Vt(we.layout_symbol["icon-rotate"]),"icon-padding":new Vt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new It(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Vt(we.layout_symbol["icon-offset"]),"icon-anchor":new Vt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new It(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new It(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new It(we.layout_symbol["text-rotation-alignment"]),"text-field":new Vt(we.layout_symbol["text-field"]),"text-font":new Vt(we.layout_symbol["text-font"]),"text-size":new Vt(we.layout_symbol["text-size"]),"text-max-width":new Vt(we.layout_symbol["text-max-width"]),"text-line-height":new It(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Vt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Vt(we.layout_symbol["text-justify"]),"text-radial-offset":new Vt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new It(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Vt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Vt(we.layout_symbol["text-anchor"]),"text-max-angle":new It(we.layout_symbol["text-max-angle"]),"text-writing-mode":new It(we.layout_symbol["text-writing-mode"]),"text-rotate":new Vt(we.layout_symbol["text-rotate"]),"text-padding":new It(we.layout_symbol["text-padding"]),"text-keep-upright":new It(we.layout_symbol["text-keep-upright"]),"text-transform":new Vt(we.layout_symbol["text-transform"]),"text-offset":new Vt(we.layout_symbol["text-offset"]),"text-allow-overlap":new It(we.layout_symbol["text-allow-overlap"]),"text-overlap":new It(we.layout_symbol["text-overlap"]),"text-ignore-placement":new It(we.layout_symbol["text-ignore-placement"]),"text-optional":new It(we.layout_symbol["text-optional"])})}};class LL{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:er,this.defaultValue=s}evaluate(s){if(s.formattedSection){let l=this.defaultValue.property.overrides;if(l&&l.hasOverride(s.formattedSection))return l.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wt("FormatSectionOverride",LL,{omit:["defaultValue"]});class ux extends Ns{constructor(s,l){super(s,sI,l)}recalculate(s,l){if(super.recalculate(s,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let h=this.layout.get("text-writing-mode");if(h){let p=[];for(let _ of h)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,l,h,p){let _=this.layout.get(s).evaluate(l,{},h,p),y=this._unevaluatedLayout._values[s];return y.isDataDriven()||cd(y.value)||!_?_:(function(x,C){return C.replace(/{([^{}]+)}/g,(D,M)=>x&&M in x?String(x[M]):"")})(l.properties,_)}createBucket(s){return new Rm(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let s of sI.paint.overridableProperties){if(!ux.hasPaintOverride(this.layout,s))continue;let l=this.paint.get(s),h=new LL(l),p=new ry(h,l.property.specification),_=null;_=l.value.kind==="constant"||l.value.kind==="source"?new im("source",p):new oy("composite",p,l.value.zoomStops),this.paint._values[s]=new Xs(l.property,_,l.parameters)}}_handleOverridablePaintPropertyUpdate(s,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&ux.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,l){let h=s.get("text-field"),p=sI.paint.properties[l],_=!1,y=x=>{for(let C of x)if(p.overrides&&p.overrides.hasOverride(C))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Wo)y(h.value.value.sections);else if(h.value.kind==="source"||h.value.kind==="composite"){let x=D=>{_||(D instanceof Ea&&tr(D.value)===Th?y(D.value.sections):D instanceof Oh?y(D.sections):D.eachChild(x))},C=h.value;C._styleExpression&&x(C._styleExpression.expression)}return _}}let BL;var TZ={get paint(){return BL=BL||new Oo({"background-color":new It(we.paint_background["background-color"]),"background-pattern":new mm(we.paint_background["background-pattern"]),"background-opacity":new It(we.paint_background["background-opacity"])})}};class SZ extends Ns{constructor(s,l){super(s,TZ,l)}}class DZ extends Ns{constructor(s,l){super(s,{},l),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class IZ{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let MZ={once:!0},aI=63710088e-1;class yd{constructor(s,l){if(isNaN(s)||isNaN(l))throw new Error(`Invalid LngLat object: (${s}, ${l})`);if(this.lng=+s,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new yd(ls(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){let l=Math.PI/180,h=this.lat*l,p=s.lat*l,_=Math.sin(h)*Math.sin(p)+Math.cos(h)*Math.cos(p)*Math.cos((s.lng-this.lng)*l);return aI*Math.acos(Math.min(_,1))}static convert(s){if(s instanceof yd)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new yd(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new yd(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let VL=2*Math.PI*aI;function jL(c){return VL*Math.cos(c*Math.PI/180)}function zL(c){return(180+c)/360}function UL(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function $L(c,s){return c/jL(s)}function HL(c){return 360*c-180}function dx(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function GL(c,s){return c*jL(dx(s))}class Uy{constructor(s,l,h=0){this.x=+s,this.y=+l,this.z=+h}static fromLngLat(s,l=0){let h=yd.convert(s);return new Uy(zL(h.lng),UL(h.lat),$L(l,h.lat))}toLngLat(){return new yd(HL(this.x),dx(this.y))}toAltitude(){return GL(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/VL*(s=dx(this.y),1/Math.cos(s*Math.PI/180));var s}}function qL(c,s,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[c*h-2*Math.PI*6378137/2,s*h-2*Math.PI*6378137/2]}class lI{constructor(s,l,h){if(!(function(p,_,y){return!(p<0||p>25||y<0||y>=Math.pow(2,p)||_<0||_>=Math.pow(2,p))})(s,l,h))throw new Error(`x=${l}, y=${h}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=l,this.y=h,this.key=Pm(0,s,s,l,h)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,l,h){let p=(y=this.y,x=this.z,C=qL(256*(_=this.x),256*(y=Math.pow(2,x)-y-1),x),D=qL(256*(_+1),256*(y+1),x),C[0]+","+C[1]+","+D[0]+","+D[1]);var _,y,x,C,D;let M=(function(R,O,F){let j,z="";for(let H=R;H>0;H--)j=1<<H-1,z+=(O&j?1:0)+(F&j?2:0);return z})(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(h==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,p)}isChildOf(s){let l=this.z-s.z;return l>0&&s.x===this.x>>l&&s.y===this.y>>l}getTilePoint(s){let l=Math.pow(2,this.z);return new d((s.x*l-this.x)*ft,(s.y*l-this.y)*ft)}toString(){return`${this.z}/${this.x}/${this.y}`}}class WL{constructor(s,l){this.wrap=s,this.canonical=l,this.key=Pm(s,l.z,l.z,l.x,l.y)}}class ea{constructor(s,l,h,p,_){if(this.terrainRttPosMatrix32f=null,s<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${h}`);this.overscaledZ=s,this.wrap=l,this.canonical=new lI(h,+p,+_),this.key=Pm(l,s,h,p,_)}clone(){return new ea(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);let l=this.canonical.z-s;return s>this.canonical.z?new ea(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ea(s,this.wrap,s,this.canonical.x>>l,this.canonical.y>>l)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(s,l){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);let h=this.canonical.z-s;return s>this.canonical.z?Pm(this.wrap*+l,s,this.canonical.z,this.canonical.x,this.canonical.y):Pm(this.wrap*+l,s,s,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(s){if(s.wrap!==this.wrap||this.overscaledZ-s.overscaledZ<=0)return!1;if(s.overscaledZ===0)return this.overscaledZ>0;let l=this.canonical.z-s.canonical.z;return!(l<0)&&s.canonical.x===this.canonical.x>>l&&s.canonical.y===this.canonical.y>>l}children(s){if(this.overscaledZ>=s)return[new ea(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let l=this.canonical.z+1,h=2*this.canonical.x,p=2*this.canonical.y;return[new ea(l,this.wrap,l,h,p),new ea(l,this.wrap,l,h+1,p),new ea(l,this.wrap,l,h,p+1),new ea(l,this.wrap,l,h+1,p+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new ea(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new ea(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new WL(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new Uy(s.x-this.wrap,s.y))}}function Pm(c,s,l,h,p){(c*=2)<0&&(c=-1*c-1);let _=1<<l;return(_*_*c+_*p+h).toString(36)+l.toString(36)+s.toString(36)}function cI(c,s){return s?c.properties[s]:c.id}function AZ(c,s){let l={id:c.id};if(s.removeAllProperties&&(delete c.removeProperties,delete c.addOrUpdateProperties,delete s.removeProperties),s.removeProperties)for(let h of s.removeProperties){let p=c.addOrUpdateProperties.findIndex(_=>_.key===h);p>-1&&c.addOrUpdateProperties.splice(p,1)}return(c.removeAllProperties||s.removeAllProperties)&&(l.removeAllProperties=!0),(c.removeProperties||s.removeProperties)&&(l.removeProperties=[...c.removeProperties||[],...s.removeProperties||[]]),(c.addOrUpdateProperties||s.addOrUpdateProperties)&&(l.addOrUpdateProperties=[...c.addOrUpdateProperties||[],...s.addOrUpdateProperties||[]]),(c.newGeometry||s.newGeometry)&&(l.newGeometry=s.newGeometry||c.newGeometry),l}function ZL(c){var s,l;if(!c)return{};let h={};return h.removeAll=c.removeAll,h.remove=new Set(c.remove||[]),h.add=new Map((s=c.add)===null||s===void 0?void 0:s.map(p=>[p.id,p])),h.update=new Map((l=c.update)===null||l===void 0?void 0:l.map(p=>[p.id,p])),h}wt("CanonicalTileID",lI),wt("OverscaledTileID",ea,{omit:["terrainRttPosMatrix32f"]});class ff{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(s){return this.minX=Math.min(this.minX,s.x),this.minY=Math.min(this.minY,s.y),this.maxX=Math.max(this.maxX,s.x),this.maxY=Math.max(this.maxY,s.y),this}expandBy(s){return this.minX-=s,this.minY-=s,this.maxX+=s,this.maxY+=s,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(s){return this.expandBy(-s)}map(s){let l=new ff;return l.extend(s(new d(this.minX,this.minY))),l.extend(s(new d(this.maxX,this.minY))),l.extend(s(new d(this.minX,this.maxY))),l.extend(s(new d(this.maxX,this.maxY))),l}static fromPoints(s){let l=new ff;for(let h of s)l.extend(h);return l}contains(s){return s.x>=this.minX&&s.x<=this.maxX&&s.y>=this.minY&&s.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(s){return!this.empty()&&!s.empty()&&s.minX>=this.minX&&s.maxX<=this.maxX&&s.minY>=this.minY&&s.maxY<=this.maxY}intersects(s){return!this.empty()&&!s.empty()&&s.minX<=this.maxX&&s.maxX>=this.minX&&s.minY<=this.maxY&&s.maxY>=this.minY}}class KL{constructor(s){this._stringToNumber={},this._numberToString=[];for(let l=0;l<s.length;l++){let h=s[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class YL{constructor(s,l,h,p,_){this.type="Feature",this._vectorTileFeature=s,this._x=h,this._y=p,this._z=l,this.properties=s.properties,this.id=_}projectPoint(s,l,h,p){return[360*(s.x+l)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(s.y+h)/p)*Math.PI))-90]}projectLine(s,l,h,p){return s.map(_=>this.projectPoint(_,l,h,p))}get geometry(){if(this._geometry)return this._geometry;let s=this._vectorTileFeature,l=s.extent*Math.pow(2,this._z),h=s.extent*this._x,p=s.extent*this._y,_=s.loadGeometry();switch(s.type){case 1:{let y=[];for(let C of _)y.push(C[0]);let x=this.projectLine(y,h,p,l);this._geometry=y.length===1?{type:"Point",coordinates:x[0]}:{type:"MultiPoint",coordinates:x};break}case 2:{let y=_.map(x=>this.projectLine(x,h,p,l));this._geometry=y.length===1?{type:"LineString",coordinates:y[0]}:{type:"MultiLineString",coordinates:y};break}case 3:{let y=dL(_),x=[];for(let C of y)x.push(C.map(D=>this.projectLine(D,h,p,l)));this._geometry=x.length===1?{type:"Polygon",coordinates:x[0]}:{type:"MultiPolygon",coordinates:x};break}default:throw new Error(`unknown feature type: ${s.type}`)}return this._geometry}set geometry(s){this._geometry=s}toJSON(){let s={geometry:this.geometry};for(let l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&l!=="_x"&&l!=="_y"&&l!=="_z"&&(s[l]=this[l]);return s}}class Nm{_name;dataBuffer;nullabilityBuffer;_size;constructor(s,l,h){this._name=s,this.dataBuffer=l,typeof h=="number"?this._size=h:(this.nullabilityBuffer=h,this._size=h.size())}getValue(s){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(s)?null:this.getValueFromBuffer(s)}has(s){return this.nullabilityBuffer&&this.nullabilityBuffer.get(s)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class hx extends Nm{}class uI extends hx{getValueFromBuffer(s){return this.dataBuffer[s]}}class dI extends hx{getValueFromBuffer(s){return this.dataBuffer[s]}}class XL extends Nm{delta;constructor(s,l,h,p){super(s,l,p),this.delta=h}}class hI extends XL{constructor(s,l,h,p){super(s,Int32Array.of(l),h,p)}getValueFromBuffer(s){return this.dataBuffer[0]+s*this.delta}}class fI extends Nm{constructor(s,l,h){super(s,Int32Array.of(l),h)}getValueFromBuffer(s){return this.dataBuffer[0]}}class kZ{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(s,l,h,p,_=4096){this._name=s,this._geometryVector=l,this._idVector=h,this._propertyVectors=p,this._extent=_}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(s){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(l=>[l.name,l]))),this.propertyVectorsMap.get(s)}*[Symbol.iterator](){let s=this.geometryVector[Symbol.iterator](),l=0;for(;l<this.numFeatures;){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));let p=s?.next().value,_={};for(let y of this.propertyVectors){if(!y)continue;let x=y.name,C=y.getValue(l);C!==null&&(_[x]=C)}l++,yield{id:h,geometry:p,properties:_}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){let s=[],l=this.geometryVector.getGeometries();for(let h=0;h<this.numFeatures;h++){let p;this.idVector&&(p=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(h)):this.idVector.getValue(h));let _={coordinates:l[h],type:this.geometryVector.geometryType(h)},y={};for(let x of this.propertyVectors){if(!x)continue;let C=x.name,D=x.getValue(h);D!==null&&(y[C]=D)}s.push({id:p,geometry:_,properties:y})}return s}containsMaxSaveIntegerValues(s){return s instanceof uI||s instanceof fI&&s instanceof hI||s instanceof dI}}class RZ{value;constructor(s){this.value=s}get(){return this.value}set(s){this.value=s}increment(){return this.value++}add(s){this.value+=s}}var En,eu,vo,ol,pf,Fs,Gr,qr,QL,ta;function io(c,s,l){let h=new Int32Array(l),p=0,_=s.get();for(let y=0;y<h.length;y++){let x=c[_++],C=127&x;x<128||(x=c[_++],C|=(127&x)<<7,x<128||(x=c[_++],C|=(127&x)<<14,x<128||(x=c[_++],C|=(127&x)<<21,x<128||(x=c[_++],C|=(15&x)<<28)))),h[p++]=C}return s.set(_),h}function fx(c,s,l){let h=new BigInt64Array(l);for(let p=0;p<h.length;p++)h[p]=NZ(c,s);return h}function PZ(c,s){let l,h;return h=c[s.get()],s.increment(),l=127&h,h<128?l:(h=c[s.get()],s.increment(),l|=(127&h)<<7,h<128?l:(h=c[s.get()],s.increment(),l|=(127&h)<<14,h<128?l:(h=c[s.get()],s.increment(),l|=(127&h)<<21,h<128?l:(h=c[s.get()],l|=(15&h)<<28,(function(p,_,y){let x,C;if(C=_[y.get()],y.increment(),x=(112&C)>>4,C<128||(C=_[y.get()],y.increment(),x|=(127&C)<<3,C<128)||(C=_[y.get()],y.increment(),x|=(127&C)<<10,C<128)||(C=_[y.get()],y.increment(),x|=(127&C)<<17,C<128)||(C=_[y.get()],y.increment(),x|=(127&C)<<24,C<128)||(C=_[y.get()],y.increment(),x|=(1&C)<<31,C<128))return 4294967296*x+(p>>>0);throw new Error("Expected varint not more than 10 bytes")})(l,c,s)))))}function JL(c,s,l,h){throw new Error("FastPFor is not implemented yet.")}function mf(c){return c>>>1^-(1&c)}function Om(c){return c>>1n^-(1n&c)}function NZ(c,s){let l=0n,h=0,p=s.get();for(;p<c.length;){let _=c[p++];if(l|=BigInt(127&_)<<BigInt(h),!(128&_))break;if(h+=7,h>=64)throw new Error("Varint too long")}return s.set(p),l}function eB(c,s,l){let h=new Int32Array(l),p=0;for(let _=0;_<s;_++){let y=c[_];h.fill(c[_+s],p,p+y),p+=y}return h}function tB(c,s,l){let h=new BigInt64Array(l),p=0;for(let _=0;_<s;_++){let y=Number(c[_]);h.fill(c[_+s],p,p+y),p+=y}return h}function nB(c,s,l){let h=new Float64Array(l),p=0;for(let _=0;_<s;_++){let y=c[_];h.fill(c[_+s],p,p+y),p+=y}return h}function pI(c){let s=c.length/4*4,l=1;if(s>=4)for(let h=c[0];l<s-4;l+=4)h=c[l]+=h,h=c[l+1]+=h,h=c[l+2]+=h,h=c[l+3]+=h;for(;l!=c.length;)c[l]+=c[l-1],++l}function iB(c){c[0]=c[0]>>>1^-(1&c[0]),c[1]=c[1]>>>1^-(1&c[1]);let s=c.length/4*4,l=2;if(s>=4)for(;l<s-4;l+=4){let h=c[l],p=c[l+1],_=c[l+2],y=c[l+3];c[l]=(h>>>1^-(1&h))+c[l-2],c[l+1]=(p>>>1^-(1&p))+c[l-1],c[l+2]=(_>>>1^-(1&_))+c[l],c[l+3]=(y>>>1^-(1&y))+c[l+1]}for(;l!=c.length;l+=2)c[l]=(c[l]>>>1^-(1&c[l]))+c[l-2],c[l+1]=(c[l+1]>>>1^-(1&c[l+1]))+c[l-1]}(function(c){c.NONE="NONE",c.DELTA="DELTA",c.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",c.RLE="RLE",c.MORTON="MORTON",c.PDE="PDE"})(En||(En={})),(function(c){c.NONE="NONE",c.FAST_PFOR="FAST_PFOR",c.VARINT="VARINT",c.ALP="ALP"})(eu||(eu={})),(function(c){c.PRESENT="PRESENT",c.DATA="DATA",c.OFFSET="OFFSET",c.LENGTH="LENGTH"})(vo||(vo={}));class mI{_dictionaryType;_offsetType;_lengthType;constructor(s,l,h){this._dictionaryType=s,this._offsetType=l,this._lengthType=h}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Yo(c,s){let l=(function(h,p){let _=h[p.get()],y=Object.values(vo)[_>>4],x=null;switch(y){case vo.DATA:x=new mI(Object.values(ol)[15&_]);break;case vo.OFFSET:x=new mI(null,Object.values(pf)[15&_]);break;case vo.LENGTH:x=new mI(null,null,Object.values(Fs)[15&_])}p.increment();let C=h[p.get()],D=Object.values(En)[C>>5],M=Object.values(En)[C>>2&7],R=Object.values(eu)[3&C];p.increment();let O=io(h,p,2),F=O[0];return{physicalStreamType:y,logicalStreamType:x,logicalLevelTechnique1:D,logicalLevelTechnique2:M,physicalLevelTechnique:R,numValues:F,byteLength:O[1],decompressedCount:F}})(c,s);return l.logicalLevelTechnique1===En.MORTON?(function(h,p,_){let y=io(p,_,2);return{physicalStreamType:h.physicalStreamType,logicalStreamType:h.logicalStreamType,logicalLevelTechnique1:h.logicalLevelTechnique1,logicalLevelTechnique2:h.logicalLevelTechnique2,physicalLevelTechnique:h.physicalLevelTechnique,numValues:h.numValues,byteLength:h.byteLength,decompressedCount:h.decompressedCount,numBits:y[0],coordinateShift:y[1]}})(l,c,s):En.RLE!==l.logicalLevelTechnique1&&En.RLE!==l.logicalLevelTechnique2||eu.NONE===l.physicalLevelTechnique?l:(function(h,p,_){let y=io(p,_,2);return{physicalStreamType:h.physicalStreamType,logicalStreamType:h.logicalStreamType,logicalLevelTechnique1:h.logicalLevelTechnique1,logicalLevelTechnique2:h.logicalLevelTechnique2,physicalLevelTechnique:h.physicalLevelTechnique,numValues:h.numValues,byteLength:h.byteLength,decompressedCount:y[1],runs:y[0],numRleValues:y[1]}})(l,c,s)}(function(c){c.NONE="NONE",c.SINGLE="SINGLE",c.SHARED="SHARED",c.VERTEX="VERTEX",c.MORTON="MORTON",c.FSST="FSST"})(ol||(ol={})),(function(c){c.VERTEX="VERTEX",c.INDEX="INDEX",c.STRING="STRING",c.KEY="KEY"})(pf||(pf={})),(function(c){c.VAR_BINARY="VAR_BINARY",c.GEOMETRIES="GEOMETRIES",c.PARTS="PARTS",c.RINGS="RINGS",c.TRIANGLES="TRIANGLES",c.SYMBOL="SYMBOL",c.DICTIONARY="DICTIONARY"})(Fs||(Fs={})),(function(c){c[c.FLAT=0]="FLAT",c[c.CONST=1]="CONST",c[c.SEQUENCE=2]="SEQUENCE",c[c.DICTIONARY=3]="DICTIONARY",c[c.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Gr||(Gr={}));class sl{values;_size;constructor(s,l){this.values=s,this._size=l}get(s){let l=Math.floor(s/8);return(this.values[l]>>s%8&1)==1}set(s,l){let h=Math.floor(s/8);this.values[h]=this.values[h]|(l?1:0)<<s%8}getInt(s){let l=Math.floor(s/8);return this.values[l]>>s%8&1}size(){return this._size}getBuffer(){return this.values}}function Xo(c,s,l,h,p){return(function(_,y,x){switch(y.logicalLevelTechnique1){case En.DELTA:return y.logicalLevelTechnique2===En.RLE?(function(C,D,M){let R=new Int32Array(M),O=0,F=0;for(let j=0;j<D;j++){let z=C[j],H=mf(C[j+D]);for(let Q=0;Q<z;Q++)F+=H,R[O++]=F}return R})(_,y.runs,y.numRleValues):((function(C){C[0]=C[0]>>>1^-(1&C[0]);let D=C.length/4*4,M=1;if(D>=4)for(;M<D-4;M+=4){let R=C[M],O=C[M+1],F=C[M+2],j=C[M+3];C[M]=(R>>>1^-(1&R))+C[M-1],C[M+1]=(O>>>1^-(1&O))+C[M],C[M+2]=(F>>>1^-(1&F))+C[M+1],C[M+3]=(j>>>1^-(1&j))+C[M+2]}for(;M!=C.length;++M)C[M]=(C[M]>>>1^-(1&C[M]))+C[M-1]})(_),_);case En.RLE:return(function(C,D,M){return M?(function(R,O,F){let j=new Int32Array(F),z=0;for(let H=0;H<O;H++){let Q=R[H],le=R[H+O];le=le>>>1^-(1&le),j.fill(le,z,z+Q),z+=Q}return j})(C,D.runs,D.numRleValues):eB(C,D.runs,D.numRleValues)})(_,y,x);case En.MORTON:return pI(_),_;case En.COMPONENTWISE_DELTA:return iB(_),_;case En.NONE:return x&&(function(C){for(let D=0;D<C.length;D++){let M=C[D];C[D]=M>>>1^-(1&M)}})(_),_;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}})(px(c,s,l),l,h)}function vd(c,s,l){return(function(h,p){if(p.logicalLevelTechnique1===En.DELTA&&p.logicalLevelTechnique2===En.NONE)return(function(y){let x=new Int32Array(y.length+1);x[0]=0,x[1]=mf(y[0]);let C=x[1],D=2;for(;D!=x.length;++D){let M=y[D-1];C+=M>>>1^-(1&M),x[D]=x[D-1]+C}return x})(h);if(p.logicalLevelTechnique1===En.RLE&&p.logicalLevelTechnique2===En.NONE)return(function(y,x,C){let D=new Int32Array(C+1);D[0]=0;let M=1,R=D[0];for(let O=0;O<x;O++){let F=y[O],j=y[O+x];for(let z=M;z<M+F;z++)D[z]=j+R,R=D[z];M+=F}return D})(h,p.runs,p.numRleValues);if(p.logicalLevelTechnique1===En.NONE&&p.logicalLevelTechnique2===En.NONE){(function(y){let x=0;for(let C=0;C<y.length;C++)y[C]+=x,x=y[C]})(h);let _=new Int32Array(p.numValues+1);return _[0]=0,_.set(h,1),_}if(p.logicalLevelTechnique1===En.DELTA&&p.logicalLevelTechnique2===En.RLE){let _=(function(y,x,C){let D=new Int32Array(C+1);D[0]=0;let M=1,R=D[0];for(let O=0;O<x;O++){let F=y[O],j=y[O+x];j=j>>>1^-(1&j);for(let z=M;z<M+F;z++)D[z]=j+R,R=D[z];M+=F}return D})(h,p.runs,p.numRleValues);return pI(_),_}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(px(c,s,l),l)}function px(c,s,l){let h=l.physicalLevelTechnique;if(h===eu.FAST_PFOR)return JL();if(h===eu.VARINT)return io(c,s,l.numValues);if(h===eu.NONE){let p=s.get();s.add(l.byteLength);let _=c.subarray(p,s.get());return new Int32Array(_)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function gI(c,s,l,h){let p=px(c,s,l);if(p.length===1){let _=p[0];return h?mf(_):_}return h?(function(_){return mf(_[1])})(p):(function(_){return _[1]})(p)}function rB(c,s,l){return(function(h){if(h.length==2){let p=mf(h[1]);return[p,p]}return[mf(h[2]),mf(h[3])]})(px(c,s,l))}function oB(c,s,l){return(function(h){if(h.length==2){let p=Om(h[1]);return[p,p]}return[Om(h[2]),Om(h[3])]})(fx(c,s,l.numValues))}function sB(c,s,l,h){return(function(p,_,y){switch(_.logicalLevelTechnique1){case En.DELTA:return _.logicalLevelTechnique2===En.RLE?(function(x,C,D){let M=new BigInt64Array(D),R=0,O=0n;for(let F=0;F<C;F++){let j=Number(x[F]),z=Om(x[F+C]);for(let H=0;H<j;H++)O+=z,M[R++]=O}return M})(p,_.runs,_.numRleValues):((function(x){x[0]=x[0]>>1n^-(1n&x[0]);let C=x.length/4*4,D=1;if(C>=4)for(;D<C-4;D+=4){let M=x[D],R=x[D+1],O=x[D+2],F=x[D+3];x[D]=(M>>1n^-(1n&M))+x[D-1],x[D+1]=(R>>1n^-(1n&R))+x[D],x[D+2]=(O>>1n^-(1n&O))+x[D+1],x[D+3]=(F>>1n^-(1n&F))+x[D+2]}for(;D!=x.length;++D)x[D]=(x[D]>>1n^-(1n&x[D]))+x[D-1]})(p),p);case En.RLE:return(function(x,C,D){return D?(function(M,R,O){let F=new BigInt64Array(O),j=0;for(let z=0;z<R;z++){let H=Number(M[z]),Q=M[z+R];Q=Q>>1n^-(1n&Q),F.fill(Q,j,j+H),j+=H}return F})(x,C.runs,C.numRleValues):tB(x,C.runs,C.numRleValues)})(p,_,y);case En.NONE:return y&&(function(x){for(let C=0;C<x.length;C++){let D=x[C];x[C]=D>>1n^-(1n&D)}})(p),p;default:throw new Error(`The specified Logical level technique is not supported: ${_.logicalLevelTechnique1}`)}})(fx(c,s,l.numValues),l,h)}function aB(c,s,l,h){let p=fx(c,s,l.numValues);if(p.length===1){let _=p[0];return h?Om(_):_}return h?(function(_){return Om(_[1])})(p):(function(_){return _[1]})(p)}function _I(c,s,l,h,p){return(function(_,y,x,C){switch(y.logicalLevelTechnique1){case En.DELTA:return y.logicalLevelTechnique2===En.RLE&&(_=eB(_,y.runs,y.numRleValues)),(function(D,M){let R=new Int32Array(D.size()),O=0;D.get(0)?(R[0]=D.get(0)?M[0]>>>1^-(1&M[0]):0,O=1):R[0]=0;let F=1;for(;F!=R.length;++F)R[F]=D.get(F)?R[F-1]+(M[O]>>>1^-(1&M[O++])):R[F-1];return R})(C,_);case En.RLE:return(function(D,M,R,O){let F=M;return R?(function(j,z,H){let Q=new Int32Array(j.size()),le=0;for(let ee=0;ee<H;ee++){let ne=z[ee],de=z[ee+H];de=de>>>1^-(1&de);for(let me=le;me<le+ne;me++)j.get(me)?Q[me]=de:(Q[me]=0,le++);le+=ne}return Q})(O,D,F.runs):(function(j,z,H){let Q=new Int32Array(j.size()),le=0;for(let ee=0;ee<H;ee++){let ne=z[ee],de=z[ee+H];for(let me=le;me<le+ne;me++)j.get(me)?Q[me]=de:(Q[me]=0,le++);le+=ne}return Q})(O,D,F.runs)})(_,y,x,C);case En.MORTON:return pI(_),_;case En.COMPONENTWISE_DELTA:return iB(_),_;case En.NONE:return _=x?(function(D,M){let R=new Int32Array(D.size()),O=0,F=0;for(;F!=R.length;++F)if(D.get(F)){let j=M[O++];R[F]=j>>>1^-(1&j)}else R[F]=0;return R})(C,_):(function(D,M){let R=new Int32Array(D.size()),O=0,F=0;for(;F!=R.length;++F)R[F]=D.get(F)?M[O++]:0;return R})(C,_),_;default:throw new Error("The specified Logical level technique is not supported")}})(l.physicalLevelTechnique===eu.FAST_PFOR?JL():io(c,s,l.numValues),l,h,p)}function mx(c,s,l,h){let p=c.logicalLevelTechnique1;if(p===En.RLE)return c.runs===1?Gr.CONST:Gr.FLAT;let _=s instanceof sl?s.size():s;if(p===En.DELTA&&c.logicalLevelTechnique2===En.RLE){let y=c.runs,x=2;if(c.numRleValues!==_)return Gr.FLAT;if(y===1)return Gr.SEQUENCE;if(y===2){let C=h.get(),D;if(c.physicalLevelTechnique===eu.VARINT)D=io(l,h,4);else{let M=h.get();D=new Int32Array(l.buffer,l.byteOffset+M,4)}if(h.set(C),D[2]===x&&D[3]===x)return Gr.SEQUENCE}}return c.numValues===1?Gr.CONST:Gr.FLAT}class lB extends hx{getValueFromBuffer(s){return this.dataBuffer[s]}}class cB extends XL{constructor(s,l,h,p){super(s,BigInt64Array.of(l),h,p)}getValueFromBuffer(s){return this.dataBuffer[0]+BigInt(s)*this.delta}}class Fm{_geometryOffsets;_partOffsets;_ringOffsets;constructor(s,l,h){this._geometryOffsets=s,this._partOffsets=l,this._ringOffsets=h}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function yI(c,s,l){return{x:uB(c,s)-l,y:uB(c>>1,s)-l}}function uB(c,s){let l=0;for(let h=0;h<s;h++)l|=(c&1<<2*h)>>h;return l}(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON",c[c.MULTIPOINT=3]="MULTIPOINT",c[c.MULTILINESTRING=4]="MULTILINESTRING",c[c.MULTIPOLYGON=5]="MULTIPOLYGON"})(qr||(qr={})),(function(c){c[c.POINT=0]="POINT",c[c.LINESTRING=1]="LINESTRING",c[c.POLYGON=2]="POLYGON"})(QL||(QL={})),(function(c){c[c.MORTON=0]="MORTON",c[c.VEC_2=1]="VEC_2",c[c.VEC_3=2]="VEC_3"})(ta||(ta={}));class OZ{createPoint(s){return[[s]]}createMultiPoint(s){return s.map(l=>[l])}createLineString(s){return[s]}createMultiLineString(s){return s}createPolygon(s,l){return[s].concat(l)}createMultiPolygon(s){return s.flat()}}function dB(c){let s=new Array(c.numGeometries),l=1,h=1,p=1,_=0,y=new OZ,x=0,C=0,D=c.mortonSettings,M=c.topologyVector,R=M.geometryOffsets,O=M.partOffsets,F=M.ringOffsets,j=c.vertexOffsets,z=c.containsPolygonGeometry(),H=c.vertexBuffer;for(let Q=0;Q<c.numGeometries;Q++){let le=c.geometryType(Q);if(le===qr.POINT){if(j&&j.length!==0)if(c.vertexBufferType===ta.VEC_2){let ee=2*j[C++],ne=new d(H[ee],H[ee+1]);s[_++]=y.createPoint(ne)}else{let ee=yI(H[j[C++]],D.numBits,D.coordinateShift),ne=new d(ee.x,ee.y);s[_++]=y.createPoint(ne)}else{let ee=new d(H[x++],H[x++]);s[_++]=y.createPoint(ee)}R&&p++,O&&l++,F&&h++}else if(le===qr.MULTIPOINT){let ee=R[p]-R[p-1];p++;let ne=new Array(ee);if(j&&j.length!==0){for(let de=0;de<ee;de++){let me=2*j[C++];ne[de]=new d(H[me],H[me+1])}s[_++]=y.createMultiPoint(ne)}else{for(let de=0;de<ee;de++){let me=H[x++],Ie=H[x++];ne[de]=new d(me,Ie)}s[_++]=y.createMultiPoint(ne)}}else if(le===qr.LINESTRING){let ee,ne=0;z?(ne=F[h]-F[h-1],h++):ne=O[l]-O[l-1],l++,j&&j.length!==0?(ee=c.vertexBufferType===ta.VEC_2?bI(H,j,C,ne,!1):wI(H,j,C,ne,!1,D),C+=ne):(ee=vI(H,x,ne,!1),x+=2*ne),s[_++]=y.createLineString(ee),R&&p++}else if(le===qr.POLYGON){let ee=O[l]-O[l-1];l++;let ne=new Array(ee-1),de=F[h]-F[h-1];if(h++,j&&j.length!==0){let me=c.vertexBufferType===ta.VEC_2?_x(H,j,C,de):yx(H,j,C,de,0,D);C+=de;for(let Ie=0;Ie<ne.length;Ie++)de=F[h]-F[h-1],h++,ne[Ie]=c.vertexBufferType===ta.VEC_2?_x(H,j,C,de):yx(H,j,C,de,0,D),C+=de;s[_++]=y.createPolygon(me,ne)}else{let me=gx(H,x,de);x+=2*de;for(let Ie=0;Ie<ne.length;Ie++)de=F[h]-F[h-1],h++,ne[Ie]=gx(H,x,de),x+=2*de;s[_++]=y.createPolygon(me,ne)}R&&p++}else if(le===qr.MULTILINESTRING){let ee=R[p]-R[p-1];p++;let ne=new Array(ee);if(j&&j.length!==0){for(let de=0;de<ee;de++){let me=0;z?(me=F[h]-F[h-1],h++):me=O[l]-O[l-1],l++;let Ie=c.vertexBufferType===ta.VEC_2?bI(H,j,C,me,!1):wI(H,j,C,me,!1,D);ne[de]=Ie,C+=me}s[_++]=y.createMultiLineString(ne)}else{for(let de=0;de<ee;de++){let me=0;z?(me=F[h]-F[h-1],h++):me=O[l]-O[l-1],l++,ne[de]=vI(H,x,me,!1),x+=2*me}s[_++]=y.createMultiLineString(ne)}}else{if(le!==qr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{let ee=R[p]-R[p-1];p++;let ne=new Array(ee),de=0;if(j&&j.length!==0){for(let me=0;me<ee;me++){let Ie=O[l]-O[l-1];l++;let qe=new Array(Ie-1);de=F[h]-F[h-1],h++;let He=c.vertexBufferType===ta.VEC_2?_x(H,j,C,de):yx(H,j,C,de,0,D);C+=de;for(let We=0;We<qe.length;We++)de=F[h]-F[h-1],h++,qe[We]=c.vertexBufferType===ta.VEC_2?_x(H,j,C,de):yx(H,j,C,de,0,D),C+=de;ne[me]=y.createPolygon(He,qe)}s[_++]=y.createMultiPolygon(ne)}else{for(let me=0;me<ee;me++){let Ie=O[l]-O[l-1];l++;let qe=new Array(Ie-1);de=F[h]-F[h-1],h++;let He=gx(H,x,de);x+=2*de;for(let We=0;We<qe.length;We++){let lt=F[h]-F[h-1];h++,qe[We]=gx(H,x,lt),x+=2*lt}ne[me]=y.createPolygon(He,qe)}s[_++]=y.createMultiPolygon(ne)}}}}return s}function gx(c,s,l){return vI(c,s,l,!0)}function _x(c,s,l,h){return bI(c,s,l,h,!0)}function yx(c,s,l,h,p,_){return wI(c,s,l,h,!0,_)}function vI(c,s,l,h){let p=new Array(h?l+1:l);for(let _=0;_<2*l;_+=2)p[_/2]=new d(c[s+_],c[s+_+1]);return h&&(p[p.length-1]=p[0]),p}function bI(c,s,l,h,p){let _=new Array(p?h+1:h);for(let y=0;y<2*h;y+=2){let x=2*s[l+y/2];_[y/2]=new d(c[x],c[x+1])}return p&&(_[_.length-1]=_[0]),_}function wI(c,s,l,h,p,_){let y=new Array(p?h+1:h);for(let x=0;x<h;x++){let C=yI(c[s[l+x]],_.numBits,_.coordinateShift);y[x]=new d(C.x,C.y)}return p&&(y[y.length-1]=y[0]),y}class hB{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(s,l,h,p,_){this._vertexBufferType=s,this._topologyVector=l,this._vertexOffsets=h,this._vertexBuffer=p,this._mortonSettings=_}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){let s=dB(this),l=0;for(;l<this.numGeometries;)yield{coordinates:s[l],type:this.geometryType(l)},l++}getSimpleEncodedVertex(s){let l=this.vertexOffsets?2*this.vertexOffsets[s]:2*s;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getVertex(s){if(this.vertexOffsets&&this.mortonSettings){let h=yI(this.vertexBuffer[this.vertexOffsets[s]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[h.x,h.y]}let l=this.vertexOffsets?2*this.vertexOffsets[s]:2*s;return[this.vertexBuffer[l],this.vertexBuffer[l+1]]}getGeometries(){return dB(this)}get mortonSettings(){return this._mortonSettings}}class fB extends hB{_numGeometries;_geometryType;constructor(s,l,h,p,_,y,x){super(h,p,_,y,x),this._numGeometries=s,this._geometryType=l}geometryType(s){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===qr.POLYGON||this._geometryType===qr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class pB extends hB{_geometryTypes;constructor(s,l,h,p,_,y){super(s,h,p,_,y),this._geometryTypes=l}geometryType(s){return this._geometryTypes[s]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let s=0;s<this.numGeometries;s++)if(this.geometryType(s)===qr.POLYGON||this.geometryType(s)===qr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class mB{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(s,l,h,p){this._triangleOffsets=s,this._indexBuffer=l,this._vertexBuffer=h,this._topologyVector=p}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");let s=new Array(this.numGeometries),l=this._topologyVector,h=l.partOffsets,p=l.ringOffsets,_=l.geometryOffsets,y=0,x=1,C=1,D=1;for(let M=0;M<this.numGeometries;M++)switch(this.geometryType(M)){case qr.POLYGON:{let R=h[x]-h[x-1];x++;let O=[];for(let F=0;F<R;F++){let j=p[C]-p[C-1];C++;let z=[];for(let H=0;H<j;H++){let Q=this._vertexBuffer[y++],le=this._vertexBuffer[y++];z.push(new d(Q,le))}z.length>0&&z.push(z[0]),O.push(z)}s[M]=O,_&&D++}break;case qr.MULTIPOLYGON:{let R=_[D]-_[D-1];D++;let O=[];for(let F=0;F<R;F++){let j=h[x]-h[x-1];x++;for(let z=0;z<j;z++){let H=p[C]-p[C-1];C++;let Q=[];for(let le=0;le<H;le++){let ee=this._vertexBuffer[y++],ne=this._vertexBuffer[y++];Q.push(new d(ee,ne))}Q.length>0&&Q.push(Q[0]),O.push(Q)}}s[M]=O}}return s}[Symbol.iterator](){return null}}function gB(c,s,l,h,p,_){return new FZ(c,s,l,h,p,_)}class FZ extends mB{_numGeometries;_geometryType;constructor(s,l,h,p,_,y){super(h,p,_,y),this._numGeometries=s,this._geometryType=l}geometryType(s){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function _B(c,s,l,h,p){return new LZ(c,s,l,h,p)}class LZ extends mB{_geometryTypes;constructor(s,l,h,p,_){super(l,h,p,_),this._geometryTypes=s}geometryType(s){return this._geometryTypes[s]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function BZ(c,s,l,h,p){let _=Yo(c,l),y=null,x=null,C=null,D=null,M=null,R=null,O=null,F=null;if(mx(_,h,c,l)===Gr.CONST){let z=gI(c,l,_,!1);for(let H=0;H<s-1;H++){let Q=Yo(c,l);switch(Q.physicalStreamType){case vo.LENGTH:switch(Q.logicalStreamType.lengthType){case Fs.GEOMETRIES:y=vd(c,l,Q);break;case Fs.PARTS:x=vd(c,l,Q);break;case Fs.RINGS:C=vd(c,l,Q);break;case Fs.TRIANGLES:O=vd(c,l,Q)}break;case vo.OFFSET:switch(Q.logicalStreamType.offsetType){case pf.VERTEX:D=Xo(c,l,Q,!1);break;case pf.INDEX:F=Xo(c,l,Q,!1)}break;case vo.DATA:ol.VERTEX===Q.logicalStreamType.dictionaryType?M=Xo(c,l,Q,!0):(R={numBits:Q.numBits,coordinateShift:Q.coordinateShift},M=Xo(c,l,Q,!1))}}return F!==null?y!=null||x!=null?gB(h,z,O,F,M,new Fm(y,x,C)):gB(h,z,O,F,M):R===null?(function(H,Q,le,ee,ne){return new fB(H,Q,ta.VEC_2,le,ee,ne)})(h,z,new Fm(y,x,C),D,M):(function(H,Q,le,ee,ne,de){return new fB(H,Q,ta.MORTON,le,ee,ne,de)})(h,z,new Fm(y,x,C),D,M,R)}let j=Xo(c,l,_,!1);for(let z=0;z<s-1;z++){let H=Yo(c,l);switch(H.physicalStreamType){case vo.LENGTH:switch(H.logicalStreamType.lengthType){case Fs.GEOMETRIES:y=Xo(c,l,H,!1);break;case Fs.PARTS:x=Xo(c,l,H,!1);break;case Fs.RINGS:C=Xo(c,l,H,!1);break;case Fs.TRIANGLES:O=vd(c,l,H)}break;case vo.OFFSET:switch(H.logicalStreamType.offsetType){case pf.VERTEX:D=Xo(c,l,H,!1);break;case pf.INDEX:F=Xo(c,l,H,!1)}break;case vo.DATA:ol.VERTEX===H.logicalStreamType.dictionaryType?M=Xo(c,l,H,!0):(R={numBits:H.numBits,coordinateShift:H.coordinateShift},M=Xo(c,l,H,!1))}}return F!==null&&x===null?_B(j,O,F,M):(y!==null?(y=xI(j,y,2),x!==null&&C!==null?(x=yB(j,y,x,!1),C=(function(z,H,Q,le){let ee=new Int32Array(Q[Q.length-1]+1),ne=0;ee[0]=ne;let de=1,me=1,Ie=0;for(let qe=0;qe<z.length;qe++){let He=z[qe],We=H[qe+1]-H[qe];if(He!==0&&He!==3)for(let lt=0;lt<We;lt++){let et=Q[de]-Q[de-1];de++;for(let Le=0;Le<et;Le++)ne=ee[me++]=ne+le[Ie++]}else for(let lt=0;lt<We;lt++)ee[me++]=++ne,de++}return ee})(j,y,x,C)):x!==null&&(x=(function(z,H,Q){let le=new Int32Array(H[H.length-1]+1),ee=0;le[0]=ee;let ne=1,de=0;for(let me=0;me<z.length;me++){let Ie=z[me],qe=H[me+1]-H[me];if(Ie===4||Ie===1)for(let He=0;He<qe;He++)ee=le[ne++]=ee+Q[de++];else for(let He=0;He<qe;He++)le[ne++]=++ee}return le})(j,y,x))):x!==null&&C!==null?(x=xI(j,x,1),C=yB(j,x,C,!0)):x!==null&&(x=xI(j,x,0)),F!==null?_B(j,O,F,M,new Fm(y,x,C)):R===null?(function(z,H,Q,le){return new pB(ta.VEC_2,z,H,Q,le)})(j,new Fm(y,x,C),D,M):(function(z,H,Q,le,ee){return new pB(ta.MORTON,z,H,Q,le,ee)})(j,new Fm(y,x,C),D,M,R))}function xI(c,s,l){let h=new Int32Array(c.length+1),p=0;h[0]=p;let _=0;for(let y=0;y<c.length;y++)p=h[y+1]=p+(c[y]>l?s[_++]:1);return h}function yB(c,s,l,h){let p=new Int32Array(s[s.length-1]+1),_=0;p[0]=_;let y=1,x=0;for(let C=0;C<c.length;C++){let D=c[C],M=s[C+1]-s[C];if(D===5||D===2||h&&(D===4||D===1))for(let R=0;R<M;R++)_=p[y++]=_+l[x++];else for(let R=0;R<M;R++)p[y++]=++_}return p}class VZ extends Nm{dataVector;constructor(s,l,h){super(s,l.getBuffer(),h),this.dataVector=l}getValueFromBuffer(s){return this.dataVector.get(s)}}class jZ extends hx{getValueFromBuffer(s){return this.dataBuffer[s]}}class vB extends Nm{constructor(s,l,h){super(s,BigInt64Array.of(l),h)}getValueFromBuffer(s){return this.dataBuffer[0]}}function $y(c,s,l){return bB(c,Math.ceil(s/8),l)}function bB(c,s,l){let h=new Uint8Array(s),p=0;for(;p<s;){let _=c[l.increment()];if(_<=127){let y=_+3,x=c[l.increment()],C=p+y;h.fill(x,p,C),p=C}else{let y=256-_;for(let x=0;x<y;x++)h[p++]=c[l.increment()]}}return h}let zZ=new TextDecoder;function EI(c,s,l){return l-s>=12?zZ.decode(c.subarray(s,l)):(function(h,p,_){let y="",x=p;for(;x<_;){let C=h[x],D,M,R,O=null,F=C>239?4:C>223?3:C>191?2:1;if(x+F>_)break;F===1?C<128&&(O=C):F===2?(D=h[x+1],(192&D)==128&&(O=(31&C)<<6|63&D,O<=127&&(O=null))):F===3?(D=h[x+1],M=h[x+2],(192&D)==128&&(192&M)==128&&(O=(15&C)<<12|(63&D)<<6|63&M,(O<=2047||O>=55296&&O<=57343)&&(O=null))):F===4&&(D=h[x+1],M=h[x+2],R=h[x+3],(192&D)==128&&(192&M)==128&&(192&R)==128&&(O=(15&C)<<18|(63&D)<<12|(63&M)<<6|63&R,(O<=65535||O>=1114112)&&(O=null))),O===null?(O=65533,F=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),x+=F}return y})(c,s,l)}class CI extends Nm{offsetBuffer;constructor(s,l,h,p){super(s,h,p),this.offsetBuffer=l}}class wB extends CI{textEncoder;constructor(s,l,h,p){super(s,l,h,p??l.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(s){return EI(this.dataBuffer,this.offsetBuffer[s],this.offsetBuffer[s+1])}}class Lm extends CI{indexBuffer;textEncoder;constructor(s,l,h,p,_){super(s,h,p,_??l.length),this.indexBuffer=l,this.indexBuffer=l,this.textEncoder=new TextEncoder}getValueFromBuffer(s){let l=this.indexBuffer[s];return EI(this.dataBuffer,this.offsetBuffer[l],this.offsetBuffer[l+1])}}class xB extends CI{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(s,l,h,p,_,y,x){super(s,h,p,x),this.indexBuffer=l,this.symbolOffsetBuffer=_,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(s){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(h,p,_){let y=[],x=new Array(p.length).fill(0);for(let C=1;C<p.length;C++)x[C]=x[C-1]+p[C-1];for(let C=0;C<_.length;C++)if(_[C]===255)y.push(_[++C]);else{let D=p[_[C]],M=x[_[C]];for(let R=0;R<D;R++)y.push(h[M+R])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));let l=this.indexBuffer[s];return EI(this.decodedDictionary,this.offsetBuffer[l],this.offsetBuffer[l+1])}offsetToLengthBuffer(s){let l=new Uint32Array(s.length-1),h=s[0];for(let p=1;p<s.length;p++){let _=s[p];l[p-1]=_-h,h=_}return l}}function UZ(c,s,l,h,p,_){return l.type==="scalarType"?(function(y,x,C,D,M,R){let O=null,F=0;if(y===0)return null;if(R.nullable){let z=Yo(x,C);F=z.numValues;let H=C.get(),Q=$y(x,F,C);C.set(H+z.byteLength),O=new sl(Q,z.numValues)}let j=O??D;switch(M.physicalType){case 4:case 3:return(function(z,H,Q,le,ee){let ne=Yo(z,H),de=mx(ne,ee,z,H),me=le.physicalType===3;if(de===Gr.FLAT){let Ie=Hy(ee)?_I(z,H,ne,me,ee):Xo(z,H,ne,me);return new uI(Q.name,Ie,ee)}if(de===Gr.SEQUENCE){let Ie=rB(z,H,ne);return new hI(Q.name,Ie[0],Ie[1],ne.numRleValues)}{let Ie=gI(z,H,ne,me);return new fI(Q.name,Ie,ee)}})(x,C,R,M,j);case 9:return(function(z,H,Q,le,ee){let ne=null,de=null,me=null,Ie=null,qe=null,He=null,We=null,lt=null;for(let et=0;et<le;et++){let Le=Yo(H,Q);if(Le.byteLength!==0)switch(Le.physicalStreamType){case vo.PRESENT:{let Ne=$y(H,Le.numValues,Q);He=new sl(Ne,Le.numValues);break}case vo.OFFSET:de=ee!=null||He!=null?_I(H,Q,Le,!1,ee??He):Xo(H,Q,Le,!1);break;case vo.LENGTH:{let Ne=vd(H,Q,Le);Fs.DICTIONARY===Le.logicalStreamType.lengthType?ne=Ne:Fs.SYMBOL===Le.logicalStreamType.lengthType?Ie=Ne:We=Ne;break}case vo.DATA:{let Ne=H.subarray(Q.get(),Q.get()+Le.byteLength);Q.add(Le.byteLength);let _t=Le.logicalStreamType.dictionaryType;ol.FSST===_t?qe=Ne:ol.SINGLE===_t||ol.SHARED===_t?me=Ne:ol.NONE===_t&&(lt=Ne);break}}}return(function(et,Le,Ne,_t,pt,xt,mt){return Le?new xB(et,Ne,_t,pt,xt,Le,mt):null})(z,qe,de,ne,me,Ie,ee??He)??(function(et,Le,Ne,_t,pt){return Le?pt?new Lm(et,Ne,_t,Le,pt):new Lm(et,Ne,_t,Le):null})(z,me,de,ne,ee??He)??(function(et,Le,Ne,_t,pt){if(!Le||!Ne)return null;if(_t)return pt?new Lm(et,_t,Le,Ne,pt):new Lm(et,_t,Le,Ne);if(pt&&pt.size()!==Le.length-1){let xt=new Int32Array(pt.size()),mt=0;for(let Rt=0;Rt<pt.size();Rt++)xt[Rt]=pt.get(Rt)?mt++:0;return new Lm(et,xt,Le,Ne,pt)}return pt?new wB(et,Le,Ne,pt):new wB(et,Le,Ne)})(z,We,lt,de,ee??He)})(R.name,x,C,R.nullable?y-1:y,O);case 0:return(function(z,H,Q,le,ee){let ne=Yo(z,H),de=ne.numValues,me=H.get(),Ie=Hy(ee)?(function(He,We,lt,et){let Le=bB(He,Math.ceil(We/8),lt),Ne=new sl(Le,We),_t=et.size(),pt=new sl(new Uint8Array(_t),_t),xt=0;for(let mt=0;mt<et.size();mt++){let Rt=!!et.get(mt)&&Ne.get(xt++);pt.set(mt,Rt)}return pt.getBuffer()})(z,de,H,ee):$y(z,de,H);H.set(me+ne.byteLength);let qe=new sl(Ie,de);return new VZ(Q.name,qe,ee)})(x,C,R,0,j);case 6:case 5:return(function(z,H,Q,le,ee){let ne=Yo(z,H),de=mx(ne,le,z,H),me=ee.physicalType===5;if(de===Gr.FLAT){let Ie=Hy(le)?(function(qe,He,We,lt,et){return(function(Le,Ne,_t,pt){switch(Ne.logicalLevelTechnique1){case En.DELTA:return Ne.logicalLevelTechnique2===En.RLE&&(Le=tB(Le,Ne.runs,Ne.numRleValues)),(function(xt,mt){let Rt=new BigInt64Array(xt.size()),Pn=0;xt.get(0)?(Rt[0]=xt.get(0)?mt[0]>>1n^-(1n&mt[0]):0n,Pn=1):Rt[0]=0n;let bn=1;for(;bn!=Rt.length;++bn)Rt[bn]=xt.get(bn)?Rt[bn-1]+(mt[Pn]>>1n^-(1n&mt[Pn++])):Rt[bn-1];return Rt})(pt,Le);case En.RLE:return(function(xt,mt,Rt,Pn){let bn=mt;return Rt?(function(Mi,wo,br){let Ai=new BigInt64Array(Mi.size()),vi=0;for(let Un=0;Un<br;Un++){let Ki=Number(wo[Un]),or=wo[Un+br];or=or>>1n^-(1n&or);for(let pi=vi;pi<vi+Ki;pi++)Mi.get(pi)?Ai[pi]=or:(Ai[pi]=0n,vi++);vi+=Ki}return Ai})(Pn,xt,bn.runs):(function(Mi,wo,br){let Ai=new BigInt64Array(Mi.size()),vi=0;for(let Un=0;Un<br;Un++){let Ki=Number(wo[Un]),or=wo[Un+br];for(let pi=vi;pi<vi+Ki;pi++)Mi.get(pi)?Ai[pi]=or:(Ai[pi]=0n,vi++);vi+=Ki}return Ai})(Pn,xt,bn.runs)})(Le,Ne,_t,pt);case En.NONE:return Le=_t?(function(xt,mt){let Rt=new BigInt64Array(xt.size()),Pn=0,bn=0;for(;bn!=Rt.length;++bn)if(xt.get(bn)){let Mi=mt[Pn++];Rt[bn]=Mi>>1n^-(1n&Mi)}else Rt[bn]=0n;return Rt})(pt,Le):(function(xt,mt){let Rt=new BigInt64Array(xt.size()),Pn=0,bn=0;for(;bn!=Rt.length;++bn)Rt[bn]=xt.get(bn)?mt[Pn++]:0n;return Rt})(pt,Le),Le;default:throw new Error("The specified Logical level technique is not supported")}})(fx(qe,He,We.numValues),We,lt,et)})(z,H,ne,me,le):sB(z,H,ne,me);return new lB(Q.name,Ie,le)}if(de===Gr.SEQUENCE){let Ie=oB(z,H,ne);return new cB(Q.name,Ie[0],Ie[1],ne.numRleValues)}{let Ie=aB(z,H,ne,me);return new vB(Q.name,Ie,le)}})(x,C,R,j,M);case 7:return(function(z,H,Q,le){let ee=Yo(z,H),ne=Hy(le)?(function(de,me,Ie,qe){let He=me.get(),We=He+qe*Float32Array.BYTES_PER_ELEMENT,lt=new Uint8Array(de.subarray(He,We)).buffer,et=new Float32Array(lt);me.set(We);let Le=Ie.size(),Ne=new Float32Array(Le),_t=0;for(let pt=0;pt<Le;pt++)Ne[pt]=Ie.get(pt)?et[_t++]:0;return Ne})(z,H,le,ee.numValues):(function(de,me,Ie){let qe=me.get(),He=qe+Ie*Float32Array.BYTES_PER_ELEMENT,We=new Uint8Array(de.subarray(qe,He)).buffer,lt=new Float32Array(We);return me.set(He),lt})(z,H,ee.numValues);return new jZ(Q.name,ne,le)})(x,C,R,j);case 8:return(function(z,H,Q,le){let ee=Yo(z,H),ne=Hy(le)?(function(de,me,Ie,qe){let He=me.get(),We=He+qe*Float64Array.BYTES_PER_ELEMENT,lt=new Uint8Array(de.subarray(He,We)).buffer,et=new Float64Array(lt);me.set(We);let Le=Ie.size(),Ne=new Float64Array(Le),_t=0;for(let pt=0;pt<Le;pt++)Ne[pt]=Ie.get(pt)?et[_t++]:0;return Ne})(z,H,le,ee.numValues):(function(de,me,Ie){let qe=me.get(),He=qe+Ie*Float64Array.BYTES_PER_ELEMENT,We=new Uint8Array(de.subarray(qe,He)).buffer,lt=new Float64Array(We);return me.set(He),lt})(z,H,ee.numValues);return new dI(Q.name,ne,le)})(x,C,R,j);default:throw new Error(`The specified data type for the field is currently not supported: ${M}`)}})(h,c,s,p,l.scalarType,l):h!=1?null:(function(y,x,C,D){let M=null,R=null,O=null,F=null,j=!1;for(;!j;){let le=Yo(y,x);switch(le.physicalStreamType){case vo.LENGTH:Fs.DICTIONARY===le.logicalStreamType.lengthType?M=vd(y,x,le):O=vd(y,x,le);break;case vo.DATA:ol.SINGLE===le.logicalStreamType.dictionaryType||ol.SHARED===le.logicalStreamType.dictionaryType?(R=y.subarray(x.get(),x.get()+le.byteLength),j=!0):F=y.subarray(x.get(),x.get()+le.byteLength),x.add(le.byteLength)}}let z=C.complexType.children,H=[],Q=0;for(let le of z){let ee=io(y,x,1)[0];if(ee==0)continue;let ne=`${C.name}${le.name==="default"?"":":"+le.name}`;if(ee!==2||le.type!=="scalarField"||le.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");let de=Yo(y,x),me=$y(y,de.numValues,x),Ie=Yo(y,x),qe=Ie.decompressedCount!==D?_I(y,x,Ie,!1,new sl(me,de.numValues)):Xo(y,x,Ie,!1);H[Q++]=F?new xB(ne,qe,M,R,O,F,new sl(me,de.numValues)):new Lm(ne,qe,M,R,new sl(me,de.numValues))}return H})(c,s,l,p)}function Hy(c){return c instanceof sl}function $Z(c){if(c.name==="id")return!1;if(c.type==="scalarType"){let s=c.scalarType;if(s.type==="physicalType")switch(s.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(s.type==="logicalType")return!1}else if(c.type==="complexType"){let s=c.complexType;if(s.type==="physicalType")switch(s.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",c),!1}let HZ=new TextDecoder;function EB(c,s){let l=io(c,s,1)[0];if(l===0)return"";let h=s.get(),p=c.subarray(h,h+l);return s.add(l),HZ.decode(p)}function CB(c,s){let l=io(c,s,1)[0]>>>0,h=!!(4&l),p=!!(2&l),_=io(c,s,1)[0]>>>0,y={};if(1&l&&(y.nullable=!0),p){let x={};if(h?(x.type="logicalType",x.logicalType=_):(x.type="physicalType",x.physicalType=_),8&l){let C=io(c,s,1)[0]>>>0;x.children=new Array(C);for(let D=0;D<C;D++)x.children[D]=CB(c,s)}y.type="complexField",y.complexField=x}else{let x={};h?(x.type="logicalType",x.logicalType=_):(x.type="physicalType",x.physicalType=_),y.type="scalarField",y.scalarField=x}return y}function GZ(c,s){let l=io(c,s,1)[0]>>>0,h=(function(p){switch(p){case 0:case 1:case 2:case 3:{let _={};_.nullable=!!(1&p),_.columnScope=0;let y={};return y.physicalType=p>1?6:4,y.type="physicalType",_.scalarType=y,_.type="scalarType",_}case 4:{let _={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:0};return _.type="complexType",_.complexType=y,_}case 30:{let _={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:1};return _.type="complexType",_.complexType=y,_}default:return(function(_){let y=null;switch(_){case 10:case 11:y=0;break;case 12:case 13:y=1;break;case 14:case 15:y=2;break;case 16:case 17:y=3;break;case 18:case 19:y=4;break;case 20:case 21:y=5;break;case 22:case 23:y=6;break;case 24:case 25:y=7;break;case 26:case 27:y=8;break;case 28:case 29:y=9;break;default:return null}let x={};x.nullable=!!(1&_),x.columnScope=0;let C={type:"physicalType"};return C.physicalType=y,x.type="scalarType",x.scalarType=C,x})(p)}})(l);if(!h)throw new Error(`Unsupported column type code: ${l}`);if((function(p){return p>=10})(l)?h.name=EB(c,s):l>=0&&l<=3?h.name="id":l===4&&(h.name="geometry"),(function(p){return p===30})(l)){let p=io(c,s,1)[0]>>>0,_=h.complexType;_.children=new Array(p);for(let y=0;y<p;y++)_.children[y]=CB(c,s)}return h}function qZ(c,s){let l={featureTables:[]},h={};h.name=EB(c,s);let p=io(c,s,1)[0]>>>0,_=io(c,s,1)[0]>>>0;h.columns=new Array(_);for(let y=0;y<_;y++)h.columns[y]=GZ(c,s);return l.featureTables.push(h),[l,p]}function WZ(c,s,l,h,p,_,y=!1){let x=s.scalarType.physicalType,C=mx(p,_,c,l);if(x===4)switch(C){case Gr.FLAT:{let D=Xo(c,l,p,!1);return new uI(h,D,_)}case Gr.SEQUENCE:{let D=rB(c,l,p);return new hI(h,D[0],D[1],p.numRleValues)}case Gr.CONST:{let D=gI(c,l,p,!1);return new fI(h,D,_)}}else switch(C){case Gr.FLAT:{if(y){let M=(function(R,O,F,j){let z=(function(H,Q,le){let ee=new Float64Array(Q);for(let ne=0;ne<Q;ne++)ee[ne]=PZ(H,le);return ee})(R,F.numValues,O);return(function(H,Q,le){switch(Q.logicalLevelTechnique1){case En.DELTA:return Q.logicalLevelTechnique2===En.RLE&&(H=nB(H,Q.runs,Q.numRleValues)),(function(ee){ee[0]=ee[0]%2==1?(ee[0]+1)/-2:ee[0]/2;let ne=ee.length/4*4,de=1;if(ne>=4)for(;de<ne-4;de+=4){let me=ee[de],Ie=ee[de+1],qe=ee[de+2],He=ee[de+3];ee[de]=(me%2==1?(me+1)/-2:me/2)+ee[de-1],ee[de+1]=(Ie%2==1?(Ie+1)/-2:Ie/2)+ee[de],ee[de+2]=(qe%2==1?(qe+1)/-2:qe/2)+ee[de+1],ee[de+3]=(He%2==1?(He+1)/-2:He/2)+ee[de+2]}for(;de!=ee.length;++de)ee[de]=(ee[de]%2==1?(ee[de]+1)/-2:ee[de]/2)+ee[de-1]})(H),H;case En.RLE:return(function(ee,ne,de){return de?(function(me,Ie,qe){let He=new Float64Array(qe),We=0;for(let lt=0;lt<Ie;lt++){let et=me[lt],Le=me[lt+Ie];Le=Le%2==1?(Le+1)/-2:Le/2,He.fill(Le,We,We+et),We+=et}return He})(ee,ne.runs,ne.numRleValues):nB(ee,ne.runs,ne.numRleValues)})(H,Q,le);case En.NONE:return H;default:throw new Error(`The specified Logical level technique is not supported: ${Q.logicalLevelTechnique1}`)}})(z,F,j)})(c,l,p,!1);return new dI(h,M,_)}let D=sB(c,l,p,!1);return new lB(h,D,_)}case Gr.SEQUENCE:{let D=oB(c,l,p);return new cB(h,D[0],D[1],p.numRleValues)}case Gr.CONST:{let D=aB(c,l,p,!1);return new vB(h,D,_)}}throw new Error("Vector type not supported for id column.")}class ZZ{constructor(s,l){var h;switch(this._featureData=s,this.properties=this._featureData.properties||{},(h=this._featureData.geometry)===null||h===void 0?void 0:h.type){case qr.POINT:case qr.MULTIPOINT:this.type=1;break;case qr.LINESTRING:case qr.MULTILINESTRING:this.type=2;break;case qr.POLYGON:case qr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=l,this.id=Number(this._featureData.id)}loadGeometry(){let s=[];for(let l of this._featureData.geometry.coordinates){let h=[];for(let p of l)h.push(new d(p.x,p.y));s.push(h)}return s}}class KZ{constructor(s){this.features=[],this.featureTable=s,this.name=s.name,this.extent=s.extent,this.version=2,this.features=s.getFeatures(),this.length=this.features.length}feature(s){return new ZZ(this.features[s],this.extent)}}class TB{constructor(s){this.layers={};let l=(function(h,p,_=!0){let y=new RZ(0),x=[];for(;y.get()<h.length;){let C=io(h,y,1)[0]>>>0,D=y.get()+C;if(D>h.length)throw new Error(`Block overruns tile: ${D} > ${h.length}`);if(io(h,y,1)[0]>>>0!=1){y.set(D);continue}let M=qZ(h,y),R=M[1],O=M[0].featureTables[0],F=null,j=null,z=[],H=0;for(let le of O.columns){let ee=le.name;if(ee==="id"){let ne=null;if(le.nullable){let me=Yo(h,y),Ie=y.get(),qe=$y(h,me.numValues,y);y.set(Ie+me.byteLength),ne=new sl(qe,me.numValues)}let de=Yo(h,y);H=de.decompressedCount,F=WZ(h,le,y,ee,de,ne??H,_)}else if(ee==="geometry"){let ne=io(h,y,1)[0];if(H===0){let de=y.get();H=Yo(h,y).decompressedCount,y.set(de)}j=BZ(h,ne,y,H)}else{let ne=$Z(le)?io(h,y,1)[0]:1;if(ne===0&&le.type==="scalarType")continue;let de=UZ(h,y,le,ne,H);if(de)if(Array.isArray(de))for(let me of de)z.push(me);else z.push(de)}}let Q=new kZ(O.name,j,F,z,R);x.push(Q),y.set(D)}return x})(new Uint8Array(s));this.layers=l.reduce((h,p)=>Object.assign(Object.assign({},h),{[p.name]:new KZ(p)}),{})}}class YZ{constructor(s,l){this.feature=s,this.type=s.type,this.properties=s.tags?s.tags:{},this.extent=l,"id"in s&&(typeof s.id=="string"?this.id=parseInt(s.id,10):typeof s.id!="number"||isNaN(s.id)||(this.id=s.id))}loadGeometry(){let s=[],l=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(let h of l){let p=[];for(let _ of h)p.push(new d(_[0],_[1]));s.push(p)}return s}}let Gy="_geojsonTileLayer";function XZ(c,s){s.writeVarintField(15,c.version||1),s.writeStringField(1,c.name||""),s.writeVarintField(5,c.extent||4096);let l={keys:[],values:[],keycache:{},valuecache:{}};for(let _=0;_<c.length;_++)l.feature=c.feature(_),s.writeMessage(2,QZ,l);let h=l.keys;for(let _ of h)s.writeStringField(3,_);let p=l.values;for(let _ of p)s.writeMessage(4,tK,_)}function QZ(c,s){if(!c.feature)return;let l=c.feature;l.id!==void 0&&s.writeVarintField(1,l.id),s.writeMessage(2,JZ,c),s.writeVarintField(3,l.type),s.writeMessage(4,eK,l)}function JZ(c,s){for(let l in c.feature?.properties){let h=c.feature.properties[l],p=c.keycache[l];if(h==null)continue;p===void 0&&(c.keys.push(l),p=c.keys.length-1,c.keycache[l]=p),s.writeVarint(p),typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"&&(h=JSON.stringify(h));let _=typeof h+":"+h,y=c.valuecache[_];y===void 0&&(c.values.push(h),y=c.values.length-1,c.valuecache[_]=y),s.writeVarint(y)}}function TI(c,s){return(s<<3)+(7&c)}function SB(c){return c<<1^c>>31}function eK(c,s){let l=c.loadGeometry(),h=c.type,p=0,_=0;for(let y of l){let x=1;h===1&&(x=y.length),s.writeVarint(TI(1,x));let C=h===3?y.length-1:y.length;for(let D=0;D<C;D++){D===1&&h!==1&&s.writeVarint(TI(2,C-1));let M=y[D].x-p,R=y[D].y-_;s.writeVarint(SB(M)),s.writeVarint(SB(R)),p+=M,_+=R}c.type===3&&s.writeVarint(TI(7,1))}}function tK(c,s){let l=typeof c;l==="string"?s.writeStringField(1,c):l==="boolean"?s.writeBooleanField(7,c):l==="number"&&(c%1!=0?s.writeDoubleField(3,c):c<0?s.writeSVarintField(6,c):s.writeVarintField(5,c))}class DB{constructor(s,l){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new hd(ft,16,0),this.grid3D=new hd(ft,16,0),this.featureIndexArray=new Y,this.promoteId=l}insert(s,l,h,p,_,y){let x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,p,_);let C=y?this.grid3D:this.grid;for(let D=0;D<l.length;D++){let M=l[D],R=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){let F=M[O];R[0]=Math.min(R[0],F.x),R[1]=Math.min(R[1],F.y),R[2]=Math.max(R[2],F.x),R[3]=Math.max(R[3],F.y)}R[0]<ft&&R[1]<ft&&R[2]>=0&&R[3]>=0&&C.insert(x,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new hL(new ax(this.rawTileData)).layers:new TB(this.rawTileData).layers,this.sourceLayerCoder=new KL(this.vtLayers?Object.keys(this.vtLayers).sort():[Gy])),this.vtLayers}query(s,l,h,p){this.loadVTLayers();let _=s.params,y=ft/s.tileSize/s.scale,x=Uh(_.filter,_.globalState),C=s.queryGeometry,D=s.queryPadding*y,M=ff.fromPoints(C),R=this.grid.query(M.minX-D,M.minY-D,M.maxX+D,M.maxY+D),O=ff.fromPoints(s.cameraQueryGeometry).expandBy(D),F=this.grid3D.query(O.minX,O.minY,O.maxX,O.maxY,(H,Q,le,ee)=>(function(ne,de,me,Ie,qe){for(let We of ne)if(de<=We.x&&me<=We.y&&Ie>=We.x&&qe>=We.y)return!0;let He=[new d(de,me),new d(de,qe),new d(Ie,qe),new d(Ie,me)];if(ne.length>2){for(let We of He)if(Tm(ne,We))return!0}for(let We=0;We<ne.length-1;We++)if(i9(ne[We],ne[We+1],He))return!0;return!1})(s.cameraQueryGeometry,H-D,Q-D,le+D,ee+D));for(let H of F)R.push(H);R.sort(nK);let j={},z;for(let H=0;H<R.length;H++){let Q=R[H];if(Q===z)continue;z=Q;let le=this.featureIndexArray.get(Q),ee=null;this.loadMatchingFeature(j,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,x,_.layers,_.availableImages,l,h,p,(ne,de,me)=>(ee||(ee=Kl(ne)),de.queryIntersectsFeature({queryGeometry:C,feature:ne,featureState:me,geometry:ee,zoom:this.z,transform:s.transform,pixelsToTileUnits:y,pixelPosMatrix:s.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:s.getElevation})))}return j}loadMatchingFeature(s,l,h,p,_,y,x,C,D,M,R){let O=this.bucketLayerIDs[l];if(y&&!O.some(H=>y.has(H)))return;let F=this.sourceLayerCoder.decode(h),j=this.vtLayers[F].feature(p);if(_.needGeometry){let H=Yl(j,!0);if(!_.filter(new Xn(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!_.filter(new Xn(this.tileID.overscaledZ),j))return;let z=this.getId(j,F);for(let H=0;H<O.length;H++){let Q=O[H];if(y&&!y.has(Q))continue;let le=C[Q];if(!le)continue;let ee={};z&&M&&(ee=M.getState(le.sourceLayer||Gy,z));let ne=ur({},D[Q]);ne.paint=IB(ne.paint,le.paint,j,ee,x),ne.layout=IB(ne.layout,le.layout,j,ee,x);let de=!R||R(j,le,ee);if(!de)continue;let me=new YL(j,this.z,this.x,this.y,z);me.layer=ne;let Ie=s[Q];Ie===void 0&&(Ie=s[Q]=[]),Ie.push({featureIndex:p,feature:me,intersectionZ:de})}}lookupSymbolFeatures(s,l,h,p,_,y,x,C){let D={};this.loadVTLayers();let M=Uh(_.filterSpec,_.globalState);for(let R of s)this.loadMatchingFeature(D,h,p,R,M,y,x,C,l);return D}hasLayer(s){for(let l of this.bucketLayerIDs)for(let h of l)if(s===h)return!0;return!1}getId(s,l){var h;let p=s.id;return this.promoteId&&(p=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((h=s.properties)===null||h===void 0)&&h.cluster)&&this.promoteId&&(p=Number(s.properties.cluster_id))),p}}function IB(c,s,l,h,p){return Ti(c,(_,y)=>{let x=s instanceof tf?s.get(y):null;return x&&x.evaluate?x.evaluate(l,h,p):x})}function nK(c,s){return s-c}function MB(c,s,l,h,p){let _=[];for(let y=0;y<c.length;y++){let x=c[y],C;for(let D=0;D<x.length-1;D++){let M=x[D],R=x[D+1];M.x<s&&R.x<s||(M.x<s?M=new d(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x<s&&(R=new d(s,M.y+(s-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y<l&&R.y<l||(M.y<l?M=new d(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round():R.y<l&&(R=new d(M.x+(l-M.y)/(R.y-M.y)*(R.x-M.x),l)._round()),M.x>=h&&R.x>=h||(M.x>=h?M=new d(h,M.y+(h-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x>=h&&(R=new d(h,M.y+(h-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y>=p&&R.y>=p||(M.y>=p?M=new d(M.x+(p-M.y)/(R.y-M.y)*(R.x-M.x),p)._round():R.y>=p&&(R=new d(M.x+(p-M.y)/(R.y-M.y)*(R.x-M.x),p)._round()),C&&M.equals(C[C.length-1])||(C=[M],_.push(C)),C.push(R)))))}}return _}function AB(c,s,l,h,p){switch(s){case 1:return(function(_,y,x,C){let D=[];for(let M of _)for(let R of M){let O=C===0?R.x:R.y;O>=y&&O<=x&&D.push([R])}return D})(c,l,h,p);case 2:return kB(c,l,h,p,!1);case 3:return kB(c,l,h,p,!0)}return[]}function iK(c,s,l,h,p){let _=h===0?rK:oK,y=[],x=[];for(let M=0;M<c.length-1;M++){let R=c[M],O=c[M+1],F=h===0?R.x:R.y,j=h===0?O.x:O.y,z=!1;F<s?j>s&&y.push(_(R,O,s)):F>l?j<l&&y.push(_(R,O,l)):y.push(R),j<s&&F>=s&&(y.push(_(R,O,s)),z=!0),j>l&&F<=l&&(y.push(_(R,O,l)),z=!0),!p&&z&&(x.push(y),y=[])}let C=c.length-1,D=h===0?c[C].x:c[C].y;return D>=s&&D<=l&&y.push(c[C]),p&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new d(y[0].x,y[0].y)),y.length>0&&x.push(y),x}function kB(c,s,l,h,p){let _=[];for(let y of c){let x=iK(y,s,l,h,p);x.length>0&&_.push(...x)}return _}function rK(c,s,l){return new d(l,c.y+(l-c.x)/(s.x-c.x)*(s.y-c.y))}function oK(c,s,l){return new d(c.x+(l-c.y)/(s.y-c.y)*(s.x-c.x),l)}wt("FeatureIndex",DB,{omit:["rawTileData","sourceLayerCoder"]});class bd extends d{constructor(s,l,h,p){super(s,l),this.angle=h,p!==void 0&&(this.segment=p)}clone(){return new bd(this.x,this.y,this.angle,this.segment)}}function RB(c,s,l,h,p){if(s.segment===void 0||l===0)return!0;let _=s,y=s.segment+1,x=0;for(;x>-l/2;){if(y--,y<0)return!1;x-=c[y].dist(_),_=c[y]}x+=c[y].dist(c[y+1]),y++;let C=[],D=0;for(;x<l/2;){let M=c[y],R=c[y+1];if(!R)return!1;let O=c[y-1].angleTo(M)-M.angleTo(R);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:x,angleDelta:O}),D+=O;x-C[0].distance>h;)D-=C.shift().angleDelta;if(D>p)return!1;y++,x+=M.dist(R)}return!0}function PB(c){let s=0;for(let l=0;l<c.length-1;l++)s+=c[l].dist(c[l+1]);return s}function NB(c,s,l){return c?.6*s*l:0}function OB(c,s){return Math.max(c?c.right-c.left:0,s?s.right-s.left:0)}function sK(c,s,l,h,p,_){let y=NB(l,p,_),x=OB(l,h)*_,C=0,D=PB(c)/2;for(let M=0;M<c.length-1;M++){let R=c[M],O=c[M+1],F=R.dist(O);if(C+F>D){let j=(D-C)/F,z=Si.number(R.x,O.x,j),H=Si.number(R.y,O.y,j),Q=new bd(z,H,O.angleTo(R),M);return Q._round(),!y||RB(c,Q,x,y,s)?Q:void 0}C+=F}}function aK(c,s,l,h,p,_,y,x,C){let D=NB(h,_,y),M=OB(h,p),R=M*y,O=c[0].x===0||c[0].x===C||c[0].y===0||c[0].y===C;return s-R<s/4&&(s=R+s/4),FB(c,O?s/2*x%s:(M/2+2*_)*y*x%s,s,D,l,R,O,!1,C)}function FB(c,s,l,h,p,_,y,x,C){let D=_/2,M=PB(c),R=0,O=s-l,F=[];for(let j=0;j<c.length-1;j++){let z=c[j],H=c[j+1],Q=z.dist(H),le=H.angleTo(z);for(;O+l<R+Q;){O+=l;let ee=(O-R)/Q,ne=Si.number(z.x,H.x,ee),de=Si.number(z.y,H.y,ee);if(ne>=0&&ne<C&&de>=0&&de<C&&O-D>=0&&O+D<=M){let me=new bd(ne,de,le,j);me._round(),h&&!RB(c,me,_,h,p)||F.push(me)}}R+=Q}return x||F.length||y||(F=FB(c,R/2,l,h,p,_,y,!0,C)),F}function LB(c,s,l,h){let p=[],_=c.image,y=_.pixelRatio,x=_.paddedRect.w-2,C=_.paddedRect.h-2,D={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom},M=_.stretchX||[[0,x]],R=_.stretchY||[[0,C]],O=(Ne,_t)=>Ne+_t[1]-_t[0],F=M.reduce(O,0),j=R.reduce(O,0),z=x-F,H=C-j,Q=0,le=F,ee=0,ne=j,de=0,me=z,Ie=0,qe=H;if(_.content&&h){let Ne=_.content,_t=Ne[2]-Ne[0],pt=Ne[3]-Ne[1];(_.textFitWidth||_.textFitHeight)&&(D=RL(c)),Q=vx(M,0,Ne[0]),ee=vx(R,0,Ne[1]),le=vx(M,Ne[0],Ne[2]),ne=vx(R,Ne[1],Ne[3]),de=Ne[0]-Q,Ie=Ne[1]-ee,me=_t-le,qe=pt-ne}let He=D.x1,We=D.y1,lt=D.x2-He,et=D.y2-We,Le=(Ne,_t,pt,xt)=>{let mt=bx(Ne.stretch-Q,le,lt,He),Rt=wx(Ne.fixed-de,me,Ne.stretch,F),Pn=bx(_t.stretch-ee,ne,et,We),bn=wx(_t.fixed-Ie,qe,_t.stretch,j),Mi=bx(pt.stretch-Q,le,lt,He),wo=wx(pt.fixed-de,me,pt.stretch,F),br=bx(xt.stretch-ee,ne,et,We),Ai=wx(xt.fixed-Ie,qe,xt.stretch,j),vi=new d(mt,Pn),Un=new d(Mi,Pn),Ki=new d(Mi,br),or=new d(mt,br),pi=new d(Rt/y,bn/y),ps=new d(wo/y,Ai/y),xo=s*Math.PI/180;if(xo){let Wr=Math.sin(xo),Li=Math.cos(xo),wr=[Li,-Wr,Wr,Li];vi._matMult(wr),Un._matMult(wr),or._matMult(wr),Ki._matMult(wr)}let ms=Ne.stretch+Ne.fixed,Da=_t.stretch+_t.fixed;return{tl:vi,tr:Un,bl:or,br:Ki,tex:{x:_.paddedRect.x+1+ms,y:_.paddedRect.y+1+Da,w:pt.stretch+pt.fixed-ms,h:xt.stretch+xt.fixed-Da},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:pi,pixelOffsetBR:ps,minFontScaleX:me/y/lt,minFontScaleY:qe/y/et,isSDF:l}};if(h&&(_.stretchX||_.stretchY)){let Ne=BB(M,z,F),_t=BB(R,H,j);for(let pt=0;pt<Ne.length-1;pt++){let xt=Ne[pt],mt=Ne[pt+1];for(let Rt=0;Rt<_t.length-1;Rt++)p.push(Le(xt,_t[Rt],mt,_t[Rt+1]))}}else p.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:C+1}));return p}function vx(c,s,l){let h=0;for(let p of c)h+=Math.max(s,Math.min(l,p[1]))-Math.max(s,Math.min(l,p[0]));return h}function BB(c,s,l){let h=[{fixed:-1,stretch:0}];for(let[p,_]of c){let y=h[h.length-1];h.push({fixed:p-y.stretch,stretch:y.stretch}),h.push({fixed:p-y.stretch,stretch:y.stretch+(_-p)})}return h.push({fixed:s+1,stretch:l}),h}function bx(c,s,l,h){return c/s*l+h}function wx(c,s,l,h){return c-s*l/h}wt("Anchor",bd);class xx{constructor(s,l,h,p,_,y,x,C,D,M){var R;if(this.boxStartIndex=s.length,D){let O=y.top,F=y.bottom,j=y.collisionPadding;j&&(O-=j[1],F+=j[3]);let z=F-O;z>0&&(z=Math.max(10,z),this.circleDiameter=z)}else{let O=!((R=y.image)===null||R===void 0)&&R.content&&(y.image.textFitWidth||y.image.textFitHeight)?RL(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};O.y1=O.y1*x-C[0],O.y2=O.y2*x+C[2],O.x1=O.x1*x-C[3],O.x2=O.x2*x+C[1];let F=y.collisionPadding;if(F&&(O.x1-=F[0]*x,O.y1-=F[1]*x,O.x2+=F[2]*x,O.y2+=F[3]*x),M){let j=new d(O.x1,O.y1),z=new d(O.x2,O.y1),H=new d(O.x1,O.y2),Q=new d(O.x2,O.y2),le=M*Math.PI/180;j._rotate(le),z._rotate(le),H._rotate(le),Q._rotate(le),O.x1=Math.min(j.x,z.x,H.x,Q.x),O.x2=Math.max(j.x,z.x,H.x,Q.x),O.y1=Math.min(j.y,z.y,H.y,Q.y),O.y2=Math.max(j.y,z.y,H.y,Q.y)}s.emplaceBack(l.x,l.y,O.x1,O.y1,O.x2,O.y2,h,p,_)}this.boxEndIndex=s.length}}class lK{constructor(s=[],l=(h,p)=>h<p?-1:h>p?1:0){if(this.data=s,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;let s=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),s}peek(){return this.data[0]}_up(s){let{data:l,compare:h}=this,p=l[s];for(;s>0;){let _=s-1>>1,y=l[_];if(h(p,y)>=0)break;l[s]=y,s=_}l[s]=p}_down(s){let{data:l,compare:h}=this,p=this.length>>1,_=l[s];for(;s<p;){let y=1+(s<<1),x=y+1;if(x<this.length&&h(l[x],l[y])<0&&(y=x),h(l[y],_)>=0)break;l[s]=l[y],s=y}l[s]=_}}function cK(c,s=1,l=!1){let h=ff.fromPoints(c[0]),p=Math.min(h.width(),h.height()),_=p/2,y=new lK([],uK),{minX:x,minY:C,maxX:D,maxY:M}=h;if(p===0)return new d(x,C);for(let F=x;F<D;F+=p)for(let j=C;j<M;j+=p)y.push(new Bm(F+_,j+_,_,c));let R=(function(F){let j=0,z=0,H=0,Q=F[0];for(let le=0,ee=Q.length,ne=ee-1;le<ee;ne=le++){let de=Q[le],me=Q[ne],Ie=de.x*me.y-me.x*de.y;z+=(de.x+me.x)*Ie,H+=(de.y+me.y)*Ie,j+=3*Ie}return new Bm(z/j,H/j,0,F)})(c),O=y.length;for(;y.length;){let F=y.pop();(F.d>R.d||!R.d)&&(R=F,l&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,O)),F.max-R.d<=s||(_=F.h/2,y.push(new Bm(F.p.x-_,F.p.y-_,_,c)),y.push(new Bm(F.p.x+_,F.p.y-_,_,c)),y.push(new Bm(F.p.x-_,F.p.y+_,_,c)),y.push(new Bm(F.p.x+_,F.p.y+_,_,c)),O+=4)}return l&&(console.log(`num probes: ${O}`),console.log(`best distance: ${R.d}`)),R.p}function uK(c,s){return s.max-c.max}function Bm(c,s,l,h){this.p=new d(c,s),this.h=l,this.d=(function(p,_){let y=!1,x=1/0;for(let C=0;C<_.length;C++){let D=_[C];for(let M=0,R=D.length,O=R-1;M<R;O=M++){let F=D[M],j=D[O];F.y>p.y!=j.y>p.y&&p.x<(j.x-F.x)*(p.y-F.y)/(j.y-F.y)+F.x&&(y=!y),x=Math.min(x,$F(p,F,j))}}return(y?1:-1)*Math.sqrt(x)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}var bo;r.aP=void 0,(bo=r.aP||(r.aP={}))[bo.center=1]="center",bo[bo.left=2]="left",bo[bo.right=3]="right",bo[bo.top=4]="top",bo[bo.bottom=5]="bottom",bo[bo["top-left"]=6]="top-left",bo[bo["top-right"]=7]="top-right",bo[bo["bottom-left"]=8]="bottom-left",bo[bo["bottom-right"]=9]="bottom-right";let SI=Number.POSITIVE_INFINITY;function VB(c,s){return s[1]!==SI?(function(l,h,p){let _=0,y=0;switch(h=Math.abs(h),p=Math.abs(p),l){case"top-right":case"top-left":case"top":y=p-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-p}switch(l){case"top-right":case"bottom-right":case"right":_=-h;break;case"top-left":case"bottom-left":case"left":_=h}return[_,y]})(c,s[0],s[1]):(function(l,h){let p=0,_=0;h<0&&(h=0);let y=h/Math.SQRT2;switch(l){case"top-right":case"top-left":_=y-7;break;case"bottom-right":case"bottom-left":_=7-y;break;case"bottom":_=7-h;break;case"top":_=h-7}switch(l){case"top-right":case"bottom-right":p=-y;break;case"top-left":case"bottom-left":p=y;break;case"left":p=h;break;case"right":p=-h}return[p,_]})(c,s[0])}function jB(c,s,l){var h;let p=c.layout,_=(h=p.get("text-variable-anchor-offset"))===null||h===void 0?void 0:h.evaluate(s,{},l);if(_){let x=_.values,C=[];for(let D=0;D<x.length;D+=2){let M=C[D]=x[D],R=x[D+1].map(O=>O*Hr);M.startsWith("top")?R[1]-=7:M.startsWith("bottom")&&(R[1]+=7),C[D+1]=R}return new Ro(C)}let y=p.get("text-variable-anchor");if(y){let x;x=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(s,{},l)*Hr,SI]:p.get("text-offset").evaluate(s,{},l).map(D=>D*Hr);let C=[];for(let D of y)C.push(D,VB(D,x));return new Ro(C)}return null}function DI(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dK(c,s,l,h,p,_,y,x,C,D,M,R){let O=_.textMaxSize.evaluate(s,{});O===void 0&&(O=y);let F=c.layers[0].layout,j=F.get("icon-offset").evaluate(s,{},M),z=UB(l.horizontal),H=y/24,Q=c.tilePixelRatio*H,le=c.tilePixelRatio*O/24,ee=c.tilePixelRatio*x,ne=c.tilePixelRatio*F.get("symbol-spacing"),de=F.get("text-padding")*c.tilePixelRatio,me=(function(pt,xt,mt,Rt=1){let Pn=pt.get("icon-padding").evaluate(xt,{},mt),bn=Pn&&Pn.values;return[bn[0]*Rt,bn[1]*Rt,bn[2]*Rt,bn[3]*Rt]})(F,s,M,c.tilePixelRatio),Ie=F.get("text-max-angle")/180*Math.PI,qe=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",He=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",We=F.get("symbol-placement"),lt=ne/2,et=F.get("icon-text-fit"),Le;h&&et!=="none"&&(c.allowVerticalPlacement&&l.vertical&&(Le=PL(h,l.vertical,et,F.get("icon-text-fit-padding"),j,H)),z&&(h=PL(h,z,et,F.get("icon-text-fit-padding"),j,H)));let Ne=M?R.line.getGranularityForZoomLevel(M.z):1,_t=(pt,xt)=>{xt.x<0||xt.x>=ft||xt.y<0||xt.y>=ft||(function(mt,Rt,Pn,bn,Mi,wo,br,Ai,vi,Un,Ki,or,pi,ps,xo,ms,Da,Wr,Li,wr,Yi,Zr,tu,al,Zy){let wd=mt.addToLineVertexArray(Rt,Pn),gf,Vm,jm,zm,qB=0,WB=0,ZB=0,KB=0,OI=-1,FI=-1,nu={},YB=rr("");if(mt.allowVerticalPlacement&&bn.vertical){let Fo=Ai.layout.get("text-rotate").evaluate(Yi,{},al)+90;jm=new xx(vi,Rt,Un,Ki,or,bn.vertical,pi,ps,xo,Fo),br&&(zm=new xx(vi,Rt,Un,Ki,or,br,Da,Wr,xo,Fo))}if(Mi){let Fo=Ai.layout.get("icon-rotate").evaluate(Yi,{}),na=Ai.layout.get("icon-text-fit")!=="none",_f=LB(Mi,Fo,tu,na),cl=br?LB(br,Fo,tu,na):void 0;Vm=new xx(vi,Rt,Un,Ki,or,Mi,Da,Wr,!1,Fo),qB=4*_f.length;let yf=mt.iconSizeData,Xl=null;yf.kind==="source"?(Xl=[Jc*Ai.layout.get("icon-size").evaluate(Yi,{})],Xl[0]>_d&&zr(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):yf.kind==="composite"&&(Xl=[Jc*Zr.compositeIconSizes[0].evaluate(Yi,{},al),Jc*Zr.compositeIconSizes[1].evaluate(Yi,{},al)],(Xl[0]>_d||Xl[1]>_d)&&zr(`${mt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),mt.addSymbols(mt.icon,_f,Xl,wr,Li,Yi,r.az.none,Rt,wd.lineStartIndex,wd.lineLength,-1,al),OI=mt.icon.placedSymbolArray.length-1,cl&&(WB=4*cl.length,mt.addSymbols(mt.icon,cl,Xl,wr,Li,Yi,r.az.vertical,Rt,wd.lineStartIndex,wd.lineLength,-1,al),FI=mt.icon.placedSymbolArray.length-1)}let XB=Object.keys(bn.horizontal);for(let Fo of XB){let na=bn.horizontal[Fo];if(!gf){YB=rr(na.text);let cl=Ai.layout.get("text-rotate").evaluate(Yi,{},al);gf=new xx(vi,Rt,Un,Ki,or,na,pi,ps,xo,cl)}let _f=na.positionedLines.length===1;if(ZB+=zB(mt,Rt,na,wo,Ai,xo,Yi,ms,wd,bn.vertical?r.az.horizontal:r.az.horizontalOnly,_f?XB:[Fo],nu,OI,Zr,al),_f)break}bn.vertical&&(KB+=zB(mt,Rt,bn.vertical,wo,Ai,xo,Yi,ms,wd,r.az.vertical,["vertical"],nu,FI,Zr,al));let pK=gf?gf.boxStartIndex:mt.collisionBoxArray.length,mK=gf?gf.boxEndIndex:mt.collisionBoxArray.length,gK=jm?jm.boxStartIndex:mt.collisionBoxArray.length,_K=jm?jm.boxEndIndex:mt.collisionBoxArray.length,yK=Vm?Vm.boxStartIndex:mt.collisionBoxArray.length,vK=Vm?Vm.boxEndIndex:mt.collisionBoxArray.length,bK=zm?zm.boxStartIndex:mt.collisionBoxArray.length,wK=zm?zm.boxEndIndex:mt.collisionBoxArray.length,ll=-1,Cx=(Fo,na)=>Fo&&Fo.circleDiameter?Math.max(Fo.circleDiameter,na):na;ll=Cx(gf,ll),ll=Cx(jm,ll),ll=Cx(Vm,ll),ll=Cx(zm,ll);let QB=ll>-1?1:0;QB&&(ll*=Zy/Hr),mt.glyphOffsetArray.length>=Rm.MAX_GLYPHS&&zr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Yi.sortKey!==void 0&&mt.addToSortKeyRanges(mt.symbolInstances.length,Yi.sortKey);let xK=jB(Ai,Yi,al),[EK,CK]=(function(Fo,na){let _f=Fo.length,cl=na?.values;if(cl?.length>0)for(let yf=0;yf<cl.length;yf+=2){let Xl=cl[yf+1];Fo.emplaceBack(r.aP[cl[yf]],Xl[0],Xl[1])}return[_f,Fo.length]})(mt.textAnchorOffsets,xK);mt.symbolInstances.emplaceBack(Rt.x,Rt.y,nu.right>=0?nu.right:-1,nu.center>=0?nu.center:-1,nu.left>=0?nu.left:-1,nu.vertical||-1,OI,FI,YB,pK,mK,gK,_K,yK,vK,bK,wK,Un,ZB,KB,qB,WB,QB,0,pi,ll,EK,CK)})(c,xt,pt,l,h,p,Le,c.layers[0],c.collisionBoxArray,s.index,s.sourceLayerIndex,c.index,Q,[de,de,de,de],qe,C,ee,me,He,j,s,_,D,M,y)};if(We==="line")for(let pt of MB(s.geometry,0,0,ft,ft)){let xt=hf(pt,Ne),mt=aK(xt,ne,Ie,l.vertical||z,h,24,le,c.overscaling,ft);for(let Rt of mt)z&&hK(c,z.text,lt,Rt)||_t(xt,Rt)}else if(We==="line-center"){for(let pt of s.geometry)if(pt.length>1){let xt=hf(pt,Ne),mt=sK(xt,Ie,l.vertical||z,h,24,le);mt&&_t(xt,mt)}}else if(s.type==="Polygon")for(let pt of qp(s.geometry,0)){let xt=cK(pt,16);_t(hf(pt[0],Ne,!0),new bd(xt.x,xt.y,0))}else if(s.type==="LineString")for(let pt of s.geometry){let xt=hf(pt,Ne);_t(xt,new bd(xt[0].x,xt[0].y,0))}else if(s.type==="Point")for(let pt of s.geometry)for(let xt of pt)_t([xt],new bd(xt.x,xt.y,0))}function zB(c,s,l,h,p,_,y,x,C,D,M,R,O,F,j){let z=(function(le,ee,ne,de,me,Ie,qe,He){let We=de.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,lt=[];for(let et of ee.positionedLines)for(let Le of et.positionedGlyphs){if(!Le.rect)continue;let Ne=Le.rect||{},_t=4,pt=!0,xt=1,mt=0,Rt=(me||He)&&Le.vertical,Pn=Le.metrics.advance*Le.scale/2;if(He&&ee.verticalizable&&(mt=et.lineOffset/2-(Le.imageName?-(Hr-Le.metrics.width*Le.scale)/2:(Le.scale-1)*Hr)),Le.imageName){let Wr=qe[Le.imageName];pt=Wr.sdf,xt=Wr.pixelRatio,_t=1/xt}let bn=me?[Le.x+Pn,Le.y]:[0,0],Mi=me?[0,0]:[Le.x+Pn+ne[0],Le.y+ne[1]-mt],wo=[0,0];Rt&&(wo=Mi,Mi=[0,0]);let br=Le.metrics.isDoubleResolution?2:1,Ai=(Le.metrics.left-_t)*Le.scale-Pn+Mi[0],vi=(-Le.metrics.top-_t)*Le.scale+Mi[1],Un=Ai+Ne.w/br*Le.scale/xt,Ki=vi+Ne.h/br*Le.scale/xt,or=new d(Ai,vi),pi=new d(Un,vi),ps=new d(Ai,Ki),xo=new d(Un,Ki);if(Rt){let Wr=new d(-Pn,Pn- -17),Li=-Math.PI/2,wr=12-Pn,Yi=new d(22-wr,-(Le.imageName?wr:0)),Zr=new d(...wo);or._rotateAround(Li,Wr)._add(Yi)._add(Zr),pi._rotateAround(Li,Wr)._add(Yi)._add(Zr),ps._rotateAround(Li,Wr)._add(Yi)._add(Zr),xo._rotateAround(Li,Wr)._add(Yi)._add(Zr)}if(We){let Wr=Math.sin(We),Li=Math.cos(We),wr=[Li,-Wr,Wr,Li];or._matMult(wr),pi._matMult(wr),ps._matMult(wr),xo._matMult(wr)}let ms=new d(0,0),Da=new d(0,0);lt.push({tl:or,tr:pi,bl:ps,br:xo,tex:Ne,writingMode:ee.writingMode,glyphOffset:bn,sectionIndex:Le.sectionIndex,isSDF:pt,pixelOffsetTL:ms,pixelOffsetBR:Da,minFontScaleX:0,minFontScaleY:0})}return lt})(0,l,x,p,_,y,h,c.allowVerticalPlacement),H=c.textSizeData,Q=null;H.kind==="source"?(Q=[Jc*p.layout.get("text-size").evaluate(y,{})],Q[0]>_d&&zr(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):H.kind==="composite"&&(Q=[Jc*F.compositeTextSizes[0].evaluate(y,{},j),Jc*F.compositeTextSizes[1].evaluate(y,{},j)],(Q[0]>_d||Q[1]>_d)&&zr(`${c.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),c.addSymbols(c.text,z,Q,x,_,y,D,s,C.lineStartIndex,C.lineLength,O,j);for(let le of M)R[le]=c.text.placedSymbolArray.length-1;return 4*z.length}function UB(c){for(let s in c)return c[s];return null}function hK(c,s,l,h){let p=c.compareText;if(s in p){let _=p[s];for(let y=_.length-1;y>=0;y--)if(h.dist(_[y])<l)return!0}else p[s]=[];return p[s].push(h),!1}let $B=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class II{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[l,h]=new Uint8Array(s,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=h>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let _=$B[15&h];if(!_)throw new Error("Unrecognized array type.");let[y]=new Uint16Array(s,2,1),[x]=new Uint32Array(s,4,1);return new II(x,y,_,s)}constructor(s,l=64,h=Float64Array,p){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=h,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;let _=$B.indexOf(this.ArrayType),y=2*s*this.ArrayType.BYTES_PER_ELEMENT,x=s*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-x%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+x+C,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+C),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+x+C,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=s)}add(s,l){let h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=s,this.coords[this._pos++]=l,h}finish(){let s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return MI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,l,h,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:_,coords:y,nodeSize:x}=this,C=[0,_.length-1,0],D=[];for(;C.length;){let M=C.pop()||0,R=C.pop()||0,O=C.pop()||0;if(R-O<=x){for(let H=O;H<=R;H++){let Q=y[2*H],le=y[2*H+1];Q>=s&&Q<=h&&le>=l&&le<=p&&D.push(_[H])}continue}let F=O+R>>1,j=y[2*F],z=y[2*F+1];j>=s&&j<=h&&z>=l&&z<=p&&D.push(_[F]),(M===0?s<=j:l<=z)&&(C.push(O),C.push(F-1),C.push(1-M)),(M===0?h>=j:p>=z)&&(C.push(F+1),C.push(R),C.push(1-M))}return D}within(s,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:_,nodeSize:y}=this,x=[0,p.length-1,0],C=[],D=h*h;for(;x.length;){let M=x.pop()||0,R=x.pop()||0,O=x.pop()||0;if(R-O<=y){for(let H=O;H<=R;H++)GB(_[2*H],_[2*H+1],s,l)<=D&&C.push(p[H]);continue}let F=O+R>>1,j=_[2*F],z=_[2*F+1];GB(j,z,s,l)<=D&&C.push(p[F]),(M===0?s-h<=j:l-h<=z)&&(x.push(O),x.push(F-1),x.push(1-M)),(M===0?s+h>=j:l+h>=z)&&(x.push(F+1),x.push(R),x.push(1-M))}return C}}function MI(c,s,l,h,p,_){if(p-h<=l)return;let y=h+p>>1;HB(c,s,y,h,p,_),MI(c,s,l,h,y-1,1-_),MI(c,s,l,y+1,p,1-_)}function HB(c,s,l,h,p,_){for(;p>h;){if(p-h>600){let D=p-h+1,M=l-h+1,R=Math.log(D),O=.5*Math.exp(2*R/3),F=.5*Math.sqrt(R*O*(D-O)/D)*(M-D/2<0?-1:1);HB(c,s,l,Math.max(h,Math.floor(l-M*O/D+F)),Math.min(p,Math.floor(l+(D-M)*O/D+F)),_)}let y=s[2*l+_],x=h,C=p;for(qy(c,s,h,l),s[2*p+_]>y&&qy(c,s,h,p);x<C;){for(qy(c,s,x,C),x++,C--;s[2*x+_]<y;)x++;for(;s[2*C+_]>y;)C--}s[2*h+_]===y?qy(c,s,h,C):(C++,qy(c,s,C,p)),C<=l&&(h=C+1),l<=C&&(p=C-1)}}function qy(c,s,l,h){AI(c,l,h),AI(s,2*l,2*h),AI(s,2*l+1,2*h+1)}function AI(c,s,l){let h=c[s];c[s]=c[l],c[l]=h}function GB(c,s,l,h){let p=c-l,_=s-h;return p*p+_*_}var kI;r.cI=void 0,(kI=r.cI||(r.cI={})).create="create",kI.load="load",kI.fullLoad="fullLoad";let Ex=null,Wy=[],RI=1e3/60,PI="loadTime",NI="fullLoadTime",fK={mark(c){performance.mark(c)},frame(c){let s=c;Ex!=null&&Wy.push(s-Ex),Ex=s},clearMetrics(){Ex=null,Wy=[],performance.clearMeasures(PI),performance.clearMeasures(NI);for(let c in r.cI)performance.clearMarks(r.cI[c])},getPerformanceMetrics(){performance.measure(PI,r.cI.create,r.cI.load),performance.measure(NI,r.cI.create,r.cI.fullLoad);let c=performance.getEntriesByName(PI)[0].duration,s=performance.getEntriesByName(NI)[0].duration,l=Wy.length,h=1/(Wy.reduce((_,y)=>_+y,0)/l/1e3),p=Wy.filter(_=>_>RI).reduce((_,y)=>_+(y-RI)/RI,0);return{loadTime:c,fullLoadTime:s,fps:h,percentDroppedFrames:p/(l+p)*100,totalFrames:l}}};r.$=K,r.A=Ge,r.B=dd,r.C=Ur,r.D=It,r.E=it,r.F=function([c,s,l]){return s+=90,s*=Math.PI/180,l*=Math.PI/180,{x:c*Math.cos(s)*Math.sin(l),y:c*Math.sin(s)*Math.sin(l),z:c*Math.cos(l)}},r.G=Si,r.H=Xn,r.I=eI,r.J=zw,r.K=function(c){if(Ni==null){let s=c.navigator?c.navigator.userAgent:null;Ni=!!c.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ni},r.L=class{constructor(c,s){this.target=c,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new IZ(()=>this.process()),this.subscription=kc(this.target,"message",l=>this.receive(l),!1),this.globalScope=Gs(self)?c:window}registerMessageHandler(c,s){this.messageHandlers[c]=s}unregisterMessageHandler(c){delete this.messageHandlers[c]}sendAsync(c,s){return new Promise((l,h)=>{let p=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=s?kc(s.signal,"abort",()=>{_?.unsubscribe(),delete this.resolveRejects[p];let C={id:p,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},MZ):null;this.resolveRejects[p]={resolve:C=>{_?.unsubscribe(),l(C)},reject:C=>{_?.unsubscribe(),h(C)}};let y=[],x=Object.assign(Object.assign({},c),{id:p,sourceMapId:this.mapId,origin:location.origin,data:Xh(c.data,y)});this.target.postMessage(x,{transfer:y})})}receive(c){let s=c.data,l=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!=="resource://android"&&location.origin!=="resource://android"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[l];let h=this.abortControllers[l];return delete this.abortControllers[l],void(h&&h.abort())}if(Gs(self)||s.mustQueue)return this.tasks[l]=s,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,s)}}process(){if(this.taskQueue.length===0)return;let c=this.taskQueue.shift(),s=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(c,s)}processTask(c,s){return o(this,void 0,void 0,function*(){if(s.type==="<response>"){let p=this.resolveRejects[c];return delete this.resolveRejects[c],p?void(s.error?p.reject(Qh(s.error)):p.resolve(Qh(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let l=Qh(s.data),h=new AbortController;this.abortControllers[c]=h;try{let p=yield this.messageHandlers[s.type](s.sourceMapId,l,h);this.completeTask(c,null,p)}catch(p){this.completeTask(c,p)}})}completeTask(c,s,l){let h=[];delete this.abortControllers[c];let p={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?Xh(s):null,data:Xh(l,h)};this.target.postMessage(p,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},r.M=X,r.N=function(){var c=new Ge(16);return Ge!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},r.O=function(c,s,l){var h,p,_,y,x,C,D,M,R,O,F,j,z=l[0],H=l[1],Q=l[2];return s===c?(c[12]=s[0]*z+s[4]*H+s[8]*Q+s[12],c[13]=s[1]*z+s[5]*H+s[9]*Q+s[13],c[14]=s[2]*z+s[6]*H+s[10]*Q+s[14],c[15]=s[3]*z+s[7]*H+s[11]*Q+s[15]):(p=s[1],_=s[2],y=s[3],x=s[4],C=s[5],D=s[6],M=s[7],R=s[8],O=s[9],F=s[10],j=s[11],c[0]=h=s[0],c[1]=p,c[2]=_,c[3]=y,c[4]=x,c[5]=C,c[6]=D,c[7]=M,c[8]=R,c[9]=O,c[10]=F,c[11]=j,c[12]=h*z+x*H+R*Q+s[12],c[13]=p*z+C*H+O*Q+s[13],c[14]=_*z+D*H+F*Q+s[14],c[15]=y*z+M*H+j*Q+s[15]),c},r.P=d,r.Q=function(c,s,l){var h=l[0],p=l[1],_=l[2];return c[0]=s[0]*h,c[1]=s[1]*h,c[2]=s[2]*h,c[3]=s[3]*h,c[4]=s[4]*p,c[5]=s[5]*p,c[6]=s[6]*p,c[7]=s[7]*p,c[8]=s[8]*_,c[9]=s[9]*_,c[10]=s[10]*_,c[11]=s[11]*_,c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},r.R=fs,r.S=function(c,s,l){var h=s[0],p=s[1],_=s[2],y=s[3],x=s[4],C=s[5],D=s[6],M=s[7],R=s[8],O=s[9],F=s[10],j=s[11],z=s[12],H=s[13],Q=s[14],le=s[15],ee=l[0],ne=l[1],de=l[2],me=l[3];return c[0]=ee*h+ne*x+de*R+me*z,c[1]=ee*p+ne*C+de*O+me*H,c[2]=ee*_+ne*D+de*F+me*Q,c[3]=ee*y+ne*M+de*j+me*le,c[4]=(ee=l[4])*h+(ne=l[5])*x+(de=l[6])*R+(me=l[7])*z,c[5]=ee*p+ne*C+de*O+me*H,c[6]=ee*_+ne*D+de*F+me*Q,c[7]=ee*y+ne*M+de*j+me*le,c[8]=(ee=l[8])*h+(ne=l[9])*x+(de=l[10])*R+(me=l[11])*z,c[9]=ee*p+ne*C+de*O+me*H,c[10]=ee*_+ne*D+de*F+me*Q,c[11]=ee*y+ne*M+de*j+me*le,c[12]=(ee=l[12])*h+(ne=l[13])*x+(de=l[14])*R+(me=l[15])*z,c[13]=ee*p+ne*C+de*O+me*H,c[14]=ee*_+ne*D+de*F+me*Q,c[15]=ee*y+ne*M+de*j+me*le,c},r.T=GD,r.U=function(c,s){let l={};for(let h=0;h<s.length;h++){let p=s[h];p in c&&(l[p]=c[p])}return l},r.V=yd,r.W=ls,r.X=UL,r.Y=zL,r.Z=Ee,r._=o,r.a=$u,r.a$=bt,r.a0=xe,r.a1=ju,r.a2=ea,r.a3=HL,r.a4=dx,r.a5=ft,r.a6=function(c,s,l){if(!c)return s||{};if(!s)return c||{};let h=ZL(c),p=ZL(s);(function(y,x){x.removeAll&&(y.add.clear(),y.update.clear(),y.remove.clear(),x.remove.clear());for(let C of x.remove)y.add.delete(C),y.update.delete(C);for(let[C,D]of x.update){let M=y.update.get(C);M&&(x.update.set(C,AZ(M,D)),y.update.delete(C))}})(h,p);let _={};if((h.removeAll||p.removeAll)&&(_.removeAll=!0),_.remove=new Set([...h.remove,...p.remove]),_.add=new Map([...h.add,...p.add]),_.update=new Map([...h.update,...p.update]),_.remove.size&&_.add.size)for(let y of _.add.keys())_.remove.delete(y);return(function(y){let x={};return y.removeAll&&(x.removeAll=y.removeAll),y.remove&&(x.remove=Array.from(y.remove)),y.add&&(x.add=Array.from(y.add.values())),y.update&&(x.update=Array.from(y.update.values())),x})(_)},r.a7=function(c,s){let l=new Map;if(c==null||c.type==null)return l;if(c.type==="Feature"){let h=cI(c,s);return h==null?void 0:(l.set(h,c),l)}if(c.type==="FeatureCollection"){let h=new Set;for(let p of c.features){let _=cI(p,s);if(_==null||h.has(_))return;h.add(_),l.set(_,p)}return l}},r.a8=function(c,s,l){var h,p;let _=[];if(s.removeAll)c.clear();else if(s.remove)for(let y of s.remove){let x=c.get(y);x&&(_.push(x.geometry),c.delete(y))}if(s.add)for(let y of s.add){let x=cI(y,l);if(x==null)continue;let C=c.get(x);C&&_.push(C.geometry),_.push(y.geometry),c.set(x,y)}if(s.update)for(let y of s.update){let x=c.get(y.id);if(!x)continue;let C=!!y.newGeometry,D=y.removeAllProperties||((h=y.removeProperties)===null||h===void 0?void 0:h.length)>0||((p=y.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0;if(!C&&!D)continue;_.push(x.geometry);let M=Object.assign({},x);if(c.set(y.id,M),C&&(_.push(y.newGeometry),M.geometry=y.newGeometry),D){if(M.properties=y.removeAllProperties?{}:Object.assign({},M.properties||{}),y.removeProperties)for(let R of y.removeProperties)delete M.properties[R];if(y.addOrUpdateProperties)for(let{key:R,value:O}of y.addOrUpdateProperties)M.properties[R]=O}}return _},r.a9=Uy,r.aA=function(c,{uSize:s,uSizeT:l},{lowerSize:h,upperSize:p}){return c.kind==="source"?h/Jc:c.kind==="composite"?Si.number(h/Jc,p/Jc,l):s},r.aB=function(c,s){var l=s[0],h=s[1],p=s[2],_=s[3],y=s[4],x=s[5],C=s[6],D=s[7],M=s[8],R=s[9],O=s[10],F=s[11],j=s[12],z=s[13],H=s[14],Q=s[15],le=l*x-h*y,ee=l*C-p*y,ne=l*D-_*y,de=h*C-p*x,me=h*D-_*x,Ie=p*D-_*C,qe=M*z-R*j,He=M*H-O*j,We=M*Q-F*j,lt=R*H-O*z,et=R*Q-F*z,Le=O*Q-F*H,Ne=le*Le-ee*et+ne*lt+de*We-me*He+Ie*qe;return Ne?(c[0]=(x*Le-C*et+D*lt)*(Ne=1/Ne),c[1]=(p*et-h*Le-_*lt)*Ne,c[2]=(z*Ie-H*me+Q*de)*Ne,c[3]=(O*me-R*Ie-F*de)*Ne,c[4]=(C*We-y*Le-D*He)*Ne,c[5]=(l*Le-p*We+_*He)*Ne,c[6]=(H*ne-j*Ie-Q*ee)*Ne,c[7]=(M*Ie-O*ne+F*ee)*Ne,c[8]=(y*et-x*We+D*qe)*Ne,c[9]=(h*We-l*et-_*qe)*Ne,c[10]=(j*me-z*ne+Q*le)*Ne,c[11]=(R*ne-M*me-F*le)*Ne,c[12]=(x*He-y*lt-C*qe)*Ne,c[13]=(l*lt-h*He+p*qe)*Ne,c[14]=(z*ee-j*de-H*le)*Ne,c[15]=(M*de-R*ee+O*le)*Ne,c):null},r.aC=zn,r.aD=function(c){var s=c[0],l=c[1];return Math.sqrt(s*s+l*l)},r.aE=function(c){return c[0]=0,c[1]=0,c},r.aF=function(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c},r.aG=iI,r.aH=$n,r.aI=function(c,s,l,h){let p=s.y-c.y,_=s.x-c.x,y=h.y-l.y,x=h.x-l.x,C=y*_-x*p;if(C===0)return null;let D=(x*(c.y-l.y)-y*(c.x-l.x))/C;return new d(c.x+D*_,c.y+D*p)},r.aJ=MB,r.aK=Cm,r.aL=function(c){let s=1/0,l=1/0,h=-1/0,p=-1/0;for(let _ of c)s=Math.min(s,_.x),l=Math.min(l,_.y),h=Math.max(h,_.x),p=Math.max(p,_.y);return[s,l,h,p]},r.aM=Hr,r.aN=Lt,r.aO=function(c,s,l,h,p=!1){if(!l[0]&&!l[1])return[0,0];let _=p?h==="map"?-c.bearingInRadians:0:h==="viewport"?c.bearingInRadians:0;if(_){let y=Math.sin(_),x=Math.cos(_);l=[l[0]*x-l[1]*y,l[0]*y+l[1]*x]}return[p?l[0]:Lt(s,l[0],c.zoom),p?l[1]:Lt(s,l[1],c.zoom)]},r.aQ=nI,r.aR=DI,r.aS=tI,r.aT=II,r.aU=ir,r.aV=ox,r.aW=ie,r.aX=dt,r.aY=Re,r.aZ=cs,r.a_=GL,r.aa=ff,r.ab=25,r.ac=lI,r.ad=c=>{let s=window.document.createElement("video");return s.muted=!0,new Promise(l=>{s.onloadstart=()=>{l(s)};for(let h of c){let p=window.document.createElement("source");De(h)||(s.crossOrigin="Anonymous"),p.src=h,s.appendChild(p)}})},r.ae=Ke,r.af=function(){return mn++},r.ag=g,r.ah=Rm,r.ai=Gy,r.aj=Uh,r.ak=Yl,r.al=YL,r.am=function(c){let s={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,p,_)=>{let y=p||_;return s[h]=!y||y.toLowerCase(),""}),s["max-age"]){let l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s},r.an=ln,r.ao=85.051129,r.ap=zu,r.aq=function(c){return Math.pow(2,c)},r.ar=kt,r.as=$L,r.at=function(c){return Math.log(c)/Math.LN2},r.au=function(c){var s=c[0],l=c[1];return s*s+l*l},r.av=function(c){if(!c.length)return new Set;let s=Math.max(...c.map(C=>C.canonical.z)),l=1/0,h=-1/0,p=1/0,_=-1/0,y=[];for(let C of c){let{x:D,y:M,z:R}=C.canonical,O=Math.pow(2,s-R),F=D*O,j=M*O;y.push({id:C,x:F,y:j}),F<l&&(l=F),F>h&&(h=F),j<p&&(p=j),j>_&&(_=j)}let x=new Set;for(let C of y)C.x!==l&&C.x!==h&&C.y!==p&&C.y!==_||x.add(C.id);return x},r.aw=function(c,s){let l=Math.abs(2*c.wrap)-+(c.wrap<0),h=Math.abs(2*s.wrap)-+(s.wrap<0);return c.overscaledZ-s.overscaledZ||h-l||s.canonical.y-c.canonical.y||s.canonical.x-c.canonical.x},r.ax=class{constructor(c,s){this.max=c,this.onRemove=s,this.reset()}reset(){for(let c in this.data)for(let s of this.data[c])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(c,s,l){let h=c.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);let p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(c,p)},l)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){let _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){let s=this.data[c].shift();return s.timeout&&clearTimeout(s.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),s.value}getByKey(c){let s=this.data[c];return s?s[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,s){if(!this.has(c))return this;let l=c.wrapped().key,h=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][h];return this.data[l].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){let s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(c){let s=[];for(let l in this.data)for(let h of this.data[l])c(h.value)||s.push(h);for(let l of s)this.remove(l.value.tileID,l)}},r.ay=function(c,s){let l=0,h=0;if(c.kind==="constant")h=c.layoutSize;else if(c.kind!=="source"){let{interpolationType:p,minZoom:_,maxZoom:y}=c,x=p?ln(No.interpolationFactor(p,s,_,y),0,1):0;c.kind==="camera"?h=Si.number(c.minSize,c.maxSize,x):l=x}return{uSizeT:l,uSize:h}},r.b=Ja,r.b$=Xc,r.b0=ct,r.b1=function(c){var s=new Ge(3);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s},r.b2=function(c,s,l){return c[0]=s[0]-l[0],c[1]=s[1]-l[1],c[2]=s[2]-l[2],c},r.b3=function(c,s){var l=s[0],h=s[1],p=s[2],_=l*l+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),c[0]=s[0]*_,c[1]=s[1]*_,c[2]=s[2]*_,c},r.b4=Gt,r.b5=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]},r.b6=function(c,s,l){return c[0]=s[0]*l[0],c[1]=s[1]*l[1],c[2]=s[2]*l[2],c[3]=s[3]*l[3],c},r.b7=Oe,r.b8=function(c,s,l){let h=s[0]*l[0]+s[1]*l[1]+s[2]*l[2];return h===0?null:(-(c[0]*l[0]+c[1]*l[1]+c[2]*l[2])-l[3])/h},r.b9=jn,r.bA=function(){return new Float64Array(3)},r.bB=Ao,r.bC=function(c,s,l){var h=l[0],p=l[1],_=l[2],y=l[3],x=s[0],C=s[1],D=s[2],M=p*D-_*C,R=_*x-h*D,O=h*C-p*x;return c[0]=x+y*(M+=M)+p*(O+=O)-_*(R+=R),c[1]=C+y*R+_*M-h*O,c[2]=D+y*O+h*R-p*M,c},r.bD=function(c,s,l){let h=(p=[c[0],c[1],c[2],s[0],s[1],s[2],l[0],l[1],l[2]])[0]*((M=p[8])*(y=p[4])-(x=p[5])*(D=p[7]))+p[1]*(-M*(_=p[3])+x*(C=p[6]))+p[2]*(D*_-y*C);var p,_,y,x,C,D,M;if(h===0)return null;let R=Gt([],[s[0],s[1],s[2]],[l[0],l[1],l[2]]),O=Gt([],[l[0],l[1],l[2]],[c[0],c[1],c[2]]),F=Gt([],[c[0],c[1],c[2]],[s[0],s[1],s[2]]),j=bt([],R,-c[3]);return ct(j,j,bt([],O,-s[3])),ct(j,j,bt([],F,-l[3])),bt(j,j,1/h),j},r.bE=aI,r.bF=function(){return new Float64Array(4)},r.bG=function(c,s,l,h){var p=[],_=[];return p[0]=s[0]-l[0],p[1]=s[1]-l[1],p[2]=s[2]-l[2],_[0]=p[0]*Math.cos(h)-p[1]*Math.sin(h),_[1]=p[0]*Math.sin(h)+p[1]*Math.cos(h),_[2]=p[2],c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},r.bH=function(c,s,l,h){var p=[],_=[];return p[0]=s[0]-l[0],p[1]=s[1]-l[1],p[2]=s[2]-l[2],_[0]=p[0],_[1]=p[1]*Math.cos(h)-p[2]*Math.sin(h),_[2]=p[1]*Math.sin(h)+p[2]*Math.cos(h),c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},r.bI=function(c,s,l,h){var p=[],_=[];return p[0]=s[0]-l[0],p[1]=s[1]-l[1],p[2]=s[2]-l[2],_[0]=p[2]*Math.sin(h)+p[0]*Math.cos(h),_[1]=p[1],_[2]=p[2]*Math.cos(h)-p[0]*Math.sin(h),c[0]=_[0]+l[0],c[1]=_[1]+l[1],c[2]=_[2]+l[2],c},r.bJ=function(c,s,l){var h=Math.sin(l),p=Math.cos(l),_=s[0],y=s[1],x=s[2],C=s[3],D=s[8],M=s[9],R=s[10],O=s[11];return s!==c&&(c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=_*p-D*h,c[1]=y*p-M*h,c[2]=x*p-R*h,c[3]=C*p-O*h,c[8]=_*h+D*p,c[9]=y*h+M*p,c[10]=x*h+R*p,c[11]=C*h+O*p,c},r.bK=function(c,s){let l=hn(c,360),h=hn(s,360),p=h-l,_=h>l?p-360:p+360;return Math.abs(p)<Math.abs(_)?p:_},r.bL=function(c){return c[0]=0,c[1]=0,c[2]=0,c},r.bM=function(c,s,l,h){let p=Math.sqrt(c*c+s*s),_=Math.sqrt(l*l+h*h);c/=p,s/=p,l/=_,h/=_;let y=Math.acos(c*l+s*h);return-s*l+c*h>0?y:-y},r.bN=function(c,s){let l=hn(c,2*Math.PI),h=hn(s,2*Math.PI);return Math.min(Math.abs(l-h),Math.abs(l-h+2*Math.PI),Math.abs(l-h-2*Math.PI))},r.bO=function(){let c={},s=we.$version;for(let l in we.$root){let h=we.$root[l];if(h.required){let p=null;p=l==="version"?s:h.type==="array"?[]:{},p!=null&&(c[l]=p)}}return c},r.bP=ye,r.bQ=my,r.bR=function c(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(let h=0;h<s.length;h++)if(!c(s[h],l[h]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(let h in s)if(!c(s[h],l[h]))return!1;return!0}return s===l},r.bS=function(c){c=c.slice();let s=Object.create(null);for(let l=0;l<c.length;l++)s[c[l].id]=c[l];for(let l=0;l<c.length;l++)"ref"in c[l]&&(c[l]=Jn(c[l],s[c[l].ref]));return c},r.bT=function(c,s){if(c.type==="custom")return new DZ(c,s);switch(c.type){case"background":return new SZ(c,s);case"circle":return new u9(c,s);case"color-relief":return new g9(c,s);case"fill":return new k9(c,s);case"fill-extrusion":return new $9(c,s);case"heatmap":return new h9(c,s);case"hillshade":return new p9(c,s);case"line":return new Y9(c,s);case"raster":return new FD(c,s);case"symbol":return new ux(c,s)}},r.bU=c=>c.type==="raster",r.bV=Ar,r.bW=function(c,s){if(!c)return[{command:"setStyle",args:[s]}];let l=[];try{if(!St(c.version,s.version))return[{command:"setStyle",args:[s]}];St(c.center,s.center)||l.push({command:"setCenter",args:[s.center]}),St(c.state,s.state)||l.push({command:"setGlobalState",args:[s.state]}),St(c.centerAltitude,s.centerAltitude)||l.push({command:"setCenterAltitude",args:[s.centerAltitude]}),St(c.zoom,s.zoom)||l.push({command:"setZoom",args:[s.zoom]}),St(c.bearing,s.bearing)||l.push({command:"setBearing",args:[s.bearing]}),St(c.pitch,s.pitch)||l.push({command:"setPitch",args:[s.pitch]}),St(c.roll,s.roll)||l.push({command:"setRoll",args:[s.roll]}),St(c.sprite,s.sprite)||l.push({command:"setSprite",args:[s.sprite]}),St(c.glyphs,s.glyphs)||l.push({command:"setGlyphs",args:[s.glyphs]}),St(c.transition,s.transition)||l.push({command:"setTransition",args:[s.transition]}),St(c.light,s.light)||l.push({command:"setLight",args:[s.light]}),St(c.terrain,s.terrain)||l.push({command:"setTerrain",args:[s.terrain]}),St(c.sky,s.sky)||l.push({command:"setSky",args:[s.sky]}),St(c.projection,s.projection)||l.push({command:"setProjection",args:[s.projection]});let h={},p=[];(function(y,x,C,D){let M;for(M in x=x||{},y=y||{})Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(x,M)||Hi(M,C,D));for(M in x)Object.prototype.hasOwnProperty.call(x,M)&&(Object.prototype.hasOwnProperty.call(y,M)?St(y[M],x[M])||(y[M].type==="geojson"&&x[M].type==="geojson"&&kr(y,x,M)?Nt(C,{command:"setGeoJSONSourceData",args:[M,x[M].data]}):hi(M,x,C,D)):cn(M,x,C))})(c.sources,s.sources,p,h);let _=[];c.layers&&c.layers.forEach(y=>{"source"in y&&h[y.source]?l.push({command:"removeLayer",args:[y.id]}):_.push(y)}),l=l.concat(p),(function(y,x,C){x=x||[];let D=(y=y||[]).map(Gi),M=x.map(Gi),R=y.reduce(Pr,{}),O=x.reduce(Pr,{}),F=D.slice(),j=Object.create(null),z,H,Q,le,ee;for(let ne=0,de=0;ne<D.length;ne++)z=D[ne],Object.prototype.hasOwnProperty.call(O,z)?de++:(Nt(C,{command:"removeLayer",args:[z]}),F.splice(F.indexOf(z,de),1));for(let ne=0,de=0;ne<M.length;ne++)z=M[M.length-1-ne],F[F.length-1-ne]!==z&&(Object.prototype.hasOwnProperty.call(R,z)?(Nt(C,{command:"removeLayer",args:[z]}),F.splice(F.lastIndexOf(z,F.length-de),1)):de++,le=F[F.length-ne],Nt(C,{command:"addLayer",args:[O[z],le]}),F.splice(F.length-ne,0,z),j[z]=!0);for(let ne=0;ne<M.length;ne++)if(z=M[ne],H=R[z],Q=O[z],!j[z]&&!St(H,Q))if(St(H.source,Q.source)&&St(H["source-layer"],Q["source-layer"])&&St(H.type,Q.type)){for(ee in Rr(H.layout,Q.layout,C,z,null,"setLayoutProperty"),Rr(H.paint,Q.paint,C,z,null,"setPaintProperty"),St(H.filter,Q.filter)||Nt(C,{command:"setFilter",args:[z,Q.filter]}),St(H.minzoom,Q.minzoom)&&St(H.maxzoom,Q.maxzoom)||Nt(C,{command:"setLayerZoomRange",args:[z,Q.minzoom,Q.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Rr(H[ee],Q[ee],C,z,ee.slice(6),"setPaintProperty"):St(H[ee],Q[ee])||Nt(C,{command:"setLayerProperty",args:[z,ee,Q[ee]]}));for(ee in Q)Object.prototype.hasOwnProperty.call(Q,ee)&&!Object.prototype.hasOwnProperty.call(H,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Rr(H[ee],Q[ee],C,z,ee.slice(6),"setPaintProperty"):St(H[ee],Q[ee])||Nt(C,{command:"setLayerProperty",args:[z,ee,Q[ee]]}))}else Nt(C,{command:"removeLayer",args:[z]}),le=F[F.lastIndexOf(z)+1],Nt(C,{command:"addLayer",args:[Q,le]})})(_,s.layers,l)}catch(h){console.warn("Unable to compute style diff:",h),l=[{command:"setStyle",args:[s]}]}return l},r.bX=function(c){let s=[],l=c.id;return l===void 0&&s.push({message:`layers.${l}: missing required property "id"`}),c.render===void 0&&s.push({message:`layers.${l}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&s.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),s},r.bY=Ti,r.bZ=Yn,r.b_=class extends Ko{constructor(c,s){super(c,s),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},r.ba=function(c,s,l){return c[0]=s[0]*l,c[1]=s[1]*l,c[2]=s[2]*l,c[3]=s[3]*l,c},r.bb=function(c,s){return c[0]*s[0]+c[1]*s[1]+c[2]*s[2]+c[3]},r.bc=WL,r.bd=Pm,r.be=function(c,s,l,h,p){var _=1/Math.tan(s/2);if(c[0]=_/l,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=_,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0){var y=1/(h-p);c[10]=(p+h)*y,c[14]=2*p*h*y}else c[10]=-1,c[14]=-2*h;return c},r.bf=function(c){var s=new Ge(16);return s[0]=c[0],s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=c[6],s[7]=c[7],s[8]=c[8],s[9]=c[9],s[10]=c[10],s[11]=c[11],s[12]=c[12],s[13]=c[13],s[14]=c[14],s[15]=c[15],s},r.bg=function(c,s,l){var h=Math.sin(l),p=Math.cos(l),_=s[0],y=s[1],x=s[2],C=s[3],D=s[4],M=s[5],R=s[6],O=s[7];return s!==c&&(c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[0]=_*p+D*h,c[1]=y*p+M*h,c[2]=x*p+R*h,c[3]=C*p+O*h,c[4]=D*p-_*h,c[5]=M*p-y*h,c[6]=R*p-x*h,c[7]=O*p-C*h,c},r.bh=function(c,s,l){var h=Math.sin(l),p=Math.cos(l),_=s[4],y=s[5],x=s[6],C=s[7],D=s[8],M=s[9],R=s[10],O=s[11];return s!==c&&(c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15]),c[4]=_*p+D*h,c[5]=y*p+M*h,c[6]=x*p+R*h,c[7]=C*p+O*h,c[8]=D*p-_*h,c[9]=M*p-y*h,c[10]=R*p-x*h,c[11]=O*p-C*h,c},r.bi=function(){let c=new Float32Array(16);return kt(c),c},r.bj=function(){let c=new Float64Array(16);return kt(c),c},r.bk=function(){return new Float64Array(16)},r.bl=function(c,s,l){let h=new Float64Array(4);return Ao(h,c,s-90,l),h},r.bm=function(c,s,l,h){var p,_,y,x,C,D=s[0],M=s[1],R=s[2],O=s[3],F=l[0],j=l[1],z=l[2],H=l[3];return(_=D*F+M*j+R*z+O*H)<0&&(_=-_,F=-F,j=-j,z=-z,H=-H),1-_>Te?(p=Math.acos(_),y=Math.sin(p),x=Math.sin((1-h)*p)/y,C=Math.sin(h*p)/y):(x=1-h,C=h),c[0]=x*D+C*F,c[1]=x*M+C*j,c[2]=x*R+C*z,c[3]=x*O+C*H,c},r.bn=function(c){let s=new Float64Array(9);var l,h,p,_,y,x,C,D,M,R,O,F,j,z,H,Q,le,ee;R=(p=(h=c)[0])*(C=p+p),O=(_=h[1])*C,j=(y=h[2])*C,z=y*(D=_+_),Q=(x=h[3])*C,le=x*D,ee=x*(M=y+y),(l=s)[0]=1-(F=_*D)-(H=y*M),l[3]=O-ee,l[6]=j+le,l[1]=O+ee,l[4]=1-R-H,l[7]=z-Q,l[2]=j-le,l[5]=z+Q,l[8]=1-R-F;let ne=cs(-Math.asin(ln(s[2],-1,1))),de,me;return Math.hypot(s[5],s[8])<.001?(de=0,me=-cs(Math.atan2(s[3],s[4]))):(de=cs(s[5]===0&&s[8]===0?0:Math.atan2(s[5],s[8])),me=cs(s[1]===0&&s[0]===0?0:Math.atan2(s[1],s[0]))),{roll:de,pitch:ne+90,bearing:me}},r.bo=function(c,s){return c.roll==s.roll&&c.pitch==s.pitch&&c.bearing==s.bearing},r.bp=_n,r.bq=Yc,r.br=Mm,r.bs=Fy,r.bt=Im,r.bu=di,r.bv=yr,r.bw=Po,r.bx=function(c,s,l,h,p){return di(h,p,ln((c-s)/(l-s),0,1))},r.by=function(c,s,l,h){return c[0]=s[0]+l[0]*h,c[1]=s[1]+l[1]*h,c[2]=s[2]+l[2]*h,c},r.bz=hn,r.c=G,r.c$=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},r.c0=class extends Ko{constructor(c,s){super(c,s),this.current=Os}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let s=1;s<16;s++)if(c[s]!==this.current[s]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},r.c1=uf,r.c2=class extends Ko{constructor(c,s){super(c,s),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},r.c3=class extends Ko{constructor(c,s){super(c,s),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},r.c4=Et,r.c5=function(c,s){var l=Math.sin(s),h=Math.cos(s);return c[0]=h,c[1]=l,c[2]=0,c[3]=-l,c[4]=h,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},r.c6=function(c,s,l){var h=s[0],p=s[1],_=s[2];return c[0]=h*l[0]+p*l[3]+_*l[6],c[1]=h*l[1]+p*l[4]+_*l[7],c[2]=h*l[2]+p*l[5]+_*l[8],c},r.c7=function(c,s,l,h,p,_,y){var x=1/(s-l),C=1/(h-p),D=1/(_-y);return c[0]=-2*x,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*C,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*D,c[11]=0,c[12]=(s+l)*x,c[13]=(p+h)*C,c[14]=(y+_)*D,c[15]=1,c},r.c8=class extends Ko{constructor(c,s){super(c,s),this.current=new Array}set(c){if(c!=this.current){this.current=c;let s=new Float32Array(4*c.length);for(let l=0;l<c.length;l++)s[4*l]=c[l].r,s[4*l+1]=c[l].g,s[4*l+2]=c[l].b,s[4*l+3]=c[l].a;this.gl.uniform4fv(this.location,s)}}},r.c9=class extends Ko{constructor(c,s){super(c,s),this.current=new Array}set(c){if(c!=this.current){this.current=c;let s=new Float32Array(c);this.gl.uniform1fv(this.location,s)}}},r.cA=function(c,s){var l;if(!Eh[s])return!1;let h=c?.target,p=((l=h?.ownerDocument)===null||l===void 0?void 0:l.defaultView)||window;return c instanceof p.MouseEvent||c instanceof p.WheelEvent},r.cB=function(c,s){return Ll[s]&&"touches"in c},r.cC=function(c){return Ll[c]||Eh[c]},r.cD=function(c,s,l){var h=s[0],p=s[1];return c[0]=l[0]*h+l[4]*p+l[12],c[1]=l[1]*h+l[5]*p+l[13],c},r.cE=function(c,s){let{x:l,y:h}=Uy.fromLngLat(s);return!(c<0||c>25||h<0||h>=1||l<0||l>=1)},r.cF=function(c,s){return c[0]=s[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=s[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=s[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},r.cG=class extends _m{},r.cH=fK,r.cJ=fe,r.cK=function(c,s){G.REGISTERED_PROTOCOLS[c]=s},r.cL=function(c){delete G.REGISTERED_PROTOCOLS[c]},r.cM=function(c,s){let l={};for(let p=0;p<c.length;p++){let _=s&&s[c[p].id]||Aw(c[p]);s&&(s[c[p].id]=_);let y=l[_];y||(y=l[_]=[]),y.push(c[p])}let h=[];for(let p in l)h.push(l[p]);return h},r.cN=wt,r.cO=KL,r.cP=DB,r.cQ=AL,r.cR=function(c){var s;c.bucket.createArrays(),c.bucket.tilePixelRatio=ft/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;let l=c.bucket.layers[0],h=l.layout,p=l._unevaluatedLayout._values,_={layoutIconSize:p["icon-size"].possiblyEvaluate(new Xn(c.bucket.zoom+1),c.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Xn(c.bucket.zoom+1),c.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Xn(18))};if(c.bucket.textSizeData.kind==="composite"){let{minZoom:M,maxZoom:R}=c.bucket.textSizeData;_.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Xn(M),c.canonical),p["text-size"].possiblyEvaluate(new Xn(R),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){let{minZoom:M,maxZoom:R}=c.bucket.iconSizeData;_.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Xn(M),c.canonical),p["icon-size"].possiblyEvaluate(new Xn(R),c.canonical)]}let y=h.get("text-line-height")*Hr,x=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",C=h.get("text-keep-upright"),D=h.get("text-size");for(let M of c.bucket.features){let R=h.get("text-font").evaluate(M,{},c.canonical).join(","),O=D.evaluate(M,{},c.canonical),F=_.layoutTextSize.evaluate(M,{},c.canonical),j=_.layoutIconSize.evaluate(M,{},c.canonical),z={horizontal:{},vertical:void 0},H=M.text,Q,le=[0,0];if(H){let de=H.toString(),me=h.get("text-letter-spacing").evaluate(M,{},c.canonical)*Hr,Ie=ND(de)?me:0,qe=h.get("text-anchor").evaluate(M,{},c.canonical),He=jB(l,M,c.canonical);if(!He){let Le=h.get("text-radial-offset").evaluate(M,{},c.canonical);le=Le?VB(qe,[Le*Hr,SI]):h.get("text-offset").evaluate(M,{},c.canonical).map(Ne=>Ne*Hr)}let We=x?"center":h.get("text-justify").evaluate(M,{},c.canonical),lt=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(M,{},c.canonical)*Hr:1/0,et=()=>{c.bucket.allowVerticalPlacement&&pd(de)&&(z.vertical=lx(H,c.glyphMap,c.glyphPositions,c.imagePositions,R,lt,y,qe,"left",Ie,le,r.az.vertical,!0,F,O))};if(!x&&He){let Le=new Set;if(We==="auto")for(let _t=0;_t<He.values.length;_t+=2)Le.add(DI(He.values[_t]));else Le.add(We);let Ne=!1;for(let _t of Le)if(!z.horizontal[_t])if(Ne)z.horizontal[_t]=z.horizontal[0];else{let pt=lx(H,c.glyphMap,c.glyphPositions,c.imagePositions,R,lt,y,"center",_t,Ie,le,r.az.horizontal,!1,F,O);pt&&(z.horizontal[_t]=pt,Ne=pt.positionedLines.length===1)}et()}else{We==="auto"&&(We=DI(qe));let Le=lx(H,c.glyphMap,c.glyphPositions,c.imagePositions,R,lt,y,qe,We,Ie,le,r.az.horizontal,!1,F,O);Le&&(z.horizontal[We]=Le),et(),pd(de)&&x&&C&&(z.vertical=lx(H,c.glyphMap,c.glyphPositions,c.imagePositions,R,lt,y,qe,We,Ie,le,r.az.vertical,!1,F,O))}}let ee=!1;if(M.icon&&M.icon.name){let de=c.imageMap[M.icon.name];de&&(Q=xZ(c.imagePositions[M.icon.name],h.get("icon-offset").evaluate(M,{},c.canonical),h.get("icon-anchor").evaluate(M,{},c.canonical)),ee=!!de.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=ee:c.bucket.sdfIcons!==ee&&zr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}let ne=UB(z.horizontal)||z.vertical;(s=c.bucket).iconsInText||(s.iconsInText=!!ne&&ne.iconsInText),(ne||Q)&&dK(c.bucket,M,z,Q,c.imageMap,_,F,j,le,ee,c.canonical,c.subdivisionGranularity)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},r.cS=KD,r.cT=XD,r.cU=QD,r.cV=function(c){let s=new ax;return(function(l,h){for(let p in l.layers)h.writeMessage(3,XZ,l.layers[p])})(c,s),s.finish()},r.cW=function(c,s,l,h,p,_){let y=AB(c,s,l,p,0);return y=AB(y,s,h,_,1),y},r.cX=class{constructor(c){this.maxEntries=c,this.map=new Map}get(c){let s=this.map.get(c);return s!==void 0&&(this.map.delete(c),this.map.set(c,s)),s}set(c,s){if(this.map.has(c))this.map.delete(c);else if(this.map.size>=this.maxEntries){let l=this.map.keys().next().value;this.map.delete(l)}this.map.set(c,s)}clear(){this.map.clear()}},r.cY=hL,r.cZ=ax,r.c_=TB,r.ca=class extends Zc{},r.cb=eZ,r.cc=class extends cf{},r.cd=HD,r.ce=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},r.cf=XF,r.cg=function(c,s,l){var h=s[0],p=s[1],_=s[2],y=l[3]*h+l[7]*p+l[11]*_+l[15];return c[0]=(l[0]*h+l[4]*p+l[8]*_+l[12])/(y=y||1),c[1]=(l[1]*h+l[5]*p+l[9]*_+l[13])/y,c[2]=(l[2]*h+l[6]*p+l[10]*_+l[14])/y,c},r.ch=class extends xy{},r.ci=class extends a{},r.cj=function(c,s){return c[0]===s[0]&&c[1]===s[1]&&c[2]===s[2]&&c[3]===s[3]&&c[4]===s[4]&&c[5]===s[5]&&c[6]===s[6]&&c[7]===s[7]&&c[8]===s[8]&&c[9]===s[9]&&c[10]===s[10]&&c[11]===s[11]&&c[12]===s[12]&&c[13]===s[13]&&c[14]===s[14]&&c[15]===s[15]},r.ck=function(c,s){var l=c[0],h=c[1],p=c[2],_=c[3],y=c[4],x=c[5],C=c[6],D=c[7],M=c[8],R=c[9],O=c[10],F=c[11],j=c[12],z=c[13],H=c[14],Q=c[15],le=s[0],ee=s[1],ne=s[2],de=s[3],me=s[4],Ie=s[5],qe=s[6],He=s[7],We=s[8],lt=s[9],et=s[10],Le=s[11],Ne=s[12],_t=s[13],pt=s[14],xt=s[15];return Math.abs(l-le)<=Te*Math.max(1,Math.abs(l),Math.abs(le))&&Math.abs(h-ee)<=Te*Math.max(1,Math.abs(h),Math.abs(ee))&&Math.abs(p-ne)<=Te*Math.max(1,Math.abs(p),Math.abs(ne))&&Math.abs(_-de)<=Te*Math.max(1,Math.abs(_),Math.abs(de))&&Math.abs(y-me)<=Te*Math.max(1,Math.abs(y),Math.abs(me))&&Math.abs(x-Ie)<=Te*Math.max(1,Math.abs(x),Math.abs(Ie))&&Math.abs(C-qe)<=Te*Math.max(1,Math.abs(C),Math.abs(qe))&&Math.abs(D-He)<=Te*Math.max(1,Math.abs(D),Math.abs(He))&&Math.abs(M-We)<=Te*Math.max(1,Math.abs(M),Math.abs(We))&&Math.abs(R-lt)<=Te*Math.max(1,Math.abs(R),Math.abs(lt))&&Math.abs(O-et)<=Te*Math.max(1,Math.abs(O),Math.abs(et))&&Math.abs(F-Le)<=Te*Math.max(1,Math.abs(F),Math.abs(Le))&&Math.abs(j-Ne)<=Te*Math.max(1,Math.abs(j),Math.abs(Ne))&&Math.abs(z-_t)<=Te*Math.max(1,Math.abs(z),Math.abs(_t))&&Math.abs(H-pt)<=Te*Math.max(1,Math.abs(H),Math.abs(pt))&&Math.abs(Q-xt)<=Te*Math.max(1,Math.abs(Q),Math.abs(xt))},r.cl=function(c,s){return c[0]=s[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],c[4]=s[4],c[5]=s[5],c[6]=s[6],c[7]=s[7],c[8]=s[8],c[9]=s[9],c[10]=s[10],c[11]=s[11],c[12]=s[12],c[13]=s[13],c[14]=s[14],c[15]=s[15],c},r.cm=c=>c.type==="symbol",r.cn=c=>c.type==="circle",r.co=c=>c.type==="heatmap",r.cp=c=>c.type==="line",r.cq=c=>c.type==="fill",r.cr=c=>c.type==="fill-extrusion",r.cs=c=>c.type==="hillshade",r.ct=c=>c.type==="color-relief",r.cu=c=>c.type==="background",r.cv=c=>c.type==="custom",r.cw=_i,r.cx=function(c,s,l){if(s<=0)return c;let h=1/s;return l===void 0||Math.abs(l)<1e-10?Math.round(c*h)/h:(l>0?Math.ceil(c*h-1e-9):Math.floor(c*h+1e-10))/h},r.cy=function(c,s,l){let h=Ct(s.x-l.x,s.y-l.y),p=Ct(c.x-l.x,c.y-l.y);var _,y;return cs(Math.atan2(h[0]*p[1]-h[1]*p[0],(_=h)[0]*(y=p)[0]+_[1]*y[1]))},r.cz=cr,r.d=De,r.d0=function(c,s,l,h,p){return o(this,void 0,void 0,function*(){if(xe())try{return yield ju(c,s,l,h,p)}catch(_){}return(function(_,y,x,C,D){let M=_.width,R=_.height;xa&&el||(xa=new OffscreenCanvas(M,R),el=xa.getContext("2d",{willReadFrequently:!0})),xa.width=M,xa.height=R,el.drawImage(_,0,0,M,R);let O=el.getImageData(y,x,C,D);return el.clearRect(0,0,M,R),O.data})(c,s,l,h,p)})},r.d1=eL,r.d2=m,r.d3=class{constructor(c,s){this.layers={[Gy]:this},this.name=Gy,this.version=s?s.version:1,this.extent=s?s.extent:4096,this.length=c.length,this.features=c}feature(c){return new YZ(this.features[c],this.extent)}},r.d4=zh,r.d5=ql,r.e=ur,r.f=c=>o(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));let s=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(s)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),r.g=W,r.h=c=>new Promise((s,l)=>{let h=new Image;h.onload=()=>{s(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=Vu})},h.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let p=new Blob([new Uint8Array(c)],{type:"image/png"});h.src=c.byteLength?URL.createObjectURL(p):Vu}),r.i=Gs,r.j=(c,s)=>Me(ur(c,{type:"json"}),s),r.k=$e,r.l=Xe,r.m=Me,r.n=(c,s)=>Me(ur(c,{type:"arrayBuffer"}),s),r.o=function(c){return new ax(c).readFields(pZ,[])},r.p=ML,r.q=function(c){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(c))},r.r=ky,r.s=kc,r.t=Oo,r.u=we,r.v=Kh,r.w=zr,r.x=by,r.y=Yh,r.z=ef}),e("worker",["./shared"],function(r){"use strict";class o{constructor(G,W){this.keyCache={},G&&this.replace(G,W)}replace(G,W){this._layerConfigs={},this._layers={},this.update(G,[],W)}update(G,W,X){for(let ye of G){this._layerConfigs[ye.id]=ye;let Me=this._layers[ye.id]=r.bT(ye,X);Me._featureFilter=r.aj(Me.filter,X),this.keyCache[ye.id]&&delete this.keyCache[ye.id]}for(let ye of W)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};let fe=r.cM(Object.values(this._layerConfigs),this.keyCache);for(let ye of fe){let Me=ye.map(it=>this._layers[it.id]),De=Me[0];if(De.isHidden())continue;let Ce=De.source||"",Se=this.familiesBySource[Ce];Se||(Se=this.familiesBySource[Ce]={});let Xe=De.sourceLayer||r.ai,$e=Se[Xe];$e||($e=Se[Xe]=[]),$e.push(Me)}}}class d{constructor(G){let W={},X=[];for(let De in G){let Ce=G[De],Se=W[De]={};for(let Xe in Ce){let $e=Ce[+Xe];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;let it={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};X.push(it),Se[Xe]={rect:it,metrics:$e.metrics}}}let{w:fe,h:ye}=r.p(X),Me=new r.r({width:fe||1,height:ye||1});for(let De in G){let Ce=G[De];for(let Se in Ce){let Xe=Ce[+Se];if(!Xe||Xe.bitmap.width===0||Xe.bitmap.height===0)continue;let $e=W[De][Se].rect;r.r.copy(Xe.bitmap,Me,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Xe.bitmap)}}this.image=Me,this.positions=W}}r.cN("GlyphAtlas",d);class m{constructor(G){this.tileID=new r.a2(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,W,X,fe,ye){return r._(this,void 0,void 0,function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new r.ag;let Me=new r.cO(Object.keys(G.layers).sort()),De=new r.cP(this.tileID,this.promoteId);De.bucketLayerIDs=[];let Ce={},Se={featureIndex:De,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:X,subdivisionGranularity:ye},Xe=W.familiesBySource[this.source];for(let Ke in Xe){let dr=G.layers[Ke];if(!dr)continue;dr.version===1&&r.w(`Vector tile source "${this.source}" layer "${Ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let qo=Me.encode(Ke),Rc=[];for(let er=0;er<dr.length;er++){let ut=dr.feature(er),nn=De.getId(ut,Ke);Rc.push({feature:ut,id:nn,index:er,sourceLayerIndex:qo})}for(let er of Xe[Ke]){let ut=er[0];ut.source!==this.source&&r.w(`layer.source = ${ut.source} does not equal this.source = ${this.source}`),ut.isHidden(this.zoom,!0)||(b(er,this.zoom,X),(Ce[ut.id]=ut.createBucket({index:De.bucketLayerIDs.length,layers:er,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qo,sourceID:this.source})).populate(Rc,Se,this.tileID.canonical),De.bucketLayerIDs.push(er.map(nn=>nn.id)))}}let $e=r.bY(Se.glyphDependencies,Ke=>Object.keys(Ke).map(Number));this.inFlightDependencies.forEach(Ke=>Ke?.abort()),this.inFlightDependencies=[];let it=Promise.resolve({});if(Object.keys($e).length){let Ke=new AbortController;this.inFlightDependencies.push(Ke),it=fe.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},Ke)}let we=Object.keys(Se.iconDependencies),Zt=Promise.resolve({});if(we.length){let Ke=new AbortController;this.inFlightDependencies.push(Ke),Zt=fe.sendAsync({type:"GI",data:{icons:we,source:this.source,tileID:this.tileID,type:"icons"}},Ke)}let Jn=Object.keys(Se.patternDependencies),St=Promise.resolve({});if(Jn.length){let Ke=new AbortController;this.inFlightDependencies.push(Ke),St=fe.sendAsync({type:"GI",data:{icons:Jn,source:this.source,tileID:this.tileID,type:"patterns"}},Ke)}let Nt=Se.dashDependencies,cn=Promise.resolve({});if(Object.keys(Nt).length){let Ke=new AbortController;this.inFlightDependencies.push(Ke),cn=fe.sendAsync({type:"GDA",data:{dashes:Nt}},Ke)}let[Hi,hi,kr,Rr]=yield Promise.all([it,Zt,St,cn]),Gi=new d(Hi),Pr=new r.cQ(hi,kr);for(let Ke in Ce){let dr=Ce[Ke];dr instanceof r.ah?(b(dr.layers,this.zoom,X),r.cR({bucket:dr,glyphMap:Hi,glyphPositions:Gi.positions,imageMap:hi,imagePositions:Pr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):dr.hasDependencies&&(dr instanceof r.cS||dr instanceof r.cT||dr instanceof r.cU)&&(b(dr.layers,this.zoom,X),dr.addFeatures(Se,this.tileID.canonical,Pr.patternPositions,Rr))}return this.status="done",{buckets:Object.values(Ce).filter(Ke=>!Ke.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gi.image,imageAtlas:Pr,dashPositions:Rr,glyphMap:this.returnDependencies?Hi:null,iconMap:this.returnDependencies?hi:null,glyphPositions:this.returnDependencies?Gi.positions:null}})}}function b(Ee,G,W){let X=new r.H(G);for(let fe of Ee)fe.recalculate(X,W)}class T{constructor(G,W,X,fe,ye){this.type=G,this.properties=X||{},this.extent=ye,this.pointsArray=W,this.id=fe}loadGeometry(){return this.pointsArray.map(G=>G.map(W=>new r.P(W.x,W.y)))}}class A{constructor(G,W,X){this.version=2,this._myFeatures=G,this.name=W,this.length=G.length,this.extent=X}feature(G){return this._myFeatures[G]}}class N{constructor(){this.layers={}}addLayer(G){this.layers[G.name]=G}}function q(Ee){let G=r.cV(Ee);return G.byteOffset===0&&G.byteLength===G.buffer.byteLength||(G=new Uint8Array(G)),{vectorTile:Ee,rawData:G.buffer}}function J(Ee,G,W){let{extent:X}=Ee,fe=Math.pow(2,W.z-G.z),ye=(W.x-G.x*fe)*X,Me=(W.y-G.y*fe)*X,De=[];for(let Ce=0;Ce<Ee.length;Ce++){let Se=Ee.feature(Ce),Xe=Se.loadGeometry();for(let it of Xe)for(let we of it)we.x=we.x*fe-ye,we.y=we.y*fe-Me;let $e=128;Xe=r.cW(Xe,Se.type,-$e,-$e,X+$e,X+$e),Xe.length!==0&&De.push(new T(Se.type,Xe,Se.properties,Se.id,X))}return new A(De,Ee.name,X)}class K{constructor(G,W,X){this.actor=G,this.layerIndex=W,this.availableImages=X,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new r.cX(1e3)}loadVectorTile(G,W){return r._(this,void 0,void 0,function*(){let X=yield r.n(G.request,W);try{return{vectorTile:G.encoding!=="mlt"?new r.cY(new r.cZ(X.data)):new r.c_(X.data),rawData:X.data,cacheControl:X.cacheControl,expires:X.expires}}catch(fe){let ye=new Uint8Array(X.data),Me=`Unable to parse the tile at ${G.request.url}, `;throw Me+=ye[0]===31&&ye[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.message}`,new Error(Me)}})}loadTile(G){return r._(this,void 0,void 0,function*(){let{uid:W,overzoomParameters:X}=G;X&&(G.request=X.overzoomRequest);let fe=!!(G&&G.request&&G.request.collectResourceTiming)&&new r.c$(G.request),ye=new m(G);this.loading[W]=ye;let Me=new AbortController;ye.abort=Me;try{let De=yield this.loadVectorTile(G,Me);if(delete this.loading[W],!De)return null;if(X){let it=this._getOverzoomTile(G,De.vectorTile);De.rawData=it.rawData,De.vectorTile=it.vectorTile}let Ce=De.rawData,Se={};De.expires&&(Se.expires=De.expires),De.cacheControl&&(Se.cacheControl=De.cacheControl);let Xe={};if(fe){let it=fe.finish();it&&(Xe.resourceTiming=JSON.parse(JSON.stringify(it)))}ye.vectorTile=De.vectorTile;let $e=ye.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity);this.loaded[W]=ye,this.fetching[W]={rawTileData:Ce,cacheControl:Se,resourceTiming:Xe};try{let it=yield $e;return r.e({rawTileData:Ce.slice(0),encoding:G.encoding},it,Se,Xe)}finally{delete this.fetching[W]}}catch(De){throw delete this.loading[W],ye.status="done",this.loaded[W]=ye,De}})}_getOverzoomTile(G,W){let{tileID:X,source:fe,overzoomParameters:ye}=G,{maxZoomTileID:Me}=ye,De=`${Me.key}_${X.key}`,Ce=this.overzoomedTileResultCache.get(De);if(Ce)return Ce;let Se=new N,Xe=this.layerIndex.familiesBySource[fe];for(let it in Xe){let we=W.layers[it];if(!we)continue;let Zt=J(we,Me,X.canonical);Zt.length>0&&Se.addLayer(Zt)}let $e=q(Se);return this.overzoomedTileResultCache.set(De,$e),$e}reloadTile(G){return r._(this,void 0,void 0,function*(){let W=G.uid;if(!this.loaded||!this.loaded[W])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let X=this.loaded[W];if(X.showCollisionBoxes=G.showCollisionBoxes,X.status==="parsing"){let fe=yield X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity),ye;if(this.fetching[W]){let{rawTileData:Me,cacheControl:De,resourceTiming:Ce}=this.fetching[W];delete this.fetching[W],ye=r.e({rawTileData:Me.slice(0),encoding:G.encoding},fe,De,Ce)}else ye=fe;return ye}if(X.status==="done"&&X.vectorTile)return X.parse(X.vectorTile,this.layerIndex,this.availableImages,this.actor,G.subdivisionGranularity)})}abortTile(G){return r._(this,void 0,void 0,function*(){let W=this.loading,X=G.uid;W&&W[X]&&W[X].abort&&(W[X].abort.abort(),delete W[X])})}removeTile(G){return r._(this,void 0,void 0,function*(){this.loaded&&this.loaded[G.uid]&&delete this.loaded[G.uid]})}}class xe{constructor(){this.loaded={}}loadTile(G){return r._(this,void 0,void 0,function*(){let{uid:W,encoding:X,rawImageData:fe,redFactor:ye,greenFactor:Me,blueFactor:De,baseShift:Ce}=G,Se=fe.width+2,Xe=fe.height+2,$e=r.b(fe)?new r.R({width:Se,height:Xe},yield r.d0(fe,-1,-1,Se,Xe)):fe,it=new r.d1(W,$e,X,ye,Me,De,Ce);return this.loaded=this.loaded||{},this.loaded[W]=it,it})}removeTile(G){let W=this.loaded,X=G.uid;W&&W[X]&&delete W[X]}}var Te,Ge,Et=(function(){if(Ge)return Te;function Ee(W,X){if(W.length!==0){G(W[0],X);for(var fe=1;fe<W.length;fe++)G(W[fe],!X)}}function G(W,X){for(var fe=0,ye=0,Me=0,De=W.length,Ce=De-1;Me<De;Ce=Me++){var Se=(W[Me][0]-W[Ce][0])*(W[Ce][1]+W[Me][1]),Xe=fe+Se;ye+=Math.abs(fe)>=Math.abs(Se)?fe-Xe+Se:Se-Xe+fe,fe=Xe}fe+ye>=0!=!!X&&W.reverse()}return Ge=1,Te=function W(X,fe){var ye,Me=X&&X.type;if(Me==="FeatureCollection")for(ye=0;ye<X.features.length;ye++)W(X.features[ye],fe);else if(Me==="GeometryCollection")for(ye=0;ye<X.geometries.length;ye++)W(X.geometries[ye],fe);else if(Me==="Feature")W(X.geometry,fe);else if(Me==="Polygon")Ee(X.coordinates,fe);else if(Me==="MultiPolygon")for(ye=0;ye<X.coordinates.length;ye++)Ee(X.coordinates[ye],fe);return X}})(),kt=r.d2(Et);let Ue={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},Oe=Math.fround||(Qe=new Float32Array(1),Ee=>(Qe[0]=+Ee,Qe[0]));var Qe;class ct{constructor(G){this.options=Object.assign(Object.create(Ue),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){let{log:W,minZoom:X,maxZoom:fe}=this.options;W&&console.time("total time");let ye=`prepare ${G.length} points`;W&&console.time(ye),this.points=G;let Me=[];for(let Ce=0;Ce<G.length;Ce++){let Se=G[Ce];if(!Se.geometry)continue;let[Xe,$e]=Se.geometry.coordinates,it=Oe(Bt(Xe)),we=Oe(jn($e));Me.push(it,we,1/0,Ce,-1,1),this.options.reduce&&Me.push(0)}let De=this.trees[fe+1]=this._createTree(Me);W&&console.timeEnd(ye);for(let Ce=fe;Ce>=X;Ce--){let Se=+Date.now();De=this.trees[Ce]=this._createTree(this._cluster(De,Ce)),W&&console.log("z%d: %d clusters in %dms",Ce,De.numItems,+Date.now()-Se)}return W&&console.timeEnd("total time"),this}getClusters(G,W){let X=((G[0]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,G[1])),ye=G[2]===180?180:((G[2]+180)%360+360)%360-180,Me=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)X=-180,ye=180;else if(X>ye){let $e=this.getClusters([X,fe,180,Me],W),it=this.getClusters([-180,fe,ye,Me],W);return $e.concat(it)}let De=this.trees[this._limitZoom(W)],Ce=De.range(Bt(X),jn(Me),Bt(ye),jn(fe)),Se=De.data,Xe=[];for(let $e of Ce){let it=this.stride*$e;Xe.push(Se[it+5]>1?bt(Se,it,this.clusterProps):this.points[Se[it+3]])}return Xe}getChildren(G){let W=this._getOriginId(G),X=this._getOriginZoom(G),fe="No cluster with the specified id.",ye=this.trees[X];if(!ye)throw new Error(fe);let Me=ye.data;if(W*this.stride>=Me.length)throw new Error(fe);let De=this.options.radius/(this.options.extent*Math.pow(2,X-1)),Ce=ye.within(Me[W*this.stride],Me[W*this.stride+1],De),Se=[];for(let Xe of Ce){let $e=Xe*this.stride;Me[$e+4]===G&&Se.push(Me[$e+5]>1?bt(Me,$e,this.clusterProps):this.points[Me[$e+3]])}if(Se.length===0)throw new Error(fe);return Se}getLeaves(G,W,X){let fe=[];return this._appendLeaves(fe,G,W=W||10,X=X||0,0),fe}getTile(G,W,X){let fe=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Me,radius:De}=this.options,Ce=De/Me,Se=(X-Ce)/ye,Xe=(X+1+Ce)/ye,$e={features:[]};return this._addTileFeatures(fe.range((W-Ce)/ye,Se,(W+1+Ce)/ye,Xe),fe.data,W,X,ye,$e),W===0&&this._addTileFeatures(fe.range(1-Ce/ye,Se,1,Xe),fe.data,ye,X,ye,$e),W===ye-1&&this._addTileFeatures(fe.range(0,Se,Ce/ye,Xe),fe.data,-1,X,ye,$e),$e.features.length?$e:null}getClusterExpansionZoom(G){let W=this._getOriginZoom(G)-1;for(;W<=this.options.maxZoom;){let X=this.getChildren(G);if(W++,X.length!==1)break;G=X[0].properties.cluster_id}return W}_appendLeaves(G,W,X,fe,ye){let Me=this.getChildren(W);for(let De of Me){let Ce=De.properties;if(Ce&&Ce.cluster?ye+Ce.point_count<=fe?ye+=Ce.point_count:ye=this._appendLeaves(G,Ce.cluster_id,X,fe,ye):ye<fe?ye++:G.push(De),G.length===X)break}return ye}_createTree(G){let W=new r.aT(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<G.length;X+=this.stride)W.add(G[X],G[X+1]);return W.finish(),W.data=G,W}_addTileFeatures(G,W,X,fe,ye,Me){for(let De of G){let Ce=De*this.stride,Se=W[Ce+5]>1,Xe,$e,it;if(Se)Xe=Gt(W,Ce,this.clusterProps),$e=W[Ce],it=W[Ce+1];else{let Jn=this.points[W[Ce+3]];Xe=Jn.properties;let[St,Nt]=Jn.geometry.coordinates;$e=Bt(St),it=jn(Nt)}let we={type:1,geometry:[[Math.round(this.options.extent*($e*ye-X)),Math.round(this.options.extent*(it*ye-fe))]],tags:Xe},Zt;Zt=Se||this.options.generateId?W[Ce+3]:this.points[W[Ce+3]].id,Zt!==void 0&&(we.id=Zt),Me.features.push(we)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,W){let{radius:X,extent:fe,reduce:ye,minPoints:Me}=this.options,De=X/(fe*Math.pow(2,W)),Ce=G.data,Se=[],Xe=this.stride;for(let $e=0;$e<Ce.length;$e+=Xe){if(Ce[$e+2]<=W)continue;Ce[$e+2]=W;let it=Ce[$e],we=Ce[$e+1],Zt=G.within(Ce[$e],Ce[$e+1],De),Jn=Ce[$e+5],St=Jn;for(let Nt of Zt){let cn=Nt*Xe;Ce[cn+2]>W&&(St+=Ce[cn+5])}if(St>Jn&&St>=Me){let Nt,cn=it*Jn,Hi=we*Jn,hi=-1,kr=($e/Xe<<5)+(W+1)+this.points.length;for(let Rr of Zt){let Gi=Rr*Xe;if(Ce[Gi+2]<=W)continue;Ce[Gi+2]=W;let Pr=Ce[Gi+5];cn+=Ce[Gi]*Pr,Hi+=Ce[Gi+1]*Pr,Ce[Gi+4]=kr,ye&&(Nt||(Nt=this._map(Ce,$e,!0),hi=this.clusterProps.length,this.clusterProps.push(Nt)),ye(Nt,this._map(Ce,Gi)))}Ce[$e+4]=kr,Se.push(cn/St,Hi/St,1/0,kr,-1,St),ye&&Se.push(hi)}else{for(let Nt=0;Nt<Xe;Nt++)Se.push(Ce[$e+Nt]);if(St>1)for(let Nt of Zt){let cn=Nt*Xe;if(!(Ce[cn+2]<=W)){Ce[cn+2]=W;for(let Hi=0;Hi<Xe;Hi++)Se.push(Ce[cn+Hi])}}}}return Se}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,W,X){if(G[W+5]>1){let Me=this.clusterProps[G[W+6]];return X?Object.assign({},Me):Me}let fe=this.points[G[W+3]].properties,ye=this.options.map(fe);return X&&ye===fe?Object.assign({},ye):ye}}function bt(Ee,G,W){return{type:"Feature",id:Ee[G+3],properties:Gt(Ee,G,W),geometry:{type:"Point",coordinates:[(X=Ee[G],360*(X-.5)),$n(Ee[G+1])]}};var X}function Gt(Ee,G,W){let X=Ee[G+5],fe=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,ye=Ee[G+6],Me=ye===-1?{}:Object.assign({},W[ye]);return Object.assign(Me,{cluster:!0,cluster_id:Ee[G+3],point_count:X,point_count_abbreviated:fe})}function Bt(Ee){return Ee/360+.5}function jn(Ee){let G=Math.sin(Ee*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function $n(Ee){let G=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Ji(Ee,G,W,X){let fe=X,ye=G+(W-G>>1),Me,De=W-G,Ce=Ee[G],Se=Ee[G+1],Xe=Ee[W],$e=Ee[W+1];for(let it=G+3;it<W;it+=3){let we=Ao(Ee[it],Ee[it+1],Ce,Se,Xe,$e);if(we>fe)Me=it,fe=we;else if(we===fe){let Zt=Math.abs(it-ye);Zt<De&&(Me=it,De=Zt)}}fe>X&&(Me-G>3&&Ji(Ee,G,Me,X),Ee[Me+2]=fe,W-Me>3&&Ji(Ee,Me,W,X))}function Ao(Ee,G,W,X,fe,ye){let Me=fe-W,De=ye-X;if(Me!==0||De!==0){let Ce=((Ee-W)*Me+(G-X)*De)/(Me*Me+De*De);Ce>1?(W=fe,X=ye):Ce>0&&(W+=Me*Ce,X+=De*Ce)}return Me=Ee-W,De=G-X,Me*Me+De*De}function zn(Ee,G,W,X){let fe={type:G,geom:W},ye={id:Ee??null,type:fe.type,geometry:fe.geom,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};switch(fe.type){case"Point":case"MultiPoint":case"LineString":Ct(ye,fe.geom);break;case"Polygon":Ct(ye,fe.geom[0]);break;case"MultiLineString":for(let Me of fe.geom)Ct(ye,Me);break;case"MultiPolygon":for(let Me of fe.geom)Ct(ye,Me[0])}return ye}function Ct(Ee,G){for(let W=0;W<G.length;W+=3)Ee.minX=Math.min(Ee.minX,G[W]),Ee.minY=Math.min(Ee.minY,G[W+1]),Ee.maxX=Math.max(Ee.maxX,G[W]),Ee.maxY=Math.max(Ee.maxY,G[W+1])}function ft(Ee,G){let W=[];switch(Ee.type){case"FeatureCollection":for(let X=0;X<Ee.features.length;X++)Lt(W,Ee.features[X],G,X);break;case"Feature":Lt(W,Ee,G);break;default:Lt(W,{geometry:Ee,properties:void 0},G)}return W}function Lt(Ee,G,W,X){if(!G.geometry)return;if(G.geometry.type==="GeometryCollection"){for(let De of G.geometry.geometries)Lt(Ee,{id:G.id,geometry:De,properties:G.properties},W,X);return}if(!G.geometry.coordinates?.length)return;let ye=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2),Me=G.id;switch(W.promoteId?Me=G.properties?.[W.promoteId]:W.generateId&&(Me=X||0),G.geometry.type){case"Point":{let De=[];return hn(G.geometry.coordinates,De),void Ee.push(zn(Me,G.geometry.type,De,G.properties))}case"MultiPoint":{let De=[];for(let Ce of G.geometry.coordinates)hn(Ce,De);return void Ee.push(zn(Me,G.geometry.type,De,G.properties))}case"LineString":{let De=[];return di(G.geometry.coordinates,De,ye,!1),void Ee.push(zn(Me,G.geometry.type,De,G.properties))}case"MultiLineString":{if(W.lineMetrics){for(let Ce of G.geometry.coordinates){let Se=[];di(Ce,Se,ye,!1),Ee.push(zn(Me,"LineString",Se,G.properties))}return}let De=[];return yr(G.geometry.coordinates,De,ye,!1),void Ee.push(zn(Me,G.geometry.type,De,G.properties))}case"Polygon":{let De=[];return yr(G.geometry.coordinates,De,ye,!0),void Ee.push(zn(Me,G.geometry.type,De,G.properties))}case"MultiPolygon":{let De=[];for(let Ce of G.geometry.coordinates){let Se=[];yr(Ce,Se,ye,!0),De.push(Se)}return void Ee.push(zn(Me,G.geometry.type,De,G.properties))}default:throw new Error("Input data is not a valid GeoJSON object.")}}function hn(Ee,G){G.push(_i(Ee[0]),cr(Ee[1]),0)}function di(Ee,G,W,X){let fe,ye,Me=0;for(let Ce=0;Ce<Ee.length;Ce++){let Se=_i(Ee[Ce][0]),Xe=cr(Ee[Ce][1]);G.push(Se,Xe,0),Ce>0&&(Me+=X?(fe*Xe-Se*ye)/2:Math.sqrt(Math.pow(Se-fe,2)+Math.pow(Xe-ye,2))),fe=Se,ye=Xe}let De=G.length-3;G[2]=1,W>0&&Ji(G,0,De,W),G[De+2]=1,G.size=Math.abs(Me),G.start=0,G.end=G.size}function yr(Ee,G,W,X){for(let fe=0;fe<Ee.length;fe++){let ye=[];di(Ee[fe],ye,W,X),G.push(ye)}}function _i(Ee){return Ee/360+.5}function cr(Ee){let G=Math.sin(Ee*Math.PI/180),W=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return W<0?0:W>1?1:W}function ln(Ee,G,W,X,fe,ye,Me,De){if(X/=G,ye>=(W/=G)&&Me<X)return Ee;if(Me<W||ye>=X)return null;let Ce=[];for(let Se of Ee){let Xe=fe===0?Se.minX:Se.minY,$e=fe===0?Se.maxX:Se.maxY;if(Xe>=W&&$e<X)Ce.push(Se);else if(!($e<W||Xe>=X))switch(Se.type){case"Point":case"MultiPoint":{let it=[];if(ls(Se.geometry,it,W,X,fe),!it.length)continue;Ce.push(zn(Se.id,it.length===3?"Point":"MultiPoint",it,Se.tags));continue}case"LineString":{let it=[];if(ur(Se.geometry,it,W,X,fe,!1,De.lineMetrics),!it.length)continue;if(De.lineMetrics){for(let we of it)Ce.push(zn(Se.id,Se.type,we,Se.tags));continue}if(it.length>1){Ce.push(zn(Se.id,"MultiLineString",it,Se.tags));continue}Ce.push(zn(Se.id,Se.type,it[0],Se.tags));continue}case"MultiLineString":{let it=[];if(Ti(Se.geometry,it,W,X,fe,!1),!it.length)continue;if(it.length===1){Ce.push(zn(Se.id,"LineString",it[0],Se.tags));continue}Ce.push(zn(Se.id,Se.type,it,Se.tags));continue}case"Polygon":{let it=[];if(Ti(Se.geometry,it,W,X,fe,!0),!it.length)continue;Ce.push(zn(Se.id,Se.type,it,Se.tags));continue}case"MultiPolygon":{let it=[];for(let we of Se.geometry){let Zt=[];Ti(we,Zt,W,X,fe,!0),Zt.length&&it.push(Zt)}if(!it.length)continue;Ce.push(zn(Se.id,Se.type,it,Se.tags));continue}}}return Ce.length?Ce:null}function ls(Ee,G,W,X,fe){for(let ye=0;ye<Ee.length;ye+=3){let Me=Ee[ye+fe];Me>=W&&Me<=X&&Yn(G,Ee[ye],Ee[ye+1],Ee[ye+2])}}function ur(Ee,G,W,X,fe,ye,Me){let De=mn(Ee),Ce=fe===0?Ar:Fl,Se,Xe,$e=Ee.start;for(let St=0;St<Ee.length-3;St+=3){let Nt=Ee[St],cn=Ee[St+1],Hi=Ee[St+2],hi=Ee[St+3],kr=Ee[St+4],Rr=fe===0?Nt:cn,Gi=fe===0?hi:kr,Pr=!1;Me&&(Se=Math.sqrt(Math.pow(Nt-hi,2)+Math.pow(cn-kr,2))),Rr<W?Gi>W&&(Xe=Ce(De,Nt,cn,hi,kr,W),Me&&(De.start=$e+Se*Xe)):Rr>X?Gi<X&&(Xe=Ce(De,Nt,cn,hi,kr,X),Me&&(De.start=$e+Se*Xe)):Yn(De,Nt,cn,Hi),Gi<W&&Rr>=W&&(Xe=Ce(De,Nt,cn,hi,kr,W),Pr=!0),Gi>X&&Rr<=X&&(Xe=Ce(De,Nt,cn,hi,kr,X),Pr=!0),!ye&&Pr&&(Me&&(De.end=$e+Se*Xe),G.push(De),De=mn(Ee)),Me&&($e+=Se)}let it=Ee.length-3,we=Ee[it],Zt=Ee[it+1],Jn=fe===0?we:Zt;Jn>=W&&Jn<=X&&Yn(De,we,Zt,Ee[it+2]),it=De.length-3,ye&&it>=3&&(De[it]!==De[0]||De[it+1]!==De[1])&&Yn(De,De[0],De[1],De[2]),De.length&&G.push(De)}function mn(Ee){let G=[];return G.size=Ee.size,G.start=Ee.start,G.end=Ee.end,G}function Ti(Ee,G,W,X,fe,ye){for(let Me of Ee)ur(Me,G,W,X,fe,ye,!1)}function Yn(Ee,G,W,X){Ee.push(G,W,X)}function Ar(Ee,G,W,X,fe,ye){let Me=(ye-G)/(X-G);return Yn(Ee,ye,W+(fe-W)*Me,1),Me}function Fl(Ee,G,W,X,fe,ye){let Me=(ye-W)/(fe-W);return Yn(Ee,G+(X-G)*Me,ye,1),Me}function zr(Ee,G){let W=G.buffer/G.extent,X=Ee,fe=ln(Ee,1,-1-W,W,0,-1,2,G),ye=ln(Ee,1,1-W,2+W,0,-1,2,G);return(fe||ye)&&(X=ln(Ee,1,-W,1+W,0,-1,2,G)||[],fe&&(X=As(fe,1).concat(X)),ye&&(X=X.concat(As(ye,-1)))),X}function As(Ee,G){let W=[];for(let X of Ee)switch(X.type){case"Point":case"MultiPoint":case"LineString":{let fe=Gs(X.geometry,G);W.push(zn(X.id,X.type,fe,X.tags));continue}case"MultiLineString":case"Polygon":{let fe=[];for(let ye of X.geometry)fe.push(Gs(ye,G));W.push(zn(X.id,X.type,fe,X.tags));continue}case"MultiPolygon":{let fe=[];for(let ye of X.geometry){let Me=[];for(let De of ye)Me.push(Gs(De,G));fe.push(Me)}W.push(zn(X.id,X.type,fe,X.tags));continue}}return W}function Gs(Ee,G){let W=[];W.size=Ee.size,Ee.start!==void 0&&(W.start=Ee.start,W.end=Ee.end);for(let X=0;X<Ee.length;X+=3)W.push(Ee[X]+G,Ee[X+1],Ee[X+2]);return W}function Ni(Ee,G){if(Ee.transformed)return Ee;let W=1<<Ee.z,X=Ee.x,fe=Ee.y;for(let ye of Ee.features){if(ye.type===1){let De=[];for(let Ce=0;Ce<ye.geometry.length;Ce+=2)De.push(Ja(ye.geometry[Ce],ye.geometry[Ce+1],G,W,X,fe));ye.geometry=De;continue}let Me=[];for(let De of ye.geometry){let Ce=[];for(let Se=0;Se<De.length;Se+=2)Ce.push(Ja(De[Se],De[Se+1],G,W,X,fe));Me.push(Ce)}ye.geometry=Me}return Ee.transformed=!0,Ee}function Ja(Ee,G,W,X,fe,ye){return[Math.round(W*(Ee*X-fe)),Math.round(W*(G*X-ye))]}function Vu(Ee,G,W,X,fe){let ye=G===fe.maxZoom?0:fe.tolerance/((1<<G)*fe.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:W,y:X,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let De of Ee)ju(Me,De,ye,fe);return Me}function ju(Ee,G,W,X){Ee.minX=Math.min(Ee.minX,G.minX),Ee.minY=Math.min(Ee.minY,G.minY),Ee.maxX=Math.max(Ee.maxX,G.maxX),Ee.maxY=Math.max(Ee.maxY,G.maxY);let fe,ye=G.tags||null;switch(G.type){case"Point":case"MultiPoint":{let Me=[];for(let De=0;De<G.geometry.length;De+=3)Me.push(G.geometry[De],G.geometry[De+1]),Ee.numPoints++,Ee.numSimplified++;if(!Me.length)return;fe={type:1,tags:ye,geometry:Me};break}case"LineString":{let Me=[];if(xa(Me,G.geometry,Ee,W,!1,!1),!Me.length)return;if(X.lineMetrics){ye={};for(let De in G.tags)ye[De]=G.tags[De];ye.mapbox_clip_start=G.geometry.start/G.geometry.size,ye.mapbox_clip_end=G.geometry.end/G.geometry.size}fe={type:2,tags:ye,geometry:Me};break}case"MultiLineString":case"Polygon":{let Me=[];for(let De=0;De<G.geometry.length;De++)xa(Me,G.geometry[De],Ee,W,G.type==="Polygon",De===0);if(!Me.length)return;fe={type:G.type==="Polygon"?3:2,tags:ye,geometry:Me};break}case"MultiPolygon":{let Me=[];for(let De=0;De<G.geometry.length;De++){let Ce=G.geometry[De];for(let Se=0;Se<Ce.length;Se++)xa(Me,Ce[Se],Ee,W,!0,Se===0)}if(!Me.length)return;fe={type:3,tags:ye,geometry:Me};break}}G.id!==null&&(fe.id=G.id),Ee.features.push(fe)}function xa(Ee,G,W,X,fe,ye){let Me=X*X;if(X>0&&G.size<(fe?Me:X))return void(W.numPoints+=G.length/3);let De=[];for(let Ce=0;Ce<G.length;Ce+=3)(X===0||G[Ce+2]>Me)&&(W.numSimplified++,De.push(G[Ce],G[Ce+1])),W.numPoints++;fe&&(function(Ce,Se){let Xe=0;for(let $e=0,it=Ce.length,we=it-2;$e<it;we=$e,$e+=2)Xe+=(Ce[$e]-Ce[we])*(Ce[$e+1]+Ce[we+1]);if(Xe>0===Se)for(let $e=0,it=Ce.length;$e<it/2;$e+=2){let we=Ce[$e],Zt=Ce[$e+1];Ce[$e]=Ce[it-2-$e],Ce[$e+1]=Ce[it-1-$e],Ce[it-2-$e]=we,Ce[it-1-$e]=Zt}})(De,ye),Ee.push(De)}function el(Ee,G,W){let X=!!G.newGeometry,fe=G.removeAllProperties||G.removeProperties?.length>0||G.addOrUpdateProperties?.length>0;if(X){let ye=ft({type:"FeatureCollection",features:[{type:"Feature",id:Ee.id,geometry:G.newGeometry,properties:fe?kc(Ee.tags,G):Ee.tags}]},W);return ye=zr(ye,W),ye[0]}if(fe){let ye=Be({},Ee);return ye.tags=kc(ye.tags,G),ye}return null}function kc(Ee,G){if(G.removeAllProperties)return{};let W=Be({},Ee||{});if(G.removeProperties)for(let X of G.removeProperties)delete W[X];if(G.addOrUpdateProperties)for(let{key:X,value:fe}of G.addOrUpdateProperties)W[X]=fe;return W}let zu={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,updateable:!1,debug:0};class cs{options;tiles;tileCoords;stats={};total=0;source;constructor(G,W){let X=(W=this.options=Object.assign({},zu,W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let fe=ft(G,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fe=zr(fe,W),fe.length&&this.splitTile(fe,0,0,0),W.updateable&&(this.source=fe),X&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,W,X,fe,ye,Me,De){let Ce=[G,W,X,fe],Se=this.options,Xe=Se.debug;for(;Ce.length;){fe=Ce.pop(),X=Ce.pop(),W=Ce.pop(),G=Ce.pop();let $e=1<<W,it=Ll(W,X,fe),we=this.tiles[it];if(!we&&(Xe>1&&console.time("creation"),we=this.tiles[it]=Vu(G,W,X,fe,Se),this.tileCoords.push({z:W,x:X,y:fe,id:it}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,fe,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));let Pr=`z${W}`;this.stats[Pr]=(this.stats[Pr]||0)+1,this.total++}if(we.source=G,ye==null){if(W===Se.indexMaxZoom||we.numPoints<=Se.indexMaxPoints)continue}else{if(W===Se.maxZoom||W===ye)continue;if(ye!=null){let Pr=ye-W;if(X!==Me>>Pr||fe!==De>>Pr)continue}}if(we.source=null,!G.length)continue;Xe>1&&console.time("clipping");let Zt=.5*Se.buffer/Se.extent,Jn=.5-Zt,St=.5+Zt,Nt=1+Zt,cn=null,Hi=null,hi=null,kr=null,Rr=ln(G,$e,X-Zt,X+St,0,we.minX,we.maxX,Se),Gi=ln(G,$e,X+Jn,X+Nt,0,we.minX,we.maxX,Se);Rr&&(cn=ln(Rr,$e,fe-Zt,fe+St,1,we.minY,we.maxY,Se),Hi=ln(Rr,$e,fe+Jn,fe+Nt,1,we.minY,we.maxY,Se)),Gi&&(hi=ln(Gi,$e,fe-Zt,fe+St,1,we.minY,we.maxY,Se),kr=ln(Gi,$e,fe+Jn,fe+Nt,1,we.minY,we.maxY,Se)),Xe>1&&console.timeEnd("clipping"),Ce.push(cn||[],W+1,2*X,2*fe),Ce.push(Hi||[],W+1,2*X,2*fe+1),Ce.push(hi||[],W+1,2*X+1,2*fe),Ce.push(kr||[],W+1,2*X+1,2*fe+1)}}getTile(G,W,X){G=+G,W=+W,X=+X;let fe=this.options,{extent:ye,debug:Me}=fe;if(G<0||G>24)return null;let De=1<<G,Ce=Ll(G,W=W+De&De-1,X);if(this.tiles[Ce])return Ni(this.tiles[Ce],ye);Me>1&&console.log("drilling down to z%d-%d-%d",G,W,X);let Se,Xe=G,$e=W,it=X;for(;!Se&&Xe>0;)Xe--,$e>>=1,it>>=1,Se=this.tiles[Ll(Xe,$e,it)];return Se?.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",Xe,$e,it),console.time("drilling down")),this.splitTile(Se.source,Xe,$e,it,G,W,X),Me>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Ni(this.tiles[Ce],ye):null):null}invalidateTiles(G){let W=this.options,{debug:X}=W,fe=1/0,ye=-1/0,Me=1/0,De=-1/0;for(let Xe of G)fe=Math.min(fe,Xe.minX),ye=Math.max(ye,Xe.maxX),Me=Math.min(Me,Xe.minY),De=Math.max(De,Xe.maxY);let Ce=W.buffer/W.extent,Se=new Set;for(let Xe in this.tiles){let $e=this.tiles[Xe],it=1<<$e.z,we=($e.x-Ce)/it,Zt=($e.x+1+Ce)/it,Jn=($e.y-Ce)/it,St=($e.y+1+Ce)/it;if(ye<we||fe>=Zt||De<Jn||Me>=St)continue;let Nt=!1;for(let cn of G)if(cn.maxX>=we&&cn.minX<Zt&&cn.maxY>=Jn&&cn.minY<St){Nt=!0;break}if(Nt){if(X){X>1&&console.log("invalidate tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$e.z,$e.x,$e.y,$e.numFeatures,$e.numPoints,$e.numSimplified);let cn=`z${$e.z}`;this.stats[cn]=(this.stats[cn]||0)-1,this.total--}delete this.tiles[Xe],Se.add(Xe)}}Se.size&&(this.tileCoords=this.tileCoords.filter(Xe=>!Se.has(Xe.id)))}updateData(G){let W=this.options,X=W.debug;if(!W.updateable)throw new Error("to update tile geojson `updateable` option must be set to true");let{affected:fe,source:ye}=(function($e,it,we){let Zt=(function(St){return St?{removeAll:St.removeAll,remove:new Set(St.remove||[]),add:new Map(St.add?.map(Nt=>[Nt.id,Nt])),update:new Map(St.update?.map(Nt=>[Nt.id,Nt]))}:{remove:new Set,add:new Map,update:new Map}})(it),Jn=[];if(Zt.removeAll&&(Jn=$e,$e=[]),Zt.remove.size||Zt.add.size){let St=[];for(let Nt of $e){let{id:cn}=Nt;(Zt.remove.has(cn)||Zt.add.has(cn))&&St.push(Nt)}if(St.length){Jn.push(...St);let Nt=new Set(St.map(cn=>cn.id));$e=$e.filter(cn=>!Nt.has(cn.id))}if(Zt.add.size){let Nt=ft({type:"FeatureCollection",features:Array.from(Zt.add.values())},we);Nt=zr(Nt,we),Jn.push(...Nt),$e.push(...Nt)}}if(Zt.update.size)for(let[St,Nt]of Zt.update){let cn=$e.findIndex(kr=>kr.id===St);if(cn===-1)continue;let Hi=$e[cn],hi=el(Hi,Nt,we);hi&&(Jn.push(Hi,hi),$e[cn]=hi)}return{affected:Jn,source:$e}})(this.source,G,W);if(!fe.length)return;this.source=ye,X>1&&(console.log("invalidating tiles"),console.time("invalidating")),this.invalidateTiles(fe),X>1&&console.timeEnd("invalidating");let[Me,De,Ce]=[0,0,0],Se=Vu(this.source,Me,De,Ce,this.options);Se.source=this.source;let Xe=Ll(Me,De,Ce);if(this.tiles[Xe]=Se,this.tileCoords.push({z:Me,x:De,y:Ce,id:Xe}),X){let $e=`z${Me}`;this.stats[$e]=(this.stats[$e]||0)+1,this.total++}}}function Ll(Ee,G,W){return 32*((1<<Ee)*W+G)+Ee}class Eh extends K{constructor(G,W,X,fe=Uu){super(G,W,X),this._dataUpdateable=new Map,this._createGeoJSONIndex=fe}loadVectorTile(G,W){return r._(this,void 0,void 0,function*(){let X=G.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let fe=this._geoJSONIndex.getTile(X.z,X.x,X.y);return fe?q(new r.d3(fe.features,{version:2,extent:r.a5})):null})}loadData(G){return r._(this,void 0,void 0,function*(){var W;(W=this._pendingRequest)===null||W===void 0||W.abort();let X=this._startPerformance(G);this._pendingRequest=new AbortController;try{(!this._pendingData||G.request||G.data||G.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(G,this._pendingRequest));let fe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(fe,G),this.loaded={};let ye={};return G.request&&(ye.data=fe),this._finishPerformance(X,G,ye),ye}catch(fe){if(delete this._pendingRequest,r.Z(fe))return{abandoned:!0};throw fe}})}_startPerformance(G){var W;if(!((W=G?.request)===null||W===void 0)&&W.collectResourceTiming)return new r.c$(G.request)}_finishPerformance(G,W,X){if(!G)return;let fe=G.finish();fe&&(X.resourceTiming={},X.resourceTiming[W.source]=JSON.parse(JSON.stringify(fe)))}getData(){return r._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(G){let W=this.loaded;return W&&W[G.uid]?super.reloadTile(G):this.loadTile(G)}loadAndProcessGeoJSON(G,W){return r._(this,void 0,void 0,function*(){let X;if(G.request?X=yield this.loadGeoJSONFromUrl(G.request,G.promoteId,W):G.data?X=this._loadGeoJSONFromObject(G.data,G.promoteId):G.dataDiff&&(X=this._loadGeoJSONFromDiff(G.dataDiff,G.promoteId,G.source)),delete this._pendingRequest,typeof X!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);return kt(X,!0),G.filter&&(X=this._filterGeoJSON(X,G.filter)),X})}loadGeoJSONFromUrl(G,W,X){return r._(this,void 0,void 0,function*(){let fe=yield r.j(G,X);return this._dataUpdateable=r.a7(fe.data,W),fe.data})}_loadGeoJSONFromObject(G,W){return this._dataUpdateable=r.a7(G,W),G}_loadGeoJSONFromDiff(G,W,X){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${X}`);r.a8(this._dataUpdateable,G,W);let fe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(fe)}_filterGeoJSON(G,W){let X=r.d4(W,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(X.result==="error")throw new Error(X.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));let fe=G.features.filter(ye=>X.value.evaluate({zoom:0},ye));return this._toFeatureCollection(fe)}_toFeatureCollection(G){return{type:"FeatureCollection",features:G}}removeSource(G){return r._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}function Uu(Ee,G){return G.cluster?new ct((function({superclusterOptions:W,clusterProperties:X}){if(!X||!W)return W;let fe={},ye={},Me={accumulated:null,zoom:0},De={properties:null},Ce=Object.keys(X);for(let Se of Ce){let[Xe,$e]=X[Se],it=r.d4($e),we=r.d4(typeof Xe=="string"?[Xe,["accumulated"],["get",Se]]:Xe);fe[Se]=it.value,ye[Se]=we.value}return W.map=Se=>{De.properties=Se;let Xe={};for(let $e of Ce)Xe[$e]=fe[$e].evaluate(Me,De);return Xe},W.reduce=(Se,Xe)=>{De.properties=Xe;for(let $e of Ce)Me.accumulated=Se[$e],Se[$e]=ye[$e].evaluate(Me,De)},W})(G)).load(Ee.features):(function(W,X){return new cs(W,X)})(Ee,G.geojsonVtOptions)}class $u{constructor(G){this.self=G,this.actor=new r.L(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(W,X)=>{if(this.externalWorkerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.externalWorkerSourceTypes[W]=X},this.self.addProtocol=r.cK,this.self.removeProtocol=r.cL,this.self.registerRTLTextPlugin=W=>{r.d5.setMethods(W)},this.actor.registerMessageHandler("LDT",(W,X)=>this._getDEMWorkerSource(W,X.source).loadTile(X)),this.actor.registerMessageHandler("RDT",(W,X)=>r._(this,void 0,void 0,function*(){this._getDEMWorkerSource(W,X.source).removeTile(X)})),this.actor.registerMessageHandler("GCEZ",(W,X)=>r._(this,void 0,void 0,function*(){return this._getWorkerSource(W,X.type,X.source).getClusterExpansionZoom(X)})),this.actor.registerMessageHandler("GCC",(W,X)=>r._(this,void 0,void 0,function*(){return this._getWorkerSource(W,X.type,X.source).getClusterChildren(X)})),this.actor.registerMessageHandler("GCL",(W,X)=>r._(this,void 0,void 0,function*(){return this._getWorkerSource(W,X.type,X.source).getClusterLeaves(X)})),this.actor.registerMessageHandler("LD",(W,X)=>this._getWorkerSource(W,X.type,X.source).loadData(X)),this.actor.registerMessageHandler("GD",(W,X)=>this._getWorkerSource(W,X.type,X.source).getData()),this.actor.registerMessageHandler("LT",(W,X)=>this._getWorkerSource(W,X.type,X.source).loadTile(X)),this.actor.registerMessageHandler("RT",(W,X)=>this._getWorkerSource(W,X.type,X.source).reloadTile(X)),this.actor.registerMessageHandler("AT",(W,X)=>this._getWorkerSource(W,X.type,X.source).abortTile(X)),this.actor.registerMessageHandler("RMT",(W,X)=>this._getWorkerSource(W,X.type,X.source).removeTile(X)),this.actor.registerMessageHandler("RS",(W,X)=>r._(this,void 0,void 0,function*(){if(!this.workerSources[W]||!this.workerSources[W][X.type]||!this.workerSources[W][X.type][X.source])return;let fe=this.workerSources[W][X.type][X.source];delete this.workerSources[W][X.type][X.source],fe.removeSource!==void 0&&fe.removeSource(X)})),this.actor.registerMessageHandler("RM",W=>r._(this,void 0,void 0,function*(){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],this.globalStates.delete(W)})),this.actor.registerMessageHandler("SR",(W,X)=>r._(this,void 0,void 0,function*(){this.referrer=X})),this.actor.registerMessageHandler("SRPS",(W,X)=>this._syncRTLPluginState(W,X)),this.actor.registerMessageHandler("IS",(W,X)=>r._(this,void 0,void 0,function*(){this.self.importScripts(X)})),this.actor.registerMessageHandler("SI",(W,X)=>this._setImages(W,X)),this.actor.registerMessageHandler("UL",(W,X)=>r._(this,void 0,void 0,function*(){this._getLayerIndex(W).update(X.layers,X.removedIds,this._getGlobalState(W))})),this.actor.registerMessageHandler("UGS",(W,X)=>r._(this,void 0,void 0,function*(){let fe=this._getGlobalState(W);for(let ye in X)fe[ye]=X[ye]})),this.actor.registerMessageHandler("SL",(W,X)=>r._(this,void 0,void 0,function*(){this._getLayerIndex(W).replace(X,this._getGlobalState(W))}))}_getGlobalState(G){let W=this.globalStates.get(G);return W||(W={},this.globalStates.set(G,W)),W}_setImages(G,W){return r._(this,void 0,void 0,function*(){this.availableImages[G]=W;for(let X in this.workerSources[G]){let fe=this.workerSources[G][X];for(let ye in fe)fe[ye].availableImages=W}})}_syncRTLPluginState(G,W){return r._(this,void 0,void 0,function*(){return yield r.d5.syncState(W,this.self.importScripts)})}_getAvailableImages(G){let W=this.availableImages[G];return W||(W=[]),W}_getLayerIndex(G){let W=this.layerIndexes[G];return W||(W=this.layerIndexes[G]=new o),W}_getWorkerSource(G,W,X){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][W]||(this.workerSources[G][W]={}),!this.workerSources[G][W][X]){let fe={sendAsync:(ye,Me)=>(ye.targetMapId=G,this.actor.sendAsync(ye,Me))};switch(W){case"vector":this.workerSources[G][W][X]=new K(fe,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][W][X]=new Eh(fe,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][W][X]=new this.externalWorkerSourceTypes[W](fe,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][W][X]}_getDEMWorkerSource(G,W){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][W]||(this.demWorkerSources[G][W]=new xe),this.demWorkerSources[G][W]}}return r.i(self)&&(self.worker=new $u(self)),$u}),e("index",["exports","./shared"],function(r,o){"use strict";var d="5.17.0";function m(){var v=new o.A(4);return o.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let b,T,A,N={frame(v,a,u,f){let g=f||window,w=g.requestAnimationFrame(S=>{E(),a(S)}),{unsubscribe:E}=o.s(v.signal,"abort",()=>{E(),g.cancelAnimationFrame(w),u(new o.a(v.signal.reason))},!1)},frameAsync(v,a){return new Promise((u,f)=>{this.frame(v,u,f,a)})},getImageData(v,a=0){return this.getImageCanvasContext(v).getImageData(-a,-a,v.width+2*a,v.height+2*a)},getImageCanvasContext(v){let a=window.document.createElement("canvas"),u=a.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return a.width=v.width,a.height=v.height,u.drawImage(v,0,0,v.width,v.height),u},resolveURL:v=>(b||(b=document.createElement("a")),b.href=v,b.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return A!==void 0?A:!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)},set prefersReducedMotion(v){A=v}},q=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function J(){return q.getCurrentTime()}class K{static testProp(a){if(!K.docStyle)return a[0];for(let u=0;u<a.length;u++)if(a[u]in K.docStyle)return a[u];return a[0]}static create(a,u,f){let g=window.document.createElement(a);return u!==void 0&&(g.className=u),f&&f.appendChild(g),g}static createNS(a,u){return window.document.createElementNS(a,u)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(a,u){a.style[K.transformProp]=u}static addEventListener(a,u,f,g={}){a.addEventListener(u,f,"passive"in g?g:g.capture)}static removeEventListener(a,u,f,g={}){a.removeEventListener(u,f,"passive"in g?g:g.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(a){let u=a.getBoundingClientRect();return{x:u.width/a.offsetWidth||1,y:u.height/a.offsetHeight||1,boundingClientRect:u}}static getPoint(a,u,f){let g=u.boundingClientRect;return new o.P((f.clientX-g.left)/u.x-a.clientLeft,(f.clientY-g.top)/u.y-a.clientTop)}static mousePos(a,u){let f=K.getScale(a);return K.getPoint(a,f,u)}static touchPos(a,u){let f=[],g=K.getScale(a);for(let w=0;w<u.length;w++)f.push(K.getPoint(a,g,u[w]));return f}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}static sanitize(a){let u=new DOMParser().parseFromString(a,"text/html").body||document.createElement("body"),f=u.querySelectorAll("script");for(let g of f)g.remove();return K.clean(u),u.innerHTML}static isPossiblyDangerous(a,u){let f=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(a)||!f.includes("javascript:")&&!f.includes("data:"))||!!a.startsWith("on")||void 0}static clean(a){let u=a.children;for(let f of u)K.removeAttributes(f),K.clean(f)}static removeAttributes(a){for(let{name:u,value:f}of a.attributes)K.isPossiblyDangerous(u,f)&&a.removeAttribute(u)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);let xe={supported:!1,testSupport:function(v){!Et&&Ge&&(kt?Ue(v):Te=v)}},Te,Ge,Et=!1,kt=!1;function Ue(v){let a=v.createTexture();v.bindTexture(v.TEXTURE_2D,a);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,Ge),v.isContextLost())return;xe.supported=!0}catch(u){}v.deleteTexture(a),Et=!0}var Oe;typeof document<"u"&&(Ge=document.createElement("img"),Ge.onload=()=>{Te&&Ue(Te),Te=null,kt=!0},Ge.onerror=()=>{Et=!0,Te=null},Ge.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(v){let a,u,f,g;v.resetRequestQueue=()=>{a=[],u=0,f=0,g={}},v.addThrottleControl=I=>{let k=f++;return g[k]=I,k},v.removeThrottleControl=I=>{delete g[I],E()},v.getImage=(I,k,P=!0)=>new Promise((B,L)=>{xe.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),o.e(I,{type:"image"}),a.push({abortController:k,requestParameters:I,supportImageRefresh:P,state:"queued",onError:$=>{L($)},onSuccess:$=>{B($)}}),E()});let w=I=>o._(this,void 0,void 0,function*(){I.state="running";let{requestParameters:k,supportImageRefresh:P,onError:B,onSuccess:L,abortController:$}=I,Y=P===!1&&!o.i(self)&&!o.g(k.url)&&(!k.headers||Object.keys(k.headers).reduce((re,ue)=>re&&ue==="accept",!0));u++;let ie=Y?S(k,$):o.m(k,$);try{let re=yield ie;delete I.abortController,I.state="completed",re.data instanceof HTMLImageElement||o.b(re.data)?L(re):re.data&&L({data:yield(oe=re.data,typeof createImageBitmap=="function"?o.f(oe):o.h(oe)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete I.abortController,B(re)}finally{u--,E()}var oe}),E=()=>{let I=(()=>{for(let k of Object.keys(g))if(g[k]())return!0;return!1})()?o.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=u;k<I&&a.length>0;k++){let P=a.shift();P.abortController.signal.aborted?k--:w(P)}},S=(I,k)=>new Promise((P,B)=>{let L=new Image,$=I.url,Y=I.credentials;Y&&Y==="include"?L.crossOrigin="use-credentials":(Y&&Y==="same-origin"||!o.d($))&&(L.crossOrigin="anonymous"),k.signal.addEventListener("abort",()=>{L.src="",B(new o.a(k.signal.reason))}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,P({data:L})},L.onerror=()=>{L.onerror=L.onload=null,k.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=$})})(Oe||(Oe={})),Oe.resetRequestQueue();class Qe{constructor(a){this._transformRequestFn=a??null}transformRequest(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}}setTransformRequest(a){this._transformRequestFn=a}}function ct(v){let a=[];if(typeof v=="string")a.push({id:"default",url:v});else if(v&&v.length>0){let u=[];for(let{id:f,url:g}of v){let w=`${f}${g}`;u.indexOf(w)===-1&&(u.push(w),a.push({id:f,url:g}))}}return a}function bt(v,a,u){try{let f=new URL(v);return f.pathname+=`${a}${u}`,f.toString()}catch(f){throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Gt(v){let{userImage:a}=v;return!!(a&&a.render&&a.render())&&(v.data.replace(new Uint8Array(a.data.buffer)),!0)}class Bt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(let a of Object.keys(this.images))this.removeImage(a);this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(let{ids:u,promiseResolve:f}of this.requestors)f(this._getImagesForIds(u));this.requestors=[]}}getImage(a){let u=this.images[a];if(u&&!u.data&&u.spriteData){let f=u.spriteData;u.data=new o.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),u.spriteData=null}return u}addImage(a,u){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,u)&&(this.images[a]=u)}_validate(a,u){let f=!0,g=u.data||u.spriteData;return this._validateStretch(u.stretchX,g&&g.width)||(this.fire(new o.k(new Error(`Image "${a}" has invalid "stretchX" value`))),f=!1),this._validateStretch(u.stretchY,g&&g.height)||(this.fire(new o.k(new Error(`Image "${a}" has invalid "stretchY" value`))),f=!1),this._validateContent(u.content,u)||(this.fire(new o.k(new Error(`Image "${a}" has invalid "content" value`))),f=!1),f}_validateStretch(a,u){if(!a)return!0;let f=0;for(let g of a){if(g[0]<f||g[1]<g[0]||u<g[1])return!1;f=g[1]}return!0}_validateContent(a,u){if(!a)return!0;if(a.length!==4)return!1;let f=u.spriteData,g=f&&f.width||u.data.width,w=f&&f.height||u.data.height;return!(a[0]<0||g<a[0]||a[1]<0||w<a[1]||a[2]<0||g<a[2]||a[3]<0||w<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,u,f=!0){let g=this.getImage(a);if(f&&(g.data.width!==u.data.width||g.data.height!==u.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=g.version+1,this.images[a]=u,this.updatedImages[a]=!0}removeImage(a){let u=this.images[a];delete this.images[a],delete this.patterns[a],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((u,f)=>{let g=!0;if(!this.isLoaded())for(let w of a)this.images[w]||(g=!1);this.isLoaded()||g?u(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:u})})}_getImagesForIds(a){let u={};for(let f of a){let g=this.getImage(f);g||(this.fire(new o.l("styleimagemissing",{id:f})),g=this.getImage(f)),g?u[f]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,textFitWidth:g.textFitWidth,textFitHeight:g.textFitHeight,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:o.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){let{width:a,height:u}=this.atlasImage;return{width:a,height:u}}getPattern(a){let u=this.patterns[a],f=this.getImage(a);if(!f)return null;if(u&&u.position.version===f.version)return u.position;if(u)u.position.version=f.version;else{let g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},w=new o.I(g,f);this.patterns[a]={bin:g,position:w}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){let u=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(a,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){let a=[];for(let w in this.patterns)a.push(this.patterns[w].bin);let{w:u,h:f}=o.p(a),g=this.atlasImage;g.resize({width:u||1,height:f||1});for(let w in this.patterns){let{bin:E}=this.patterns[w],S=E.x+1,I=E.y+1,k=this.getImage(w).data,P=k.width,B=k.height;o.R.copy(k,g,{x:0,y:0},{x:S,y:I},{width:P,height:B}),o.R.copy(k,g,{x:0,y:B-1},{x:S,y:I-1},{width:P,height:1}),o.R.copy(k,g,{x:0,y:0},{x:S,y:I+B},{width:P,height:1}),o.R.copy(k,g,{x:P-1,y:0},{x:S-1,y:I},{width:1,height:B}),o.R.copy(k,g,{x:0,y:0},{x:S+P,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(let u of a){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;let f=this.getImage(u);f||o.w(`Image with ID: "${u}" was not found`),Gt(f)&&this.updateImage(u,f)}}cloneImages(){let a={};for(let u in this.images){let f=this.images[u];a[u]=Object.assign(Object.assign({},f),{data:f.data?f.data.clone():null})}return a}}let jn=1e20;function $n(v,a,u,f,g,w,E,S,I){for(let k=a;k<a+f;k++)Ji(v,u*w+k,w,g,E,S,I);for(let k=u;k<u+g;k++)Ji(v,k*w+a,1,f,E,S,I)}function Ji(v,a,u,f,g,w,E){w[0]=0,E[0]=-jn,E[1]=jn,g[0]=v[a];for(let S=1,I=0,k=0;S<f;S++){g[S]=v[a+S*u];let P=S*S;do{let B=w[I];k=(g[S]-g[B]+P-B*B)/(S-B)/2}while(k<=E[I]&&--I>-1);I++,w[I]=S,E[I]=k,E[I+1]=jn}for(let S=0,I=0;S<f;S++){for(;E[I+1]<S;)I++;let k=w[I],P=S-k;v[a+S*u]=g[k]+P*P}}let Ao=o.v.layout_symbol["text-font"].default.join(",");class zn{constructor(a,u,f){this.requestManager=a,this.localIdeographFontFamily=u,this.entries={},this.lang=f}setURL(a){this.url=a}getGlyphs(a){return o._(this,void 0,void 0,function*(){let u=[];for(let w in a)for(let E of a[w])u.push(this._getAndCacheGlyphsPromise(w,E));let f=yield Promise.all(u),g={};for(let{stack:w,id:E,glyph:S}of f)g[w]||(g[w]={}),g[w][E]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return g})}_getAndCacheGlyphsPromise(a,u){return o._(this,void 0,void 0,function*(){let f=this.entries[a];f||(f=this.entries[a]={glyphs:{},requests:{},ranges:{}});let g=f.glyphs[u];return g!==void 0?{stack:a,id:u,glyph:g}:!this.url||this._charUsesLocalIdeographFontFamily(u)?(g=f.glyphs[u]=this._drawGlyph(f,a,u),{stack:a,id:u,glyph:g}):yield this._downloadAndCacheRangePromise(a,u)})}_downloadAndCacheRangePromise(a,u){return o._(this,void 0,void 0,function*(){let f=this.entries[a],g=Math.floor(u/256);if(f.ranges[g])return{stack:a,id:u,glyph:null};if(!f.requests[g]){let w=zn.loadGlyphRange(a,g,this.url,this.requestManager);f.requests[g]=w}try{let w=yield f.requests[g];for(let E in w)f.glyphs[+E]=w[+E];return f.ranges[g]=!0,{stack:a,id:u,glyph:w[u]||null}}catch(w){let E=f.glyphs[u]=this._drawGlyph(f,a,u);return this._warnOnMissingGlyphRange(E,g,u,w),{stack:a,id:u,glyph:E}}})}_warnOnMissingGlyphRange(a,u,f,g){let w=256*u,E=w+255,S=f.toString(16).padStart(4,"0").toUpperCase();o.w(`Unable to load glyph range ${u}, ${w}-${E}. Rendering codepoint U+${S} locally instead. ${g}`)}_charUsesLocalIdeographFontFamily(a){return!!this.localIdeographFontFamily&&o.q(a)}_drawGlyph(a,u,f){let g=u===Ao&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(f),w=g?"ideographTinySDF":"tinySDF";a[w]||(a[w]=this._createTinySDF(g?this.localIdeographFontFamily:u));let E=a[w].draw(String.fromCodePoint(f)),S=new RegExp("^\\p{gc=Cf}+$","u").test(String.fromCodePoint(f));return{id:f,bitmap:new o.r({width:E.width||60,height:E.height||60},E.data),metrics:{width:S?0:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:S?0:E.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(a){let u=a?a.split(","):[];u.push("sans-serif");let f=u.map(g=>/[-\w]+/.test(g)?g:`'${CSS.escape(g)}'`).join(",");return new zn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:this._fontWeight(u[0]),fontStyle:this._fontStyle(u[0]),lang:this.lang})}_fontStyle(a){return/italic/i.test(a)?"italic":/oblique/i.test(a)?"oblique":"normal"}_fontWeight(a){let u={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950},f;for(let[g,w]of Object.entries(u))new RegExp(`\\b${g}\\b`,"i").test(a)&&(f=`${w}`);return f}destroy(){for(let a in this.entries){let u=this.entries[a];u.tinySDF&&(u.tinySDF=null),u.ideographTinySDF&&(u.ideographTinySDF=null),u.glyphs={},u.requests={},u.ranges={}}this.entries={}}}zn.loadGlyphRange=function(v,a,u,f){return o._(this,void 0,void 0,function*(){let g=256*a,w=g+255,E=f.transformRequest(u.replace("{fontstack}",v).replace("{range}",`${g}-${w}`),"Glyphs"),S=yield o.n(E,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${a}, ${g}-${w}`);let I={};for(let k of o.o(S.data))I[k.id]=k;return I})},zn.TinySDF=class{constructor({fontSize:v=24,buffer:a=3,radius:u=8,cutoff:f=.25,fontFamily:g="sans-serif",fontWeight:w="normal",fontStyle:E="normal",lang:S=null}={}){this.buffer=a,this.cutoff=f,this.radius=u,this.lang=S;let I=this.size=v+4*a,k=this._createCanvas(I),P=this.ctx=k.getContext("2d",{willReadFrequently:!0});P.font=`${E} ${w} ${v}px ${g}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(v){let a=document.createElement("canvas");return a.width=a.height=v,a}draw(v){let{width:a,actualBoundingBoxAscent:u,actualBoundingBoxDescent:f,actualBoundingBoxLeft:g,actualBoundingBoxRight:w}=this.ctx.measureText(v),E=Math.ceil(u),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-g))),I=Math.min(this.size-this.buffer,E+Math.ceil(f)),k=S+2*this.buffer,P=I+2*this.buffer,B=Math.max(k*P,0),L=new Uint8ClampedArray(B),$={data:L,width:k,height:P,glyphWidth:S,glyphHeight:I,glyphTop:E,glyphLeft:0,glyphAdvance:a};if(S===0||I===0)return $;let{ctx:Y,buffer:ie,gridInner:oe,gridOuter:re}=this;this.lang&&(Y.lang=this.lang),Y.clearRect(ie,ie,S,I),Y.fillText(v,ie,ie+E);let ue=Y.getImageData(ie,ie,S,I);re.fill(jn,0,B),oe.fill(0,0,B);for(let ge=0;ge<I;ge++)for(let ce=0;ce<S;ce++){let pe=ue.data[4*(ge*S+ce)+3]/255;if(pe===0)continue;let ve=(ge+ie)*k+ce+ie;if(pe===1)re[ve]=0,oe[ve]=jn;else{let he=.5-pe;re[ve]=he>0?he*he:0,oe[ve]=he<0?he*he:0}}$n(re,0,0,k,P,k,this.f,this.v,this.z),$n(oe,ie,ie,S,I,k,this.f,this.v,this.z);for(let ge=0;ge<B;ge++){let ce=Math.sqrt(re[ge])-Math.sqrt(oe[ge]);L[ge]=Math.round(255-255*(ce/this.radius+this.cutoff))}return $}};class Ct{constructor(){this.specification=o.u.light.position}possiblyEvaluate(a,u){return o.F(a.expression.evaluate(u))}interpolate(a,u,f){return{x:o.G.number(a.x,u.x,f),y:o.G.number(a.y,u.y,f),z:o.G.number(a.z,u.z,f)}}}let ft;class Lt extends o.E{constructor(a){super(),ft=ft||new o.t({anchor:new o.D(o.u.light.anchor),position:new Ct,color:new o.D(o.u.light.color),intensity:new o.D(o.u.light.intensity)}),this._transitionable=new o.x(ft,void 0),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u={}){if(!this._validate(o.y,a,u))for(let f in a){let g=a[f];f.endsWith(o.z)?this._transitionable.setTransition(f.slice(0,-o.z.length),g):this._transitionable.setValue(f,g)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,f){return(!f||f.validate!==!1)&&o.B(this,a.call(o.C,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.u}))}}let hn=new o.t({"sky-color":new o.D(o.u.sky["sky-color"]),"horizon-color":new o.D(o.u.sky["horizon-color"]),"fog-color":new o.D(o.u.sky["fog-color"]),"fog-ground-blend":new o.D(o.u.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.u.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.u.sky["atmosphere-blend"])});class di extends o.E{constructor(a){super(),this._transitionable=new o.x(hn,void 0),this.setSky(a),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0))}setSky(a,u={}){if(!this._validate(o.J,a,u)){a||(a={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let f in a){let g=a[f];f.endsWith(o.z)?this._transitionable.setTransition(f.slice(0,-o.z.length),g):this._transitionable.setValue(f,g)}}}getSky(){return this._transitionable.serialize()}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,f={}){return f?.validate!==!1&&o.B(this,a.call(o.C,o.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.u})))}calculateFogBlendOpacity(a){return a<60?0:a<70?(a-60)/10:1}}class yr{constructor(a,u){this.width=a,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,u){let f=a.join(",")+String(u);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(a,u)),this.dashEntry[f]}getDashRanges(a,u,f){let g=[],w=a.length%2==1?-a[a.length-1]*f:0,E=a[0]*f,S=!0;g.push({left:w,right:E,isDash:S,zeroLength:a[0]===0});let I=a[0];for(let k=1;k<a.length;k++){S=!S;let P=a[k];w=I*f,I+=P,E=I*f,g.push({left:w,right:E,isDash:S,zeroLength:P===0})}return g}addRoundDash(a,u,f){let g=u/2;for(let w=-f;w<=f;w++){let E=this.width*(this.nextRow+f+w),S=0,I=a[S];for(let k=0;k<this.width;k++){k/I.right>1&&(I=a[++S]);let P=Math.abs(k-I.left),B=Math.abs(k-I.right),L=Math.min(P,B),$,Y=w/f*(g+1);if(I.isDash){let ie=g-Math.abs(Y);$=Math.sqrt(L*L+ie*ie)}else $=g-Math.sqrt(L*L+Y*Y);this.data[E+k]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(a){for(let S=a.length-1;S>=0;--S){let I=a[S],k=a[S+1];I.zeroLength?a.splice(S,1):k&&k.isDash===I.isDash&&(k.left=I.left,a.splice(S,1))}let u=a[0],f=a[a.length-1];u.isDash===f.isDash&&(u.left=f.left-this.width,f.right=u.right+this.width);let g=this.width*this.nextRow,w=0,E=a[w];for(let S=0;S<this.width;S++){S/E.right>1&&(E=a[++w]);let I=Math.abs(S-E.left),k=Math.abs(S-E.right),P=Math.min(I,k);this.data[g+S]=Math.max(0,Math.min(255,(E.isDash?P:-P)+128))}}addDash(a,u){let f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return o.w("LineAtlas out of space"),null;let w=0;for(let S=0;S<a.length;S++)w+=a[S];if(w!==0){let S=this.width/w,I=this.getDashRanges(a,this.width,S);u?this.addRoundDash(I,S,f):this.addRegularDash(I)}let E={y:this.nextRow+f,height:2*f,width:w};return this.nextRow+=g,this.dirty=!0,E}bind(a){let u=a.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}let _i="maplibre_preloaded_worker_pool";class cr{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<cr.workerCount;)this.workers.push(new Worker(o.c.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_i]}numActive(){return Object.keys(this.active).length}}let ln=Math.floor(N.hardwareConcurrency/2),ls,ur;function mn(){return ls||(ls=new cr),ls}cr.workerCount=o.K(globalThis)?Math.max(Math.min(ln,3),1):1;class Ti{constructor(a,u){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=u;let f=this.workerPool.acquire(u);for(let g=0;g<f.length;g++){let w=new o.L(f[g],u);w.name=`Worker ${g}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,u){let f=[];for(let g of this.actors)f.push(g.sendAsync({type:a,data:u}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(a=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,u){for(let f of this.actors)f.registerMessageHandler(a,u)}unregisterMessageHandler(a){for(let u of this.actors)u.unregisterMessageHandler(a)}}function Yn(){return ur||(ur=new Ti(mn(),o.M),ur.registerMessageHandler("GR",(v,a,u)=>o.m(a,u))),ur}function Ar(v,a){let u=o.N();return o.O(u,u,[1,1,0]),o.Q(u,u,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?o.S(u,u,v.calculatePosMatrix(a.toUnwrapped())):u}function Fl(v,a,u,f,g,w,E){var S;let I=(function(L,$,Y){if(L)for(let ie of L){let oe=$[ie];if(oe&&oe.source===Y&&oe.type==="fill-extrusion")return!0}else for(let ie in $){let oe=$[ie];if(oe.source===Y&&oe.type==="fill-extrusion")return!0}return!1})((S=g?.layers)!==null&&S!==void 0?S:null,a,v.id),k=w.maxPitchScaleFactor(),P=v.tilesIn(f,k,I);P.sort(zr);let B=[];for(let L of P)B.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(a,u,v.getState(),L.queryGeometry,L.cameraQueryGeometry,L.scale,g,w,k,Ar(w,L.tileID),E?($,Y)=>E(L.tileID,$,Y):void 0)});return(function(L,$){for(let Y in L)for(let ie of L[Y])As(ie,$);return L})((function(L){let $={},Y={};for(let ie of L){let oe=ie.queryResults,re=ie.wrappedTileID,ue=Y[re]=Y[re]||{};for(let ge in oe){let ce=oe[ge],pe=ue[ge]=ue[ge]||{},ve=$[ge]=$[ge]||[];for(let he of ce)pe[he.featureIndex]||(pe[he.featureIndex]=!0,ve.push(he))}}return $})(B),v)}function zr(v,a){let u=v.tileID,f=a.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}function As(v,a){let u=v.feature,f=a.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=f}function Gs(v,a,u,f){return o._(this,void 0,void 0,function*(){let g=v;if(v.url?g=(yield o.j(a.transformRequest(v.url,"Source"),u)).data:yield N.frameAsync(u,f),!g)return null;let w=o.U(o.e(g,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(w.vectorLayerIds=g.vector_layers.map(E=>E.id)),w})}class Ni{constructor(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof o.V?new o.V(a.lng,a.lat):o.V.convert(a),this}setSouthWest(a){return this._sw=a instanceof o.V?new o.V(a.lng,a.lat):o.V.convert(a),this}extend(a){let u=this._sw,f=this._ne,g,w;if(a instanceof o.V)g=a,w=a;else{if(!(a instanceof Ni))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Ni.convert(a)):this.extend(o.V.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(o.V.convert(a)):this;if(g=a._sw,w=a._ne,!g||!w)return this}return u||f?(u.lng=Math.min(g.lng,u.lng),u.lat=Math.min(g.lat,u.lat),f.lng=Math.max(w.lng,f.lng),f.lat=Math.max(w.lat,f.lat)):(this._sw=new o.V(g.lng,g.lat),this._ne=new o.V(w.lng,w.lat)),this}getCenter(){return new o.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.V(this.getWest(),this.getNorth())}getSouthEast(){return new o.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){let{lng:u,lat:f}=o.V.convert(a),g=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&g}intersects(a){if(!((a=Ni.convert(a)).getNorth()>=this.getSouth()&&a.getSouth()<=this.getNorth()))return!1;let u=Math.abs(this.getEast()-this.getWest()),f=Math.abs(a.getEast()-a.getWest());if(u>=360||f>=360)return!0;let g=o.W(this.getWest(),-180,180),w=o.W(this.getEast(),-180,180),E=o.W(a.getWest(),-180,180),S=o.W(a.getEast(),-180,180),I=g>=w,k=E>=S;return!(!I||!k)||(I?S>=g||E<=w:k?w>=E||g<=S:E<=w&&S>=g)}static convert(a){return a instanceof Ni?a:a&&new Ni(a)}static fromLngLat(a,u=0){let f=360*u/40075017,g=f/Math.cos(Math.PI/180*a.lat);return new Ni(new o.V(a.lng-g,a.lat-f),new o.V(a.lng+g,a.lat+f))}adjustAntiMeridian(){let a=new o.V(this._sw.lng,this._sw.lat),u=new o.V(this._ne.lng,this._ne.lat);return new Ni(a,a.lng>u.lng?new o.V(u.lng+360,u.lat):u)}}class Ja{constructor(a,u,f){this.bounds=Ni.convert(this.validateBounds(a)),this.minzoom=u||0,this.maxzoom=f||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){let u=Math.pow(2,a.z),f=Math.floor(o.Y(this.bounds.getWest())*u),g=Math.floor(o.X(this.bounds.getNorth())*u),w=Math.ceil(o.Y(this.bounds.getEast())*u),E=Math.ceil(o.X(this.bounds.getSouth())*u);return a.x>=f&&a.x<w&&a.y>=g&&a.y<E}}class Vu extends o.E{constructor(a,u,f,g){if(super(),this.id=a,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.U(u,["url","scheme","tileSize","promoteId","encoding"])),this._options=o.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let a=yield Gs(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),a&&(o.e(this,a),a.bounds&&(this.tileBounds=new Ja(a.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,o.Z(a)||this.fire(new o.k(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(a){return o._(this,void 0,void 0,function*(){let u=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(u,"Tile"),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(a)};f.request.collectResourceTiming=this._collectResourceTiming;let g="RT";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((w,E)=>{a.reloadPromise={resolve:w,reject:E}})}else a.actor=this.dispatcher.getActor(),g="LT";a.abortController=new AbortController;try{let w=yield a.actor.sendAsync({type:g,data:f},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,w)}catch(w){if(delete a.abortController,a.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(a,null)}})}_getOverzoomParameters(a){if(a.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;let u=a.tileID.scaledTo(this.maxzoom).canonical,f=u.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:u,overzoomRequest:this.map._requestManager.transformRequest(f,"Tile")}}_afterTileLoadWorkerResponse(a,u){if(u&&u.resourceTiming&&(a.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&a.setExpiryData(u),a.loadVectorData(u,this.map.painter),a.reloadPromise){let f=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(f.resolve).catch(f.reject)}}abortTile(a){return o._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"AT",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return o._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ju extends o.E{constructor(a,u,f,g){super(),this.id=a,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},u),o.e(this,o.U(u,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(a=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let u=yield Gs(this._options,this.map._requestManager,this._tileJSONRequest,this.map._ownerWindow);this._tileJSONRequest=null,this._loaded=!0,u&&(o.e(this,u),u.bounds&&(this.tileBounds=new Ja(u.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:a})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,o.Z(u)||this.fire(new o.k(u))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load(!0)}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return o.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return o._(this,void 0,void 0,function*(){let u=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{let f=yield Oe.getImage(this.map._requestManager.transformRequest(u,"Tile"),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&a.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});let g=this.map.painter.context,w=g.gl,E=f.data;a.texture=this.map.painter.getTileTexture(E.width),a.texture?a.texture.update(E,{useMipmap:!0}):(a.texture=new o.T(g,E,w.RGBA,{useMipmap:!0}),a.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),a.state="loaded"}}catch(f){if(delete a.abortController,a.aborted)a.state="unloaded";else if(f)throw a.state="errored",f}})}abortTile(a){return o._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return o._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class xa extends ju{constructor(a,u,f,g){super(a,u,f,g),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(a){return o._(this,void 0,void 0,function*(){let u=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(u,"Tile");a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{let g=yield Oe.getImage(f,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(g&&g.data){let w=g.data;this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&a.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});let E=o.b(w)&&o.$()?w:yield this.readImageNow(w),S={type:this.type,uid:a.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();let I=yield a.actor.sendAsync({type:"LDT",data:S});a.dem=I,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(g){if(delete a.abortController,a.aborted)a.state="unloaded";else if(g)throw a.state="errored",g}})}readImageNow(a){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.a0()){let u=a.width+2,f=a.height+2;try{return new o.R({width:u,height:f},yield o.a1(a,-1,-1,u,f))}catch(g){}}return N.getImageData(a,1)})}_getNeighboringTiles(a){let u=a.canonical,f=Math.pow(2,u.z),g=(u.x-1+f)%f,w=u.x===0?a.wrap-1:a.wrap,E=(u.x+1+f)%f,S=u.x+1===f?a.wrap+1:a.wrap,I={};return I[new o.a2(a.overscaledZ,w,u.z,g,u.y).key]={backfilled:!1},I[new o.a2(a.overscaledZ,S,u.z,E,u.y).key]={backfilled:!1},u.y>0&&(I[new o.a2(a.overscaledZ,w,u.z,g,u.y-1).key]={backfilled:!1},I[new o.a2(a.overscaledZ,a.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},I[new o.a2(a.overscaledZ,S,u.z,E,u.y-1).key]={backfilled:!1}),u.y+1<f&&(I[new o.a2(a.overscaledZ,w,u.z,g,u.y+1).key]={backfilled:!1},I[new o.a2(a.overscaledZ,a.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},I[new o.a2(a.overscaledZ,S,u.z,E,u.y+1).key]={backfilled:!1}),I}unloadTile(a){return o._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"RDT",data:{type:this.type,uid:a.uid,source:this.id}}))})}}function el(v){return v.type==="GeometryCollection"?v.geometries.map(a=>a.coordinates).flat(1/0):v.coordinates.flat(1/0)}function kc(v){let a=new Ni,u;switch(v.type){case"FeatureCollection":u=v.features.map(f=>el(f.geometry)).flat(1/0);break;case"Feature":u=el(v.geometry);break;default:u=el(v)}if(u.length==0)return a;for(let f=0;f<u.length-1;f+=2)a.extend([u[f],u[f+1]]);return a}class zu extends o.E{constructor(a,u,f,g){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=f.getActor(),this.setEventedParent(g),this._data=typeof u.data=="string"?{url:u.data}:{geojson:u.data},this._options=o.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,u.clusterMaxZoom!==void 0&&this.maxzoom<=u.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(u.buffer!==void 0?u.buffer:128),tolerance:this._pixelsToTileUnits(u.tolerance!==void 0?u.tolerance:.375),extent:o.a5,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:o.a5,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(a){return a*(o.a5/this.tileSize)}_getClusterMaxZoom(a){let u=a?Math.round(a):this.maxzoom-1;return Number.isInteger(a)||a===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${a}" rounded to "${u}"`),u}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a,u){this._data=typeof a=="string"?{url:a}:{geojson:a},this._pendingWorkerUpdate={data:a};let f=this._updateWorkerData();return u?f:this}updateData(a,u){this._pendingWorkerUpdate.diff=o.a6(this._pendingWorkerUpdate.diff,a);let f=this._updateWorkerData();return u?f:this}getData(){return o._(this,void 0,void 0,function*(){let a=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:a})})}getBounds(){return o._(this,void 0,void 0,function*(){return kc(yield this.getData())})}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(a.clusterRadius)),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(a.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,u,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:a,limit:u,offset:f}})}_updateWorkerData(){return o._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);let{data:a,diff:u}=this._pendingWorkerUpdate,f=this._getLoadGeoJSONParameters(a,u);a!==void 0?this._pendingWorkerUpdate.data=void 0:u&&(this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,yield this._dispatchWorkerUpdate(f)})}_getLoadGeoJSONParameters(a,u){let f=o.e({type:this.type},this.workerOptions);return typeof a=="string"?(f.request=this.map._requestManager.transformRequest(N.resolveURL(a),"Source"),f.request.collectResourceTiming=this._collectResourceTiming,f):a!==void 0?(f.data=a,f):(u&&(f.dataDiff=u),f)}_dispatchWorkerUpdate(a){return o._(this,void 0,void 0,function*(){this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{let u=yield this.actor.sendAsync({type:"LD",data:a});if(this._isUpdatingWorker=!1,this._removed||u.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));u.data&&(this._data={geojson:u.data});let f=this._applyDiffToSource(a.dataDiff),g=this._getShouldReloadTileOptions(f),w={dataType:"source"};this._applyResourceTiming(w,u),this.fire(new o.l("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},w),{sourceDataType:"content",shouldReloadTileOptions:g})))}catch(u){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(u))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyResourceTiming(a,u){var f;if(!this._collectResourceTiming)return;let g=(f=u.resourceTiming)===null||f===void 0?void 0:f[this.id];if(!g)return;let w=g.slice(0);w?.length&&o.e(a,{resourceTiming:w})}_applyDiffToSource(a){if(!a)return;let u=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){let g=o.a7(this._data.geojson,u);if(!g)throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:g}}if(!this._data.updateable)return;let f=o.a8(this._data.updateable,a,u);return a.removeAll||this._options.cluster?void 0:f}_getShouldReloadTileOptions(a){if(a)return{affectedBounds:a.filter(Boolean).map(u=>kc(u))}}shouldReloadTile(a,{affectedBounds:u}){if(a.state==="loading")return!0;if(a.state==="unloaded")return!1;let{buffer:f,extent:g}=this.workerOptions.geojsonVtOptions,w=(function({x:E,y:S,z:I},k=0){let P=o.a3((E-k)/Math.pow(2,I)),B=o.a4((S+1+k)/Math.pow(2,I)),L=o.a3((E+1+k)/Math.pow(2,I)),$=o.a4((S-k)/Math.pow(2,I));return new Ni([P,B],[L,$])})(a.tileID.canonical,f/g);for(let E of u)if(w.intersects(E))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(a){return o._(this,void 0,void 0,function*(){let u=a.actor?"RT":"LT";a.actor=this.actor;let f={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};a.abortController=new AbortController;let g=yield this.actor.sendAsync({type:u,data:f},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(g,this.map.painter,u==="RT")})}abortTile(a){return o._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return o._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class cs extends o.E{constructor(a,u,f,g){super(),this.flippedWindingOrder=!1,this.id=a,this.dispatcher=f,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=u}load(a){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let u=yield Oe.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,a&&(this.coordinates=a),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,o.Z(u)||this.fire(new o.k(u))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;let u=a.map(o.a9.fromLngLat);var f;return this.tileID=(function(g){let w=o.aa.fromPoints(g),E=w.width(),S=w.height(),I=Math.max(E,S),k=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,k);return new o.ac(k,Math.floor((w.minX+w.maxX)/2*P),Math.floor((w.minY+w.maxY)/2*P))})(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(g=>this.tileID.getTilePoint(g)._round()),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let a=this.map.painter.context,u=a.gl;this.texture||(this.texture=new o.T(a,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let f=!1;for(let g in this.tiles){let w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(a){let{minX:u,minY:f,maxX:g,maxY:w}=o.aa.fromPoints(a),E={};for(let S=0;S<=o.ab;S++){let I=Math.pow(2,S),k=Math.floor(u*I),P=Math.floor(f*I),B=Math.floor(g*I),L=Math.floor(w*I),$=(k%I+I)%I,Y=B%I,ie=Math.floor(k/I),oe=Math.floor(B/I);E[S]={minWrap:ie,maxWrap:oe,minTileXWrapped:$,maxTileXWrapped:Y,minTileY:P,maxTileY:L}}return E}}class Ll extends cs{constructor(a,u,f,g){super(a,u,f,g),this.roundZoom=!0,this.type="video",this.options=u}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;let a=this.options;this.urls=[];for(let u of a.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{let u=yield o.ad(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new o.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){let u=this.video.seekable;a<u.start(0)||a>u.end(0)?this.fire(new o.k(new o.ae(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let a=this.map.painter.context,u=a.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(a,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let f=!1;for(let g in this.tiles){let w=this.tiles[g];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,f=!0)}f&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Eh extends cs{constructor(a,u,f,g){super(a,u,f,g),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(E=>typeof E!="number"))||this.fire(new o.k(new o.ae(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.ae(`sources.${a}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new o.k(new o.ae(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.ae(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.ae(`sources.${a}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let u=this.map.painter.context,f=u.gl;this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new o.T(u,this.canvas,f.RGBA,{premultiply:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let g=!1;for(let w in this.tiles){let E=this.tiles[w];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,g=!0)}g&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}let Uu={},$u=v=>{switch(v){case"geojson":return zu;case"image":return cs;case"raster":return ju;case"raster-dem":return xa;case"vector":return Vu;case"video":return Ll;case"canvas":return Eh}return Uu[v]},Ee="RTLPluginLoaded";class G extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yn()}_syncState(a){return this.status=a,this.dispatcher.broadcast("SRPS",{pluginStatus:a,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return o._(this,arguments,void 0,function*(u,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=N.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Ee))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let W=null;function X(){return W||(W=new G),W}var fe,ye;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(fe||(fe={})),(function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"})(ye||(ye={}));class Me{constructor(a,u){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=a,this.uid=o.af(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(a){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(a||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:a,fadingDirection:u,fadingParentID:f,fadeEndTime:g}){this.resetFadeLogic(),this.fadingRole=a,this.fadingDirection=u,this.fadingParentID=f,this.fadeEndTime=g}setSelfFadeLogic(a){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=a}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=J(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData,this.latestFeatureIndex.encoding=a.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=(function(g,w){let E={};if(!w)return E;for(let S of g){let I=S.layerIds.map(k=>w.getLayer(k)).filter(Boolean);if(I.length!==0){S.layers=I,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>I.filter(P=>P.id===k)[0]));for(let k of I)E[k.id]=S}}return E})(a.buckets,u?.style),this.hasSymbolBuckets=!1;for(let g in this.buckets){let w=this.buckets[g];if(w instanceof o.ah){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let g in this.buckets){let w=this.buckets[g];if(w instanceof o.ah&&w.hasRTLText){this.hasRTLText=!0,X().lazyLoad();break}}this.queryPadding=0;for(let g in this.buckets){let w=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(g).queryRadius(w))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage),this.dashPositions=a.dashPositions}else this.collisionBoxArray=new o.ag}unloadVectorData(){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(let f in this.buckets){let g=this.buckets[f];g.uploadPending()&&g.upload(a)}let u=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(a,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(a,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,u,f,g,w,E,S,I,k,P,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:w,scale:E,tileSize:this.tileSize,pixelPosMatrix:P,transform:I,params:S,queryPadding:this.queryPadding*k,getElevation:B},a,u,f):{}}querySourceFeatures(a,u){let f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;let g=f.loadVTLayers(),w=u&&u.sourceLayer?u.sourceLayer:"",E=g[o.ai]||g[w];if(!E)return;let S=o.aj(u?.filter,u?.globalState),{z:I,x:k,y:P}=this.tileID.canonical,B={z:I,x:k,y:P};for(let L=0;L<E.length;L++){let $=E.feature(L);if(S.needGeometry){let oe=o.ak($,!0);if(!S.filter(new o.H(this.tileID.overscaledZ),oe,this.tileID.canonical))continue}else if(!S.filter(new o.H(this.tileID.overscaledZ),$))continue;let Y=f.getId($,w),ie=new o.al($,I,k,P,Y);ie.tile=B,a.push(ie)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){let u=this.expirationTime;if(a.cacheControl){let f=o.am(a.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){let f=Date.now(),g=!1;if(this.expirationTime>f)g=!1;else if(u)if(this.expirationTime<u)g=!0;else{let w=this.expirationTime-u;w?this.expirationTime=f+Math.max(w,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;let f=this.latestFeatureIndex.loadVTLayers();for(let g in this.buckets){if(!u.style.hasLayer(g))continue;let w=this.buckets[g],E=w.layers[0].sourceLayer||o.ai,S=f[E],I=a[E];if(!S||!I||Object.keys(I).length===0)continue;w.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});let k=u&&u.style&&u.style.getLayer(g);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(w)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(a){this.symbolFadeHoldUntil=J()+a}setDependencies(a,u){let f={};for(let g of u)f[g]=!0;this.dependencies[a]=f}hasDependency(a,u){for(let f of a){let g=this.dependencies[f];if(g){for(let w of u)if(g[w])return!0}}return!1}}class De{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,u,f){let g=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][g]=this.stateChanges[a][g]||{},o.e(this.stateChanges[a][g],f),this.deletedStates[a]===null){this.deletedStates[a]={};for(let w in this.state[a])w!==g&&(this.deletedStates[a][w]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][g]===null){this.deletedStates[a][g]={};for(let w in this.state[a][g])f[w]||(this.deletedStates[a][g][w]=null)}else for(let w in f)this.deletedStates[a]&&this.deletedStates[a][g]&&this.deletedStates[a][g][w]===null&&delete this.deletedStates[a][g][w]}removeFeatureState(a,u,f){if(this.deletedStates[a]===null)return;let g=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},f&&u!==void 0)this.deletedStates[a][g]!==null&&(this.deletedStates[a][g]=this.deletedStates[a][g]||{},this.deletedStates[a][g][f]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][g])for(f in this.deletedStates[a][g]={},this.stateChanges[a][g])this.deletedStates[a][g][f]=null;else this.deletedStates[a][g]=null;else this.deletedStates[a]=null}getState(a,u){let f=String(u),g=o.e({},(this.state[a]||{})[f],(this.stateChanges[a]||{})[f]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){let w=this.deletedStates[a][u];if(w===null)return{};for(let E in w)delete g[E]}return g}initializeTileState(a,u){a.setFeatureState(this.state,u)}coalesceChanges(a,u){let f={};for(let g in this.stateChanges){this.state[g]=this.state[g]||{};let w={};for(let E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),o.e(this.state[g][E],this.stateChanges[g][E]),w[E]=this.state[g][E];f[g]=w}for(let g in this.deletedStates){this.state[g]=this.state[g]||{};let w={};if(this.deletedStates[g]===null)for(let E in this.state[g])w[E]={},this.state[g][E]={};else for(let E in this.deletedStates[g]){if(this.deletedStates[g][E]===null)this.state[g][E]={};else for(let S of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][S];w[E]=this.state[g][E]}f[g]=f[g]||{},o.e(f[g],w)}this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0&&a.setFeatureState(f,u)}}let Ce=89.25;function Se(v,a){let u=o.an(a.lat,-o.ao,o.ao);return new o.P(o.Y(a.lng)*v,o.X(u)*v)}function Xe(v,a){return new o.a9(a.x/v,a.y/v).toLngLat()}function $e(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(o.ap(90-v.pitch)),Math.tan(o.ap(Ce-v.pitch)))}function it(v,a){let u=v.canonical,f=a/o.aq(u.z),g=u.x+Math.pow(2,u.z)*v.wrap,w=o.ar(new Float64Array(16));return o.O(w,w,[g*f,u.y*f,0]),o.Q(w,w,[f/o.a5,f/o.a5,1]),w}function we(v,a,u,f,g){let w=o.a9.fromLngLat(v,a),E=g*o.as(1,v.lat),{x:S,y:I,z:k}=Zt(u,f);return new o.a9(w.x+E*-S,w.y+E*-I,w.z+E*-k)}function Zt(v,a){let u=o.ap(v),f=o.ap(a),g=Math.cos(-u),w=Math.sin(u);return{x:w*Math.sin(f),y:-w*Math.cos(f),z:g}}function Jn(v,a,u){let f=a.intersectsFrustum(v);if(!u||f===0)return f;let g=a.intersectsPlane(u);return g===0?0:f===2&&g===2?2:1}function St(v,a,u){let f=0,g=(u-a)/10;for(let w=0;w<10;w++)f+=g*Math.pow(Math.cos(a+(w+.5)/10*(u-a)),v);return f}function Nt(v,a){return function(u,f,g,w,E){let S=2*((v-1)/o.at(Math.cos(o.ap(Ce-E))/Math.cos(o.ap(Ce)))-1),I=Math.acos(g/w),k=2*St(S-1,0,o.ap(E/2)),P=Math.min(o.ap(Ce),I+o.ap(E/2)),B=St(S-1,Math.min(P,I-o.ap(E/2)),P),L=Math.atan(f/g),$=Math.hypot(f,g),Y=u;return Y+=o.at(w/$/Math.max(.5,Math.cos(o.ap(E/2)))),Y+=S*o.at(Math.cos(L))/2,Y-=o.at(Math.max(1,B/k/a))/2,Y}}let cn=Nt(9.314,3);function Hi(v,a){let u=(a.roundZoom?Math.round:Math.floor)(v.zoom+o.at(v.tileSize/a.tileSize));return Math.max(0,u)}function hi(v,a){let u=v.getCameraFrustum(),f=v.getClippingPlane(),g=v.screenPointToMercatorCoordinate(v.getCameraPoint()),w=o.a9.fromLngLat(v.center,v.elevation);g.z=w.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;let E=v.getCoveringTilesDetailsProvider(),S=E.allowVariableZoom(v,a),I=Hi(v,a),k=a.minzoom||0,P=a.maxzoom!==void 0?a.maxzoom:v.maxZoom,B=Math.min(Math.max(0,I),P),L=Math.pow(2,B),$=[L*g.x,L*g.y,0],Y=[L*w.x,L*w.y,0],ie=Math.hypot(w.x-g.x,w.y-g.y),oe=Math.abs(w.z-g.z),re=Math.hypot(ie,oe),ue=pe=>({zoom:0,x:0,y:0,wrap:pe,fullyVisible:!1}),ge=[],ce=[];if(v.renderWorldCopies&&E.allowWorldCopies())for(let pe=1;pe<=3;pe++)ge.push(ue(-pe)),ge.push(ue(pe));for(ge.push(ue(0));ge.length>0;){let pe=ge.pop(),ve=pe.x,he=pe.y,be=pe.fullyVisible,Pe={x:ve,y:he,z:pe.zoom},Ae=E.getTileBoundingVolume(Pe,pe.wrap,v.elevation,a);if(!be){let at=Jn(u,Ae,f);if(at===0)continue;be=at===2}let ke=E.distanceToTile2d(g.x,g.y,Pe,Ae),Re=I;S&&(Re=(a.calculateTileZoom||cn)(v.zoom+o.at(v.tileSize/a.tileSize),ke,oe,re,v.fov)),Re=(a.roundZoom?Math.round:Math.floor)(Re),Re=Math.max(0,Re);let ot=Math.min(Re,P);if(pe.wrap=E.getWrap(w,Pe,pe.wrap),pe.zoom>=ot){if(pe.zoom<k)continue;let at=B-pe.zoom,Ye=$[0]-.5-(ve<<at),dt=$[1]-.5-(he<<at),Yt=a.reparseOverscaled?Math.max(pe.zoom,Re):pe.zoom;ce.push({tileID:new o.a2(pe.zoom===P?Yt:pe.zoom,pe.wrap,pe.zoom,ve,he),distanceSq:o.au([Y[0]-.5-ve,Y[1]-.5-he]),tileDistanceToCamera:Math.sqrt(Ye*Ye+dt*dt)})}else for(let at=0;at<4;at++)ge.push({zoom:pe.zoom+1,x:(ve<<1)+at%2,y:(he<<1)+(at>>1),wrap:pe.wrap,fullyVisible:be})}return ce.sort((pe,ve)=>pe.distanceSq-ve.distanceSq).map(pe=>pe.tileID)}let kr=o.aa.fromPoints([new o.P(0,0),new o.P(o.a5,o.a5)]);function Rr(v){return v==="raster"||v==="image"||v==="video"}function Gi(v,a,u,f,g,w,E){if(!a.hasData())return!1;let{tileID:S,fadingRole:I,fadingDirection:k,fadingParentID:P}=a;if(I===fe.Base&&k===ye.Incoming&&P)return u[P.key]=P,!0;let B=Math.max(S.overscaledZ-g,w);for(let L=S.overscaledZ-1;L>=B;L--){let $=S.scaledTo(L),Y=v.getLoadedTile($);if(Y)return a.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:ye.Incoming,fadingParentID:Y.tileID,fadeEndTime:f+E}),Y.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:ye.Departing,fadeEndTime:f+E}),u[$.key]=$,!0}return!1}function Pr(v,a,u,f,g,w){if(!a.hasData())return!1;let E=a.tileID.children(g),S=Ke(v,a,E,u,f,g,w);if(S)return!0;for(let I of E)Ke(v,a,I.children(g),u,f,g,w)&&(S=!0);return S}function Ke(v,a,u,f,g,w,E){if(u[0].overscaledZ>=w)return!1;let S=!1;for(let I of u){let k=v.getLoadedTile(I);if(!k)continue;let{fadingRole:P,fadingDirection:B,fadingParentID:L}=k;P===fe.Base&&B===ye.Departing&&L||(k.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:ye.Departing,fadingParentID:a.tileID,fadeEndTime:g+E}),a.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:ye.Incoming,fadeEndTime:g+E})),f[I.key]=I,S=!0}return S}function dr(v,a,u,f){let g=v.tileID;return!!v.selfFading||!v.hasData()&&!!a.has(g)&&(v.setSelfFadeLogic(u+f),!0)}function qo(v,a){var u;v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let f=a.tileID.canonical.x-v.tileID.canonical.x,g=a.tileID.canonical.y-v.tileID.canonical.y,w=Math.pow(2,v.tileID.canonical.z),E=a.tileID.key;f===0&&g===0||Math.abs(g)>1||(Math.abs(f)>1&&(Math.abs(f+w)===1?f+=w:Math.abs(f-w)===1&&(f-=w)),a.dem&&v.dem&&(v.dem.backfillBorder(a.dem,f,g),!((u=v.neighboringTiles)===null||u===void 0)&&u[E]&&(v.neighboringTiles[E].backfilled=!0)))}class Rc{constructor(){this._tiles={}}handleWrapJump(a){let u={};for(let f in this._tiles){let g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+a),u[g.tileID.key]=g}this._tiles=u}setFeatureState(a,u){for(let f in this._tiles)this._tiles[f].setFeatureState(a,u)}getAllTiles(){return Object.values(this._tiles)}getAllIds(a=!1){return a?Object.values(this._tiles).map(u=>u.tileID).sort(o.aw).map(u=>u.key):Object.keys(this._tiles)}getTileById(a){return this._tiles[a]}setTile(a,u){this._tiles[a]=u}deleteTileById(a){delete this._tiles[a]}getLoadedTile(a){let u=this.getTileById(a.key);return u?.hasData()?u:null}isIdRenderable(a,u=!1){var f;return(f=this.getTileById(a))===null||f===void 0?void 0:f.isRenderable(u)}getRenderableIds(a=0,u){let f=[];for(let g of this.getAllIds())this.isIdRenderable(g,u)&&f.push(this.getTileById(g));return u?f.sort((g,w)=>{let E=g.tileID,S=w.tileID,I=new o.P(E.canonical.x,E.canonical.y)._rotate(-a),k=new o.P(S.canonical.x,S.canonical.y)._rotate(-a);return E.overscaledZ-S.overscaledZ||k.y-I.y||k.x-I.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(o.aw).map(g=>g.key)}}class er extends o.E{constructor(a,u,f){super(),this.id=a,this.dispatcher=f,this.on("data",g=>this._dataHandler(g)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,w,E,S)=>{let I=new($u(w.type))(g,w,E,S);if(I.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${I.id}`);return I})(a,u,f,this),this._inViewTiles=new Rc,this._outOfViewCache=new o.ax(0,g=>this._unloadTile(g)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new De,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){for(let u of this._inViewTiles.getAllTiles())u.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a),this._inViewTiles=new Rc}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let a of this._inViewTiles.getAllTiles())if(a.state!=="loaded"&&a.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;let a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,u,f){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,u,f)}catch(g){a.state="errored",g.status!==404?this._source.fire(new o.k(g,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new o.l("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(let u of this._inViewTiles.getAllTiles())u.upload(a),u.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(a){var u;return this._inViewTiles.getRenderableIds((u=this.transform)===null||u===void 0?void 0:u.bearingInRadians,a)}hasRenderableParent(a){let u=a.overscaledZ-1;if(u>=this._source.minzoom){let f=this.getLoadedTile(a.scaledTo(u));if(f)return this._inViewTiles.isIdRenderable(f.tileID.key)}return!1}reload(a,u=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(let f of this._inViewTiles.getAllIds()){let g=this._inViewTiles.getTileById(f);u&&!this._source.shouldReloadTile(g,u)||(a?this._reloadTile(f,"expired"):g.state!=="errored"&&this._reloadTile(f,"reloading"))}}}_reloadTile(a,u){return o._(this,void 0,void 0,function*(){let f=this._inViewTiles.getTileById(a);f&&(f.state!=="loading"&&(f.state=u),yield this._loadTile(f,a,u))})}_tileLoaded(a,u,f){a.timeAdded=J(),a.selfFading&&(a.fadeEndTime=a.timeAdded+this._rasterFadeDuration),f==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(u,a),this.getSource().type==="raster-dem"&&a.dem&&(function(g,w){var E,S;let I=w.getRenderableIds();for(let k of I){if(!g.neighboringTiles||!g.neighboringTiles[k])continue;let P=w.getTileById(k);g.neighboringTiles[k].backfilled||qo(g,P),!((S=(E=P.neighboringTiles)===null||E===void 0?void 0:E[g.tileID.key])===null||S===void 0)&&S.backfilled||qo(P,g)}})(a,this._inViewTiles),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:a,coord:a.tileID}))}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._inViewTiles.getTileById(a)}_retainLoadedChildren(a,u){let f=this._getLoadedDescendents(u),g=new Set;for(let w of u){let E=f[w.key];if(!E?.length){g.add(w);continue}let S=w.overscaledZ+er.maxOverzooming,I=E.filter(B=>B.tileID.overscaledZ<=S);if(!I.length){g.add(w);continue}let k=Math.min(...I.map(B=>B.tileID.overscaledZ)),P=I.filter(B=>B.tileID.overscaledZ===k).map(B=>B.tileID);for(let B of P)a[B.key]=B;this._areDescendentsComplete(P,k,w.overscaledZ)||g.add(w)}return g}_getLoadedDescendents(a){var u;let f={};for(let g of this._inViewTiles.getAllTiles().filter(w=>w.hasData()))for(let w of a)g.tileID.isChildOf(w)&&(f[u=w.key]||(f[u]=[])).push(g);return f}_areDescendentsComplete(a,u,f){return a.length===1&&a[0].isOverscaled()?a[0].overscaledZ===u:Math.pow(4,u-f)===a.length}getLoadedTile(a){return this._inViewTiles.getLoadedTile(a)}updateCacheSize(a){let u=Math.ceil(a.width/this._source.tileSize)+1,f=Math.ceil(a.height/this._source.tileSize)+1,g=Math.floor(u*f*(this._maxTileCacheZoomLevels===null?o.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._outOfViewCache.setMaxSize(w)}handleWrapJump(a){let u=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);this._prevLng=a,u&&(this._inViewTiles.handleWrapJump(u),this._resetTileReloadTimers())}update(a,u){if(!this._sourceLoaded||this._paused)return;let f;this.transform=a,this.terrain=u,this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?f=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new o.a2(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(f=hi(a,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?a.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter(I=>this._source.hasTile(I)))):f=[],this.usedForTerrain&&(f=this._addTerrainIdealTiles(f));let g=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,g&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let w=Hi(a,this._source),E=this._updateRetainedTiles(f,w),S=Rr(this._source.type);S&&this._rasterFadeDuration>0&&!u&&(function(I,k,P,B,L,$,Y){let ie=J(),oe=o.av(k);for(let re of k){let ue=I.getTileById(re.key);ue.fadingDirection!==ye.Departing&&ue.fadeOpacity!==0||ue.resetFadeLogic(),Gi(I,ue,P,ie,B,L,Y)||Pr(I,ue,P,ie,$,Y)||dr(ue,oe,ie,Y)||ue.resetFadeLogic()}})(this._inViewTiles,f,E,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),S?this._cleanUpRasterTiles(E):this._cleanUpVectorTiles(E)}_cleanUpRasterTiles(a){for(let u of this._inViewTiles.getAllIds())a[u]||this._removeTile(u)}_cleanUpVectorTiles(a){for(let u of this._inViewTiles.getAllIds()){let f=this._inViewTiles.getTileById(u);a[u]?f.clearSymbolFadeHold():f.hasSymbolBuckets?f.holdingForSymbolFade()?f.symbolFadeFinished()&&this._removeTile(u):f.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(u)}}_addTerrainIdealTiles(a){let u=[];for(let f of a)if(f.canonical.z>this._source.minzoom){let g=f.scaledTo(f.canonical.z-1);u.push(g);let w=f.scaledTo(Math.max(this._source.minzoom,Math.min(f.canonical.z,5)));u.push(w)}return a.concat(u)}releaseSymbolFadeTiles(){for(let a of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(a).holdingForSymbolFade()&&this._removeTile(a)}_updateRetainedTiles(a,u){var f;let g=new Set;for(let k of a)this._addTile(k).hasData()||g.add(k);let w=a.reduce((k,P)=>(k[P.key]=P,k),{}),E=this._retainLoadedChildren(w,g),S={},I=Math.max(u-er.maxUnderzooming,this._source.minzoom);for(let k of E){let P=this._inViewTiles.getTileById(k.key),B=P?.wasRequested();for(let L=k.overscaledZ-1;L>=I;--L){let $=k.scaledTo(L);if(S[$.key])break;if(S[$.key]=!0,P=this.getTile($),!P&&B&&(P=this._addTile($)),P){let Y=P.hasData();if((Y||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||B)&&(w[$.key]=$),B=P.wasRequested(),Y)break}}}return w}_addTile(a){let u=this._inViewTiles.getTileById(a.key);if(u)return u;u=this._outOfViewCache.getAndRemove(a),u&&(u.resetFadeLogic(),this._setTileReloadTimer(a.key,u),u.tileID=a,this._state.initializeTileState(u,this.map?this.map.painter:null));let f=u;return u||(u=new Me(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(u,a.key,u.state)),u.uses++,this._inViewTiles.setTile(a.key,u),f||this._source.fire(new o.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(a,u){this._clearTileReloadTimer(a);let f=u.getExpiryTimeout();f&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},f))}_clearTileReloadTimer(a){let u=this._timers[a];u&&(clearTimeout(u),delete this._timers[a])}_resetTileReloadTimers(){for(let a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(let a of this._inViewTiles.getAllIds()){let u=this._inViewTiles.getTileById(a);this._setTileReloadTimer(a,u)}}refreshTiles(a){for(let u of this._inViewTiles.getAllIds()){let f=this._inViewTiles.getTileById(u);(this._inViewTiles.isIdRenderable(u)||f.state=="errored")&&a.some(g=>g.equals(f.tileID.canonical))&&this._reloadTile(u,"expired")}}_removeTile(a){let u=this._inViewTiles.getTileById(a);u&&(u.uses--,this._inViewTiles.deleteTileById(a),this._clearTileReloadTimer(a),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._outOfViewCache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(a){a.dataType==="source"&&(a.sourceDataType!=="metadata"?a.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(a.sourceDataChanged,a.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let a of this._inViewTiles.getAllIds())this._removeTile(a);this._outOfViewCache.reset()}tilesIn(a,u,f){let g=[],w=this.transform;if(!w)return g;let E=w.getCoveringTilesDetailsProvider().allowWorldCopies(),S=f?w.getCameraQueryGeometry(a):a,I=$=>w.screenPointToMercatorCoordinate($,this.terrain),k=this.transformBbox(a,I,!E),P=this.transformBbox(S,I,!E),B=this.getIds(),L=o.aa.fromPoints(P);for(let $=0;$<B.length;$++){let Y=this._inViewTiles.getTileById(B[$]);if(Y.holdingForSymbolFade())continue;let ie=E?[Y.tileID]:[Y.tileID.unwrapTo(-1),Y.tileID.unwrapTo(0)],oe=Math.pow(2,w.zoom-Y.tileID.overscaledZ),re=u*Y.queryPadding*o.a5/Y.tileSize/oe;for(let ue of ie){let ge=L.map(ce=>ue.getTilePoint(new o.a9(ce.x,ce.y)));if(ge.expandBy(re),ge.intersects(kr)){let ce=k.map(ve=>ue.getTilePoint(ve)),pe=P.map(ve=>ue.getTilePoint(ve));g.push({tile:Y,tileID:E?ue:ue.unwrapTo(0),queryGeometry:ce,cameraQueryGeometry:pe,scale:oe})}}}return g}transformBbox(a,u,f){let g=a.map(u);if(f){let w=o.aa.fromPoints(a);w.shrinkBy(.001*Math.min(w.width(),w.height()));let E=w.map(u);o.aa.fromPoints(g).covers(E)||(g=g.map(S=>S.x>.5?new o.a9(S.x-1,S.y,S.z):S))}return g}getVisibleCoordinates(a){let u=this.getRenderableIds(a).map(f=>this._inViewTiles.getTileById(f).tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){return!!this._source.hasTransition()||!(!Rr(this._source.type)||!(function(a,u){if(u<=0)return!1;let f=J();for(let g of a.getAllTiles())if(g.fadeEndTime>=f)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(a){this._rasterFadeDuration=a}setFeatureState(a,u,f){this._state.updateState(a=a||o.ai,u,f)}removeFeatureState(a,u,f){this._state.removeFeatureState(a=a||o.ai,u,f)}getFeatureState(a,u){return this._state.getState(a=a||o.ai,u)}setDependencies(a,u,f){let g=this._inViewTiles.getTileById(a);g&&g.setDependencies(u,f)}reloadTilesForDependencies(a,u){for(let f of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(f).hasDependency(a,u)&&this._reloadTile(f,"reloading");this._outOfViewCache.filter(f=>!f.hasDependency(a,u))}areTilesLoaded(){for(let a of this._inViewTiles.getAllTiles())if(a.state!=="loaded"&&a.state!=="errored")return!1;return!0}}er.maxUnderzooming=10,er.maxOverzooming=3;class ut{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.an(a,0,1);let u=1,f=this._distances[u],g=a*this.paddedLength+this.padding;for(;f<g&&u<this._distances.length;)f=this._distances[++u];let w=u-1,E=this._distances[w],S=f-E,I=S>0?(g-E)/S:0;return this.points[w].mult(1-I).add(this.points[u].mult(I))}}function nn(v,a){let u=!0;return v==="always"||v!=="never"&&a!=="never"||(u=!1),u}class gn{constructor(a,u,f){let g=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(a/f),this.yCellCount=Math.ceil(u/f);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,f,g,w){this._forEachCell(u,f,g,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}insertCircle(a,u,f,g){this._forEachCell(u-g,f-g,u+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(f),this.circles.push(g)}_insertBoxCell(a,u,f,g,w,E){this.boxCells[w].push(E)}_insertCircleCell(a,u,f,g,w,E){this.circleCells[w].push(E)}_query(a,u,f,g,w,E,S){if(f<0||a>this.width||g<0||u>this.height)return[];let I=[];if(a<=0&&u<=0&&this.width<=f&&this.height<=g){if(w)return[{key:null,x1:a,y1:u,x2:f,y2:g}];for(let k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){let P=this.circles[3*k],B=this.circles[3*k+1],L=this.circles[3*k+2];I.push({key:this.circleKeys[k],x1:P-L,y1:B-L,x2:P+L,y2:B+L})}}else this._forEachCell(a,u,f,g,this._queryCell,I,{hitTest:w,overlapMode:E,seenUids:{box:{},circle:{}}},S);return I}query(a,u,f,g){return this._query(a,u,f,g,!1,null)}hitTest(a,u,f,g,w,E){return this._query(a,u,f,g,!0,w,E).length>0}hitTestCircle(a,u,f,g,w){let E=a-f,S=a+f,I=u-f,k=u+f;if(S<0||E>this.width||k<0||I>this.height)return!1;let P=[];return this._forEachCell(E,I,S,k,this._queryCellCircle,P,{hitTest:!0,overlapMode:g,circle:{x:a,y:u,radius:f},seenUids:{box:{},circle:{}}},w),P.length>0}_queryCell(a,u,f,g,w,E,S,I){let{seenUids:k,hitTest:P,overlapMode:B}=S,L=this.boxCells[w];if(L!==null){let Y=this.bboxes;for(let ie of L)if(!k.box[ie]){k.box[ie]=!0;let oe=4*ie,re=this.boxKeys[ie];if(a<=Y[oe+2]&&u<=Y[oe+3]&&f>=Y[oe+0]&&g>=Y[oe+1]&&(!I||I(re))&&(!P||!nn(B,re.overlapMode))&&(E.push({key:re,x1:Y[oe],y1:Y[oe+1],x2:Y[oe+2],y2:Y[oe+3]}),P))return!0}}let $=this.circleCells[w];if($!==null){let Y=this.circles;for(let ie of $)if(!k.circle[ie]){k.circle[ie]=!0;let oe=3*ie,re=this.circleKeys[ie];if(this._circleAndRectCollide(Y[oe],Y[oe+1],Y[oe+2],a,u,f,g)&&(!I||I(re))&&(!P||!nn(B,re.overlapMode))){let ue=Y[oe],ge=Y[oe+1],ce=Y[oe+2];if(E.push({key:re,x1:ue-ce,y1:ge-ce,x2:ue+ce,y2:ge+ce}),P)return!0}}}return!1}_queryCellCircle(a,u,f,g,w,E,S,I){let{circle:k,seenUids:P,overlapMode:B}=S,L=this.boxCells[w];if(L!==null){let Y=this.bboxes;for(let ie of L)if(!P.box[ie]){P.box[ie]=!0;let oe=4*ie,re=this.boxKeys[ie];if(this._circleAndRectCollide(k.x,k.y,k.radius,Y[oe+0],Y[oe+1],Y[oe+2],Y[oe+3])&&(!I||I(re))&&!nn(B,re.overlapMode))return E.push(!0),!0}}let $=this.circleCells[w];if($!==null){let Y=this.circles;for(let ie of $)if(!P.circle[ie]){P.circle[ie]=!0;let oe=3*ie,re=this.circleKeys[ie];if(this._circlesCollide(Y[oe],Y[oe+1],Y[oe+2],k.x,k.y,k.radius)&&(!I||I(re))&&!nn(B,re.overlapMode))return E.push(!0),!0}}}_forEachCell(a,u,f,g,w,E,S,I){let k=this._convertToXCellCoord(a),P=this._convertToYCellCoord(u),B=this._convertToXCellCoord(f),L=this._convertToYCellCoord(g);for(let $=k;$<=B;$++)for(let Y=P;Y<=L;Y++)if(w.call(this,a,u,f,g,this.xCellCount*Y+$,E,S,I))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,f,g,w,E){let S=g-a,I=w-u,k=f+E;return k*k>S*S+I*I}_circleAndRectCollide(a,u,f,g,w,E,S){let I=(E-g)/2,k=Math.abs(a-(g+I));if(k>I+f)return!1;let P=(S-w)/2,B=Math.abs(u-(w+P));if(B>P+f)return!1;if(k<=I||B<=P)return!0;let L=k-I,$=B-P;return L*L+$*$<=f*f}}function us(v,a,u){let f=o.N();if(!v){let{vecSouth:B,vecEast:L}=tl(a),$=m();$[0]=L[0],$[1]=L[1],$[2]=B[0],$[3]=B[1],g=$,(P=(E=(w=$)[0])*(k=w[3])-(I=w[2])*(S=w[1]))&&(g[0]=k*(P=1/P),g[1]=-S*P,g[2]=-I*P,g[3]=E*P),f[0]=$[0],f[1]=$[1],f[4]=$[2],f[5]=$[3]}var g,w,E,S,I,k,P;return o.Q(f,f,[1/u,1/u,1]),f}function Fp(v,a,u,f){if(v){let g=o.N();if(!a){let{vecSouth:w,vecEast:E}=tl(u);g[0]=E[0],g[1]=E[1],g[4]=w[0],g[5]=w[1]}return o.Q(g,g,[f,f,1]),g}return u.pixelsToClipSpaceMatrix}function tl(v){let a=Math.cos(v.rollInRadians),u=Math.sin(v.rollInRadians),f=Math.cos(v.pitchInRadians),g=Math.cos(v.bearingInRadians),w=Math.sin(v.bearingInRadians),E=o.aC();E[0]=-g*f*u-w*a,E[1]=-w*f*u+g*a;let S=o.aD(E);S<1e-9?o.aE(E):o.aF(E,E,1/S);let I=o.aC();I[0]=g*f*a-w*u,I[1]=w*f*a+g*u;let k=o.aD(I);return k<1e-9?o.aE(I):o.aF(I,I,1/k),{vecEast:I,vecSouth:E}}function un(v,a,u,f){let g;f?(g=[v,a,f(v,a),1],o.aH(g,g,u)):(g=[v,a,0,1],Vp(g,g,u));let w=g[3];return{point:new o.P(g[0]/w,g[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function Ch(v,a){return .5+v/a*.5}function Th(v,a){return v.x>=-a[0]&&v.x<=a[0]&&v.y>=-a[1]&&v.y<=a[1]}function Lp(v,a,u,f,g,w,E,S,I,k,P,B,L){let $=u?v.textSizeData:v.iconSizeData,Y=o.ay($,a.transform.zoom),ie=[256/a.width*2+1,256/a.height*2+1],oe=u?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;oe.clear();let re=v.lineVertexArray,ue=u?v.text.placedSymbolArray:v.icon.placedSymbolArray,ge=a.transform.width/a.transform.height,ce=!1;for(let pe=0;pe<ue.length;pe++){let ve=ue.get(pe);if(ve.hidden||ve.writingMode===o.az.vertical&&!ce){Nc(ve.numGlyphs,oe);continue}ce=!1;let he=new o.P(ve.anchorX,ve.anchorY),be={getElevation:L,pitchedLabelPlaneMatrix:f,lineVertexArray:re,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:a.transform,tileAnchorPoint:he,unwrappedTileID:I,width:k,height:P,translation:B},Pe=qu(ve.anchorX,ve.anchorY,be);if(!Th(Pe.point,ie)){Nc(ve.numGlyphs,oe);continue}let Ae=Ch(a.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),ke=o.aA($,Y,ve),Re=w?ke*a.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,I)/Ae:ke*Ae,ot=Gu({projectionContext:be,pitchedLabelPlaneMatrixInverse:g,symbol:ve,fontSize:Re,flip:!1,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:S});ce=ot.useVertical,(ot.notEnoughRoom||ce||ot.needsFlipping&&Gu({projectionContext:be,pitchedLabelPlaneMatrixInverse:g,symbol:ve,fontSize:Re,flip:!0,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:oe,aspectRatio:ge,rotateToLine:S}).notEnoughRoom)&&Nc(ve.numGlyphs,oe)}u?v.text.dynamicLayoutVertexBuffer.updateData(oe):v.icon.dynamicLayoutVertexBuffer.updateData(oe)}function Hu(v,a,u,f,g,w,E,S){let I=w.glyphStartIndex+w.numGlyphs,k=w.lineStartIndex,P=w.lineStartIndex+w.lineLength,B=a.getoffsetX(w.glyphStartIndex),L=a.getoffsetX(I-1),$=qs(v*B,u,f,g,w.segment,k,P,S,E);if(!$)return null;let Y=qs(v*L,u,f,g,w.segment,k,P,S,E);return Y?S.projectionCache.anyProjectionOccluded?null:{first:$,last:Y}:null}function Sh(v,a,u,f){return v===o.az.horizontal&&Math.abs(u.y-a.y)>Math.abs(u.x-a.x)*f?{useVertical:!0}:(v===o.az.vertical?a.y<u.y:a.x>u.x)?{needsFlipping:!0}:null}function Gu(v){let{projectionContext:a,pitchedLabelPlaneMatrixInverse:u,symbol:f,fontSize:g,flip:w,keepUpright:E,glyphOffsetArray:S,dynamicLayoutVertexArray:I,aspectRatio:k,rotateToLine:P}=v,B=g/24,L=f.lineOffsetX*B,$=f.lineOffsetY*B,Y;if(f.numGlyphs>1){let ie=f.glyphStartIndex+f.numGlyphs,oe=f.lineStartIndex,re=f.lineStartIndex+f.lineLength,ue=Hu(B,S,L,$,w,f,P,a);if(!ue)return{notEnoughRoom:!0};let ge=Bp(ue.first.point.x,ue.first.point.y,a,u),ce=Bp(ue.last.point.x,ue.last.point.y,a,u);if(E&&!w){let pe=Sh(f.writingMode,ge,ce,k);if(pe)return pe}Y=[ue.first];for(let pe=f.glyphStartIndex+1;pe<ie-1;pe++){let ve=qs(B*S.getoffsetX(pe),L,$,w,f.segment,oe,re,a,P);if(!ve)return{notEnoughRoom:!0};Y.push(ve)}Y.push(ue.last)}else{if(E&&!w){let oe=Wn(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,re=f.lineStartIndex+f.segment+1,ue=new o.P(a.lineVertexArray.getx(re),a.lineVertexArray.gety(re)),ge=Wn(ue.x,ue.y,a),ce=ge.signedDistanceFromCamera>0?ge.point:Dh(a.tileAnchorPoint,ue,oe,1,a),pe=Bp(oe.x,oe.y,a,u),ve=Bp(ce.x,ce.y,a,u),he=Sh(f.writingMode,pe,ve,k);if(he)return he}let ie=qs(B*S.getoffsetX(f.glyphStartIndex),L,$,w,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,a,P);if(!ie||a.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Y=[ie]}for(let ie of Y)o.aG(I,ie.point,ie.angle);return{}}function Dh(v,a,u,f,g){let w=v.add(v.sub(a)._unit()),E=Wn(w.x,w.y,g).point,S=u.sub(E);return u.add(S._mult(f/S.mag()))}function ko(v,a,u){let f=a.projectionCache;if(f.projections[v])return f.projections[v];let g=new o.P(a.lineVertexArray.getx(v),a.lineVertexArray.gety(v)),w=Wn(g.x,g.y,a);if(w.signedDistanceFromCamera>0)return f.projections[v]=w.point,f.anyProjectionOccluded=f.anyProjectionOccluded||w.isOccluded,w.point;let E=v-u.direction;return Dh(u.distanceFromAnchor===0?a.tileAnchorPoint:new o.P(a.lineVertexArray.getx(E),a.lineVertexArray.gety(E)),g,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,a)}function Wn(v,a,u){let f=v+u.translation[0],g=a+u.translation[1],w;return u.pitchWithMap?(w=un(f,g,u.pitchedLabelPlaneMatrix,u.getElevation),w.isOccluded=!1):(w=u.transform.projectTileCoordinates(f,g,u.unwrappedTileID,u.getElevation),w.point.x=(.5*w.point.x+.5)*u.width,w.point.y=(.5*-w.point.y+.5)*u.height),w}function Bp(v,a,u,f){if(u.pitchWithMap){let g=[v,a,0,1];return o.aH(g,g,f),u.transform.projectTileCoordinates(g[0]/g[3],g[1]/g[3],u.unwrappedTileID,u.getElevation).point}return{x:v/u.width*2-1,y:1-a/u.height*2}}function qu(v,a,u){return u.transform.projectTileCoordinates(v,a,u.unwrappedTileID,u.getElevation)}function Ih(v,a,u){return v._unit()._perp()._mult(a*u)}function Pc(v,a,u,f,g,w,E,S,I){if(S.projectionCache.offsets[v])return S.projectionCache.offsets[v];let k=u.add(a);if(v+I.direction<f||v+I.direction>=g)return S.projectionCache.offsets[v]=k,k;let P=ko(v+I.direction,S,I),B=Ih(P.sub(u),E,I.direction),L=u.add(B),$=P.add(B);return S.projectionCache.offsets[v]=o.aI(w,k,L,$)||k,S.projectionCache.offsets[v]}function qs(v,a,u,f,g,w,E,S,I){let k=f?v-a:v+a,P=k>0?1:-1,B=0;f&&(P*=-1,B=Math.PI),P<0&&(B+=Math.PI);let L,$=P>0?w+g:w+g+1;S.projectionCache.cachedAnchorPoint?L=S.projectionCache.cachedAnchorPoint:(L=Wn(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=L);let Y,ie,oe=L,re=L,ue=0,ge=0,ce=Math.abs(k),pe=[],ve;for(;ue+ge<=ce;){if($+=P,$<w||$>=E)return null;ue+=ge,re=oe,ie=Y;let Pe={absOffsetX:ce,direction:P,distanceFromAnchor:ue,previousVertex:re};if(oe=ko($,S,Pe),u===0)pe.push(re),ve=oe.sub(re);else{let Ae,ke=oe.sub(re);Ae=ke.mag()===0?Ih(ko($+P,S,Pe).sub(oe),u,P):Ih(ke,u,P),ie||(ie=re.add(Ae)),Y=Pc($,Ae,oe,w,E,ie,u,S,Pe),pe.push(ie),ve=Y.sub(ie)}ge=ve.mag()}let he=ve._mult((ce-ue)/ge)._add(ie||re),be=B+Math.atan2(oe.y-re.y,oe.x-re.x);return pe.push(he),{point:he,angle:I?be:0,path:pe}}let Yb=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Nc(v,a){for(let u=0;u<v;u++){let f=a.length;a.resize(f+4),a.float32.set(Yb,3*f)}}function Vp(v,a,u){let f=a[0],g=a[1];return v[0]=u[0]*f+u[4]*g+u[12],v[1]=u[1]*f+u[5]*g+u[13],v[3]=u[3]*f+u[7]*g+u[15],v}let qi=100;class Xb{constructor(a,u=new gn(a.width+200,a.height+200,25),f=new gn(a.width+200,a.height+200,25)){this.transform=a,this.grid=u,this.ignoredGrid=f,this.pitchFactor=Math.cos(a.pitch*Math.PI/180)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+qi,this.screenBottomBoundary=a.height+qi,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,u,f,g,w,E,S,I,k,P,B,L){let $=this.projectAndGetPerspectiveRatio(a.anchorPointX+I[0],a.anchorPointY+I[1],w,P,L),Y=f*$.perspectiveRatio,ie;if(E||S)ie=this._projectCollisionBox(a,Y,g,w,E,S,I,$,P,B,L);else{let ve=$.x+(B?B.x*Y:0),he=$.y+(B?B.y*Y:0);ie={allPointsOccluded:!1,box:[ve+a.x1*Y,he+a.y1*Y,ve+a.x2*Y,he+a.y2*Y]}}let[oe,re,ue,ge]=ie.box,ce=E?ie.allPointsOccluded:$.isOccluded,pe=ce;return pe||(pe=$.perspectiveRatio<this.perspectiveRatioCutoff),pe||(pe=!this.isInsideGrid(oe,re,ue,ge)),pe||u!=="always"&&this.grid.hitTest(oe,re,ue,ge,u,k)?{box:[oe,re,ue,ge],placeable:!1,offscreen:!1,occluded:ce}:{box:[oe,re,ue,ge],placeable:!0,offscreen:this.isOffscreen(oe,re,ue,ge),occluded:ce}}placeCollisionCircles(a,u,f,g,w,E,S,I,k,P,B,L,$,Y){let ie=[],oe=new o.P(u.anchorX,u.anchorY),re=this.getPerspectiveRatio(oe.x,oe.y,E,Y),ue=(k?w*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,E)/re:w*re)/o.aM,ge={getElevation:Y,pitchedLabelPlaneMatrix:S,lineVertexArray:f,pitchWithMap:k,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:oe,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:$},ce=Hu(ue,g,u.lineOffsetX*ue,u.lineOffsetY*ue,!1,u,!1,ge),pe=!1,ve=!1,he=!0;if(ce){let be=.5*B*re+L,Pe=new o.P(-100,-100),Ae=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ke=new ut,Re=ce.first,ot=ce.last,at=[];for(let Yt=Re.path.length-1;Yt>=1;Yt--)at.push(Re.path[Yt]);for(let Yt=1;Yt<ot.path.length;Yt++)at.push(ot.path[Yt]);let Ye=2.5*be;if(k){let Yt=this.projectPathToScreenSpace(at,ge);at=Yt.some(Hn=>Hn.signedDistanceFromCamera<=0)?[]:Yt.map(Hn=>Hn.point)}let dt=[];if(at.length>0){let Yt=at[0].clone(),Hn=at[0].clone();for(let yi=1;yi<at.length;yi++)Yt.x=Math.min(Yt.x,at[yi].x),Yt.y=Math.min(Yt.y,at[yi].y),Hn.x=Math.max(Hn.x,at[yi].x),Hn.y=Math.max(Hn.y,at[yi].y);dt=Yt.x>=Pe.x&&Hn.x<=Ae.x&&Yt.y>=Pe.y&&Hn.y<=Ae.y?[at]:Hn.x<Pe.x||Yt.x>Ae.x||Hn.y<Pe.y||Yt.y>Ae.y?[]:o.aJ([at],Pe.x,Pe.y,Ae.x,Ae.y)}for(let Yt of dt){ke.reset(Yt,.25*be);let Hn=0;Hn=ke.length<=.5*be?1:Math.ceil(ke.paddedLength/Ye)+1;for(let yi=0;yi<Hn;yi++){let ni=yi/Math.max(Hn-1,1),Di=ke.lerp(ni),ii=Di.x+qi,Zi=Di.y+qi;ie.push(ii,Zi,be,0);let Ii=ii-be,$r=Zi-be,hr=ii+be,rr=Zi+be;if(he=he&&this.isOffscreen(Ii,$r,hr,rr),ve=ve||this.isInsideGrid(Ii,$r,hr,rr),a!=="always"&&this.grid.hitTestCircle(ii,Zi,be,a,P)&&(pe=!0,!I))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!I&&pe||!ve||re<this.perspectiveRatioCutoff?[]:ie,offscreen:he,collisionDetected:pe}}projectPathToScreenSpace(a,u){let f=(function(g,w){let E=o.N();return o.aB(E,w.pitchedLabelPlaneMatrix),g.map(S=>{let I=un(S.x,S.y,E,w.getElevation),k=w.transform.projectTileCoordinates(I.point.x,I.point.y,w.unwrappedTileID,w.getElevation);return k.point.x=(.5*k.point.x+.5)*w.width,k.point.y=(.5*-k.point.y+.5)*w.height,k})})(a,u);return(function(g){let w=0,E=0,S=0,I=0;for(let k=0;k<g.length;k++)g[k].isOccluded?(S=k+1,I=0):(I++,I>E&&(E=I,w=S));return g.slice(w,w+E)})(f)}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let u=[],f=new o.aa;for(let B of a){let L=new o.P(B.x+qi,B.y+qi);f.extend(L),u.push(L)}let{minX:g,minY:w,maxX:E,maxY:S}=f,I=this.grid.query(g,w,E,S).concat(this.ignoredGrid.query(g,w,E,S)),k={},P={};for(let B of I){let L=B.key;if(k[L.bucketInstanceId]===void 0&&(k[L.bucketInstanceId]={}),k[L.bucketInstanceId][L.featureIndex])continue;let $=[new o.P(B.x1,B.y1),new o.P(B.x2,B.y1),new o.P(B.x2,B.y2),new o.P(B.x1,B.y2)];o.aK(u,$)&&(k[L.bucketInstanceId][L.featureIndex]=!0,P[L.bucketInstanceId]===void 0&&(P[L.bucketInstanceId]=[]),P[L.bucketInstanceId].push(L.featureIndex))}return P}insertCollisionBox(a,u,f,g,w,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:w,collisionGroupID:E,overlapMode:u},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,f,g,w,E){let S=f?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:w,collisionGroupID:E,overlapMode:u};for(let k=0;k<a.length;k+=4)S.insertCircle(I,a[k],a[k+1],a[k+2])}projectAndGetPerspectiveRatio(a,u,f,g,w){if(w){let E;g?(E=[a,u,g(a,u),1],o.aH(E,E,w)):(E=[a,u,0,1],Vp(E,E,w));let S=E[3];return{x:(E[0]/S+1)/2*this.transform.width+qi,y:(-E[1]/S+1)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{let E=this.transform.projectTileCoordinates(a,u,f,g);return{x:(E.point.x+1)/2*this.transform.width+qi,y:(1-E.point.y)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(a,u,f,g){let w=this.transform.projectTileCoordinates(a,u,f,g);return .5+this.transform.cameraToCenterDistance/w.signedDistanceFromCamera*.5}isOffscreen(a,u,f,g){return f<qi||a>=this.screenRightBoundary||g<qi||u>this.screenBottomBoundary}isInsideGrid(a,u,f,g){return f>=0&&a<this.gridRightBoundary&&g>=0&&u<this.gridBottomBoundary}getViewportMatrix(){let a=o.ar([]);return o.O(a,a,[-100,-100,0]),a}_projectCollisionBox(a,u,f,g,w,E,S,I,k,P,B){let L=1,$=0,Y=0,ie=1,oe=a.anchorPointX+S[0],re=a.anchorPointY+S[1];if(E&&!w){let at=this.projectAndGetPerspectiveRatio(oe+1,re,g,k,B),Ye=at.x-I.x,dt=Math.atan((at.y-I.y)/Ye)+(Ye<0?Math.PI:0),Yt=Math.sin(dt),Hn=Math.cos(dt);L=Hn,$=Yt,Y=-Yt,ie=Hn}else if(!E&&w){let at=tl(this.transform);L=at.vecEast[0],$=at.vecEast[1],Y=at.vecSouth[0],ie=at.vecSouth[1]}let ue=I.x,ge=I.y,ce=u;w&&(ue=oe,ge=re,ce=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),ce*=this.transform.getPitchedTextCorrection(oe,re,g),P||(ce*=o.an(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),P&&(ue+=L*P.x*ce+Y*P.y*ce,ge+=$*P.x*ce+ie*P.y*ce);let pe=a.x1*ce,ve=a.x2*ce,he=(pe+ve)/2,be=a.y1*ce,Pe=a.y2*ce,Ae=(be+Pe)/2,ke=[{offsetX:pe,offsetY:be},{offsetX:he,offsetY:be},{offsetX:ve,offsetY:be},{offsetX:ve,offsetY:Ae},{offsetX:ve,offsetY:Pe},{offsetX:he,offsetY:Pe},{offsetX:pe,offsetY:Pe},{offsetX:pe,offsetY:Ae}],Re=[];for(let{offsetX:at,offsetY:Ye}of ke)Re.push(new o.P(ue+L*at+Y*Ye,ge+$*at+ie*Ye));let ot=!1;if(w){let at=Re.map(Ye=>this.projectAndGetPerspectiveRatio(Ye.x,Ye.y,g,k,B));ot=at.some(Ye=>!Ye.isOccluded),Re=at.map(Ye=>new o.P(Ye.x,Ye.y))}else ot=!0;return{box:o.aL(Re),allPointsOccluded:!ot}}}class Qb{constructor(a,u,f,g){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class Mh{constructor(a,u,f,g,w){this.text=new Qb(a?a.text:null,u,f,w),this.icon=new Qb(a?a.icon:null,u,g,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Jb{constructor(a,u,f){this.text=a,this.icon=u,this.skipFade=f}}class ew{constructor(a,u,f,g,w){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=w}}class tw{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){let u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:f=>f.collisionGroupID===u}}return this.collisionGroups[a]}}function jp(v,a,u,f,g){let{horizontalAlign:w,verticalAlign:E}=o.aS(v);return new o.P(-(w-.5)*a+f[0]*g,-(E-.5)*u+f[1]*g)}class N_{constructor(a,u,f,g,w){this.transform=a.clone(),this.terrain=u,this.collisionIndex=new Xb(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new tw(g),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(a){let u=this.terrain;return u?(f,g)=>u.getElevation(a,f,g):null}getBucketParts(a,u,f,g){let w=f.getBucket(u),E=f.latestFeatureIndex;if(!w||!E||u.id!==w.layerIds[0])return;let S=f.collisionBoxArray,I=w.layers[0].layout,k=w.layers[0].paint,P=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),B=f.tileSize/o.a5,L=f.tileID.toUnwrapped(),$=I.get("text-rotation-alignment")==="map",Y=o.aN(f,1,this.transform.zoom),ie=o.aO(this.collisionIndex.transform,f,k.get("text-translate"),k.get("text-translate-anchor")),oe=o.aO(this.collisionIndex.transform,f,k.get("icon-translate"),k.get("icon-translate-anchor")),re=us($,this.transform,Y);this.retainedQueryData[w.bucketInstanceId]=new ew(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,f.tileID);let ue={bucket:w,layout:I,translationText:ie,translationIcon:oe,unwrappedTileID:L,pitchedLabelPlaneMatrix:re,scale:P,textPixelRatio:B,holdingForFade:f.holdingForSymbolFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.ay(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(g)for(let ge of w.sortKeyRanges){let{sortKey:ce,symbolInstanceStart:pe,symbolInstanceEnd:ve}=ge;a.push({sortKey:ce,symbolInstanceStart:pe,symbolInstanceEnd:ve,parameters:ue})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ue})}attemptAnchorPlacement(a,u,f,g,w,E,S,I,k,P,B,L,$,Y,ie,oe,re,ue,ge,ce){let pe=o.aP[a.textAnchor],ve=[a.textOffset0,a.textOffset1],he=jp(pe,f,g,ve,w),be=this.collisionIndex.placeCollisionBox(u,L,I,k,P,S,E,oe,B.predicate,ge,he,ce);if((!ue||this.collisionIndex.placeCollisionBox(ue,L,I,k,P,S,E,re,B.predicate,ge,he,ce).placeable)&&be.placeable){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:ve,width:f,height:g,anchor:pe,textBoxScale:w,prevAnchor:Pe},this.markUsedJustification(Y,pe,$,ie),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,ie,$),this.placedOrientations[$.crossTileID]=ie),{shift:he,placedGlyphBoxes:be}}}placeLayerBucketPart(a,u,f){let{bucket:g,layout:w,translationText:E,translationIcon:S,unwrappedTileID:I,pitchedLabelPlaneMatrix:k,textPixelRatio:P,holdingForFade:B,collisionBoxArray:L,partiallyEvaluatedTextSize:$,collisionGroup:Y}=a.parameters,ie=w.get("text-optional"),oe=w.get("icon-optional"),re=o.aQ(w,"text-overlap","text-allow-overlap"),ue=re==="always",ge=o.aQ(w,"icon-overlap","icon-allow-overlap"),ce=ge==="always",pe=w.get("text-rotation-alignment")==="map",ve=w.get("text-pitch-alignment")==="map",he=w.get("icon-text-fit")!=="none",be=w.get("symbol-z-order")==="viewport-y",Pe=ue&&(ce||!g.hasIconData()||oe),Ae=ce&&(ue||!g.hasTextData()||ie);!g.collisionArrays&&L&&g.deserializeCollisionBoxes(L);let ke=this.retainedQueryData[g.bucketInstanceId].tileID,Re=this._getTerrainElevationFunc(ke),ot=this.transform.getFastPathSimpleProjectionMatrix(ke),at=(Ye,dt,Yt)=>{var Hn,yi;if(u[Ye.crossTileID])return;if(B)return void(this.placements[Ye.crossTileID]=new Jb(!1,!1,!1));let ni=!1,Di=!1,ii=!0,Zi=null,Ii={box:null,placeable:!1,offscreen:null,occluded:!1},$r={placeable:!1},hr=null,rr=null,no=null,Wl=0,rl=0,Ta=0;dt.textFeatureIndex?Wl=dt.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(Wl=Ye.featureIndex),dt.verticalTextFeatureIndex&&(rl=dt.verticalTextFeatureIndex);let Ko=dt.textBox;if(Ko){let Os=fi=>{let ri=o.az.horizontal;if(g.allowVerticalPlacement&&!fi&&this.prevPlacement){let Nr=this.prevPlacement.placedOrientations[Ye.crossTileID];Nr&&(this.placedOrientations[Ye.crossTileID]=Nr,ri=Nr,this.markUsedOrientation(g,ri,Ye))}return ri},Sa=(fi,ri)=>{if(g.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&dt.verticalTextBox){for(let Nr of g.writingModes)if(Nr===o.az.vertical?(Ii=ri(),$r=Ii):Ii=fi(),Ii&&Ii.placeable)break}else Ii=fi()},Qs=Ye.textAnchorOffsetStartIndex,Js=Ye.textAnchorOffsetEndIndex;if(Js===Qs){let fi=(ri,Nr)=>{let Or=this.collisionIndex.placeCollisionBox(ri,re,P,ke,I,ve,pe,E,Y.predicate,Re,void 0,ot);return Or&&Or.placeable&&(this.markUsedOrientation(g,Nr,Ye),this.placedOrientations[Ye.crossTileID]=Nr),Or};Sa(()=>fi(Ko,o.az.horizontal),()=>{let ri=dt.verticalTextBox;return g.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&ri?fi(ri,o.az.vertical):{box:null,offscreen:null}}),Os(Ii&&Ii.placeable)}else{let fi=o.aP[(yi=(Hn=this.prevPlacement)===null||Hn===void 0?void 0:Hn.variableOffsets[Ye.crossTileID])===null||yi===void 0?void 0:yi.anchor],ri=(Or,Yw,Xw)=>{let Qc=Or.x2-Or.x1,BD=Or.y2-Or.y1,Qw=Ye.textBoxScale,Iy=he&&ge==="never"?Yw:null,Zl=null,Kl=re==="never"?1:2,Yl="never";fi&&Kl++;for(let My=0;My<Kl;My++){for(let Ay=Qs;Ay<Js;Ay++){let Em=g.textAnchorOffsets.get(Ay);if(fi&&Em.textAnchor!==fi)continue;let Cm=this.attemptAnchorPlacement(Em,Or,Qc,BD,Qw,pe,ve,P,ke,I,Y,Yl,Ye,g,Xw,E,S,Iy,Re);if(Cm&&(Zl=Cm.placedGlyphBoxes,Zl&&Zl.placeable))return ni=!0,Zi=Cm.shift,Zl}fi?fi=null:Yl=re}return f&&!Zl&&(Zl={box:this.collisionIndex.placeCollisionBox(Ko,"always",P,ke,I,ve,pe,E,Y.predicate,Re,void 0,ot).box,offscreen:!1,placeable:!1,occluded:!1}),Zl};Sa(()=>ri(Ko,dt.iconBox,o.az.horizontal),()=>{let Or=dt.verticalTextBox;return g.allowVerticalPlacement&&(!Ii||!Ii.placeable)&&Ye.numVerticalGlyphVertices>0&&Or?ri(Or,dt.verticalIconBox,o.az.vertical):{box:null,occluded:!0,offscreen:null}}),Ii&&(ni=Ii.placeable,ii=Ii.offscreen);let Nr=Os(Ii&&Ii.placeable);if(!ni&&this.prevPlacement){let Or=this.prevPlacement.variableOffsets[Ye.crossTileID];Or&&(this.variableOffsets[Ye.crossTileID]=Or,this.markUsedJustification(g,Or.anchor,Ye,Nr))}}}if(hr=Ii,ni=hr&&hr.placeable,ii=hr&&hr.offscreen,Ye.useRuntimeCollisionCircles&&Ye.centerJustifiedTextSymbolIndex>=0){let Os=g.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),Sa=o.aA(g.textSizeData,$,Os),Qs=w.get("text-padding");rr=this.collisionIndex.placeCollisionCircles(re,Os,g.lineVertexArray,g.glyphOffsetArray,Sa,I,k,f,ve,Y.predicate,Ye.collisionCircleDiameter,Qs,E,Re),rr.circles.length&&rr.collisionDetected&&!f&&o.w("Collisions detected, but collision boxes are not shown"),ni=ue||rr.circles.length>0&&!rr.collisionDetected,ii=ii&&rr.offscreen}if(dt.iconFeatureIndex&&(Ta=dt.iconFeatureIndex),dt.iconBox){let Os=Sa=>this.collisionIndex.placeCollisionBox(Sa,ge,P,ke,I,ve,pe,S,Y.predicate,Re,he&&Zi?Zi:void 0,ot);$r&&$r.placeable&&dt.verticalIconBox?(no=Os(dt.verticalIconBox),Di=no.placeable):(no=Os(dt.iconBox),Di=no.placeable),ii=ii&&no.offscreen}let Yc=ie||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,uf=oe||Ye.numIconVertices===0;Yc||uf?uf?Yc||(Di=Di&&ni):ni=Di&&ni:Di=ni=Di&&ni;let Xc=Di&&no.placeable;if(ni&&hr.placeable&&this.collisionIndex.insertCollisionBox(hr.box,re,w.get("text-ignore-placement"),g.bucketInstanceId,$r&&$r.placeable&&rl?rl:Wl,Y.ID),Xc&&this.collisionIndex.insertCollisionBox(no.box,ge,w.get("icon-ignore-placement"),g.bucketInstanceId,Ta,Y.ID),rr&&ni&&this.collisionIndex.insertCollisionCircles(rr.circles,re,w.get("text-ignore-placement"),g.bucketInstanceId,Wl,Y.ID),f&&this.storeCollisionData(g.bucketInstanceId,Yt,dt,hr,no,rr),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new Jb((ni||Pe)&&!hr?.occluded,(Di||Ae)&&!no?.occluded,ii||g.justReloaded),u[Ye.crossTileID]=!0};if(be){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Ye=g.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let dt=Ye.length-1;dt>=0;--dt){let Yt=Ye[dt];at(g.symbolInstances.get(Yt),g.collisionArrays[Yt],Yt)}}else for(let Ye=a.symbolInstanceStart;Ye<a.symbolInstanceEnd;Ye++)at(g.symbolInstances.get(Ye),g.collisionArrays[Ye],Ye);g.justReloaded=!1}storeCollisionData(a,u,f,g,w,E){if(f.textBox||f.iconBox){let S,I;this.collisionBoxArrays.has(a)?S=this.collisionBoxArrays.get(a):(S=new Map,this.collisionBoxArrays.set(a,S)),S.has(u)?I=S.get(u):(I={text:null,icon:null},S.set(u,I)),f.textBox&&(I.text=g.box),f.iconBox&&(I.icon=w.box)}if(E){let S=this.collisionCircleArrays[a];S===void 0&&(S=this.collisionCircleArrays[a]=[]);for(let I=0;I<E.circles.length;I+=4)S.push(E.circles[I+0]-qi),S.push(E.circles[I+1]-qi),S.push(E.circles[I+2]),S.push(E.collisionDetected?1:0)}}markUsedJustification(a,u,f,g){let w;w=g===o.az.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.aR(u)];let E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(let S of E)S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=w>=0&&S!==w?0:f.crossTileID)}markUsedOrientation(a,u,f){let g=u===o.az.horizontal||u===o.az.horizontalOnly?u:0,w=u===o.az.vertical?u:0,E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(let S of E)a.text.placedSymbolArray.get(S).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;let u=this.prevPlacement,f=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;let g=u?u.symbolFadeChange(a):1,w=u?u.opacities:{},E=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(let I in this.placements){let k=this.placements[I],P=w[I];P?(this.opacities[I]=new Mh(P,g,k.text,k.icon),f=f||k.text!==P.text.placed||k.icon!==P.icon.placed):(this.opacities[I]=new Mh(null,g,k.text,k.icon,k.skipFade),f=f||k.text||k.icon)}for(let I in w){let k=w[I];if(!this.opacities[I]){let P=new Mh(k,g,!1,!1);P.isHidden()||(this.opacities[I]=P,f=f||k.text.placed||k.icon.placed)}}for(let I in E)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=E[I]);for(let I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u){let f={};for(let g of u){let w=g.getBucket(a);w&&g.latestFeatureIndex&&a.id===w.layerIds[0]&&this.updateBucketOpacities(w,g.tileID,f,g.collisionBoxArray)}}updateBucketOpacities(a,u,f,g){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();let w=a.layers[0],E=w.layout,S=new Mh(null,0,!1,!1,!0),I=E.get("text-allow-overlap"),k=E.get("icon-allow-overlap"),P=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=E.get("text-rotation-alignment")==="map",L=E.get("text-pitch-alignment")==="map",$=E.get("icon-text-fit")!=="none",Y=new Mh(null,0,I&&(k||!a.hasIconData()||E.get("icon-optional")),k&&(I||!a.hasTextData()||E.get("text-optional")),!0);!a.collisionArrays&&g&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(g);let ie=(re,ue,ge)=>{for(let ce=0;ce<ue/4;ce++)re.opacityVertexArray.emplaceBack(ge);re.hasVisibleVertices=re.hasVisibleVertices||ge!==kh},oe=this.collisionBoxArrays.get(a.bucketInstanceId);for(let re=0;re<a.symbolInstances.length;re++){let ue=a.symbolInstances.get(re),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:ce,crossTileID:pe}=ue,ve=this.opacities[pe];f[pe]?ve=S:ve||(ve=Y,this.opacities[pe]=ve),f[pe]=!0;let he=ue.numIconVertices>0,be=this.placedOrientations[ue.crossTileID],Pe=be===o.az.vertical,Ae=be===o.az.horizontal||be===o.az.horizontalOnly;if(ge>0||ce>0){let Re=B_(ve.text);ie(a.text,ge,Pe?kh:Re),ie(a.text,ce,Ae?kh:Re);let ot=ve.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(dt=>{dt>=0&&(a.text.placedSymbolArray.get(dt).hidden=ot||Pe?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=ot||Ae?1:0);let at=this.variableOffsets[ue.crossTileID];at&&this.markUsedJustification(a,at.anchor,ue,be);let Ye=this.placedOrientations[ue.crossTileID];Ye&&(this.markUsedJustification(a,"left",ue,Ye),this.markUsedOrientation(a,Ye,ue))}if(he){let Re=B_(ve.icon),ot=!($&&ue.verticalPlacedIconSymbolIndex&&Pe);ue.placedIconSymbolIndex>=0&&(ie(a.icon,ue.numIconVertices,ot?Re:kh),a.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=ve.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(ie(a.icon,ue.numVerticalIconVertices,ot?kh:Re),a.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}let ke=oe&&oe.has(re)?oe.get(re):{text:null,icon:null};if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){let Re=a.collisionArrays[re];if(Re){let ot=new o.P(0,0);if(Re.textBox||Re.verticalTextBox){let at=!0;if(P){let Ye=this.variableOffsets[pe];Ye?(ot=jp(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale),B&&ot._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):at=!1}if(Re.textBox||Re.verticalTextBox){let Ye;Re.textBox&&(Ye=Pe),Re.verticalTextBox&&(Ye=Ae),O_(a.textCollisionBox.collisionVertexArray,ve.text.placed,!at||Ye,ke.text,ot.x,ot.y)}}if(Re.iconBox||Re.verticalIconBox){let at=!!(!Ae&&Re.verticalIconBox),Ye;Re.iconBox&&(Ye=at),Re.verticalIconBox&&(Ye=!at),O_(a.iconCollisionBox.collisionVertexArray,ve.icon.placed,Ye,ke.icon,$?ot.x:0,$?ot.y:0)}}}}if(a.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);a.bucketInstanceId in this.collisionCircleArrays&&(a.collisionCircleArray=this.collisionCircleArrays[a.bucketInstanceId],delete this.collisionCircleArrays[a.bucketInstanceId])}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){let f=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*f>a}setStale(){this.stale=!0}}function O_(v,a,u,f,g,w){f&&f.length!==0||(f=[0,0,0,0]);let E=f[0]-qi,S=f[1]-qi,I=f[2]-qi,k=f[3]-qi;v.emplaceBack(a?1:0,u?1:0,g||0,w||0,E,S),v.emplaceBack(a?1:0,u?1:0,g||0,w||0,I,S),v.emplaceBack(a?1:0,u?1:0,g||0,w||0,I,k),v.emplaceBack(a?1:0,u?1:0,g||0,w||0,E,k)}let F_=Math.pow(2,25),L_=Math.pow(2,24),fD=Math.pow(2,17),Ah=Math.pow(2,16),zp=Math.pow(2,9),nw=Math.pow(2,8),Wu=Math.pow(2,1);function B_(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;let a=v.placed?1:0,u=Math.floor(127*v.opacity);return u*F_+a*L_+u*fD+a*Ah+u*zp+a*nw+u*Wu+a}let kh=0;class Bl{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,u,f,g,w){let E=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(E,g,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,I)=>S.sortKey-I.sortKey));this._currentPartIndex<E.length;)if(u.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,w())return!0;return!1}}class Zu{constructor(a,u,f,g,w,E,S,I){this.placement=new N_(a,u,E,S,I),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(a,u,f){let g=J(),w=()=>!this._forceFullPlacement&&J()-g>2;for(;this._currentPlacementIndex>=0;){let E=u[a[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Bl(E)),this._inProgressLayer.continuePlacement(f[E.source],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}let _n=512/o.a5/2;class V_{constructor(a,u,f){this.tileID=a,this.bucketInstanceId=f,this._symbolsByKey={};let g=new Map;for(let w=0;w<u.length;w++){let E=u.get(w),S=E.key,I=g.get(S);I?I.push(E):g.set(S,[E])}for(let[w,E]of g){let S={positions:E.map(I=>({x:Math.floor(I.anchorX*_n),y:Math.floor(I.anchorY*_n)})),crossTileIDs:E.map(I=>I.crossTileID)};if(S.positions.length>128){let I=new o.aT(S.positions.length,16,Uint16Array);for(let{x:k,y:P}of S.positions)I.add(k,P);I.finish(),delete S.positions,S.index=I}this._symbolsByKey[w]=S}}getScaledCoordinates(a,u){let{x:f,y:g,z:w}=this.tileID.canonical,{x:E,y:S,z:I}=u.canonical,k=_n/Math.pow(2,I-w),P=(S*o.a5+a.anchorY)*k,B=g*o.a5*_n;return{x:Math.floor((E*o.a5+a.anchorX)*k-f*o.a5*_n),y:Math.floor(P-B)}}findMatches(a,u,f){let g=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let w=0;w<a.length;w++){let E=a.get(w);if(E.crossTileID)continue;let S=this._symbolsByKey[E.key];if(!S)continue;let I=this.getScaledCoordinates(E,u);if(S.index){let k=S.index.range(I.x-g,I.y-g,I.x+g,I.y+g).sort();for(let P of k){let B=S.crossTileIDs[P];if(!f[B]){f[B]=!0,E.crossTileID=B;break}}}else if(S.positions)for(let k=0;k<S.positions.length;k++){let P=S.positions[k],B=S.crossTileIDs[k];if(Math.abs(P.x-I.x)<=g&&Math.abs(P.y-I.y)<=g&&!f[B]){f[B]=!0,E.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:a})=>a)}}class pD{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class j_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){let u=Math.round((a-this.lng)/360);if(u!==0)for(let f in this.indexes){let g=this.indexes[f],w={};for(let E in g){let S=g[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),w[S.tileID.key]=S}this.indexes[f]=w}this.lng=a}addBucket(a,u,f){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let w=0;w<u.symbolInstances.length;w++)u.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});let g=this.usedCrossTileIDs[a.overscaledZ];for(let w in this.indexes){let E=this.indexes[w];if(Number(w)>a.overscaledZ)for(let S in E){let I=E[S];I.tileID.isChildOf(a)&&I.findMatches(u.symbolInstances,a,g)}else{let S=E[a.scaledTo(Number(w)).key];S&&S.findMatches(u.symbolInstances,a,g)}}for(let w=0;w<u.symbolInstances.length;w++){let E=u.symbolInstances.get(w);E.crossTileID||(E.crossTileID=f.generate(),g[E.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new V_(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(let f of u.getCrossTileIDsLists())for(let g of f)delete this.usedCrossTileIDs[a][g]}removeStaleBuckets(a){let u=!1;for(let f in this.indexes){let g=this.indexes[f];for(let w in g)a[g[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[w]),delete g[w],u=!0)}return u}}class Wo{constructor(){this.layerIndexes={},this.crossTileIDs=new pD,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,f){let g=this.layerIndexes[a.id];g===void 0&&(g=this.layerIndexes[a.id]=new j_);let w=!1,E={};g.handleWrapJump(f);for(let S of u){let I=S.getBucket(a);I&&a.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(S.tileID,I,this.crossTileIDs)&&(w=!0),E[I.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(a){let u={};a.forEach(f=>{u[f]=!0});for(let f in this.layerIndexes)u[f]||delete this.layerIndexes[f]}}var yo="void main() {fragColor=vec4(1.0);}";let Oi={prelude:$t(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:$t("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:$t("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:$t(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:$t(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$t(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$t(yo,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:$t(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:$t(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$t("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$t("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:$t("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:$t(yo,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:$t(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:$t(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:$t(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$t(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$t(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$t(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:$t(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:$t(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:$t(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:$t(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:$t(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:$t(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$t(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:$t("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:$t("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:$t("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:$t("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:$t(`#ifdef GL_ES
precision highp float;
#endif
in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:$t("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function $t(v,a){let u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=a.match(/in ([\w]+) ([\w]+)/g),g=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=w?w.concat(g):g,S={};return{fragmentSource:v=v.replace(u,(I,k,P,B,L)=>(S[L]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${P} ${B} ${L};
#else
uniform ${P} ${B} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${P} ${B} ${L} = u_${L};
#endif
`)),vertexSource:a=a.replace(u,(I,k,P,B,L)=>{let $=B==="float"?"vec2":"vec4",Y=L.match(/color/)?"color":$;return S[L]?k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${P} ${$} a_${L};
out ${P} ${B} ${L};
#else
uniform ${P} ${B} u_${L};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${P} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${Y}(a_${L}, u_${L}_t);
#else
    ${P} ${B} ${L} = u_${L};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${P} ${$} a_${L};
#else
uniform ${P} ${B} u_${L};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${P} ${B} ${L} = a_${L};
#else
    ${P} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${P} ${B} ${L} = unpack_mix_${Y}(a_${L}, u_${L}_t);
#else
    ${P} ${B} ${L} = u_${L};
#endif
`}),staticAttributes:f,staticUniforms:E}}class ei{constructor(a,u,f){this.vertexBuffer=a,this.indexBuffer=u,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Vl=o.aU([{name:"a_pos",type:"Int16",components:2}]);let Ro="#define PROJECTION_MERCATOR",ds="mercator";class Po{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ds}get shaderDefine(){return Ro}get shaderPreludeCode(){return Oi.projectionMercator}get vertexShaderPreludeCode(){return Oi.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aV.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(a){}getMeshFromTileID(a,u,f,g,w){if(this._cachedMesh)return this._cachedMesh;let E=new o.aW;E.emplaceBack(0,0),E.emplaceBack(o.a5,0),E.emplaceBack(0,o.a5),E.emplaceBack(o.a5,o.a5);let S=a.createVertexBuffer(E,Vl.members),I=o.aX.simpleSegment(0,0,4,2),k=new o.aY;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3);let P=a.createIndexBuffer(k);return this._cachedMesh=new ei(S,P,I),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(a){}}class Ku{constructor(a=0,u=0,f=0,g=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=f,this.right=g}interpolate(a,u,f){return u.top!=null&&a.top!=null&&(this.top=o.G.number(a.top,u.top,f)),u.bottom!=null&&a.bottom!=null&&(this.bottom=o.G.number(a.bottom,u.bottom,f)),u.left!=null&&a.left!=null&&(this.left=o.G.number(a.left,u.left,f)),u.right!=null&&a.right!=null&&(this.right=o.G.number(a.right,u.right,f)),this}getCenter(a,u){let f=o.an((this.left+a-this.right)/2,0,a),g=o.an((this.top+u-this.bottom)/2,0,u);return new o.P(f,g)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Ku(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function jl(v,a){if(!v.renderWorldCopies||v.lngRange)return;let u=a.lng-v.center.lng;a.lng+=u>180?-360:u<-180?360:0}function tr(v){return Math.max(0,Math.floor(v))}class Oc{constructor(a,u){var f;this.applyConstrain=(g,w)=>this._constrainOverride!==null?this._constrainOverride(g,w):this._callbacks.defaultConstrain(g,w),this._callbacks=a,this._tileSize=512,this._renderWorldCopies=u?.renderWorldCopies===void 0||!!u?.renderWorldCopies,this._minZoom=u?.minZoom||0,this._maxZoom=u?.maxZoom||22,this._minPitch=u?.minPitch==null?0:u?.minPitch,this._maxPitch=u?.maxPitch==null?60:u?.maxPitch,this._constrainOverride=(f=u?.constrainOverride)!==null&&f!==void 0?f:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=tr(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ku,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(a,u,f){this._constrainOverride=a.constrainOverride,this._latRange=a.latRange,this._lngRange=a.lngRange,this._width=a.width,this._height=a.height,this._center=a.center,this._elevation=a.elevation,this._minElevationForCurrentTile=a.minElevationForCurrentTile,this._zoom=a.zoom,this._tileZoom=tr(this._zoom),this._scale=o.aq(this._zoom),this._bearingInRadians=a.bearingInRadians,this._fovInRadians=a.fovInRadians,this._pitchInRadians=a.pitchInRadians,this._rollInRadians=a.rollInRadians,this._unmodified=a.unmodified,this._edgeInsets=new Ku(a.padding.top,a.padding.bottom,a.padding.left,a.padding.right),this._minZoom=a.minZoom,this._maxZoom=a.maxZoom,this._minPitch=a.minPitch,this._maxPitch=a.maxPitch,this._renderWorldCopies=a.renderWorldCopies,this._cameraToCenterDistance=a.cameraToCenterDistance,this._nearZ=a.nearZ,this._farZ=a.farZ,this._autoCalculateNearFarZ=!f&&a.autoCalculateNearFarZ,u&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(a){this._minElevationForCurrentTile=a}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(a){this._minZoom!==a&&(this._minZoom=a,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(a){this._minPitch!==a&&(this._minPitch=a,this.setPitch(Math.max(this.pitch,a)))}get maxPitch(){return this._maxPitch}setMaxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.setPitch(Math.min(this.pitch,a)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get constrainOverride(){return this._constrainOverride}setConstrainOverride(a){a===void 0&&(a=null),this._constrainOverride!==a&&(this._constrainOverride=a,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(a){let u=o.W(a,-180,180)*Math.PI/180;var f,g,w,E,S,I,k,P,B;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=m(),f=this._rotationMatrix,w=-this._bearingInRadians,E=(g=this._rotationMatrix)[0],S=g[1],I=g[2],k=g[3],P=Math.sin(w),B=Math.cos(w),f[0]=E*B+I*P,f[1]=S*B+k*P,f[2]=E*-P+I*B,f[3]=S*-P+k*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(a){let u=o.an(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(a){let u=a/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aZ(this._fovInRadians)}setFov(a){a=o.an(a,.1,150),this.fov!==a&&(this._unmodified=!1,this._fovInRadians=o.ap(a),this._calcMatrices())}get zoom(){return this._zoom}setZoom(a){let u=this.applyConstrain(this._center,a).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=o.aq(u),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(a){a!==this._elevation&&(this._elevation=a,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(a,u){this._autoCalculateNearFarZ=!1,this._nearZ=a,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,f){this._unmodified=!1,this._edgeInsets.interpolate(a,u,f),this.constrainInternal(),this._calcMatrices()}resize(a,u,f=!0){this._width=a,this._height=u,f&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ni([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(a){a?(this._lngRange=[a.getWest(),a.getEast()],this._latRange=[a.getSouth(),a.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.ao,o.ao])}getCameraQueryGeometry(a,u){if(u.length===1)return[u[0],a];{let{minX:f,minY:g,maxX:w,maxY:E}=o.aa.fromPoints(u).extend(a);return[new o.P(f,g),new o.P(w,g),new o.P(w,E),new o.P(f,E),new o.P(f,g)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let a=this._unmodified,{center:u,zoom:f}=this.applyConstrain(this.center,this.zoom);this.setCenter(u),this.setZoom(f),this._unmodified=a,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let a=o.ar(new Float64Array(16));o.Q(a,a,[this._width/2,-this._height/2,1]),o.O(a,a,[1,-1,0]),this._clipSpaceToPixelsMatrix=a,a=o.ar(new Float64Array(16)),o.Q(a,a,[1,-1,1]),o.O(a,a,[-1,-1,0]),o.Q(a,a,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=a,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(a,u,f,g){let w=f!==void 0?f:this.bearing,E=g=g!==void 0?g:this.pitch,{distanceToCenter:S,clampedElevation:I}=this._distanceToCenterFromAltElevationPitch(u,this.elevation,E),{x:k,y:P}=Zt(E,w),B=o.a9.fromLngLat(a,u),L,$,Y=o.a_(1,B.y),ie=0;do{if(ie+=1,ie>10)break;$=S/Y,L=new o.a9(B.x+k*$,B.y+P*$),Y=1/L.meterInMercatorCoordinateUnits()}while(Math.abs(S-$*Y)>1e-12);return{center:L.toLngLat(),elevation:I,zoom:o.at(this.height/2/Math.tan(this.fovInRadians/2)/$/this.tileSize)}}recalculateZoomAndCenter(a){if(this.elevation-a==0)return;let u=1/this.worldSize,f=o.as(1,this.center.lat)*this.worldSize,g=o.a9.fromLngLat(this.center,this.elevation),w=g.x/u,E=g.y/u,S=g.z/u,I=this.pitch,k=this.bearing,{x:P,y:B,z:L}=Zt(I,k),$=this.cameraToCenterDistance,Y=w+$*-P,ie=E+$*-B,oe=S+$*L,{distanceToCenter:re,clampedElevation:ue}=this._distanceToCenterFromAltElevationPitch(oe/f,a,I),ge=re*f,ce=new o.a9((Y+P*ge)*u,(ie+B*ge)*u,0).toLngLat(),pe=o.as(1,ce.lat),ve=o.at(this.height/2/Math.tan(this.fovInRadians/2)/re/pe/this.tileSize);this._elevation=ue,this._center=ce,this.setZoom(ve)}_distanceToCenterFromAltElevationPitch(a,u,f){let g=-Math.cos(o.ap(f)),w=a-u,E,S=u;return g*w>=0||Math.abs(g)<.1?(E=1e4,S=a+E*g):E=-w/g,{distanceToCenter:E,clampedElevation:S}}getCameraPoint(){let a=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(a*Math.sin(this.rollInRadians),a*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let a=o.as(1,this.center.lat)*this.worldSize;return we(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/a).toLngLat()}getMercatorTileCoordinates(a){if(!a)return[0,0,1,1];let u=a.canonical.z>=0?1<<a.canonical.z:Math.pow(2,a.canonical.z);return[a.canonical.x/u,a.canonical.y/u,1/u/o.a5,1/u/o.a5]}}class Ea{constructor(a,u){this.min=a,this.max=u,this.center=o.a$([],o.b0([],this.min,this.max),.5)}quadrant(a){let u=[a%2==0,a<2],f=o.b1(this.min),g=o.b1(this.max);for(let w=0;w<u.length;w++)f[w]=u[w]?this.min[w]:this.center[w],g[w]=u[w]?this.center[w]:this.max[w];return g[2]=this.max[2],new Ea(f,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersectsFrustum(a){let u=!0;for(let f=0;f<a.planes.length;f++){let g=this.intersectsPlane(a.planes[f]);if(g===0)return 0;g===1&&(u=!1)}return u?2:a.aabb.min[0]>this.max[0]||a.aabb.min[1]>this.max[1]||a.aabb.min[2]>this.max[2]||a.aabb.max[0]<this.min[0]||a.aabb.max[1]<this.min[1]||a.aabb.max[2]<this.min[2]?0:1}intersectsPlane(a){let u=a[3],f=a[3];for(let g=0;g<3;g++)a[g]>0?(u+=a[g]*this.min[g],f+=a[g]*this.max[g]):(f+=a[g]*this.min[g],u+=a[g]*this.max[g]);return u>=0?2:f<0?0:1}}class Up{distanceToTile2d(a,u,f,g){let w=g.distanceX([a,u]),E=g.distanceY([a,u]);return Math.hypot(w,E)}getWrap(a,u,f){return f}getTileBoundingVolume(a,u,f,g){var w,E;let S=0,I=0;if(g?.terrain){let P=new o.a2(a.z,u,a.z,a.x,a.y),B=g.terrain.getMinMaxElevation(P);S=(w=B.minElevation)!==null&&w!==void 0?w:Math.min(0,f),I=(E=B.maxElevation)!==null&&E!==void 0?E:Math.max(0,f)}let k=1<<a.z;return new Ea([u+a.x/k,a.y/k,S],[u+(a.x+1)/k,(a.y+1)/k,I])}allowVariableZoom(a,u){let f=a.fov*(Math.abs(Math.cos(a.rollInRadians))*a.height+Math.abs(Math.sin(a.rollInRadians))*a.width)/a.height,g=o.an(78.5-f/2,0,60);return!!u.terrain||a.pitch>g}allowWorldCopies(){return!0}prepareNextFrame(){}}class Zo{constructor(a,u,f){this.points=a,this.planes=u,this.aabb=f}static fromInvProjectionMatrix(a,u=1,f=0,g,w){let E=w?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,f),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>(function($,Y,ie,oe){let re=o.aH([],$,Y),ue=1/re[3]/ie*oe;return o.b6(re,re,[ue,ue,1/re[3],ue])})(L,a,u,S));g&&(function(L,$,Y,ie){let oe=ie?4:0,re=ie?0:4,ue=0,ge=[],ce=[];for(let he=0;he<4;he++){let be=o.b2([],L[he+re],L[he+oe]),Pe=o.b7(be);o.a$(be,be,1/Pe),ge.push(Pe),ce.push(be)}for(let he=0;he<4;he++){let be=o.b8(L[he+oe],ce[he],Y);ue=be!==null&&be>=0?Math.max(ue,be):Math.max(ue,ge[he])}let pe=(function(he,be){let Pe=o.b2([],he[be[0]],he[be[1]]),Ae=o.b2([],he[be[2]],he[be[1]]),ke=[0,0,0,0];return o.b3(ke,o.b4([],Pe,Ae)),ke[3]=-o.b5(ke,he[be[0]]),ke})(L,$),ve=(function(he,be){let Pe=o.b9(he),Ae=o.ba([],he,1/Pe),ke=o.b2([],be,o.a$([],Ae,o.b5(be,Ae))),Re=o.b9(ke);if(Re>0){let ot=Math.sqrt(1-Ae[3]*Ae[3]),at=o.a$([],Ae,-Ae[3]),Ye=o.b0([],at,o.a$([],ke,ot/Re));return o.bb(be,Ye)}return null})(Y,pe);if(ve!==null){let he=ve/o.b5(ce[0],pe);ue=Math.min(ue,he)}for(let he=0;he<4;he++){let be=Math.min(ue,ge[he]);L[he+re]=[L[he+oe][0]+ce[he][0]*be,L[he+oe][1]+ce[he][1]*be,L[he+oe][2]+ce[he][2]*be,1]}})(I,E[0],g,w);let k=E.map(L=>{let $=o.b2([],I[L[0]],I[L[1]]),Y=o.b2([],I[L[2]],I[L[1]]),ie=o.b3([],o.b4([],$,Y)),oe=-o.b5(ie,I[L[1]]);return ie.concat(oe)}),P=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let L of I)for(let $=0;$<3;$++)P[$]=Math.min(P[$],L[$]),B[$]=Math.max(B[$],L[$]);return new Zo(I,k,new Ea(P,B))}}class Fc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,u,f){return this._helper.interpolatePadding(a,u,f)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,u,f=!0){this._helper.resize(a,u,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}setConstrainOverride(a){this._helper.setConstrainOverride(a)}overrideNearFarZ(a,u){this._helper.overrideNearFarZ(a,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(a,u){}constructor(a){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(u,f)=>{f=o.an(+f,this.minZoom,this.maxZoom);let g={center:new o.V(u.lng,u.lat),zoom:f},w=this._helper._lngRange;if(!this._helper._renderWorldCopies&&w===null){let ce=179.9999999999;w=[-ce,ce]}let E=this.tileSize*o.aq(g.zoom),S=0,I=E,k=0,P=E,B=0,L=0,{x:$,y:Y}=this.size;if(this._helper._latRange){let ce=this._helper._latRange;S=o.X(ce[1])*E,I=o.X(ce[0])*E,I-S<Y&&(B=Y/(I-S))}w&&(k=o.W(o.Y(w[0])*E,0,E),P=o.W(o.Y(w[1])*E,0,E),P<k&&(P+=E),P-k<$&&(L=$/(P-k)));let{x:ie,y:oe}=Se(E,u),re,ue,ge=Math.max(L||0,B||0);if(ge){let ce=new o.P(L?(P+k)/2:ie,B?(I+S)/2:oe);return g.center=Xe(E,ce).wrap(),g.zoom+=o.at(ge),g}if(this._helper._latRange){let ce=Y/2;oe-ce<S&&(ue=S+ce),oe+ce>I&&(ue=I-ce)}if(w){let ce=(k+P)/2,pe=ie;this._helper._renderWorldCopies&&(pe=o.W(ie,ce-E/2,ce+E/2));let ve=$/2;pe-ve<k&&(re=k+ve),pe+ve>P&&(re=P-ve)}if(re!==void 0||ue!==void 0){let ce=new o.P(re??ie,ue??oe);g.center=Xe(E,ce).wrap()}return g},this.applyConstrain=(u,f)=>this._helper.applyConstrain(u,f),this._helper=new Oc({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,f)=>this.defaultConstrain(u,f)},a),this._coveringTilesDetailsProvider=new Up}clone(){let a=new Fc;return a.apply(this,!1),a}apply(a,u,f){this._helper.apply(a,u,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(a){let u=[new o.bc(0,a)];if(this._helper._renderWorldCopies){let f=this.screenPointToMercatorCoordinate(new o.P(0,0)),g=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),w=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),S=Math.floor(Math.min(f.x,g.x,w.x,E.x)),I=Math.floor(Math.max(f.x,g.x,w.x,E.x)),k=1;for(let P=S-k;P<=I+k;P++)P!==0&&u.push(new o.bc(P,a))}return u}getCameraFrustum(){return Zo.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(a){let u=this.screenPointToLocation(this.centerPoint,a),f=a?a.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(a,u){let f=o.as(this.elevation,this.center.lat),g=this.screenPointToMercatorCoordinateAtZ(u,f),w=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),E=o.a9.fromLngLat(a),S=new o.a9(E.x-(g.x-w.x),E.y-(g.y-w.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(a,u){return u?this.coordinatePoint(o.a9.fromLngLat(a),u.getElevationForLngLat(a,this),this._pixelMatrix3D):this.coordinatePoint(o.a9.fromLngLat(a))}screenPointToLocation(a,u){var f;return(f=this.screenPointToMercatorCoordinate(a,u))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(a,u){if(u){let f=u.pointCoordinate(a);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(a)}screenPointToMercatorCoordinateAtZ(a,u){let f=u||0,g=[a.x,a.y,0,1],w=[a.x,a.y,1,1];o.aH(g,g,this._pixelMatrixInverse),o.aH(w,w,this._pixelMatrixInverse);let E=g[3],S=w[3],I=g[1]/E,k=w[1]/S,P=g[2]/E,B=w[2]/S,L=P===B?0:(f-P)/(B-P);return new o.a9(o.G.number(g[0]/E,w[0]/S,L)/this.worldSize,o.G.number(I,k,L)/this.worldSize,f)}coordinatePoint(a,u=0,f=this._pixelMatrix){let g=[a.x*this.worldSize,a.y*this.worldSize,u,1];return o.aH(g,g,f),new o.P(g[0]/g[3],g[1]/g[3])}getBounds(){let a=Math.max(0,this._helper._height/2-$e(this));return new Ni().extend(this.screenPointToLocation(new o.P(0,a))).extend(this.screenPointToLocation(new o.P(this._helper._width,a))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(a,u){return u?u.pointCoordinate(a)!=null:a.y>this.height/2-$e(this)}calculatePosMatrix(a,u=!1,f){var g;let w=(g=a.key)!==null&&g!==void 0?g:o.bd(a.wrap,a.canonical.z,a.canonical.z,a.canonical.x,a.canonical.y),E=u?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(w)){let k=E.get(w);return f?k.f32:k.f64}let S=it(a,this.worldSize);o.S(S,u?this._alignedProjMatrix:this._viewProjMatrix,S);let I={f64:S,f32:new Float32Array(S)};return E.set(w,I),f?I.f32:I.f64}calculateFogMatrix(a){let u=a.key,f=this._fogMatrixCacheF32;if(f.has(u))return f.get(u);let g=it(a,this.worldSize);return o.S(g,this._fogMatrix,g),f.set(u,new Float32Array(g)),f.get(u)}calculateCenterFromCameraLngLatAlt(a,u,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(a,u,f,g)}_calculateNearFarZIfNeeded(a,u,f){if(!this._helper.autoCalculateNearFarZ)return;let g=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),w=a-g*this._helper._pixelPerMeter/Math.cos(u),E=g<0?w:a,S=Math.PI/2+this.pitchInRadians,I=o.ap(this.fov)*(Math.abs(Math.cos(o.ap(this.roll)))*this.height+Math.abs(Math.sin(o.ap(this.roll)))*this.width)/this.height*(.5+f.y/this.height),k=Math.sin(I)*E/Math.sin(o.an(Math.PI-S-I,.01,Math.PI-.01)),P=$e(this),B=Math.atan(P/this._helper.cameraToCenterDistance),L=o.ap(.75),$=B>L?2*B*(.5+f.y/(2*P)):L,Y=Math.sin($)*E/Math.sin(o.an(Math.PI-S-$,.01,Math.PI-.01)),ie=Math.min(k,Y);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*ie+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let a=this.centerOffset,u=Se(this.worldSize,this.center),f=u.x,g=u.y;this._helper._pixelPerMeter=o.as(1,this.center.lat)*this.worldSize;let w=o.ap(Math.min(this.pitch,Ce)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(w)),S;this._calculateNearFarZIfNeeded(E,w,a),S=new Float64Array(16),o.be(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aB(this._invProjMatrix,S),S[8]=2*-a.x/this._helper._width,S[9]=2*a.y/this._helper._height,this._projectionMatrix=o.bf(S),o.Q(S,S,[1,-1,1]),o.O(S,S,[0,0,-this._helper.cameraToCenterDistance]),o.bg(S,S,-this.rollInRadians),o.bh(S,S,this.pitchInRadians),o.bg(S,S,-this.bearingInRadians),o.O(S,S,[-f,-g,0]),this._mercatorMatrix=o.Q([],S,[this.worldSize,this.worldSize,this.worldSize]),o.Q(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),o.O(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=o.aB([],S);let I=[0,0,-1,1];o.aH(I,I,this._invViewProjMatrix),this._cameraPosition=[I[0]/I[3],I[1]/I[3],I[2]/I[3]],this._fogMatrix=new Float64Array(16),o.be(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-a.x/this.width,this._fogMatrix[9]=2*a.y/this.height,o.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.bg(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.bh(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.bg(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.O(this._fogMatrix,this._fogMatrix,[-f,-g,0]),o.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);let k=this._helper._width%2/2,P=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),$=f-Math.round(f)+B*k+L*P,Y=g-Math.round(g)+B*P+L*k,ie=new Float64Array(S);if(o.O(ie,ie,[$>.5?$-1:$,Y>.5?Y-1:Y,0]),this._alignedProjMatrix=ie,S=o.aB(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let a=this.screenPointToMercatorCoordinate(new o.P(0,0)),u=[a.x*this.worldSize,a.y*this.worldSize,0,1];return o.aH(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let a=o.as(1,this.center.lat)*this.worldSize;return we(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/a).toLngLat()}lngLatToCameraDepth(a,u){let f=o.a9.fromLngLat(a),g=[f.x*this.worldSize,f.y*this.worldSize,u,1];return o.aH(g,g,this._viewProjMatrix),g[2]/g[3]}getProjectionData(a){let{overscaledTileID:u,aligned:f,applyTerrainMatrix:g}=a,w=this._helper.getMercatorTileCoordinates(u),E=u?this.calculatePosMatrix(u,f,!0):null,S;return S=u&&u.terrainRttPosMatrix32f&&g?u.terrainRttPosMatrix32f:E||o.bi(),{mainMatrix:S,tileMercatorCoords:w,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(a){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(a,u,f){return 1}transformLightDirection(a){return o.b1(a)}getRayDirectionFromPixel(a){throw new Error("Not implemented.")}projectTileCoordinates(a,u,f,g){let w=this.calculatePosMatrix(f),E;g?(E=[a,u,g(a,u),1],o.aH(E,E,w)):(E=[a,u,0,1],Vp(E,E,w));let S=E[3];return{point:new o.P(E[0]/S,E[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(a){for(let u of a)this.calculatePosMatrix(u)}getMatrixForModel(a,u){let f=o.a9.fromLngLat(a,u),g=f.meterInMercatorCoordinateUnits(),w=o.bj();return o.O(w,w,[f.x,f.y,f.z]),o.bg(w,w,Math.PI),o.bh(w,w,Math.PI/2),o.Q(w,w,[-g,g,g]),w}getProjectionDataForCustomLayer(a=!0){let u=new o.a2(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:a}),g=it(u,this.worldSize);o.S(g,this._viewProjMatrix,g),f.tileMercatorCoords=[0,0,1,1];let w=[o.a5,o.a5,this.worldSize/this._helper.pixelsPerMeter],E=o.bk();return o.Q(E,g,w),f.fallbackMatrix=E,f.mainMatrix=E,f}getFastPathSimpleProjectionMatrix(a){return this.calculatePosMatrix(a)}}function nl(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function iw(v){if(v.useSlerp)if(v.k<1){let a=o.bl(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),u=o.bl(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),f=new Float64Array(4);o.bm(f,a,u,v.k);let g=o.bn(f);v.tr.setRoll(g.roll),v.tr.setPitch(g.pitch),v.tr.setBearing(g.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(o.G.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(o.G.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(o.G.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function z_(v,a,u,f,g){let w=g.padding,E=Se(g.worldSize,u.getNorthWest()),S=Se(g.worldSize,u.getNorthEast()),I=Se(g.worldSize,u.getSouthEast()),k=Se(g.worldSize,u.getSouthWest()),P=o.ap(-f),B=E.rotate(P),L=S.rotate(P),$=I.rotate(P),Y=k.rotate(P),ie=new o.P(Math.max(B.x,L.x,Y.x,$.x),Math.max(B.y,L.y,Y.y,$.y)),oe=new o.P(Math.min(B.x,L.x,Y.x,$.x),Math.min(B.y,L.y,Y.y,$.y)),re=ie.sub(oe),ue=(g.width-(w.left+w.right+a.left+a.right))/re.x,ge=(g.height-(w.top+w.bottom+a.top+a.bottom))/re.y;if(ge<0||ue<0)return void nl();let ce=Math.min(o.at(g.scale*Math.min(ue,ge)),v.maxZoom),pe=o.P.convert(v.offset),ve=new o.P((a.left-a.right)/2,(a.top-a.bottom)/2).rotate(o.ap(f)),he=pe.add(ve).mult(g.scale/o.aq(ce));return{center:Xe(g.worldSize,E.add(I).div(2).sub(he)),zoom:ce,bearing:f}}class Lc{get useGlobeControls(){return!1}handlePanInertia(a,u){let f=a.mag(),g=Math.abs($e(u));return{easingOffset:a.mult(Math.min(.75*g/f,1)),easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(a,u){a.bearingDelta&&u.setBearing(u.bearing+a.bearingDelta),a.pitchDelta&&u.setPitch(u.pitch+a.pitchDelta),a.rollDelta&&u.setRoll(u.roll+a.rollDelta),a.zoomDelta&&u.setZoom(u.zoom+a.zoomDelta)}handleMapControlsPan(a,u,f){a.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(f,a.around)}cameraForBoxAndBearing(a,u,f,g,w){return z_(a,u,f,g,w)}handleJumpToCenterZoom(a,u){a.zoom!==(u.zoom!==void 0?+u.zoom:a.zoom)&&a.setZoom(+u.zoom),u.center!==void 0&&a.setCenter(o.V.convert(u.center))}handleEaseTo(a,u){let f=a.zoom,g=a.padding,w={roll:a.roll,pitch:a.pitch,bearing:a.bearing},E={roll:u.roll===void 0?a.roll:u.roll,pitch:u.pitch===void 0?a.pitch:u.pitch,bearing:u.bearing===void 0?a.bearing:u.bearing},S=u.zoom!==void 0,I=!a.isPaddingEqual(u.padding),k=!1,P=S?+u.zoom:a.zoom,B=a.centerPoint.add(u.offsetAsPoint),L=a.screenPointToLocation(B),{center:$,zoom:Y}=a.applyConstrain(o.V.convert(u.center||L),P??f);jl(a,$);let ie=Se(a.worldSize,L),oe=Se(a.worldSize,$).sub(ie),re=o.aq(Y-f);return k=Y!==f,{easeFunc:ue=>{if(k&&a.setZoom(o.G.number(f,Y,ue)),o.bo(w,E)||iw({startEulerAngles:w,endEulerAngles:E,tr:a,k:ue,useSlerp:w.roll!=E.roll}),I&&(a.interpolatePadding(g,u.padding,ue),B=a.centerPoint.add(u.offsetAsPoint)),u.around)a.setLocationAtPoint(u.around,u.aroundPoint);else{let ge=o.aq(a.zoom-f),ce=Y>f?Math.min(2,re):Math.max(.5,re),pe=Math.pow(ce,1-ue),ve=Xe(a.worldSize,ie.add(oe.mult(ue*pe)).mult(ge));a.setLocationAtPoint(a.renderWorldCopies?ve.wrap():ve,B)}},isZooming:k,elevationCenter:$}}handleFlyTo(a,u){let f=u.zoom!==void 0,g=a.zoom,w=a.applyConstrain(o.V.convert(u.center||u.locationAtOffset),f?+u.zoom:g),E=w.center,S=w.zoom;jl(a,E);let I=Se(a.worldSize,u.locationAtOffset),k=Se(a.worldSize,E).sub(I),P=k.mag(),B=o.aq(S-g),L;if(u.minZoom!==void 0){let $=Math.min(+u.minZoom,g,S),Y=a.applyConstrain(E,$).zoom;L=o.aq(Y-g)}return{easeFunc:($,Y,ie,oe)=>{a.setZoom($===1?S:g+o.at(Y));let re=$===1?E:Xe(a.worldSize,I.add(k.mult(ie)).mult(Y));a.setLocationAtPoint(a.renderWorldCopies?re.wrap():re,oe)},scaleOfZoom:B,targetCenter:E,scaleOfMinZoom:L,pixelPathLength:P}}}class ti{constructor(a,u,f){this.blendFunction=a,this.blendColor=u,this.mask=f}}ti.Replace=[1,0],ti.disabled=new ti(ti.Replace,o.bp.transparent,[!1,!1,!1,!1]),ti.unblended=new ti(ti.Replace,o.bp.transparent,[!0,!0,!0,!0]),ti.alphaBlended=new ti([1,771],o.bp.transparent,[!0,!0,!0,!0]);let Yu=2305;class Mn{constructor(a,u,f){this.enable=a,this.mode=u,this.frontFace=f}}Mn.disabled=new Mn(!1,1029,Yu),Mn.backCCW=new Mn(!0,1029,Yu),Mn.frontCCW=new Mn(!0,1028,Yu);class dn{constructor(a,u,f){this.func=a,this.mask=u,this.range=f}}dn.ReadOnly=!1,dn.ReadWrite=!0,dn.disabled=new dn(519,dn.ReadOnly,[0,1]);let Xu=7680;class Rn{constructor(a,u,f,g,w,E){this.test=a,this.ref=u,this.mask=f,this.fail=g,this.depthFail=w,this.pass=E}}Rn.disabled=new Rn({func:519,mask:0},0,0,Xu,Xu,Xu);let Rh=new WeakMap;function ks(v){var a;if(Rh.has(v))return Rh.get(v);{let u=(a=v.getParameter(v.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return Rh.set(v,u),u}}class Qu{get awaitingQuery(){return!!this._readbackQueue}constructor(a){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=a;let u=a.context,f=u.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;let g=new o.aW;g.emplaceBack(-1,-1),g.emplaceBack(2,-1),g.emplaceBack(-1,2);let w=new o.aY;w.emplaceBack(0,1,2),this._fullscreenTriangle=new ei(u.createVertexBuffer(g,Vl.members),u.createIndexBuffer(w),o.aX.simpleSegment(0,0,g.length,w.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(f.TEXTURE1);let E=f.createTexture();f.bindTexture(f.TEXTURE_2D,E),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),ks(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){let a=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),a.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(a,u){let f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(a,u),this._updateCount++,this._measuredError}_bindFramebuffer(){let a=this._cachedRenderContext.context,u=a.gl;a.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),a.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(a,u){let f=this._cachedRenderContext.context,g=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:o.bp.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,g.TRIANGLES,dn.disabled,Rn.disabled,ti.unblended,Mn.disabled,((w,E)=>({u_input:w,u_output_expected:E}))(a,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ks(g)){g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.readBuffer(g.COLOR_ATTACHMENT0),g.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),g.bindBuffer(g.PIXEL_PACK_BUFFER,null);let w=g.fenceSync(g.SYNC_GPU_COMMANDS_COMPLETE,0);g.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:w}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let a=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ks(a)){let u=a.clientWaitSync(this._readbackQueue.sync,0,0);if(u===a.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===a.TIMEOUT_EXPIRED)return;a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),a.bindBuffer(a.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),a.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Qu._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(a){let u=0;return u+=a[0]/256,u+=a[1]/65536,u+=a[2]/16777216,a[3]<127&&(u=-u),u/128}}let zl=o.a5/128;function rw(v,a){let u=v.granularity!==void 0?Math.max(v.granularity,1):1,f=u+(v.generateBorders?2:0),g=u+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),w=f+1,E=g+1,S=v.generateBorders?-1:0,I=v.generateBorders||v.extendToNorthPole?-1:0,k=u+(v.generateBorders?1:0),P=u+(v.generateBorders||v.extendToSouthPole?1:0),B=w*E,L=f*g*6,$=w*E>65536;if($&&a==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let Y=$||a==="32bit",ie=new Int16Array(2*B),oe=0;for(let ge=I;ge<=P;ge++)for(let ce=S;ce<=k;ce++){let pe=ce/u*o.a5;ce===-1&&(pe=-zl),ce===u+1&&(pe=o.a5+zl);let ve=ge/u*o.a5;ge===-1&&(ve=v.extendToNorthPole?o.br:-zl),ge===u+1&&(ve=v.extendToSouthPole?o.bs:o.a5+zl),ie[oe++]=pe,ie[oe++]=ve}let re=Y?new Uint32Array(L):new Uint16Array(L),ue=0;for(let ge=0;ge<g;ge++)for(let ce=0;ce<f;ce++){let pe=ce+1+ge*w,ve=ce+(ge+1)*w,he=ce+1+(ge+1)*w;re[ue++]=ce+ge*w,re[ue++]=ve,re[ue++]=pe,re[ue++]=pe,re[ue++]=ve,re[ue++]=he}return{vertices:ie.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Y}}let Ph=new o.aV({fill:new o.bt(128,2),line:new o.bt(512,0),tile:new o.bt(128,32),stencil:new o.bt(128,1),circle:3});class U_{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Oi.projectionGlobe}get vertexShaderPreludeCode(){return Oi.projectionMercator.vertexSource}get subdivisionGranularity(){return Ph}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(a){this._errorMeasurement||(this._errorMeasurement=new Qu(a));let u=o.X(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,g=this._errorMeasurement.updateErrorLoop(u,f),w=J();g!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=g,this._errorMeasurementLastChangeTime=w);let E=Math.min(Math.max((w-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bu(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bv(E))}_getMeshKey(a){return`${a.granularity.toString(36)}_${a.generateBorders?"b":""}${a.extendToNorthPole?"n":""}${a.extendToSouthPole?"s":""}`}getMeshFromTileID(a,u,f,g,w){let E=(w==="stencil"?Ph.stencil:Ph.tile).getGranularityForZoomLevel(u.z);return this._getMesh(a,{granularity:E,generateBorders:f,extendToNorthPole:u.y===0&&g,extendToSouthPole:u.y===(1<<u.z)-1&&g})}_getMesh(a,u){let f=this._getMeshKey(u);if(f in this._tileMeshCache)return this._tileMeshCache[f];let g=(function(w,E){let S=rw(E,"16bit"),I=o.aW.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),k=o.aY.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new ei(w.createVertexBuffer(I,Vl.members),w.createIndexBuffer(k),o.aX.simpleSegment(0,0,I.length,k.length))})(a,u);return this._tileMeshCache[f]=g,g}recalculate(a){}hasTransition(){let a=J(),u=!1;return u=u||(a-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(a){this._errorQueryLatitudeDegrees=a}}let mD=new o.t({type:new o.D(o.u.projection.type)});class ow extends o.E{constructor(a){super(),this._transitionable=new o.x(mD,void 0),this.setProjection(a),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.H(0)),this._mercatorProjection=new Po,this._verticalPerspectiveProjection=new U_}get transitionState(){let a=this.properties.get("type");if(typeof a=="string"&&a==="mercator")return 0;if(typeof a=="string"&&a==="vertical-perspective")return 1;if(a instanceof o.bw){if(a.from==="vertical-perspective"&&a.to==="mercator")return 1-a.transition;if(a.from==="mercator"&&a.to==="vertical-perspective")return a.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(a){this._mercatorProjection.updateGPUdependent(a),this._verticalPerspectiveProjection.updateGPUdependent(a)}getMeshFromTileID(a,u,f,g,w){return this.currentProjection.getMeshFromTileID(a,u,f,g,w)}setProjection(a){this._transitionable.setValue("type",a?.type||"mercator")}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}setErrorQueryLatitudeDegrees(a){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(a),this._mercatorProjection.setErrorQueryLatitudeDegrees(a)}}function No(v){let a=Bc(v.worldSize,v.center.lat);return 2*Math.PI*a}function Ca(v,a,u,f,g){let w=1/(1<<g),E=a/o.a5*w+f*w,S=o.bz((v/o.a5*w+u*w)*Math.PI*2+Math.PI,2*Math.PI),I=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,k=Math.cos(I),P=new Float64Array(3);return P[0]=Math.sin(S)*k,P[1]=Math.sin(I),P[2]=Math.cos(S)*k,P}function Si(v){return(function(a,u){let f=Math.cos(u),g=new Float64Array(3);return g[0]=Math.sin(a)*f,g[1]=Math.sin(u),g[2]=Math.cos(a)*f,g})(v.lng*Math.PI/180,v.lat*Math.PI/180)}function Bc(v,a){return v/(2*Math.PI)/Math.cos(a*Math.PI/180)}function $_(v){let a=Math.asin(v[1])/Math.PI*180,u=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(u>1e-6){let f=v[0]/u,g=Math.acos(v[2]/u),w=(f>0?g:-g)/Math.PI*180;return new o.V(o.W(w,-180,180),a)}return new o.V(0,a)}function Nh(v){return Math.cos(v*Math.PI/180)}function Wi(v,a){let u=Nh(v),f=Nh(a);return o.at(f/u)}function sw(v,a){let u=v.rotate(a.bearingInRadians),f=a.zoom+Wi(a.center.lat,0),g=o.bu(1/Nh(a.center.lat),1/Nh(Math.min(Math.abs(a.center.lat),60)),o.bx(f,7,3,0,1)),w=360/No({worldSize:a.worldSize,center:{lat:a.center.lat}});return new o.V(a.center.lng-u.x*w*g,o.an(a.center.lat+u.y*w,-o.ao,o.ao))}function H_(v){let a=.5*v,u=Math.sin(a),f=Math.cos(a);return Math.log(u+f)-Math.log(f-u)}function aw(v,a,u,f){let g=v.lat+u*f;if(Math.abs(u)>1){let w=(Math.sign(v.lat+u)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,E=Math.abs(v.lat+u)*Math.PI/180,S=H_(w+f*(E-w)),I=H_(w),k=H_(E);return new o.V(v.lng+a*((S-I)/(k-I)),g)}return new o.V(v.lng+a*f,g)}class gD{constructor(a){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=a}swapBuffers(){if(!this._hadAnyChanges)return;let a=this._cachePrevious;this._cachePrevious=this._cache,this._cache=a,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(a,u,f,g){let w=`${a.z}_${a.x}_${a.y}_${g?.terrain?"t":""}`,E=this._cache.get(w);if(E)return E;let S=this._cachePrevious.get(w);if(S)return this._cache.set(w,S),S;let I=this._boundingVolumeFactory(a,u,f,g);return this._cache.set(w,I),this._hadAnyChanges=!0,I}}class Ju{constructor(a,u,f,g){this.min=f,this.max=g,this.points=a,this.planes=u}static fromAabb(a,u){let f=[];for(let g=0;g<8;g++)f.push([1&~g?a[0]:u[0],(g>>1&1)==1?u[1]:a[1],(g>>2&1)==1?u[2]:a[2]]);return new Ju(f,[[-1,0,0,u[0]],[1,0,0,-a[0]],[0,-1,0,u[1]],[0,1,0,-a[1]],[0,0,-1,u[2]],[0,0,1,-a[2]]],a,u)}static fromCenterSizeAngles(a,u,f){let g=o.bB([],f[0],f[1],f[2]),w=o.bC([],[u[0],0,0],g),E=o.bC([],[0,u[1],0],g),S=o.bC([],[0,0,u[2]],g),I=[...a],k=[...a];for(let B=0;B<8;B++)for(let L=0;L<3;L++){let $=a[L]+w[L]*(1&~B?-1:1)+E[L]*((B>>1&1)==1?1:-1)+S[L]*((B>>2&1)==1?1:-1);I[L]=Math.min(I[L],$),k[L]=Math.max(k[L],$)}let P=[];for(let B=0;B<8;B++){let L=[...a];o.b0(L,L,o.a$([],w,1&~B?-1:1)),o.b0(L,L,o.a$([],E,(B>>1&1)==1?1:-1)),o.b0(L,L,o.a$([],S,(B>>2&1)==1?1:-1)),P.push(L)}return new Ju(P,[[...w,-o.b5(w,P[0])],[...E,-o.b5(E,P[0])],[...S,-o.b5(S,P[0])],[-w[0],-w[1],-w[2],-o.b5(w,P[7])],[-E[0],-E[1],-E[2],-o.b5(E,P[7])],[-S[0],-S[1],-S[2],-o.b5(S,P[7])]],I,k)}intersectsFrustum(a){let u=!0,f=this.points.length,g=this.planes.length,w=a.planes.length,E=a.points.length;for(let S=0;S<w;S++){let I=a.planes[S],k=0;for(let P=0;P<f;P++){let B=this.points[P];I[0]*B[0]+I[1]*B[1]+I[2]*B[2]+I[3]>=0&&k++}if(k===0)return 0;k<f&&(u=!1)}if(u)return 2;for(let S=0;S<g;S++){let I=this.planes[S],k=0;for(let P=0;P<E;P++){let B=a.points[P];I[0]*B[0]+I[1]*B[1]+I[2]*B[2]+I[3]>=0&&k++}if(k===0)return 0}return 1}intersectsPlane(a){let u=this.points.length,f=0;for(let g=0;g<u;g++){let w=this.points[g];a[0]*w[0]+a[1]*w[1]+a[2]*w[2]+a[3]>=0&&f++}return f===u?2:f===0?0:1}}function $p(v,a,u){let f=v-a;return f<0?-f:Math.max(0,f-u)}function ed(v,a,u,f,g){let w=v-u,E;return E=w<0?Math.min(-w,1+w-g):w>1?Math.min(Math.max(w-g,0),1-w):0,Math.max(E,$p(a,f,g))}class G_{constructor(){this._boundingVolumeCache=new gD(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(a,u,f,g){let w=1<<f.z,E=1/w,S=f.x/w,I=f.y/w,k=2;return k=Math.min(k,ed(a,u,S,I,E)),k=Math.min(k,ed(a,u,S+.5,-I-E,E)),k=Math.min(k,ed(a,u,S+.5,2-I-E,E)),k}getWrap(a,u,f){let g=1<<u.z,w=1/g,E=u.x/g,S=$p(a.x,E,w),I=$p(a.x,E-1,w),k=$p(a.x,E+1,w),P=Math.min(S,I,k);return P===k?1:P===I?-1:0}allowVariableZoom(a,u){return Hi(a,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(a,u,f,g){return this._boundingVolumeCache.getTileBoundingVolume(a,u,f,g)}_computeTileBoundingVolume(a,u,f,g){var w,E;let S=0,I=0;if(g?.terrain){let k=new o.a2(a.z,u,a.z,a.x,a.y),P=g.terrain.getMinMaxElevation(k);S=(w=P.minElevation)!==null&&w!==void 0?w:Math.min(0,f),I=(E=P.maxElevation)!==null&&E!==void 0?E:Math.max(0,f)}if(S/=o.bE,I/=o.bE,S+=1,I+=1,a.z<=0)return Ju.fromAabb([-I,-I,-I],[I,I,I]);if(a.z===1)return Ju.fromAabb([a.x===0?-I:0,a.y===0?0:-I,-I],[a.x===0?0:I,a.y===0?I:0,I]);{let k=[Ca(0,0,a.x,a.y,a.z),Ca(o.a5,0,a.x,a.y,a.z),Ca(o.a5,o.a5,a.x,a.y,a.z),Ca(0,o.a5,a.x,a.y,a.z)],P=[];for(let ke of k)P.push(o.a$([],ke,I));if(I!==S)for(let ke of k)P.push(o.a$([],ke,S));a.y===0&&P.push([0,1,0]),a.y===(1<<a.z)-1&&P.push([0,-1,0]);let B=[1,1,1],L=[-1,-1,-1];for(let ke of P)for(let Re=0;Re<3;Re++)B[Re]=Math.min(B[Re],ke[Re]),L[Re]=Math.max(L[Re],ke[Re]);let $=Ca(o.a5/2,o.a5/2,a.x,a.y,a.z),Y=o.b4([],[0,1,0],$);o.b3(Y,Y);let ie=o.b4([],$,Y);o.b3(ie,ie);let oe=o.b4([],k[2],k[1]);o.b3(oe,oe);let re=o.b4([],k[0],k[3]);o.b3(re,re),P.push(o.a$([],$,I)),a.y>=(1<<a.z)/2&&P.push(o.a$([],Ca(o.a5/2,0,a.x,a.y,a.z),I)),a.y<(1<<a.z)/2&&P.push(o.a$([],Ca(o.a5/2,o.a5,a.x,a.y,a.z),I));let ue=Oh($,P),ge=Oh(ie,P),ce=[-$[0],-$[1],-$[2],ue.max],pe=[$[0],$[1],$[2],-ue.min],ve=[-ie[0],-ie[1],-ie[2],ge.max],he=[ie[0],ie[1],ie[2],-ge.min],be=[...oe,0],Pe=[...re,0],Ae=[];return a.y===0?Ae.push(o.bD(Pe,be,ce),o.bD(Pe,be,pe)):Ae.push(o.bD(ve,be,ce),o.bD(ve,be,pe),o.bD(ve,Pe,ce),o.bD(ve,Pe,pe)),a.y===(1<<a.z)-1?Ae.push(o.bD(Pe,be,ce),o.bD(Pe,be,pe)):Ae.push(o.bD(he,be,ce),o.bD(he,be,pe),o.bD(he,Pe,ce),o.bD(he,Pe,pe)),new Ju(Ae,[ce,pe,ve,he,be,Pe],B,L)}}}function Oh(v,a){let u=1/0,f=-1/0;for(let g of a){let w=o.b5(v,g);u=Math.min(u,w),f=Math.max(f,w)}return{min:u,max:f}}class td{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,u,f){return this._helper.interpolatePadding(a,u,f)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,u){this._helper.resize(a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}setConstrainOverride(a){this._helper.setConstrainOverride(a)}overrideNearFarZ(a,u){this._helper.overrideNearFarZ(a,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(a){}constructor(a){this._cachedClippingPlane=o.bF(),this._projectionMatrix=o.bj(),this._globeViewProjMatrix32f=o.bi(),this._globeViewProjMatrixNoCorrection=o.bj(),this._globeViewProjMatrixNoCorrectionInverted=o.bj(),this._globeProjMatrixInverted=o.bj(),this._cameraPosition=o.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(u,f)=>{let g=o.an(u.lat,-o.ao,o.ao),w=o.an(+f,this.minZoom+Wi(0,g),this.maxZoom);return{center:new o.V(u.lng,g),zoom:w}},this.applyConstrain=(u,f)=>this._helper.applyConstrain(u,f),this._helper=new Oc({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,f)=>this.defaultConstrain(u,f)},a),this._coveringTilesDetailsProvider=new G_}clone(){let a=new td;return a.apply(this,!1),a}apply(a,u,f){this._globeLatitudeErrorCorrectionRadians=f||0,this._helper.apply(a,u)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let a=o.bA();return a[0]=this._cameraPosition[0],a[1]=this._cameraPosition[1],a[2]=this._cameraPosition[2],a}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(a){let{overscaledTileID:u,applyGlobeMatrix:f}=a,g=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:g,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(a){let u=this.pitchInRadians,f=this.cameraToCenterDistance/a,g=Math.sin(u)*f,w=Math.cos(u)*f+1,E=1/Math.sqrt(g*g+w*w)*1,S=-g,I=w,k=Math.sqrt(S*S+I*I);S/=k,I/=k;let P=[0,S,I];o.bG(P,P,[0,0,0],-this.bearingInRadians),o.bH(P,P,[0,0,0],-1*this.center.lat*Math.PI/180),o.bI(P,P,[0,0,0],this.center.lng*Math.PI/180);let B=1/o.b7(P);return o.a$(P,P,B),[...P,-E*B]}isLocationOccluded(a){return!this.isSurfacePointVisible(Si(a))}transformLightDirection(a){let u=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,g=Math.cos(f),w=[Math.sin(u)*g,Math.sin(f),Math.cos(u)*g],E=[w[2],0,-w[0]],S=[0,0,0];o.b4(S,E,w),o.b3(E,E),o.b3(S,S);let I=[0,0,0];return o.b3(I,[E[0]*a[0]+S[0]*a[1]+w[0]*a[2],E[1]*a[0]+S[1]*a[1]+w[1]*a[2],E[2]*a[0]+S[2]*a[1]+w[2]*a[2]]),I}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(a,u,f){let g=(function(S,I,k){let P=1/(1<<k.z);return new o.a9(S/o.a5*P+k.x*P,I/o.a5*P+k.y*P)})(a,u,f.canonical),w=(E=g.y,[o.bz(g.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(w[1])}projectTileCoordinates(a,u,f,g){let w=f.canonical,E=Ca(a,u,w.x,w.y,w.z),S=1+(g?g(a,u):0)/o.bE,I=[E[0]*S,E[1]*S,E[2]*S,1];o.aH(I,I,this._globeViewProjMatrixNoCorrection);let k=this._cachedClippingPlane,P=k[0]*E[0]+k[1]*E[1]+k[2]*E[2]+k[3]<0;return{point:new o.P(I[0]/I[3],I[1]/I[3]),signedDistanceFromCamera:I[3],isOccluded:P}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let a=Bc(this.worldSize,this.center.lat),u=o.bk(),f=o.bk();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*a),o.be(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let g=this.centerOffset;u[8]=2*-g.x/this._helper._width,u[9]=2*g.y/this._helper._height,this._projectionMatrix=o.bf(u),this._globeProjMatrixInverted=o.bk(),o.aB(this._globeProjMatrixInverted,u),o.O(u,u,[0,0,-this.cameraToCenterDistance]),o.bg(u,u,this.rollInRadians),o.bh(u,u,-this.pitchInRadians),o.bg(u,u,this.bearingInRadians),o.O(u,u,[0,0,-a]);let w=o.bA();w[0]=a,w[1]=a,w[2]=a,o.bh(f,u,this.center.lat*Math.PI/180),o.bJ(f,f,-this.center.lng*Math.PI/180),o.Q(f,f,w),this._globeViewProjMatrixNoCorrection=f,o.bh(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bJ(u,u,-this.center.lng*Math.PI/180),o.Q(u,u,w),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=o.bk(),o.aB(this._globeViewProjMatrixNoCorrectionInverted,f);let E=o.bA();this._cameraPosition=o.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/a,o.bG(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),o.bH(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),o.bG(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),o.b0(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bH(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),o.bI(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(a);let S=o.bf(this._globeViewProjMatrixNoCorrectionInverted);o.Q(S,S,[1,1,-1]),this._cachedFrustum=Zo.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(a){o.w("calculateFogMatrix is not supported on globe projection.");let u=o.bk();return o.ar(u),u}getVisibleUnwrappedCoordinates(a){return[new o.bc(0,a)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(a){a&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(a,u){if(!this._globeViewProjMatrixNoCorrection)return 1;let f=Si(a);o.a$(f,f,1+u/o.bE);let g=o.bF();return o.aH(g,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),g[2]/g[3]}populateCache(a){}getBounds(){let a=.5*this.width,u=.5*this.height,f=[new o.P(0,0),new o.P(a,0),new o.P(this.width,0),new o.P(this.width,u),new o.P(this.width,this.height),new o.P(a,this.height),new o.P(0,this.height),new o.P(0,u)],g=[];for(let B of f)g.push(this.unprojectScreenPoint(B));let w=0,E=0,S=0,I=0,k=this.center;for(let B of g){let L=o.bK(k.lng,B.lng),$=o.bK(k.lat,B.lat);L<E&&(E=L),L>w&&(w=L),$<I&&(I=$),$>S&&(S=$)}let P=[k.lng+E,k.lat+I,k.lng+w,k.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(P[3]=90,P[0]=-180,P[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(P[1]=-90,P[0]=-180,P[2]=180),new Ni(P)}calculateCenterFromCameraLngLatAlt(a,u,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(a,u,f,g)}setLocationAtPoint(a,u){let f=Si(this.unprojectScreenPoint(u)),g=Si(a),w=o.bA();o.bL(w);let E=o.bA();o.bI(E,f,w,-this.center.lng*Math.PI/180),o.bH(E,E,w,this.center.lat*Math.PI/180);let S=g[0]*g[0]+g[2]*g[2],I=E[0]*E[0];if(S<I)return;let k=Math.sqrt(S-I),P=-k,B=o.bM(g[0],g[2],E[0],k),L=o.bM(g[0],g[2],E[0],P),$=o.bA();o.bI($,g,w,-B);let Y=o.bM($[1],$[2],E[1],E[2]),ie=o.bA();o.bI(ie,g,w,-L);let oe=o.bM(ie[1],ie[2],E[1],E[2]),re=.5*Math.PI,ue=Y>=-re&&Y<=re,ge=oe>=-re&&oe<=re,ce,pe;if(ue&&ge){let Pe=this.center.lng*Math.PI/180,Ae=this.center.lat*Math.PI/180;o.bN(B,Pe)+o.bN(Y,Ae)<o.bN(L,Pe)+o.bN(oe,Ae)?(ce=B,pe=Y):(ce=L,pe=oe)}else if(ue)ce=B,pe=Y;else{if(!ge)return;ce=L,pe=oe}let ve=ce/Math.PI*180,he=pe/Math.PI*180,be=this.center.lat;this.setCenter(new o.V(ve,o.an(he,-90,90))),this.setZoom(this.zoom+Wi(be,this.center.lat))}locationToScreenPoint(a,u){let f=Si(a);if(u){let g=u.getElevationForLngLatZoom(a,this._helper._tileZoom);o.a$(f,f,1+g/o.bE)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(a){let u=o.bF();return o.aH(u,[...a,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new o.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(a,u){if(u){let f=u.pointCoordinate(a);if(f)return f}return o.a9.fromLngLat(this.unprojectScreenPoint(a))}screenPointToLocation(a,u){var f;return(f=this.screenPointToMercatorCoordinate(a,u))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(a,u){let f=this._cameraPosition,g=this.getRayDirectionFromPixel(a);return!!this.rayPlanetIntersection(f,g)}getRayDirectionFromPixel(a){let u=o.bF();u[0]=a.x/this.width*2-1,u[1]=-1*(a.y/this.height*2-1),u[2]=1,u[3]=1,o.aH(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];let f=o.bA();f[0]=u[0]-this._cameraPosition[0],f[1]=u[1]-this._cameraPosition[1],f[2]=u[2]-this._cameraPosition[2];let g=o.bA();return o.b3(g,f),g}isSurfacePointVisible(a){let u=this._cachedClippingPlane;return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]+u[3]>=0}isSurfacePointOnScreen(a){if(!this.isSurfacePointVisible(a))return!1;let u=o.bF();return o.aH(u,[...a,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(a,u){let f=o.b5(a,u),g=o.bA(),w=o.bA();o.a$(w,u,f),o.b2(g,a,w);let E=1-o.b5(g,g);if(E<0)return null;let S=o.b5(a,a)-1,I=-f+(f<0?1:-1)*Math.sqrt(E),k=S/I,P=I;return{tMin:Math.min(k,P),tMax:Math.max(k,P)}}unprojectScreenPoint(a){let u=this._cameraPosition,f=this.getRayDirectionFromPixel(a),g=this.rayPlanetIntersection(u,f);if(g){let P=o.bA();o.b0(P,u,[f[0]*g.tMin,f[1]*g.tMin,f[2]*g.tMin]);let B=o.bA();return o.b3(B,P),$_(B)}let w=this._cachedClippingPlane,E=w[0]*f[0]+w[1]*f[1]+w[2]*f[2],S=-o.bb(w,u)/E,I=o.bA();if(S>0)o.b0(I,u,[f[0]*S,f[1]*S,f[2]*S]);else{let P=o.bA();o.b0(P,u,[2*f[0],2*f[1],2*f[2]]);let B=o.bb(this._cachedClippingPlane,P);o.b2(I,P,[this._cachedClippingPlane[0]*B,this._cachedClippingPlane[1]*B,this._cachedClippingPlane[2]*B])}let k=(function(P){let B=o.bA();return B[0]=P[0]*-P[3],B[1]=P[1]*-P[3],B[2]=P[2]*-P[3],{center:B,radius:Math.sqrt(1-P[3]*P[3])}})(w);return $_((function(P,B,L){let $=o.bA();o.b2($,L,P);let Y=o.bA();return o.by(Y,P,$,B/o.b9($)),Y})(k.center,k.radius,I))}getMatrixForModel(a,u){let f=o.V.convert(a),g=1/o.bE,w=o.bj();return o.bJ(w,w,f.lng/180*Math.PI),o.bh(w,w,-f.lat/180*Math.PI),o.O(w,w,[0,0,1+u/o.bE]),o.bh(w,w,.5*Math.PI),o.Q(w,w,[g,g,g]),w}getProjectionDataForCustomLayer(a=!0){let u=this.getProjectionData({overscaledTileID:new o.a2(0,0,0,0,0),applyGlobeMatrix:a});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(a){}}class nd{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(a){this._helper.setMinZoom(a)}setMaxZoom(a){this._helper.setMaxZoom(a)}setMinPitch(a){this._helper.setMinPitch(a)}setMaxPitch(a){this._helper.setMaxPitch(a)}setRenderWorldCopies(a){this._helper.setRenderWorldCopies(a)}setBearing(a){this._helper.setBearing(a)}setPitch(a){this._helper.setPitch(a)}setRoll(a){this._helper.setRoll(a)}setFov(a){this._helper.setFov(a)}setZoom(a){this._helper.setZoom(a)}setCenter(a){this._helper.setCenter(a)}setElevation(a){this._helper.setElevation(a)}setMinElevationForCurrentTile(a){this._helper.setMinElevationForCurrentTile(a)}setPadding(a){this._helper.setPadding(a)}interpolatePadding(a,u,f){return this._helper.interpolatePadding(a,u,f)}isPaddingEqual(a){return this._helper.isPaddingEqual(a)}resize(a,u,f=!0){this._helper.resize(a,u,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(a){this._helper.setMaxBounds(a)}setConstrainOverride(a){this._helper.setConstrainOverride(a)}overrideNearFarZ(a,u){this._helper.overrideNearFarZ(a,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(a){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),a)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(a,u){this._globeness=a,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(a){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(u,f)=>this.currentTransform.defaultConstrain(u,f),this.applyConstrain=(u,f)=>this._helper.applyConstrain(u,f),this._helper=new Oc({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,f)=>this.defaultConstrain(u,f)},a),this._globeness=1,this._mercatorTransform=new Fc,this._verticalPerspectiveTransform=new td}clone(){let a=new nd;return a._globeness=this._globeness,a._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,a.apply(this,!1),a}apply(a,u){this._helper.apply(a,u),this._mercatorTransform.apply(this,!1),this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(a){let u=this._mercatorTransform.getProjectionData(a),f=this._verticalPerspectiveTransform.getProjectionData(a);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:u.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:a.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(a){return this.currentTransform.isLocationOccluded(a)}transformLightDirection(a){return this.currentTransform.transformLightDirection(a)}getPixelScale(){return o.bu(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bu(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(a,u,f){let g=this._mercatorTransform.getPitchedTextCorrection(a,u,f),w=this._verticalPerspectiveTransform.getPitchedTextCorrection(a,u,f);return o.bu(g,w,this._globeness)}projectTileCoordinates(a,u,f,g){return this.currentTransform.projectTileCoordinates(a,u,f,g)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,!1,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(a){return this.currentTransform.calculateFogMatrix(a)}getVisibleUnwrappedCoordinates(a){return this.currentTransform.getVisibleUnwrappedCoordinates(a)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(a){this._mercatorTransform.recalculateZoomAndCenter(a),this._verticalPerspectiveTransform.recalculateZoomAndCenter(a)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(a,u){return this.currentTransform.lngLatToCameraDepth(a,u)}populateCache(a){this._mercatorTransform.populateCache(a),this._verticalPerspectiveTransform.populateCache(a)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(a,u,f,g){return this._helper.calculateCenterFromCameraLngLatAlt(a,u,f,g)}setLocationAtPoint(a,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(a,u),void this.apply(this._mercatorTransform,!1);this._verticalPerspectiveTransform.setLocationAtPoint(a,u),this.apply(this._verticalPerspectiveTransform,!1)}locationToScreenPoint(a,u){return this.currentTransform.locationToScreenPoint(a,u)}screenPointToMercatorCoordinate(a,u){return this.currentTransform.screenPointToMercatorCoordinate(a,u)}screenPointToLocation(a,u){return this.currentTransform.screenPointToLocation(a,u)}isPointOnMapSurface(a,u){return this.currentTransform.isPointOnMapSurface(a,u)}getRayDirectionFromPixel(a){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(a)}getMatrixForModel(a,u){return this.currentTransform.getMatrixForModel(a,u)}getProjectionDataForCustomLayer(a=!0){let u=this._mercatorTransform.getProjectionDataForCustomLayer(a);if(!this.isGlobeRendering)return u;let f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(a);return f.fallbackMatrix=u.mainMatrix,f}getFastPathSimpleProjectionMatrix(a){return this.currentTransform.getFastPathSimpleProjectionMatrix(a)}}class vr{get useGlobeControls(){return!0}handlePanInertia(a,u){let f=sw(a,u);return Math.abs(f.lng-u.center.lng)>180&&(f.lng=u.center.lng+179.5*Math.sign(f.lng-u.center.lng)),{easingCenter:f,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(a,u){let f=a.around,g=u.screenPointToLocation(f);a.bearingDelta&&u.setBearing(u.bearing+a.bearingDelta),a.pitchDelta&&u.setPitch(u.pitch+a.pitchDelta),a.rollDelta&&u.setRoll(u.roll+a.rollDelta);let w=u.zoom;a.zoomDelta&&u.setZoom(u.zoom+a.zoomDelta);let E=u.zoom-w;if(E===0)return;let S=o.bK(u.center.lng,g.lng),I=S/(Math.abs(S/180)+1),k=o.bK(u.center.lat,g.lat),P=u.getRayDirectionFromPixel(f),B=u.cameraPosition,L=-1*o.b5(B,P),$=o.bA();o.b0($,B,[P[0]*L,P[1]*L,P[2]*L]);let Y=o.b7($)-1,ie=Math.exp(.5*-Math.max(Y-.3,0)),oe=Bc(u.worldSize,u.center.lat)/Math.min(u.width,u.height),re=o.bx(oe,.9,.5,1,.25),ue=(1-o.aq(-E))*Math.min(ie,re),ge=u.center.lat,ce=u.zoom,pe=new o.V(u.center.lng+I*ue,o.an(u.center.lat+k*ue,-o.ao,o.ao));u.setLocationAtPoint(g,f);let ve=u.center,he=o.bx(Math.abs(S),45,85,0,1),be=o.bx(oe,.75,.35,0,1),Pe=Math.pow(Math.max(he,be),.25),Ae=o.bK(ve.lng,pe.lng),ke=o.bK(ve.lat,pe.lat);u.setCenter(new o.V(ve.lng+Ae*Pe,ve.lat+ke*Pe).wrap()),u.setZoom(ce+Wi(ge,u.center.lat))}handleMapControlsPan(a,u,f){if(!a.panDelta)return;let g=u.center.lat,w=u.zoom;u.setCenter(sw(a.panDelta,u).wrap()),u.setZoom(w+Wi(g,u.center.lat))}cameraForBoxAndBearing(a,u,f,g,w){let E=z_(a,u,f,g,w),S=u.left/w.width*2-1,I=(w.width-u.right)/w.width*2-1,k=u.top/w.height*-2+1,P=(w.height-u.bottom)/w.height*-2+1,B=o.bK(f.getWest(),f.getEast())<0,L=B?f.getEast():f.getWest(),$=B?f.getWest():f.getEast(),Y=Math.max(f.getNorth(),f.getSouth()),ie=Math.min(f.getNorth(),f.getSouth()),oe=L+.5*o.bK(L,$),re=Y+.5*o.bK(Y,ie),ue=w.clone();ue.setCenter(E.center),ue.setBearing(E.bearing),ue.setPitch(0),ue.setRoll(0),ue.setZoom(E.zoom);let ge=ue.modelViewProjectionMatrix,ce=[Si(f.getNorthWest()),Si(f.getNorthEast()),Si(f.getSouthWest()),Si(f.getSouthEast()),Si(new o.V($,re)),Si(new o.V(L,re)),Si(new o.V(oe,Y)),Si(new o.V(oe,ie))],pe=Si(E.center),ve=Number.POSITIVE_INFINITY;for(let he of ce)S<0&&(ve=vr.getLesserNonNegativeNonNull(ve,vr.solveVectorScale(he,pe,ge,"x",S))),I>0&&(ve=vr.getLesserNonNegativeNonNull(ve,vr.solveVectorScale(he,pe,ge,"x",I))),k>0&&(ve=vr.getLesserNonNegativeNonNull(ve,vr.solveVectorScale(he,pe,ge,"y",k))),P<0&&(ve=vr.getLesserNonNegativeNonNull(ve,vr.solveVectorScale(he,pe,ge,"y",P)));if(Number.isFinite(ve)&&ve!==0)return E.zoom=ue.zoom+o.at(ve),E;nl()}handleJumpToCenterZoom(a,u){let f=a.center.lat,g=a.applyConstrain(u.center?o.V.convert(u.center):a.center,a.zoom).center;a.setCenter(g.wrap());let w=u.zoom!==void 0?+u.zoom:a.zoom+Wi(f,g.lat);a.zoom!==w&&a.setZoom(w)}handleEaseTo(a,u){let f=a.zoom,g=a.center,w=a.padding,E={roll:a.roll,pitch:a.pitch,bearing:a.bearing},S={roll:u.roll===void 0?a.roll:u.roll,pitch:u.pitch===void 0?a.pitch:u.pitch,bearing:u.bearing===void 0?a.bearing:u.bearing},I=u.zoom!==void 0,k=!a.isPaddingEqual(u.padding),P=!1,B=u.center?o.V.convert(u.center):g,L=a.applyConstrain(B,f).center;jl(a,L);let $=a.clone();$.setCenter(L),$.setZoom(I?+u.zoom:f+Wi(g.lat,B.lat)),$.setBearing(u.bearing);let Y=new o.P(o.an(a.centerPoint.x+u.offsetAsPoint.x,0,a.width),o.an(a.centerPoint.y+u.offsetAsPoint.y,0,a.height));$.setLocationAtPoint(L,Y);let ie=(u.offset&&u.offsetAsPoint.mag())>0?$.center:L,oe=I?+u.zoom:f+Wi(g.lat,ie.lat),re=f+Wi(g.lat,0),ue=oe+Wi(ie.lat,0),ge=o.bK(g.lng,ie.lng),ce=o.bK(g.lat,ie.lat),pe=o.aq(ue-re);return P=oe!==f,{easeFunc:ve=>{if(o.bo(E,S)||iw({startEulerAngles:E,endEulerAngles:S,tr:a,k:ve,useSlerp:E.roll!=S.roll}),k&&a.interpolatePadding(w,u.padding,ve),u.around)o.w("Easing around a point is not supported under globe projection."),a.setLocationAtPoint(u.around,u.aroundPoint);else{let he=ue>re?Math.min(2,pe):Math.max(.5,pe),be=Math.pow(he,1-ve),Pe=aw(g,ge,ce,ve*be);a.setCenter(Pe.wrap())}if(P){let he=o.G.number(re,ue,ve)+Wi(0,a.center.lat);a.setZoom(he)}},isZooming:P,elevationCenter:ie}}handleFlyTo(a,u){let f=u.zoom!==void 0,g=a.center,w=a.zoom,E=a.padding,S=!a.isPaddingEqual(u.padding),I=a.applyConstrain(o.V.convert(u.center||u.locationAtOffset),w).center,k=f?+u.zoom:a.zoom+Wi(a.center.lat,I.lat),P=a.clone();P.setCenter(I),P.setZoom(k),P.setBearing(u.bearing);let B=new o.P(o.an(a.centerPoint.x+u.offsetAsPoint.x,0,a.width),o.an(a.centerPoint.y+u.offsetAsPoint.y,0,a.height));P.setLocationAtPoint(I,B);let L=P.center;jl(a,L);let $=(function(ce,pe,ve){let he=Si(pe),be=Si(ve),Pe=o.b5(he,be),Ae=Math.acos(Pe),ke=No(ce);return Ae/(2*Math.PI)*ke})(a,g,L),Y=w+Wi(g.lat,0),ie=k+Wi(L.lat,0),oe=o.aq(ie-Y),re;if(typeof u.minZoom=="number"){let ce=+u.minZoom+Wi(L.lat,0),pe=Math.min(ce,Y,ie)+Wi(0,L.lat),ve=a.applyConstrain(L,pe).zoom+Wi(L.lat,0);re=o.aq(ve-Y)}let ue=o.bK(g.lng,L.lng),ge=o.bK(g.lat,L.lat);return{easeFunc:(ce,pe,ve,he)=>{let be=aw(g,ue,ge,ve);S&&a.interpolatePadding(E,u.padding,ce);let Pe=ce===1?L:be;a.setCenter(Pe.wrap());let Ae=Y+o.at(pe);a.setZoom(ce===1?k:Ae+Wi(0,Pe.lat))},scaleOfZoom:oe,targetCenter:L,scaleOfMinZoom:re,pixelPathLength:$}}static solveVectorScale(a,u,f,g,w){let E=g==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],S=[f[3],f[7],f[11],f[15]],I=a[0]*E[0]+a[1]*E[1]+a[2]*E[2],k=a[0]*S[0]+a[1]*S[1]+a[2]*S[2],P=u[0]*E[0]+u[1]*E[1]+u[2]*E[2],B=u[0]*S[0]+u[1]*S[1]+u[2]*S[2];return P+w*k===I+w*B||S[3]*(I-P)+E[3]*(B-k)+I*B==P*k?null:(P+E[3]-w*B-w*S[3])/(P-I-w*B+w*k)}static getLesserNonNegativeNonNull(a,u){return u!==null&&u>=0&&u<a?u:a}}class lw{constructor(a){this._globe=a,this._mercatorCameraHelper=new Lc,this._verticalPerspectiveCameraHelper=new vr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(a,u){return this.currentHelper.handlePanInertia(a,u)}handleMapControlsRollPitchBearingZoom(a,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(a,u)}handleMapControlsPan(a,u,f){this.currentHelper.handleMapControlsPan(a,u,f)}cameraForBoxAndBearing(a,u,f,g,w){return this.currentHelper.cameraForBoxAndBearing(a,u,f,g,w)}handleJumpToCenterZoom(a,u){this.currentHelper.handleJumpToCenterZoom(a,u)}handleEaseTo(a,u){return this.currentHelper.handleEaseTo(a,u)}handleFlyTo(a,u){return this.currentHelper.handleFlyTo(a,u)}}let id=(v,a)=>o.B(v,a&&a.filter(u=>u.identifier!=="source.canvas")),Fh=o.bO();class Vc extends o.E{constructor(a,u={}){var f,g;super(),this._rtlPluginLoaded=()=>{for(let E in this.tileManagers){let S=this.tileManagers[E].getSource().type;S!=="vector"&&S!=="geojson"||this.tileManagers[E].reload()}},this.map=a,this.dispatcher=new Ti(mn(),a._getMapId()),this.dispatcher.registerMessageHandler("GG",(E,S)=>this.getGlyphs(E,S)),this.dispatcher.registerMessageHandler("GI",(E,S)=>this.getImages(E,S)),this.dispatcher.registerMessageHandler("GDA",(E,S)=>this.getDashes(E,S)),this.imageManager=new Bt,this.imageManager.setEventedParent(this);let w=((f=a._container)===null||f===void 0?void 0:f.lang)||typeof document<"u"&&((g=document.documentElement)===null||g===void 0?void 0:g.lang)||void 0;this.glyphManager=new zn(a._requestManager,u.localIdeographFontFamily,w),this.lineAtlas=new yr(256,512),this.crossTileSymbolIndex=new Wo,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",o.bP()),X().on(Ee,this._rtlPluginLoaded),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;let S=this.tileManagers[E.sourceId];if(!S)return;let I=S.getSource();if(I&&I.vectorLayerIds)for(let k in this._layers){let P=this._layers[k];P.source===I.id&&this._validateLayer(P)}})}_setInitialValues(){var a;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new o.bQ,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((a=this.crossTileSymbolIndex)===null||a===void 0?void 0:a.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(a,u){var f,g,w;this._checkLoaded();let E=u===null?(w=(g=(f=this.stylesheet.state)===null||f===void 0?void 0:f[a])===null||g===void 0?void 0:g.default)!==null&&w!==void 0?w:null:u;if(o.bR(E,this._globalState[a]))return this;this._globalState[a]=E,this._applyGlobalStateChanges([a])}getGlobalState(){return this._globalState}setGlobalState(a){this._checkLoaded();let u=[];for(let f in a)!o.bR(this._globalState[f],a[f].default)&&(u.push(f),this._globalState[f]=a[f].default);this._applyGlobalStateChanges(u)}_applyGlobalStateChanges(a){if(a.length===0)return;let u=new Set,f={};for(let g of a){f[g]=this._globalState[g];for(let w in this._layers){let E=this._layers[w],S=E.getLayoutAffectingGlobalStateRefs(),I=E.getPaintAffectingGlobalStateRefs(),k=E.getVisibilityAffectingGlobalStateRefs();if(S.has(g)&&u.add(E.source),I.has(g))for(let{name:P,value:B}of I.get(g))this._updatePaintProperty(E,P,B);k?.has(g)&&(E.recalculateVisibility(),this._updateLayer(E))}}this.dispatcher.broadcast("UGS",f);for(let g in this.tileManagers)u.has(g)&&(this._reloadSource(g),this._changed=!0)}loadURL(a,u={},f){this.fire(new o.l("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;let g=this.map._requestManager.transformRequest(a,"Style");this._loadStyleRequest=new AbortController;let w=this._loadStyleRequest;o.j(g,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,u,f)}).catch(E=>{this._loadStyleRequest=null,E&&!w.signal.aborted&&this.fire(new o.k(E))})}loadJSON(a,u={},f){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,N.frameAsync(this._frameRequest,this.map._ownerWindow).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(a,u,f)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Fh,{validate:!1})}_load(a,u,f){var g,w;let E=u.transformStyle?u.transformStyle(f,a):a;if(!u.validate||!id(this,o.C(E))){E=Object.assign({},E),this._loaded=!0,this.stylesheet=E;for(let S in E.sources)this.addSource(S,E.sources[S],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new Lt(this.stylesheet.light),this._setProjectionInternal(((g=this.stylesheet.projection)===null||g===void 0?void 0:g.type)||"mercator"),this.sky=new di(this.stylesheet.sky),this.map.setTerrain((w=this.stylesheet.terrain)!==null&&w!==void 0?w:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var a,u,f;let g=o.bS(this.stylesheet.layers);this.setGlobalState((a=this.stylesheet.state)!==null&&a!==void 0?a:null),this.dispatcher.broadcast("SL",g),this._order=g.map(w=>w.id),this._layers={},this._serializedLayers=null;for(let w of g){let E=o.bT(w,this._globalState);if(E.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=E,o.bU(E)&&this.tileManagers[E.source]){let S=(f=(u=w.paint)===null||u===void 0?void 0:u["raster-fade-duration"])!==null&&f!==void 0?f:E.paint.get("raster-fade-duration");this.tileManagers[E.source].setRasterFadeDuration(S)}}}_loadSprite(a,u=!1,f=void 0){this.imageManager.setLoaded(!1);let g=new AbortController,w;this._spriteRequest=g,(function(E,S,I,k){return o._(this,void 0,void 0,function*(){let P=ct(E),B=I>1?"@2x":"",L={},$={};for(let{id:Y,url:ie}of P){let oe=S.transformRequest(bt(ie,B,".json"),"SpriteJSON");L[Y]=o.j(oe,k);let re=S.transformRequest(bt(ie,B,".png"),"SpriteImage");$[Y]=Oe.getImage(re,k)}return yield Promise.all([...Object.values(L),...Object.values($)]),(function(Y,ie){return o._(this,void 0,void 0,function*(){let oe={};for(let re in Y){oe[re]={};let ue=N.getImageCanvasContext((yield ie[re]).data),ge=(yield Y[re]).data;for(let ce in ge){let{width:pe,height:ve,x:he,y:be,sdf:Pe,pixelRatio:Ae,stretchX:ke,stretchY:Re,content:ot,textFitWidth:at,textFitHeight:Ye}=ge[ce];oe[re][ce]={data:null,pixelRatio:Ae,sdf:Pe,stretchX:ke,stretchY:Re,content:ot,textFitWidth:at,textFitHeight:Ye,spriteData:{width:pe,height:ve,x:he,y:be,context:ue}}}}return oe})})(L,$)})})(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(E=>{if(this._spriteRequest=null,E)for(let S in E){this._spritesImagesIds[S]=[];let I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(k=>!(k in E)):[];for(let k of I)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(let k in E[S]){let P=S==="default"?k:`${S}:${k}`;this._spritesImagesIds[S].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,E[S][k],!1):this.imageManager.addImage(P,E[S][k]),u&&(this._changedImages[P]=!0)}}}).catch(E=>{this._spriteRequest=null,w=E,g.signal.aborted||this.fire(new o.k(w))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),f&&f(w)})}_unloadSprite(){for(let a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(a){let u=this.tileManagers[a.source];if(!u)return;let f=a.sourceLayer;if(!f)return;let g=u.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.k(new Error(`Source layer "${f}" does not exist on source "${g.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let a in this.tileManagers)if(!this.tileManagers[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a,u=!1){let f=this._serializedAllLayers();if(!a||a.length===0)return Object.values(u?o.bV(f):f);let g=[];for(let w of a)if(f[w]){let E=u?o.bV(f[w]):f[w];g.push(E)}return g}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};let u=Object.keys(this._layers);for(let f of u){let g=this._layers[f];g.type!=="custom"&&(a[f]=g.serialize())}return a}hasTransitions(){var a,u,f;if(!((a=this.light)===null||a===void 0)&&a.hasTransition()||!((u=this.sky)===null||u===void 0)&&u.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(let g in this.tileManagers)if(this.tileManagers[g].hasTransition())return!0;for(let g in this._layers)if(this._layers[g].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;let u=this._changed;if(u){let g=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(g.length||w.length)&&this._updateWorkerLayers(g,w);for(let E in this._updatedSources){let S=this._updatedSources[E];if(S==="reload")this._reloadSource(E);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let E in this._updatedPaintProps)this._layers[E].updateTransitions(a);this.light.updateTransitions(a),this.sky.updateTransitions(a),this._resetUpdates()}let f={};for(let g in this.tileManagers){let w=this.tileManagers[g];f[g]=w.used,w.used=!1}for(let g of this._order){let w=this._layers[g];w.recalculate(a,this._availableImages),!w.isHidden(a.zoom)&&w.source&&(this.tileManagers[w.source].used=!0)}for(let g in f){let w=this.tileManagers[g];!!f[g]!=!!w.used&&w.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(a),this.sky.recalculate(a),this.projection.recalculate(a),this.z=a.zoom,u&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){let a=Object.keys(this._changedImages);if(a.length){for(let u in this.tileManagers)this.tileManagers[u].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(a,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a,u={}){var f;this._checkLoaded();let g=this.serialize();if(a=u.transformStyle?u.transformStyle(g,a):a,((f=u.validate)===null||f===void 0||f)&&id(this,o.C(a)))return!1;(a=o.bV(a)).layers=o.bS(a.layers);let w=o.bW(g,a),E=this._getOperationsToPerform(w);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(let S of E.operations)S();return this.stylesheet=a,this._serializedLayers=null,this.fire(new o.l("style.load",{style:this})),!0}_getOperationsToPerform(a){let u=[],f=[];for(let g of a)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":u.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":u.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setSky":u.push(()=>this.setSky.apply(this,g.args));break;case"setProjection":this.setProjection.apply(this,g.args);break;case"setGlobalState":u.push(()=>this.setGlobalState.apply(this,g.args));break;case"setTransition":u.push(()=>{});break;default:f.push(g.command)}return{operations:u,unimplemented:f}}addImage(a,u){if(this.getImage(a))return this.fire(new o.k(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,u),this._afterImageUpdated(a)}updateImage(a,u){this.imageManager.updateImage(a,u)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new o.k(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,u,f={}){if(this._checkLoaded(),this.tileManagers[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(o.C.source,`sources.${a}`,u,null,f))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);let g=this.tileManagers[a]=new er(a,u,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:a})),g.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.tileManagers[a]===void 0)throw new Error("There is no source with this ID");for(let f in this._layers)if(this._layers[f].source===a)return this.fire(new o.k(new Error(`Source "${a}" cannot be removed while layer "${f}" is using it.`)));let u=this.tileManagers[a];delete this.tileManagers[a],delete this._updatedSources[a],u.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,u){if(this._checkLoaded(),this.tileManagers[a]===void 0)throw new Error(`There is no source with this ID=${a}`);let f=this.tileManagers[a].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(u),this._changed=!0}getSource(a){return this.tileManagers[a]&&this.tileManagers[a].getSource()}addLayer(a,u,f={}){this._checkLoaded();let g=a.id;if(this.getLayer(g))return void this.fire(new o.k(new Error(`Layer "${g}" already exists on this map.`)));let w;if(a.type==="custom"){if(id(this,o.bX(a)))return;w=o.bT(a,this._globalState)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(g,a.source),a=o.bV(a),a=o.e(a,{source:g})),this._validate(o.C.layer,`layers.${g}`,a,{arrayIndex:-1},f))return;w=o.bT(a,this._globalState),this._validateLayer(w),w.setEventedParent(this,{layer:{id:g}})}let E=u?this._order.indexOf(u):this._order.length;if(u&&E===-1)this.fire(new o.k(new Error(`Cannot add layer "${g}" before non-existing layer "${u}".`)));else{if(this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=w,this._removedLayers[g]&&w.source&&w.type!=="custom"){let S=this._removedLayers[g];delete this._removedLayers[g],S.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.tileManagers[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(a,u){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.k(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===u)return;let f=this._order.indexOf(a);this._order.splice(f,1);let g=u?this._order.indexOf(u):this._order.length;u&&g===-1?this.fire(new o.k(new Error(`Cannot move layer "${a}" before non-existing layer "${u}".`))):(this._order.splice(g,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();let u=this._layers[a];if(!u)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${a}".`)));u.setEventedParent(null);let f=this._order.indexOf(a);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=u,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],u.onRemove&&u.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,u,f){this._checkLoaded();let g=this.getLayer(a);g?g.minzoom===u&&g.maxzoom===f||(u!=null&&(g.minzoom=u),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,u,f={}){this._checkLoaded();let g=this.getLayer(a);if(g){if(!o.bR(g.filter,u))return u==null?(g.setFilter(void 0),void this._updateLayer(g)):void(this._validate(o.C.filter,`layers.${g.id}.filter`,u,null,f)||(g.setFilter(o.bV(u)),this._updateLayer(g)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return o.bV(this.getLayer(a).filter)}setLayoutProperty(a,u,f,g={}){this._checkLoaded();let w=this.getLayer(a);w?o.bR(w.getLayoutProperty(u),f)||(w.setLayoutProperty(u,f,g),this._updateLayer(w)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,u){let f=this.getLayer(a);if(f)return f.getLayoutProperty(u);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,u,f,g={}){this._checkLoaded();let w=this.getLayer(a);w?o.bR(w.getPaintProperty(u),f)||this._updatePaintProperty(w,u,f,g):this.fire(new o.k(new Error(`Cannot style non-existing layer "${a}".`)))}_updatePaintProperty(a,u,f,g={}){a.setPaintProperty(u,f,g)&&this._updateLayer(a),o.bU(a)&&u==="raster-fade-duration"&&this.tileManagers[a.source].setRasterFadeDuration(f),this._changed=!0,this._updatedPaintProps[a.id]=!0,this._serializedLayers=null}getPaintProperty(a,u){return this.getLayer(a).getPaintProperty(u)}setFeatureState(a,u){this._checkLoaded();let f=a.source,g=a.sourceLayer,w=this.tileManagers[f];if(w===void 0)return void this.fire(new o.k(new Error(`The source '${f}' does not exist in the map's style.`)));let E=w.getSource().type;E==="geojson"&&g?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||g?(a.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),w.setFeatureState(g,a.id,u)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,u){this._checkLoaded();let f=a.source,g=this.tileManagers[f];if(g===void 0)return void this.fire(new o.k(new Error(`The source '${f}' does not exist in the map's style.`)));let w=g.getSource().type,E=w==="vector"?a.sourceLayer:void 0;w!=="vector"||E?u&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(E,a.id,u):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();let u=a.source,f=a.sourceLayer,g=this.tileManagers[u];if(g!==void 0)return g.getSource().type!=="vector"||f?(a.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),g.getFeatureState(f,a.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let a=o.bY(this.tileManagers,w=>w.serialize()),u=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,g=this.stylesheet;return o.bZ({version:g.version,name:g.name,metadata:g.metadata,light:g.light,sky:g.sky,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,projection:g.projection,sources:a,layers:u,terrain:f},w=>w!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.tileManagers[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.tileManagers[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){let u=E=>this._layers[E].type==="fill-extrusion",f={},g=[];for(let E=this._order.length-1;E>=0;E--){let S=this._order[E];if(u(S)){f[S]=E;for(let I of a){let k=I[S];if(k)for(let P of k)g.push(P)}}}g.sort((E,S)=>S.intersectionZ-E.intersectionZ);let w=[];for(let E=this._order.length-1;E>=0;E--){let S=this._order[E];if(u(S))for(let I=g.length-1;I>=0;I--){let k=g[I].feature;if(f[k.layer.id]<E)break;w.push(k),g.pop()}else for(let I of a){let k=I[S];if(k)for(let P of k)w.push(P.feature)}}return w}queryRenderedFeatures(a,u,f){u&&u.filter&&this._validate(o.C.filter,"queryRenderedFeatures.filter",u.filter,null,u);let g={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let k of u.layers){let P=this._layers[k];if(!P)return this.fire(new o.k(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}let w=[];u.availableImages=this._availableImages;let E=this._serializedAllLayers(),S=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,I=Object.assign(Object.assign({},u),{layers:S,globalState:this._globalState});for(let k in this.tileManagers)u.layers&&!g[k]||w.push(Fl(this.tileManagers[k],this._layers,E,a,I,f,this.map.terrain?(P,B,L)=>this.map.terrain.getElevation(P,B,L):void 0));return this.placement&&w.push((function(k,P,B,L,$,Y,ie){let oe={},re=Y.queryRenderedSymbols(L),ue=[];for(let ge of Object.keys(re).map(Number))ue.push(ie[ge]);ue.sort(zr);for(let ge of ue){let ce=ge.featureIndex.lookupSymbolFeatures(re[ge.bucketInstanceId],P,ge.bucketIndex,ge.sourceLayerIndex,{filterSpec:$.filter,globalState:$.globalState},$.layers,$.availableImages,k);for(let pe in ce){let ve=oe[pe]=oe[pe]||[],he=ce[pe];he.sort((be,Pe)=>{let Ae=ge.featureSortOrder;if(Ae){let ke=Ae.indexOf(be.featureIndex);return Ae.indexOf(Pe.featureIndex)-ke}return Pe.featureIndex-be.featureIndex});for(let be of he)ve.push(be)}}return(function(ge,ce,pe){for(let ve in ge)for(let he of ge[ve])As(he,pe[ce[ve].source]);return ge})(oe,k,B)})(this._layers,E,this.tileManagers,a,I,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(a,u){u?.filter&&this._validate(o.C.filter,"querySourceFeatures.filter",u.filter,null,u);let f=this.tileManagers[a];return f?(function(g,w){let E=g.getRenderableIds().map(k=>g.getTileByID(k)),S=[],I={};for(let k=0;k<E.length;k++){let P=E[k],B=P.tileID.canonical.key;I[B]||(I[B]=!0,P.querySourceFeatures(S,w))}return S})(f,u?Object.assign(Object.assign({},u),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(a,u={}){this._checkLoaded();let f=this.light.getLight(),g=!1;for(let E in a)if(!o.bR(a[E],f[E])){g=!0;break}if(!g)return;let w={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,u),this.light.updateTransitions(w)}getProjection(){var a;return(a=this.stylesheet)===null||a===void 0?void 0:a.projection}setProjection(a){if(this._checkLoaded(),this.projection){if(this.projection.name===a.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=a,this._setProjectionInternal(a.type)}getSky(){var a;return(a=this.stylesheet)===null||a===void 0?void 0:a.sky}setSky(a,u={}){this._checkLoaded();let f=this.getSky(),g=!1;if(!a&&!f)return;if(a&&!f)g=!0;else if(!a&&f)g=!0;else for(let E in a)if(!o.bR(a[E],f[E])){g=!0;break}if(!g)return;let w={now:J(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=a,this.sky.setSky(a,u),this.sky.updateTransitions(w)}_setProjectionInternal(a){let u=(function(f,g){let w={constrainOverride:g};if(Array.isArray(f)){let E=new ow({type:f});return{projection:E,transform:new nd(w),cameraHelper:new lw(E)}}switch(f){case"mercator":return{projection:new Po,transform:new Fc(w),cameraHelper:new Lc};case"globe":{let E=new ow({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:E,transform:new nd(w),cameraHelper:new lw(E)}}case"vertical-perspective":return{projection:new U_,transform:new td(w),cameraHelper:new vr};default:return o.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Po,transform:new Fc(w),cameraHelper:new Lc}}})(a,this.map.transformConstrain);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(let f in this.tileManagers)this.tileManagers[f].reload()}_validate(a,u,f,g,w={}){return(!w||w.validate!==!1)&&id(this,a.call(o.C,o.e({key:u,style:this.serialize(),value:f,styleSpec:o.u},g)))}_remove(a=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),X().off(Ee,this._rtlPluginLoaded);for(let u in this._layers)this._layers[u].setEventedParent(null);for(let u in this.tileManagers){let f=this.tileManagers[u];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(a)}_clearSource(a){this.tileManagers[a].clearTiles()}_reloadSource(a){this.tileManagers[a].resume(),this.tileManagers[a].reload()}_updateSources(a){for(let u in this.tileManagers)this.tileManagers[u].update(a,this.map.terrain)}_generateCollisionBoxes(){for(let a in this.tileManagers)this._reloadSource(a)}_updatePlacement(a,u,f,g,w=!1){let E=!1,S=!1,I={};for(let k of this._order){let P=this._layers[k];if(P.type!=="symbol")continue;if(!I[P.source]){let L=this.tileManagers[P.source];I[P.source]=L.getRenderableIds(!0).map($=>L.getTileByID($)).sort(($,Y)=>Y.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Y.tileID)?-1:1))}let B=this.crossTileSymbolIndex.addLayer(P,I[P.source],a.center.lng);E=E||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J(),a.zoom))&&(this.pauseablePlacement=new Zu(a,this.map.terrain,this._order,w,u,f,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(let k of this._order){let P=this._layers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,I[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J())}_releaseSymbolFadeTiles(){for(let a in this.tileManagers)this.tileManagers[a].releaseSymbolFadeTiles()}getImages(a,u){return o._(this,void 0,void 0,function*(){let f=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();let g=this.tileManagers[u.source];return g&&g.setDependencies(u.tileID.key,u.type,u.icons),f})}getGlyphs(a,u){return o._(this,void 0,void 0,function*(){let f=yield this.glyphManager.getGlyphs(u.stacks),g=this.tileManagers[u.source];return g&&g.setDependencies(u.tileID.key,u.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a,u={}){this._checkLoaded(),a&&this._validate(o.C.glyphs,"glyphs",a,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}getDashes(a,u){return o._(this,void 0,void 0,function*(){let f={};for(let[g,w]of Object.entries(u.dashes))f[g]=this.lineAtlas.getDash(w.dasharray,w.round);return f})}addSprite(a,u,f={},g){this._checkLoaded();let w=[{id:a,url:u}],E=[...ct(this.stylesheet.sprite),...w];this._validate(o.C.sprite,"sprite",E,null,f)||(this.stylesheet.sprite=E,this._loadSprite(w,!0,g))}removeSprite(a){this._checkLoaded();let u=ct(this.stylesheet.sprite);if(u.find(f=>f.id===a)){if(this._spritesImagesIds[a])for(let f of this._spritesImagesIds[a])this.imageManager.removeImage(f),this._changedImages[f]=!0;u.splice(u.findIndex(f=>f.id===a),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return ct(this.stylesheet.sprite)}setSprite(a,u={},f){this._checkLoaded(),a&&this._validate(o.C.sprite,"sprite",a,null,u)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,f):(this._unloadSprite(),f&&f(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(let a in this.tileManagers){let u=this.tileManagers[a];u.setEventedParent(null),u.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(let a in this._layers){let u=this._layers[a];u.setEventedParent(null),u.onRemove&&u.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var _D=o.aU([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Hp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,u,f,g,w,E,S,I,k){this.context=a;let P=this.boundPaintVertexBuffers.length!==g.length;for(let B=0;!P&&B<g.length;B++)this.boundPaintVertexBuffers[B]!==g[B]&&(P=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==f||P||this.boundIndexBuffer!==w||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==k?this.freshBind(u,f,g,w,E,S,I,k):(a.bindVertexArray.set(this.vao),S&&S.bind(),w&&w.dynamicDraw&&w.bind(),I&&I.bind(),k&&k.bind())}freshBind(a,u,f,g,w,E,S,I){let k=a.numAttributes,P=this.context,B=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=I,u.enableAttributes(B,a);for(let L of f)L.enableAttributes(B,a);E&&E.enableAttributes(B,a),S&&S.enableAttributes(B,a),I&&I.enableAttributes(B,a),u.bind(),u.setVertexAttribPointers(B,a,w);for(let L of f)L.bind(),L.setVertexAttribPointers(B,a,w);E&&(E.bind(),E.setVertexAttribPointers(B,a,w)),g&&g.bind(),S&&(S.bind(),S.setVertexAttribPointers(B,a,w)),I&&(I.bind(),I.setVertexAttribPointers(B,a,w)),P.currentNumAttributes=k}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let yD=(v,a,u,f,g)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:a,u_fog_color:u?u.properties.get("fog-color"):o.bp.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?0:u?u.calculateFogBlendOpacity(f):0,u_horizon_color:u?u.properties.get("horizon-color"):o.bp.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:g?1:0}),rd={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Gp(v){let a=[];for(let u=0;u<v.length;u++){if(v[u]===null)continue;let f=v[u].split(" ");a.push(f.pop())}return a}class cw{constructor(a,u,f,g,w,E,S,I,k=[]){let P=a.gl;this.program=P.createProgram();let B=Gp(u.staticAttributes),L=f?f.getBinderAttributes():[],$=B.concat(L),Y=Oi.prelude.staticUniforms?Gp(Oi.prelude.staticUniforms):[],ie=S.staticUniforms?Gp(S.staticUniforms):[],oe=u.staticUniforms?Gp(u.staticUniforms):[],re=f?f.getBinderUniforms():[],ue=Y.concat(ie).concat(oe).concat(re),ge=[];for(let Ae of ue)ge.indexOf(Ae)<0&&ge.push(Ae);let ce=f?f.defines():[];ks(P)&&ce.unshift("#version 300 es"),w&&ce.push("#define OVERDRAW_INSPECTOR;"),E&&ce.push("#define TERRAIN3D;"),I&&ce.push(I),k&&ce.push(...k);let pe=ce.concat(Oi.prelude.fragmentSource,S.fragmentSource,u.fragmentSource).join(`
`),ve=ce.concat(Oi.prelude.vertexSource,S.vertexSource,u.vertexSource).join(`
`);ks(P)||(pe=(function(Ae){return Ae.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(pe),ve=(function(Ae){return Ae.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ve));let he=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(he,pe),P.compileShader(he),!P.getShaderParameter(he,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(he)}`);P.attachShader(this.program,he);let be=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(be,ve),P.compileShader(be),!P.getShaderParameter(be,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(be)}`);P.attachShader(this.program,be),this.attributes={};let Pe={};this.numAttributes=$.length;for(let Ae=0;Ae<this.numAttributes;Ae++)$[Ae]&&(P.bindAttribLocation(this.program,Ae,$[Ae]),this.attributes[$[Ae]]=Ae);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(be),P.deleteShader(he);for(let Ae=0;Ae<ge.length;Ae++){let ke=ge[Ae];if(ke&&!Pe[ke]){let Re=P.getUniformLocation(this.program,ke);Re&&(Pe[ke]=Re)}}this.fixedUniforms=g(a,Pe),this.terrainUniforms=((Ae,ke)=>({u_depth:new o.b_(Ae,ke.u_depth),u_terrain:new o.b_(Ae,ke.u_terrain),u_terrain_dim:new o.bq(Ae,ke.u_terrain_dim),u_terrain_matrix:new o.c0(Ae,ke.u_terrain_matrix),u_terrain_unpack:new o.c1(Ae,ke.u_terrain_unpack),u_terrain_exaggeration:new o.bq(Ae,ke.u_terrain_exaggeration)}))(a,Pe),this.projectionUniforms=((Ae,ke)=>({u_projection_matrix:new o.c0(Ae,ke.u_projection_matrix),u_projection_tile_mercator_coords:new o.c1(Ae,ke.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.c1(Ae,ke.u_projection_clipping_plane),u_projection_transition:new o.bq(Ae,ke.u_projection_transition),u_projection_fallback_matrix:new o.c0(Ae,ke.u_projection_fallback_matrix)}))(a,Pe),this.binderUniforms=f?f.getUniforms(a,Pe):[]}draw(a,u,f,g,w,E,S,I,k,P,B,L,$,Y,ie,oe,re,ue,ge){let ce=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(f),a.setStencilMode(g),a.setColorMode(w),a.setCullFace(E),I){a.activeTexture.set(ce.TEXTURE2),ce.bindTexture(ce.TEXTURE_2D,I.depthTexture),a.activeTexture.set(ce.TEXTURE3),ce.bindTexture(ce.TEXTURE_2D,I.texture);for(let ve in this.terrainUniforms)this.terrainUniforms[ve].set(I[ve])}if(k)for(let ve in k)this.projectionUniforms[rd[ve]].set(k[ve]);if(S)for(let ve in this.fixedUniforms)this.fixedUniforms[ve].set(S[ve]);oe&&oe.setUniforms(a,this.binderUniforms,Y,{zoom:ie});let pe=0;switch(u){case ce.LINES:pe=2;break;case ce.TRIANGLES:pe=3;break;case ce.LINE_STRIP:pe=1}for(let ve of $.get()){let he=ve.vaos||(ve.vaos={});(he[P]||(he[P]=new Hp)).bind(a,this,B,oe?oe.getPaintVertexBuffers():[],L,ve.vertexOffset,re,ue,ge),ce.drawElements(u,ve.primitiveLength*pe,ce.UNSIGNED_SHORT,ve.primitiveOffset*pe*2)}}}function uw(v,a,u){let f=1/o.aN(u,1,a.transform.tileZoom),g=Math.pow(2,u.tileID.overscaledZ),w=u.tileSize*Math.pow(2,a.transform.tileZoom)/g,E=w*(u.tileID.canonical.x+u.tileID.wrap*g),S=w*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}let q_=(v,a,u,f)=>{let g=v.style.light,w=g.properties.get("position"),E=[w.x,w.y,w.z],S=o.c4();g.properties.get("anchor")==="viewport"&&o.c5(S,v.transform.bearingInRadians),o.c6(E,E,S);let I=v.transform.transformLightDirection(E),k=g.properties.get("color");return{u_lightpos:E,u_lightpos_globe:I,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+a,u_opacity:u,u_fill_translate:f}},W_=(v,a,u,f,g,w,E)=>o.e(q_(v,a,u,f),uw(w,v,E),{u_height_factor:-Math.pow(2,g.overscaledZ)/E.tileSize/8}),Z_=(v,a,u,f)=>o.e(uw(a,v,u),{u_fill_translate:f}),dw=(v,a)=>({u_world:v,u_fill_translate:a}),hw=(v,a,u,f,g)=>o.e(Z_(v,a,u,g),{u_world:f}),fw=(v,a,u,f,g)=>{let w=v.transform,E,S,I=0;if(u.paint.get("circle-pitch-alignment")==="map"){let k=o.aN(a,1,w.zoom);E=!0,S=[k,k],I=k/(o.a5*Math.pow(2,a.tileID.overscaledZ))*2*Math.PI*g}else E=!1,S=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+E,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:I,u_translate:f}},jc=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),pw=v=>({u_viewport_size:[v.width,v.height]}),K_=(v,a=1)=>({u_color:v,u_overlay:0,u_overlay_scale:a}),od=(v,a,u,f)=>{let g=o.aN(v,1,a)/(o.a5*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:o.aN(v,1,a),u_intensity:u,u_globe_extrude_scale:g}},mw=(v,a,u,f)=>{let g=o.N();o.c7(g,0,v.width,v.height,0,0,1);let w=v.context.gl;return{u_matrix:g,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:u,u_color_ramp:f,u_opacity:a.paint.get("heatmap-opacity")}},qp=(v,a,u)=>{let f=u.paint.get("hillshade-accent-color"),g;switch(u.paint.get("hillshade-method")){case"basic":g=4;break;case"combined":g=1;break;case"igor":g=2;break;case"multidirectional":g=3;break;default:g=0}let w=u.getIlluminationProperties();for(let E=0;E<w.directionRadians.length;E++)u.paint.get("hillshade-illumination-anchor")==="viewport"&&(w.directionRadians[E]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:bD(0,a.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:w.altitudeRadians,u_azimuths:w.directionRadians,u_accent:f,u_method:g,u_highlights:w.highlightColor,u_shadows:w.shadowColor}},vD=(v,a)=>{let u=a.stride,f=o.N();return o.c7(f,0,o.a5,-o.a5,0,0,1),o.O(f,f,[0,-o.a5,0]),{u_matrix:f,u_image:1,u_dimension:[u,u],u_zoom:v.overscaledZ,u_unpack:a.getUnpackVector()}};function bD(v,a){let u=Math.pow(2,a.canonical.z),f=a.canonical.y;return[new o.a9(0,f/u).toLngLat().lat,new o.a9(0,(f+1)/u).toLngLat().lat]}let gw=(v,a,u=0)=>({u_image:0,u_unpack:a.getUnpackVector(),u_dimension:[a.stride,a.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:v.paint.get("color-relief-opacity")}),Lh=(v,a,u,f)=>{let g=v.transform;return{u_translation:Zp(v,a,u),u_ratio:f/o.aN(a,1,g.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},_w=(v,a,u,f,g)=>o.e(Lh(v,a,u,f),{u_image:0,u_image_height:g}),Y_=(v,a,u,f,g)=>{let w=v.transform,E=Ws(a,w);return{u_translation:Zp(v,a,u),u_texsize:a.imageAtlasTexture.size,u_ratio:f/o.aN(a,1,w.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},yw=(v,a,u,f,g)=>{let w=Ws(a,v.transform);return o.e(Lh(v,a,u,f),{u_tileratio:w,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image:0,u_mix:g.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},Wp=(v,a,u,f,g,w)=>{let E=Ws(a,v.transform);return o.e(Lh(v,a,u,f),{u_image:0,u_image_height:w,u_tileratio:E,u_crossfade_from:g.fromScale,u_crossfade_to:g.toScale,u_image_dash:1,u_mix:g.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function Ws(v,a){return 1/o.aN(v,1,a.tileZoom)}function Zp(v,a,u){return o.aO(v.transform,a,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}let X_=(v,a,u,f,g)=>{return{u_tl_parent:v,u_scale_parent:a,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(E=f.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=f.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Q_(f.paint.get("raster-hue-rotate")),u_coords_top:[g[0].x,g[0].y,g[1].x,g[1].y],u_coords_bottom:[g[3].x,g[3].y,g[2].x,g[2].y]};var w,E};function Q_(v){v*=Math.PI/180;let a=Math.sin(v),u=Math.cos(v);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}let J_=(v,a,u,f,g,w,E,S,I,k,P,B,L)=>{let $=E.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:$.width/$.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+P,u_pitch_with_map:+f,u_is_along_line:g,u_is_variable_anchor:w,u_texsize:B,u_texture:0,u_translation:k,u_pitched_scale:L}},Kp=(v,a,u,f,g,w,E,S,I,k,P,B,L,$)=>{let Y=E.transform;return o.e(J_(v,a,u,f,g,w,E,S,I,k,P,B,$),{u_gamma_scale:f?Math.cos(Y.pitch*Math.PI/180)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},zc=(v,a,u,f,g,w,E,S,I,k,P,B,L)=>o.e(Kp(v,a,u,f,g,w,E,S,I,k,!0,P,0,L),{u_texsize_icon:B,u_texture_icon:1}),ey=(v,a)=>({u_opacity:v,u_color:a}),wD=(v,a,u,f,g)=>o.e((function(w,E,S,I){let k=S.imageManager.getPattern(w.from.toString()),P=S.imageManager.getPattern(w.to.toString()),{width:B,height:L}=S.imageManager.getPixelSize(),$=Math.pow(2,I.tileID.overscaledZ),Y=I.tileSize*Math.pow(2,S.transform.tileZoom)/$,ie=Y*(I.tileID.canonical.x+I.tileID.wrap*$),oe=Y*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[B,L],u_mix:E.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/o.aN(I,1,S.transform.tileZoom),u_pixel_coord_upper:[ie>>16,oe>>16],u_pixel_coord_lower:[65535&ie,65535&oe]}})(u,g,a,f),{u_opacity:v}),vw=(v,a)=>{},xD={fillExtrusion:(v,a)=>({u_lightpos:new o.c2(v,a.u_lightpos),u_lightpos_globe:new o.c2(v,a.u_lightpos_globe),u_lightintensity:new o.bq(v,a.u_lightintensity),u_lightcolor:new o.c2(v,a.u_lightcolor),u_vertical_gradient:new o.bq(v,a.u_vertical_gradient),u_opacity:new o.bq(v,a.u_opacity),u_fill_translate:new o.c3(v,a.u_fill_translate)}),fillExtrusionPattern:(v,a)=>({u_lightpos:new o.c2(v,a.u_lightpos),u_lightpos_globe:new o.c2(v,a.u_lightpos_globe),u_lightintensity:new o.bq(v,a.u_lightintensity),u_lightcolor:new o.c2(v,a.u_lightcolor),u_vertical_gradient:new o.bq(v,a.u_vertical_gradient),u_height_factor:new o.bq(v,a.u_height_factor),u_opacity:new o.bq(v,a.u_opacity),u_fill_translate:new o.c3(v,a.u_fill_translate),u_image:new o.b_(v,a.u_image),u_texsize:new o.c3(v,a.u_texsize),u_pixel_coord_upper:new o.c3(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(v,a.u_pixel_coord_lower),u_scale:new o.c2(v,a.u_scale),u_fade:new o.bq(v,a.u_fade)}),fill:(v,a)=>({u_fill_translate:new o.c3(v,a.u_fill_translate)}),fillPattern:(v,a)=>({u_image:new o.b_(v,a.u_image),u_texsize:new o.c3(v,a.u_texsize),u_pixel_coord_upper:new o.c3(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(v,a.u_pixel_coord_lower),u_scale:new o.c2(v,a.u_scale),u_fade:new o.bq(v,a.u_fade),u_fill_translate:new o.c3(v,a.u_fill_translate)}),fillOutline:(v,a)=>({u_world:new o.c3(v,a.u_world),u_fill_translate:new o.c3(v,a.u_fill_translate)}),fillOutlinePattern:(v,a)=>({u_world:new o.c3(v,a.u_world),u_image:new o.b_(v,a.u_image),u_texsize:new o.c3(v,a.u_texsize),u_pixel_coord_upper:new o.c3(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(v,a.u_pixel_coord_lower),u_scale:new o.c2(v,a.u_scale),u_fade:new o.bq(v,a.u_fade),u_fill_translate:new o.c3(v,a.u_fill_translate)}),circle:(v,a)=>({u_camera_to_center_distance:new o.bq(v,a.u_camera_to_center_distance),u_scale_with_map:new o.b_(v,a.u_scale_with_map),u_pitch_with_map:new o.b_(v,a.u_pitch_with_map),u_extrude_scale:new o.c3(v,a.u_extrude_scale),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_globe_extrude_scale:new o.bq(v,a.u_globe_extrude_scale),u_translate:new o.c3(v,a.u_translate)}),collisionBox:(v,a)=>({u_pixel_extrude_scale:new o.c3(v,a.u_pixel_extrude_scale)}),collisionCircle:(v,a)=>({u_viewport_size:new o.c3(v,a.u_viewport_size)}),debug:(v,a)=>({u_color:new o.b$(v,a.u_color),u_overlay:new o.b_(v,a.u_overlay),u_overlay_scale:new o.bq(v,a.u_overlay_scale)}),depth:vw,clippingMask:vw,heatmap:(v,a)=>({u_extrude_scale:new o.bq(v,a.u_extrude_scale),u_intensity:new o.bq(v,a.u_intensity),u_globe_extrude_scale:new o.bq(v,a.u_globe_extrude_scale)}),heatmapTexture:(v,a)=>({u_matrix:new o.c0(v,a.u_matrix),u_world:new o.c3(v,a.u_world),u_image:new o.b_(v,a.u_image),u_color_ramp:new o.b_(v,a.u_color_ramp),u_opacity:new o.bq(v,a.u_opacity)}),hillshade:(v,a)=>({u_image:new o.b_(v,a.u_image),u_latrange:new o.c3(v,a.u_latrange),u_exaggeration:new o.bq(v,a.u_exaggeration),u_altitudes:new o.c9(v,a.u_altitudes),u_azimuths:new o.c9(v,a.u_azimuths),u_accent:new o.b$(v,a.u_accent),u_method:new o.b_(v,a.u_method),u_shadows:new o.c8(v,a.u_shadows),u_highlights:new o.c8(v,a.u_highlights)}),hillshadePrepare:(v,a)=>({u_matrix:new o.c0(v,a.u_matrix),u_image:new o.b_(v,a.u_image),u_dimension:new o.c3(v,a.u_dimension),u_zoom:new o.bq(v,a.u_zoom),u_unpack:new o.c1(v,a.u_unpack)}),colorRelief:(v,a)=>({u_image:new o.b_(v,a.u_image),u_unpack:new o.c1(v,a.u_unpack),u_dimension:new o.c3(v,a.u_dimension),u_elevation_stops:new o.b_(v,a.u_elevation_stops),u_color_stops:new o.b_(v,a.u_color_stops),u_color_ramp_size:new o.b_(v,a.u_color_ramp_size),u_opacity:new o.bq(v,a.u_opacity)}),line:(v,a)=>({u_translation:new o.c3(v,a.u_translation),u_ratio:new o.bq(v,a.u_ratio),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_units_to_pixels:new o.c3(v,a.u_units_to_pixels)}),lineGradient:(v,a)=>({u_translation:new o.c3(v,a.u_translation),u_ratio:new o.bq(v,a.u_ratio),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_units_to_pixels:new o.c3(v,a.u_units_to_pixels),u_image:new o.b_(v,a.u_image),u_image_height:new o.bq(v,a.u_image_height)}),linePattern:(v,a)=>({u_translation:new o.c3(v,a.u_translation),u_texsize:new o.c3(v,a.u_texsize),u_ratio:new o.bq(v,a.u_ratio),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_image:new o.b_(v,a.u_image),u_units_to_pixels:new o.c3(v,a.u_units_to_pixels),u_scale:new o.c2(v,a.u_scale),u_fade:new o.bq(v,a.u_fade)}),lineSDF:(v,a)=>({u_translation:new o.c3(v,a.u_translation),u_ratio:new o.bq(v,a.u_ratio),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_units_to_pixels:new o.c3(v,a.u_units_to_pixels),u_image:new o.b_(v,a.u_image),u_mix:new o.bq(v,a.u_mix),u_tileratio:new o.bq(v,a.u_tileratio),u_crossfade_from:new o.bq(v,a.u_crossfade_from),u_crossfade_to:new o.bq(v,a.u_crossfade_to),u_lineatlas_width:new o.bq(v,a.u_lineatlas_width),u_lineatlas_height:new o.bq(v,a.u_lineatlas_height)}),lineGradientSDF:(v,a)=>({u_translation:new o.c3(v,a.u_translation),u_ratio:new o.bq(v,a.u_ratio),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_units_to_pixels:new o.c3(v,a.u_units_to_pixels),u_image:new o.b_(v,a.u_image),u_image_height:new o.bq(v,a.u_image_height),u_tileratio:new o.bq(v,a.u_tileratio),u_crossfade_from:new o.bq(v,a.u_crossfade_from),u_crossfade_to:new o.bq(v,a.u_crossfade_to),u_image_dash:new o.b_(v,a.u_image_dash),u_mix:new o.bq(v,a.u_mix),u_lineatlas_width:new o.bq(v,a.u_lineatlas_width),u_lineatlas_height:new o.bq(v,a.u_lineatlas_height)}),raster:(v,a)=>({u_tl_parent:new o.c3(v,a.u_tl_parent),u_scale_parent:new o.bq(v,a.u_scale_parent),u_buffer_scale:new o.bq(v,a.u_buffer_scale),u_fade_t:new o.bq(v,a.u_fade_t),u_opacity:new o.bq(v,a.u_opacity),u_image0:new o.b_(v,a.u_image0),u_image1:new o.b_(v,a.u_image1),u_brightness_low:new o.bq(v,a.u_brightness_low),u_brightness_high:new o.bq(v,a.u_brightness_high),u_saturation_factor:new o.bq(v,a.u_saturation_factor),u_contrast_factor:new o.bq(v,a.u_contrast_factor),u_spin_weights:new o.c2(v,a.u_spin_weights),u_coords_top:new o.c1(v,a.u_coords_top),u_coords_bottom:new o.c1(v,a.u_coords_bottom)}),symbolIcon:(v,a)=>({u_is_size_zoom_constant:new o.b_(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(v,a.u_is_size_feature_constant),u_size_t:new o.bq(v,a.u_size_t),u_size:new o.bq(v,a.u_size),u_camera_to_center_distance:new o.bq(v,a.u_camera_to_center_distance),u_pitch:new o.bq(v,a.u_pitch),u_rotate_symbol:new o.b_(v,a.u_rotate_symbol),u_aspect_ratio:new o.bq(v,a.u_aspect_ratio),u_fade_change:new o.bq(v,a.u_fade_change),u_label_plane_matrix:new o.c0(v,a.u_label_plane_matrix),u_coord_matrix:new o.c0(v,a.u_coord_matrix),u_is_text:new o.b_(v,a.u_is_text),u_pitch_with_map:new o.b_(v,a.u_pitch_with_map),u_is_along_line:new o.b_(v,a.u_is_along_line),u_is_variable_anchor:new o.b_(v,a.u_is_variable_anchor),u_texsize:new o.c3(v,a.u_texsize),u_texture:new o.b_(v,a.u_texture),u_translation:new o.c3(v,a.u_translation),u_pitched_scale:new o.bq(v,a.u_pitched_scale)}),symbolSDF:(v,a)=>({u_is_size_zoom_constant:new o.b_(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(v,a.u_is_size_feature_constant),u_size_t:new o.bq(v,a.u_size_t),u_size:new o.bq(v,a.u_size),u_camera_to_center_distance:new o.bq(v,a.u_camera_to_center_distance),u_pitch:new o.bq(v,a.u_pitch),u_rotate_symbol:new o.b_(v,a.u_rotate_symbol),u_aspect_ratio:new o.bq(v,a.u_aspect_ratio),u_fade_change:new o.bq(v,a.u_fade_change),u_label_plane_matrix:new o.c0(v,a.u_label_plane_matrix),u_coord_matrix:new o.c0(v,a.u_coord_matrix),u_is_text:new o.b_(v,a.u_is_text),u_pitch_with_map:new o.b_(v,a.u_pitch_with_map),u_is_along_line:new o.b_(v,a.u_is_along_line),u_is_variable_anchor:new o.b_(v,a.u_is_variable_anchor),u_texsize:new o.c3(v,a.u_texsize),u_texture:new o.b_(v,a.u_texture),u_gamma_scale:new o.bq(v,a.u_gamma_scale),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_is_halo:new o.b_(v,a.u_is_halo),u_translation:new o.c3(v,a.u_translation),u_pitched_scale:new o.bq(v,a.u_pitched_scale)}),symbolTextAndIcon:(v,a)=>({u_is_size_zoom_constant:new o.b_(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.b_(v,a.u_is_size_feature_constant),u_size_t:new o.bq(v,a.u_size_t),u_size:new o.bq(v,a.u_size),u_camera_to_center_distance:new o.bq(v,a.u_camera_to_center_distance),u_pitch:new o.bq(v,a.u_pitch),u_rotate_symbol:new o.b_(v,a.u_rotate_symbol),u_aspect_ratio:new o.bq(v,a.u_aspect_ratio),u_fade_change:new o.bq(v,a.u_fade_change),u_label_plane_matrix:new o.c0(v,a.u_label_plane_matrix),u_coord_matrix:new o.c0(v,a.u_coord_matrix),u_is_text:new o.b_(v,a.u_is_text),u_pitch_with_map:new o.b_(v,a.u_pitch_with_map),u_is_along_line:new o.b_(v,a.u_is_along_line),u_is_variable_anchor:new o.b_(v,a.u_is_variable_anchor),u_texsize:new o.c3(v,a.u_texsize),u_texsize_icon:new o.c3(v,a.u_texsize_icon),u_texture:new o.b_(v,a.u_texture),u_texture_icon:new o.b_(v,a.u_texture_icon),u_gamma_scale:new o.bq(v,a.u_gamma_scale),u_device_pixel_ratio:new o.bq(v,a.u_device_pixel_ratio),u_is_halo:new o.b_(v,a.u_is_halo),u_translation:new o.c3(v,a.u_translation),u_pitched_scale:new o.bq(v,a.u_pitched_scale)}),background:(v,a)=>({u_opacity:new o.bq(v,a.u_opacity),u_color:new o.b$(v,a.u_color)}),backgroundPattern:(v,a)=>({u_opacity:new o.bq(v,a.u_opacity),u_image:new o.b_(v,a.u_image),u_pattern_tl_a:new o.c3(v,a.u_pattern_tl_a),u_pattern_br_a:new o.c3(v,a.u_pattern_br_a),u_pattern_tl_b:new o.c3(v,a.u_pattern_tl_b),u_pattern_br_b:new o.c3(v,a.u_pattern_br_b),u_texsize:new o.c3(v,a.u_texsize),u_mix:new o.bq(v,a.u_mix),u_pattern_size_a:new o.c3(v,a.u_pattern_size_a),u_pattern_size_b:new o.c3(v,a.u_pattern_size_b),u_scale_a:new o.bq(v,a.u_scale_a),u_scale_b:new o.bq(v,a.u_scale_b),u_pixel_coord_upper:new o.c3(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.c3(v,a.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bq(v,a.u_tile_units_to_pixels)}),terrain:(v,a)=>({u_texture:new o.b_(v,a.u_texture),u_ele_delta:new o.bq(v,a.u_ele_delta),u_fog_matrix:new o.c0(v,a.u_fog_matrix),u_fog_color:new o.b$(v,a.u_fog_color),u_fog_ground_blend:new o.bq(v,a.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bq(v,a.u_fog_ground_blend_opacity),u_horizon_color:new o.b$(v,a.u_horizon_color),u_horizon_fog_blend:new o.bq(v,a.u_horizon_fog_blend),u_is_globe_mode:new o.bq(v,a.u_is_globe_mode)}),terrainDepth:(v,a)=>({u_ele_delta:new o.bq(v,a.u_ele_delta)}),terrainCoords:(v,a)=>({u_texture:new o.b_(v,a.u_texture),u_terrain_coords_id:new o.bq(v,a.u_terrain_coords_id),u_ele_delta:new o.bq(v,a.u_ele_delta)}),projectionErrorMeasurement:(v,a)=>({u_input:new o.bq(v,a.u_input),u_output_expected:new o.bq(v,a.u_output_expected)}),atmosphere:(v,a)=>({u_sun_pos:new o.c2(v,a.u_sun_pos),u_atmosphere_blend:new o.bq(v,a.u_atmosphere_blend),u_globe_position:new o.c2(v,a.u_globe_position),u_globe_radius:new o.bq(v,a.u_globe_radius),u_inv_proj_matrix:new o.c0(v,a.u_inv_proj_matrix)}),sky:(v,a)=>({u_sky_color:new o.b$(v,a.u_sky_color),u_horizon_color:new o.b$(v,a.u_horizon_color),u_horizon:new o.c3(v,a.u_horizon),u_horizon_normal:new o.c3(v,a.u_horizon_normal),u_sky_horizon_blend:new o.bq(v,a.u_sky_horizon_blend),u_sky_blend:new o.bq(v,a.u_sky_blend)})};class ED{constructor(a,u,f){this.context=a;let g=a.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){let u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let bw={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class CD{constructor(a,u,f,g){this.length=u.length,this.attributes=f,this.itemSize=u.bytesPerElement,this.dynamicDraw=g,this.context=a;let w=a.gl;this.buffer=w.createBuffer(),a.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);let u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let f=0;f<this.attributes.length;f++){let g=u.attributes[this.attributes[f].name];g!==void 0&&a.enableVertexAttribArray(g)}}setVertexAttribPointers(a,u,f){for(let g=0;g<this.attributes.length;g++){let w=this.attributes[g],E=u.attributes[w.name];E!==void 0&&a.vertexAttribPointer(E,w.components,a[bw[w.type]],!1,this.itemSize,w.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Vn{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yp extends Vn{getDefault(){return o.bp.transparent}set(a){let u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Xp extends Vn{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Qp extends Vn{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class ty extends Vn{getDefault(){return[!0,!0,!0,!0]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Uc extends Vn{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Bh extends Vn{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class sd extends Vn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){let u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Rs extends Vn{getDefault(){let a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class ww extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class xw extends Vn{getDefault(){return[0,1]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class ny extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class $c extends Vn{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Jp extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class em extends Vn{getDefault(){let a=this.gl;return[a.ONE,a.ZERO]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Vh extends Vn{getDefault(){return o.bp.transparent}set(a){let u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class tm extends Vn{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ew extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class ad extends Vn{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class ld extends Vn{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Cw extends Vn{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class iy extends Vn{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class yn extends Vn{getDefault(){let a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){let u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class nm extends Vn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class TD extends Vn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Tw extends Vn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class jh extends Vn{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class SD extends Vn{getDefault(){return null}set(a){let u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class DD extends Vn{getDefault(){return null}set(a){var u;if(a===this.current&&!this.dirty)return;let f=this.gl;ks(f)?f.bindVertexArray(a):(u=f.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class Sw extends Vn{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class ID extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class ry extends Vn{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;let u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class cd extends Vn{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class zh extends cd{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class im extends cd{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class oy extends cd{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}let sy="Framebuffer is not complete";class rm{constructor(a,u,f,g,w){this.context=a,this.width=u,this.height=f;let E=a.gl,S=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new zh(a,S),g)this.depthAttachment=w?new oy(a,S):new im(a,S);else if(w)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(sy)}destroy(){let a=this.context.gl,u=this.colorAttachment.get();if(u&&a.deleteTexture(u),this.depthAttachment){let f=this.depthAttachment.get();f&&a.deleteRenderbuffer(f)}a.deleteFramebuffer(this.framebuffer)}}class om{constructor(a){var u,f;if(this.gl=a,this.clearColor=new Yp(this),this.clearDepth=new Xp(this),this.clearStencil=new Qp(this),this.colorMask=new ty(this),this.depthMask=new Uc(this),this.stencilMask=new Bh(this),this.stencilFunc=new sd(this),this.stencilOp=new Rs(this),this.stencilTest=new ww(this),this.depthRange=new xw(this),this.depthTest=new ny(this),this.depthFunc=new $c(this),this.blend=new Jp(this),this.blendFunc=new em(this),this.blendColor=new Vh(this),this.blendEquation=new tm(this),this.cullFace=new Ew(this),this.cullFaceSide=new ad(this),this.frontFace=new ld(this),this.program=new Cw(this),this.activeTexture=new iy(this),this.viewport=new yn(this),this.bindFramebuffer=new nm(this),this.bindRenderbuffer=new TD(this),this.bindTexture=new Tw(this),this.bindVertexBuffer=new jh(this),this.bindElementBuffer=new SD(this),this.bindVertexArray=new DD(this),this.pixelStoreUnpack=new Sw(this),this.pixelStoreUnpackPremultiplyAlpha=new ID(this),this.pixelStoreUnpackFlipY=new ry(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),ks(a)){this.HALF_FLOAT=a.HALF_FLOAT;let g=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=a.RGBA16F)!==null&&u!==void 0?u:g?.RGBA16F_EXT,this.RGB16F=(f=a.RGB16F)!==null&&f!==void 0?f:g?.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");let g=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=g?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u){return new ED(this,a,u)}createVertexBuffer(a,u,f){return new CD(this,a,u,f)}createRenderbuffer(a,u,f){let g=this.gl,w=g.createRenderbuffer();return this.bindRenderbuffer.set(w),g.renderbufferStorage(g.RENDERBUFFER,a,u,f),this.bindRenderbuffer.set(null),w}createFramebuffer(a,u,f,g){return new rm(this,a,u,f,g)}clear({color:a,depth:u,stencil:f}){let g=this.gl,w=0;a&&(w|=g.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(w|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f!==void 0&&(w|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(w)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){o.bR(a.blendFunction,ti.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return ks(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var u;return ks(this.gl)?this.gl.deleteVertexArray(a):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}let Ul;function Hc(v,a,u,f,g){let w=v.context,E=v.transform,S=w.gl,I=v.useProgram("collisionBox"),k=[],P=0,B=0;for(let re=0;re<f.length;re++){let ue=f[re],ge=a.getTile(ue).getBucket(u);if(!ge)continue;let ce=g?ge.textCollisionBox:ge.iconCollisionBox,pe=ge.collisionCircleArray;pe.length>0&&(k.push({circleArray:pe,circleOffset:B,coord:ue}),P+=pe.length/4,B=P),ce&&I.draw(w,S.LINES,dn.disabled,Rn.disabled,v.colorModeForRenderPass(),Mn.disabled,jc(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(ue),E.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,null,v.transform.zoom,null,null,ce.collisionVertexBuffer)}if(!g||!k.length)return;let L=v.useProgram("collisionCircle"),$=new o.ca;$.resize(4*P),$._trim();let Y=0;for(let re of k)for(let ue=0;ue<re.circleArray.length/4;ue++){let ge=4*ue,ce=re.circleArray[ge+0],pe=re.circleArray[ge+1],ve=re.circleArray[ge+2],he=re.circleArray[ge+3];$.emplace(Y++,ce,pe,ve,he,0),$.emplace(Y++,ce,pe,ve,he,1),$.emplace(Y++,ce,pe,ve,he,2),$.emplace(Y++,ce,pe,ve,he,3)}(!Ul||Ul.length<2*P)&&(Ul=(function(re){let ue=2*re,ge=new o.cc;ge.resize(ue),ge._trim();for(let ce=0;ce<ue;ce++){let pe=6*ce;ge.uint16[pe+0]=4*ce+0,ge.uint16[pe+1]=4*ce+1,ge.uint16[pe+2]=4*ce+2,ge.uint16[pe+3]=4*ce+2,ge.uint16[pe+4]=4*ce+3,ge.uint16[pe+5]=4*ce+0}return ge})(P));let ie=w.createIndexBuffer(Ul,!0),oe=w.createVertexBuffer($,o.cb.members,!0);for(let re of k){let ue=pw(v.transform);L.draw(w,S.TRIANGLES,dn.disabled,Rn.disabled,v.colorModeForRenderPass(),Mn.disabled,ue,v.style.map.terrain&&v.style.map.terrain.getTerrainData(re.coord),null,u.id,oe,ie,o.aX.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,v.transform.zoom,null,null,null)}oe.destroy(),ie.destroy()}let ay=o.ar(new Float32Array(16));function MD(v,a,u,f,g,w){let{horizontalAlign:E,verticalAlign:S}=o.aS(v);return new o.P((-(E-.5)*a/g+f[0])*w,(-(S-.5)*u/g+f[1])*w)}function Uh(v,a,u,f,g,w){let E=a.tileAnchorPoint.add(new o.P(a.translation[0],a.translation[1]));if(a.pitchWithMap){let S=f.mult(w);u||(S=S.rotate(-g));let I=E.add(S);return un(I.x,I.y,a.pitchedLabelPlaneMatrix,a.getElevation).point}if(u){let S=Wn(a.tileAnchorPoint.x+1,a.tileAnchorPoint.y,a).point.sub(v),I=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return v.add(f.rotate(I))}return v.add(f)}function AD(v,a,u,f,g,w,E,S,I,k,P,B){let L=v.text.placedSymbolArray,$=v.text.dynamicLayoutVertexArray,Y=v.icon.dynamicLayoutVertexArray,ie={};$.clear();for(let oe=0;oe<L.length;oe++){let re=L.get(oe),ue=re.hidden||!re.crossTileID||v.allowVerticalPlacement&&!re.placedOrientation?null:f[re.crossTileID];if(ue){let ge=new o.P(re.anchorX,re.anchorY),ce={getElevation:B,width:g.width,height:g.height,pitchedLabelPlaneMatrix:w,pitchWithMap:u,transform:g,tileAnchorPoint:ge,translation:k,unwrappedTileID:P},pe=u?qu(ge.x,ge.y,ce):Wn(ge.x,ge.y,ce),ve=Ch(g.cameraToCenterDistance,pe.signedDistanceFromCamera),he=o.aA(v.textSizeData,S,re)*ve/o.aM;u&&(he*=v.tilePixelRatio/E);let{width:be,height:Pe,anchor:Ae,textOffset:ke,textBoxScale:Re}=ue,ot=MD(Ae,be,Pe,ke,Re,he),at=g.getPitchedTextCorrection(ge.x+k[0],ge.y+k[1],P),Ye=Uh(pe.point,ce,a,ot,-g.bearingInRadians,at),dt=v.allowVerticalPlacement&&re.placedOrientation===o.az.vertical?Math.PI/2:0;for(let Yt=0;Yt<re.numGlyphs;Yt++)o.aG($,Ye,dt);I&&re.associatedIconIndex>=0&&(ie[re.associatedIconIndex]={shiftedAnchor:Ye,angle:dt})}else Nc(re.numGlyphs,$)}if(I){Y.clear();let oe=v.icon.placedSymbolArray;for(let re=0;re<oe.length;re++){let ue=oe.get(re);if(ue.hidden)Nc(ue.numGlyphs,Y);else{let ge=ie[re];if(ge)for(let ce=0;ce<ue.numGlyphs;ce++)o.aG(Y,ge.shiftedAnchor,ge.angle);else Nc(ue.numGlyphs,Y)}}v.icon.dynamicLayoutVertexBuffer.updateData(Y)}v.text.dynamicLayoutVertexBuffer.updateData($)}function Dw(v,a,u){return u.iconsInText&&a?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function $h(v,a,u,f,g,w,E,S,I,k,P,B,L){let $=v.context,Y=$.gl,ie=v.transform,oe=S==="map",re=I==="map",ue=S!=="viewport"&&u.layout.get("symbol-placement")!=="point",ge=oe&&!re&&!ue,ce=!u.layout.get("symbol-sort-key").isConstant(),pe=!1,ve=v.getDepthModeForSublayer(0,dn.ReadOnly),he=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),be=[],Pe=ie.getCircleRadiusCorrection();for(let Ae of f){let ke=a.getTile(Ae),Re=ke.getBucket(u);if(!Re)continue;let ot=g?Re.text:Re.icon;if(!ot||!ot.segments.get().length||!ot.hasVisibleVertices)continue;let at=ot.programConfigurations.get(u.id),Ye=g||Re.sdfIcons,dt=g?Re.textSizeData:Re.iconSizeData,Yt=re||ie.pitch!==0,Hn=v.useProgram(Dw(Ye,g,Re),at),yi=o.ay(dt,ie.zoom),ni=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),Di,ii,Zi,Ii,$r=[0,0],hr=null;if(g)ii=ke.glyphAtlasTexture,Zi=Y.LINEAR,Di=ke.glyphAtlasTexture.size,Re.iconsInText&&($r=ke.imageAtlasTexture.size,hr=ke.imageAtlasTexture,Ii=Yt||v.options.rotating||v.options.zooming||dt.kind==="composite"||dt.kind==="camera"?Y.LINEAR:Y.NEAREST);else{let fi=u.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;ii=ke.imageAtlasTexture,Zi=Ye||v.options.rotating||v.options.zooming||fi||Yt?Y.LINEAR:Y.NEAREST,Di=ke.imageAtlasTexture.size}let rr=o.aN(ke,1,v.transform.zoom),no=us(oe,v.transform,rr),Wl=o.N();o.aB(Wl,no);let rl=Fp(re,oe,v.transform,rr),Ta=o.aO(ie,ke,w,E),Ko=ie.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),Yc=he&&Re.hasTextData(),uf=u.layout.get("icon-text-fit")!=="none"&&Yc&&Re.hasIconData();if(ue){let fi=v.style.map.terrain?(Nr,Or)=>v.style.map.terrain.getElevation(Ae,Nr,Or):null,ri=u.layout.get("text-rotation-alignment")==="map";Lp(Re,v,g,no,Wl,re,k,ri,Ae.toUnwrapped(),ie.width,ie.height,Ta,fi)}let Xc=g&&he||uf,Os=ue||Xc?ay:re?no:v.transform.clipSpaceToPixelsMatrix,Sa=Ye&&u.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Qs;Qs=Ye?Re.iconsInText?zc(dt.kind,yi,ge,re,ue,Xc,v,Os,rl,Ta,Di,$r,Pe):Kp(dt.kind,yi,ge,re,ue,Xc,v,Os,rl,Ta,g,Di,0,Pe):J_(dt.kind,yi,ge,re,ue,Xc,v,Os,rl,Ta,g,Di,Pe);let Js={program:Hn,buffers:ot,uniformValues:Qs,projectionData:Ko,atlasTexture:ii,atlasTextureIcon:hr,atlasInterpolation:Zi,atlasInterpolationIcon:Ii,isSDF:Ye,hasHalo:Sa};if(ce&&Re.canOverlap){pe=!0;let fi=ot.segments.get();for(let ri of fi)be.push({segments:new o.aX([ri]),sortKey:ri.sortKey,state:Js,terrainData:ni})}else be.push({segments:ot.segments,sortKey:0,state:Js,terrainData:ni})}pe&&be.sort((Ae,ke)=>Ae.sortKey-ke.sortKey);for(let Ae of be){let ke=Ae.state;if($.activeTexture.set(Y.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,Y.CLAMP_TO_EDGE),ke.atlasTextureIcon&&($.activeTexture.set(Y.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),ke.isSDF){let Re=ke.uniformValues;ke.hasHalo&&(Re.u_is_halo=1,sm(ke.buffers,Ae.segments,u,v,ke.program,ve,P,B,Re,ke.projectionData,Ae.terrainData)),Re.u_is_halo=0}sm(ke.buffers,Ae.segments,u,v,ke.program,ve,P,B,ke.uniformValues,ke.projectionData,Ae.terrainData)}}function sm(v,a,u,f,g,w,E,S,I,k,P){let B=f.context;g.draw(B,B.gl.TRIANGLES,w,E,S,Mn.backCCW,I,P,k,u.id,v.layoutVertexBuffer,v.indexBuffer,a,u.paint,f.transform.zoom,v.programConfigurations.get(u.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Iw(v,a,u,f,g){let w=v.context,E=w.gl,S=Rn.disabled,I=new ti([E.ONE,E.ONE],o.bp.transparent,[!0,!0,!0,!0]),k=a.getBucket(u);if(!k)return;let P=f.key,B=u.heatmapFbos.get(P);B||(B=Hh(w,a.tileSize,a.tileSize),u.heatmapFbos.set(P,B)),w.bindFramebuffer.set(B.framebuffer),w.viewport.set([0,0,a.tileSize,a.tileSize]),w.clear({color:o.bp.transparent});let L=k.programConfigurations.get(u.id),$=v.useProgram("heatmap",L,!g),Y=v.transform.getProjectionData({overscaledTileID:a.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ie=v.style.map.terrain.getTerrainData(f);$.draw(w,E.TRIANGLES,dn.disabled,S,I,Mn.disabled,od(a,v.transform.zoom,u.paint.get("heatmap-intensity"),1),ie,Y,u.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,u.paint,v.transform.zoom,L)}function Mw(v,a,u,f,g){let w=v.context,E=w.gl,S=v.transform;w.setColorMode(v.colorModeForRenderPass());let I=am(w,a),k=u.key,P=a.heatmapFbos.get(k);if(!P)return;w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,P.colorAttachment.get()),w.activeTexture.set(E.TEXTURE1),I.bind(E.LINEAR,E.CLAMP_TO_EDGE);let B=S.getProjectionData({overscaledTileID:u,applyTerrainMatrix:g,applyGlobeMatrix:!f});v.useProgram("heatmapTexture").draw(w,E.TRIANGLES,dn.disabled,Rn.disabled,v.colorModeForRenderPass(),Mn.disabled,mw(v,a,0,1),null,B,a.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,a.paint,S.zoom),P.destroy(),a.heatmapFbos.delete(k)}function Hh(v,a,u){var f,g;let w=v.gl,E=w.createTexture();w.bindTexture(w.TEXTURE_2D,E),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);let S=(f=v.HALF_FLOAT)!==null&&f!==void 0?f:w.UNSIGNED_BYTE,I=(g=v.RGBA16F)!==null&&g!==void 0?g:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,I,a,u,0,w.RGBA,S,null);let k=v.createFramebuffer(a,u,!1,!1);return k.colorAttachment.set(E),k}function am(v,a){return a.colorRampTexture||(a.colorRampTexture=new o.T(v,a.colorRamp,v.gl.RGBA)),a.colorRampTexture}function Aw(v,a,u,f,g,w,E,S){let I=256;if(g.stepInterpolant){let k=a.getSource().maxzoom,P=E.canonical.z===k?Math.ceil(1<<v.transform.maxZoom-E.canonical.z):1;I=o.an(o.ce(w.maxLineLength/o.a5*1024*P),256,u.maxTextureSize)}return S.gradient=o.cf({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:I,image:S.gradient||void 0,clips:w.lineClipsArray}),S.texture?S.texture.update(S.gradient):S.texture=new o.T(u,S.gradient,f.RGBA),S.version=g.gradientVersion,S.texture}function kw(v,a,u,f,g){v.activeTexture.set(a.TEXTURE0),u.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),f.updatePaintBuffers(g)}function nr(v,a,u,f,g,w){(g||v.lineAtlas.dirty)&&(a.activeTexture.set(u.TEXTURE0),v.lineAtlas.bind(a)),f.updatePaintBuffers(w)}function Gc(v,a,u,f,g,w,E){let S=w.gradients[g.id],I=S.texture;g.gradientVersion!==S.version&&(I=Aw(v,a,u,f,g,w,E,S)),u.activeTexture.set(f.TEXTURE0),I.bind(g.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}function hs(v,a,u,f,g,w,E,S,I){let k=w.gradients[g.id],P=k.texture;g.gradientVersion!==k.version&&(P=Aw(v,a,u,f,g,w,E,k)),u.activeTexture.set(f.TEXTURE0),P.bind(g.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE),u.activeTexture.set(f.TEXTURE1),v.lineAtlas.bind(u),S.updatePaintBuffers(I)}function lm(v,a,u,f,g){if(!u||!f||!f.imageAtlas)return;let w=f.imageAtlas.patternPositions,E=w[u.to.toString()],S=w[u.from.toString()];if(!E&&S&&(E=S),!S&&E&&(S=E),!E||!S){let I=g.getPaintProperty(a);E=w[I],S=w[I]}E&&S&&v.setConstantPatternPositions(E,S)}function Gh(v,a,u,f,g,w,E,S){let I=v.context.gl,k="fill-pattern",P=u.paint.get(k),B=P&&P.constantOr(1),L=u.getCrossfadeParameters(),$,Y,ie,oe,re,ue=v.transform,ge=u.paint.get("fill-translate"),ce=u.paint.get("fill-translate-anchor");E?(Y=B&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=I.LINES):(Y=B?"fillPattern":"fill",$=I.TRIANGLES);let pe=P.constantOr(null);for(let ve of f){let he=a.getTile(ve);if(B&&!he.patternsLoaded())continue;let be=he.getBucket(u);if(!be)continue;let Pe=be.programConfigurations.get(u.id),Ae=v.useProgram(Y,Pe),ke=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ve);B&&(v.context.activeTexture.set(I.TEXTURE0),he.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Pe.updatePaintBuffers(L)),lm(Pe,k,pe,he,u);let Re=ue.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),ot=o.aO(ue,he,ge,ce);if(E){oe=be.indexBuffer2,re=be.segments2;let Ye=[I.drawingBufferWidth,I.drawingBufferHeight];ie=Y==="fillOutlinePattern"&&B?hw(v,L,he,Ye,ot):dw(Ye,ot)}else oe=be.indexBuffer,re=be.segments,ie=B?Z_(v,L,he,ot):{u_fill_translate:ot};let at=v.stencilModeForClipping(ve);Ae.draw(v.context,$,g,at,w,Mn.backCCW,ie,ke,Re,u.id,be.layoutVertexBuffer,oe,re,u.paint,v.transform.zoom,Pe)}}function cm(v,a,u,f,g,w,E,S){let I=v.context,k=I.gl,P="fill-extrusion-pattern",B=u.paint.get(P),L=B.constantOr(1),$=u.getCrossfadeParameters(),Y=u.paint.get("fill-extrusion-opacity"),ie=B.constantOr(null),oe=v.transform;for(let re of f){let ue=a.getTile(re),ge=ue.getBucket(u);if(!ge)continue;let ce=v.style.map.terrain&&v.style.map.terrain.getTerrainData(re),pe=ge.programConfigurations.get(u.id),ve=v.useProgram(L?"fillExtrusionPattern":"fillExtrusion",pe);L&&(v.context.activeTexture.set(k.TEXTURE0),ue.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),pe.updatePaintBuffers($));let he=oe.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!S,applyTerrainMatrix:!0});lm(pe,P,ie,ue,u);let be=o.aO(oe,ue,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Pe=u.paint.get("fill-extrusion-vertical-gradient"),Ae=L?W_(v,Pe,Y,be,re,$,ue):q_(v,Pe,Y,be);ve.draw(I,I.gl.TRIANGLES,g,w,E,Mn.backCCW,Ae,ce,he,u.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,u.paint,v.transform.zoom,pe,v.style.map.terrain&&ge.centroidVertexBuffer)}}function $l(v,a,u,f,g,w,E,S,I){var k;let P=v.style.projection,B=v.context,L=v.transform,$=B.gl,Y=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],ie=v.useProgram("hillshade",null,!1,Y),oe=!v.options.moving;for(let re of f){let ue=a.getTile(re),ge=ue.fbo;if(!ge)continue;let ce=P.getMeshFromTileID(B,re.canonical,S,!0,"raster"),pe=(k=v.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(re);B.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,ge.colorAttachment.get());let ve=L.getProjectionData({overscaledTileID:re,aligned:oe,applyGlobeMatrix:!I,applyTerrainMatrix:!0});ie.draw(B,$.TRIANGLES,w,g[re.overscaledZ],E,Mn.backCCW,qp(v,ue,u),pe,ve,u.id,ce.vertexBuffer,ce.indexBuffer,ce.segments)}}function qh(v,a,u,f,g,w,E,S,I){var k;let P=v.style.projection,B=v.context,L=v.transform,$=B.gl,Y=v.useProgram("colorRelief"),ie=!v.options.moving,oe=!0,re=0;for(let ue of f){let ge=a.getTile(ue),ce=ge.dem;if(oe){let Ae=$.getParameter($.MAX_TEXTURE_SIZE),{elevationTexture:ke,colorTexture:Re}=u.getColorRampTextures(B,Ae,ce.getUnpackVector());B.activeTexture.set($.TEXTURE1),ke.bind($.NEAREST,$.CLAMP_TO_EDGE),B.activeTexture.set($.TEXTURE4),Re.bind($.LINEAR,$.CLAMP_TO_EDGE),oe=!1,re=ke.size[0]}if(!ce||!ce.data)continue;let pe=ce.stride,ve=ce.getPixels();if(B.activeTexture.set($.TEXTURE0),B.pixelStoreUnpackPremultiplyAlpha.set(!1),ge.demTexture=ge.demTexture||v.getTileTexture(pe),ge.demTexture){let Ae=ge.demTexture;Ae.update(ve,{premultiply:!1}),Ae.bind($.LINEAR,$.CLAMP_TO_EDGE)}else ge.demTexture=new o.T(B,ve,$.RGBA,{premultiply:!1}),ge.demTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);let he=P.getMeshFromTileID(B,ue.canonical,S,!0,"raster"),be=(k=v.style.map.terrain)===null||k===void 0?void 0:k.getTerrainData(ue),Pe=L.getProjectionData({overscaledTileID:ue,aligned:ie,applyGlobeMatrix:!I,applyTerrainMatrix:!0});Y.draw(B,$.TRIANGLES,w,g[ue.overscaledZ],E,Mn.backCCW,gw(u,ge.dem,re),be,Pe,u.id,he.vertexBuffer,he.indexBuffer,he.segments)}}let qc=[new o.P(0,0),new o.P(o.a5,0),new o.P(o.a5,o.a5),new o.P(0,o.a5)];function ud(v,a,u,f,g,w,E,S,I=!1,k=!1){let P=f[f.length-1].overscaledZ,B=v.context,L=B.gl,$=v.useProgram("raster"),Y=v.transform,ie=v.style.projection,oe=v.colorModeForRenderPass(),re=!v.options.moving,ue=u.paint.get("raster-opacity"),ge=u.paint.get("raster-resampling"),ce=u.paint.get("raster-fade-duration"),pe=!!v.style.map.terrain;for(let ve of f){let he=v.getDepthModeForSublayer(ve.overscaledZ-P,ue===1?dn.ReadWrite:dn.ReadOnly,L.LESS),be=a.getTile(ve),Pe=ge==="nearest"?L.NEAREST:L.LINEAR;B.activeTexture.set(L.TEXTURE0),be.texture.bind(Pe,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(L.TEXTURE1);let{parentTile:Ae,parentScaleBy:ke,parentTopLeft:Re,fadeValues:ot}=Rw(be,a,ce,pe);be.fadeOpacity=ot.tileOpacity,Ae?(Ae.fadeOpacity=ot.parentTileOpacity,Ae.texture.bind(Pe,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST)):be.texture.bind(Pe,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),be.texture.useMipmap&&B.extTextureFilterAnisotropic&&v.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);let at=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ve),Ye=Y.getProjectionData({overscaledTileID:ve,aligned:re,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),dt=X_(Re,ke,ot.fadeMix,u,S),Yt=ie.getMeshFromTileID(B,ve.canonical,w,E,"raster");$.draw(B,L.TRIANGLES,he,g?g[ve.overscaledZ]:Rn.disabled,oe,I?Mn.frontCCW:Mn.backCCW,dt,at,Ye,u.id,Yt.vertexBuffer,Yt.indexBuffer,Yt.segments)}}function Rw(v,a,u,f){let g={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(u===0||f)return g;if(v.fadingParentID){let w=a.getLoadedTile(v.fadingParentID);if(!w)return g;let E=Math.pow(2,w.tileID.overscaledZ-v.tileID.overscaledZ),S=[v.tileID.canonical.x*E%1,v.tileID.canonical.y*E%1],I=(function(k,P,B){let L=J(),$=(L-P.timeAdded)/B,Y=k.fadingDirection===ye.Incoming,ie=o.an((L-k.timeAdded)/B,0,1),oe=o.an(1-$,0,1),re=Y?ie:oe;return{tileOpacity:re,parentTileOpacity:Y?oe:ie,fadeMix:{opacity:1,mix:1-re}}})(v,w,u);return{parentTile:w,parentScaleBy:E,parentTopLeft:S,fadeValues:I}}if(v.selfFading){let w=(function(E,S){let I=(J()-E.timeAdded)/S,k=o.an(I,0,1);return{tileOpacity:k,fadeMix:{opacity:k,mix:0}}})(v,u);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:w}}return g}let Pw=new o.bp(1,0,0,1),Nw=new o.bp(0,1,0,1),Ow=new o.bp(0,0,1,1),Fw=new o.bp(1,0,1,1),Hl=new o.bp(0,1,1,1);function ly(v,a,u,f){Wh(v,0,a+u/2,v.transform.width,u,f)}function cy(v,a,u,f){Wh(v,a-u/2,0,u,v.transform.height,f)}function Wh(v,a,u,f,g,w){let E=v.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(a*v.pixelRatio,u*v.pixelRatio,f*v.pixelRatio,g*v.pixelRatio),E.clear({color:w}),S.disable(S.SCISSOR_TEST)}function Lw(v,a,u){let f=v.context,g=f.gl,w=v.useProgram("debug"),E=dn.disabled,S=Rn.disabled,I=v.colorModeForRenderPass(),k="$debug",P=v.style.map.terrain&&v.style.map.terrain.getTerrainData(u);f.activeTexture.set(g.TEXTURE0);let B=a.getTileByID(u.key).latestRawTileData,L=Math.floor((B&&B.byteLength||0)/1024),$=a.getTile(u).tileSize,Y=512/Math.min($,512)*(u.overscaledZ/v.transform.zoom)*.5,ie=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ie+=` => ${u.overscaledZ}`),(function(re,ue){re.initDebugOverlayCanvas();let ge=re.debugOverlayCanvas,ce=re.context.gl,pe=re.debugOverlayCanvas.getContext("2d");pe.clearRect(0,0,ge.width,ge.height),pe.shadowColor="white",pe.shadowBlur=2,pe.lineWidth=1.5,pe.strokeStyle="white",pe.textBaseline="top",pe.font="bold 36px Open Sans, sans-serif",pe.fillText(ue,5,5),pe.strokeText(ue,5,5),re.debugOverlayTexture.update(ge),re.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)})(v,`${ie} ${L}kB`);let oe=v.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(f,g.TRIANGLES,E,S,ti.alphaBlended,Mn.disabled,K_(o.bp.transparent,Y),null,oe,k,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),w.draw(f,g.LINE_STRIP,E,S,I,Mn.disabled,K_(o.bp.red),P,oe,k,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function uy(v,a,u,f){let{isRenderingGlobe:g}=f,w=v.context,E=w.gl,S=v.transform,I=v.colorModeForRenderPass(),k=v.getDepthModeFor3D(),P=v.useProgram("terrain");w.bindFramebuffer.set(null),w.viewport.set([0,0,v.width,v.height]);for(let B of u){let L=a.getTerrainMesh(B.tileID),$=v.renderToTexture.getTexture(B),Y=a.getTerrainData(B.tileID);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,$.texture);let ie=a.getMeshFrameDelta(S.zoom),oe=S.calculateFogMatrix(B.tileID.toUnwrapped()),re=yD(ie,oe,v.style.sky,S.pitch,g),ue=S.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});P.draw(w,E.TRIANGLES,k,Rn.disabled,I,Mn.backCCW,re,Y,ue,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function dy(v,a){if(!a.mesh){let u=new o.aW;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);let f=new o.aY;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),a.mesh=new ei(v.createVertexBuffer(u,Vl.members),v.createIndexBuffer(f),o.aX.simpleSegment(0,0,u.length,f.length))}return a.mesh}class Bw{constructor(a,u){this.context=new om(a),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=er.maxOverzooming+er.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wo}resize(a,u,f){if(this.width=Math.floor(a*f),this.height=Math.floor(u*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style._order)this.style._layers[g].resize()}setup(){let a=this.context,u=new o.aW;u.emplaceBack(0,0),u.emplaceBack(o.a5,0),u.emplaceBack(0,o.a5),u.emplaceBack(o.a5,o.a5),this.tileExtentBuffer=a.createVertexBuffer(u,Vl.members),this.tileExtentSegments=o.aX.simpleSegment(0,0,4,2);let f=new o.aW;f.emplaceBack(0,0),f.emplaceBack(o.a5,0),f.emplaceBack(0,o.a5),f.emplaceBack(o.a5,o.a5),this.debugBuffer=a.createVertexBuffer(f,Vl.members),this.debugSegments=o.aX.simpleSegment(0,0,4,5);let g=new o.ch;g.emplaceBack(0,0,0,0),g.emplaceBack(o.a5,0,o.a5,0),g.emplaceBack(0,o.a5,0,o.a5),g.emplaceBack(o.a5,o.a5,o.a5,o.a5),this.rasterBoundsBuffer=a.createVertexBuffer(g,_D.members),this.rasterBoundsSegments=o.aX.simpleSegment(0,0,4,2);let w=new o.aW;w.emplaceBack(0,0),w.emplaceBack(o.a5,0),w.emplaceBack(0,o.a5),w.emplaceBack(o.a5,o.a5),this.rasterBoundsBufferPosOnly=a.createVertexBuffer(w,Vl.members),this.rasterBoundsSegmentsPosOnly=o.aX.simpleSegment(0,0,4,5);let E=new o.aW;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(E,Vl.members),this.viewportSegments=o.aX.simpleSegment(0,0,4,2);let S=new o.ci;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(S);let I=new o.aY;I.emplaceBack(1,0,2),I.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);let k=this.context.gl;this.stencilClearMode=new Rn({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.tileExtentMesh=new ei(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let a=this.context,u=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let f=o.N();o.c7(f,0,this.width,this.height,0,0,1),o.Q(f,f,[u.drawingBufferWidth,u.drawingBufferHeight,0]);let g={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(a,u.TRIANGLES,dn.disabled,this.stencilClearMode,ti.disabled,Mn.disabled,null,null,g,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,u,f){if(this.currentStencilSource===a.source||!a.isTileClipped()||!u||!u.length)return;this.currentStencilSource=a.source,this.nextStencilID+u.length>256&&this.clearStencil();let g=this.context;g.setColorMode(ti.disabled),g.setDepthMode(dn.disabled);let w={};for(let E of u)w[E.key]=this.nextStencilID++;this._renderTileMasks(w,u,f,!0),this._renderTileMasks(w,u,f,!1),this._tileClippingMaskIDs=w}_renderTileMasks(a,u,f,g){let w=this.context,E=w.gl,S=this.style.projection,I=this.transform,k=this.useProgram("clippingMask");for(let P of u){let B=a[P.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P),$=S.getMeshFromTileID(this.context,P.canonical,g,!0,"stencil"),Y=I.getProjectionData({overscaledTileID:P,applyGlobeMatrix:!f,applyTerrainMatrix:!0});k.draw(w,E.TRIANGLES,dn.disabled,new Rn({func:E.ALWAYS,mask:0},B,255,E.KEEP,E.KEEP,E.REPLACE),ti.disabled,f?Mn.disabled:Mn.backCCW,null,L,Y,"$clipping",$.vertexBuffer,$.indexBuffer,$.segments)}}_renderTilesDepthBuffer(){let a=this.context,u=a.gl,f=this.style.projection,g=this.transform,w=this.useProgram("depth"),E=this.getDepthModeFor3D(),S=hi(g,{tileSize:g.tileSize});for(let I of S){let k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),P=f.getMeshFromTileID(this.context,I.canonical,!0,!0,"raster"),B=g.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!0,applyTerrainMatrix:!0});w.draw(a,u.TRIANGLES,E,Rn.disabled,ti.disabled,Mn.backCCW,null,k,B,"$clipping",P.vertexBuffer,P.indexBuffer,P.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let a=this.nextStencilID++,u=this.context.gl;return new Rn({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){let u=this.context.gl;return new Rn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(a){let u=this.context.gl,f=a.sort((E,S)=>S.overscaledZ-E.overscaledZ),g=f[f.length-1].overscaledZ,w=f[0].overscaledZ-g+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();let E={};for(let S=0;S<w;S++)E[S+g]=new Rn({func:u.GEQUAL,mask:255},S+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=w,[E,f]}return[{[g]:Rn.disabled},f]}stencilConfigForOverlapTwoPass(a){let u=this.context.gl,f=a.sort((E,S)=>S.overscaledZ-E.overscaledZ),g=f[f.length-1].overscaledZ,w=f[0].overscaledZ-g+1;if(this.clearStencil(),w>1){let E={},S={};for(let I=0;I<w;I++)E[I+g]=new Rn({func:u.GREATER,mask:255},w+1+I,255,u.KEEP,u.KEEP,u.REPLACE),S[I+g]=new Rn({func:u.GREATER,mask:255},1+I,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*w+1,[E,S,f]}return this.nextStencilID=3,[{[g]:new Rn({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[g]:new Rn({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},f]}colorModeForRenderPass(){let a=this.context.gl;return this._showOverdrawInspector?new ti([a.CONSTANT_COLOR,a.ONE],new o.bp(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ti.unblended:ti.alphaBlended}getDepthModeForSublayer(a,u,f){if(!this.opaquePassEnabledForLayer())return dn.disabled;let g=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new dn(f||this.context.gl.LEQUAL,u,[g,g])}getDepthModeFor3D(){return new dn(this.context.gl.LEQUAL,dn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,u){var f,g;this.style=a,this.options=u,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(J()),this.imageManager.beginFrame();let w=this.style._order,E=this.style.tileManagers,S={},I={},k={},P={isRenderingToTexture:!1,isRenderingGlobe:((f=a.projection)===null||f===void 0?void 0:f.transitionState)>0};for(let L in E){let $=E[L];$.used&&$.prepare(this.context),S[L]=$.getVisibleCoordinates(!1),I[L]=S[L].slice().reverse(),k[L]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<w.length;L++)if(this.style._layers[w[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let L of w){let $=this.style._layers[L];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;let Y=I[$.source];($.type==="custom"||Y.length)&&this.renderLayer(this,E[$.source],$,Y,P)}if((g=this.style.projection)===null||g===void 0||g.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?o.bp.black:o.bp.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(L,$){let Y=L.context,ie=Y.gl,oe=((ve,he,be)=>{let Pe=Math.cos(he.rollInRadians),Ae=Math.sin(he.rollInRadians),ke=$e(he),Re=he.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(he.width/2-ke*Ae)*be,(he.height/2+ke*Pe)*be],u_horizon_normal:[-Ae,Pe],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*he.height/2*be,u_sky_blend:Re}})($,L.style.map.transform,L.pixelRatio),re=new dn(ie.LEQUAL,dn.ReadWrite,[0,1]),ue=Rn.disabled,ge=L.colorModeForRenderPass(),ce=L.useProgram("sky"),pe=dy(Y,$);ce.draw(Y,ie.TRIANGLES,re,ue,ge,Mn.disabled,oe,null,void 0,"sky",pe.vertexBuffer,pe.indexBuffer,pe.segments)})(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){let L=this.style._layers[w[this.currentLayer]],$=E[L.source],Y=S[L.source];this._renderTileClippingMasks(L,Y,!1),this.renderLayer(this,$,L,Y,P)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){let L=this.style._layers[w[this.currentLayer]],$=E[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,P))continue;this.opaquePassEnabledForLayer()||B||(B=!0,P.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let Y=(L.type==="symbol"?k:I)[L.source];this._renderTileClippingMasks(L,S[L.source],!!this.renderToTexture),this.renderLayer(this,$,L,Y,P)}if(P.isRenderingGlobe&&(function(L,$,Y){let ie=L.context,oe=ie.gl,re=L.useProgram("atmosphere"),ue=new dn(oe.LEQUAL,dn.ReadOnly,[0,1]),ge=L.transform,ce=(function(Re,ot){let at=Re.properties.get("position"),Ye=[-at.x,-at.y,-at.z],dt=o.ar(new Float64Array(16));return Re.properties.get("anchor")==="map"&&(o.bg(dt,dt,ot.rollInRadians),o.bh(dt,dt,-ot.pitchInRadians),o.bg(dt,dt,ot.bearingInRadians),o.bh(dt,dt,ot.center.lat*Math.PI/180),o.bJ(dt,dt,-ot.center.lng*Math.PI/180)),o.cg(Ye,Ye,dt),Ye})(Y,L.transform),pe=ge.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=$.properties.get("atmosphere-blend")*pe.projectionTransition;if(ve===0)return;let he=Bc(ge.worldSize,ge.center.lat),be=ge.inverseProjectionMatrix,Pe=new Float64Array(4);Pe[3]=1,o.aH(Pe,Pe,ge.modelViewProjectionMatrix),Pe[0]/=Pe[3],Pe[1]/=Pe[3],Pe[2]/=Pe[3],Pe[3]=1,o.aH(Pe,Pe,be),Pe[0]/=Pe[3],Pe[1]/=Pe[3],Pe[2]/=Pe[3],Pe[3]=1;let Ae=((Re,ot,at,Ye,dt)=>({u_sun_pos:Re,u_atmosphere_blend:ot,u_globe_position:at,u_globe_radius:Ye,u_inv_proj_matrix:dt}))(ce,ve,[Pe[0],Pe[1],Pe[2]],he,be),ke=dy(ie,$);re.draw(ie,oe.TRIANGLES,ue,Rn.disabled,ti.alphaBlended,Mn.disabled,Ae,null,null,"atmosphere",ke.vertexBuffer,ke.indexBuffer,ke.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let L=(function($,Y){let ie=null,oe=Object.values($._layers).flatMap(ce=>ce.source&&!ce.isHidden(Y)?[$.tileManagers[ce.source]]:[]),re=oe.filter(ce=>ce.getSource().type==="vector"),ue=oe.filter(ce=>ce.getSource().type!=="vector"),ge=ce=>{(!ie||ie.getSource().maxzoom<ce.getSource().maxzoom)&&(ie=ce)};return re.forEach(ce=>ge(ce)),ie||ue.forEach(ce=>ge(ce)),ie})(this.style,this.transform.zoom);L&&(function($,Y,ie){for(let oe=0;oe<ie.length;oe++)Lw($,Y,ie[oe])})(this,L,L.getVisibleCoordinates())}this.options.showPadding&&(function(L){let $=L.transform.padding;ly(L,L.transform.height-($.top||0),3,Pw),ly(L,$.bottom||0,3,Nw),cy(L,$.left||0,3,Ow),cy(L,L.transform.width-($.right||0),3,Fw);let Y=L.transform.centerPoint;(function(ie,oe,re,ue){Wh(ie,oe-1,re-10,2,20,ue),Wh(ie,oe-10,re-1,20,2,ue)})(L,Y.x,L.transform.height-Y.y,Hl)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;let u=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix,g=this.terrainFacilitator.dirty;g||(g=a?!o.cj(u,f):!o.ck(u,f)),g||(g=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),g&&(o.cl(u,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(w,E){let S=w.context,I=S.gl,k=w.transform,P=ti.unblended,B=new dn(I.LEQUAL,dn.ReadWrite,[0,1]),L=E.tileManager.getRenderableTiles(),$=w.useProgram("terrainDepth");S.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),S.clear({color:o.bp.transparent,depth:1});for(let Y of L){let ie=E.getTerrainMesh(Y.tileID),oe=E.getTerrainData(Y.tileID),re=k.getProjectionData({overscaledTileID:Y.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ue={u_ele_delta:E.getMeshFrameDelta(k.zoom)};$.draw(S,I.TRIANGLES,B,Rn.disabled,P,Mn.backCCW,ue,oe,re,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain),(function(w,E){let S=w.context,I=S.gl,k=w.transform,P=ti.unblended,B=new dn(I.LEQUAL,dn.ReadWrite,[0,1]),L=E.getCoordsTexture(),$=E.tileManager.getRenderableTiles(),Y=w.useProgram("terrainCoords");S.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),S.clear({color:o.bp.transparent,depth:1}),E.coordsIndex=[];for(let ie of $){let oe=E.getTerrainMesh(ie.tileID),re=E.getTerrainData(ie.tileID);S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,L.texture);let ue={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(k.zoom)},ge=k.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Y.draw(S,I.TRIANGLES,B,Rn.disabled,P,Mn.backCCW,ue,re,ge,"terrain",oe.vertexBuffer,oe.indexBuffer,oe.segments),E.coordsIndex.push(ie.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,w.width,w.height])})(this,this.style.map.terrain))}renderLayer(a,u,f,g,w){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(g||[]).length)&&(this.id=f.id,o.cm(f)?(function(E,S,I,k,P,B){if(E.renderPass!=="translucent")return;let{isRenderingToTexture:L}=B,$=Rn.disabled,Y=E.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ie,oe,re,ue,ge,ce,pe,ve,he){let be=oe.transform,Pe=oe.style.map.terrain,Ae=ge==="map",ke=ce==="map";for(let Re of ie){let ot=ue.getTile(Re),at=ot.getBucket(re);if(!at||!at.text||!at.text.segments.get().length)continue;let Ye=o.ay(at.textSizeData,be.zoom),dt=o.aN(ot,1,oe.transform.zoom),Yt=us(Ae,oe.transform,dt),Hn=re.layout.get("icon-text-fit")!=="none"&&at.hasIconData();if(Ye){let yi=Math.pow(2,be.zoom-ot.tileID.overscaledZ),ni=Pe?(Di,ii)=>Pe.getElevation(Re,Di,ii):null;AD(at,Ae,ke,he,be,Yt,yi,Ye,Hn,o.aO(be,ot,pe,ve),Re.toUnwrapped(),ni)}}})(k,E,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),P),I.paint.get("icon-opacity").constantOr(1)!==0&&$h(E,S,I,k,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),$,Y,L),I.paint.get("text-opacity").constantOr(1)!==0&&$h(E,S,I,k,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),$,Y,L),S.map.showCollisionBoxes&&(Hc(E,S,I,k,!0),Hc(E,S,I,k,!1))})(a,u,f,g,this.style.placement.variableOffsets,w):o.cn(f)?(function(E,S,I,k,P){if(E.renderPass!=="translucent")return;let{isRenderingToTexture:B}=P,L=I.paint.get("circle-opacity"),$=I.paint.get("circle-stroke-width"),Y=I.paint.get("circle-stroke-opacity"),ie=!I.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&($.constantOr(1)===0||Y.constantOr(1)===0))return;let oe=E.context,re=oe.gl,ue=E.transform,ge=E.getDepthModeForSublayer(0,dn.ReadOnly),ce=Rn.disabled,pe=E.colorModeForRenderPass(),ve=[],he=ue.getCircleRadiusCorrection();for(let be=0;be<k.length;be++){let Pe=k[be],Ae=S.getTile(Pe),ke=Ae.getBucket(I);if(!ke)continue;let Re=I.paint.get("circle-translate"),ot=I.paint.get("circle-translate-anchor"),at=o.aO(ue,Ae,Re,ot),Ye=ke.programConfigurations.get(I.id),dt=E.useProgram("circle",Ye),Yt=ke.layoutVertexBuffer,Hn=ke.indexBuffer,yi=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Pe),ni={programConfiguration:Ye,program:dt,layoutVertexBuffer:Yt,indexBuffer:Hn,uniformValues:fw(E,Ae,I,at,he),terrainData:yi,projectionData:ue.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(ie){let Di=ke.segments.get();for(let ii of Di)ve.push({segments:new o.aX([ii]),sortKey:ii.sortKey,state:ni})}else ve.push({segments:ke.segments,sortKey:0,state:ni})}ie&&ve.sort((be,Pe)=>be.sortKey-Pe.sortKey);for(let be of ve){let{programConfiguration:Pe,program:Ae,layoutVertexBuffer:ke,indexBuffer:Re,uniformValues:ot,terrainData:at,projectionData:Ye}=be.state;Ae.draw(oe,re.TRIANGLES,ge,ce,pe,Mn.backCCW,ot,at,Ye,I.id,ke,Re,be.segments,I.paint,E.transform.zoom,Pe)}})(a,u,f,g,w):o.co(f)?(function(E,S,I,k,P){if(I.paint.get("heatmap-opacity")===0)return;let B=E.context,{isRenderingToTexture:L,isRenderingGlobe:$}=P;if(E.style.map.terrain){for(let Y of k){let ie=S.getTile(Y);S.hasRenderableParent(Y)||(E.renderPass==="offscreen"?Iw(E,ie,I,Y,$):E.renderPass==="translucent"&&Mw(E,I,Y,L,$))}B.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?(function(Y,ie,oe,re){let ue=Y.context,ge=ue.gl,ce=Y.transform,pe=Rn.disabled,ve=new ti([ge.ONE,ge.ONE],o.bp.transparent,[!0,!0,!0,!0]);(function(he,be,Pe){let Ae=he.gl;he.activeTexture.set(Ae.TEXTURE1),he.viewport.set([0,0,be.width/4,be.height/4]);let ke=Pe.heatmapFbos.get(o.cd);ke?(Ae.bindTexture(Ae.TEXTURE_2D,ke.colorAttachment.get()),he.bindFramebuffer.set(ke.framebuffer)):(ke=Hh(he,be.width/4,be.height/4),Pe.heatmapFbos.set(o.cd,ke))})(ue,Y,oe),ue.clear({color:o.bp.transparent});for(let he=0;he<re.length;he++){let be=re[he];if(ie.hasRenderableParent(be))continue;let Pe=ie.getTile(be),Ae=Pe.getBucket(oe);if(!Ae)continue;let ke=Ae.programConfigurations.get(oe.id),Re=Y.useProgram("heatmap",ke),ot=ce.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),at=ce.getCircleRadiusCorrection();Re.draw(ue,ge.TRIANGLES,dn.disabled,pe,ve,Mn.backCCW,od(Pe,ce.zoom,oe.paint.get("heatmap-intensity"),at),null,ot,oe.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,oe.paint,ce.zoom,ke)}ue.viewport.set([0,0,Y.width,Y.height])})(E,S,I,k):E.renderPass==="translucent"&&(function(Y,ie){let oe=Y.context,re=oe.gl;oe.setColorMode(Y.colorModeForRenderPass());let ue=ie.heatmapFbos.get(o.cd);ue&&(oe.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,ue.colorAttachment.get()),oe.activeTexture.set(re.TEXTURE1),am(oe,ie).bind(re.LINEAR,re.CLAMP_TO_EDGE),Y.useProgram("heatmapTexture").draw(oe,re.TRIANGLES,dn.disabled,Rn.disabled,Y.colorModeForRenderPass(),Mn.disabled,mw(Y,ie,0,1),null,null,ie.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments,ie.paint,Y.transform.zoom))})(E,I)})(a,u,f,g,w):o.cp(f)?(function(E,S,I,k,P){if(E.renderPass!=="translucent")return;let{isRenderingToTexture:B}=P,L=I.paint.get("line-opacity"),$=I.paint.get("line-width");if(L.constantOr(1)===0||$.constantOr(1)===0)return;let Y=E.getDepthModeForSublayer(0,dn.ReadOnly),ie=E.colorModeForRenderPass(),oe=I.paint.get("line-dasharray"),re=oe.constantOr(1),ue=I.paint.get("line-pattern"),ge=ue.constantOr(1),ce=I.paint.get("line-gradient"),pe=I.getCrossfadeParameters(),ve;ve=ge?"linePattern":re&&ce?"lineGradientSDF":re?"lineSDF":ce?"lineGradient":"line";let he=E.context,be=he.gl,Pe=E.transform,Ae=!0;for(let ke of k){let Re=S.getTile(ke);if(ge&&!Re.patternsLoaded())continue;let ot=Re.getBucket(I);if(!ot)continue;let at=ot.programConfigurations.get(I.id),Ye=E.context.program.get(),dt=E.useProgram(ve,at),Yt=Ae||dt.program!==Ye,Hn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ke),yi=ue.constantOr(null),ni=oe&&oe.constantOr(null);if(yi&&Re.imageAtlas){let $r=Re.imageAtlas,hr=$r.patternPositions[yi.to.toString()],rr=$r.patternPositions[yi.from.toString()];hr&&rr&&at.setConstantPatternPositions(hr,rr)}else if(ni){let $r=I.layout.get("line-cap")==="round",hr=E.lineAtlas.getDash(ni.to,$r),rr=E.lineAtlas.getDash(ni.from,$r);at.setConstantDashPositions(hr,rr)}let Di=Pe.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),ii=Pe.getPixelScale(),Zi;ge?(Zi=Y_(E,Re,I,ii,pe),kw(he,be,Re,at,pe)):re&&ce?(Zi=Wp(E,Re,I,ii,pe,ot.lineClipsArray.length),hs(E,S,he,be,I,ot,ke,at,pe)):re?(Zi=yw(E,Re,I,ii,pe),nr(E,he,be,at,Yt,pe)):ce?(Zi=_w(E,Re,I,ii,ot.lineClipsArray.length),Gc(E,S,he,be,I,ot,ke)):Zi=Lh(E,Re,I,ii);let Ii=E.stencilModeForClipping(ke);dt.draw(he,be.TRIANGLES,Y,Ii,ie,Mn.disabled,Zi,Hn,Di,I.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,I.paint,E.transform.zoom,at,ot.layoutVertexBuffer2),Ae=!1}})(a,u,f,g,w):o.cq(f)?(function(E,S,I,k,P){let B=I.paint.get("fill-color"),L=I.paint.get("fill-opacity");if(L.constantOr(1)===0)return;let{isRenderingToTexture:$}=P,Y=E.colorModeForRenderPass(),ie=I.paint.get("fill-pattern"),oe=E.opaquePassEnabledForLayer()&&!ie.constantOr(1)&&B.constantOr(o.bp.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===oe){let re=E.getDepthModeForSublayer(1,E.renderPass==="opaque"?dn.ReadWrite:dn.ReadOnly);Gh(E,S,I,k,re,Y,!1,$)}if(E.renderPass==="translucent"&&I.paint.get("fill-antialias")){let re=E.getDepthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,dn.ReadOnly);Gh(E,S,I,k,re,Y,!0,$)}})(a,u,f,g,w):o.cr(f)?(function(E,S,I,k,P){let B=I.paint.get("fill-extrusion-opacity");if(B===0)return;let{isRenderingToTexture:L}=P;if(E.renderPass==="translucent"){let $=new dn(E.context.gl.LEQUAL,dn.ReadWrite,E.depthRangeFor3D);if(B!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))cm(E,S,I,k,$,Rn.disabled,ti.disabled,L),cm(E,S,I,k,$,E.stencilModeFor3D(),E.colorModeForRenderPass(),L);else{let Y=E.colorModeForRenderPass();cm(E,S,I,k,$,Rn.disabled,Y,L)}}})(a,u,f,g,w):o.cs(f)?(function(E,S,I,k,P){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;let{isRenderingToTexture:B}=P,L=E.context,$=E.style.projection.useSubdivision,Y=E.getDepthModeForSublayer(0,dn.ReadOnly),ie=E.colorModeForRenderPass();if(E.renderPass==="offscreen")(function(oe,re,ue,ge,ce,pe,ve){let he=oe.context,be=he.gl;for(let Pe of ue){let Ae=re.getTile(Pe),ke=Ae.dem;if(!ke||!ke.data||!Ae.needsHillshadePrepare)continue;let Re=ke.dim,ot=ke.stride,at=ke.getPixels();if(he.activeTexture.set(be.TEXTURE1),he.pixelStoreUnpackPremultiplyAlpha.set(!1),Ae.demTexture=Ae.demTexture||oe.getTileTexture(ot),Ae.demTexture){let dt=Ae.demTexture;dt.update(at,{premultiply:!1}),dt.bind(be.NEAREST,be.CLAMP_TO_EDGE)}else Ae.demTexture=new o.T(he,at,be.RGBA,{premultiply:!1}),Ae.demTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE);he.activeTexture.set(be.TEXTURE0);let Ye=Ae.fbo;if(!Ye){let dt=new o.T(he,{width:Re,height:Re,data:null},be.RGBA);dt.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ye=Ae.fbo=he.createFramebuffer(Re,Re,!0,!1),Ye.colorAttachment.set(dt.texture)}he.bindFramebuffer.set(Ye.framebuffer),he.viewport.set([0,0,Re,Re]),oe.useProgram("hillshadePrepare").draw(he,be.TRIANGLES,ce,pe,ve,Mn.disabled,vD(Ae.tileID,ke),null,null,ge.id,oe.rasterBoundsBuffer,oe.quadTriangleIndexBuffer,oe.rasterBoundsSegments),Ae.needsHillshadePrepare=!1}})(E,S,k,I,Y,Rn.disabled,ie),L.viewport.set([0,0,E.width,E.height]);else if(E.renderPass==="translucent")if($){let[oe,re,ue]=E.stencilConfigForOverlapTwoPass(k);$l(E,S,I,ue,oe,Y,ie,!1,B),$l(E,S,I,ue,re,Y,ie,!0,B)}else{let[oe,re]=E.getStencilConfigForOverlapAndUpdateStencilID(k);$l(E,S,I,re,oe,Y,ie,!1,B)}})(a,u,f,g,w):o.ct(f)?(function(E,S,I,k,P){if(E.renderPass!=="translucent"||!k.length)return;let{isRenderingToTexture:B}=P,L=E.style.projection.useSubdivision,$=E.getDepthModeForSublayer(0,dn.ReadOnly),Y=E.colorModeForRenderPass();if(L){let[ie,oe,re]=E.stencilConfigForOverlapTwoPass(k);qh(E,S,I,re,ie,$,Y,!1,B),qh(E,S,I,re,oe,$,Y,!0,B)}else{let[ie,oe]=E.getStencilConfigForOverlapAndUpdateStencilID(k);qh(E,S,I,oe,ie,$,Y,!1,B)}})(a,u,f,g,w):o.bU(f)?(function(E,S,I,k,P){if(E.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!k.length)return;let{isRenderingToTexture:B}=P,L=S.getSource(),$=E.style.projection.useSubdivision;if(L instanceof cs)ud(E,S,I,k,null,!1,!1,L.tileCoords,L.flippedWindingOrder,B);else if($){let[Y,ie,oe]=E.stencilConfigForOverlapTwoPass(k);ud(E,S,I,oe,Y,!1,!0,qc,!1,B),ud(E,S,I,oe,ie,!0,!0,qc,!1,B)}else{let[Y,ie]=E.getStencilConfigForOverlapAndUpdateStencilID(k);ud(E,S,I,ie,Y,!1,!0,qc,!1,B)}})(a,u,f,g,w):o.cu(f)?(function(E,S,I,k,P){let B=I.paint.get("background-color"),L=I.paint.get("background-opacity");if(L===0)return;let{isRenderingToTexture:$}=P,Y=E.context,ie=Y.gl,oe=E.style.projection,re=E.transform,ue=re.tileSize,ge=I.paint.get("background-pattern");if(E.isPatternMissing(ge))return;let ce=!ge&&B.a===1&&L===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==ce)return;let pe=Rn.disabled,ve=E.getDepthModeForSublayer(0,ce==="opaque"?dn.ReadWrite:dn.ReadOnly),he=E.colorModeForRenderPass(),be=E.useProgram(ge?"backgroundPattern":"background"),Pe=k||hi(re,{tileSize:ue,terrain:E.style.map.terrain});ge&&(Y.activeTexture.set(ie.TEXTURE0),E.imageManager.bind(E.context));let Ae=I.getCrossfadeParameters();for(let ke of Pe){let Re=re.getProjectionData({overscaledTileID:ke,applyGlobeMatrix:!$,applyTerrainMatrix:!0}),ot=ge?wD(L,E,ge,{tileID:ke,tileSize:ue},Ae):ey(L,B),at=E.style.map.terrain&&E.style.map.terrain.getTerrainData(ke),Ye=oe.getMeshFromTileID(Y,ke.canonical,!1,!0,"raster");be.draw(Y,ie.TRIANGLES,ve,pe,he,Mn.backCCW,ot,at,Re,I.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}})(a,0,f,g,w):o.cv(f)&&(function(E,S,I,k){let{isRenderingGlobe:P}=k,B=E.context,L=I.implementation,$=E.style.projection,Y=E.transform,ie=Y.getProjectionDataForCustomLayer(P),oe={farZ:Y.farZ,nearZ:Y.nearZ,fov:Y.fov*Math.PI/180,modelViewProjectionMatrix:Y.modelViewProjectionMatrix,projectionMatrix:Y.projectionMatrix,shaderData:{variantName:$.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${$.shaderPreludeCode.vertexSource}`,define:$.shaderDefine},defaultProjectionData:ie},re=L.renderingMode?L.renderingMode:"2d";if(E.renderPass==="offscreen"){let ue=L.prerender;ue&&(E.setCustomLayerDefaults(),B.setColorMode(E.colorModeForRenderPass()),ue.call(L,B.gl,oe),B.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),B.setColorMode(E.colorModeForRenderPass()),B.setStencilMode(Rn.disabled);let ue=re==="3d"?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,dn.ReadOnly);B.setDepthMode(ue),L.render(B.gl,oe),B.setDirty(),E.setBaseState(),B.bindFramebuffer.set(null)}})(a,0,f,w))}saveTileTexture(a){let u=this._tileTextures[a.size[0]];u?u.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){let u=this._tileTextures[a];return u&&u.length>0?u.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;let u=this.imageManager.getPattern(a.from.toString()),f=this.imageManager.getPattern(a.to.toString());return!u||!f}useProgram(a,u,f=!1,g=[]){this.cache=this.cache||{};let w=!!this.style.map.terrain,E=this.style.projection,S=f?Oi.projectionMercator:E.shaderPreludeCode,I=f?Ro:E.shaderDefine,k=a+(u?u.cacheKey:"")+`/${f?ds:E.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(w?"/terrain":"")+(g?`/${g.join("/")}`:"");return this.cache[k]||(this.cache[k]=new cw(this.context,Oi[a],u,xD[a],this._showOverdrawInspector,w,S,I,g)),this.cache[k]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var a,u;if(this._tileTextures){for(let f in this._tileTextures){let g=this._tileTextures[f];if(g)for(let w of g)w.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((a=this.tileExtentMesh.vertexBuffer)===null||a===void 0||a.destroy()),this.tileExtentMesh&&((u=this.tileExtentMesh.indexBuffer)===null||u===void 0||u.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(let f in this.cache){let g=this.cache[f];g&&g.program&&this.context.gl.deleteProgram(g.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){let{drawingBufferWidth:a,drawingBufferHeight:u}=this.context.gl;return this.width!==a||this.height!==u}}function hy(v,a){let u,f=!1,g=null,w=null,E=()=>{g=null,f&&(v.apply(w,u),g=setTimeout(E,a),f=!1)};return(...S)=>(f=!0,w=this,u=S,g||E(),g)}class fy{constructor(a){this._getCurrentHash=()=>{let u=window.location.hash.replace("#","");if(this._hashName){let f;return u.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(f=g)}),(f&&f[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{let u=this._getCurrentHash();if(!this._isValidHash(u))return!1;let f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:f,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{let u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{let u=this._getCurrentHash();if(u.length===0)return;let f=u.join("/"),g=f;g.split("&").length>0&&(g=g.split("&")[0]),this._hashName&&(g=`${this._hashName}=${f}`);let w=window.location.hash.replace(g,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let E=window.location.href.replace(/(#.+)?$/,w);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=hy(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(a){let u=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,g),E=Math.round(u.lng*w)/w,S=Math.round(u.lat*w)/w,I=this._map.getBearing(),k=this._map.getPitch(),P="";if(P+=a?`/${E}/${S}/${f}`:`${f}/${S}/${E}`,(I||k)&&(P+="/"+Math.round(10*I)/10),k&&(P+=`/${Math.round(k)}`),this._hashName){let B=this._hashName,L=!1,$=window.location.hash.slice(1).split("&").map(Y=>{let ie=Y.split("=")[0];return ie===B?(L=!0,`${ie}=${P}`):Y}).filter(Y=>Y);return L||$.push(`${B}=${P}`),`#${$.join("&")}`}return`#${P}`}_isValidHash(a){if(a.length<3||a.some(isNaN))return!1;try{new o.V(+a[2],+a[1])}catch(w){return!1}let u=+a[0],f=+(a[3]||0),g=+(a[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&f>=-180&&f<=180&&g>=this._map.getMinPitch()&&g<=this._map.getMaxPitch()}}let Gl={linearity:.3,easing:o.cw(0,0,.3,1)},Vw=o.e({deceleration:2500,maxSpeed:1400},Gl),Ps=o.e({deceleration:20,maxSpeed:1400},Gl),Zs=o.e({deceleration:1e3,maxSpeed:360},Gl),jw=o.e({deceleration:1e3,maxSpeed:90},Gl),Ks=o.e({deceleration:1e3,maxSpeed:360},Gl);class kD{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J(),settings:a})}_drainInertiaBuffer(){let a=this._inertiaBuffer,u=J();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let u={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:w}of this._inertiaBuffer)u.zoom+=w.zoomDelta||0,u.bearing+=w.bearingDelta||0,u.pitch+=w.pitchDelta||0,u.roll+=w.rollDelta||0,w.panDelta&&u.pan._add(w.panDelta),w.around&&(u.around=w.around),w.pinchAround&&(u.pinchAround=w.pinchAround);let f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(u.pan.mag()){let w=Kh(u.pan.mag(),f,o.e({},Vw,a||{})),E=u.pan.mult(w.amount/u.pan.mag()),S=this._map.cameraHelper.handlePanInertia(E,this._map.transform);g.center=S.easingCenter,g.offset=S.easingOffset,Zh(g,w)}if(u.zoom){let w=Kh(u.zoom,f,Ps),E=o.cx(this._map.transform.zoom+w.amount,this._map.getZoomSnap(),w.amount);g.zoom=E,Zh(g,w)}if(u.bearing){let w=Kh(u.bearing,f,Zs);g.bearing=this._map.transform.bearing+o.an(w.amount,-179,179),Zh(g,w)}if(u.pitch){let w=Kh(u.pitch,f,jw);g.pitch=this._map.transform.pitch+w.amount,Zh(g,w)}if(u.roll){let w=Kh(u.roll,f,Ks);g.roll=this._map.transform.roll+o.an(w.amount,-179,179),Zh(g,w)}if(g.zoom||g.bearing){let w=u.pinchAround===void 0?u.around:u.pinchAround;g.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),o.e(g,{noMoveStart:!0})}}function Zh(v,a){(!v.duration||v.duration<a.duration)&&(v.duration=a.duration,v.easing=a.easing)}function Kh(v,a,u){let{maxSpeed:f,linearity:g,deceleration:w}=u,E=o.an(v*g/(a/1e3),-f,f),S=Math.abs(E)/(w*g);return{easing:u.easing,duration:1e3*S,amount:E*(S/2)}}class Ur extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,f,g={}){f=f instanceof MouseEvent?f:new MouseEvent(a,f);let w=K.mousePos(u.getCanvas(),f),E=u.unproject(w);super(a,o.e({point:w,lngLat:E,originalEvent:f},g)),this._defaultPrevented=!1,this.target=u}}class Yh extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,f){let g=a==="touchend"?f.changedTouches:f.touches,w=K.touchPos(u.getCanvasContainer(),g),E=w.map(I=>u.unproject(I)),S=w.reduce((I,k,P,B)=>I.add(k.div(B.length)),new o.P(0,0));super(a,{points:w,point:S,lngLats:E,lngLat:u.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class zw extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,f){super(a,{originalEvent:f}),this._defaultPrevented=!1}}class RD{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new zw(a.type,this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new Ur(a.type,this._map,a))}mouseup(a){this._map.fire(new Ur(a.type,this._map,a))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Ur(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Ur(a.type,this._map,a))}mouseover(a){this._map.fire(new Ur(a.type,this._map,a))}mouseout(a){this._map.fire(new Ur(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Yh(a.type,this._map,a))}touchmove(a){this._map.fire(new Yh(a.type,this._map,a))}touchend(a){this._map.fire(new Yh(a.type,this._map,a))}touchcancel(a){this._map.fire(new Yh(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class PD{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Ur(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Ur(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dd{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.screenPointToLocation(o.P.convert(a),this._map.terrain)}}class hd{constructor(a,u){this._map=a,this._tr=new dd(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&a.button===0&&(K.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;let f=u;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;let g=this._startPos;this._lastPos=f,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));let w=Math.min(g.x,f.x),E=Math.max(g.x,f.x),S=Math.min(g.y,f.y),I=Math.max(g.y,f.y);K.setTransform(this._box,`translate(${w}px,${S}px)`),this._box.style.width=E-w+"px",this._box.style.height=I-S+"px"}mouseupWindow(a,u){if(!this._active||a.button!==0)return;let f=this._startPos,g=u;if(this.reset(),K.suppressClick(),f.x!==g.x||f.y!==g.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:a})),{cameraAnimation:w=>w.fitScreenCoordinates(f,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new o.l(a,{originalEvent:u}))}}function Ys(v,a){if(v.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${a.length}`);let u={};for(let f=0;f<v.length;f++)u[v[f].identifier]=a[f];return u}class wt{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,u,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),f.length===this.numTouches&&(this.centroid=(function(g){let w=new o.P(0,0);for(let E of g)w._add(E);return w.div(g.length)})(u),this.touches=Ys(f,u)))}touchmove(a,u,f){if(this.aborted||!this.centroid)return;let g=Ys(f,u);for(let w in this.touches){let E=g[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(a,u,f){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){let g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class um{constructor(a){this.singleTap=new wt(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,u,f){this.singleTap.touchstart(a,u,f)}touchmove(a,u,f){this.singleTap.touchmove(a,u,f)}touchend(a,u,f){let g=this.singleTap.touchend(a,u,f);if(g){let w=a.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(w&&E||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class py{constructor(a){this._tr=new dd(a),this._zoomIn=new um({numTouches:1,numTaps:2}),this._zoomOut=new um({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,f){this._zoomIn.touchstart(a,u,f),this._zoomOut.touchstart(a,u,f)}touchmove(a,u,f){this._zoomIn.touchmove(a,u,f),this._zoomOut.touchmove(a,u,f)}touchend(a,u,f){let g=this._zoomIn.touchend(a,u,f),w=this._zoomOut.touchend(a,u,f),E=this._tr;return g?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:o.cx(E.zoom+1,S.getZoomSnap()),around:E.unproject(g)},{originalEvent:a})}):w?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:o.cx(E.zoom-1,S.getZoomSnap()),around:E.unproject(w)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fd{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(...a){let u=this._moveFunction(...a);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(a,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,u){if(!this.isEnabled())return;let f=this._lastPoint;if(!f)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);let g=Array.isArray(u)?u[0]:u;return!this._moved&&g.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(f,g))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&K.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let Xh=0,Qh=2,my={[Xh]:1,[Qh]:2};class Jh{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){let u=K.mouseButton(a);this._eventButton=u}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!(function(u,f){let g=my[f];return u.buttons===void 0||(u.buttons&g)!==g})(a,this._eventButton)}isValidEndEvent(a){return K.mouseButton(a)===this._eventButton}}class gy{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}class Uw{constructor(a=new Jh({checkCorrectEvent:()=>!0}),u=new gy){this.mouseMoveStateManager=a,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(a,u,f){return a instanceof MouseEvent?u(a):typeof TouchEvent<"u"&&a instanceof TouchEvent?f(a):void 0}startMove(a){this._executeRelevantHandler(a,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(a){this._executeRelevantHandler(a,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(a){return this._executeRelevantHandler(a,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(a){return this._executeRelevantHandler(a,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(a){return this._executeRelevantHandler(a,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}let pd=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=a=>{a.preventDefault()}};class ND{constructor(a,u){this._clickTolerance=a.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(a){return a<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(a,u,f){return this._calculateTransform(a,u,f)}touchmove(a,u,f){if(this._active){if(!this._shouldBePrevented(f.length))return a.preventDefault(),this._calculateTransform(a,u,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",a)}}touchend(a,u,f){this._calculateTransform(a,u,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,f){f.length>0&&(this._active=!0);let g=Ys(f,u),w=new o.P(0,0),E=new o.P(0,0),S=0;for(let k in g){let P=g[k],B=this._touches[k];B&&(w._add(P),E._add(P.sub(B)),S++,g[k]=P)}if(this._touches=g,this._shouldBePrevented(S)||!E.mag())return;let I=E.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(S),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dm{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,u,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,f){if(!this._firstTwoTouches)return;a.preventDefault();let[g,w]=this._firstTwoTouches,E=hm(f,u,g),S=hm(f,u,w);if(!E||!S)return;let I=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],I,a)}touchend(a,u,f){if(!this._firstTwoTouches)return;let[g,w]=this._firstTwoTouches,E=hm(f,u,g),S=hm(f,u,w);E&&S||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function hm(v,a,u){for(let f=0;f<v.length;f++)if(v[f].identifier===u)return a[f]}function $w(v,a){return Math.log(v/a)/Math.LN2}class _y extends dm{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){let f=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs($w(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$w(this._distance,f),pinchAround:u}}}function Hw(v,a){return 180*v.angleWith(a)/Math.PI}class yy extends dm{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u,f){let g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hw(this._vector,g),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());let u=25/(Math.PI*this._minDiameter)*360,f=Hw(a,this._startVector);return Math.abs(f)<u}}function vy(v){return Math.abs(v.y)>Math.abs(v.x)}class Gw extends dm{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,u,f){super.touchstart(a,u,f),this._currentTouchCount=f.length}_start(a){this._lastPoints=a,vy(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let g=a[0].sub(this._lastPoints[0]),w=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,w,f.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(g.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(a,u,f){if(this._valid!==void 0)return this._valid;let g=a.mag()>=2,w=u.mag()>=2;if(!g&&!w)return;if(!g||!w)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;let E=a.y>0==u.y>0;return vy(a)&&vy(u)&&E}}let ql={panStep:100,bearingStep:15,pitchStep:10};class Xn{constructor(a){this._tr=new dd(a);let u=ql;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,f=0,g=0,w=0,E=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?f=-1:(a.preventDefault(),w=-1);break;case 39:a.shiftKey?f=1:(a.preventDefault(),w=1);break;case 38:a.shiftKey?g=1:(a.preventDefault(),E=-1);break;case 40:a.shiftKey?g=-1:(a.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:S=>{let I=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:OD,zoom:u?o.cx(I.zoom+u*(a.shiftKey?2:1),S.getZoomSnap()):I.zoom,bearing:I.bearing+f*this._bearingStep,pitch:I.pitch+g*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:I.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function OD(v){return v*(2-v)}let ef=4.000244140625,fm=1/450;class pm{constructor(a,u){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=a,this._tr=new dd(a),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fm}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(a){return!!this._map.cooperativeGestures.isEnabled()&&!(a.ctrlKey||this._map.cooperativeGestures.isBypassed(a))}wheel(a){if(!this.isEnabled())return;if(this._shouldBePrevented(a))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",a);let u=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY,f=J(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,u!==0&&u%ef==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(g*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let u=K.mousePos(this._map.getCanvas(),a),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(o.V.convert(f.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let a=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let S=a.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){let S=this._type==="wheel"&&Math.abs(this._delta)>ef?this._wheelZoomRate:this._defaultZoomRate,I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);let k=typeof this._targetZoom!="number"?a.scale:o.aq(this._targetZoom),P=a.applyConstrain(a.getCameraLngLat(),o.at(k*I)).zoom,B=this._map.getZoomSnap();if(this._type==="wheel"&&B>0){let L=o.cx(a.zoom,B);this._targetZoom=o.cx(P,B,P-L)}else this._targetZoom=P;this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let u=typeof this._targetZoom!="number"?a.zoom:this._targetZoom,f=this._startZoom,g=this._easing,w,E=!1;if(this._type==="wheel"&&f&&g){let S=J()-this._lastWheelEventTime,I=Math.min((S+5)/200,1),k=g(I);w=o.G.number(f,u,k),I<1?this._frameId||(this._frameId=!0):E=!0}else w=u,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=w,{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=o.cz;if(this._prevEase){let f=this._prevEase,g=(J()-f.start)/f.duration,w=f.easing(g+.01)-f.easing(g),E=.27/Math.sqrt(w*w+1e-4)*.01,S=Math.sqrt(.0729-E*E);u=o.cw(E,S,.25,1)}return this._prevEase={start:J(),duration:a,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class by{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qw{constructor(a){this._tr=new dd(a),this.reset()}reset(){this._active=!1}dblclick(a,u){return a.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:o.cx(this._tr.zoom+(a.shiftKey?-1:1),f.getZoomSnap()),around:this._tr.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ww{constructor(){this._tap=new um({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,u,f){if(!this._swipePoint)if(this._tapTime){let g=u[0],w=a.timeStamp-this._tapTime<500,E=this._tapPoint.dist(g)<30;w&&E?f.length>0&&(this._swipePoint=g,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(a,u,f)}touchmove(a,u,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;let g=u[0],w=g.y-this._swipePoint.y;return this._swipePoint=g,a.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(a,u,f)}touchend(a,u,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{let g=this._tap.touchend(a,u,f);g&&(this._tapTime=a.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zw{constructor(a,u,f){this._el=a,this._mousePan=u,this._touchPan=f}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xs{constructor(a,u,f,g){this._pitchWithRotate=a.pitchWithRotate,this._rollEnabled=a.rollEnabled,this._mouseRotate=u,this._mousePitch=f,this._mouseRoll=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class tf{constructor(a,u,f,g){this._el=a,this._touchZoom=u,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class It{constructor(a,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",a);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=u,this._container.appendChild(g);let w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=f,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(a){return a[this._bypassKey]}notifyGestureBlocked(a,u){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:a,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let Vt=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class nf extends o.l{}function mm(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class gm{get _ownerDocument(){var a;return((a=this._el)===null||a===void 0?void 0:a.ownerDocument)||document}get _ownerWindow(){var a,u;return((u=(a=this._el)===null||a===void 0?void 0:a.ownerDocument)===null||u===void 0?void 0:u.defaultView)||window}constructor(a,u){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,w)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let E=g.type==="renderFrame"?void 0:g,S={needsRenderFrame:!1},I={},k={};for(let{handlerName:L,handler:$,allowed:Y}of this._handlers){if(!$.isEnabled())continue;let ie;if(this._blockedByActive(k,Y,L))$.reset();else if($[w||g.type]){if(o.cA(g,w||g.type)){let oe=K.mousePos(this._map.getCanvas(),g);ie=$[w||g.type](g,oe)}else if(o.cB(g,w||g.type)){let oe=this._getMapTouches(g.touches),re=K.touchPos(this._map.getCanvas(),oe);ie=$[w||g.type](g,re,oe)}else o.cC(w||g.type)||(ie=$[w||g.type](g));this.mergeHandlerResult(S,I,ie,L,E),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()}(ie||$.isActive())&&(k[L]=$)}let P={};for(let L in this._previousActiveHandlers)k[L]||(P[L]=E);this._previousActiveHandlers=k,(Object.keys(P).length||mm(S))&&(this._changes.push([S,I,P]),this._triggerRenderFrame()),(Object.keys(k).length||mm(S))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:B}=S;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kD(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);let f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[this._ownerDocument,"mousemove",{capture:!0}],[this._ownerDocument,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[this._ownerWindow,"blur",void 0]];for(let[g,w,E]of this._listeners)K.addEventListener(g,w,g===this._ownerDocument?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(let[a,u,f]of this._listeners)K.removeEventListener(a,u,a===this._ownerDocument?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(a){let u=this._map,f=u.getCanvasContainer();this._add("mapEvent",new RD(u,a));let g=u.boxZoom=new hd(u,a);this._add("boxZoom",g),a.interactive&&a.boxZoom&&g.enable();let w=u.cooperativeGestures=new It(u,a.cooperativeGestures);this._add("cooperativeGestures",w),a.cooperativeGestures&&w.enable();let E=new py(u),S=new qw(u);u.doubleClickZoom=new by(S,E),this._add("tapZoom",E),this._add("clickZoom",S),a.interactive&&a.doubleClickZoom&&u.doubleClickZoom.enable();let I=new Ww;this._add("tapDragZoom",I);let k=u.touchPitch=new Gw(u);this._add("touchPitch",k),a.interactive&&a.touchPitch&&u.touchPitch.enable(a.touchPitch);let P=()=>u.project(u.getCenter()),B=(function({enable:ce,clickTolerance:pe,aroundCenter:ve=!0,minPixelCenterThreshold:he=100,rotateDegreesPerPixelMoved:be=.8},Pe){let Ae=new Jh({checkCorrectEvent:ke=>K.mouseButton(ke)===0&&ke.ctrlKey||K.mouseButton(ke)===2&&!ke.ctrlKey});return new fd({clickTolerance:pe,move:(ke,Re)=>{let ot=Pe();if(ve&&Math.abs(ot.y-ke.y)>he)return{bearingDelta:o.cy(new o.P(ke.x,Re.y),Re,ot)};let at=(Re.x-ke.x)*be;return ve&&Re.y<ot.y&&(at=-at),{bearingDelta:at}},moveStateManager:Ae,enable:ce,assignEvents:pd})})(a,P),L=(function({enable:ce,clickTolerance:pe,pitchDegreesPerPixelMoved:ve=-.5}){let he=new Jh({checkCorrectEvent:be=>K.mouseButton(be)===0&&be.ctrlKey||K.mouseButton(be)===2});return new fd({clickTolerance:pe,move:(be,Pe)=>({pitchDelta:(Pe.y-be.y)*ve}),moveStateManager:he,enable:ce,assignEvents:pd})})(a),$=(function({enable:ce,clickTolerance:pe,rollDegreesPerPixelMoved:ve=.3},he){let be=new Jh({checkCorrectEvent:Pe=>K.mouseButton(Pe)===2&&Pe.ctrlKey});return new fd({clickTolerance:pe,move:(Pe,Ae)=>{let ke=he(),Re=(Ae.x-Pe.x)*ve;return Ae.y<ke.y&&(Re=-Re),{rollDelta:Re}},moveStateManager:be,enable:ce,assignEvents:pd})})(a,P);u.dragRotate=new Xs(a,B,L,$),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",$,["mousePitch"]),a.interactive&&a.dragRotate&&u.dragRotate.enable();let Y=(function({enable:ce,clickTolerance:pe}){let ve=new Jh({checkCorrectEvent:he=>K.mouseButton(he)===0&&!he.ctrlKey});return new fd({clickTolerance:pe,move:(he,be)=>({around:be,panDelta:be.sub(he)}),activateOnStart:!0,moveStateManager:ve,enable:ce,assignEvents:pd})})(a),ie=new ND(a,u);u.dragPan=new Zw(f,Y,ie),this._add("mousePan",Y),this._add("touchPan",ie,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&u.dragPan.enable(a.dragPan);let oe=new yy,re=new _y;u.touchZoomRotate=new tf(f,re,oe,I),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&u.touchZoomRotate.enable(a.touchZoomRotate),this._add("blockableMapEvent",new PD(u));let ue=u.scrollZoom=new pm(u,()=>this._triggerRenderFrame());this._add("scrollZoom",ue,["mousePan"]),a.interactive&&a.scrollZoom&&u.scrollZoom.enable(a.scrollZoom);let ge=u.keyboard=new Xn(u);this._add("keyboard",ge),a.interactive&&a.keyboard&&u.keyboard.enable()}_add(a,u,f){this._handlers.push({handlerName:a,handler:u,allowed:f}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(let{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(let{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vt(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,u,f){for(let g in a)if(g!==f&&(!u||u.indexOf(g)<0))return!0;return!1}_getMapTouches(a){let u=[];for(let f of a)this._el.contains(f.target)&&u.push(f);return u}mergeHandlerResult(a,u,f,g,w){if(!f)return;o.e(a,f);let E={handlerName:g,originalEvent:f.originalEvent||w};f.zoomDelta!==void 0&&(u.zoom=E),f.panDelta!==void 0&&(u.drag=E),f.rollDelta!==void 0&&(u.roll=E),f.pitchDelta!==void 0&&(u.pitch=E),f.bearingDelta!==void 0&&(u.rotate=E)}_applyChanges(){let a={},u={},f={};for(let[g,w,E]of this._changes)g.panDelta&&(a.panDelta=(a.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+g.pitchDelta),g.rollDelta&&(a.rollDelta=(a.rollDelta||0)+g.rollDelta),g.around!==void 0&&(a.around=g.around),g.pinchAround!==void 0&&(a.pinchAround=g.pinchAround),g.noInertia&&(a.noInertia=g.noInertia),o.e(u,w),o.e(f,E);this._updateMapTransform(a,u,f),this._changes=[]}_updateMapTransform(a,u,f){let g=this._map,w=g._getTransformForUpdate(),E=g.terrain;if(!(mm(a)||E&&this._terrainMovement))return this._fireEvents(u,f,!0);g._stop(!0);let{panDelta:S,zoomDelta:I,bearingDelta:k,pitchDelta:P,rollDelta:B,around:L,pinchAround:$}=a;$!==void 0&&(L=$),L=L||g.transform.centerPoint,E&&!w.isPointOnMapSurface(L)&&(L=w.centerPoint);let Y={panDelta:S,zoomDelta:I,rollDelta:B,pitchDelta:P,bearingDelta:k,around:L};this._map.cameraHelper.useGlobeControls&&!w.isPointOnMapSurface(L)&&(L=w.centerPoint);let ie=L.distSqr(w.centerPoint)<.01?w.center:w.screenPointToLocation(S?L.sub(S):L);this._handleMapControls({terrain:E,tr:w,deltasForHelper:Y,preZoomAroundLoc:ie,combinedEventsInProgress:u,panDelta:S}),g._applyUpdatedTransform(w),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,f,!0)}_handleMapControls({terrain:a,tr:u,deltasForHelper:f,preZoomAroundLoc:g,combinedEventsInProgress:w,panDelta:E}){let S=this._map.cameraHelper;if(S.handleMapControlsRollPitchBearingZoom(f,u),a)return S.useGlobeControls?(this._terrainMovement||!w.drag&&!w.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void S.handleMapControlsPan(f,u,g)):this._terrainMovement||!w.drag&&!w.zoom?void(w.drag&&this._terrainMovement&&E?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(E))):S.handleMapControlsPan(f,u,g)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void S.handleMapControlsPan(f,u,g));S.handleMapControlsPan(f,u,g)}_fireEvents(a,u,f){let g=Vt(this._eventsInProgress),w=Vt(a),E={};for(let B in a){let{originalEvent:L}=a[B];this._eventsInProgress[B]||(E[`${B}start`]=L),this._eventsInProgress[B]=a[B]}!g&&w&&this._fireEvent("movestart",w.originalEvent);for(let B in E)this._fireEvent(B,E[B]);w&&this._fireEvent("move",w.originalEvent);for(let B in a){let{originalEvent:L}=a[B];this._fireEvent(B,L)}let S={},I;for(let B in this._eventsInProgress){let{handlerName:L,originalEvent:$}=this._eventsInProgress[B];this._handlersById[L].isActive()||(delete this._eventsInProgress[B],I=u[L]||$,S[`${B}end`]=I)}for(let B in S)this._fireEvent(B,S[B]);let k=Vt(this._eventsInProgress),P=(g||w)&&!k;if(P&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(f&&P){this._updatingCamera=!0;let B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!B||!B.essential&&N.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:I})),L(this._map.getBearing())&&this._map.resetNorth()):(L(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new o.l(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new nf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Oo extends o.E{constructor(a,u,f){super(),this._renderFrameCallback=()=>{let g=Math.min((J()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,this._zoomSnap=f.zoomSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(a,u){a.apply(this.transform,!0),this.transform=a,this.cameraHelper=u}getCenter(){return new o.V(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(a,u){return this.jumpTo({elevation:a},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(a){this._centerClampedToGround=a}panBy(a,u,f){return a=o.P.convert(a).mult(-1),this.panTo(this.transform.center,o.e({offset:a},u),f)}panTo(a,u,f){return this.easeTo(o.e({center:a},u),f)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,f){return this.easeTo(o.e({zoom:a},u),f)}zoomIn(a,u){return this.zoomTo(o.cx(this.getZoom()+1,this._zoomSnap),a,u),this}zoomOut(a,u){return this.zoomTo(o.cx(this.getZoom()-1,this._zoomSnap),a,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(a,u){return a!=this.transform.fov&&(this.transform.setFov(a),this.fire(new o.l("movestart",u)).fire(new o.l("move",u)).fire(new o.l("moveend",u))),this}getBearing(){return this.transform.bearing}setZoomSnap(a){return this._zoomSnap=a,this}getZoomSnap(){return this._zoomSnap}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,f){return this.easeTo(o.e({bearing:a},u),f)}resetNorth(a,u){return this.rotateTo(0,o.e({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}getRoll(){return this.transform.roll}setRoll(a,u){return this.jumpTo({roll:a},u),this}cameraForBounds(a,u){a=Ni.convert(a).adjustAntiMeridian();let f=u&&u.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),f,u)}_cameraForBoxAndBearing(a,u,f,g){let w={top:0,bottom:0,right:0,left:0};if(typeof(g=o.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){let k=g.padding;g.padding={top:k,bottom:k,right:k,left:k}}let E=o.e(w,g.padding);g.padding=E;let S=this.transform,I=new Ni(a,u);return this.cameraHelper.cameraForBoxAndBearing(g,E,I,f,S)}fitBounds(a,u,f){return this._fitInternal(this.cameraForBounds(a,u),u,f)}fitScreenCoordinates(a,u,f,g,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(a)),this.transform.screenPointToLocation(o.P.convert(u)),f,g),g,w)}_fitInternal(a,u,f){return a?(delete(u=o.e(a,u)).padding,u.linear?this.easeTo(u,f):this.flyTo(u,f)):this}jumpTo(a,u){this.stop();let f=this._getTransformForUpdate(),g=!1,w=!1,E=!1,S=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,a);let I=f.zoom!==S;return"elevation"in a&&f.elevation!==+a.elevation&&f.setElevation(+a.elevation),"bearing"in a&&f.bearing!==+a.bearing&&(g=!0,f.setBearing(+a.bearing)),"pitch"in a&&f.pitch!==+a.pitch&&(w=!0,f.setPitch(+a.pitch)),"roll"in a&&f.roll!==+a.roll&&(E=!0,f.setRoll(+a.roll)),a.padding==null||f.isPaddingEqual(a.padding)||f.setPadding(a.padding),this._applyUpdatedTransform(f),this.fire(new o.l("movestart",u)).fire(new o.l("move",u)),I&&this.fire(new o.l("zoomstart",u)).fire(new o.l("zoom",u)).fire(new o.l("zoomend",u)),g&&this.fire(new o.l("rotatestart",u)).fire(new o.l("rotate",u)).fire(new o.l("rotateend",u)),w&&this.fire(new o.l("pitchstart",u)).fire(new o.l("pitch",u)).fire(new o.l("pitchend",u)),E&&this.fire(new o.l("rollstart",u)).fire(new o.l("roll",u)).fire(new o.l("rollend",u)),this.fire(new o.l("moveend",u))}calculateCameraOptionsFromTo(a,u,f,g=0){let w=o.a9.fromLngLat(a,u),E=o.a9.fromLngLat(f,g),S=E.x-w.x,I=E.y-w.y,k=E.z-w.z,P=Math.hypot(S,I,k);if(P===0)throw new Error("Can't calculate camera options with same From and To");let B=Math.hypot(S,I),L=o.at(this.transform.cameraToCenterDistance/P/this.transform.tileSize),$=180*Math.atan2(S,-I)/Math.PI,Y=180*Math.acos(B/P)/Math.PI;return Y=k<0?90-Y:90+Y,{center:E.toLngLat(),elevation:g,zoom:L,pitch:Y,bearing:$}}calculateCameraOptionsFromCameraLngLatAltRotation(a,u,f,g,w){let E=this.transform.calculateCenterFromCameraLngLatAlt(a,u,f,g);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:f,pitch:g,roll:w}}easeTo(a,u){this._stop(!1,a.easeId),((a=o.e({offset:[0,0],duration:500,easing:o.cz},a)).animate===!1||!a.essential&&N.prefersReducedMotion)&&(a.duration=0);let f=this._getTransformForUpdate(),g=this.getBearing(),w=f.pitch,E=f.roll,S="bearing"in a?this._normalizeBearing(a.bearing,g):g,I="pitch"in a?+a.pitch:w,k="roll"in a?this._normalizeBearing(a.roll,E):E,P="padding"in a?a.padding:f.padding,B=o.P.convert(a.offset),L,$;a.around&&(L=o.V.convert(a.around),$=f.locationToScreenPoint(L));let Y={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ie=this.cameraHelper.handleEaseTo(f,{bearing:S,pitch:I,roll:k,padding:P,around:L,aroundPoint:$,offsetAsPoint:B,offset:a.offset,zoom:a.zoom,center:a.center});return this._rotating=this._rotating||g!==S,this._pitching=this._pitching||I!==w,this._rolling=this._rolling||k!==E,this._padding=!f.isPaddingEqual(P),this._zooming=this._zooming||ie.isZooming,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,Y),this.terrain&&this._prepareElevation(ie.elevationCenter),this._ease(oe=>{ie.easeFunc(oe),this.terrain&&!a.freezeElevation&&this._updateElevation(oe),this._applyUpdatedTransform(f),this._fireMoveEvents(u)},oe=>{this.terrain&&a.freezeElevation&&this._finalizeElevation(),this._afterEase(u,oe)},a),this}_prepareEase(a,u,f={}){this._moving=!0,u||f.moving||this.fire(new o.l("movestart",a)),this._zooming&&!f.zooming&&this.fire(new o.l("zoomstart",a)),this._rotating&&!f.rotating&&this.fire(new o.l("rotatestart",a)),this._pitching&&!f.pitching&&this.fire(new o.l("pitchstart",a)),this._rolling&&!f.rolling&&this.fire(new o.l("rollstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&u!==this._elevationTarget){let f=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(f-(u-(f*a+this._elevationStart))/(1-a)),this._elevationTarget=u}this.transform.setElevation(o.G.number(this._elevationStart,this._elevationTarget,a))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(a){if(!this.terrain&&a.elevation>=0&&a.pitch<=90)return{};let u=a.getCameraLngLat(),f=a.getCameraAltitude(),g=this.terrain?this.terrain.getElevationForLngLatZoom(u,a.zoom):0;if(f<g){let w=this.calculateCameraOptionsFromTo(u,g,a.center,a.elevation);return{pitch:w.pitch,zoom:w.zoom}}return{}}_applyUpdatedTransform(a){let u=[];if(u.push(g=>this._elevateCameraIfInsideTerrain(g)),this.transformCameraUpdate&&u.push(g=>this.transformCameraUpdate(g)),!u.length)return;let f=a.clone();for(let g of u){let w=f.clone(),{center:E,zoom:S,roll:I,pitch:k,bearing:P,elevation:B}=g(w);E&&w.setCenter(E),B!==void 0&&w.setElevation(B),S!==void 0&&w.setZoom(S),I!==void 0&&w.setRoll(I),k!==void 0&&w.setPitch(k),P!==void 0&&w.setBearing(P),f.apply(w,!1)}this.transform.apply(f,!1)}_fireMoveEvents(a){this.fire(new o.l("move",a)),this._zooming&&this.fire(new o.l("zoom",a)),this._rotating&&this.fire(new o.l("rotate",a)),this._pitching&&this.fire(new o.l("pitch",a)),this._rolling&&this.fire(new o.l("roll",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;let f=this._zooming,g=this._rotating,w=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new o.l("zoomend",a)),g&&this.fire(new o.l("rotateend",a)),w&&this.fire(new o.l("pitchend",a)),E&&this.fire(new o.l("rollend",a)),this.fire(new o.l("moveend",a))}flyTo(a,u){if(!a.essential&&N.prefersReducedMotion){let Re=o.U(a,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Re,u)}this.stop(),a=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.cz},a);let f=this._getTransformForUpdate(),g=f.bearing,w=f.pitch,E=f.roll,S=f.padding,I="bearing"in a?this._normalizeBearing(a.bearing,g):g,k="pitch"in a?+a.pitch:w,P="roll"in a?this._normalizeBearing(a.roll,E):E,B="padding"in a?a.padding:f.padding,L=o.P.convert(a.offset),$=f.centerPoint.add(L),Y=f.screenPointToLocation($),ie=this.cameraHelper.handleFlyTo(f,{bearing:I,pitch:k,roll:P,padding:B,locationAtOffset:Y,offsetAsPoint:L,center:a.center,minZoom:a.minZoom,zoom:a.zoom}),oe=a.curve,re=Math.max(f.width,f.height),ue=re/ie.scaleOfZoom,ge=ie.pixelPathLength;typeof ie.scaleOfMinZoom=="number"&&(oe=Math.sqrt(re/ie.scaleOfMinZoom/ge*2));let ce=oe*oe;function pe(Re){let ot=(ue*ue-re*re+(Re?-1:1)*ce*ce*ge*ge)/(2*(Re?ue:re)*ce*ge);return Math.log(Math.sqrt(ot*ot+1)-ot)}function ve(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function he(Re){return(Math.exp(Re)+Math.exp(-Re))/2}let be=pe(!1),Pe=function(Re){return he(be)/he(be+oe*Re)},Ae=function(Re){return re*((he(be)*(ve(ot=be+oe*Re)/he(ot))-ve(be))/ce)/ge;var ot},ke=(pe(!0)-be)/oe;if(Math.abs(ge)<2e-6||!isFinite(ke)){if(Math.abs(re-ue)<1e-6)return this.easeTo(a,u);let Re=ue<re?-1:1;ke=Math.abs(Math.log(ue/re))/oe,Ae=()=>0,Pe=ot=>Math.exp(Re*oe*ot)}return a.duration="duration"in a?+a.duration:1e3*ke/("screenSpeed"in a?+a.screenSpeed/oe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=g!==I,this._pitching=k!==w,this._rolling=P!==E,this._padding=!f.isPaddingEqual(B),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(ie.targetCenter),this._ease(Re=>{let ot=Re*ke,at=1/Pe(ot),Ye=Ae(ot);this._rotating&&f.setBearing(o.G.number(g,I,Re)),this._pitching&&f.setPitch(o.G.number(w,k,Re)),this._rolling&&f.setRoll(o.G.number(E,P,Re)),this._padding&&(f.interpolatePadding(S,B,Re),$=f.centerPoint.add(L)),ie.easeFunc(Re,at,Ye,$),this.terrain&&!a.freezeElevation&&this._updateElevation(Re),this._applyUpdatedTransform(f),this._fireMoveEvents(u)},()=>{this.terrain&&a.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,u){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,u)}return a||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(a,u,f){f.animate===!1||f.duration===0?(a(1),u()):(this._easeStart=J(),this._easeOptions=f,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,u){a=o.W(a,-180,180);let f=Math.abs(a-u);return Math.abs(a-360-u)<f&&(a-=360),Math.abs(a+360-u)<f&&(a+=360),a}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLat(o.V.convert(a),this.transform):null}}let Ns={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wy{constructor(a=Ns){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,u){let f=this._map._getUIString(`AttributionControl.${u}`);a.title=f,a.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){let g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}let u=this._map.style.tileManagers;for(let g in u){let w=u[g];if(w.used||w.usedForTerrain){let E=w.getSource();E.attribution&&a.indexOf(E.attribution)<0&&a.push(E.attribution)}}a=a.filter(g=>String(g).trim()),a.sort((g,w)=>g.length-w.length),a=a.filter((g,w)=>{for(let E=w+1;E<a.length;E++)if(a[E].indexOf(g)>=0)return!1;return!0});let f=a.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,a.length?(this._innerContainer.innerHTML=K.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Kw{constructor(a={}){this._updateCompact=()=>{let u=this._container.children;if(u.length){let f=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");let u=K.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class FD{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){let u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){let u=this._currentlyRunning,f=u?this._queue.concat(u):this._queue;for(let g of f)if(g.id===a)return void(g.cancelled=!0)}run(a=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let u=this._currentlyRunning=this._queue;this._queue=[];for(let f of u)if(!f.cancelled&&(f.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var LD=o.aU([{name:"a_pos3d",type:"Int16",components:3}]);class rf extends o.E{constructor(a){super(),this._lastTilesetChange=J(),this.tileManager=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=a._source.tileSize*2**this.deltaZoom,a.usedForTerrain=!0,a.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(a,u){this.tileManager.update(a,u),this._renderableTilesKeys=[];let f={};for(let g of hi(a,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.tileManager._source.calculateTileZoom}))f[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.terrainRttPosMatrix32f=new Float64Array(16),o.c7(g.terrainRttPosMatrix32f,0,o.a5,o.a5,0,0,1),this._tiles[g.key]=new Me(g,this.tileSize),this._lastTilesetChange=J());for(let g in this._tiles)f[g]||delete this._tiles[g]}freeRtt(a){for(let u in this._tiles){let f=this._tiles[u];(!a||f.tileID.equals(a)||f.tileID.isChildOf(a)||a.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a,u){return u?this._getTerrainCoordsForTileRanges(a,u):this._getTerrainCoordsForRegularTile(a)}_getTerrainCoordsForRegularTile(a){let u={};for(let f of this._renderableTilesKeys){let g=this._tiles[f].tileID,w=a.clone(),E=o.bk();if(g.canonical.equals(a.canonical))o.c7(E,0,o.a5,o.a5,0,0,1);else if(g.canonical.isChildOf(a.canonical)){let S=g.canonical.z-a.canonical.z,I=g.canonical.x-(g.canonical.x>>S<<S),k=g.canonical.y-(g.canonical.y>>S<<S),P=o.a5>>S;o.c7(E,0,P,P,0,0,1),o.O(E,E,[-I*P,-k*P,0])}else{if(!a.canonical.isChildOf(g.canonical))continue;{let S=a.canonical.z-g.canonical.z,I=a.canonical.x-(a.canonical.x>>S<<S),k=a.canonical.y-(a.canonical.y>>S<<S),P=o.a5>>S;o.c7(E,0,o.a5,o.a5,0,0,1),o.O(E,E,[I*P,k*P,0]),o.Q(E,E,[1/2**S,1/2**S,0])}}w.terrainRttPosMatrix32f=new Float32Array(E),u[f]=w}return u}_getTerrainCoordsForTileRanges(a,u){let f={};for(let g of this._renderableTilesKeys){let w=this._tiles[g].tileID;if(!this._isWithinTileRanges(w,u))continue;let E=a.clone(),S=o.bk();if(w.canonical.z===a.canonical.z){let I=a.canonical.x-w.canonical.x+a.wrap*(1<<a.canonical.z),k=a.canonical.y-w.canonical.y;o.c7(S,0,o.a5,o.a5,0,0,1),o.O(S,S,[I*o.a5,k*o.a5,0])}else if(w.canonical.z>a.canonical.z){let I=w.canonical.z-a.canonical.z,k=w.canonical.x-(w.canonical.x>>I<<I)+a.wrap*(1<<w.canonical.z),P=w.canonical.y-(w.canonical.y>>I<<I),B=a.canonical.x-(w.canonical.x>>I),L=a.canonical.y-(w.canonical.y>>I),$=o.a5>>I;o.c7(S,0,$,$,0,0,1),o.O(S,S,[-k*$+B*o.a5,-P*$+L*o.a5,0])}else{let I=a.canonical.z-w.canonical.z,k=a.canonical.x-(a.canonical.x>>I<<I)+a.wrap*(1<<a.canonical.z),P=a.canonical.y-(a.canonical.y>>I<<I),B=(a.canonical.x>>I)-w.canonical.x,L=(a.canonical.y>>I)-w.canonical.y,$=o.a5<<I;o.c7(S,0,$,$,0,0,1),o.O(S,S,[k*o.a5+B*$,P*o.a5+L*$,0])}E.terrainRttPosMatrix32f=new Float32Array(S),f[g]=E}return f}getSourceTile(a,u){let f=this.tileManager._source,g=a.overscaledZ-this.deltaZoom;if(g>f.maxzoom&&(g=f.maxzoom),g<f.minzoom)return;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(g).key);let w=this.findTileInCaches(this._sourceTileCache[a.key]);if(!w?.dem&&u)for(;g>=f.minzoom&&!w?.dem;)w=this.findTileInCaches(a.scaledTo(g--).key);return w}findTileInCaches(a){let u=this.tileManager.getTileByID(a);return u||(u=this.tileManager._outOfViewCache.getByKey(a),u)}anyTilesAfterTime(a=Date.now()){return this._lastTilesetChange>=a}_isWithinTileRanges(a,u){let f=u[a.canonical.z];return!!f&&(a.wrap>f.minWrap||a.wrap<f.maxWrap||a.canonical.x>=f.minTileXWrapped&&a.canonical.x<=f.maxTileXWrapped&&a.canonical.y>=f.minTileY&&a.canonical.y<=f.maxTileY)}}class Fi{constructor(a,u,f){this._meshCache={},this.painter=a,this.tileManager=new rf(u),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,u,f,g=o.a5){var w;if(!(u>=0&&u<g&&f>=0&&f<g))return 0;let E=this.getTerrainData(a),S=(w=E.tile)===null||w===void 0?void 0:w.dem;if(!S)return 0;let I=o.cD([],[u/g*o.a5,f/g*o.a5],E.u_terrain_matrix),k=[I[0]*S.dim,I[1]*S.dim],P=Math.floor(k[0]),B=Math.floor(k[1]),L=k[0]-P,$=k[1]-B;return S.get(P,B)*(1-L)*(1-$)+S.get(P+1,B)*L*(1-$)+S.get(P,B+1)*(1-L)*$+S.get(P+1,B+1)*L*$}getElevationForLngLatZoom(a,u){if(!o.cE(u,a.wrap()))return 0;let{tileID:f,mercatorX:g,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(a,u);return this.getElevation(f,g%o.a5,w%o.a5,o.a5)}getElevationForLngLat(a,u){let f=hi(u,{maxzoom:this.tileManager.maxzoom,minzoom:this.tileManager.minzoom,tileSize:512,terrain:this}),g=0;for(let w of f)w.canonical.z>g&&(g=Math.min(w.canonical.z,this.tileManager.maxzoom));return this.getElevationForLngLatZoom(a,g)}getElevation(a,u,f,g=o.a5){return this.getDEMElevation(a,u,f,g)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){let g=this.painter.context,w=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(g,w,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(g,new o.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ar([])}let u=this.tileManager.getSourceTile(a,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){let g=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new o.T(g,u.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),u.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}let f=u&&u.toString()+u.tileID.key+a.key;if(f&&!this._demMatrixCache[f]){let g=this.tileManager.getSource().maxzoom,w=a.canonical.z-u.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=g?w=a.canonical.z-g:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let E=a.canonical.x-(a.canonical.x>>w<<w),S=a.canonical.y-(a.canonical.y>>w<<w),I=o.cF(new Float64Array(16),[1/(o.a5<<w),1/(o.a5<<w),0]);o.O(I,I,[E*o.a5,S*o.a5,0]),this._demMatrixCache[a.key]={matrix:I,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(a){let u=this.painter,f=u.width/devicePixelRatio,g=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(u.context,{width:f,height:g,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(f,g,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,f,g))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,E=0;w<this._coordsTextureSize;w++)for(let S=0;S<this._coordsTextureSize;S++,E+=4)u[E+0]=255&S,u[E+1]=255&w,u[E+2]=S>>8<<4|w>>8,u[E+3]=0;let f=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),g=new o.T(a,f,a.gl.RGBA,{premultiply:!1});return g.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);let u=new Uint8Array(4),f=this.painter.context,g=f.gl,w=Math.round(a.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(a.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(w,S-E-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),f.bindFramebuffer.set(null);let I=u[0]+(u[2]>>4<<8),k=u[1]+((15&u[2])<<8),P=this.coordsIndex[255-u[3]],B=P&&this.tileManager.getTileByID(P);if(!B)return null;let L=this._coordsTextureSize,$=(1<<B.tileID.canonical.z)*L;return new o.a9((B.tileID.canonical.x*L+I)/$+B.tileID.wrap,(B.tileID.canonical.y*L+k)/$,this.getElevation(B.tileID,I,k,L))}depthAtPoint(a){let u=new Uint8Array(4),f=this.painter.context,g=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,u),f.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(a){var u;let f=((u=this.painter.style.projection)===null||u===void 0?void 0:u.transitionState)>0,g=f&&a.canonical.y===0,w=f&&a.canonical.y===(1<<a.canonical.z)-1,E=`m_${g?"n":""}_${w?"s":""}`;if(this._meshCache[E])return this._meshCache[E];let S=this.painter.context,I=new o.cG,k=new o.aY,P=this.meshSize,B=o.a5/P,L=P*P;for(let he=0;he<=P;he++)for(let be=0;be<=P;be++)I.emplaceBack(be*B,he*B,0);for(let he=0;he<L;he+=P+1)for(let be=0;be<P;be++)k.emplaceBack(be+he,P+be+he+1,P+be+he+2),k.emplaceBack(be+he,P+be+he+2,be+he+1);let $=I.length,Y=$+(P+1),ie=(P+1)*P,oe=g?o.br:0,re=g?0:1,ue=w?o.bs:o.a5,ge=w?0:1;for(let he=0;he<=P;he++)I.emplaceBack(he*B,oe,re);for(let he=0;he<=P;he++)I.emplaceBack(he*B,ue,ge);for(let he=0;he<P;he++)k.emplaceBack(ie+he,Y+he,Y+he+1),k.emplaceBack(ie+he,Y+he+1,ie+he+1),k.emplaceBack(0+he,$+he+1,$+he),k.emplaceBack(0+he,0+he+1,$+he+1);let ce=I.length,pe=ce+2*(P+1);for(let he of[0,1])for(let be=0;be<=P;be++)for(let Pe of[0,1])I.emplaceBack(he*o.a5,be*B,Pe);for(let he=0;he<2*P;he+=2)k.emplaceBack(ce+he,ce+he+1,ce+he+3),k.emplaceBack(ce+he,ce+he+3,ce+he+2),k.emplaceBack(pe+he,pe+he+3,pe+he+1),k.emplaceBack(pe+he,pe+he+2,pe+he+3);let ve=new ei(S.createVertexBuffer(I,LD.members),S.createIndexBuffer(k),o.aX.simpleSegment(0,0,I.length,k.length));return this._meshCache[E]=ve,ve}getMeshFrameDelta(a){return 2*Math.PI*o.bE/Math.pow(2,Math.max(a,0))/5}getMinTileElevationForLngLatZoom(a,u){var f;if(!o.cE(u,a.wrap()))return 0;let{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(a,u);return(f=this.getMinMaxElevation(g).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(a){let u=this.getTerrainData(a).tile,f={minElevation:null,maxElevation:null};return u&&u.dem&&(f.minElevation=u.dem.min*this.exaggeration,f.maxElevation=u.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(a,u){let f=o.a9.fromLngLat(a.wrap()),g=(1<<u)*o.a5,w=f.x*g,E=f.y*g,S=Math.floor(w/o.a5),I=Math.floor(E/o.a5);return{tileID:new o.a2(u,0,u,S,I),mercatorX:w,mercatorY:E}}}class ir{constructor(a,u,f){this._context=a,this._size=u,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){let u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(f.texture),{id:a,fbo:u,texture:f,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>a.id!==u),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(let u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(let a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}let Wc={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class of{constructor(a,u){this.painter=a,this.terrain=u,this.pool=new ir(a.context,30,u.tileManager.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=a._order.filter(f=>!a._layers[f].isHidden(u)),this._coordsAscending={};for(let f in a.tileManagers){this._coordsAscending[f]={};let g=a.tileManagers[f].getVisibleCoordinates(),w=a.tileManagers[f].getSource(),E=w instanceof cs?w.terrainTileRanges:null;for(let S of g){let I=this.terrain.tileManager.getTerrainCoords(S,E);for(let k in I)this._coordsAscending[f][k]||(this._coordsAscending[f][k]=[]),this._coordsAscending[f][k].push(I[k])}}this._coordsAscendingStr={};for(let f of a._order){let g=a._layers[f],w=g.source;if(Wc[g.type]&&!this._coordsAscendingStr[w]){this._coordsAscendingStr[w]={};for(let E in this._coordsAscending[w])this._coordsAscendingStr[w][E]=this._coordsAscending[w][E].map(S=>S.key).sort().join()}}for(let f of this._renderableTiles)for(let g in this._coordsAscendingStr){let w=this._coordsAscendingStr[g][f.tileID.key];w&&w!==f.rttCoords[g]&&(f.rtt=[])}}renderLayer(a,u){if(a.isHidden(this.painter.transform.zoom))return!1;let f=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),g=a.type,w=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(Wc[g]&&(this._prevType&&Wc[this._prevType]||this._stacks.push([]),this._prevType=g,this._stacks[this._stacks.length-1].push(a.id),!E))return!0;if(Wc[this._prevType]||Wc[g]&&E){this._prevType=g;let S=this._stacks.length-1,I=this._stacks[S]||[];for(let k of this._renderableTiles){if(this.pool.isFull()&&(uy(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(k),k.rtt[S]){let B=this.pool.getObjectForId(k.rtt[S].id);if(B.stamp===k.rtt[S].stamp){this.pool.useObject(B);continue}}let P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),k.rtt[S]={id:P.id,stamp:P.stamp},w.context.bindFramebuffer.set(P.fbo.framebuffer),w.context.clear({color:o.bp.transparent,stencil:0}),w.currentStencilSource=void 0;for(let B=0;B<I.length;B++){let L=w.style._layers[I[B]],$=L.source?this._coordsAscending[L.source][k.tileID.key]:[k.tileID];w.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),w._renderTileClippingMasks(L,$,!0),w.renderLayer(w,w.style.tileManagers[L.source],L,$,f),L.source&&(k.rttCoords[L.source]=this._coordsAscendingStr[L.source][k.tileID.key])}}return uy(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),Wc[g]}return!1}}let _m={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},xy=d,ym={hash:!1,interactive:!0,bearingSnap:7,zoomSnap:0,attributionControl:Ns,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ey={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class sf{constructor(a,u,f=!1){this.mousedown=w=>{this.startMove(w,K.mousePos(this.element,w)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=w=>{this.move(w,K.mousePos(this.element,w))},this.mouseup=w=>{this._rotatePitchHandler.dragEnd(w),this.offTemp()},this.touchstart=w=>{w.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,w.targetTouches)[0],this.startMove(w,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=w=>{w.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,w.targetTouches)[0],this.move(w,this._lastPos))},this.touchend=w=>{w.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;let g=new Uw;this._rotatePitchHandler=new fd({clickTolerance:3,move:(w,E)=>{let S=u.getBoundingClientRect(),I=new o.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:o.cy(new o.P(w.x,E.y),E,I),pitchDelta:f?-.5*(E.y-w.y):void 0}},moveStateManager:g,enable:!0,assignEvents:()=>{}}),this.map=a,K.addEventListener(u,"mousedown",this.mousedown),K.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(u,"touchcancel",this.reset)}startMove(a,u){this._rotatePitchHandler.dragStart(a,u),K.disableDrag()}move(a,u){let f=this.map,{bearingDelta:g,pitchDelta:w}=this._rotatePitchHandler.dragMove(a,u)||{};g&&f.setBearing(f.getBearing()+g),w&&f.setPitch(f.getPitch()+w)}off(){let a=this.element;K.removeEventListener(a,"mousedown",this.mousedown),K.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let il;function vm(v,a,u,f=!1){if(f||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();let g=new o.V(v.lng,v.lat);if(v=new o.V(v.lng,v.lat),a){let w=new o.V(v.lng-360,v.lat),E=new o.V(v.lng+360,v.lat),S=u.locationToScreenPoint(v).distSqr(a);u.locationToScreenPoint(w).distSqr(a)<S?v=w:u.locationToScreenPoint(E).distSqr(a)<S&&(v=E)}for(;Math.abs(v.lng-u.center.lng)>180;){let w=u.locationToScreenPoint(v);if(w.x>=0&&w.y>=0&&w.x<=u.width&&w.y<=u.height)break;v.lng>u.center.lng?v.lng-=360:v.lng+=360}return v.lng!==g.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(v))?v:g}let af={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bm(v,a,u){let f=v.classList;for(let g in af)f.remove(`maplibregl-${u}-anchor-${g}`);f.add(`maplibregl-${u}-anchor-${a}`)}class lf extends o.E{constructor(a){if(super(),this._onKeyPress=u=>{let f=u.code,g=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=u=>{let f=u.originalEvent.target,g=this._element;this._popup&&(f===g||g.contains(f))&&this.togglePopup()},this._update=u=>{if(!this._map)return;let f=this._map.loaded()&&!this._map.isMoving();(u?.type==="terrain"||u?.type==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=vm(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let w="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?w="rotateX(0deg)":this._pitchAlignment==="map"&&(w=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&u.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${af[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${w} ${g}`),N.frameAsync(new AbortController,this._map._ownerWindow).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){let f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._subpixelPositioning=a&&a.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(a?.opacity,a?.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=o.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div");let u=K.createNS("http://www.w3.org/2000/svg","svg"),f=41,g=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${f}px`),u.setAttributeNS(null,"width",`${g}px`),u.setAttributeNS(null,"viewBox",`0 0 ${g} ${f}`);let w=K.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");let E=K.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");let S=K.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");let I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let re of I){let ue=K.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",re.rx),ue.setAttributeNS(null,"ry",re.ry),S.appendChild(ue)}let k=K.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"fill",this._color);let P=K.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),k.appendChild(P);let B=K.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");let L=K.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(L);let $=K.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");let Y=K.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(8.0, 8.0)");let ie=K.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#000000"),ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962");let oe=K.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#FFFFFF"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962"),Y.appendChild(ie),Y.appendChild(oe),E.appendChild(S),E.appendChild(k),E.appendChild(B),E.appendChild($),E.appendChild(Y),u.appendChild(E),u.setAttributeNS(null,"height",f*this._scale+"px"),u.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(u),this._offset=o.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),bm(this._element,this._anchor,"marker"),a&&a.className)for(let u of a.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(a){return this.remove(),this._map=a,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",a._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),a.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.V.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){let g=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(a){return this._subpixelPositioning=a,this}getPopup(){return this._popup}togglePopup(){let a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(a=!1){var u,f;let g=(u=this._map)===null||u===void 0?void 0:u.terrain,w=this._map.transform.isLocationOccluded(this._lngLat);if(!g||w){let $=w?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==$&&(this._element.style.opacity=$))}if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let E=this._map,S=E.terrain.depthAtPoint(this._pos),I=E.terrain.getElevationForLngLat(this._lngLat,E.transform);if(E.transform.lngLatToCameraDepth(this._lngLat,I)-S<.006)return void(this._element.style.opacity=this._opacity);let k=-this._offset.y/E.transform.pixelsPerMeter,P=Math.sin(E.getPitch()*Math.PI/180)*k,B=E.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),L=E.transform.lngLatToCameraDepth(this._lngLat,I+P)-B>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=o.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,u){return(this._opacity===void 0||a===void 0&&u===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}let Cy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},md=0,Zc=!1,Ty={maxWidth:100,unit:"metric"};function cf(v,a,u){let f=u&&u.maxWidth||100,g=v._container.clientHeight/2,w=v._container.clientWidth/2,E=v.unproject([w-f/2,g]),S=v.unproject([w+f/2,g]),I=Math.round(v.project(S).x-v.project(E).x),k=Math.min(f,I,v._container.clientWidth),P=E.distanceTo(S);if(u&&u.unit==="imperial"){let B=3.2808*P;B>5280?Kc(a,k,B/5280,v._getUIString("ScaleControl.Miles")):Kc(a,k,B,v._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?Kc(a,k,P/1852,v._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Kc(a,k,P/1e3,v._getUIString("ScaleControl.Kilometers")):Kc(a,k,P,v._getUIString("ScaleControl.Meters"))}function Kc(v,a,u,f){let g=(function(w){let E=Math.pow(10,`${Math.floor(w)}`.length-1),S=w/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(I){let k=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*k)/k})(S),E*S})(u);v.style.width=a*(g/u)+"px",v.innerHTML=`${g}&nbsp;${f}`}let Sy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0,padding:void 0},wm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xm(v){if(v){if(typeof v=="number"){let a=Math.round(Math.abs(v)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,v),"top-left":new o.P(a,a),"top-right":new o.P(-a,a),bottom:new o.P(0,-v),"bottom-left":new o.P(a,-a),"bottom-right":new o.P(-a,-a),left:new o.P(v,0),right:new o.P(-v,0)}}if(v instanceof o.P||Array.isArray(v)){let a=o.P.convert(v);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:o.P.convert(v.center||[0,0]),top:o.P.convert(v.top||[0,0]),"top-left":o.P.convert(v["top-left"]||[0,0]),"top-right":o.P.convert(v["top-right"]||[0,0]),bottom:o.P.convert(v.bottom||[0,0]),"bottom-left":o.P.convert(v["bottom-left"]||[0,0]),"bottom-right":o.P.convert(v["bottom-right"]||[0,0]),left:o.P.convert(v.left||[0,0]),right:o.P.convert(v.right||[0,0])}}return xm(new o.P(0,0))}let Dy=d;r.AJAXError=o.cJ,r.Event=o.l,r.Evented=o.E,r.LngLat=o.V,r.MercatorCoordinate=o.a9,r.Point=o.P,r.addProtocol=o.cK,r.config=o.c,r.removeProtocol=o.cL,r.AttributionControl=wy,r.BoxZoomHandler=hd,r.CanvasSource=Eh,r.CooperativeGesturesHandler=It,r.DoubleClickZoomHandler=by,r.DragPanHandler=Zw,r.DragRotateHandler=Xs,r.EdgeInsets=Ku,r.FullscreenControl=class extends o.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var a;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=u?.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let v=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},r.GeoJSONSource=zu,r.GeolocateControl=class extends o.E{constructor(v){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",a)),this._finish()}},this._updateCamera=a=>{let u=new o.V(a.coords.longitude,a.coords.latitude),f=a.coords.accuracy,g=this._map.getBearing(),w=o.e({bearing:g},this.options.fitBoundsOptions),E=Ni.fromLngLat(u,f);this._map.fitBounds(E,w,{geolocateSource:!0})},this._updateMarker=a=>{if(a){let u=new o.V(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=a.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=a=>{if(this._map){if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&Zc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=a=>{if(this._map){if(a===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");let u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{let u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new lf({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{let f=u?.[0]instanceof ResizeObserverEntry;u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},Cy,v)}onAdd(v){return this._map=v,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,function*(a=!1){if(il!==void 0&&!a)return il;if(window.navigator.permissions===void 0)return il=!!window.navigator.geolocation,il;try{il=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch(u){il=!!window.navigator.geolocation}return il})})().then(a=>this._finishSetupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,md=0,Zc=!1}_isOutOfMapMaxBounds(v){let a=this._map.getMaxBounds(),u=v.coords;return a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){let v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;let a=this._map.project(v),u=this._map.unproject([a.x+100,a.y]),f=v.distanceTo(u)/100,g=2*this._accuracy/f;this._circleElement.style.width=`${g.toFixed(2)}px`,this._circleElement.style.height=`${g.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":md--,Zc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),md++,md>1?(v={maximumAge:6e5,timeout:0},Zc=!0):(v=this.options.positionOptions,Zc=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},r.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;let a=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(a!=="mercator"&&a?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=K.create("button","maplibregl-ctrl-globe",this._container),K.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},r.Hash=fy,r.ImageSource=cs,r.KeyboardHandler=Xn,r.LngLatBounds=Ni,r.LogoControl=Kw,r.Map=class extends Oo{get _ownerWindow(){var v,a;return((a=(v=this._container)===null||v===void 0?void 0:v.ownerDocument)===null||a===void 0?void 0:a.defaultView)||window}constructor(v){var a,u;o.cH.mark(o.cI.create);let f=Object.assign(Object.assign(Object.assign({},ym),v),{canvasContextAttributes:Object.assign(Object.assign({},ym.canvasContextAttributes),v.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let g=new Fc,w=new Lc;f.minZoom!==void 0&&g.setMinZoom(f.minZoom),f.maxZoom!==void 0&&g.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&g.setMinPitch(f.minPitch),f.maxPitch!==void 0&&g.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&g.setRenderWorldCopies(f.renderWorldCopies),f.transformConstrain!==null&&g.setConstrainOverride(f.transformConstrain),super(g,w,{bearingSnap:f.bearingSnap,zoomSnap:f.zoomSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new FD,this._controls=[],this._mapId=o.af(),this._lostContextStyle={style:null,images:null},this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(let I of Object.values(this.style._layers))if(I.type==="custom"&&console.warn(`Custom layer with id '${I.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),I._listeners)for(let[k]of Object.entries(I._listeners))console.warn(`Custom layer with id '${I.id}' had event listeners for event '${k}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new o.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._lostContextStyle={style:null,images:null},this._setupPainter(),this.resize(),this._update(),this._resizeInternal(),this.fire(new o.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._zoomSnap=f.zoomSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},_m),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this._zoomLevelsToOverscale=f.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=f.transformCameraUpdate,this.transformConstrain=f.transformConstrain,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,f.reduceMotion!==void 0&&(N.prefersReducedMotion=f.reduceMotion),this._imageQueueHandle=Oe.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qe(f.transformRequest),this._container=this._resolveContainer(f.container),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"&&(this._ownerWindow.addEventListener("online",this._onWindowOnline,!1),this._setupResizeObserver()),this.handlers=new gm(this,f),this._hash=f.hash&&new fy(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,o.e({},f.fitBoundsOptions,{duration:0}))));let E=typeof f.style=="string"||((u=(a=f.style)===null||a===void 0?void 0:a.projection)===null||u===void 0?void 0:u.type)!=="globe";this.resize(null,E),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new wy(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new Kw,f.logoPosition),this.on("style.load",()=>{if(E||this._resizeTransform(),this.transform.unmodified){let S=o.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}}),this.on("data",S=>{this._update(S.dataType==="style"),this.fire(new o.l(`${S.dataType}data`,S))}),this.on("dataloading",S=>{this.fire(new o.l(`${S.dataType}dataloading`,S))}),this.on("dataabort",S=>{this.fire(new o.l("sourcedataabort",S))})}_getMapId(){return this._mapId}setGlobalStateProperty(v,a){return this.style.setGlobalStateProperty(v,a),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,a){if(a===void 0&&(a=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let u=v.onAdd(this);this._controls.push(v);let f=this._controlPositions[a];return a.indexOf("bottom")!==-1?f.insertBefore(u,f.firstChild):f.appendChild(u),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let a=this._controls.indexOf(v);return a>-1&&this._controls.splice(a,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return hi(this.transform,v)}calculateCameraOptionsFromTo(v,a,u,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLat(u,this.transform)),super.calculateCameraOptionsFromTo(v,a,u,f)}resize(v,a=!0){if(this._lostContextStyle.style!==null)return this;this._resizeInternal(a);let u=!this._moving;return u&&(this.stop(),this.fire(new o.l("movestart",v)).fire(new o.l("move",v))),this.fire(new o.l("resize",v)),u&&this.fire(new o.l("moveend",v)),this}_resizeInternal(v=!0){let[a,u]=this._containerDimensions(),f=this._getClampedPixelRatio(a,u);if(this._resizeCanvas(a,u,f),this.painter.resize(a,u,f),this.painter.overLimit()){let g=this.painter.context.gl;this._maxCanvasSize=[g.drawingBufferWidth,g.drawingBufferHeight];let w=this._getClampedPixelRatio(a,u);this._resizeCanvas(a,u,w),this.painter.resize(a,u,w)}this._resizeTransform(v)}_resizeTransform(v=!0){var a;let[u,f]=this._containerDimensions();this.transform.resize(u,f,v),(a=this._requestedCameraState)===null||a===void 0||a.resize(u,f,v)}_getClampedPixelRatio(v,a){let{0:u,1:f}=this._maxCanvasSize,g=this.getPixelRatio(),w=v*g,E=a*g;return Math.min(w>u?u/w:1,E>f?f/E:1)*g}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Ni.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom){let a=this.transform.zoom,u=this._getTransformForUpdate();return u.setMinZoom(v),this._applyUpdatedTransform(u),this._update(),a!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom){let a=this.transform.zoom,u=this._getTransformForUpdate();return u.setMaxZoom(v),this._applyUpdatedTransform(u),this._update(),a!==this.transform.zoom&&this.fire(new o.l("zoomstart")).fire(new o.l("zoom")).fire(new o.l("zoomend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch){let a=this.transform.pitch,u=this._getTransformForUpdate();return u.setMinPitch(v),this._applyUpdatedTransform(u),this._update(),a!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch){let a=this.transform.pitch,u=this._getTransformForUpdate();return u.setMaxPitch(v),this._applyUpdatedTransform(u),this._update(),a!==this.transform.pitch&&this.fire(new o.l("pitchstart")).fire(new o.l("pitch")).fire(new o.l("pitchend")).fire(new o.l("movestart")).fire(new o.l("move")).fire(new o.l("moveend")),this}throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrainOverride(v),this._update()}project(v){return this.transform.locationToScreenPoint(o.V.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(o.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,a,u){if(v==="mouseenter"||v==="mouseover"){let f=!1;return{layers:a,listener:u,delegates:{mousemove:w=>{let E=a.filter(I=>this.getLayer(I)),S=E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[];S.length?f||(f=!0,u.call(this,new Ur(v,this,w.originalEvent,{features:S}))):f=!1},mouseout:()=>{f=!1}}}}if(v==="mouseleave"||v==="mouseout"){let f=!1;return{layers:a,listener:u,delegates:{mousemove:E=>{let S=a.filter(I=>this.getLayer(I));(S.length!==0?this.queryRenderedFeatures(E.point,{layers:S}):[]).length?f=!0:f&&(f=!1,u.call(this,new Ur(v,this,E.originalEvent)))},mouseout:E=>{f&&(f=!1,u.call(this,new Ur(v,this,E.originalEvent)))}}}}{let f=g=>{let w=a.filter(S=>this.getLayer(S)),E=w.length!==0?this.queryRenderedFeatures(g.point,{layers:w}):[];E.length&&(g.features=E,u.call(this,g),delete g.features)};return{layers:a,listener:u,delegates:{[v]:f}}}}_saveDelegatedListener(v,a){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(a)}_removeDelegatedListener(v,a,u){if(!this._delegatedListeners||!this._delegatedListeners[v])return;let f=this._delegatedListeners[v];for(let g=0;g<f.length;g++){let w=f[g];if(w.listener===u&&w.layers.length===a.length&&w.layers.every(E=>a.includes(E))){for(let E in w.delegates)this.off(E,w.delegates[E]);return void f.splice(g,1)}}}on(v,a,u){if(u===void 0)return super.on(v,a);let f=typeof a=="string"?[a]:a,g=this._createDelegatedListener(v,f,u);this._saveDelegatedListener(v,g);for(let w in g.delegates)this.on(w,g.delegates[w]);return{unsubscribe:()=>{this._removeDelegatedListener(v,f,u)}}}once(v,a,u){if(u===void 0)return super.once(v,a);let f=typeof a=="string"?[a]:a,g=this._createDelegatedListener(v,f,u);for(let w in g.delegates){let E=g.delegates[w];g.delegates[w]=(...S)=>{this._removeDelegatedListener(v,f,u),E(...S)}}this._saveDelegatedListener(v,g);for(let w in g.delegates)this.once(w,g.delegates[w]);return this}off(v,a,u){return u===void 0?super.off(v,a):(this._removeDelegatedListener(v,typeof a=="string"?[a]:a,u),this)}queryRenderedFeatures(v,a){if(!this.style)return[];let u,f=v instanceof o.P||Array.isArray(v),g=f?v:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(f?{}:v)||{},g instanceof o.P||typeof g[0]=="number")u=[o.P.convert(g)];else{let w=o.P.convert(g[0]),E=o.P.convert(g[1]);u=[w,new o.P(E.x,w.y),E,new o.P(w.x,E.y),w]}return this.style.queryRenderedFeatures(u,a,this.transform)}querySourceFeatures(v,a){return this.style.querySourceFeatures(v,a)}setStyle(v,a){return(a=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(v,a))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){let a=this._locale[v];if(a==null)throw new Error(`Missing UI string '${v}'`);return a}_updateStyle(v,a){var u,f;if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,a));let g=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new Vc(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,a,g):this.style.loadJSON(v,a,g),this):((f=(u=this.style)===null||u===void 0?void 0:u.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Vc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,a){if(typeof v=="string"){let u=this._requestManager.transformRequest(v,"Style");o.j(u,new AbortController).then(f=>{this._updateDiff(f.data,a)}).catch(f=>{f&&this.fire(new o.k(f))})}else typeof v=="object"&&this._updateDiff(v,a)}_updateDiff(v,a){try{this.style.setState(v,a)&&this._update(!0)}catch(u){o.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(v,a)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(v,a){return this._lazyInitEmptyStyle(),this.style.addSource(v,a),this._update(!0)}isSourceLoaded(v){let a=this.style&&this.style.tileManagers[v];if(a!==void 0)return a.loaded();this.fire(new o.k(new Error(`There is no tile manager with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){let a=this.style.tileManagers[v.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&a.reload();for(let u in this.style._layers){let f=this.style._layers[u];f.type==="hillshade"&&f.source===v.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),f.type==="color-relief"&&f.source===v.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Fi(this.painter,a,v),this.painter.renderToTexture=new of(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var f;u.dataType==="style"?this.terrain.tileManager.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=u.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:v})),this}getTerrain(){var v,a;return(a=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&a!==void 0?a:null}areTilesLoaded(){let v=this.style&&this.style.tileManagers;for(let a of Object.values(v))if(!a.areTilesLoaded())return!1;return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,a,u){if(u){let f=this.getSource(u);if(!f)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);f.calculateTileZoom=Nt(Math.max(1,v),Math.max(1,a))}else for(let f in this.style.tileManagers)this.style.tileManagers[f].getSource().calculateTileZoom=Nt(Math.max(1,v),Math.max(1,a));return this._update(!0),this}refreshTiles(v,a){let u=this.style.tileManagers[v];if(!u)throw new Error(`There is no tile manager with ID "${v}", cannot refresh tile`);a===void 0?u.reload(!0):u.refreshTiles(a.map(f=>new o.ac(f.z,f.x,f.y)))}addImage(v,a,u={}){let{pixelRatio:f=1,sdf:g=!1,stretchX:w,stretchY:E,content:S,textFitWidth:I,textFitHeight:k}=u;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||o.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:P,height:B,data:L}=a,$=a;return this.style.addImage(v,{data:new o.R({width:P,height:B},new Uint8Array(L)),pixelRatio:f,stretchX:w,stretchY:E,content:S,textFitWidth:I,textFitHeight:k,sdf:g,version:0,userImage:$}),$.onAdd&&$.onAdd(this,v),this}}{let{width:P,height:B,data:L}=N.getImageData(a);this.style.addImage(v,{data:new o.R({width:P,height:B},L),pixelRatio:f,stretchX:w,stretchY:E,content:S,textFitWidth:I,textFitHeight:k,sdf:g,version:0})}}updateImage(v,a){let u=this.style.getImage(v);if(!u)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let f=a instanceof HTMLImageElement||o.b(a)?N.getImageData(a):a,{width:g,height:w,data:E}=f;if(g===void 0||w===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==u.data.width||w!==u.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));let S=!(a instanceof HTMLImageElement||o.b(a));return u.data.replace(E,S),this.style.updateImage(v,u),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return Oe.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,a){return this._lazyInitEmptyStyle(),this.style.addLayer(v,a),this._update(!0)}moveLayer(v,a){return this.style.moveLayer(v,a),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,a,u){return this.style.setLayerZoomRange(v,a,u),this._update(!0)}setFilter(v,a,u={}){return this.style.setFilter(v,a,u),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,a,u,f={}){return this.style.setPaintProperty(v,a,u,f),this._update(!0)}getPaintProperty(v,a){return this.style.getPaintProperty(v,a)}setLayoutProperty(v,a,u,f={}){return this.style.setLayoutProperty(v,a,u,f),this._update(!0)}getLayoutProperty(v,a){return this.style.getLayoutProperty(v,a)}setGlyphs(v,a={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,a,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,a,u,f=>{f||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,a={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,a,u=>{u||this._update(!0)}),this}setLight(v,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,a),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,a={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,a),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,a){return this.style.setFeatureState(v,a),this._update()}removeFeatureState(v,a){return this.style.removeFeatureState(v,a),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,a=0;return this._container&&(v=this._container.clientWidth||400,a=this._container.clientHeight||300),[v,a]}_setupResizeObserver(){var v;let a=!1,u=hy(g=>{this._trackResize&&!this._removed&&(this.resize(g),this.redraw())},50),f=(v=this._ownerWindow.ResizeObserver)!==null&&v!==void 0?v:ResizeObserver;this._resizeObserver=new f(g=>{a?u(g):a=!0}),this._resizeObserver.observe(this._container)}_resolveContainer(v){if(typeof v=="string"){let a=document.getElementById(v);if(!a)throw new Error(`Container '${v}' not found.`);return a}if(v instanceof HTMLElement||v&&typeof v=="object"&&v.nodeType===1)return v;throw new Error("Invalid type: 'container' must be a String or HTMLElement.")}_setupContainer(){let v=this._container;v.classList.add("maplibregl-map");let a=this._canvasContainer=K.create("div","maplibregl-canvas-container",v);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let u=this._containerDimensions(),f=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],f);let g=this._controlContainer=K.create("div","maplibregl-control-container",v),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{w[E]=K.create("div",`maplibregl-ctrl-${E} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,a,u){this._canvas.width=Math.floor(u*v),this._canvas.height=Math.floor(u*a),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${a}px`}_setupPainter(){let v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),a=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{a={requestedAttributes:v},f&&(a.statusMessage=f.statusMessage,a.type=f.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!u){let f="Failed to initialize WebGL";throw a?(a.message=f,new Error(JSON.stringify(a))):new Error(f)}this.painter=new Bw(u,this.transform),xe.testSupport(u)}migrateProjection(v,a){super.migrateProjection(v,a),this.painter.transform=v,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var a,u,f,g,w;let E=this._idleTriggered?this._fadeDuration:0,S=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let I=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let B=this.transform.zoom,L=J();this.style.zoomHistory.update(B,L);let $=new o.H(B,{now:L,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Y=$.crossFadingFactor();Y===1&&Y===this._crossFadingFactor||(I=!0,this._crossFadingFactor=Y),this.style.update($)}let k=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0!==S;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((g=this.style.projection)===null||g===void 0?void 0:g.transitionState,(w=this.style.projection)===null||w===void 0?void 0:w.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||k)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,k),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cH.mark(o.cI.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let P=this._sourcesDirty||this._styleDirty||this._placementDirty;return P||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,o.cH.mark(o.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(let u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&this._ownerWindow.removeEventListener("online",this._onWindowOnline,!1),Oe.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();let a=this.painter.context.gl.getExtension("WEBGL_lose_context");a?.loseContext&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cH.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,N.frame(this._frameRequest,v=>{o.cH.frame(v),this._frameRequest=null;try{this._render(v)}catch(a){if(!o.Z(a)&&!(function(u){return u.message===sy})(a))throw a}},()=>{},this._ownerWindow))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return xy}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},r.MapMouseEvent=Ur,r.MapTouchEvent=Yh,r.MapWheelEvent=zw,r.Marker=lf,r.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{let a=this._map.getZoom(),u=a===this._map.getMaxZoom(),f=a===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(a,u)=>{let f=this._map._getUIString(`NavigationControl.${u}`);a.title=f,a.setAttribute("aria-label",f)},this.options=o.e({},Ey,v),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,a){let u=K.create("button",v,this._container);return u.type="button",u.addEventListener("click",a),u}},r.Popup=class extends o.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=vm(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!a)return;let u=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor,g=xm(this.options.offset);if(!f){let E=this._container.offsetWidth,S=this._container.offsetHeight,I=(function(P){var B,L,$,Y;return P?{top:(B=P.top)!==null&&B!==void 0?B:0,right:(L=P.right)!==null&&L!==void 0?L:0,bottom:($=P.bottom)!==null&&$!==void 0?$:0,left:(Y=P.left)!==null&&Y!==void 0?Y:0}:{top:0,right:0,bottom:0,left:0}})(this.options.padding),k;k=u.y+g.bottom.y<S+I.top?["top"]:u.y>this._map.transform.height-S-I.bottom?["bottom"]:[],u.x<E/2+I.left?k.push("left"):u.x>this._map.transform.width-E/2-I.right&&k.push("right"),f=k.length===0?"bottom":k.join("-")}let w=u.add(g[f]);this.options.subpixelPositioning||(w=w.round()),K.setTransform(this._container,`${af[f]} translate(${w.x}px,${w.y}px)`),bm(this._container,f,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Sy),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=o.V.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){let a=document.createDocumentFragment(),u=document.createElement("body"),f;for(u.innerHTML=v;f=u.firstChild,f;)a.appendChild(f);return this.setDOMContent(a)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}setPadding(v){this.options.padding=v,this._update()}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let v=this._container.querySelector(wm);v&&v.focus()}},r.RasterDEMTileSource=xa,r.RasterTileSource=ju,r.ScaleControl=class{constructor(v){this._onMove=()=>{cf(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,cf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ty),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},r.ScrollZoomHandler=pm,r.Style=Vc,r.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},r.TwoFingersTouchPitchHandler=Gw,r.TwoFingersTouchRotateHandler=yy,r.TwoFingersTouchZoomHandler=_y,r.TwoFingersTouchZoomRotateHandler=tf,r.VectorTileSource=Vu,r.VideoSource=Ll,r.addSourceType=(v,a)=>o._(void 0,void 0,void 0,function*(){if($u(v))throw new Error(`A source type called "${v}" already exists.`);((u,f)=>{Uu[u]=f})(v,a)}),r.clearPrewarmedResources=function(){let v=ls;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(_i),ls=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.createTileMesh=rw,r.getMaxParallelImageRequests=function(){return o.c.MAX_PARALLEL_IMAGE_REQUESTS},r.getRTLTextPluginStatus=function(){return X().getRTLTextPluginStatus()},r.getVersion=function(){return Dy},r.getWorkerCount=function(){return cr.workerCount},r.getWorkerUrl=function(){return o.c.WORKER_URL},r.importScriptInWorkers=function(v){return Yn().broadcast("IS",v)},r.isTimeFrozen=function(){return q.isFrozen()},r.now=J,r.prewarm=function(){mn().acquire(_i)},r.restoreNow=function(){q.restoreNow()},r.setMaxParallelImageRequests=function(v){o.c.MAX_PARALLEL_IMAGE_REQUESTS=v},r.setNow=function(v){q.setNow(v)},r.setRTLTextPlugin=function(v,a){return X().setRTLTextPlugin(v,a)},r.setWorkerCount=function(v){cr.workerCount=v},r.setWorkerUrl=function(v){o.c.WORKER_URL=v}});var i=n;return i})});var Qo=null,Dx=!1,UI=1,RK=null,gs=Symbol("SIGNAL");function Xt(n){let t=Qo;return Qo=n,t}function Mx(){return Qo}var Um={version:0,lastCleanEpoch:0,dirty:!1,producers:void 0,producersTail:void 0,consumers:void 0,consumersTail:void 0,recomputing:!1,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Yy(n){if(Dx)throw new Error("");if(Qo===null)return;Qo.consumerOnSignalRead(n);let t=Qo.producersTail;if(t!==void 0&&t.producer===n)return;let e,i=Qo.recomputing;if(i&&(e=t!==void 0?t.nextProducer:Qo.producers,e!==void 0&&e.producer===n)){Qo.producersTail=e,e.lastReadVersion=n.version;return}let r=n.consumersTail;if(r!==void 0&&r.consumer===Qo&&(!i||NK(r,Qo)))return;let o=Hm(Qo),d={producer:n,consumer:Qo,nextProducer:e,prevConsumer:r,lastReadVersion:n.version,nextConsumer:void 0};Qo.producersTail=d,t!==void 0?t.nextProducer=d:Qo.producers=d,o&&sV(n,d)}function iV(){UI++}function $I(n){if(!(Hm(n)&&!n.dirty)&&!(!n.dirty&&n.lastCleanEpoch===UI)){if(!n.producerMustRecompute(n)&&!Qy(n)){zI(n);return}n.producerRecomputeValue(n),zI(n)}}function HI(n){if(n.consumers===void 0)return;let t=Dx;Dx=!0;try{for(let e=n.consumers;e!==void 0;e=e.nextConsumer){let i=e.consumer;i.dirty||PK(i)}}finally{Dx=t}}function GI(){return Qo?.consumerAllowSignalWrites!==!1}function PK(n){n.dirty=!0,HI(n),n.consumerMarkedDirty?.(n)}function zI(n){n.dirty=!1,n.lastCleanEpoch=UI}function $m(n){return n&&rV(n),Xt(n)}function rV(n){n.producersTail=void 0,n.recomputing=!0}function Xy(n,t){Xt(t),n&&oV(n)}function oV(n){n.recomputing=!1;let t=n.producersTail,e=t!==void 0?t.nextProducer:n.producers;if(e!==void 0){if(Hm(n))do e=qI(e);while(e!==void 0);t!==void 0?t.nextProducer=void 0:n.producers=void 0}}function Qy(n){for(let t=n.producers;t!==void 0;t=t.nextProducer){let e=t.producer,i=t.lastReadVersion;if(i!==e.version||($I(e),i!==e.version))return!0}return!1}function bf(n){if(Hm(n)){let t=n.producers;for(;t!==void 0;)t=qI(t)}n.producers=void 0,n.producersTail=void 0,n.consumers=void 0,n.consumersTail=void 0}function sV(n,t){let e=n.consumersTail,i=Hm(n);if(e!==void 0?(t.nextConsumer=e.nextConsumer,e.nextConsumer=t):(t.nextConsumer=void 0,n.consumers=t),t.prevConsumer=e,n.consumersTail=t,!i)for(let r=n.producers;r!==void 0;r=r.nextProducer)sV(r.producer,r)}function qI(n){let t=n.producer,e=n.nextProducer,i=n.nextConsumer,r=n.prevConsumer;if(n.nextConsumer=void 0,n.prevConsumer=void 0,i!==void 0?i.prevConsumer=r:t.consumersTail=r,r!==void 0)r.nextConsumer=i;else if(t.consumers=i,!Hm(t)){let o=t.producers;for(;o!==void 0;)o=qI(o)}return e}function Hm(n){return n.consumerIsAlwaysLive||n.consumers!==void 0}function WI(n){RK?.(n)}function NK(n,t){let e=t.producersTail;if(e!==void 0){let i=t.producers;do{if(i===n)return!0;if(i===e)break;i=i.nextProducer}while(i!==void 0)}return!1}function ZI(n,t){return Object.is(n,t)}function Ax(n,t){let e=Object.create(OK);e.computation=n,t!==void 0&&(e.equal=t);let i=()=>{if($I(e),Yy(e),e.value===Ix)throw e.error;return e.value};return i[gs]=e,WI(e),i}var VI=Symbol("UNSET"),jI=Symbol("COMPUTING"),Ix=Symbol("ERRORED"),OK=Mt(Be({},Um),{value:VI,dirty:!0,error:null,equal:ZI,kind:"computed",producerMustRecompute(n){return n.value===VI||n.value===jI},producerRecomputeValue(n){if(n.value===jI)throw new Error("");let t=n.value;n.value=jI;let e=$m(n),i,r=!1;try{i=n.computation(),Xt(null),r=t!==VI&&t!==Ix&&i!==Ix&&n.equal(t,i)}catch(o){i=Ix,n.error=o}finally{Xy(n,e)}if(r){n.value=t;return}n.value=i,n.version++}});function FK(){throw new Error}var aV=FK;function lV(n){aV(n)}function KI(n){aV=n}var LK=null;function YI(n,t){let e=Object.create(kx);e.value=n,t!==void 0&&(e.equal=t);let i=()=>cV(e);return i[gs]=e,WI(e),[i,d=>Jy(e,d),d=>uV(e,d)]}function cV(n){return Yy(n),n.value}function Jy(n,t){GI()||lV(n),n.equal(n.value,t)||(n.value=t,BK(n))}function uV(n,t){GI()||lV(n),Jy(n,t(n.value))}var kx=Mt(Be({},Um),{equal:ZI,value:void 0,kind:"signal"});function BK(n){n.version++,iV(),HI(n),LK?.(n)}function XI(n){let t=Xt(null);try{return n()}finally{Xt(t)}}var QI=Mt(Be({},Um),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,kind:"effect"});function JI(n){if(n.dirty=!1,n.version>0&&!Qy(n))return;n.version++;let t=$m(n);try{n.cleanup(),n.fn()}finally{Xy(n,t)}}function wn(n){return typeof n=="function"}function Gm(n){let e=n(i=>{Error.call(i),i.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Rx=Gm(n=>function(e){n(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((i,r)=>`${r+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function wf(n,t){if(n){let e=n.indexOf(t);0<=e&&n.splice(e,1)}}var Gn=class n{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let o of e)o.remove(this);else e.remove(this);let{initialTeardown:i}=this;if(wn(i))try{i()}catch(o){t=o instanceof Rx?o.errors:[o]}let{_teardowns:r}=this;if(r){this._teardowns=null;for(let o of r)try{dV(o)}catch(d){t=t??[],d instanceof Rx?t=[...t,...d.errors]:t.push(d)}}if(t)throw new Rx(t)}}add(t){var e;if(t&&t!==this)if(this.closed)dV(t);else{if(t instanceof n){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=(e=this._teardowns)!==null&&e!==void 0?e:[]).push(t)}}_hasParent(t){let{_parentage:e}=this;return e===t||Array.isArray(e)&&e.includes(t)}_addParent(t){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t}_removeParent(t){let{_parentage:e}=this;e===t?this._parentage=null:Array.isArray(e)&&wf(e,t)}remove(t){let{_teardowns:e}=this;e&&wf(e,t),t instanceof n&&t._removeParent(this)}};Gn.EMPTY=(()=>{let n=new Gn;return n.closed=!0,n})();var eM=Gn.EMPTY;function Px(n){return n instanceof Gn||n&&"closed"in n&&wn(n.remove)&&wn(n.add)&&wn(n.unsubscribe)}function dV(n){wn(n)?n():n.unsubscribe()}var ul={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var qm={setTimeout(...n){let{delegate:t}=qm;return(t?.setTimeout||setTimeout)(...n)},clearTimeout(n){let{delegate:t}=qm;return(t?.clearTimeout||clearTimeout)(n)},delegate:void 0};function Nx(n){qm.setTimeout(()=>{let{onUnhandledError:t}=ul;if(t)t(n);else throw n})}function iu(){}var hV=tM("C",void 0,void 0);function fV(n){return tM("E",void 0,n)}function pV(n){return tM("N",n,void 0)}function tM(n,t,e){return{kind:n,value:t,error:e}}var xf=null;function Wm(n){if(ul.useDeprecatedSynchronousErrorHandling){let t=!xf;if(t&&(xf={errorThrown:!1,error:null}),n(),t){let{errorThrown:e,error:i}=xf;if(xf=null,e)throw i}}else n()}function mV(n){ul.useDeprecatedSynchronousErrorHandling&&xf&&(xf.errorThrown=!0,xf.error=n)}var Ef=class extends Gn{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Px(t)&&t.add(this)):this.destination=VK}static create(t,e,i){return new ev(t,e,i)}next(t){this.isStopped?iM(pV(t),this):this._next(t)}error(t){this.isStopped?iM(fV(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?iM(hV,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},ev=class extends Ef{constructor(t,e,i){super();let r;if(wn(t))r=t;else if(t){({next:r,error:e,complete:i}=t);let o;this&&ul.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe()):o=t,r=r?.bind(o),e=e?.bind(o),i=i?.bind(o)}this.destination={next:r?nM(r,this):iu,error:nM(e??gV,this),complete:i?nM(i,this):iu}}};function nM(n,t){return(...e)=>{try{n(...e)}catch(i){ul.useDeprecatedSynchronousErrorHandling?mV(i):Nx(i)}}}function gV(n){throw n}function iM(n,t){let{onStoppedNotification:e}=ul;e&&qm.setTimeout(()=>e(n,t))}var VK={closed:!0,next:iu,error:gV,complete:iu};var Zm=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ia(n){return n}function rM(...n){return oM(n)}function oM(n){return n.length===0?ia:n.length===1?n[0]:function(e){return n.reduce((i,r)=>r(i),e)}}var Kt=(()=>{class n{constructor(e){e&&(this._subscribe=e)}lift(e){let i=new n;return i.source=this,i.operator=e,i}subscribe(e,i,r){let o=zK(e)?e:new ev(e,i,r);return Wm(()=>{let{operator:d,source:m}=this;o.add(d?d.call(o,m):m?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(e){try{return this._subscribe(e)}catch(i){e.error(i)}}forEach(e,i){return i=_V(i),new i((r,o)=>{let d;d=this.subscribe(m=>{try{e(m)}catch(b){o(b),d?.unsubscribe()}},o,r)})}_subscribe(e){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(e)}[Zm](){return this}pipe(...e){return oM(e)(this)}toPromise(e){return e=_V(e),new e((i,r)=>{let o;this.subscribe(d=>o=d,d=>r(d),()=>i(o))})}}return n.create=t=>new n(t),n})();function _V(n){var t;return(t=n??ul.Promise)!==null&&t!==void 0?t:Promise}function jK(n){return n&&wn(n.next)&&wn(n.error)&&wn(n.complete)}function zK(n){return n&&n instanceof Ef||jK(n)&&Px(n)}function UK(n){return wn(n?.lift)}function Bn(n){return t=>{if(UK(t))return t.lift(function(e){try{return n(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}var An=class extends Ef{constructor(t,e,i,r,o){super(t),this.onFinalize=o,this._next=e?function(d){try{e(d)}catch(m){t.error(m)}}:super._next,this._error=r?function(d){try{r(d)}catch(m){t.error(m)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(d){t.error(d)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;let{closed:e}=this;super.unsubscribe(),!e&&((t=this.onFinalize)===null||t===void 0||t.call(this))}};var Km={schedule(n){let t=requestAnimationFrame,e=cancelAnimationFrame,{delegate:i}=Km;i&&(t=i.requestAnimationFrame,e=i.cancelAnimationFrame);let r=t(o=>{e=void 0,n(o)});return new Gn(()=>e?.(r))},requestAnimationFrame(...n){let{delegate:t}=Km;return(t?.requestAnimationFrame||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){let{delegate:t}=Km;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...n)},delegate:void 0};var yV=Gm(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var yt=(()=>{class n extends Kt{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let i=new Ox(this,this);return i.operator=e,i}_throwIfClosed(){if(this.closed)throw new yV}next(e){Wm(()=>{if(this._throwIfClosed(),!this.isStopped){let i=this.observers.slice();for(let r of i)r.next(e)}})}error(e){Wm(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:i}=this;for(;i.length;)i.shift().error(e)}})}complete(){Wm(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:i,isStopped:r,observers:o}=this;return i||r?eM:(o.push(e),new Gn(()=>wf(o,e)))}_checkFinalizedStatuses(e){let{hasError:i,thrownError:r,isStopped:o}=this;i?e.error(r):o&&e.complete()}asObservable(){let e=new Kt;return e.source=this,e}}return n.create=(t,e)=>new Ox(t,e),n})(),Ox=class extends yt{constructor(t,e){super(),this.destination=t,this.source=e}next(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.next)===null||i===void 0||i.call(e,t)}error(t){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.error)===null||i===void 0||i.call(e,t)}complete(){var t,e;(e=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||e===void 0||e.call(t)}_subscribe(t){var e,i;return(i=(e=this.source)===null||e===void 0?void 0:e.subscribe(t))!==null&&i!==void 0?i:eM}};var Fr=class extends yt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){let e=super._subscribe(t);return!e.closed&&t.next(this._value),e}getValue(){let{hasError:t,thrownError:e,_value:i}=this;if(t)throw e;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}};var tv={now(){return(tv.delegate||Date).now()},delegate:void 0};var Ym=class extends yt{constructor(t=1/0,e=1/0,i=tv){super(),this._bufferSize=t,this._windowTime=e,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=e===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,e)}next(t){let{isStopped:e,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:o,_windowTime:d}=this;e||(i.push(t),!r&&i.push(o.now()+d)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();let e=this._innerSubscribe(t),{_infiniteTimeWindow:i,_buffer:r}=this,o=r.slice();for(let d=0;d<o.length&&!t.closed;d+=i?1:2)t.next(o[d]);return this._checkFinalizedStatuses(t),e}_trimBuffer(){let{_bufferSize:t,_timestampProvider:e,_buffer:i,_infiniteTimeWindow:r}=this,o=(r?1:2)*t;if(t<1/0&&o<i.length&&i.splice(0,i.length-o),!r){let d=e.now(),m=0;for(let b=1;b<i.length&&i[b]<=d;b+=2)m=b;m&&i.splice(0,m+1)}}};var Fx=class extends Gn{constructor(t,e){super()}schedule(t,e=0){return this}};var nv={setInterval(...n){let{delegate:t}=nv;return(t?.setInterval||setInterval)(...n)},clearInterval(n){let{delegate:t}=nv;return(t?.clearInterval||clearInterval)(n)},delegate:void 0};var Xm=class extends Fx{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;let i=this.id,r=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(r,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,i=0){return nv.setInterval(t.flush.bind(t,this),i)}recycleAsyncId(t,e,i=0){if(i!=null&&this.delay===i&&this.pending===!1)return e;nv.clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let i=this._execute(t,e);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let i=!1,r;try{this.work(t)}catch(o){i=!0,r=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){let{id:t,scheduler:e}=this,{actions:i}=e;this.work=this.state=this.scheduler=null,this.pending=!1,wf(i,this),t!=null&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null,super.unsubscribe()}}};var Qm=class n{constructor(t,e=n.now){this.schedulerActionCtor=t,this.now=e}schedule(t,e=0,i){return new this.schedulerActionCtor(this,t).schedule(i,e)}};Qm.now=tv.now;var Jm=class extends Qm{constructor(t,e=Qm.now){super(t,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(t){let{actions:e}=this;if(this._active){e.push(t);return}let i;this._active=!0;do if(i=t.execute(t.state,t.delay))break;while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}};var iv=new Jm(Xm),Lx=iv;var Bx=class extends Xm{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,i=0){return i!==null&&i>0?super.requestAsyncId(t,e,i):(t.actions.push(this),t._scheduled||(t._scheduled=Km.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,e,i=0){if(i!=null&&i>0||i==null&&this.delay>0)return super.recycleAsyncId(t,e,i);t.actions.length===0&&(Km.cancelAnimationFrame(e),t._scheduled=void 0)}};var Vx=class extends Jm{flush(t){this._active=!0,this._scheduled=void 0;let{actions:e}=this,i,r=-1;t=t||e.shift();let o=e.length;do if(i=t.execute(t.state,t.delay))break;while(++r<o&&(t=e.shift()));if(this._active=!1,i){for(;++r<o&&(t=e.shift());)t.unsubscribe();throw i}}};var jx=new Vx(Bx);var ro=new Kt(n=>n.complete());function zx(n){return n&&wn(n.schedule)}function sM(n){return n[n.length-1]}function Ux(n){return wn(sM(n))?n.pop():void 0}function Ql(n){return zx(sM(n))?n.pop():void 0}function vV(n,t){return typeof sM(n)=="number"?n.pop():t}var zV=Sx(jV(),1),{__extends:D0e,__assign:I0e,__rest:M0e,__decorate:A0e,__param:k0e,__metadata:R0e,__awaiter:UV,__generator:P0e,__exportStar:N0e,__createBinding:O0e,__values:F0e,__read:L0e,__spread:B0e,__spreadArrays:V0e,__spreadArray:j0e,__await:qx,__asyncGenerator:$V,__asyncDelegator:z0e,__asyncValues:HV,__makeTemplateObject:U0e,__importStar:$0e,__importDefault:H0e,__classPrivateFieldGet:G0e,__classPrivateFieldSet:q0e}=zV.default;var Wx=n=>n&&typeof n.length=="number"&&typeof n!="function";function Zx(n){return wn(n?.then)}function Kx(n){return wn(n[Zm])}function Yx(n){return Symbol.asyncIterator&&wn(n?.[Symbol.asyncIterator])}function Xx(n){return new TypeError(`You provided ${n!==null&&typeof n=="object"?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function $K(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Qx=$K();function Jx(n){return wn(n?.[Qx])}function eE(n){return $V(this,arguments,function*(){let e=n.getReader();try{for(;;){let{value:i,done:r}=yield qx(e.read());if(r)return yield qx(void 0);yield yield qx(i)}}finally{e.releaseLock()}})}function tE(n){return wn(n?.getReader)}function sr(n){if(n instanceof Kt)return n;if(n!=null){if(Kx(n))return HK(n);if(Wx(n))return GK(n);if(Zx(n))return qK(n);if(Yx(n))return GV(n);if(Jx(n))return WK(n);if(tE(n))return ZK(n)}throw Xx(n)}function HK(n){return new Kt(t=>{let e=n[Zm]();if(wn(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function GK(n){return new Kt(t=>{for(let e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()})}function qK(n){return new Kt(t=>{n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,Nx)})}function WK(n){return new Kt(t=>{for(let e of n)if(t.next(e),t.closed)return;t.complete()})}function GV(n){return new Kt(t=>{KK(n,t).catch(e=>t.error(e))})}function ZK(n){return GV(eE(n))}function KK(n,t){var e,i,r,o;return UV(this,void 0,void 0,function*(){try{for(e=HV(n);i=yield e.next(),!i.done;){let d=i.value;if(t.next(d),t.closed)return}}catch(d){r={error:d}}finally{try{i&&!i.done&&(o=e.return)&&(yield o.call(e))}finally{if(r)throw r.error}}t.complete()})}function Ls(n,t,e,i=0,r=!1){let o=t.schedule(function(){e(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(o),!r)return o}function nE(n,t=0){return Bn((e,i)=>{e.subscribe(new An(i,r=>Ls(i,n,()=>i.next(r),t),()=>Ls(i,n,()=>i.complete(),t),r=>Ls(i,n,()=>i.error(r),t)))})}function iE(n,t=0){return Bn((e,i)=>{i.add(n.schedule(()=>e.subscribe(i),t))})}function qV(n,t){return sr(n).pipe(iE(t),nE(t))}function WV(n,t){return sr(n).pipe(iE(t),nE(t))}function ZV(n,t){return new Kt(e=>{let i=0;return t.schedule(function(){i===n.length?e.complete():(e.next(n[i++]),e.closed||this.schedule())})})}function KV(n,t){return new Kt(e=>{let i;return Ls(e,t,()=>{i=n[Qx](),Ls(e,t,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(d){e.error(d);return}o?e.complete():e.next(r)},0,!0)}),()=>wn(i?.return)&&i.return()})}function rE(n,t){if(!n)throw new Error("Iterable cannot be null");return new Kt(e=>{Ls(e,t,()=>{let i=n[Symbol.asyncIterator]();Ls(e,t,()=>{i.next().then(r=>{r.done?e.complete():e.next(r.value)})},0,!0)})})}function YV(n,t){return rE(eE(n),t)}function XV(n,t){if(n!=null){if(Kx(n))return qV(n,t);if(Wx(n))return ZV(n,t);if(Zx(n))return WV(n,t);if(Yx(n))return rE(n,t);if(Jx(n))return KV(n,t);if(tE(n))return YV(n,t)}throw Xx(n)}function Bi(n,t){return t?XV(n,t):sr(n)}function Jt(...n){let t=Ql(n);return Bi(n,t)}function lM(n,t){let e=wn(n)?n:()=>n,i=r=>r.error(e());return new Kt(t?r=>t.schedule(i,0,r):i)}function rv(n){return!!n&&(n instanceof Kt||wn(n.lift)&&wn(n.subscribe))}var Cf=Gm(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function QV(n){return n instanceof Date&&!isNaN(n)}function Tn(n,t){return Bn((e,i)=>{let r=0;e.subscribe(new An(i,o=>{i.next(n.call(t,o,r++))}))})}var{isArray:YK}=Array;function XK(n,t){return YK(t)?n(...t):n(t)}function oE(n){return Tn(t=>XK(n,t))}var{isArray:QK}=Array,{getPrototypeOf:JK,prototype:eY,keys:tY}=Object;function sE(n){if(n.length===1){let t=n[0];if(QK(t))return{args:t,keys:null};if(nY(t)){let e=tY(t);return{args:e.map(i=>t[i]),keys:e}}}return{args:n,keys:null}}function nY(n){return n&&typeof n=="object"&&JK(n)===eY}function aE(n,t){return n.reduce((e,i,r)=>(e[i]=t[r],e),{})}function tg(...n){let t=Ql(n),e=Ux(n),{args:i,keys:r}=sE(n);if(i.length===0)return Bi([],t);let o=new Kt(iY(i,t,r?d=>aE(r,d):ia));return e?o.pipe(oE(e)):o}function iY(n,t,e=ia){return i=>{JV(t,()=>{let{length:r}=n,o=new Array(r),d=r,m=r;for(let b=0;b<r;b++)JV(t,()=>{let T=Bi(n[b],t),A=!1;T.subscribe(new An(i,N=>{o[b]=N,A||(A=!0,m--),m||i.next(e(o.slice()))},()=>{--d||i.complete()}))},i)},i)}}function JV(n,t,e){n?Ls(e,n,t):t()}function e3(n,t,e,i,r,o,d,m){let b=[],T=0,A=0,N=!1,q=()=>{N&&!b.length&&!T&&t.complete()},J=xe=>T<i?K(xe):b.push(xe),K=xe=>{o&&t.next(xe),T++;let Te=!1;sr(e(xe,A++)).subscribe(new An(t,Ge=>{r?.(Ge),o?J(Ge):t.next(Ge)},()=>{Te=!0},void 0,()=>{if(Te)try{for(T--;b.length&&T<i;){let Ge=b.shift();d?Ls(t,d,()=>K(Ge)):K(Ge)}q()}catch(Ge){t.error(Ge)}}))};return n.subscribe(new An(t,J,()=>{N=!0,q()})),()=>{m?.()}}function Lo(n,t,e=1/0){return wn(t)?Lo((i,r)=>Tn((o,d)=>t(i,o,r,d))(sr(n(i,r))),e):(typeof t=="number"&&(e=t),Bn((i,r)=>e3(i,r,n,e)))}function Jl(n=1/0){return Lo(ia,n)}function t3(){return Jl(1)}function xd(...n){return t3()(Bi(n,Ql(n)))}function ru(n){return new Kt(t=>{sr(n()).subscribe(t)})}function cM(...n){let t=Ux(n),{args:e,keys:i}=sE(n),r=new Kt(o=>{let{length:d}=e;if(!d){o.complete();return}let m=new Array(d),b=d,T=d;for(let A=0;A<d;A++){let N=!1;sr(e[A]).subscribe(new An(o,q=>{N||(N=!0,T--),m[A]=q},()=>b--,void 0,()=>{(!b||!N)&&(T||o.next(i?aE(i,m):m),o.complete())}))}});return t?r.pipe(oE(t)):r}function lE(n=0,t,e=Lx){let i=-1;return t!=null&&(zx(t)?e=t:i=t),new Kt(r=>{let o=QV(n)?+n-e.now():n;o<0&&(o=0);let d=0;return e.schedule(function(){r.closed||(r.next(d++),0<=i?this.schedule(void 0,i):r.complete())},o)})}function ov(n=0,t=iv){return n<0&&(n=0),lE(n,n,t)}function Tf(...n){let t=Ql(n),e=vV(n,1/0),i=n;return i.length?i.length===1?sr(i[0]):Jl(e)(Bi(i,t)):ro}var ou=new Kt(iu);function mi(n,t){return Bn((e,i)=>{let r=0;e.subscribe(new An(i,o=>n.call(t,o,r++)&&i.next(o)))})}function n3(n){return Bn((t,e)=>{let i=!1,r=null,o=null,d=!1,m=()=>{if(o?.unsubscribe(),o=null,i){i=!1;let T=r;r=null,e.next(T)}d&&e.complete()},b=()=>{o=null,d&&e.complete()};t.subscribe(new An(e,T=>{i=!0,r=T,o||sr(n(T)).subscribe(o=new An(e,m,b))},()=>{d=!0,(!i||!o||o.closed)&&e.complete()}))})}function cE(n,t=Lx){return n3(()=>lE(n,t))}function ng(n){return Bn((t,e)=>{let i=null,r=!1,o;i=t.subscribe(new An(e,void 0,void 0,d=>{o=sr(n(d,ng(n)(t))),i?(i.unsubscribe(),i=null,o.subscribe(e)):r=!0})),r&&(i.unsubscribe(),i=null,o.subscribe(e))})}function Ed(n,t){return wn(t)?Lo(n,t,1):Lo(n,1)}function uM(n,t=iv){return Bn((e,i)=>{let r=null,o=null,d=null,m=()=>{if(r){r.unsubscribe(),r=null;let T=o;o=null,i.next(T)}};function b(){let T=d+n,A=t.now();if(A<T){r=this.schedule(void 0,T-A),i.add(r);return}m()}e.subscribe(new An(i,T=>{o=T,d=t.now(),r||(r=t.schedule(b,n),i.add(r))},()=>{m(),i.complete()},void 0,()=>{o=r=null}))})}function i3(n){return Bn((t,e)=>{let i=!1;t.subscribe(new An(e,r=>{i=!0,e.next(r)},()=>{i||e.next(n),e.complete()}))})}function Xi(n){return n<=0?()=>ro:Bn((t,e)=>{let i=0;t.subscribe(new An(e,r=>{++i<=n&&(e.next(r),n<=i&&e.complete())}))})}function uE(n,t=ia){return n=n??rY,Bn((e,i)=>{let r,o=!0;e.subscribe(new An(i,d=>{let m=t(d);(o||!n(r,m))&&(o=!1,r=m,i.next(d))}))})}function rY(n,t){return n===t}function r3(n=oY){return Bn((t,e)=>{let i=!1;t.subscribe(new An(e,r=>{i=!0,e.next(r)},()=>i?e.complete():e.error(n())))})}function oY(){return new Cf}function sv(n){return Bn((t,e)=>{try{t.subscribe(e)}finally{e.add(n)}})}function su(n,t){let e=arguments.length>=2;return i=>i.pipe(n?mi((r,o)=>n(r,o,i)):ia,Xi(1),e?i3(t):r3(()=>new Cf))}function dE(n){return n<=0?()=>ro:Bn((t,e)=>{let i=[];t.subscribe(new An(e,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(let r of i)e.next(r);e.complete()},void 0,()=>{i=null}))})}function av(n){return mi((t,e)=>n<=e)}function ra(...n){let t=Ql(n);return Bn((e,i)=>{(t?xd(n,e,t):xd(n,e)).subscribe(i)})}function Kr(n,t){return Bn((e,i)=>{let r=null,o=0,d=!1,m=()=>d&&!r&&i.complete();e.subscribe(new An(i,b=>{r?.unsubscribe();let T=0,A=o++;sr(n(b,A)).subscribe(r=new An(i,N=>i.next(t?t(b,N,A,T++):N),()=>{r=null,m()}))},()=>{d=!0,m()}))})}function Bo(n){return Bn((t,e)=>{sr(n).subscribe(new An(e,()=>e.complete(),iu)),!e.closed&&t.subscribe(e)})}function Ia(n,t,e){let i=wn(n)||t||e?{next:n,error:t,complete:e}:n;return i?Bn((r,o)=>{var d;(d=i.subscribe)===null||d===void 0||d.call(i);let m=!0;r.subscribe(new An(o,b=>{var T;(T=i.next)===null||T===void 0||T.call(i,b),o.next(b)},()=>{var b;m=!1,(b=i.complete)===null||b===void 0||b.call(i),o.complete()},b=>{var T;m=!1,(T=i.error)===null||T===void 0||T.call(i,b),o.error(b)},()=>{var b,T;m&&((b=i.unsubscribe)===null||b===void 0||b.call(i)),(T=i.finalize)===null||T===void 0||T.call(i)}))}):ia}var dM;function hE(){return dM}function ec(n){let t=dM;return dM=n,t}var o3=Symbol("NotFound");function ig(n){return n===o3||n?.name==="\u0275NotFound"}var vE="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss",Je=class extends Error{code;constructor(t,e){super(Ma(t,e)),this.code=t}};function sY(n){return`NG0${Math.abs(n)}`}function Ma(n,t){return`${sY(n)}${t?": "+t:""}`}var Aa=globalThis;function oi(n){for(let t in n)if(n[t]===oi)return t;throw Error("")}function u3(n,t){for(let e in t)t.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&(n[e]=t[e])}function lu(n){if(typeof n=="string")return n;if(Array.isArray(n))return`[${n.map(lu).join(", ")}]`;if(n==null)return""+n;let t=n.overriddenName||n.name;if(t)return`${t}`;let e=n.toString();if(e==null)return""+e;let i=e.indexOf(`
`);return i>=0?e.slice(0,i):e}function bE(n,t){return n?t?`${n} ${t}`:n:t||""}var aY=oi({__forward_ref__:oi});function jo(n){return n.__forward_ref__=jo,n.toString=function(){return lu(this())},n}function Vo(n){return CM(n)?n():n}function CM(n){return typeof n=="function"&&n.hasOwnProperty(aY)&&n.__forward_ref__===jo}function ze(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Dn(n){return{providers:n.providers||[],imports:n.imports||[]}}function pv(n){return lY(n,wE)}function TM(n){return pv(n)!==null}function lY(n,t){return n.hasOwnProperty(t)&&n[t]||null}function cY(n){let t=n?.[wE]??null;return t||null}function fM(n){return n&&n.hasOwnProperty(pE)?n[pE]:null}var wE=oi({\u0275prov:oi}),pE=oi({\u0275inj:oi}),rt=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,e){this._desc=t,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=ze({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function SM(n){return n&&!!n.\u0275providers}var DM=oi({\u0275cmp:oi}),IM=oi({\u0275dir:oi}),MM=oi({\u0275pipe:oi}),AM=oi({\u0275mod:oi}),cv=oi({\u0275fac:oi}),Af=oi({__NG_ELEMENT_ID__:oi}),s3=oi({__NG_ENV_ID__:oi});function kM(n){return xE(n,"@NgModule"),n[AM]||null}function ic(n){return xE(n,"@Component"),n[DM]||null}function RM(n){return xE(n,"@Directive"),n[IM]||null}function d3(n){return xE(n,"@Pipe"),n[MM]||null}function xE(n,t){if(n==null)throw new Je(-919,!1)}function oa(n){return typeof n=="string"?n:n==null?"":String(n)}var h3=oi({ngErrorCode:oi}),uY=oi({ngErrorMessage:oi}),dY=oi({ngTokenPath:oi});function PM(n,t){return f3("",-200,t)}function EE(n,t){throw new Je(-201,!1)}function f3(n,t,e){let i=new Je(t,n);return i[h3]=t,i[uY]=n,e&&(i[dY]=e),i}function hY(n){return n[h3]}var pM;function p3(){return pM}function _s(n){let t=pM;return pM=n,t}function NM(n,t,e){let i=pv(n);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(e&8)return null;if(t!==void 0)return t;EE(n,"")}var fY={},Sf=fY,pY="__NG_DI_FLAG__",mM=class{injector;constructor(t){this.injector=t}retrieve(t,e){let i=Df(e)||0;try{return this.injector.get(t,i&8?null:Sf,i)}catch(r){if(ig(r))return r;throw r}}};function mY(n,t=0){let e=hE();if(e===void 0)throw new Je(-203,!1);if(e===null)return NM(n,void 0,t);{let i=gY(t),r=e.retrieve(n,i);if(ig(r)){if(i.optional)return null;throw r}return r}}function vt(n,t=0){return(p3()||mY)(Vo(n),t)}function se(n,t){return vt(n,Df(t))}function Df(n){return typeof n>"u"||typeof n=="number"?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function gY(n){return{optional:!!(n&8),host:!!(n&1),self:!!(n&2),skipSelf:!!(n&4)}}function gM(n){let t=[];for(let e=0;e<n.length;e++){let i=Vo(n[e]);if(Array.isArray(i)){if(i.length===0)throw new Je(900,!1);let r,o=0;for(let d=0;d<i.length;d++){let m=i[d],b=_Y(m);typeof b=="number"?b===-1?r=m.token:o|=b:r=m}t.push(vt(r,o))}else t.push(vt(i))}return t}function _Y(n){return n[pY]}function Cd(n,t){let e=n.hasOwnProperty(cv);return e?n[cv]:null}function m3(n,t,e){if(n.length!==t.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],o=t[i];if(e&&(r=e(r),o=e(o)),o!==r)return!1}return!0}function g3(n){return n.flat(Number.POSITIVE_INFINITY)}function CE(n,t){n.forEach(e=>Array.isArray(e)?CE(e,t):t(e))}function OM(n,t,e){t>=n.length?n.push(e):n.splice(t,0,e)}function mv(n,t){return t>=n.length-1?n.pop():n.splice(t,1)[0]}function _3(n,t){let e=[];for(let i=0;i<n;i++)e.push(t);return e}function y3(n,t,e,i){let r=n.length;if(r==t)n.push(e,i);else if(r===1)n.push(i,n[0]),n[0]=e;else{for(r--,n.push(n[r-1],n[r]);r>t;){let o=r-2;n[r]=n[o],r--}n[t]=e,n[t+1]=i}}function TE(n,t,e){let i=og(n,t);return i>=0?n[i|1]=e:(i=~i,y3(n,i,t,e)),i}function SE(n,t){let e=og(n,t);if(e>=0)return n[e|1]}function og(n,t){return yY(n,t,1)}function yY(n,t,e){let i=0,r=n.length>>e;for(;r!==i;){let o=i+(r-i>>1),d=n[o<<e];if(t===d)return o<<e;d>t?r=o:i=o+1}return~(r<<e)}var Dd={},ys=[],cu=new rt(""),FM=new rt("",-1),LM=new rt(""),uv=class{get(t,e=Sf){if(e===Sf){let r=f3("",-201);throw r.name="\u0275NotFound",r}return e}};function dl(n){return{\u0275providers:n}}function DE(...n){return{\u0275providers:BM(!0,n),\u0275fromNgModule:!0}}function BM(n,...t){let e=[],i=new Set,r,o=d=>{e.push(d)};return CE(t,d=>{let m=d;mE(m,o,[],i)&&(r||=[],r.push(m))}),r!==void 0&&v3(r,o),e}function v3(n,t){for(let e=0;e<n.length;e++){let{ngModule:i,providers:r}=n[e];VM(r,o=>{t(o,i)})}}function mE(n,t,e,i){if(n=Vo(n),!n)return!1;let r=null,o=fM(n),d=!o&&ic(n);if(!o&&!d){let b=n.ngModule;if(o=fM(b),o)r=b;else return!1}else{if(d&&!d.standalone)return!1;r=n}let m=i.has(r);if(d){if(m)return!1;if(i.add(r),d.dependencies){let b=typeof d.dependencies=="function"?d.dependencies():d.dependencies;for(let T of b)mE(T,t,e,i)}}else if(o){if(o.imports!=null&&!m){i.add(r);let T;CE(o.imports,A=>{mE(A,t,e,i)&&(T||=[],T.push(A))}),T!==void 0&&v3(T,t)}if(!m){let T=Cd(r)||(()=>new r);t({provide:r,useFactory:T,deps:ys},r),t({provide:LM,useValue:r,multi:!0},r),t({provide:cu,useValue:()=>vt(r),multi:!0},r)}let b=o.providers;if(b!=null&&!m){let T=n;VM(b,A=>{t(A,T)})}}else return!1;return r!==n&&n.providers!==void 0}function VM(n,t){for(let e of n)SM(e)&&(e=e.\u0275providers),Array.isArray(e)?VM(e,t):t(e)}var vY=oi({provide:String,useValue:oi});function b3(n){return n!==null&&typeof n=="object"&&vY in n}function bY(n){return!!(n&&n.useExisting)}function wY(n){return!!(n&&n.useFactory)}function If(n){return typeof n=="function"}function w3(n){return!!n.useClass}var gv=new rt(""),fE={},a3={},hM;function sg(){return hM===void 0&&(hM=new uv),hM}var si=class{},Mf=class extends si{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,e,i,r){super(),this.parent=e,this.source=i,this.scopes=r,yM(t,d=>this.processProvider(d)),this.records.set(FM,rg(void 0,this)),r.has("environment")&&this.records.set(si,rg(void 0,this));let o=this.records.get(gv);o!=null&&typeof o.value=="string"&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(LM,ys,{self:!0}))}retrieve(t,e){let i=Df(e)||0;try{return this.get(t,Sf,i)}catch(r){if(ig(r))return r;throw r}}destroy(){lv(this),this._destroyed=!0;let t=Xt(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of e)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Xt(t)}}onDestroy(t){return lv(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){lv(this);let e=ec(this),i=_s(void 0),r;try{return t()}finally{ec(e),_s(i)}}get(t,e=Sf,i){if(lv(this),t.hasOwnProperty(s3))return t[s3](this);let r=Df(i),o,d=ec(this),m=_s(void 0);try{if(!(r&4)){let T=this.records.get(t);if(T===void 0){let A=SY(t)&&pv(t);A&&this.injectableDefInScope(A)?T=rg(_M(t),fE):T=null,this.records.set(t,T)}if(T!=null)return this.hydrate(t,T,r)}let b=r&2?sg():this.parent;return e=r&8&&e===Sf?null:e,b.get(t,e)}catch(b){let T=hY(b);throw T===-200||T===-201?new Je(T,null):b}finally{_s(m),ec(d)}}resolveInjectorInitializers(){let t=Xt(null),e=ec(this),i=_s(void 0),r;try{let o=this.get(cu,ys,{self:!0});for(let d of o)d()}finally{ec(e),_s(i),Xt(t)}}toString(){let t=[],e=this.records;for(let i of e.keys())t.push(lu(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){t=Vo(t);let e=If(t)?t:Vo(t&&t.provide),i=EY(t);if(!If(t)&&t.multi===!0){let r=this.records.get(e);r||(r=rg(void 0,fE,!0),r.factory=()=>gM(r.multi),this.records.set(e,r)),e=t,r.multi.push(t)}this.records.set(e,i)}hydrate(t,e,i){let r=Xt(null);try{if(e.value===a3)throw PM(lu(t));return e.value===fE&&(e.value=a3,e.value=e.factory(void 0,i)),typeof e.value=="object"&&e.value&&TY(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Xt(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;let e=Vo(t.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(t){let e=this._onDestroyHooks.indexOf(t);e!==-1&&this._onDestroyHooks.splice(e,1)}};function _M(n){let t=pv(n),e=t!==null?t.factory:Cd(n);if(e!==null)return e;if(n instanceof rt)throw new Je(204,!1);if(n instanceof Function)return xY(n);throw new Je(204,!1)}function xY(n){if(n.length>0)throw new Je(204,!1);let e=cY(n);return e!==null?()=>e.factory(n):()=>new n}function EY(n){if(b3(n))return rg(void 0,n.useValue);{let t=jM(n);return rg(t,fE)}}function jM(n,t,e){let i;if(If(n)){let r=Vo(n);return Cd(r)||_M(r)}else if(b3(n))i=()=>Vo(n.useValue);else if(wY(n))i=()=>n.useFactory(...gM(n.deps||[]));else if(bY(n))i=(r,o)=>vt(Vo(n.useExisting),o!==void 0&&o&8?8:void 0);else{let r=Vo(n&&(n.useClass||n.provide));if(CY(n))i=()=>new r(...gM(n.deps));else return Cd(r)||_M(r)}return i}function lv(n){if(n.destroyed)throw new Je(205,!1)}function rg(n,t,e=!1){return{factory:n,value:t,multi:e?[]:void 0}}function CY(n){return!!n.deps}function TY(n){return n!==null&&typeof n=="object"&&typeof n.ngOnDestroy=="function"}function SY(n){return typeof n=="function"||typeof n=="object"&&n.ngMetadataName==="InjectionToken"}function yM(n,t){for(let e of n)Array.isArray(e)?yM(e,t):e&&SM(e)?yM(e.\u0275providers,t):t(e)}function so(n,t){let e;n instanceof Mf?(lv(n),e=n):e=new mM(n);let i,r=ec(e),o=_s(void 0);try{return t()}finally{ec(r),_s(o)}}function x3(){return p3()!==void 0||hE()!=null}var hl=0,Qt=1,fn=2,oo=3,ka=4,vs=5,kf=6,ag=7,Lr=8,uu=9,rc=10,ki=11,lg=12,zM=13,Rf=14,bs=15,Id=16,Pf=17,oc=18,du=19,UM=20,au=21,IE=22,Td=23,sa=24,Nf=25,Of=26,xr=27,E3=1,$M=6,Md=7,_v=8,Ff=9,Er=10;function sc(n){return Array.isArray(n)&&typeof n[E3]=="object"}function fl(n){return Array.isArray(n)&&n[E3]===!0}function HM(n){return(n.flags&4)!==0}function Ad(n){return n.componentOffset>-1}function yv(n){return(n.flags&1)===1}function ac(n){return!!n.template}function cg(n){return(n[fn]&512)!==0}function Lf(n){return(n[fn]&256)===256}var GM="svg",C3="math";function Ra(n){for(;Array.isArray(n);)n=n[hl];return n}function qM(n,t){return Ra(t[n])}function pl(n,t){return Ra(t[n.index])}function vv(n,t){return n.data[t]}function T3(n,t){return n[t]}function WM(n,t,e,i){e>=n.data.length&&(n.data[e]=null,n.blueprint[e]=null),t[e]=i}function Pa(n,t){let e=t[n];return sc(e)?e:e[hl]}function S3(n){return(n[fn]&4)===4}function ME(n){return(n[fn]&128)===128}function D3(n){return fl(n[oo])}function Na(n,t){return t==null?null:n[t]}function ZM(n){n[Pf]=0}function KM(n){n[fn]&1024||(n[fn]|=1024,ME(n)&&Bf(n))}function I3(n,t){for(;n>0;)t=t[Rf],n--;return t}function bv(n){return!!(n[fn]&9216||n[sa]?.dirty)}function AE(n){n[rc].changeDetectionScheduler?.notify(8),n[fn]&64&&(n[fn]|=1024),bv(n)&&Bf(n)}function Bf(n){n[rc].changeDetectionScheduler?.notify(0);let t=Sd(n);for(;t!==null&&!(t[fn]&8192||(t[fn]|=8192,!ME(t)));)t=Sd(t)}function YM(n,t){if(Lf(n))throw new Je(911,!1);n[au]===null&&(n[au]=[]),n[au].push(t)}function M3(n,t){if(n[au]===null)return;let e=n[au].indexOf(t);e!==-1&&n[au].splice(e,1)}function Sd(n){let t=n[oo];return fl(t)?t[oo]:t}function XM(n){return n[ag]??=[]}function QM(n){return n.cleanup??=[]}function A3(n,t,e,i){let r=XM(t);r.push(e),n.firstCreatePass&&QM(n).push(i,r.length-1)}var Sn={lFrame:j3(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var vM=!1;function k3(){return Sn.lFrame.elementDepthCount}function R3(){Sn.lFrame.elementDepthCount++}function JM(){Sn.lFrame.elementDepthCount--}function eA(){return Sn.bindingsEnabled}function tA(){return Sn.skipHydrationRootTNode!==null}function nA(n){return Sn.skipHydrationRootTNode===n}function iA(){Sn.skipHydrationRootTNode=null}function rn(){return Sn.lFrame.lView}function ar(){return Sn.lFrame.tView}function Ve(n){return Sn.lFrame.contextLView=n,n[Lr]}function je(n){return Sn.lFrame.contextLView=null,n}function Eo(){let n=rA();for(;n!==null&&n.type===64;)n=n.parent;return n}function rA(){return Sn.lFrame.currentTNode}function P3(){let n=Sn.lFrame,t=n.currentTNode;return n.isParent?t:t.parent}function ug(n,t){let e=Sn.lFrame;e.currentTNode=n,e.isParent=t}function oA(){return Sn.lFrame.isParent}function sA(){Sn.lFrame.isParent=!1}function aA(){return vM}function dv(n){let t=vM;return vM=n,t}function lA(){let n=Sn.lFrame,t=n.bindingRootIndex;return t===-1&&(t=n.bindingRootIndex=n.tView.bindingStartIndex),t}function kE(){return Sn.lFrame.bindingIndex}function N3(n){return Sn.lFrame.bindingIndex=n}function kd(){return Sn.lFrame.bindingIndex++}function dg(n){let t=Sn.lFrame,e=t.bindingIndex;return t.bindingIndex=t.bindingIndex+n,e}function O3(){return Sn.lFrame.inI18n}function F3(n,t){let e=Sn.lFrame;e.bindingIndex=e.bindingRootIndex=n,RE(t)}function L3(){return Sn.lFrame.currentDirectiveIndex}function RE(n){Sn.lFrame.currentDirectiveIndex=n}function B3(n){let t=Sn.lFrame.currentDirectiveIndex;return t===-1?null:n[t]}function cA(){return Sn.lFrame.currentQueryIndex}function PE(n){Sn.lFrame.currentQueryIndex=n}function DY(n){let t=n[Qt];return t.type===2?t.declTNode:t.type===1?n[vs]:null}function uA(n,t,e){if(e&4){let r=t,o=n;for(;r=r.parent,r===null&&!(e&1);)if(r=DY(o),r===null||(o=o[Rf],r.type&10))break;if(r===null)return!1;t=r,n=o}let i=Sn.lFrame=V3();return i.currentTNode=t,i.lView=n,!0}function NE(n){let t=V3(),e=n[Qt];Sn.lFrame=t,t.currentTNode=e.firstChild,t.lView=n,t.tView=e,t.contextLView=n,t.bindingIndex=e.bindingStartIndex,t.inI18n=!1}function V3(){let n=Sn.lFrame,t=n===null?null:n.child;return t===null?j3(n):t}function j3(n){let t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return n!==null&&(n.child=t),t}function z3(){let n=Sn.lFrame;return Sn.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}var dA=z3;function OE(){let n=z3();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function U3(n){return(Sn.lFrame.contextLView=I3(n,Sn.lFrame.contextLView))[Lr]}function Oa(){return Sn.lFrame.selectedIndex}function Rd(n){Sn.lFrame.selectedIndex=n}function wv(){let n=Sn.lFrame;return vv(n.tView,n.selectedIndex)}function on(){Sn.lFrame.currentNamespace=GM}function ai(){IY()}function IY(){Sn.lFrame.currentNamespace=null}function $3(){return Sn.lFrame.currentNamespace}var H3=!0;function FE(){return H3}function LE(n){H3=n}function bM(n,t=null,e=null,i){let r=hA(n,t,e,i);return r.resolveInjectorInitializers(),r}function hA(n,t=null,e=null,i,r=new Set){let o=[e||ys,DE(n)];return i=i||(typeof n=="object"?void 0:lu(n)),new Mf(o,t||sg(),i||null,r)}var en=class n{static THROW_IF_NOT_FOUND=Sf;static NULL=new uv;static create(t,e){if(Array.isArray(t))return bM({name:""},e,t,"");{let i=t.name??"";return bM({name:i},t.parent,t.providers,i)}}static \u0275prov=ze({token:n,providedIn:"any",factory:()=>vt(FM)});static __NG_ELEMENT_ID__=-1},Ht=new rt(""),Bs=(()=>{class n{static __NG_ELEMENT_ID__=MY;static __NG_ENV_ID__=e=>e}return n})(),gE=class extends Bs{_lView;constructor(t){super(),this._lView=t}get destroyed(){return Lf(this._lView)}onDestroy(t){let e=this._lView;return YM(e,t),()=>M3(e,t)}};function MY(){return new gE(rn())}var fA=!1,G3=new rt(""),lc=(()=>{class n{taskId=0;pendingTasks=new Set;destroyed=!1;pendingTask=new Fr(!1);debugTaskTracker=se(G3,{optional:!0});get hasPendingTasks(){return this.destroyed?!1:this.pendingTask.value}get hasPendingTasksObservable(){return this.destroyed?new Kt(e=>{e.next(!1),e.complete()}):this.pendingTask}add(){!this.hasPendingTasks&&!this.destroyed&&this.pendingTask.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),this.debugTaskTracker?.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.debugTaskTracker?.remove(e),this.pendingTasks.size===0&&this.hasPendingTasks&&this.pendingTask.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks&&this.pendingTask.next(!1),this.destroyed=!0,this.pendingTask.unsubscribe()}static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new n})}return n})(),wM=class extends yt{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,x3()&&(this.destroyRef=se(Bs,{optional:!0})??void 0,this.pendingTasks=se(lc,{optional:!0})??void 0)}emit(t){let e=Xt(null);try{super.next(t)}finally{Xt(e)}}subscribe(t,e,i){let r=t,o=e||(()=>null),d=i;if(t&&typeof t=="object"){let b=t;r=b.next?.bind(b),o=b.error?.bind(b),d=b.complete?.bind(b)}this.__isAsync&&(o=this.wrapInTimeout(o),r&&(r=this.wrapInTimeout(r)),d&&(d=this.wrapInTimeout(d)));let m=super.subscribe({next:r,error:o,complete:d});return t instanceof Gn&&t.add(m),m}wrapInTimeout(t){return e=>{let i=this.pendingTasks?.add();setTimeout(()=>{try{t(e)}finally{i!==void 0&&this.pendingTasks?.remove(i)}})}}},xn=wM;function _E(...n){}function pA(n){let t,e;function i(){n=_E;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),t!==void 0&&clearTimeout(t)}catch(r){}}return t=setTimeout(()=>{n(),i()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{n(),i()})),()=>i()}function q3(n){return queueMicrotask(()=>n()),()=>{n=_E}}var mA="isAngularZone",hv=mA+"_ID",AY=0,jt=class n{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new xn(!1);onMicrotaskEmpty=new xn(!1);onStable=new xn(!1);onError=new xn(!1);constructor(t){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:r=!1,scheduleInRootZone:o=fA}=t;if(typeof Zone>"u")throw new Je(908,!1);Zone.assertZonePatched();let d=this;d._nesting=0,d._outer=d._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(d._inner=d._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(d._inner=d._inner.fork(Zone.longStackTraceZoneSpec)),d.shouldCoalesceEventChangeDetection=!r&&i,d.shouldCoalesceRunChangeDetection=r,d.callbackScheduled=!1,d.scheduleInRootZone=o,PY(d)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(mA)===!0}static assertInAngularZone(){if(!n.isInAngularZone())throw new Je(909,!1)}static assertNotInAngularZone(){if(n.isInAngularZone())throw new Je(909,!1)}run(t,e,i){return this._inner.run(t,e,i)}runTask(t,e,i,r){let o=this._inner,d=o.scheduleEventTask("NgZoneEvent: "+r,t,kY,_E,_E);try{return o.runTask(d,e,i)}finally{o.cancelTask(d)}}runGuarded(t,e,i){return this._inner.runGuarded(t,e,i)}runOutsideAngular(t){return this._outer.run(t)}},kY={};function gA(n){if(n._nesting==0&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function RY(n){if(n.isCheckStableRunning||n.callbackScheduled)return;n.callbackScheduled=!0;function t(){pA(()=>{n.callbackScheduled=!1,xM(n),n.isCheckStableRunning=!0,gA(n),n.isCheckStableRunning=!1})}n.scheduleInRootZone?Zone.root.run(()=>{t()}):n._outer.run(()=>{t()}),xM(n)}function PY(n){let t=()=>{RY(n)},e=AY++;n._inner=n._inner.fork({name:"angular",properties:{[mA]:!0,[hv]:e,[hv+e]:!0},onInvokeTask:(i,r,o,d,m,b)=>{if(NY(b))return i.invokeTask(o,d,m,b);try{return l3(n),i.invokeTask(o,d,m,b)}finally{(n.shouldCoalesceEventChangeDetection&&d.type==="eventTask"||n.shouldCoalesceRunChangeDetection)&&t(),c3(n)}},onInvoke:(i,r,o,d,m,b,T)=>{try{return l3(n),i.invoke(o,d,m,b,T)}finally{n.shouldCoalesceRunChangeDetection&&!n.callbackScheduled&&!OY(b)&&t(),c3(n)}},onHasTask:(i,r,o,d)=>{i.hasTask(o,d),r===o&&(d.change=="microTask"?(n._hasPendingMicrotasks=d.microTask,xM(n),gA(n)):d.change=="macroTask"&&(n.hasPendingMacrotasks=d.macroTask))},onHandleError:(i,r,o,d)=>(i.handleError(o,d),n.runOutsideAngular(()=>n.onError.emit(d)),!1)})}function xM(n){n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&n.callbackScheduled===!0?n.hasPendingMicrotasks=!0:n.hasPendingMicrotasks=!1}function l3(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function c3(n){n._nesting--,gA(n)}var fv=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new xn;onMicrotaskEmpty=new xn;onStable=new xn;onError=new xn;run(t,e,i){return t.apply(e,i)}runGuarded(t,e,i){return t.apply(e,i)}runOutsideAngular(t){return t()}runTask(t,e,i,r){return t.apply(e,i)}};function NY(n){return W3(n,"__ignore_ng_zone__")}function OY(n){return W3(n,"__scheduler_tick__")}function W3(n,t){return!Array.isArray(n)||n.length!==1?!1:n[0]?.data?.[t]===!0}var tc=class{_console=console;handleError(t){this._console.error("ERROR",t)}},aa=new rt("",{factory:()=>{let n=se(jt),t=se(si),e;return i=>{n.runOutsideAngular(()=>{t.destroyed&&!e?setTimeout(()=>{throw i}):(e??=t.get(tc),e.handleError(i))})}}}),Z3={provide:cu,useValue:()=>{let n=se(tc,{optional:!0})},multi:!0};function Zn(n,t){let[e,i,r]=YI(n,t?.equal),o=e,d=o[gs];return o.set=i,o.update=r,o.asReadonly=K3.bind(o),o}function K3(){let n=this[gs];if(n.readonlyFn===void 0){let t=()=>this();t[gs]=n,n.readonlyFn=t}return n.readonlyFn}var xv=(()=>{class n{view;node;constructor(e,i){this.view=e,this.node=i}static __NG_ELEMENT_ID__=FY}return n})();function FY(){return new xv(rn(),Eo())}var nc=class{},hg=new rt("",{factory:()=>!0});var BE=new rt(""),VE=(()=>{class n{internalPendingTasks=se(lc);scheduler=se(nc);errorHandler=se(aa);add(){let e=this.internalPendingTasks.add();return()=>{this.internalPendingTasks.has(e)&&(this.scheduler.notify(11),this.internalPendingTasks.remove(e))}}run(e){let i=this.add();e().catch(this.errorHandler).finally(i)}static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new n})}return n})(),jE=(()=>{class n{static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new EM})}return n})(),EM=class{dirtyEffectCount=0;queues=new Map;add(t){this.enqueue(t),this.schedule(t)}schedule(t){t.dirty&&this.dirtyEffectCount++}remove(t){let e=t.zone,i=this.queues.get(e);i.has(t)&&(i.delete(t),t.dirty&&this.dirtyEffectCount--)}enqueue(t){let e=t.zone;this.queues.has(e)||this.queues.set(e,new Set);let i=this.queues.get(e);i.has(t)||i.add(t)}flush(){for(;this.dirtyEffectCount>0;){let t=!1;for(let[e,i]of this.queues)e===null?t||=this.flushQueue(i):t||=e.run(()=>this.flushQueue(i));t||(this.dirtyEffectCount=0)}}flushQueue(t){let e=!1;for(let i of t)i.dirty&&(this.dirtyEffectCount--,e=!0,i.run());return e}},yE=class{[gs];constructor(t){this[gs]=t}destroy(){this[gs].destroy()}};function fg(n,t){let e=t?.injector??se(en),i=t?.manualCleanup!==!0?e.get(Bs):null,r,o=e.get(xv,null,{optional:!0}),d=e.get(nc);return o!==null?(r=VY(o.view,d,n),i instanceof gE&&i._lView===o.view&&(i=null)):r=jY(n,e.get(jE),d),r.injector=e,i!==null&&(r.onDestroyFns=[i.onDestroy(()=>r.destroy())]),new yE(r)}var Y3=Mt(Be({},QI),{cleanupFns:void 0,zone:null,onDestroyFns:null,run(){let n=dv(!1);try{JI(this)}finally{dv(n)}},cleanup(){if(!this.cleanupFns?.length)return;let n=Xt(null);try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[],Xt(n)}}}),LY=Mt(Be({},Y3),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(12)},destroy(){if(bf(this),this.onDestroyFns!==null)for(let n of this.onDestroyFns)n();this.cleanup(),this.scheduler.remove(this)}}),BY=Mt(Be({},Y3),{consumerMarkedDirty(){this.view[fn]|=8192,Bf(this.view),this.notifier.notify(13)},destroy(){if(bf(this),this.onDestroyFns!==null)for(let n of this.onDestroyFns)n();this.cleanup(),this.view[Td]?.delete(this)}});function VY(n,t,e){let i=Object.create(BY);return i.view=n,i.zone=typeof Zone<"u"?Zone.current:null,i.notifier=t,i.fn=X3(i,e),n[Td]??=new Set,n[Td].add(i),i.consumerMarkedDirty(i),i}function jY(n,t,e){let i=Object.create(LY);return i.fn=X3(i,n),i.scheduler=t,i.notifier=e,i.zone=typeof Zone<"u"?Zone.current:null,i.scheduler.add(i),i.notifier.notify(12),i}function X3(n,t){return()=>{t(e=>(n.cleanupFns??=[]).push(e))}}function Cr(n){return XI(n)}function Pv(n){return{toString:n}.toString()}function qY(n){return typeof n=="function"}function Aj(n,t,e,i){t!==null?t.applyValueToInputSignal(t,i):n[e]=i}var YE=class{previousValue;currentValue;firstChange;constructor(t,e,i){this.previousValue=t,this.currentValue=e,this.firstChange=i}isFirstChange(){return this.firstChange}},Co=(()=>{let n=()=>kj;return n.ngInherit=!0,n})();function kj(n){return n.type.prototype.ngOnChanges&&(n.setInput=ZY),WY}function WY(){let n=Pj(this),t=n?.current;if(t){let e=n.previous;if(e===Dd)n.previous=t;else for(let i in t)e[i]=t[i];n.current=null,this.ngOnChanges(t)}}function ZY(n,t,e,i,r){let o=this.declaredInputs[i],d=Pj(n)||KY(n,{previous:Dd,current:null}),m=d.current||(d.current={}),b=d.previous,T=b[o];m[o]=new YE(T&&T.currentValue,e,b===Dd),Aj(n,t,r,e)}var Rj="__ngSimpleChanges__";function Pj(n){return n[Rj]||null}function KY(n,t){return n[Rj]=t}var Q3=[];var li=function(n,t=null,e){for(let i=0;i<Q3.length;i++){let r=Q3[i];r(n,t,e)}},qn=(function(n){return n[n.TemplateCreateStart=0]="TemplateCreateStart",n[n.TemplateCreateEnd=1]="TemplateCreateEnd",n[n.TemplateUpdateStart=2]="TemplateUpdateStart",n[n.TemplateUpdateEnd=3]="TemplateUpdateEnd",n[n.LifecycleHookStart=4]="LifecycleHookStart",n[n.LifecycleHookEnd=5]="LifecycleHookEnd",n[n.OutputStart=6]="OutputStart",n[n.OutputEnd=7]="OutputEnd",n[n.BootstrapApplicationStart=8]="BootstrapApplicationStart",n[n.BootstrapApplicationEnd=9]="BootstrapApplicationEnd",n[n.BootstrapComponentStart=10]="BootstrapComponentStart",n[n.BootstrapComponentEnd=11]="BootstrapComponentEnd",n[n.ChangeDetectionStart=12]="ChangeDetectionStart",n[n.ChangeDetectionEnd=13]="ChangeDetectionEnd",n[n.ChangeDetectionSyncStart=14]="ChangeDetectionSyncStart",n[n.ChangeDetectionSyncEnd=15]="ChangeDetectionSyncEnd",n[n.AfterRenderHooksStart=16]="AfterRenderHooksStart",n[n.AfterRenderHooksEnd=17]="AfterRenderHooksEnd",n[n.ComponentStart=18]="ComponentStart",n[n.ComponentEnd=19]="ComponentEnd",n[n.DeferBlockStateStart=20]="DeferBlockStateStart",n[n.DeferBlockStateEnd=21]="DeferBlockStateEnd",n[n.DynamicComponentStart=22]="DynamicComponentStart",n[n.DynamicComponentEnd=23]="DynamicComponentEnd",n[n.HostBindingsUpdateStart=24]="HostBindingsUpdateStart",n[n.HostBindingsUpdateEnd=25]="HostBindingsUpdateEnd",n})(qn||{});function YY(n,t,e){let{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=t.type.prototype;if(i){let d=kj(t);(e.preOrderHooks??=[]).push(n,d),(e.preOrderCheckHooks??=[]).push(n,d)}r&&(e.preOrderHooks??=[]).push(0-n,r),o&&((e.preOrderHooks??=[]).push(n,o),(e.preOrderCheckHooks??=[]).push(n,o))}function Nj(n,t){for(let e=t.directiveStart,i=t.directiveEnd;e<i;e++){let o=n.data[e].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:m,ngAfterViewInit:b,ngAfterViewChecked:T,ngOnDestroy:A}=o;d&&(n.contentHooks??=[]).push(-e,d),m&&((n.contentHooks??=[]).push(e,m),(n.contentCheckHooks??=[]).push(e,m)),b&&(n.viewHooks??=[]).push(-e,b),T&&((n.viewHooks??=[]).push(e,T),(n.viewCheckHooks??=[]).push(e,T)),A!=null&&(n.destroyHooks??=[]).push(e,A)}}function GE(n,t,e){Oj(n,t,3,e)}function qE(n,t,e,i){(n[fn]&3)===e&&Oj(n,t,e,i)}function _A(n,t){let e=n[fn];(e&3)===t&&(e&=16383,e+=1,n[fn]=e)}function Oj(n,t,e,i){let r=i!==void 0?n[Pf]&65535:0,o=i??-1,d=t.length-1,m=0;for(let b=r;b<d;b++)if(typeof t[b+1]=="number"){if(m=t[b],i!=null&&m>=i)break}else t[b]<0&&(n[Pf]+=65536),(m<o||o==-1)&&(XY(n,e,t,b),n[Pf]=(n[Pf]&4294901760)+b+2),b++}function J3(n,t){li(qn.LifecycleHookStart,n,t);let e=Xt(null);try{t.call(n)}finally{Xt(e),li(qn.LifecycleHookEnd,n,t)}}function XY(n,t,e,i){let r=e[i]<0,o=e[i+1],d=r?-e[i]:e[i],m=n[d];r?n[fn]>>14<n[Pf]>>16&&(n[fn]&3)===t&&(n[fn]+=16384,J3(m,o)):J3(m,o)}var mg=-1,jf=class{factory;name;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,e,i,r){this.factory=t,this.name=r,this.canSeeViewProviders=e,this.injectImpl=i}};function QY(n){return(n.flags&8)!==0}function JY(n){return(n.flags&16)!==0}function eX(n,t,e){let i=0;for(;i<e.length;){let r=e[i];if(typeof r=="number"){if(r!==0)break;i++;let o=e[i++],d=e[i++],m=e[i++];n.setAttribute(t,d,m,o)}else{let o=r,d=e[++i];tX(o)?n.setProperty(t,o,d):n.setAttribute(t,o,d),i++}}return i}function Fj(n){return n===3||n===4||n===6}function tX(n){return n.charCodeAt(0)===64}function gg(n,t){if(!(t===null||t.length===0))if(n===null||n.length===0)n=t.slice();else{let e=-1;for(let i=0;i<t.length;i++){let r=t[i];typeof r=="number"?e=r:e===0||(e===-1||e===2?ej(n,e,r,null,t[++i]):ej(n,e,r,null,null))}}return n}function ej(n,t,e,i,r){let o=0,d=n.length;if(t===-1)d=-1;else for(;o<n.length;){let m=n[o++];if(typeof m=="number"){if(m===t){d=-1;break}else if(m>t){d=o-1;break}}}for(;o<n.length;){let m=n[o];if(typeof m=="number")break;if(m===e){r!==null&&(n[o+1]=r);return}o++,r!==null&&o++}d!==-1&&(n.splice(d,0,t),o=d+1),n.splice(o++,0,e),r!==null&&n.splice(o++,0,r)}function Lj(n){return n!==mg}function XE(n){return n&32767}function nX(n){return n>>16}function QE(n,t){let e=nX(n),i=t;for(;e>0;)i=i[Rf],e--;return i}var DA=!0;function JE(n){let t=DA;return DA=n,t}var iX=256,Bj=iX-1,Vj=5,rX=0,cc={};function oX(n,t,e){let i;typeof e=="string"?i=e.charCodeAt(0)||0:e.hasOwnProperty(Af)&&(i=e[Af]),i==null&&(i=e[Af]=rX++);let r=i&Bj,o=1<<r;t.data[n+(r>>Vj)]|=o}function e1(n,t){let e=jj(n,t);if(e!==-1)return e;let i=t[Qt];i.firstCreatePass&&(n.injectorIndex=t.length,yA(i.data,n),yA(t,null),yA(i.blueprint,null));let r=ak(n,t),o=n.injectorIndex;if(Lj(r)){let d=XE(r),m=QE(r,t),b=m[Qt].data;for(let T=0;T<8;T++)t[o+T]=m[d+T]|b[d+T]}return t[o+8]=r,o}function yA(n,t){n.push(0,0,0,0,0,0,0,0,t)}function jj(n,t){return n.injectorIndex===-1||n.parent&&n.parent.injectorIndex===n.injectorIndex||t[n.injectorIndex+8]===null?-1:n.injectorIndex}function ak(n,t){if(n.parent&&n.parent.injectorIndex!==-1)return n.parent.injectorIndex;let e=0,i=null,r=t;for(;r!==null;){if(i=Gj(r),i===null)return mg;if(e++,r=r[Rf],i.injectorIndex!==-1)return i.injectorIndex|e<<16}return mg}function IA(n,t,e){oX(n,t,e)}function sX(n,t){if(t==="class")return n.classes;if(t==="style")return n.styles;let e=n.attrs;if(e){let i=e.length,r=0;for(;r<i;){let o=e[r];if(Fj(o))break;if(o===0)r=r+2;else if(typeof o=="number")for(r++;r<i&&typeof e[r]=="string";)r++;else{if(o===t)return e[r+1];r=r+2}}}return null}function zj(n,t,e){if(e&8||n!==void 0)return n;EE(t,"NodeInjector")}function Uj(n,t,e,i){if(e&8&&i===void 0&&(i=null),(e&3)===0){let r=n[uu],o=_s(void 0);try{return r?r.get(t,i,e&8):NM(t,i,e&8)}finally{_s(o)}}return zj(i,t,e)}function $j(n,t,e,i=0,r){if(n!==null){if(t[fn]&2048&&!(i&2)){let d=uX(n,t,e,i,cc);if(d!==cc)return d}let o=Hj(n,t,e,i,cc);if(o!==cc)return o}return Uj(t,e,i,r)}function Hj(n,t,e,i,r){let o=lX(e);if(typeof o=="function"){if(!uA(t,n,i))return i&1?zj(r,e,i):Uj(t,e,i,r);try{let d;if(d=o(i),d==null&&!(i&8))EE(e);else return d}finally{dA()}}else if(typeof o=="number"){let d=null,m=jj(n,t),b=mg,T=i&1?t[bs][vs]:null;for((m===-1||i&4)&&(b=m===-1?ak(n,t):t[m+8],b===mg||!nj(i,!1)?m=-1:(d=t[Qt],m=XE(b),t=QE(b,t)));m!==-1;){let A=t[Qt];if(tj(o,m,A.data)){let N=aX(m,t,e,d,i,T);if(N!==cc)return N}b=t[m+8],b!==mg&&nj(i,t[Qt].data[m+8]===T)&&tj(o,m,t)?(d=A,m=XE(b),t=QE(b,t)):m=-1}}return r}function aX(n,t,e,i,r,o){let d=t[Qt],m=d.data[n+8],b=i==null?Ad(m)&&DA:i!=d&&(m.type&3)!==0,T=r&1&&o===m,A=WE(m,d,e,b,T);return A!==null?Dv(t,d,A,m,r):cc}function WE(n,t,e,i,r){let o=n.providerIndexes,d=t.data,m=o&1048575,b=n.directiveStart,T=n.directiveEnd,A=o>>20,N=i?m:m+A,q=r?m+A:T;for(let J=N;J<q;J++){let K=d[J];if(J<b&&e===K||J>=b&&K.type===e)return J}if(r){let J=d[b];if(J&&ac(J)&&J.type===e)return b}return null}function Dv(n,t,e,i,r){let o=n[e],d=t.data;if(o instanceof jf){let m=o;if(m.resolving)throw PM("");let b=JE(m.canSeeViewProviders);m.resolving=!0;let T=d[e].type||d[e],A,N=m.injectImpl?_s(m.injectImpl):null,q=uA(n,i,0);try{o=n[e]=m.factory(void 0,r,d,n,i),t.firstCreatePass&&e>=i.directiveStart&&YY(e,d[e],t)}finally{N!==null&&_s(N),JE(b),m.resolving=!1,dA()}}return o}function lX(n){if(typeof n=="string")return n.charCodeAt(0)||0;let t=n.hasOwnProperty(Af)?n[Af]:void 0;return typeof t=="number"?t>=0?t&Bj:cX:t}function tj(n,t,e){let i=1<<n;return!!(e[t+(n>>Vj)]&i)}function nj(n,t){return!(n&2)&&!(n&1&&t)}var Vf=class{_tNode;_lView;constructor(t,e){this._tNode=t,this._lView=e}get(t,e,i){return $j(this._tNode,this._lView,t,Df(i),e)}};function cX(){return new Vf(Eo(),rn())}function ao(n){return Pv(()=>{let t=n.prototype.constructor,e=t[cv]||MA(t),i=Object.prototype,r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){let o=r[cv]||MA(r);if(o&&o!==e)return o;r=Object.getPrototypeOf(r)}return o=>new o})}function MA(n){return CM(n)?()=>{let t=MA(Vo(n));return t&&t()}:Cd(n)}function uX(n,t,e,i,r){let o=n,d=t;for(;o!==null&&d!==null&&d[fn]&2048&&!cg(d);){let m=Hj(o,d,e,i|2,cc);if(m!==cc)return m;let b=o.parent;if(!b){let T=d[UM];if(T){let A=T.get(e,cc,i);if(A!==cc)return A}b=Gj(d),d=d[Rf]}o=b}return r}function Gj(n){let t=n[Qt],e=t.type;return e===2?t.declTNode:e===1?n[vs]:null}function Nv(n){return sX(Eo(),n)}function dX(){return bg(Eo(),rn())}function bg(n,t){return new Fn(pl(n,t))}var Fn=(()=>{class n{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=dX}return n})();function hX(n){return n instanceof Fn?n.nativeElement:n}function fX(){return this._results[Symbol.iterator]()}var t1=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new yt}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){this.dirty=!1;let i=g3(t);(this._changesDetected=!m3(this._results,i,e))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=fX};function qj(n){return(n.flags&128)===128}var lk=(function(n){return n[n.OnPush=0]="OnPush",n[n.Default=1]="Default",n})(lk||{}),Wj=new Map,pX=0;function mX(){return pX++}function gX(n){Wj.set(n[du],n)}function AA(n){Wj.delete(n[du])}var ij="__ngContext__";function _g(n,t){sc(t)?(n[ij]=t[du],gX(t)):n[ij]=t}function Zj(n){return Yj(n[lg])}function Kj(n){return Yj(n[ka])}function Yj(n){for(;n!==null&&!fl(n);)n=n[ka];return n}var _X;function ck(n){_X=n}var wg=new rt("",{factory:()=>yX}),yX="ng";var g1=new rt(""),$f=new rt("",{providedIn:"platform",factory:()=>"unknown"}),Od=new rt(""),xg=new rt("",{factory:()=>se(Ht).body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Xj="r";var Qj="di";var Jj=!1,ez=new rt("",{factory:()=>Jj});var _1=new rt("");var vX=(n,t,e,i)=>{};function bX(n,t,e,i){vX(n,t,e,i)}function y1(n){return(n.flags&32)===32}var wX=()=>null;function tz(n,t,e=!1){return wX(n,t,e)}function nz(n,t){let e=n.contentQueries;if(e!==null){let i=Xt(null);try{for(let r=0;r<e.length;r+=2){let o=e[r],d=e[r+1];if(d!==-1){let m=n.data[d];PE(o),m.contentQueries(2,t[d],d)}}}finally{Xt(i)}}}function kA(n,t,e){PE(0);let i=Xt(null);try{t(n,e)}finally{Xt(i)}}function iz(n,t,e){if(HM(t)){let i=Xt(null);try{let r=t.directiveStart,o=t.directiveEnd;for(let d=r;d<o;d++){let m=n.data[d];if(m.contentQueries){let b=e[d];m.contentQueries(1,b,d)}}}finally{Xt(i)}}}var _l=(function(n){return n[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",n[n.ExperimentalIsolatedShadowDom=4]="ExperimentalIsolatedShadowDom",n})(_l||{});var zE;function xX(){if(zE===void 0&&(zE=null,Aa.trustedTypes))try{zE=Aa.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return zE}function v1(n){return xX()?.createHTML(n)||n}var UE;function EX(){if(UE===void 0&&(UE=null,Aa.trustedTypes))try{UE=Aa.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch(n){}return UE}function rj(n){return EX()?.createScriptURL(n)||n}var hu=class{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${vE})`}},RA=class extends hu{getTypeName(){return"HTML"}},PA=class extends hu{getTypeName(){return"Style"}},NA=class extends hu{getTypeName(){return"Script"}},OA=class extends hu{getTypeName(){return"URL"}},FA=class extends hu{getTypeName(){return"ResourceURL"}};function La(n){return n instanceof hu?n.changingThisBreaksApplicationSecurity:n}function fu(n,t){let e=rz(n);if(e!=null&&e!==t){if(e==="ResourceURL"&&t==="URL")return!0;throw new Error(`Required a safe ${t}, got a ${e} (see ${vE})`)}return e===t}function rz(n){return n instanceof hu&&n.getTypeName()||null}function uk(n){return new RA(n)}function dk(n){return new PA(n)}function hk(n){return new NA(n)}function fk(n){return new OA(n)}function pk(n){return new FA(n)}function CX(n){let t=new BA(n);return TX()?new LA(t):t}var LA=class{inertDocumentHelper;constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{let e=new window.DOMParser().parseFromString(v1(t),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(t):(e.firstChild?.remove(),e)}catch(e){return null}}},BA=class{defaultDoc;inertDocument;constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){let e=this.inertDocument.createElement("template");return e.innerHTML=v1(t),e}};function TX(){try{return!!new window.DOMParser().parseFromString(v1(""),"text/html")}catch(n){return!1}}var SX=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Ov(n){return n=String(n),n.match(SX)?n:"unsafe:"+n}function pu(n){let t={};for(let e of n.split(","))t[e]=!0;return t}function Fv(...n){let t={};for(let e of n)for(let i in e)e.hasOwnProperty(i)&&(t[i]=!0);return t}var oz=pu("area,br,col,hr,img,wbr"),sz=pu("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),az=pu("rp,rt"),DX=Fv(az,sz),IX=Fv(sz,pu("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),MX=Fv(az,pu("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),oj=Fv(oz,IX,MX,DX),lz=pu("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),AX=pu("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),kX=pu("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),RX=Fv(lz,AX,kX),PX=pu("script,style,template"),VA=class{sanitizedSomething=!1;buf=[];sanitizeChildren(t){let e=t.firstChild,i=!0,r=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?i=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,i&&e.firstChild){r.push(e),e=FX(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let o=OX(e);if(o){e=o;break}e=r.pop()}}return this.buf.join("")}startElement(t){let e=sj(t).toLowerCase();if(!oj.hasOwnProperty(e))return this.sanitizedSomething=!0,!PX.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let i=t.attributes;for(let r=0;r<i.length;r++){let o=i.item(r),d=o.name,m=d.toLowerCase();if(!RX.hasOwnProperty(m)){this.sanitizedSomething=!0;continue}let b=o.value;lz[m]&&(b=Ov(b)),this.buf.push(" ",d,'="',aj(b),'"')}return this.buf.push(">"),!0}endElement(t){let e=sj(t).toLowerCase();oj.hasOwnProperty(e)&&!oz.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(aj(t))}};function NX(n,t){return(n.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function OX(n){let t=n.nextSibling;if(t&&n!==t.previousSibling)throw cz(t);return t}function FX(n){let t=n.firstChild;if(t&&NX(n,t))throw cz(t);return t}function sj(n){let t=n.nodeName;return typeof t=="string"?t:"FORM"}function cz(n){return new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`)}var LX=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,BX=/([^\#-~ |!])/g;function aj(n){return n.replace(/&/g,"&amp;").replace(LX,function(t){let e=t.charCodeAt(0),i=t.charCodeAt(1);return"&#"+((e-55296)*1024+(i-56320)+65536)+";"}).replace(BX,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $E;function mk(n,t){let e=null;try{$E=$E||CX(n);let i=t?String(t):"";e=$E.getInertBodyElement(i);let r=5,o=i;do{if(r===0)throw new Error("Failed to sanitize html because the input is unstable");r--,i=o,o=e.innerHTML,e=$E.getInertBodyElement(i)}while(i!==o);let m=new VA().sanitizeChildren(lj(e)||e);return v1(m)}finally{if(e){let i=lj(e)||e;for(;i.firstChild;)i.firstChild.remove()}}}function lj(n){return"content"in n&&VX(n)?n.content:null}function VX(n){return n.nodeType===Node.ELEMENT_NODE&&n.nodeName==="TEMPLATE"}function jX(n,t){return n.createText(t)}function zX(n,t,e){n.setValue(t,e)}function uz(n,t,e){return n.createElement(t,e)}function n1(n,t,e,i,r){n.insertBefore(t,e,i,r)}function dz(n,t,e){n.appendChild(t,e)}function cj(n,t,e,i,r){i!==null?n1(n,t,e,i,r):dz(n,t,e)}function hz(n,t,e,i){n.removeChild(null,t,e,i)}function UX(n,t,e){n.setAttribute(t,"style",e)}function $X(n,t,e){e===""?n.removeAttribute(t,"class"):n.setAttribute(t,"class",e)}function fz(n,t,e){let{mergedAttrs:i,classes:r,styles:o}=e;i!==null&&eX(n,t,i),r!==null&&$X(n,t,r),o!==null&&UX(n,t,o)}var la=(function(n){return n[n.NONE=0]="NONE",n[n.HTML=1]="HTML",n[n.STYLE=2]="STYLE",n[n.SCRIPT=3]="SCRIPT",n[n.URL=4]="URL",n[n.RESOURCE_URL=5]="RESOURCE_URL",n})(la||{});function Vi(n){let t=mz();return t?t.sanitize(la.URL,n)||"":fu(n,"URL")?La(n):Ov(oa(n))}function pz(n){let t=mz();if(t)return rj(t.sanitize(la.RESOURCE_URL,n)||"");if(fu(n,"ResourceURL"))return rj(La(n));throw new Je(904,!1)}var HX=new Set(["embed","frame","iframe","media","script"]),GX=new Set(["base","link","script"]);function qX(n,t){return t==="src"&&HX.has(n)||t==="href"&&GX.has(n)||t==="xlink:href"&&n==="script"?pz:Vi}function gk(n,t,e){return qX(t,e)(n)}function mz(){let n=rn();return n&&n[rc].sanitizer}function gz(n){return n instanceof Function?n():n}function WX(n,t,e){let i=n.length;for(;;){let r=n.indexOf(t,e);if(r===-1)return r;if(r===0||n.charCodeAt(r-1)<=32){let o=t.length;if(r+o===i||n.charCodeAt(r+o)<=32)return r}e=r+1}}var _z="ng-template";function ZX(n,t,e,i){let r=0;if(i){for(;r<t.length&&typeof t[r]=="string";r+=2)if(t[r]==="class"&&WX(t[r+1].toLowerCase(),e,0)!==-1)return!0}else if(_k(n))return!1;if(r=t.indexOf(1,r),r>-1){let o;for(;++r<t.length&&typeof(o=t[r])=="string";)if(o.toLowerCase()===e)return!0}return!1}function _k(n){return n.type===4&&n.value!==_z}function KX(n,t,e){let i=n.type===4&&!e?_z:n.value;return t===i}function YX(n,t,e){let i=4,r=n.attrs,o=r!==null?JX(r):0,d=!1;for(let m=0;m<t.length;m++){let b=t[m];if(typeof b=="number"){if(!d&&!ml(i)&&!ml(b))return!1;if(d&&ml(b))continue;d=!1,i=b|i&1;continue}if(!d)if(i&4){if(i=2|i&1,b!==""&&!KX(n,b,e)||b===""&&t.length===1){if(ml(i))return!1;d=!0}}else if(i&8){if(r===null||!ZX(n,r,b,e)){if(ml(i))return!1;d=!0}}else{let T=t[++m],A=XX(b,r,_k(n),e);if(A===-1){if(ml(i))return!1;d=!0;continue}if(T!==""){let N;if(A>o?N="":N=r[A+1].toLowerCase(),i&2&&T!==N){if(ml(i))return!1;d=!0}}}}return ml(i)||d}function ml(n){return(n&1)===0}function XX(n,t,e,i){if(t===null)return-1;let r=0;if(i||!e){let o=!1;for(;r<t.length;){let d=t[r];if(d===n)return r;if(d===3||d===6)o=!0;else if(d===1||d===2){let m=t[++r];for(;typeof m=="string";)m=t[++r];continue}else{if(d===4)break;if(d===0){r+=4;continue}}r+=o?1:2}return-1}else return eQ(t,n)}function yz(n,t,e=!1){for(let i=0;i<t.length;i++)if(YX(n,t[i],e))return!0;return!1}function QX(n){let t=n.attrs;if(t!=null){let e=t.indexOf(5);if((e&1)===0)return t[e+1]}return null}function JX(n){for(let t=0;t<n.length;t++){let e=n[t];if(Fj(e))return t}return n.length}function eQ(n,t){let e=n.indexOf(4);if(e>-1)for(e++;e<n.length;){let i=n[e];if(typeof i=="number")return-1;if(i===t)return e;e++}return-1}function tQ(n,t){e:for(let e=0;e<t.length;e++){let i=t[e];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function uj(n,t){return n?":not("+t.trim()+")":t}function nQ(n){let t=n[0],e=1,i=2,r="",o=!1;for(;e<n.length;){let d=n[e];if(typeof d=="string")if(i&2){let m=n[++e];r+="["+d+(m.length>0?'="'+m+'"':"")+"]"}else i&8?r+="."+d:i&4&&(r+=" "+d);else r!==""&&!ml(d)&&(t+=uj(o,r),r=""),i=d,o=o||!ml(i);e++}return r!==""&&(t+=uj(o,r)),t}function iQ(n){return n.map(nQ).join(",")}function rQ(n){let t=[],e=[],i=1,r=2;for(;i<n.length;){let o=n[i];if(typeof o=="string")r===2?o!==""&&t.push(o,n[++i]):r===8&&e.push(o);else{if(!ml(r))break;r=o}i++}return e.length&&t.push(1,...e),t}var lo={};function yk(n,t,e,i,r,o,d,m,b,T,A){let N=xr+i,q=N+r,J=oQ(N,q),K=typeof T=="function"?T():T;return J[Qt]={type:n,blueprint:J,template:e,queries:null,viewQuery:m,declTNode:t,data:J.slice().fill(null,N),bindingStartIndex:N,expandoStartIndex:q,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof o=="function"?o():o,pipeRegistry:typeof d=="function"?d():d,firstChild:null,schemas:b,consts:K,incompleteFirstPass:!1,ssrId:A}}function oQ(n,t){let e=[];for(let i=0;i<t;i++)e.push(i<n?null:lo);return e}function sQ(n){let t=n.tView;return t===null||t.incompleteFirstPass?n.tView=yk(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts,n.id):t}function vk(n,t,e,i,r,o,d,m,b,T,A){let N=t.blueprint.slice();return N[hl]=r,N[fn]=i|4|128|8|64|1024,(T!==null||n&&n[fn]&2048)&&(N[fn]|=2048),ZM(N),N[oo]=N[Rf]=n,N[Lr]=e,N[rc]=d||n&&n[rc],N[ki]=m||n&&n[ki],N[uu]=b||n&&n[uu]||null,N[vs]=o,N[du]=mX(),N[kf]=A,N[UM]=T,N[bs]=t.type==2?n[bs]:N,N}function aQ(n,t,e){let i=pl(t,n),r=sQ(e),o=n[rc].rendererFactory,d=bk(n,vk(n,r,null,vz(e),i,t,null,o.createRenderer(i,e),null,null,null));return n[t.index]=d}function vz(n){let t=16;return n.signals?t=4096:n.onPush&&(t=64),t}function bz(n,t,e,i){if(e===0)return-1;let r=t.length;for(let o=0;o<e;o++)t.push(i),n.blueprint.push(i),n.data.push(null);return r}function bk(n,t){return n[lg]?n[zM][ka]=t:n[lg]=t,n[zM]=t,t}function te(n=1){wz(ar(),rn(),Oa()+n,!1)}function wz(n,t,e,i){if(!i)if((t[fn]&3)===3){let o=n.preOrderCheckHooks;o!==null&&GE(t,o,e)}else{let o=n.preOrderHooks;o!==null&&qE(t,o,0,e)}Rd(e)}var b1=(function(n){return n[n.None=0]="None",n[n.SignalBased=1]="SignalBased",n[n.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",n})(b1||{});function jA(n,t,e,i){let r=Xt(null);try{let[o,d,m]=n.inputs[e],b=null;(d&b1.SignalBased)!==0&&(b=t[o][gs]),b!==null&&b.transformFn!==void 0?i=b.transformFn(i):m!==null&&(i=m.call(t,i)),n.setInput!==null?n.setInput(t,b,i,e,o):Aj(t,b,o,i)}finally{Xt(r)}}var uc=(function(n){return n[n.Important=1]="Important",n[n.DashCase=2]="DashCase",n})(uc||{}),lQ;function wk(n,t){return lQ(n,t)}var zf=new Set,w1=(function(n){return n[n.CHANGE_DETECTION=0]="CHANGE_DETECTION",n[n.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",n})(w1||{}),mu=new rt(""),dj=new Set;function ca(n){dj.has(n)||(dj.add(n),performance?.mark?.("mark_feature_usage",{detail:{feature:n}}))}var xk=(()=>{class n{impl=null;execute(){this.impl?.execute()}static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new n})}return n})(),xz=[0,1,2,3],Ez=(()=>{class n{ngZone=se(jt);scheduler=se(nc);errorHandler=se(tc,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){se(mu,{optional:!0})}execute(){let e=this.sequences.size>0;e&&li(qn.AfterRenderHooksStart),this.executing=!0;for(let i of xz)for(let r of this.sequences)if(!(r.erroredOrDestroyed||!r.hooks[i]))try{r.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>{let o=r.hooks[i];return o(r.pipelinedValue)},r.snapshot))}catch(o){r.erroredOrDestroyed=!0,this.errorHandler?.handleError(o)}this.executing=!1;for(let i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(let i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(7),this.deferredRegistrations.clear(),e&&li(qn.AfterRenderHooksEnd)}register(e){let{view:i}=e;i!==void 0?((i[Nf]??=[]).push(e),Bf(i),i[fn]|=8192):this.executing?this.deferredRegistrations.add(e):this.addSequence(e)}addSequence(e){this.sequences.add(e),this.scheduler.notify(7)}unregister(e){this.executing&&this.sequences.has(e)?(e.erroredOrDestroyed=!0,e.pipelinedValue=void 0,e.once=!0):(this.sequences.delete(e),this.deferredRegistrations.delete(e))}maybeTrace(e,i){return i?i.run(w1.AFTER_NEXT_RENDER,e):e()}static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new n})}return n})(),i1=class{impl;hooks;view;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(t,e,i,r,o,d=null){this.impl=t,this.hooks=e,this.view=i,this.once=r,this.snapshot=d,this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.();let t=this.view?.[Nf];t&&(this.view[Nf]=t.filter(e=>e!==this))}};function co(n,t){let e=t?.injector??se(en);return ca("NgAfterNextRender"),uQ(n,e,t,!0)}function cQ(n){return n instanceof Function?[void 0,void 0,n,void 0]:[n.earlyRead,n.write,n.mixedReadWrite,n.read]}function uQ(n,t,e,i){let r=t.get(xk);r.impl??=t.get(Ez);let o=t.get(mu,null,{optional:!0}),d=e?.manualCleanup!==!0?t.get(Bs):null,m=t.get(xv,null,{optional:!0}),b=new i1(r.impl,cQ(n),m?.view,i,d,o?.snapshot(null));return r.impl.register(b),b}var Cz=new rt("",{factory:()=>({queue:new Set,isScheduled:!1,scheduler:null,injector:se(si)})});function Tz(n,t,e){let i=n.get(Cz);if(Array.isArray(t))for(let r of t)i.queue.add(r),e?.detachedLeaveAnimationFns?.push(r);else i.queue.add(t),e?.detachedLeaveAnimationFns?.push(t);i.scheduler&&i.scheduler(n)}function dQ(n,t){let e=n.get(Cz);if(t.detachedLeaveAnimationFns){for(let i of t.detachedLeaveAnimationFns)e.queue.delete(i);t.detachedLeaveAnimationFns=void 0}}function hQ(n,t){for(let[e,i]of t)Tz(n,i.animateFns)}function hj(n,t,e,i){let r=n?.[Of]?.enter;t!==null&&r&&r.has(e.index)&&hQ(i,r)}function pg(n,t,e,i,r,o,d,m){if(r!=null){let b,T=!1;fl(r)?b=r:sc(r)&&(T=!0,r=r[hl]);let A=Ra(r);n===0&&i!==null?(hj(m,i,o,e),d==null?dz(t,i,A):n1(t,i,A,d||null,!0)):n===1&&i!==null?(hj(m,i,o,e),n1(t,i,A,d||null,!0)):n===2?fj(m,o,e,N=>{hz(t,A,T,N)}):n===3&&fj(m,o,e,()=>{t.destroyNode(A)}),b!=null&&EQ(t,n,e,b,o,i,d)}}function fQ(n,t){Sz(n,t),t[hl]=null,t[vs]=null}function pQ(n,t,e,i,r,o){i[hl]=r,i[vs]=t,E1(n,i,e,1,r,o)}function Sz(n,t){t[rc].changeDetectionScheduler?.notify(9),E1(n,t,t[ki],2,null,null)}function mQ(n){let t=n[lg];if(!t)return vA(n[Qt],n);for(;t;){let e=null;if(sc(t))e=t[lg];else{let i=t[Er];i&&(e=i)}if(!e){for(;t&&!t[ka]&&t!==n;)sc(t)&&vA(t[Qt],t),t=t[oo];t===null&&(t=n),sc(t)&&vA(t[Qt],t),e=t&&t[ka]}t=e}}function Ek(n,t){let e=n[Ff],i=e.indexOf(t);e.splice(i,1)}function x1(n,t){if(Lf(t))return;let e=t[ki];e.destroyNode&&E1(n,t,e,3,null,null),mQ(t)}function vA(n,t){if(Lf(t))return;let e=Xt(null);try{t[fn]&=-129,t[fn]|=256,t[sa]&&bf(t[sa]),yQ(n,t),_Q(n,t),t[Qt].type===1&&t[ki].destroy();let i=t[Id];if(i!==null&&fl(t[oo])){i!==t[oo]&&Ek(i,t);let r=t[oc];r!==null&&r.detachView(n)}AA(t)}finally{Xt(e)}}function fj(n,t,e,i){let r=n?.[Of];if(r==null||r.leave==null||!r.leave.has(t.index))return i(!1);n&&zf.add(n[du]),Tz(e,()=>{if(r.leave&&r.leave.has(t.index)){let d=r.leave.get(t.index),m=[];if(d){for(let b=0;b<d.animateFns.length;b++){let T=d.animateFns[b],{promise:A}=T();m.push(A)}r.detachedLeaveAnimationFns=void 0}r.running=Promise.allSettled(m),gQ(n,i)}else n&&zf.delete(n[du]),i(!1)},r)}function gQ(n,t){let e=n[Of]?.running;if(e){e.then(()=>{n[Of].running=void 0,zf.delete(n[du]),t(!0)});return}t(!1)}function _Q(n,t){let e=n.cleanup,i=t[ag];if(e!==null)for(let d=0;d<e.length-1;d+=2)if(typeof e[d]=="string"){let m=e[d+3];m>=0?i[m]():i[-m].unsubscribe(),d+=2}else{let m=i[e[d+1]];e[d].call(m)}i!==null&&(t[ag]=null);let r=t[au];if(r!==null){t[au]=null;for(let d=0;d<r.length;d++){let m=r[d];m()}}let o=t[Td];if(o!==null){t[Td]=null;for(let d of o)d.destroy()}}function yQ(n,t){let e;if(n!=null&&(e=n.destroyHooks)!=null)for(let i=0;i<e.length;i+=2){let r=t[e[i]];if(!(r instanceof jf)){let o=e[i+1];if(Array.isArray(o))for(let d=0;d<o.length;d+=2){let m=r[o[d]],b=o[d+1];li(qn.LifecycleHookStart,m,b);try{b.call(m)}finally{li(qn.LifecycleHookEnd,m,b)}}else{li(qn.LifecycleHookStart,r,o);try{o.call(r)}finally{li(qn.LifecycleHookEnd,r,o)}}}}}function Dz(n,t,e){return vQ(n,t.parent,e)}function vQ(n,t,e){let i=t;for(;i!==null&&i.type&168;)t=i,i=t.parent;if(i===null)return e[hl];if(Ad(i)){let{encapsulation:r}=n.data[i.directiveStart+i.componentOffset];if(r===_l.None||r===_l.Emulated)return null}return pl(i,e)}function Iz(n,t,e){return wQ(n,t,e)}function bQ(n,t,e){return n.type&40?pl(n,e):null}var wQ=bQ,pj;function Ck(n,t,e,i){let r=Dz(n,i,t),o=t[ki],d=i.parent||t[vs],m=Iz(d,i,t);if(r!=null)if(Array.isArray(e))for(let b=0;b<e.length;b++)cj(o,r,e[b],m,!1);else cj(o,r,e,m,!1);pj!==void 0&&pj(o,i,t,e,r)}function Cv(n,t){if(t!==null){let e=t.type;if(e&3)return pl(t,n);if(e&4)return zA(-1,n[t.index]);if(e&8){let i=t.child;if(i!==null)return Cv(n,i);{let r=n[t.index];return fl(r)?zA(-1,r):Ra(r)}}else{if(e&128)return Cv(n,t.next);if(e&32)return wk(t,n)()||Ra(n[t.index]);{let i=Mz(n,t);if(i!==null){if(Array.isArray(i))return i[0];let r=Sd(n[bs]);return Cv(r,i)}else return Cv(n,t.next)}}}return null}function Mz(n,t){if(t!==null){let i=n[bs][vs],r=t.projection;return i.projection[r]}return null}function zA(n,t){let e=Er+n+1;if(e<t.length){let i=t[e],r=i[Qt].firstChild;if(r!==null)return Cv(i,r)}return t[Md]}function Tk(n,t,e,i,r,o,d){for(;e!=null;){let m=i[uu];if(e.type===128){e=e.next;continue}let b=i[e.index],T=e.type;if(d&&t===0&&(b&&_g(Ra(b),i),e.flags|=2),!y1(e))if(T&8)Tk(n,t,e.child,i,r,o,!1),pg(t,n,m,r,b,e,o,i);else if(T&32){let A=wk(e,i),N;for(;N=A();)pg(t,n,m,r,N,e,o,i);pg(t,n,m,r,b,e,o,i)}else T&16?Az(n,t,i,e,r,o):pg(t,n,m,r,b,e,o,i);e=d?e.projectionNext:e.next}}function E1(n,t,e,i,r,o){Tk(e,i,n.firstChild,t,r,o,!1)}function xQ(n,t,e){let i=t[ki],r=Dz(n,e,t),o=e.parent||t[vs],d=Iz(o,e,t);Az(i,0,t,e,r,d)}function Az(n,t,e,i,r,o){let d=e[bs],b=d[vs].projection[i.projection];if(Array.isArray(b))for(let T=0;T<b.length;T++){let A=b[T];pg(t,n,e[uu],r,A,i,o,e)}else{let T=b,A=d[oo];qj(i)&&(T.flags|=128),Tk(n,t,T,A,r,o,!0)}}function EQ(n,t,e,i,r,o,d){let m=i[Md],b=Ra(i);m!==b&&pg(t,n,e,o,m,r,d);for(let T=Er;T<i.length;T++){let A=i[T];E1(A[Qt],A,n,t,o,m)}}function CQ(n,t,e,i,r){if(t)r?n.addClass(e,i):n.removeClass(e,i);else{let o=i.indexOf("-")===-1?void 0:uc.DashCase;r==null?n.removeStyle(e,i,o):(typeof r=="string"&&r.endsWith("!important")&&(r=r.slice(0,-10),o|=uc.Important),n.setStyle(e,i,r,o))}}function kz(n,t,e,i,r){let o=Oa(),d=i&2;try{Rd(-1),d&&t.length>xr&&wz(n,t,xr,!1);let m=d?qn.TemplateUpdateStart:qn.TemplateCreateStart;li(m,r,e),e(i,r)}finally{Rd(o);let m=d?qn.TemplateUpdateEnd:qn.TemplateCreateEnd;li(m,r,e)}}function Sk(n,t,e){AQ(n,t,e),(e.flags&64)===64&&kQ(n,t,e)}function C1(n,t,e=pl){let i=t.localNames;if(i!==null){let r=t.index+1;for(let o=0;o<i.length;o+=2){let d=i[o+1],m=d===-1?e(t,n):n[d];n[r++]=m}}}function TQ(n,t,e,i){let o=i.get(ez,Jj)||e===_l.ShadowDom||e===_l.ExperimentalIsolatedShadowDom,d=n.selectRootElement(t,o);return SQ(d),d}function SQ(n){DQ(n)}var DQ=()=>null;function IQ(n){return n==="class"?"className":n==="for"?"htmlFor":n==="formaction"?"formAction":n==="innerHtml"?"innerHTML":n==="readonly"?"readOnly":n==="tabindex"?"tabIndex":n}function Rz(n,t,e,i,r,o){let d=t[Qt];if(Dk(n,d,t,e,i)){Ad(n)&&MQ(t,n.index);return}n.type&3&&(e=IQ(e)),Pz(n,t,e,i,r,o)}function Pz(n,t,e,i,r,o){if(n.type&3){let d=pl(n,t);i=o!=null?o(i,n.value||"",e):i,r.setProperty(d,e,i)}else n.type&12}function MQ(n,t){let e=Pa(t,n);e[fn]&16||(e[fn]|=64)}function AQ(n,t,e){let i=e.directiveStart,r=e.directiveEnd;Ad(e)&&aQ(t,e,n.data[i+e.componentOffset]),n.firstCreatePass||e1(e,t);let o=e.initialInputs;for(let d=i;d<r;d++){let m=n.data[d],b=Dv(t,n,d,e);if(_g(b,t),o!==null&&OQ(t,d-i,b,m,e,o),ac(m)){let T=Pa(e.index,t);T[Lr]=Dv(t,n,d,e)}}}function kQ(n,t,e){let i=e.directiveStart,r=e.directiveEnd,o=e.index,d=L3();try{Rd(o);for(let m=i;m<r;m++){let b=n.data[m],T=t[m];RE(m),(b.hostBindings!==null||b.hostVars!==0||b.hostAttrs!==null)&&RQ(b,T)}}finally{Rd(-1),RE(d)}}function RQ(n,t){n.hostBindings!==null&&n.hostBindings(1,t)}function Nz(n,t){let e=n.directiveRegistry,i=null;if(e)for(let r=0;r<e.length;r++){let o=e[r];yz(t,o.selectors,!1)&&(i??=[],ac(o)?i.unshift(o):i.push(o))}return i}function PQ(n,t,e,i,r,o){let d=pl(n,t);NQ(t[ki],d,o,n.value,e,i,r)}function NQ(n,t,e,i,r,o,d){if(o==null)n.removeAttribute(t,r,e);else{let m=d==null?oa(o):d(o,i||"",r);n.setAttribute(t,r,m,e)}}function OQ(n,t,e,i,r,o){let d=o[t];if(d!==null)for(let m=0;m<d.length;m+=2){let b=d[m],T=d[m+1];jA(i,e,b,T)}}function Oz(n,t,e,i,r){let o=xr+e,d=t[Qt],m=r(d,t,n,i,e);t[o]=m,ug(n,!0);let b=n.type===2;return b?(fz(t[ki],m,n),(k3()===0||yv(n))&&_g(m,t),R3()):_g(m,t),FE()&&(!b||!y1(n))&&Ck(d,t,m,n),n}function Fz(n){let t=n;return oA()?sA():(t=t.parent,ug(t,!1)),t}function FQ(n,t){let e=n[uu];if(!e)return;let i;try{i=e.get(aa,null)}catch(r){i=null}i?.(t)}function Dk(n,t,e,i,r){let o=n.inputs?.[i],d=n.hostDirectiveInputs?.[i],m=!1;if(d)for(let b=0;b<d.length;b+=2){let T=d[b],A=d[b+1],N=t.data[T];jA(N,e[T],A,r),m=!0}if(o)for(let b of o){let T=e[b],A=t.data[b];jA(A,T,i,r),m=!0}return m}function LQ(n,t){let e=Pa(t,n),i=e[Qt];BQ(i,e);let r=e[hl];r!==null&&e[kf]===null&&(e[kf]=tz(r,e[uu])),li(qn.ComponentStart);try{Ik(i,e,e[Lr])}finally{li(qn.ComponentEnd,e[Lr])}}function BQ(n,t){for(let e=t.length;e<n.blueprint.length;e++)t.push(n.blueprint[e])}function Ik(n,t,e){NE(t);try{let i=n.viewQuery;i!==null&&kA(1,i,e);let r=n.template;r!==null&&kz(n,t,r,1,e),n.firstCreatePass&&(n.firstCreatePass=!1),t[oc]?.finishViewCreation(n),n.staticContentQueries&&nz(n,t),n.staticViewQueries&&kA(2,n.viewQuery,e);let o=n.components;o!==null&&VQ(t,o)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{t[fn]&=-5,OE()}}function VQ(n,t){for(let e=0;e<t.length;e++)LQ(n,t[e])}function Lv(n,t,e,i){let r=Xt(null);try{let o=t.tView,m=n[fn]&4096?4096:16,b=vk(n,o,e,m,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),T=n[t.index];b[Id]=T;let A=n[oc];return A!==null&&(b[oc]=A.createEmbeddedView(o)),Ik(o,b,e),b}finally{Xt(r)}}function yg(n,t){return!t||t.firstChild===null||qj(n)}function Iv(n,t,e,i,r=!1){for(;e!==null;){if(e.type===128){e=r?e.projectionNext:e.next;continue}let o=t[e.index];o!==null&&i.push(Ra(o)),fl(o)&&Lz(o,i);let d=e.type;if(d&8)Iv(n,t,e.child,i);else if(d&32){let m=wk(e,t),b;for(;b=m();)i.push(b)}else if(d&16){let m=Mz(t,e);if(Array.isArray(m))i.push(...m);else{let b=Sd(t[bs]);Iv(b[Qt],b,m,i,!0)}}e=r?e.projectionNext:e.next}return i}function Lz(n,t){for(let e=Er;e<n.length;e++){let i=n[e],r=i[Qt].firstChild;r!==null&&Iv(i[Qt],i,r,t)}n[Md]!==n[hl]&&t.push(n[Md])}function Bz(n){if(n[Nf]!==null){for(let t of n[Nf])t.impl.addSequence(t);n[Nf].length=0}}var Vz=[];function jQ(n){return n[sa]??zQ(n)}function zQ(n){let t=Vz.pop()??Object.create($Q);return t.lView=n,t}function UQ(n){n.lView[sa]!==n&&(n.lView=null,Vz.push(n))}var $Q=Mt(Be({},Um),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{Bf(n.lView)},consumerOnSignalRead(){this.lView[sa]=this}});function HQ(n){let t=n[sa]??Object.create(GQ);return t.lView=n,t}var GQ=Mt(Be({},Um),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:n=>{let t=Sd(n.lView);for(;t&&!jz(t[Qt]);)t=Sd(t);t&&KM(t)},consumerOnSignalRead(){this.lView[sa]=this}});function jz(n){return n.type!==2}function zz(n){if(n[Td]===null)return;let t=!0;for(;t;){let e=!1;for(let i of n[Td])i.dirty&&(e=!0,i.zone===null||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=e&&!!(n[fn]&8192)}}var qQ=100;function Uz(n,t=0){let i=n[rc].rendererFactory,r=!1;r||i.begin?.();try{WQ(n,t)}finally{r||i.end?.()}}function WQ(n,t){let e=aA();try{dv(!0),UA(n,t);let i=0;for(;bv(n);){if(i===qQ)throw new Je(103,!1);i++,UA(n,1)}}finally{dv(e)}}function ZQ(n,t,e,i){if(Lf(t))return;let r=t[fn],o=!1,d=!1;NE(t);let m=!0,b=null,T=null;o||(jz(n)?(T=jQ(t),b=$m(T)):Mx()===null?(m=!1,T=HQ(t),b=$m(T)):t[sa]&&(bf(t[sa]),t[sa]=null));try{ZM(t),N3(n.bindingStartIndex),e!==null&&kz(n,t,e,2,i);let A=(r&3)===3;if(!o)if(A){let J=n.preOrderCheckHooks;J!==null&&GE(t,J,null)}else{let J=n.preOrderHooks;J!==null&&qE(t,J,0,null),_A(t,0)}if(d||KQ(t),zz(t),$z(t,0),n.contentQueries!==null&&nz(n,t),!o)if(A){let J=n.contentCheckHooks;J!==null&&GE(t,J)}else{let J=n.contentHooks;J!==null&&qE(t,J,1),_A(t,1)}XQ(n,t);let N=n.components;N!==null&&Gz(t,N,0);let q=n.viewQuery;if(q!==null&&kA(2,q,i),!o)if(A){let J=n.viewCheckHooks;J!==null&&GE(t,J)}else{let J=n.viewHooks;J!==null&&qE(t,J,2),_A(t,2)}if(n.firstUpdatePass===!0&&(n.firstUpdatePass=!1),t[IE]){for(let J of t[IE])J();t[IE]=null}o||(Bz(t),t[fn]&=-73)}catch(A){throw o||Bf(t),A}finally{T!==null&&(Xy(T,b),m&&UQ(T)),OE()}}function $z(n,t){for(let e=Zj(n);e!==null;e=Kj(e))for(let i=Er;i<e.length;i++){let r=e[i];Hz(r,t)}}function KQ(n){for(let t=Zj(n);t!==null;t=Kj(t)){if(!(t[fn]&2))continue;let e=t[Ff];for(let i=0;i<e.length;i++){let r=e[i];KM(r)}}}function YQ(n,t,e){li(qn.ComponentStart);let i=Pa(t,n);try{Hz(i,e)}finally{li(qn.ComponentEnd,i[Lr])}}function Hz(n,t){ME(n)&&UA(n,t)}function UA(n,t){let i=n[Qt],r=n[fn],o=n[sa],d=!!(t===0&&r&16);if(d||=!!(r&64&&t===0),d||=!!(r&1024),d||=!!(o?.dirty&&Qy(o)),d||=!1,o&&(o.dirty=!1),n[fn]&=-9217,d)ZQ(i,n,i.template,n[Lr]);else if(r&8192){let m=Xt(null);try{zz(n),$z(n,1);let b=i.components;b!==null&&Gz(n,b,1),Bz(n)}finally{Xt(m)}}}function Gz(n,t,e){for(let i=0;i<t.length;i++)YQ(n,t[i],e)}function XQ(n,t){let e=n.hostBindingOpCodes;if(e!==null)try{for(let i=0;i<e.length;i++){let r=e[i];if(r<0)Rd(~r);else{let o=r,d=e[++i],m=e[++i];F3(d,o);let b=t[o];li(qn.HostBindingsUpdateStart,b);try{m(2,b)}finally{li(qn.HostBindingsUpdateEnd,b)}}}}finally{Rd(-1)}}function Mk(n,t){let e=aA()?64:1088;for(n[rc].changeDetectionScheduler?.notify(t);n;){n[fn]|=e;let i=Sd(n);if(cg(n)&&!i)return n;n=i}return null}function qz(n,t,e,i){return[n,!0,0,t,null,i,null,e,null,null]}function Wz(n,t){let e=Er+t;if(e<n.length)return n[e]}function Bv(n,t,e,i=!0){let r=t[Qt];if(QQ(r,t,n,e),i){let d=zA(e,n),m=t[ki],b=m.parentNode(n[Md]);b!==null&&pQ(r,n[vs],m,t,b,d)}let o=t[kf];o!==null&&o.firstChild!==null&&(o.firstChild=null)}function Zz(n,t){let e=Mv(n,t);return e!==void 0&&x1(e[Qt],e),e}function Mv(n,t){if(n.length<=Er)return;let e=Er+t,i=n[e];if(i){let r=i[Id];r!==null&&r!==n&&Ek(r,i),t>0&&(n[e-1][ka]=i[ka]);let o=mv(n,Er+t);fQ(i[Qt],i);let d=o[oc];d!==null&&d.detachView(o[Qt]),i[oo]=null,i[ka]=null,i[fn]&=-129}return i}function QQ(n,t,e,i){let r=Er+i,o=e.length;i>0&&(e[r-1][ka]=t),i<o-Er?(t[ka]=e[r],OM(e,Er+i,t)):(e.push(t),t[ka]=null),t[oo]=e;let d=t[Id];d!==null&&e!==d&&Kz(d,t);let m=t[oc];m!==null&&m.insertView(n),AE(t),t[fn]|=128}function Kz(n,t){let e=n[Ff],i=t[oo];if(sc(i))n[fn]|=2;else{let r=i[oo][bs];t[bs]!==r&&(n[fn]|=2)}e===null?n[Ff]=[t]:e.push(t)}var Pd=class{_lView;_cdRefInjectingView;_appRef=null;_attachedToViewContainer=!1;exhaustive;get rootNodes(){let t=this._lView,e=t[Qt];return Iv(e,t,e.firstChild,[])}constructor(t,e){this._lView=t,this._cdRefInjectingView=e}get context(){return this._lView[Lr]}set context(t){this._lView[Lr]=t}get destroyed(){return Lf(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let t=this._lView[oo];if(fl(t)){let e=t[_v],i=e?e.indexOf(this):-1;i>-1&&(Mv(t,i),mv(e,i))}this._attachedToViewContainer=!1}x1(this._lView[Qt],this._lView)}onDestroy(t){YM(this._lView,t)}markForCheck(){Mk(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[fn]&=-129}reattach(){AE(this._lView),this._lView[fn]|=128}detectChanges(){this._lView[fn]|=1024,Uz(this._lView)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Je(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let t=cg(this._lView),e=this._lView[Id];e!==null&&!t&&Ek(e,this._lView),Sz(this._lView[Qt],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Je(902,!1);this._appRef=t;let e=cg(this._lView),i=this._lView[Id];i!==null&&!e&&Kz(i,this._lView),AE(this._lView)}};var Vs=(()=>{class n{_declarationLView;_declarationTContainer;elementRef;static __NG_ELEMENT_ID__=JQ;constructor(e,i,r){this._declarationLView=e,this._declarationTContainer=i,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,i){return this.createEmbeddedViewImpl(e,i)}createEmbeddedViewImpl(e,i,r){let o=Lv(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:i,dehydratedView:r});return new Pd(o)}}return n})();function JQ(){return Ak(Eo(),rn())}function Ak(n,t){return n.type&4?new Vs(t,n,bg(n,t)):null}function Eg(n,t,e,i,r){let o=n.data[t];if(o===null)o=eJ(n,t,e,i,r),O3()&&(o.flags|=32);else if(o.type&64){o.type=e,o.value=i,o.attrs=r;let d=P3();o.injectorIndex=d===null?-1:d.injectorIndex}return ug(o,!0),o}function eJ(n,t,e,i,r){let o=rA(),d=oA(),m=d?o:o&&o.parent,b=n.data[t]=nJ(n,m,e,t,i,r);return tJ(n,b,o,d),b}function tJ(n,t,e,i){n.firstChild===null&&(n.firstChild=t),e!==null&&(i?e.child==null&&t.parent!==null&&(e.child=t):e.next===null&&(e.next=t,t.prev=e))}function nJ(n,t,e,i,r,o){let d=t?t.injectorIndex:-1,m=0;return tA()&&(m|=128),{type:e,index:i,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,fieldIndex:-1,customControlIndex:-1,propertyBindings:null,flags:m,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function iJ(n){let t=n[$M]??[],i=n[oo][ki],r=[];for(let o of t)o.data[Qj]!==void 0?r.push(o):rJ(o,i);n[$M]=r}function rJ(n,t){let e=0,i=n.firstChild;if(i){let r=n.data[Xj];for(;e<r;){let o=i.nextSibling;hz(t,i,!1),i=o,e++}}}var oJ=()=>null,sJ=()=>null;function r1(n,t){return oJ(n,t)}function Yz(n,t,e){return sJ(n,t,e)}var Xz=class{},T1=class{},$A=class{resolveComponentFactory(t){throw new Je(917,!1)}},Vv=class{static NULL=new $A},pr=class{},Br=(()=>{class n{destroyNode=null;static __NG_ELEMENT_ID__=()=>aJ()}return n})();function aJ(){let n=rn(),t=Eo(),e=Pa(t.index,n);return(sc(e)?e:n)[ki]}var Qz=(()=>{class n{static \u0275prov=ze({token:n,providedIn:"root",factory:()=>null})}return n})();var ZE={},HA=class{injector;parentInjector;constructor(t,e){this.injector=t,this.parentInjector=e}get(t,e,i){let r=this.injector.get(t,ZE,i);return r!==ZE||e===ZE?r:this.parentInjector.get(t,e,i)}};function o1(n,t,e){let i=e?n.styles:null,r=e?n.classes:null,o=0;if(t!==null)for(let d=0;d<t.length;d++){let m=t[d];if(typeof m=="number")o=m;else if(o==1)r=bE(r,m);else if(o==2){let b=m,T=t[++d];i=bE(i,b+": "+T+";")}}e?n.styles=i:n.stylesWithoutHost=i,e?n.classes=r:n.classesWithoutHost=r}function Ze(n,t=0){let e=rn();if(e===null)return vt(n,t);let i=Eo();return $j(i,e,Vo(n),t)}function kk(){let n="invalid";throw new Error(n)}function Jz(n,t,e,i,r){let o=i===null?null:{"":-1},d=r(n,e);if(d!==null){let m=d,b=null,T=null;for(let A of d)if(A.resolveHostDirectives!==null){[m,b,T]=A.resolveHostDirectives(d);break}uJ(n,t,e,m,o,b,T)}o!==null&&i!==null&&lJ(e,i,o)}function lJ(n,t,e){let i=n.localNames=[];for(let r=0;r<t.length;r+=2){let o=e[t[r+1]];if(o==null)throw new Je(-301,!1);i.push(t[r],o)}}function cJ(n,t,e){t.componentOffset=e,(n.components??=[]).push(t.index)}function uJ(n,t,e,i,r,o,d){let m=i.length,b=null;for(let q=0;q<m;q++){let J=i[q];b===null&&ac(J)&&(b=J,cJ(n,e,q)),IA(e1(e,t),n,J.type)}gJ(e,n.data.length,m),b?.viewProvidersResolver&&b.viewProvidersResolver(b);for(let q=0;q<m;q++){let J=i[q];J.providersResolver&&J.providersResolver(J)}let T=!1,A=!1,N=bz(n,t,m,null);m>0&&(e.directiveToIndex=new Map);for(let q=0;q<m;q++){let J=i[q];if(e.mergedAttrs=gg(e.mergedAttrs,J.hostAttrs),hJ(n,e,t,N,J),mJ(N,J,r),d!==null&&d.has(J)){let[xe,Te]=d.get(J);e.directiveToIndex.set(J.type,[N,xe+e.directiveStart,Te+e.directiveStart])}else(o===null||!o.has(J))&&e.directiveToIndex.set(J.type,N);J.contentQueries!==null&&(e.flags|=4),(J.hostBindings!==null||J.hostAttrs!==null||J.hostVars!==0)&&(e.flags|=64);let K=J.type.prototype;!T&&(K.ngOnChanges||K.ngOnInit||K.ngDoCheck)&&((n.preOrderHooks??=[]).push(e.index),T=!0),!A&&(K.ngOnChanges||K.ngDoCheck)&&((n.preOrderCheckHooks??=[]).push(e.index),A=!0),N++}dJ(n,e,o)}function dJ(n,t,e){for(let i=t.directiveStart;i<t.directiveEnd;i++){let r=n.data[i];if(e===null||!e.has(r))mj(0,t,r,i),mj(1,t,r,i),_j(t,i,!1);else{let o=e.get(r);gj(0,t,o,i),gj(1,t,o,i),_j(t,i,!0)}}}function mj(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let d;n===0?d=t.inputs??={}:d=t.outputs??={},d[o]??=[],d[o].push(i),eU(t,o)}}function gj(n,t,e,i){let r=n===0?e.inputs:e.outputs;for(let o in r)if(r.hasOwnProperty(o)){let d=r[o],m;n===0?m=t.hostDirectiveInputs??={}:m=t.hostDirectiveOutputs??={},m[d]??=[],m[d].push(i,o),eU(t,d)}}function eU(n,t){t==="class"?n.flags|=8:t==="style"&&(n.flags|=16)}function _j(n,t,e){let{attrs:i,inputs:r,hostDirectiveInputs:o}=n;if(i===null||!e&&r===null||e&&o===null||_k(n)){n.initialInputs??=[],n.initialInputs.push(null);return}let d=null,m=0;for(;m<i.length;){let b=i[m];if(b===0){m+=4;continue}else if(b===5){m+=2;continue}else if(typeof b=="number")break;if(!e&&r.hasOwnProperty(b)){let T=r[b];for(let A of T)if(A===t){d??=[],d.push(b,i[m+1]);break}}else if(e&&o.hasOwnProperty(b)){let T=o[b];for(let A=0;A<T.length;A+=2)if(T[A]===t){d??=[],d.push(T[A+1],i[m+1]);break}}m+=2}n.initialInputs??=[],n.initialInputs.push(d)}function hJ(n,t,e,i,r){n.data[i]=r;let o=r.factory||(r.factory=Cd(r.type,!0)),d=new jf(o,ac(r),Ze,null);n.blueprint[i]=d,e[i]=d,fJ(n,t,i,bz(n,e,r.hostVars,lo),r)}function fJ(n,t,e,i,r){let o=r.hostBindings;if(o){let d=n.hostBindingOpCodes;d===null&&(d=n.hostBindingOpCodes=[]);let m=~t.index;pJ(d)!=m&&d.push(m),d.push(e,i,o)}}function pJ(n){let t=n.length;for(;t>0;){let e=n[--t];if(typeof e=="number"&&e<0)return e}return 0}function mJ(n,t,e){if(e){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)e[t.exportAs[i]]=n;ac(t)&&(e[""]=n)}}function gJ(n,t,e){n.flags|=1,n.directiveStart=t,n.directiveEnd=t+e,n.providerIndexes=t}function tU(n,t,e,i,r,o,d,m){let b=t[Qt],T=b.consts,A=Na(T,d),N=Eg(b,n,e,i,A);return o&&Jz(b,t,N,Na(T,m),r),N.mergedAttrs=gg(N.mergedAttrs,N.attrs),N.attrs!==null&&o1(N,N.attrs,!1),N.mergedAttrs!==null&&o1(N,N.mergedAttrs,!0),b.queries!==null&&b.queries.elementStart(b,N),N}function nU(n,t){Nj(n,t),HM(t)&&n.queries.elementEnd(t)}function _J(n,t,e,i,r,o){let d=t.consts,m=Na(d,r),b=Eg(t,n,e,i,m);if(b.mergedAttrs=gg(b.mergedAttrs,b.attrs),o!=null){let T=Na(d,o);b.localNames=[];for(let A=0;A<T.length;A+=2)b.localNames.push(T[A],-1)}return b.attrs!==null&&o1(b,b.attrs,!1),b.mergedAttrs!==null&&o1(b,b.mergedAttrs,!0),t.queries!==null&&t.queries.elementStart(t,b),b}function iU(n,t,e){return n[t]=e}function yJ(n,t){return n[t]}function Fa(n,t,e){if(e===lo)return!1;let i=n[t];return Object.is(i,e)?!1:(n[t]=e,!0)}function s1(n,t,e,i){let r=Fa(n,t,e);return Fa(n,t+1,i)||r}function vJ(n,t,e,i,r){let o=s1(n,t,e,i);return Fa(n,t+2,r)||o}function rU(n,t,e,i,r,o){let d=s1(n,t,e,i);return s1(n,t+2,r,o)||d}function KE(n,t,e){return function i(r){let o=Ad(n)?Pa(n.index,t):t;Mk(o,5);let d=t[Lr],m=yj(t,d,e,r),b=i.__ngNextListenerFn__;for(;b;)m=yj(t,d,b,r)&&m,b=b.__ngNextListenerFn__;return m}}function yj(n,t,e,i){let r=Xt(null);try{return li(qn.OutputStart,t,e),e(i)!==!1}catch(o){return FQ(n,o),!1}finally{li(qn.OutputEnd,t,e),Xt(r)}}function oU(n,t,e,i,r,o,d,m){let b=yv(n),T=!1,A=null;if(!i&&b&&(A=wJ(t,e,o,n.index)),A!==null){let N=A.__ngLastListenerFn__||A;N.__ngNextListenerFn__=d,A.__ngLastListenerFn__=d,T=!0}else{let N=pl(n,e),q=i?i(N):N;bX(e,q,o,m);let J=r.listen(q,o,m);if(!bJ(o)){let K=i?xe=>i(Ra(xe[n.index])):n.index;sU(K,t,e,o,m,J,!1)}}return T}function bJ(n){return n.startsWith("animation")||n.startsWith("transition")}function wJ(n,t,e,i){let r=n.cleanup;if(r!=null)for(let o=0;o<r.length-1;o+=2){let d=r[o];if(d===e&&r[o+1]===i){let m=t[ag],b=r[o+2];return m&&m.length>b?m[b]:null}typeof d=="string"&&(o+=2)}return null}function sU(n,t,e,i,r,o,d){let m=t.firstCreatePass?QM(t):null,b=XM(e),T=b.length;b.push(r,o),m&&m.push(i,n,T,(T+1)*(d?-1:1))}function vj(n,t,e,i,r,o){let d=t[e],m=t[Qt],T=m.data[e].outputs[i],N=d[T].subscribe(o);sU(n.index,m,t,r,o,N,!0)}var GA=Symbol("BINDING");var a1=class extends Vv{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){let e=ic(t);return new Nd(e,this.ngModule)}};function xJ(n){return Object.keys(n).map(t=>{let[e,i,r]=n[t],o={propName:e,templateName:t,isSignal:(i&b1.SignalBased)!==0};return r&&(o.transform=r),o})}function EJ(n){return Object.keys(n).map(t=>({propName:n[t],templateName:t}))}function CJ(n,t,e){let i=t instanceof si?t:t?.injector;return i&&n.getStandaloneInjector!==null&&(i=n.getStandaloneInjector(i)||i),i?new HA(e,i):e}function TJ(n){let t=n.get(pr,null);if(t===null)throw new Je(407,!1);let e=n.get(Qz,null),i=n.get(nc,null);return{rendererFactory:t,sanitizer:e,changeDetectionScheduler:i,ngReflect:!1}}function SJ(n,t){let e=aU(n);return uz(t,e,e==="svg"?GM:e==="math"?C3:null)}function aU(n){return(n.selectors[0][0]||"div").toLowerCase()}var Nd=class extends T1{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=xJ(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=EJ(this.componentDef.outputs),this.cachedOutputs}constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=iQ(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!e}create(t,e,i,r,o,d){li(qn.DynamicComponentStart);let m=Xt(null);try{let b=this.componentDef,T=DJ(i,b,d,o),A=CJ(b,r||this.ngModule,t),N=TJ(A),q=N.rendererFactory.createRenderer(null,b),J=i?TQ(q,i,b.encapsulation,A):SJ(b,q),K=d?.some(bj)||o?.some(Ge=>typeof Ge!="function"&&Ge.bindings.some(bj)),xe=vk(null,T,null,512|vz(b),null,null,N,q,A,null,tz(J,A,!0));xe[xr]=J,NE(xe);let Te=null;try{let Ge=tU(xr,xe,2,"#host",()=>T.directiveRegistry,!0,0);fz(q,J,Ge),_g(J,xe),Sk(T,xe,Ge),iz(T,Ge,xe),nU(T,Ge),e!==void 0&&MJ(Ge,this.ngContentSelectors,e),Te=Pa(Ge.index,xe),xe[Lr]=Te[Lr],Ik(T,xe,null)}catch(Ge){throw Te!==null&&AA(Te),AA(xe),Ge}finally{li(qn.DynamicComponentEnd),OE()}return new l1(this.componentType,xe,!!K)}finally{Xt(m)}}};function DJ(n,t,e,i){let r=n?["ng-version","21.1.2"]:rQ(t.selectors[0]),o=null,d=null,m=0;if(e)for(let A of e)m+=A[GA].requiredVars,A.create&&(A.targetIdx=0,(o??=[]).push(A)),A.update&&(A.targetIdx=0,(d??=[]).push(A));if(i)for(let A=0;A<i.length;A++){let N=i[A];if(typeof N!="function")for(let q of N.bindings){m+=q[GA].requiredVars;let J=A+1;q.create&&(q.targetIdx=J,(o??=[]).push(q)),q.update&&(q.targetIdx=J,(d??=[]).push(q))}}let b=[t];if(i)for(let A of i){let N=typeof A=="function"?A:A.type,q=RM(N);b.push(q)}return yk(0,null,IJ(o,d),1,m,b,null,null,null,[r],null)}function IJ(n,t){return!n&&!t?null:e=>{if(e&1&&n)for(let i of n)i.create();if(e&2&&t)for(let i of t)i.update()}}function bj(n){let t=n[GA].kind;return t==="input"||t==="twoWay"}var l1=class extends Xz{_rootLView;_hasInputBindings;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,e,i){super(),this._rootLView=e,this._hasInputBindings=i,this._tNode=vv(e[Qt],xr),this.location=bg(this._tNode,e),this.instance=Pa(this._tNode.index,e)[Lr],this.hostView=this.changeDetectorRef=new Pd(e,void 0),this.componentType=t}setInput(t,e){this._hasInputBindings;let i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),e))return;let r=this._rootLView,o=Dk(i,r[Qt],r,t,e);this.previousInputValues.set(t,e);let d=Pa(i.index,r);Mk(d,1)}get injector(){return new Vf(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}};function MJ(n,t,e){let i=n.projection=[];for(let r=0;r<t.length;r++){let o=e[r];i.push(o!=null&&o.length?Array.from(o):null)}}var ua=(()=>{class n{static __NG_ELEMENT_ID__=AJ}return n})();function AJ(){let n=Eo();return cU(n,rn())}var kJ=ua,lU=class extends kJ{_lContainer;_hostTNode;_hostLView;constructor(t,e,i){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=i}get element(){return bg(this._hostTNode,this._hostLView)}get injector(){return new Vf(this._hostTNode,this._hostLView)}get parentInjector(){let t=ak(this._hostTNode,this._hostLView);if(Lj(t)){let e=QE(t,this._hostLView),i=XE(t),r=e[Qt].data[i+8];return new Vf(r,e)}else return new Vf(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){let e=wj(this._lContainer);return e!==null&&e[t]||null}get length(){return this._lContainer.length-Er}createEmbeddedView(t,e,i){let r,o;typeof i=="number"?r=i:i!=null&&(r=i.index,o=i.injector);let d=r1(this._lContainer,t.ssrId),m=t.createEmbeddedViewImpl(e||{},o,d);return this.insertImpl(m,r,yg(this._hostTNode,d)),m}createComponent(t,e,i,r,o,d,m){let b=t&&!qY(t),T;if(b)T=e;else{let Te=e||{};T=Te.index,i=Te.injector,r=Te.projectableNodes,o=Te.environmentInjector||Te.ngModuleRef,d=Te.directives,m=Te.bindings}let A=b?t:new Nd(ic(t)),N=i||this.parentInjector;if(!o&&A.ngModule==null){let Ge=(b?N:this.parentInjector).get(si,null);Ge&&(o=Ge)}let q=ic(A.componentType??{}),J=r1(this._lContainer,q?.id??null),K=J?.firstChild??null,xe=A.create(N,r,K,o,d,m);return this.insertImpl(xe.hostView,T,yg(this._hostTNode,J)),xe}insert(t,e){return this.insertImpl(t,e,!0)}insertImpl(t,e,i){let r=t._lView;if(D3(r)){let m=this.indexOf(t);if(m!==-1)this.detach(m);else{let b=r[oo],T=new lU(b,b[vs],b[oo]);T.detach(T.indexOf(t))}}let o=this._adjustIndex(e),d=this._lContainer;return Bv(d,r,o,i),t.attachToViewContainerRef(),OM(bA(d),o,t),t}move(t,e){return this.insert(t,e)}indexOf(t){let e=wj(this._lContainer);return e!==null?e.indexOf(t):-1}remove(t){let e=this._adjustIndex(t,-1),i=Mv(this._lContainer,e);i&&(mv(bA(this._lContainer),e),x1(i[Qt],i))}detach(t){let e=this._adjustIndex(t,-1),i=Mv(this._lContainer,e);return i&&mv(bA(this._lContainer),e)!=null?new Pd(i):null}_adjustIndex(t,e=0){return t??this.length+e}};function wj(n){return n[_v]}function bA(n){return n[_v]||(n[_v]=[])}function cU(n,t){let e,i=t[n.index];return fl(i)?e=i:(e=qz(i,t,null,n),t[n.index]=e,bk(t,e)),PJ(e,t,n,i),new lU(e,n,t)}function RJ(n,t){let e=n[ki],i=e.createComment(""),r=pl(t,n),o=e.parentNode(r);return n1(e,o,i,e.nextSibling(r),!1),i}var PJ=FJ,NJ=()=>!1;function OJ(n,t,e){return NJ(n,t,e)}function FJ(n,t,e,i){if(n[Md])return;let r;e.type&8?r=Ra(i):r=RJ(t,e),n[Md]=r}var qA=class n{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new n(this.queryList)}setDirty(){this.queryList.setDirty()}},WA=class n{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){let e=t.queries;if(e!==null){let i=t.contentQueries!==null?t.contentQueries[0]:e.length,r=[];for(let o=0;o<i;o++){let d=e.getByIndex(o),m=this.queries[d.indexInDeclarationView];r.push(m.clone())}return new n(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)Rk(t,e).matches!==null&&this.queries[e].setDirty()}},c1=class{flags;read;predicate;constructor(t,e,i=null){this.flags=e,this.read=i,typeof t=="string"?this.predicate=HJ(t):this.predicate=t}},ZA=class n{queries;constructor(t=[]){this.queries=t}elementStart(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let i=0;i<this.length;i++){let r=e!==null?e.length:0,o=this.getByIndex(i).embeddedTView(t,r);o&&(o.indexInDeclarationView=i,e!==null?e.push(o):e=[o])}return e!==null?new n(e):null}template(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}},KA=class n{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,e=-1){this.metadata=t,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new n(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,i=t.parent;for(;i!==null&&i.type&8&&i.index!==e;)i=i.parent;return e===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(t,e){let i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){let o=i[r];this.matchTNodeWithReadOption(t,e,LJ(e,o)),this.matchTNodeWithReadOption(t,e,WE(e,t,o,!1,!1))}else i===Vs?e.type&4&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,WE(e,t,i,!1,!1))}matchTNodeWithReadOption(t,e,i){if(i!==null){let r=this.metadata.read;if(r!==null)if(r===Fn||r===ua||r===Vs&&e.type&4)this.addMatch(e.index,-2);else{let o=WE(e,t,r,!1,!1);o!==null&&this.addMatch(e.index,o)}else this.addMatch(e.index,i)}}addMatch(t,e){this.matches===null?this.matches=[t,e]:this.matches.push(t,e)}};function LJ(n,t){let e=n.localNames;if(e!==null){for(let i=0;i<e.length;i+=2)if(e[i]===t)return e[i+1]}return null}function BJ(n,t){return n.type&11?bg(n,t):n.type&4?Ak(n,t):null}function VJ(n,t,e,i){return e===-1?BJ(t,n):e===-2?jJ(n,t,i):Dv(n,n[Qt],e,t)}function jJ(n,t,e){if(e===Fn)return bg(t,n);if(e===Vs)return Ak(t,n);if(e===ua)return cU(t,n)}function uU(n,t,e,i){let r=t[oc].queries[i];if(r.matches===null){let o=n.data,d=e.matches,m=[];for(let b=0;d!==null&&b<d.length;b+=2){let T=d[b];if(T<0)m.push(null);else{let A=o[T];m.push(VJ(t,A,d[b+1],e.metadata.read))}}r.matches=m}return r.matches}function YA(n,t,e,i){let r=n.queries.getByIndex(e),o=r.matches;if(o!==null){let d=uU(n,t,r,e);for(let m=0;m<o.length;m+=2){let b=o[m];if(b>0)i.push(d[m/2]);else{let T=o[m+1],A=t[-b];for(let N=Er;N<A.length;N++){let q=A[N];q[Id]===q[oo]&&YA(q[Qt],q,T,i)}if(A[Ff]!==null){let N=A[Ff];for(let q=0;q<N.length;q++){let J=N[q];YA(J[Qt],J,T,i)}}}}}return i}function zJ(n,t){return n[oc].queries[t].queryList}function dU(n,t,e){let i=new t1((e&4)===4);return A3(n,t,i,i.destroy),(t[oc]??=new WA).queries.push(new qA(i))-1}function UJ(n,t,e){let i=ar();return i.firstCreatePass&&(hU(i,new c1(n,t,e),-1),(t&2)===2&&(i.staticViewQueries=!0)),dU(i,rn(),t)}function $J(n,t,e,i){let r=ar();if(r.firstCreatePass){let o=Eo();hU(r,new c1(t,e,i),o.index),GJ(r,n),(e&2)===2&&(r.staticContentQueries=!0)}return dU(r,rn(),e)}function HJ(n){return n.split(",").map(t=>t.trim())}function hU(n,t,e){n.queries===null&&(n.queries=new ZA),n.queries.track(new KA(t,e))}function GJ(n,t){let e=n.contentQueries||(n.contentQueries=[]),i=e.length?e[e.length-1]:-1;t!==i&&e.push(n.queries.length-1,t)}function Rk(n,t){return n.queries.getByIndex(t)}function qJ(n,t){let e=n[Qt],i=Rk(e,t);return i.crossesNgTemplate?YA(e,n,t,[]):uU(e,n,i,t)}var dc=class{},S1=class{};var u1=class extends dc{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new a1(this);constructor(t,e,i,r=!0){super(),this.ngModuleType=t,this._parent=e;let o=kM(t);this._bootstrapComponents=gz(o.bootstrap),this._r3Injector=hA(t,e,[{provide:dc,useValue:this},{provide:Vv,useValue:this.componentFactoryResolver},...i],lu(t),new Set(["environment"])),r&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}},d1=class extends S1{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new u1(this.moduleType,t,[])}};var Av=class extends dc{injector;componentFactoryResolver=new a1(this);instance=null;constructor(t){super();let e=new Mf([...t.providers,{provide:dc,useValue:this},{provide:Vv,useValue:this.componentFactoryResolver}],t.parent||sg(),t.debugName,new Set(["environment"]));this.injector=e,t.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}};function Cg(n,t,e=null){return new Av({providers:n,parent:t,debugName:e,runEnvironmentInitializers:!0}).injector}var WJ=(()=>{class n{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let i=BM(!1,e.type),r=i.length>0?Cg([i],this._injector,""):null;this.cachedInjectors.set(e,r)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=ze({token:n,providedIn:"environment",factory:()=>new n(vt(si))})}return n})();function Pt(n){return Pv(()=>{let t=fU(n),e=Mt(Be({},t),{decls:n.decls,vars:n.vars,template:n.template,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,onPush:n.changeDetection===lk.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&n.dependencies||null,getStandaloneInjector:t.standalone?r=>r.get(WJ).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:n.signals??!1,data:n.data||{},encapsulation:n.encapsulation||_l.Emulated,styles:n.styles||ys,_:null,schemas:n.schemas||null,tView:null,id:""});t.standalone&&ca("NgStandalone"),pU(e);let i=n.dependencies;return e.directiveDefs=xj(i,ZJ),e.pipeDefs=xj(i,d3),e.id=XJ(e),e})}function ZJ(n){return ic(n)||RM(n)}function In(n){return Pv(()=>({type:n.type,bootstrap:n.bootstrap||ys,declarations:n.declarations||ys,imports:n.imports||ys,exports:n.exports||ys,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function KJ(n,t){if(n==null)return Dd;let e={};for(let i in n)if(n.hasOwnProperty(i)){let r=n[i],o,d,m,b;Array.isArray(r)?(m=r[0],o=r[1],d=r[2]??o,b=r[3]||null):(o=r,d=r,m=b1.None,b=null),e[o]=[i,m,b],t[o]=d}return e}function YJ(n){if(n==null)return Dd;let t={};for(let e in n)n.hasOwnProperty(e)&&(t[n[e]]=e);return t}function sn(n){return Pv(()=>{let t=fU(n);return pU(t),t})}function Pk(n){return{type:n.type,name:n.name,factory:null,pure:n.pure!==!1,standalone:n.standalone??!0,onDestroy:n.type.prototype.ngOnDestroy||null}}function fU(n){let t={};return{type:n.type,providersResolver:null,viewProvidersResolver:null,factory:null,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputConfig:n.inputs||Dd,exportAs:n.exportAs||null,standalone:n.standalone??!0,signals:n.signals===!0,selectors:n.selectors||ys,viewQuery:n.viewQuery||null,features:n.features||null,setInput:null,resolveHostDirectives:null,hostDirectives:null,inputs:KJ(n.inputs,t),outputs:YJ(n.outputs),debugInfo:null}}function pU(n){n.features?.forEach(t=>t(n))}function xj(n,t){return n?()=>{let e=typeof n=="function"?n():n,i=[];for(let r of e){let o=t(r);o!==null&&i.push(o)}return i}:null}function XJ(n){let t=0,e=typeof n.consts=="function"?"":n.consts,i=[n.selectors,n.ngContentSelectors,n.hostVars,n.hostAttrs,e,n.vars,n.decls,n.encapsulation,n.standalone,n.signals,n.exportAs,JSON.stringify(n.inputs),JSON.stringify(n.outputs),Object.getOwnPropertyNames(n.type.prototype),!!n.contentQueries,!!n.viewQuery];for(let o of i.join("|"))t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}function QJ(n){return Object.getPrototypeOf(n.prototype).constructor}function ci(n){let t=QJ(n.type),e=!0,i=[n];for(;t;){let r;if(ac(n))r=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Je(903,!1);r=t.\u0275dir}if(r){if(e){i.push(r);let d=n;d.inputs=wA(n.inputs),d.declaredInputs=wA(n.declaredInputs),d.outputs=wA(n.outputs);let m=r.hostBindings;m&&iee(n,m);let b=r.viewQuery,T=r.contentQueries;if(b&&tee(n,b),T&&nee(n,T),JJ(n,r),u3(n.outputs,r.outputs),ac(r)&&r.data.animation){let A=n.data;A.animation=(A.animation||[]).concat(r.data.animation)}}let o=r.features;if(o)for(let d=0;d<o.length;d++){let m=o[d];m&&m.ngInherit&&m(n),m===ci&&(e=!1)}}t=Object.getPrototypeOf(t)}eee(i)}function JJ(n,t){for(let e in t.inputs){if(!t.inputs.hasOwnProperty(e)||n.inputs.hasOwnProperty(e))continue;let i=t.inputs[e];i!==void 0&&(n.inputs[e]=i,n.declaredInputs[e]=t.declaredInputs[e])}}function eee(n){let t=0,e=null;for(let i=n.length-1;i>=0;i--){let r=n[i];r.hostVars=t+=r.hostVars,r.hostAttrs=gg(r.hostAttrs,e=gg(e,r.hostAttrs))}}function wA(n){return n===Dd?{}:n===ys?[]:n}function tee(n,t){let e=n.viewQuery;e?n.viewQuery=(i,r)=>{t(i,r),e(i,r)}:n.viewQuery=t}function nee(n,t){let e=n.contentQueries;e?n.contentQueries=(i,r,o)=>{t(i,r,o),e(i,r,o)}:n.contentQueries=t}function iee(n,t){let e=n.hostBindings;e?n.hostBindings=(i,r)=>{t(i,r),e(i,r)}:n.hostBindings=t}function mU(n,t,e,i,r,o,d,m){if(e.firstCreatePass){n.mergedAttrs=gg(n.mergedAttrs,n.attrs);let A=n.tView=yk(2,n,r,o,d,e.directiveRegistry,e.pipeRegistry,null,e.schemas,e.consts,null);e.queries!==null&&(e.queries.template(e,n),A.queries=e.queries.embeddedTView(n))}m&&(n.flags|=m),ug(n,!1);let b=oee(e,t,n,i);FE()&&Ck(e,t,b,n),_g(b,t);let T=qz(b,t,b,n);t[i+xr]=T,bk(t,T),OJ(T,n,t)}function ree(n,t,e,i,r,o,d,m,b,T,A){let N=e+xr,q;return t.firstCreatePass?(q=Eg(t,N,4,d||null,m||null),eA()&&Jz(t,n,q,Na(t.consts,T),Nz),Nj(t,q)):q=t.data[N],mU(q,n,t,e,i,r,o,b),yv(q)&&Sk(t,n,q),T!=null&&C1(n,q,A),q}function kv(n,t,e,i,r,o,d,m,b,T,A){let N=e+xr,q;if(t.firstCreatePass){if(q=Eg(t,N,4,d||null,m||null),T!=null){let J=Na(t.consts,T);q.localNames=[];for(let K=0;K<J.length;K+=2)q.localNames.push(J[K],-1)}}else q=t.data[N];return mU(q,n,t,e,i,r,o,b),T!=null&&C1(n,q,A),q}function Fd(n,t,e,i,r,o,d,m){let b=rn(),T=ar(),A=Na(T.consts,o);return ree(b,T,n,t,e,i,r,A,void 0,d,m),Fd}var oee=see;function see(n,t,e,i){return LE(!0),t[ki].createComment("")}var D1=(()=>{class n{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"platform"})}return n})();function gU(n){return typeof n=="function"&&n[gs]!==void 0}function Nk(n){return gU(n)&&typeof n.set=="function"}var Ok=new rt("");function Ld(n){return!!n&&typeof n.then=="function"}function Fk(n){return!!n&&typeof n.subscribe=="function"}var Lk=new rt("");function Tg(n){return dl([{provide:Lk,multi:!0,useValue:n}])}var Bk=(()=>{class n{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,i)=>{this.resolve=e,this.reject=i});appInits=se(Lk,{optional:!0})??[];injector=se(en);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let r of this.appInits){let o=so(this.injector,r);if(Ld(o))e.push(o);else if(Fk(o)){let d=new Promise((m,b)=>{o.subscribe({complete:m,error:b})});e.push(d)}}let i=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{i()}).catch(r=>{this.reject(r)}),e.length===0&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),jv=new rt("");function _U(){KI(()=>{let n="";throw new Je(600,n)})}function yU(n){return n.isBoundToModule}var aee=10;var To=(()=>{class n{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=se(aa);afterRenderManager=se(xk);zonelessEnabled=se(hg);rootEffectScheduler=se(jE);dirtyFlags=0;tracingSnapshot=null;allTestViews=new Set;autoDetectTestViews=new Set;includeAllTestViews=!1;afterTick=new yt;get allViews(){return[...(this.includeAllTestViews?this.allTestViews:this.autoDetectTestViews).keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];internalPendingTask=se(lc);get isStable(){return this.internalPendingTask.hasPendingTasksObservable.pipe(Tn(e=>!e))}constructor(){se(mu,{optional:!0})}whenStable(){let e;return new Promise(i=>{e=this.isStable.subscribe({next:r=>{r&&i()}})}).finally(()=>{e.unsubscribe()})}_injector=se(si);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,i){return this.bootstrapImpl(e,i)}bootstrapImpl(e,i,r=en.NULL){return this._injector.get(jt).run(()=>{li(qn.BootstrapComponentStart);let d=e instanceof T1;if(!this._injector.get(Bk).done){let K="";throw new Je(405,K)}let b;d?b=e:b=this._injector.get(Vv).resolveComponentFactory(e),this.componentTypes.push(b.componentType);let T=yU(b)?void 0:this._injector.get(dc),A=i||b.selector,N=b.create(r,[],A,T),q=N.location.nativeElement,J=N.injector.get(Ok,null);return J?.registerApplication(q),N.onDestroy(()=>{this.detachView(N.hostView),Tv(this.components,N),J?.unregisterApplication(q)}),this._loadComponent(N),li(qn.BootstrapComponentEnd,N),N})}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){li(qn.ChangeDetectionStart),this.tracingSnapshot!==null?this.tracingSnapshot.run(w1.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw li(qn.ChangeDetectionEnd),new Je(101,!1);let e=Xt(null);try{this._runningTick=!0,this.synchronize()}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,Xt(e),this.afterTick.next(),li(qn.ChangeDetectionEnd)}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(pr,null,{optional:!0}));let e=0;for(;this.dirtyFlags!==0&&e++<aee;){li(qn.ChangeDetectionSyncStart);try{this.synchronizeOnce()}finally{li(qn.ChangeDetectionSyncEnd)}}}synchronizeOnce(){this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush());let e=!1;if(this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r}of this.allViews){if(!i&&!bv(r))continue;let o=i&&!this.zonelessEnabled?0:1;Uz(r,o),e=!0}if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}e||(this._rendererFactory?.begin?.(),this._rendererFactory?.end?.()),this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>bv(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let i=e;this._views.push(i),i.attachToAppRef(this)}detachView(e){let i=e;Tv(this._views,i),i.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView);try{this.tick()}catch(r){this.internalErrorHandler(r)}this.components.push(e),this._injector.get(jv,[]).forEach(r=>r(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Tv(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Je(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Tv(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function uo(n,t,e,i){let r=rn(),o=kd();if(Fa(r,o,t)){let d=ar(),m=wv();PQ(m,r,n,t,e,i)}return uo}var STe=typeof document<"u"&&typeof document?.documentElement?.getAnimations=="function";var XA=class{destroy(t){}updateValue(t,e){}swap(t,e){let i=Math.min(t,e),r=Math.max(t,e),o=this.detach(r);if(r-i>1){let d=this.detach(i);this.attach(i,o),this.attach(r,d)}else this.attach(i,o)}move(t,e){this.attach(e,this.detach(t))}};function xA(n,t,e,i,r){return n===e&&Object.is(t,i)?1:Object.is(r(n,t),r(e,i))?-1:0}function lee(n,t,e,i){let r,o,d=0,m=n.length-1,b=void 0;if(Array.isArray(t)){Xt(i);let T=t.length-1;for(Xt(null);d<=m&&d<=T;){let A=n.at(d),N=t[d],q=xA(d,A,d,N,e);if(q!==0){q<0&&n.updateValue(d,N),d++;continue}let J=n.at(m),K=t[T],xe=xA(m,J,T,K,e);if(xe!==0){xe<0&&n.updateValue(m,K),m--,T--;continue}let Te=e(d,A),Ge=e(m,J),Et=e(d,N);if(Object.is(Et,Ge)){let kt=e(T,K);Object.is(kt,Te)?(n.swap(d,m),n.updateValue(m,K),T--,m--):n.move(m,d),n.updateValue(d,N),d++;continue}if(r??=new h1,o??=Cj(n,d,m,e),QA(n,r,d,Et))n.updateValue(d,N),d++,m++;else if(o.has(Et))r.set(Te,n.detach(d)),m--;else{let kt=n.create(d,t[d]);n.attach(d,kt),d++,m++}}for(;d<=T;)Ej(n,r,e,d,t[d]),d++}else if(t!=null){Xt(i);let T=t[Symbol.iterator]();Xt(null);let A=T.next();for(;!A.done&&d<=m;){let N=n.at(d),q=A.value,J=xA(d,N,d,q,e);if(J!==0)J<0&&n.updateValue(d,q),d++,A=T.next();else{r??=new h1,o??=Cj(n,d,m,e);let K=e(d,q);if(QA(n,r,d,K))n.updateValue(d,q),d++,m++,A=T.next();else if(!o.has(K))n.attach(d,n.create(d,q)),d++,m++,A=T.next();else{let xe=e(d,N);r.set(xe,n.detach(d)),m--}}}for(;!A.done;)Ej(n,r,e,n.length,A.value),A=T.next()}for(;d<=m;)n.destroy(n.detach(m--));r?.forEach(T=>{n.destroy(T)})}function QA(n,t,e,i){return t!==void 0&&t.has(i)?(n.attach(e,t.get(i)),t.delete(i),!0):!1}function Ej(n,t,e,i,r){if(QA(n,t,i,e(i,r)))n.updateValue(i,r);else{let o=n.create(i,r);n.attach(i,o)}}function Cj(n,t,e,i){let r=new Set;for(let o=t;o<=e;o++)r.add(i(o,n.at(o)));return r}var h1=class{kvMap=new Map;_vMap=void 0;has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;let e=this.kvMap.get(t);return this._vMap!==void 0&&this._vMap.has(e)?(this.kvMap.set(t,this._vMap.get(e)),this._vMap.delete(e)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,e){if(this.kvMap.has(t)){let i=this.kvMap.get(t);this._vMap===void 0&&(this._vMap=new Map);let r=this._vMap;for(;r.has(i);)i=r.get(i);r.set(i,e)}else this.kvMap.set(t,e)}forEach(t){for(let[e,i]of this.kvMap)if(t(i,e),this._vMap!==void 0){let r=this._vMap;for(;r.has(i);)i=r.get(i),t(i,e)}}};function tt(n,t,e,i,r,o,d,m){ca("NgControlFlow");let b=rn(),T=ar(),A=Na(T.consts,o);return kv(b,T,n,t,e,i,r,A,256,d,m),Vk}function Vk(n,t,e,i,r,o,d,m){ca("NgControlFlow");let b=rn(),T=ar(),A=Na(T.consts,o);return kv(b,T,n,t,e,i,r,A,512,d,m),Vk}function nt(n,t){ca("NgControlFlow");let e=rn(),i=kd(),r=e[i]!==lo?e[i]:-1,o=r!==-1?f1(e,xr+r):void 0,d=0;if(Fa(e,i,n)){let m=Xt(null);try{if(o!==void 0&&Zz(o,d),n!==-1){let b=xr+n,T=f1(e,b),A=nk(e[Qt],b),N=Yz(T,A,e),q=Lv(e,A,t,{dehydratedView:N});Bv(T,q,d,yg(A,N))}}finally{Xt(m)}}else if(o!==void 0){let m=Wz(o,d);m!==void 0&&(m[Lr]=t)}}var JA=class{lContainer;$implicit;$index;constructor(t,e,i){this.lContainer=t,this.$implicit=e,this.$index=i}get $count(){return this.lContainer.length-Er}};function Hf(n){return n}function So(n,t){return t}var ek=class{hasEmptyBlock;trackByFn;liveCollection;constructor(t,e,i){this.hasEmptyBlock=t,this.trackByFn=e,this.liveCollection=i}};function qt(n,t,e,i,r,o,d,m,b,T,A,N,q){ca("NgControlFlow");let J=rn(),K=ar(),xe=b!==void 0,Te=rn(),Ge=m?d.bind(Te[bs][Lr]):d,Et=new ek(xe,Ge);Te[xr+n]=Et,kv(J,K,n+1,t,e,i,r,Na(K.consts,o),256),xe&&kv(J,K,n+2,b,T,A,N,Na(K.consts,q),512)}var tk=class extends XA{lContainer;hostLView;templateTNode;operationsCounter=void 0;needsIndexUpdate=!1;constructor(t,e,i){super(),this.lContainer=t,this.hostLView=e,this.templateTNode=i}get length(){return this.lContainer.length-Er}at(t){return this.getLView(t)[Lr].$implicit}attach(t,e){let i=e[kf];this.needsIndexUpdate||=t!==this.length,Bv(this.lContainer,e,t,yg(this.templateTNode,i)),cee(this.lContainer,t)}detach(t){return this.needsIndexUpdate||=t!==this.length-1,uee(this.lContainer,t),dee(this.lContainer,t)}create(t,e){let i=r1(this.lContainer,this.templateTNode.tView.ssrId);return Lv(this.hostLView,this.templateTNode,new JA(this.lContainer,e,t),{dehydratedView:i})}destroy(t){x1(t[Qt],t)}updateValue(t,e){this.getLView(t)[Lr].$implicit=e}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[Lr].$index=t}getLView(t){return hee(this.lContainer,t)}};function Wt(n){let t=Xt(null),e=Oa();try{let i=rn(),r=i[Qt],o=i[e],d=e+1,m=f1(i,d);if(o.liveCollection===void 0){let T=nk(r,d);o.liveCollection=new tk(m,i,T)}else o.liveCollection.reset();let b=o.liveCollection;if(lee(b,n,o.trackByFn,t),b.updateIndexes(),o.hasEmptyBlock){let T=kd(),A=b.length===0;if(Fa(i,T,A)){let N=e+2,q=f1(i,N);if(A){let J=nk(r,N),K=Yz(q,J,i),xe=Lv(i,J,void 0,{dehydratedView:K});Bv(q,xe,0,yg(J,K))}else r.firstUpdatePass&&iJ(q),Zz(q,0)}}}finally{Xt(t)}}function f1(n,t){return n[t]}function cee(n,t){if(n.length<=Er)return;let e=Er+t,i=n[e],r=i?i[Of]:void 0;if(i&&r&&r.detachedLeaveAnimationFns&&r.detachedLeaveAnimationFns.length>0){let o=i[uu];dQ(o,r),zf.delete(i[du]),r.detachedLeaveAnimationFns=void 0}}function uee(n,t){if(n.length<=Er)return;let e=Er+t,i=n[e],r=i?i[Of]:void 0;r&&r.leave&&r.leave.size>0&&(r.detachedLeaveAnimationFns=[])}function dee(n,t){return Mv(n,t)}function hee(n,t){return Wz(n,t)}function nk(n,t){return vv(n,t)}function Ft(n,t,e){let i=rn(),r=kd();if(Fa(i,r,t)){let o=ar(),d=wv();Rz(d,i,n,t,i[ki],e)}return Ft}function ik(n,t,e,i,r){Dk(t,n,e,r?"class":"style",i)}function V(n,t,e,i){let r=rn(),o=r[Qt],d=n+xr,m=o.firstCreatePass?tU(d,r,2,t,Nz,eA(),e,i):o.data[d];if(Oz(m,r,n,t,vU),yv(m)){let b=r[Qt];Sk(b,r,m),iz(b,m,r)}return i!=null&&C1(r,m),V}function U(){let n=ar(),t=Eo(),e=Fz(t);return n.firstCreatePass&&nU(n,e),nA(e)&&iA(),JM(),e.classesWithoutHost!=null&&QY(e)&&ik(n,e,rn(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&JY(e)&&ik(n,e,rn(),e.stylesWithoutHost,!1),U}function st(n,t,e,i){return V(n,t,e,i),U(),st}function Ot(n,t,e,i){let r=rn(),o=r[Qt],d=n+xr,m=o.firstCreatePass?_J(d,o,2,t,e,i):o.data[d];return Oz(m,r,n,t,vU),i!=null&&C1(r,m),Ot}function At(){let n=Eo(),t=Fz(n);return nA(t)&&iA(),JM(),At}function zo(n,t,e,i){return Ot(n,t,e,i),At(),zo}var vU=(n,t,e,i,r)=>(LE(!0),uz(t[ki],i,$3()));function Tt(){return rn()}function Sg(n,t,e){let i=rn(),r=kd();if(Fa(i,r,t)){let o=ar(),d=wv();Pz(d,i,n,t,i[ki],e)}return Sg}var Ev=void 0;function fee(n){let t=Math.floor(Math.abs(n)),e=n.toString().replace(/^[^.]*\.?/,"").length;return t===1&&e===0?1:5}var pee=["en",[["a","p"],["AM","PM"]],[["AM","PM"]],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ev,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ev,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm\u202Fa","h:mm:ss\u202Fa","h:mm:ss\u202Fa z","h:mm:ss\u202Fa zzzz"],["{1}, {0}",Ev,Ev,Ev],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",fee],Sv={};function jk(n,t,e){typeof t!="string"&&(e=t,t=n[mr.LocaleId]),t=t.toLowerCase().replace(/_/g,"-"),Sv[t]=n,e&&(Sv[t][mr.ExtraData]=e)}function da(n){let t=mee(n),e=Tj(t);if(e)return e;let i=t.split("-")[0];if(e=Tj(i),e)return e;if(i==="en")return pee;throw new Je(701,!1)}function Tj(n){return n in Sv||(Sv[n]=Aa.ng&&Aa.ng.common&&Aa.ng.common.locales&&Aa.ng.common.locales[n]),Sv[n]}var mr=(function(n){return n[n.LocaleId=0]="LocaleId",n[n.DayPeriodsFormat=1]="DayPeriodsFormat",n[n.DayPeriodsStandalone=2]="DayPeriodsStandalone",n[n.DaysFormat=3]="DaysFormat",n[n.DaysStandalone=4]="DaysStandalone",n[n.MonthsFormat=5]="MonthsFormat",n[n.MonthsStandalone=6]="MonthsStandalone",n[n.Eras=7]="Eras",n[n.FirstDayOfWeek=8]="FirstDayOfWeek",n[n.WeekendRange=9]="WeekendRange",n[n.DateFormat=10]="DateFormat",n[n.TimeFormat=11]="TimeFormat",n[n.DateTimeFormat=12]="DateTimeFormat",n[n.NumberSymbols=13]="NumberSymbols",n[n.NumberFormats=14]="NumberFormats",n[n.CurrencyCode=15]="CurrencyCode",n[n.CurrencySymbol=16]="CurrencySymbol",n[n.CurrencyName=17]="CurrencyName",n[n.Currencies=18]="Currencies",n[n.Directionality=19]="Directionality",n[n.PluralCase=20]="PluralCase",n[n.ExtraData=21]="ExtraData",n})(mr||{});function mee(n){return n.toLowerCase().replace(/_/g,"-")}var zv="en-US";var gee=zv;function bU(n){typeof n=="string"&&(gee=n.toLowerCase().replace(/_/g,"-"))}function Fe(n,t,e){let i=rn(),r=ar(),o=Eo();return wU(r,i,i[ki],o,n,t,e),Fe}function ho(n,t,e){let i=rn(),r=ar(),o=Eo();return(o.type&3||e)&&oU(o,r,i,e,i[ki],n,t,KE(o,i,t)),ho}function wU(n,t,e,i,r,o,d){let m=!0,b=null;if((i.type&3||d)&&(b??=KE(i,t,o),oU(i,n,t,d,e,r,o,b)&&(m=!1)),m){let T=i.outputs?.[r],A=i.hostDirectiveOutputs?.[r];if(A&&A.length)for(let N=0;N<A.length;N+=2){let q=A[N],J=A[N+1];b??=KE(i,t,o),vj(i,t,q,J,r,b)}if(T&&T.length)for(let N of T)b??=KE(i,t,o),vj(i,t,N,r,r,b)}}function _e(n=1){return U3(n)}function _ee(n,t){let e=null,i=QX(n);for(let r=0;r<t.length;r++){let o=t[r];if(o==="*"){e=r;continue}if(i===null?yz(n,o,!0):tQ(i,o))return r}return e}function Uv(n){let t=rn()[bs][vs];if(!t.projection){let e=n?n.length:1,i=t.projection=_3(e,null),r=i.slice(),o=t.child;for(;o!==null;){if(o.type!==128){let d=n?_ee(o,n):0;d!==null&&(r[d]?r[d].projectionNext=o:i[d]=o,r[d]=o)}o=o.next}}}function Gf(n,t=0,e,i,r,o){let d=rn(),m=ar(),b=i?n+1:null;b!==null&&kv(d,m,b,i,r,o,null,e);let T=Eg(m,xr+n,16,null,e||null);T.projection===null&&(T.projection=t),sA();let N=!d[kf]||tA();d[bs][vs].projection[T.projection]===null&&b!==null?yee(d,m,b):N&&!y1(T)&&xQ(m,d,T)}function yee(n,t,e){let i=xr+e,r=t.data[i],o=n[i],d=r1(o,r.tView.ssrId),m=Lv(n,r,void 0,{dehydratedView:d});Bv(o,m,0,yg(r,d))}function I1(n,t,e,i){return $J(n,t,e,i),I1}function ws(n,t,e){return UJ(n,t,e),ws}function Do(n){let t=rn(),e=ar(),i=cA();PE(i+1);let r=Rk(e,i);if(n.dirty&&S3(t)===((r.metadata.flags&2)===2)){if(r.matches===null)n.reset([]);else{let o=qJ(t,i);n.reset(o,hX),n.notifyOnChanges()}return!0}return!1}function Io(){return zJ(rn(),cA())}function HE(n,t){return n<<17|t<<2}function Uf(n){return n>>17&32767}function vee(n){return(n&2)==2}function bee(n,t){return n&131071|t<<17}function rk(n){return n|2}function vg(n){return(n&131068)>>2}function EA(n,t){return n&-131069|t<<2}function wee(n){return(n&1)===1}function ok(n){return n|1}function xee(n,t,e,i,r,o){let d=o?t.classBindings:t.styleBindings,m=Uf(d),b=vg(d);n[i]=e;let T=!1,A;if(Array.isArray(e)){let N=e;A=N[1],(A===null||og(N,A)>0)&&(T=!0)}else A=e;if(r)if(b!==0){let q=Uf(n[m+1]);n[i+1]=HE(q,m),q!==0&&(n[q+1]=EA(n[q+1],i)),n[m+1]=bee(n[m+1],i)}else n[i+1]=HE(m,0),m!==0&&(n[m+1]=EA(n[m+1],i)),m=i;else n[i+1]=HE(b,0),m===0?m=i:n[b+1]=EA(n[b+1],i),b=i;T&&(n[i+1]=rk(n[i+1])),Sj(n,A,i,!0),Sj(n,A,i,!1),Eee(t,A,n,i,o),d=HE(m,b),o?t.classBindings=d:t.styleBindings=d}function Eee(n,t,e,i,r){let o=r?n.residualClasses:n.residualStyles;o!=null&&typeof t=="string"&&og(o,t)>=0&&(e[i+1]=ok(e[i+1]))}function Sj(n,t,e,i){let r=n[e+1],o=t===null,d=i?Uf(r):vg(r),m=!1;for(;d!==0&&(m===!1||o);){let b=n[d],T=n[d+1];Cee(b,t)&&(m=!0,n[d+1]=i?ok(T):rk(T)),d=i?Uf(T):vg(T)}m&&(n[e+1]=i?rk(r):ok(r))}function Cee(n,t){return n===null||t==null||(Array.isArray(n)?n[1]:n)===t?!0:Array.isArray(n)&&typeof t=="string"?og(n,t)>=0:!1}var gl={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Tee(n){return n.substring(gl.key,gl.keyEnd)}function See(n){return Dee(n),xU(n,EU(n,0,gl.textEnd))}function xU(n,t){let e=gl.textEnd;return e===t?-1:(t=gl.keyEnd=Iee(n,gl.key=t,e),EU(n,t,e))}function Dee(n){gl.key=0,gl.keyEnd=0,gl.value=0,gl.valueEnd=0,gl.textEnd=n.length}function EU(n,t,e){for(;t<e&&n.charCodeAt(t)<=32;)t++;return t}function Iee(n,t,e){for(;t<e&&n.charCodeAt(t)>32;)t++;return t}function yl(n,t,e){return CU(n,t,e,!1),yl}function ji(n,t){return CU(n,t,null,!0),ji}function Ri(n){Aee(Fee,Mee,n,!0)}function Mee(n,t){for(let e=See(t);e>=0;e=xU(t,e))TE(n,Tee(t),!0)}function CU(n,t,e,i){let r=rn(),o=ar(),d=dg(2);if(o.firstUpdatePass&&SU(o,n,d,i),t!==lo&&Fa(r,d,t)){let m=o.data[Oa()];DU(o,m,r,r[ki],n,r[d+1]=Bee(t,e),i,d)}}function Aee(n,t,e,i){let r=ar(),o=dg(2);r.firstUpdatePass&&SU(r,null,o,i);let d=rn();if(e!==lo&&Fa(d,o,e)){let m=r.data[Oa()];if(IU(m,i)&&!TU(r,o)){let b=i?m.classesWithoutHost:m.stylesWithoutHost;b!==null&&(e=bE(b,e||"")),ik(r,m,d,e,i)}else Lee(r,m,d,d[ki],d[o+1],d[o+1]=Oee(n,t,e),i,o)}}function TU(n,t){return t>=n.expandoStartIndex}function SU(n,t,e,i){let r=n.data;if(r[e+1]===null){let o=r[Oa()],d=TU(n,e);IU(o,i)&&t===null&&!d&&(t=!1),t=kee(r,o,t,i),xee(r,o,t,e,d,i)}}function kee(n,t,e,i){let r=B3(n),o=i?t.residualClasses:t.residualStyles;if(r===null)(i?t.classBindings:t.styleBindings)===0&&(e=CA(null,n,t,e,i),e=Rv(e,t.attrs,i),o=null);else{let d=t.directiveStylingLast;if(d===-1||n[d]!==r)if(e=CA(r,n,t,e,i),o===null){let b=Ree(n,t,i);b!==void 0&&Array.isArray(b)&&(b=CA(null,n,t,b[1],i),b=Rv(b,t.attrs,i),Pee(n,t,i,b))}else o=Nee(n,t,i)}return o!==void 0&&(i?t.residualClasses=o:t.residualStyles=o),e}function Ree(n,t,e){let i=e?t.classBindings:t.styleBindings;if(vg(i)!==0)return n[Uf(i)]}function Pee(n,t,e,i){let r=e?t.classBindings:t.styleBindings;n[Uf(r)]=i}function Nee(n,t,e){let i,r=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<r;o++){let d=n[o].hostAttrs;i=Rv(i,d,e)}return Rv(i,t.attrs,e)}function CA(n,t,e,i,r){let o=null,d=e.directiveEnd,m=e.directiveStylingLast;for(m===-1?m=e.directiveStart:m++;m<d&&(o=t[m],i=Rv(i,o.hostAttrs,r),o!==n);)m++;return n!==null&&(e.directiveStylingLast=m),i}function Rv(n,t,e){let i=e?1:2,r=-1;if(t!==null)for(let o=0;o<t.length;o++){let d=t[o];typeof d=="number"?r=d:r===i&&(Array.isArray(n)||(n=n===void 0?[]:["",n]),TE(n,d,e?!0:t[++o]))}return n===void 0?null:n}function Oee(n,t,e){if(e==null||e==="")return ys;let i=[],r=La(e);if(Array.isArray(r))for(let o=0;o<r.length;o++)n(i,r[o],!0);else if(r instanceof Set)for(let o of r)n(i,o,!0);else if(typeof r=="object")for(let o in r)r.hasOwnProperty(o)&&n(i,o,r[o]);else typeof r=="string"&&t(i,r);return i}function Fee(n,t,e){let i=String(t);i!==""&&!i.includes(" ")&&TE(n,i,e)}function Lee(n,t,e,i,r,o,d,m){r===lo&&(r=ys);let b=0,T=0,A=0<r.length?r[0]:null,N=0<o.length?o[0]:null;for(;A!==null||N!==null;){let q=b<r.length?r[b+1]:void 0,J=T<o.length?o[T+1]:void 0,K=null,xe;A===N?(b+=2,T+=2,q!==J&&(K=N,xe=J)):N===null||A!==null&&A<N?(b+=2,K=A):(T+=2,K=N,xe=J),K!==null&&DU(n,t,e,i,K,xe,d,m),A=b<r.length?r[b]:null,N=T<o.length?o[T]:null}}function DU(n,t,e,i,r,o,d,m){if(!(t.type&3))return;let b=n.data,T=b[m+1],A=wee(T)?Dj(b,t,e,r,vg(T),d):void 0;if(!p1(A)){p1(o)||vee(T)&&(o=Dj(b,null,e,r,m,d));let N=qM(Oa(),e);CQ(i,d,N,r,o)}}function Dj(n,t,e,i,r,o){let d=t===null,m;for(;r>0;){let b=n[r],T=Array.isArray(b),A=T?b[1]:b,N=A===null,q=e[r+1];q===lo&&(q=N?ys:void 0);let J=N?SE(q,i):A===i?q:void 0;if(T&&!p1(J)&&(J=SE(b,i)),p1(J)&&(m=J,d))return m;let K=n[r+1];r=d?Uf(K):vg(K)}if(t!==null){let b=o?t.residualClasses:t.residualStyles;b!=null&&(m=SE(b,i))}return m}function p1(n){return n!==void 0}function Bee(n,t){return n==null||n===""||(typeof t=="string"?n=n+t:typeof n=="object"&&(n=lu(La(n)))),n}function IU(n,t){return(n.flags&(t?8:16))!==0}function Z(n,t=""){let e=rn(),i=ar(),r=n+xr,o=i.firstCreatePass?Eg(i,r,1,t,null):i.data[r],d=Vee(i,e,o,t);e[r]=d,FE()&&Ck(i,e,d,o),ug(o,!1)}var Vee=(n,t,e,i)=>(LE(!0),jX(t[ki],i));function jee(n,t,e,i=""){return Fa(n,kd(),e)?t+oa(e)+i:lo}function zee(n,t,e,i,r,o=""){let d=kE(),m=s1(n,d,e,r);return dg(2),m?t+oa(e)+i+oa(r)+o:lo}function Uee(n,t,e,i,r,o,d,m=""){let b=kE(),T=vJ(n,b,e,r,d);return dg(3),T?t+oa(e)+i+oa(r)+o+oa(d)+m:lo}function $ee(n,t,e,i,r,o,d,m,b,T=""){let A=kE(),N=rU(n,A,e,r,d,b);return dg(4),N?t+oa(e)+i+oa(r)+o+oa(d)+m+oa(b)+T:lo}function ht(n){return tn("",n),ht}function tn(n,t,e){let i=rn(),r=jee(i,n,t,e);return r!==lo&&A1(i,Oa(),r),tn}function Tr(n,t,e,i,r){let o=rn(),d=zee(o,n,t,e,i,r);return d!==lo&&A1(o,Oa(),d),Tr}function Dg(n,t,e,i,r,o,d){let m=rn(),b=Uee(m,n,t,e,i,r,o,d);return b!==lo&&A1(m,Oa(),b),Dg}function M1(n,t,e,i,r,o,d,m,b){let T=rn(),A=$ee(T,n,t,e,i,r,o,d,m,b);return A!==lo&&A1(T,Oa(),A),M1}function A1(n,t,e){let i=qM(t,n);zX(n[ki],i,e)}function bi(n,t,e){Nk(t)&&(t=t());let i=rn(),r=kd();if(Fa(i,r,t)){let o=ar(),d=wv();Rz(d,i,n,t,i[ki],e)}return bi}function Pi(n,t){let e=Nk(n);return e&&n.set(t),e}function wi(n,t){let e=rn(),i=ar(),r=Eo();return wU(i,e,e[ki],r,n,t),wi}function Ij(n,t,e){let i=ar();i.firstCreatePass&&MU(t,i.data,i.blueprint,ac(n),e)}function MU(n,t,e,i,r){if(n=Vo(n),Array.isArray(n))for(let o=0;o<n.length;o++)MU(n[o],t,e,i,r);else{let o=ar(),d=rn(),m=Eo(),b=If(n)?n:Vo(n.provide),T=jM(n),A=m.providerIndexes&1048575,N=m.directiveStart,q=m.providerIndexes>>20;if(If(n)||!n.multi){let J=new jf(T,r,Ze,null),K=SA(b,t,r?A:A+q,N);K===-1?(IA(e1(m,d),o,b),TA(o,n,t.length),t.push(b),m.directiveStart++,m.directiveEnd++,r&&(m.providerIndexes+=1048576),e.push(J),d.push(J)):(e[K]=J,d[K]=J)}else{let J=SA(b,t,A+q,N),K=SA(b,t,A,A+q),xe=J>=0&&e[J],Te=K>=0&&e[K];if(r&&!Te||!r&&!xe){IA(e1(m,d),o,b);let Ge=qee(r?Gee:Hee,e.length,r,i,T,n);!r&&Te&&(e[K].providerFactory=Ge),TA(o,n,t.length,0),t.push(b),m.directiveStart++,m.directiveEnd++,r&&(m.providerIndexes+=1048576),e.push(Ge),d.push(Ge)}else{let Ge=AU(e[r?K:J],T,!r&&i);TA(o,n,J>-1?J:K,Ge)}!r&&i&&Te&&e[K].componentProviders++}}}function TA(n,t,e,i){let r=If(t),o=w3(t);if(r||o){let b=(o?Vo(t.useClass):t).prototype.ngOnDestroy;if(b){let T=n.destroyHooks||(n.destroyHooks=[]);if(!r&&t.multi){let A=T.indexOf(e);A===-1?T.push(e,[i,b]):T[A+1].push(i,b)}else T.push(e,b)}}}function AU(n,t,e){return e&&n.componentProviders++,n.multi.push(t)-1}function SA(n,t,e,i){for(let r=e;r<i;r++)if(t[r]===n)return r;return-1}function Hee(n,t,e,i,r){return sk(this.multi,[])}function Gee(n,t,e,i,r){let o=this.multi,d;if(this.providerFactory){let m=this.providerFactory.componentProviders,b=Dv(i,i[Qt],this.providerFactory.index,r);d=b.slice(0,m),sk(o,d);for(let T=m;T<b.length;T++)d.push(b[T])}else d=[],sk(o,d);return d}function sk(n,t){for(let e=0;e<n.length;e++){let i=n[e];t.push(i())}return t}function qee(n,t,e,i,r,o){let d=new jf(n,e,Ze,null);return d.multi=[],d.index=t,d.componentProviders=0,AU(d,r,i&&!e),d}function fo(n,t){return e=>{e.providersResolver=(i,r)=>Ij(i,r?r(n):n,!1),t&&(e.viewProvidersResolver=(i,r)=>Ij(i,r?r(t):t,!0))}}function zk(n,t){let e=lA()+n,i=rn();return i[e]===lo?iU(i,e,t()):yJ(i,e)}function Wee(n,t){let e=n[t];return e===lo?void 0:e}function Zee(n,t,e,i,r,o,d,m,b){let T=t+e;return rU(n,T,r,o,d,m)?iU(n,T+4,b?i.call(b,r,o,d,m):i(r,o,d,m)):Wee(n,T+4)}function gu(n,t){let e=ar(),i,r=n+xr;e.firstCreatePass?(i=Kee(t,e.pipeRegistry),e.data[r]=i,i.onDestroy&&(e.destroyHooks??=[]).push(r,i.onDestroy)):i=e.data[r];let o=i.factory||(i.factory=Cd(i.type,!0)),d,m=_s(Ze);try{let b=JE(!1),T=o();return JE(b),WM(e,rn(),r,T),T}finally{_s(m)}}function Kee(n,t){if(t)for(let e=t.length-1;e>=0;e--){let i=t[e];if(n===i.name)return i}}function _u(n,t,e,i,r,o){let d=n+xr,m=rn(),b=T3(m,d);return Yee(m,d)?Zee(m,lA(),t,b.transform,e,i,r,o,b):b.transform(e,i,r,o)}function Yee(n,t){return n[Qt].data[t].pure}var m1=class{ngModuleFactory;componentFactories;constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}},Uk=(()=>{class n{compileModuleSync(e){return new d1(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let i=this.compileModuleSync(e),r=kM(e),o=gz(r.declarations).reduce((d,m)=>{let b=ic(m);return b&&d.push(new Nd(b)),d},[]);return new m1(i,o)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var kU=(()=>{class n{applicationErrorHandler=se(aa);appRef=se(To);taskService=se(lc);ngZone=se(jt);zonelessEnabled=se(hg);tracing=se(mu,{optional:!0});zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Gn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(hv):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(se(BE,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{let e=this.taskService.add();if(!this.runningTick&&(this.cleanup(),!this.zonelessEnabled||this.appRef.includeAllTestViews)){this.taskService.remove(e);return}this.switchToMicrotaskScheduler(),this.taskService.remove(e)})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()}))}switchToMicrotaskScheduler(){this.ngZone.runOutsideAngular(()=>{let e=this.taskService.add();this.useMicrotaskScheduler=!0,queueMicrotask(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})})}notify(e){if(!this.zonelessEnabled&&e===5)return;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 6:{this.appRef.dirtyFlags|=2;break}case 12:{this.appRef.dirtyFlags|=16;break}case 13:{this.appRef.dirtyFlags|=2;break}case 11:break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick())return;let i=this.useMicrotaskScheduler?q3:pA;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>i(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>i(()=>this.tick()))}shouldScheduleTick(){return!(this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(hv+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){this.applicationErrorHandler(i)}finally{this.taskService.remove(e),this.cleanup()}}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function RU(){return[{provide:nc,useExisting:kU},{provide:jt,useClass:fv},{provide:hg,useValue:!0}]}function Xee(){return typeof $localize<"u"&&$localize.locale||zv}var qf=new rt("",{factory:()=>se(qf,{optional:!0,skipSelf:!0})||Xee()});function xi(n,t){return Ax(n,t?.equal)}var OU=Symbol("InputSignalNode#UNSET"),dte=Mt(Be({},kx),{transformFn:void 0,applyValueToInputSignal(n,t){Jy(n,t)}});function FU(n,t){let e=Object.create(dte);e.value=n,e.transformFn=t?.transform;function i(){if(Yy(e),e.value===OU){let r=null;throw new Je(-950,r)}return e.value}return i[gs]=e,i}var R1=class{attributeName;constructor(t){this.attributeName=t}__NG_ELEMENT_ID__=()=>Nv(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}};function PU(n,t){return FU(n,t)}function hte(n){return FU(OU,n)}var LU=(PU.required=hte,PU);var fte=(()=>{class n{zone=se(jt);changeDetectionScheduler=se(nc);applicationRef=se(To);applicationErrorHandler=se(aa);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{try{this.applicationRef.dirtyFlags|=1,this.applicationRef._tick()}catch(e){this.applicationErrorHandler(e)}})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),pte=new rt("",{factory:()=>!1});function mte({ngZoneFactory:n,scheduleInRootZone:t}){return n??=()=>new jt(Mt(Be({},VU()),{scheduleInRootZone:t})),[{provide:hg,useValue:!1},{provide:jt,useFactory:n},{provide:cu,multi:!0,useFactory:()=>{let e=se(fte,{optional:!0});return()=>e.initialize()}},{provide:cu,multi:!0,useFactory:()=>{let e=se(gte);return()=>{e.initialize()}}},{provide:BE,useValue:t??fA}]}function BU(n){let t=n?.scheduleInRootZone,e=mte({ngZoneFactory:()=>{let i=VU(n);return i.scheduleInRootZone=t,i.shouldCoalesceEventChangeDetection&&ca("NgZone_CoalesceEvent"),new jt(i)},scheduleInRootZone:t});return dl([{provide:pte,useValue:!0},e])}function VU(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:n?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:n?.runCoalescing??!1}}var gte=(()=>{class n{subscription=new Gn;initialized=!1;zone=se(jt);pendingTasks=se(lc);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{jt.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{jt.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var $k=new rt(""),_te=new rt("");function $v(n){return!n.moduleRef}function yte(n){let t=$v(n)?n.r3Injector:n.moduleRef.injector,e=t.get(jt);return e.run(()=>{$v(n)?n.r3Injector.resolveInjectorInitializers():n.moduleRef.resolveInjectorInitializers();let i=t.get(aa),r;if(e.runOutsideAngular(()=>{r=e.onError.subscribe({next:i})}),$v(n)){let o=()=>t.destroy(),d=n.platformInjector.get($k);d.add(o),t.onDestroy(()=>{r.unsubscribe(),d.delete(o)})}else{let o=()=>n.moduleRef.destroy(),d=n.platformInjector.get($k);d.add(o),n.moduleRef.onDestroy(()=>{Tv(n.allPlatformModules,n.moduleRef),r.unsubscribe(),d.delete(o)})}return bte(i,e,()=>{let o=t.get(lc),d=o.add(),m=t.get(Bk);return m.runInitializers(),m.donePromise.then(()=>{let b=t.get(qf,zv);if(bU(b||zv),!t.get(_te,!0))return $v(n)?t.get(To):(n.allPlatformModules.push(n.moduleRef),n.moduleRef);if($v(n)){let A=t.get(To);return n.rootComponent!==void 0&&A.bootstrap(n.rootComponent),A}else return vte?.(n.moduleRef,n.allPlatformModules),n.moduleRef}).finally(()=>{o.remove(d)})})})}var vte;function bte(n,t,e){try{let i=e();return Ld(i)?i.catch(r=>{throw t.runOutsideAngular(()=>n(r)),r}):i}catch(i){throw t.runOutsideAngular(()=>n(i)),i}}var k1=null;function wte(n=[],t){return en.create({name:t,providers:[{provide:gv,useValue:"platform"},{provide:$k,useValue:new Set([()=>k1=null])},...n]})}function xte(n=[]){if(k1)return k1;let t=wte(n);return k1=t,_U(),Ete(t),t}function Ete(n){let t=n.get(g1,null);so(n,()=>{t?.forEach(e=>e())})}var Cte=1e4;var Eke=Cte-1e3;var Uo=(()=>{class n{static __NG_ELEMENT_ID__=Tte}return n})();function Tte(n){return Ste(Eo(),rn(),(n&16)===16)}function Ste(n,t,e){if(Ad(n)&&!e){let i=Pa(n.index,t);return new Pd(i,i)}else if(n.type&175){let i=t[bs];return new Pd(i,t)}return null}function jU(n){let{rootComponent:t,appProviders:e,platformProviders:i,platformRef:r}=n;li(qn.BootstrapApplicationStart);try{let o=r?.injector??xte(i),d=[RU(),Z3,...e||[]],m=new Av({providers:d,parent:o,debugName:"",runEnvironmentInitializers:!1});return yte({r3Injector:m.injector,platformInjector:o,rootComponent:t})}catch(o){return Promise.reject(o)}finally{li(qn.BootstrapApplicationEnd)}}function gr(n){return typeof n=="boolean"?n:n!=null&&n!=="false"}function Hv(n,t=NaN){return!isNaN(parseFloat(n))&&!isNaN(Number(n))?Number(n):t}function P1(n,t){let e=ic(n),i=t.elementInjector||sg();return new Nd(e).create(i,t.projectableNodes,t.hostElement,t.environmentInjector,t.directives,t.bindings)}function zU(n){let t=ic(n);if(!t)return null;let e=new Nd(t);return{get selector(){return e.selector},get type(){return e.componentType},get inputs(){return e.inputs},get outputs(){return e.outputs},get ngContentSelectors(){return e.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}var UU=null;function Ba(){return UU}function Gk(n){UU??=n}var Gv=class{},yu=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se($U),providedIn:"platform"})}return n})(),qk=new rt(""),$U=(()=>{class n extends yu{_location;_history;_doc=se(Ht);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ba().getBaseHref(this._doc)}onPopState(e){let i=Ba().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",e,!1),()=>i.removeEventListener("popstate",e)}onHashChange(e){let i=Ba().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",e,!1),()=>i.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,i,r){this._history.pushState(e,i,r)}replaceState(e,i,r){this._history.replaceState(e,i,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function N1(n,t){return n?t?n.endsWith("/")?t.startsWith("/")?n+t.slice(1):n+t:t.startsWith("/")?n+t:`${n}/${t}`:n:t}function HU(n){let t=n.search(/#|\?|$/);return n[t-1]==="/"?n.slice(0,t-1)+n.slice(t):n}function vl(n){return n&&n[0]!=="?"?`?${n}`:n}var bl=(()=>{class n{historyGo(e){throw new Error("")}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se(F1),providedIn:"root"})}return n})(),O1=new rt(""),F1=(()=>{class n extends bl{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??se(Ht).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return N1(this._baseHref,e)}path(e=!1){let i=this._platformLocation.pathname+vl(this._platformLocation.search),r=this._platformLocation.hash;return r&&e?`${i}${r}`:i}pushState(e,i,r,o){let d=this.prepareExternalUrl(r+vl(o));this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,o){let d=this.prepareExternalUrl(r+vl(o));this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(vt(yu),vt(O1,8))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),hc=(()=>{class n{_subject=new yt;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let i=this._locationStrategy.getBaseHref();this._basePath=Mte(HU(GU(i))),this._locationStrategy.onPopState(r=>{this._subject.next({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,i=""){return this.path()==this.normalize(e+vl(i))}normalize(e){return n.stripTrailingSlash(Ite(this._basePath,GU(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,i="",r=null){this._locationStrategy.pushState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+vl(i)),r)}replaceState(e,i="",r=null){this._locationStrategy.replaceState(r,"",e,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+vl(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{let i=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(i,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",i){this._urlChangeListeners.forEach(r=>r(e,i))}subscribe(e,i,r){return this._subject.subscribe({next:e,error:i??void 0,complete:r??void 0})}static normalizeQueryParams=vl;static joinWithSlash=N1;static stripTrailingSlash=HU;static \u0275fac=function(i){return new(i||n)(vt(bl))};static \u0275prov=ze({token:n,factory:()=>Dte(),providedIn:"root"})}return n})();function Dte(){return new hc(vt(bl))}function Ite(n,t){if(!n||!t.startsWith(n))return t;let e=t.substring(n.length);return e===""||["/",";","?","#"].includes(e[0])?e:t}function GU(n){return n.replace(/\/index.html$/,"")}function Mte(n){if(new RegExp("^(https?:)?//").test(n)){let[,e]=n.split(/\/\/[^\/]+/);return e}return n}var Xk=(()=>{class n extends bl{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(e,i){super(),this._platformLocation=e,i!=null&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let i=this._platformLocation.hash??"#";return i.length>0?i.substring(1):i}prepareExternalUrl(e){let i=N1(this._baseHref,e);return i.length>0?"#"+i:i}pushState(e,i,r,o){let d=this.prepareExternalUrl(r+vl(o))||this._platformLocation.pathname;this._platformLocation.pushState(e,i,d)}replaceState(e,i,r,o){let d=this.prepareExternalUrl(r+vl(o))||this._platformLocation.pathname;this._platformLocation.replaceState(e,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(i){return new(i||n)(vt(yu),vt(O1,8))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})();var Jo=(function(n){return n[n.Format=0]="Format",n[n.Standalone=1]="Standalone",n})(Jo||{}),Ei=(function(n){return n[n.Narrow=0]="Narrow",n[n.Abbreviated=1]="Abbreviated",n[n.Wide=2]="Wide",n[n.Short=3]="Short",n})(Ei||{}),js=(function(n){return n[n.Short=0]="Short",n[n.Medium=1]="Medium",n[n.Long=2]="Long",n[n.Full=3]="Full",n})(js||{}),bu={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function ZU(n){return da(n)[mr.LocaleId]}function KU(n,t,e){let i=da(n),r=[i[mr.DayPeriodsFormat],i[mr.DayPeriodsStandalone]],o=Va(r,t);return Va(o,e)}function YU(n,t,e){let i=da(n),r=[i[mr.DaysFormat],i[mr.DaysStandalone]],o=Va(r,t);return Va(o,e)}function XU(n,t,e){let i=da(n),r=[i[mr.MonthsFormat],i[mr.MonthsStandalone]],o=Va(r,t);return Va(o,e)}function QU(n,t){let i=da(n)[mr.Eras];return Va(i,t)}function qv(n,t){let e=da(n);return Va(e[mr.DateFormat],t)}function Wv(n,t){let e=da(n);return Va(e[mr.TimeFormat],t)}function Zv(n,t){let i=da(n)[mr.DateTimeFormat];return Va(i,t)}function Kv(n,t){let e=da(n),i=e[mr.NumberSymbols][t];if(typeof i>"u"){if(t===bu.CurrencyDecimal)return e[mr.NumberSymbols][bu.Decimal];if(t===bu.CurrencyGroup)return e[mr.NumberSymbols][bu.Group]}return i}function JU(n){if(!n[mr.ExtraData])throw new Je(2303,!1)}function e4(n){let t=da(n);return JU(t),(t[mr.ExtraData][2]||[]).map(i=>typeof i=="string"?Wk(i):[Wk(i[0]),Wk(i[1])])}function t4(n,t,e){let i=da(n);JU(i);let r=[i[mr.ExtraData][0],i[mr.ExtraData][1]],o=Va(r,t)||[];return Va(o,e)||[]}function Va(n,t){for(let e=t;e>-1;e--)if(typeof n[e]<"u")return n[e];throw new Je(2304,!1)}function Wk(n){let[t,e]=n.split(":");return{hours:+t,minutes:+e}}var kte=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,L1={},Rte=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function n4(n,t,e,i){let r=zte(n);t=vu(e,t)||t;let d=[],m;for(;t;)if(m=Rte.exec(t),m){d=d.concat(m.slice(1));let A=d.pop();if(!A)break;t=A}else{d.push(t);break}let b=r.getTimezoneOffset();i&&(b=r4(i,b),r=jte(r,i));let T="";return d.forEach(A=>{let N=Bte(A);T+=N?N(r,e,b):A==="''"?"'":A.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),T}function U1(n,t,e){let i=new Date(0);return i.setFullYear(n,t,e),i.setHours(0,0,0),i}function vu(n,t){let e=ZU(n);if(L1[e]??={},L1[e][t])return L1[e][t];let i="";switch(t){case"shortDate":i=qv(n,js.Short);break;case"mediumDate":i=qv(n,js.Medium);break;case"longDate":i=qv(n,js.Long);break;case"fullDate":i=qv(n,js.Full);break;case"shortTime":i=Wv(n,js.Short);break;case"mediumTime":i=Wv(n,js.Medium);break;case"longTime":i=Wv(n,js.Long);break;case"fullTime":i=Wv(n,js.Full);break;case"short":let r=vu(n,"shortTime"),o=vu(n,"shortDate");i=B1(Zv(n,js.Short),[r,o]);break;case"medium":let d=vu(n,"mediumTime"),m=vu(n,"mediumDate");i=B1(Zv(n,js.Medium),[d,m]);break;case"long":let b=vu(n,"longTime"),T=vu(n,"longDate");i=B1(Zv(n,js.Long),[b,T]);break;case"full":let A=vu(n,"fullTime"),N=vu(n,"fullDate");i=B1(Zv(n,js.Full),[A,N]);break}return i&&(L1[e][t]=i),i}function B1(n,t){return t&&(n=n.replace(/\{([^}]+)}/g,function(e,i){return t!=null&&i in t?t[i]:e})),n}function wl(n,t,e="-",i,r){let o="";(n<0||r&&n<=0)&&(r?n=-n+1:(n=-n,o=e));let d=String(n);for(;d.length<t;)d="0"+d;return i&&(d=d.slice(d.length-t)),o+d}function Pte(n,t){return wl(n,3).substring(0,t)}function Yr(n,t,e=0,i=!1,r=!1){return function(o,d){let m=Nte(n,o);if((e>0||m>-e)&&(m+=e),n===3)m===0&&e===-12&&(m=12);else if(n===6)return Pte(m,t);let b=Kv(d,bu.MinusSign);return wl(m,t,b,i,r)}}function Nte(n,t){switch(n){case 0:return t.getFullYear();case 1:return t.getMonth();case 2:return t.getDate();case 3:return t.getHours();case 4:return t.getMinutes();case 5:return t.getSeconds();case 6:return t.getMilliseconds();case 7:return t.getDay();default:throw new Je(2301,!1)}}function zi(n,t,e=Jo.Format,i=!1){return function(r,o){return Ote(r,o,n,t,e,i)}}function Ote(n,t,e,i,r,o){switch(e){case 2:return XU(t,r,i)[n.getMonth()];case 1:return YU(t,r,i)[n.getDay()];case 0:let d=n.getHours(),m=n.getMinutes();if(o){let T=e4(t),A=t4(t,r,i),N=T.findIndex(q=>{if(Array.isArray(q)){let[J,K]=q,xe=d>=J.hours&&m>=J.minutes,Te=d<K.hours||d===K.hours&&m<K.minutes;if(J.hours<K.hours){if(xe&&Te)return!0}else if(xe||Te)return!0}else if(q.hours===d&&q.minutes===m)return!0;return!1});if(N!==-1)return A[N]}return KU(t,r,i)[d<12?0:1];case 3:return QU(t,i)[n.getFullYear()<=0?0:1];default:let b=e;throw new Je(2302,!1)}}function V1(n){return function(t,e,i){let r=-1*i,o=Kv(e,bu.MinusSign),d=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case 0:return(r>=0?"+":"")+wl(d,2,o)+wl(Math.abs(r%60),2,o);case 1:return"GMT"+(r>=0?"+":"")+wl(d,1,o);case 2:return"GMT"+(r>=0?"+":"")+wl(d,2,o)+":"+wl(Math.abs(r%60),2,o);case 3:return i===0?"Z":(r>=0?"+":"")+wl(d,2,o)+":"+wl(Math.abs(r%60),2,o);default:throw new Je(2310,!1)}}}var Fte=0,z1=4;function Lte(n){let t=U1(n,Fte,1).getDay();return U1(n,0,1+(t<=z1?z1:z1+7)-t)}function i4(n){let t=n.getDay(),e=t===0?-3:z1-t;return U1(n.getFullYear(),n.getMonth(),n.getDate()+e)}function Zk(n,t=!1){return function(e,i){let r;if(t){let o=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,d=e.getDate();r=1+Math.floor((d+o)/7)}else{let o=i4(e),d=Lte(o.getFullYear()),m=o.getTime()-d.getTime();r=1+Math.round(m/6048e5)}return wl(r,n,Kv(i,bu.MinusSign))}}function j1(n,t=!1){return function(e,i){let o=i4(e).getFullYear();return wl(o,n,Kv(i,bu.MinusSign),t)}}var Kk={};function Bte(n){if(Kk[n])return Kk[n];let t;switch(n){case"G":case"GG":case"GGG":t=zi(3,Ei.Abbreviated);break;case"GGGG":t=zi(3,Ei.Wide);break;case"GGGGG":t=zi(3,Ei.Narrow);break;case"y":t=Yr(0,1,0,!1,!0);break;case"yy":t=Yr(0,2,0,!0,!0);break;case"yyy":t=Yr(0,3,0,!1,!0);break;case"yyyy":t=Yr(0,4,0,!1,!0);break;case"Y":t=j1(1);break;case"YY":t=j1(2,!0);break;case"YYY":t=j1(3);break;case"YYYY":t=j1(4);break;case"M":case"L":t=Yr(1,1,1);break;case"MM":case"LL":t=Yr(1,2,1);break;case"MMM":t=zi(2,Ei.Abbreviated);break;case"MMMM":t=zi(2,Ei.Wide);break;case"MMMMM":t=zi(2,Ei.Narrow);break;case"LLL":t=zi(2,Ei.Abbreviated,Jo.Standalone);break;case"LLLL":t=zi(2,Ei.Wide,Jo.Standalone);break;case"LLLLL":t=zi(2,Ei.Narrow,Jo.Standalone);break;case"w":t=Zk(1);break;case"ww":t=Zk(2);break;case"W":t=Zk(1,!0);break;case"d":t=Yr(2,1);break;case"dd":t=Yr(2,2);break;case"c":case"cc":t=Yr(7,1);break;case"ccc":t=zi(1,Ei.Abbreviated,Jo.Standalone);break;case"cccc":t=zi(1,Ei.Wide,Jo.Standalone);break;case"ccccc":t=zi(1,Ei.Narrow,Jo.Standalone);break;case"cccccc":t=zi(1,Ei.Short,Jo.Standalone);break;case"E":case"EE":case"EEE":t=zi(1,Ei.Abbreviated);break;case"EEEE":t=zi(1,Ei.Wide);break;case"EEEEE":t=zi(1,Ei.Narrow);break;case"EEEEEE":t=zi(1,Ei.Short);break;case"a":case"aa":case"aaa":t=zi(0,Ei.Abbreviated);break;case"aaaa":t=zi(0,Ei.Wide);break;case"aaaaa":t=zi(0,Ei.Narrow);break;case"b":case"bb":case"bbb":t=zi(0,Ei.Abbreviated,Jo.Standalone,!0);break;case"bbbb":t=zi(0,Ei.Wide,Jo.Standalone,!0);break;case"bbbbb":t=zi(0,Ei.Narrow,Jo.Standalone,!0);break;case"B":case"BB":case"BBB":t=zi(0,Ei.Abbreviated,Jo.Format,!0);break;case"BBBB":t=zi(0,Ei.Wide,Jo.Format,!0);break;case"BBBBB":t=zi(0,Ei.Narrow,Jo.Format,!0);break;case"h":t=Yr(3,1,-12);break;case"hh":t=Yr(3,2,-12);break;case"H":t=Yr(3,1);break;case"HH":t=Yr(3,2);break;case"m":t=Yr(4,1);break;case"mm":t=Yr(4,2);break;case"s":t=Yr(5,1);break;case"ss":t=Yr(5,2);break;case"S":t=Yr(6,1);break;case"SS":t=Yr(6,2);break;case"SSS":t=Yr(6,3);break;case"Z":case"ZZ":case"ZZZ":t=V1(0);break;case"ZZZZZ":t=V1(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":t=V1(1);break;case"OOOO":case"ZZZZ":case"zzzz":t=V1(2);break;default:return null}return Kk[n]=t,t}function r4(n,t){n=n.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(e)?t:e}function Vte(n,t){return n=new Date(n.getTime()),n.setMinutes(n.getMinutes()+t),n}function jte(n,t,e){let r=n.getTimezoneOffset(),o=r4(t,r);return Vte(n,-1*(o-r))}function zte(n){if(qU(n))return n;if(typeof n=="number"&&!isNaN(n))return new Date(n);if(typeof n=="string"){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){let[r,o=1,d=1]=n.split("-").map(m=>+m);return U1(r,o-1,d)}let e=parseFloat(n);if(!isNaN(n-e))return new Date(e);let i;if(i=n.match(kte))return Ute(i)}let t=new Date(n);if(!qU(t))throw new Je(2311,!1);return t}function Ute(n){let t=new Date(0),e=0,i=0,r=n[8]?t.setUTCFullYear:t.setFullYear,o=n[8]?t.setUTCHours:t.setHours;n[9]&&(e=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(t,Number(n[1]),Number(n[2])-1,Number(n[3]));let d=Number(n[4]||0)-e,m=Number(n[5]||0)-i,b=Number(n[6]||0),T=Math.floor(parseFloat("0."+(n[7]||0))*1e3);return o.call(t,d,m,b,T),t}function qU(n){return n instanceof Date&&!isNaN(n.valueOf())}var Yk=/\s+/,WU=[],Qk=(()=>{class n{_ngEl;_renderer;initialClasses=WU;rawClass;stateMap=new Map;constructor(e,i){this._ngEl=e,this._renderer=i}set klass(e){this.initialClasses=e!=null?e.trim().split(Yk):WU}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(Yk):e}ngDoCheck(){for(let i of this.initialClasses)this._updateState(i,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let i of e)this._updateState(i,!0);else if(e!=null)for(let i of Object.keys(e))this._updateState(i,!!e[i]);this._applyStateDiff()}_updateState(e,i){let r=this.stateMap.get(e);r!==void 0?(r.enabled!==i&&(r.changed=!0,r.enabled=i),r.touched=!0):this.stateMap.set(e,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let i=e[0],r=e[1];r.changed?(this._toggleClass(i,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),r.touched=!1}}_toggleClass(e,i){e=e.trim(),e.length>0&&e.split(Yk).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}static \u0275fac=function(i){return new(i||n)(Ze(Fn),Ze(Br))};static \u0275dir=sn({type:n,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return n})();function $te(n,t){return new Je(2100,!1)}var Hte="mediumDate",o4=new rt(""),s4=new rt(""),Wf=(()=>{class n{locale;defaultTimezone;defaultOptions;constructor(e,i,r){this.locale=e,this.defaultTimezone=i,this.defaultOptions=r}transform(e,i,r,o){if(e==null||e===""||e!==e)return null;try{let d=i??this.defaultOptions?.dateFormat??Hte,m=r??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return n4(e,d,o||this.locale,m)}catch(d){throw $te(n,d.message)}}static \u0275fac=function(i){return new(i||n)(Ze(qf,16),Ze(o4,24),Ze(s4,24))};static \u0275pipe=Pk({name:"date",type:n,pure:!0})}return n})();var Ui=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})();function Yv(n,t){t=encodeURIComponent(t);for(let e of n.split(";")){let i=e.indexOf("="),[r,o]=i==-1?[e,""]:[e.slice(0,i),e.slice(i+1)];if(r.trim()===t)return decodeURIComponent(o)}return null}var Zf=class{};function $1(n,t,e){return jk(n,t,e)}var eR="browser";function a4(n){return n===eR}var tR=(()=>{class n{static \u0275prov=ze({token:n,providedIn:"root",factory:()=>new Jk(se(Ht),window)})}return n})(),Jk=class{document;window;offset=()=>[0,0];constructor(t,e){this.document=t,this.window=e}setOffset(t){Array.isArray(t)?this.offset=()=>t:this.offset=t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t,e){this.window.scrollTo(Mt(Be({},e),{left:t[0],top:t[1]}))}scrollToAnchor(t,e){let i=qte(this.document,t);i&&(this.scrollToElement(i,e),i.focus())}setHistoryScrollRestoration(t){try{this.window.history.scrollRestoration=t}catch(e){console.warn(Ma(2400,!1))}}scrollToElement(t,e){let i=t.getBoundingClientRect(),r=i.left+this.window.pageXOffset,o=i.top+this.window.pageYOffset,d=this.offset();this.window.scrollTo(Mt(Be({},e),{left:r-d[0],top:o-d[1]}))}};function qte(n,t){let e=n.getElementById(t)||n.getElementsByName(t)[0];if(e)return e;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),r=i.currentNode;for(;r;){let o=r.shadowRoot;if(o){let d=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(d)return d}r=i.nextNode()}}return null}var Qv=class{_doc;constructor(t){this._doc=t}manager},H1=(()=>{class n extends Qv{constructor(e){super(e)}supports(e){return!0}addEventListener(e,i,r,o){return e.addEventListener(i,r,o),()=>this.removeEventListener(e,i,r,o)}removeEventListener(e,i,r,o){return e.removeEventListener(i,r,o)}static \u0275fac=function(i){return new(i||n)(vt(Ht))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),W1=new rt(""),oR=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,i){this._zone=i,e.forEach(d=>{d.manager=this});let r=e.filter(d=>!(d instanceof H1));this._plugins=r.slice().reverse();let o=e.find(d=>d instanceof H1);o&&this._plugins.push(o)}addEventListener(e,i,r,o){return this._findPluginFor(i).addEventListener(e,i,r,o)}getZone(){return this._zone}_findPluginFor(e){let i=this._eventNameToPlugin.get(e);if(i)return i;if(i=this._plugins.find(o=>o.supports(e)),!i)throw new Je(5101,!1);return this._eventNameToPlugin.set(e,i),i}static \u0275fac=function(i){return new(i||n)(vt(W1),vt(jt))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),nR="ng-app-id";function l4(n){for(let t of n)t.remove()}function c4(n,t){let e=t.createElement("style");return e.textContent=n,e}function Wte(n,t,e,i){let r=n.head?.querySelectorAll(`style[${nR}="${t}"],link[${nR}="${t}"]`);if(r)for(let o of r)o.removeAttribute(nR),o instanceof HTMLLinkElement?i.set(o.href.slice(o.href.lastIndexOf("/")+1),{usage:0,elements:[o]}):o.textContent&&e.set(o.textContent,{usage:0,elements:[o]})}function rR(n,t){let e=t.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",n),e}var sR=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;constructor(e,i,r,o={}){this.doc=e,this.appId=i,this.nonce=r,Wte(e,i,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,i){for(let r of e)this.addUsage(r,this.inline,c4);i?.forEach(r=>this.addUsage(r,this.external,rR))}removeStyles(e,i){for(let r of e)this.removeUsage(r,this.inline);i?.forEach(r=>this.removeUsage(r,this.external))}addUsage(e,i,r){let o=i.get(e);o?o.usage++:i.set(e,{usage:1,elements:[...this.hosts].map(d=>this.addElement(d,r(e,this.doc)))})}removeUsage(e,i){let r=i.get(e);r&&(r.usage--,r.usage<=0&&(l4(r.elements),i.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])l4(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[i,{elements:r}]of this.inline)r.push(this.addElement(e,c4(i,this.doc)));for(let[i,{elements:r}]of this.external)r.push(this.addElement(e,rR(i,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,i){return this.nonce&&i.setAttribute("nonce",this.nonce),e.appendChild(i)}static \u0275fac=function(i){return new(i||n)(vt(Ht),vt(wg),vt(xg,8),vt($f))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),iR={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},aR=/%COMP%/g;var d4="%COMP%",Zte=`_nghost-${d4}`,Kte=`_ngcontent-${d4}`,Yte=!0,Xte=new rt("",{factory:()=>Yte});function Qte(n){return Kte.replace(aR,n)}function Jte(n){return Zte.replace(aR,n)}function h4(n,t){return t.map(e=>e.replace(aR,n))}var t0=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;constructor(e,i,r,o,d,m,b=null,T=null){this.eventManager=e,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestroy=o,this.doc=d,this.ngZone=m,this.nonce=b,this.tracingService=T,this.defaultRenderer=new Jv(e,d,m,this.tracingService)}createRenderer(e,i){if(!e||!i)return this.defaultRenderer;let r=this.getOrCreateRenderer(e,i);return r instanceof q1?r.applyToHost(e):r instanceof e0&&r.applyStyles(),r}getOrCreateRenderer(e,i){let r=this.rendererByCompId,o=r.get(i.id);if(!o){let d=this.doc,m=this.ngZone,b=this.eventManager,T=this.sharedStylesHost,A=this.removeStylesOnCompDestroy,N=this.tracingService;switch(i.encapsulation){case _l.Emulated:o=new q1(b,T,i,this.appId,A,d,m,N);break;case _l.ShadowDom:return new G1(b,e,i,d,m,this.nonce,N,T);case _l.ExperimentalIsolatedShadowDom:return new G1(b,e,i,d,m,this.nonce,N);default:o=new e0(b,T,i,A,d,m,N);break}r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(i){return new(i||n)(vt(oR),vt(sR),vt(wg),vt(Xte),vt(Ht),vt(jt),vt(xg),vt(mu,8))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),Jv=class{eventManager;doc;ngZone;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,e,i,r){this.eventManager=t,this.doc=e,this.ngZone=i,this.tracingService=r}destroy(){}destroyNode=null;createElement(t,e){return e?this.doc.createElementNS(iR[e]||e,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,e){(u4(t)?t.content:t).appendChild(e)}insertBefore(t,e,i){t&&(u4(t)?t.content:t).insertBefore(e,i)}removeChild(t,e){e.remove()}selectRootElement(t,e){let i=typeof t=="string"?this.doc.querySelector(t):t;if(!i)throw new Je(-5104,!1);return e||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,i,r){if(r){e=r+":"+e;let o=iR[r];o?t.setAttributeNS(o,e,i):t.setAttribute(e,i)}else t.setAttribute(e,i)}removeAttribute(t,e,i){if(i){let r=iR[i];r?t.removeAttributeNS(r,e):t.removeAttribute(`${i}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,i,r){r&(uc.DashCase|uc.Important)?t.style.setProperty(e,i,r&uc.Important?"important":""):t.style[e]=i}removeStyle(t,e,i){i&uc.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,i){t!=null&&(t[e]=i)}setValue(t,e){t.nodeValue=e}listen(t,e,i,r){if(typeof t=="string"&&(t=Ba().getGlobalEventTarget(this.doc,t),!t))throw new Je(5102,!1);let o=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(o=this.tracingService.wrapEventListener(t,e,o)),this.eventManager.addEventListener(t,e,o,r)}decoratePreventDefault(t){return e=>{if(e==="__ngUnwrap__")return t;t(e)===!1&&e.preventDefault()}}};function u4(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var G1=class extends Jv{hostEl;sharedStylesHost;shadowRoot;constructor(t,e,i,r,o,d,m,b){super(t,r,o,m),this.hostEl=e,this.sharedStylesHost=b,this.shadowRoot=e.attachShadow({mode:"open"}),this.sharedStylesHost&&this.sharedStylesHost.addHost(this.shadowRoot);let T=i.styles;T=h4(i.id,T);for(let N of T){let q=document.createElement("style");d&&q.setAttribute("nonce",d),q.textContent=N,this.shadowRoot.appendChild(q)}let A=i.getExternalStyles?.();if(A)for(let N of A){let q=rR(N,r);d&&q.setAttribute("nonce",d),this.shadowRoot.appendChild(q)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,i){return super.insertBefore(this.nodeOrShadowRoot(t),e,i)}removeChild(t,e){return super.removeChild(null,e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost&&this.sharedStylesHost.removeHost(this.shadowRoot)}},e0=class extends Jv{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,e,i,r,o,d,m,b){super(t,o,d,m),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=r;let T=i.styles;this.styles=b?h4(b,T):T,this.styleUrls=i.getExternalStyles?.(b)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&zf.size===0&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},q1=class extends e0{contentAttr;hostAttr;constructor(t,e,i,r,o,d,m,b){let T=r+"-"+i.id;super(t,e,i,o,d,m,b,T),this.contentAttr=Qte(T),this.hostAttr=Jte(T)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,e){let i=super.createElement(t,e);return super.setAttribute(i,this.contentAttr,""),i}};var Z1=class n extends Gv{supportsDOMEvents=!0;static makeCurrent(){Gk(new n)}onAndCancel(t,e,i,r){return t.addEventListener(e,i,r),()=>{t.removeEventListener(e,i,r)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){t.remove()}createElement(t,e){return e=e||this.getDefaultDocument(),e.createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return e==="window"?window:e==="document"?t:e==="body"?t.body:null}getBaseHref(t){let e=ene();return e==null?null:tne(e)}resetBaseElement(){n0=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Yv(document.cookie,t)}},n0=null;function ene(){return n0=n0||document.head.querySelector("base"),n0?n0.getAttribute("href"):null}function tne(n){return new URL(n,document.baseURI).pathname}var nne=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),f4=["alt","control","meta","shift"],ine={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},rne={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},p4=(()=>{class n extends Qv{constructor(e){super(e)}supports(e){return n.parseEventName(e)!=null}addEventListener(e,i,r,o){let d=n.parseEventName(i),m=n.eventCallback(d.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ba().onAndCancel(e,d.domEventName,m,o))}static parseEventName(e){let i=e.toLowerCase().split("."),r=i.shift();if(i.length===0||!(r==="keydown"||r==="keyup"))return null;let o=n._normalizeKey(i.pop()),d="",m=i.indexOf("code");if(m>-1&&(i.splice(m,1),d="code."),f4.forEach(T=>{let A=i.indexOf(T);A>-1&&(i.splice(A,1),d+=T+".")}),d+=o,i.length!=0||o.length===0)return null;let b={};return b.domEventName=r,b.fullKey=d,b}static matchEventFullKeyCode(e,i){let r=ine[e.key]||e.key,o="";return i.indexOf("code.")>-1&&(r=e.code,o="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),f4.forEach(d=>{if(d!==r){let m=rne[d];m(e)&&(o+=d+".")}}),o+=r,o===i)}static eventCallback(e,i,r){return o=>{n.matchEventFullKeyCode(o,e)&&r.runGuarded(()=>i(o))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(i){return new(i||n)(vt(Ht))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})();function lR(n,t,e){return ae(this,null,function*(){let i=Be({rootComponent:n},one(t,e));return jU(i)})}function one(n,t){return{platformRef:t?.platformRef,appProviders:[...une,...n?.providers??[]],platformProviders:cne}}function sne(){Z1.makeCurrent()}function ane(){return new tc}function lne(){return ck(document),document}var cne=[{provide:$f,useValue:eR},{provide:g1,useValue:sne,multi:!0},{provide:Ht,useFactory:lne}];var une=[{provide:gv,useValue:"root"},{provide:tc,useFactory:ane},{provide:W1,useClass:H1,multi:!0},{provide:W1,useClass:p4,multi:!0},t0,sR,oR,{provide:pr,useExisting:t0},{provide:Zf,useClass:nne},[]];var Kf=class n{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?typeof t=="string"?this.lazyInit=()=>{this.headers=new Map,t.split(`
`).forEach(e=>{let i=e.indexOf(":");if(i>0){let r=e.slice(0,i),o=e.slice(i+1).trim();this.addHeaderEntry(r,o)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((e,i)=>{this.addHeaderEntry(i,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([e,i])=>{this.setHeaderEntries(e,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();let e=this.headers.get(t.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,e){return this.clone({name:t,value:e,op:"a"})}set(t,e){return this.clone({name:t,value:e,op:"s"})}delete(t,e){return this.clone({name:t,value:e,op:"d"})}maybeSetNormalizedName(t,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,t)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(e=>{this.headers.set(e,t.headers.get(e)),this.normalizedNames.set(e,t.normalizedNames.get(e))})}clone(t){let e=new n;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([t]),e}applyUpdate(t){let e=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if(typeof i=="string"&&(i=[i]),i.length===0)return;this.maybeSetNormalizedName(t.name,e);let r=(t.op==="a"?this.headers.get(e):void 0)||[];r.push(...i),this.headers.set(e,r);break;case"d":let o=t.value;if(!o)this.headers.delete(e),this.normalizedNames.delete(e);else{let d=this.headers.get(e);if(!d)return;d=d.filter(m=>o.indexOf(m)===-1),d.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,d)}break}}addHeaderEntry(t,e){let i=t.toLowerCase();this.maybeSetNormalizedName(t,i),this.headers.has(i)?this.headers.get(i).push(e):this.headers.set(i,[e])}setHeaderEntries(t,e){let i=(Array.isArray(e)?e:[e]).map(o=>o.toString()),r=t.toLowerCase();this.headers.set(r,i),this.maybeSetNormalizedName(t,r)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>t(this.normalizedNames.get(e),this.headers.get(e)))}};var Y1=class{map=new Map;set(t,e){return this.map.set(t,e),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}},X1=class{encodeKey(t){return m4(t)}encodeValue(t){return m4(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}};function dne(n,t){let e=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{let o=r.indexOf("="),[d,m]=o==-1?[t.decodeKey(r),""]:[t.decodeKey(r.slice(0,o)),t.decodeValue(r.slice(o+1))],b=e.get(d)||[];b.push(m),e.set(d,b)}),e}var hne=/%(\d[a-f0-9])/gi,fne={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function m4(n){return encodeURIComponent(n).replace(hne,(t,e)=>fne[e]??t)}function K1(n){return`${n}`}var Bd=class n{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new X1,t.fromString){if(t.fromObject)throw new Je(2805,!1);this.map=dne(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(e=>{let i=t.fromObject[e],r=Array.isArray(i)?i.map(K1):[K1(i)];this.map.set(e,r)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();let e=this.map.get(t);return e?e[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,e){return this.clone({param:t,value:e,op:"a"})}appendAll(t){let e=[];return Object.keys(t).forEach(i=>{let r=t[i];Array.isArray(r)?r.forEach(o=>{e.push({param:i,value:o,op:"a"})}):e.push({param:i,value:r,op:"a"})}),this.clone(e)}set(t,e){return this.clone({param:t,value:e,op:"s"})}delete(t,e){return this.clone({param:t,value:e,op:"d"})}toString(){return this.init(),this.keys().map(t=>{let e=this.encoder.encodeKey(t);return this.map.get(t).map(i=>e+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>t!=="").join("&")}clone(t){let e=new n({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(t),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":let e=(t.op==="a"?this.map.get(t.param):void 0)||[];e.push(K1(t.value)),this.map.set(t.param,e);break;case"d":if(t.value!==void 0){let i=this.map.get(t.param)||[],r=i.indexOf(K1(t.value));r!==-1&&i.splice(r,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}else{this.map.delete(t.param);break}}}),this.cloneFrom=this.updates=null)}};function pne(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function g4(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function _4(n){return typeof Blob<"u"&&n instanceof Blob}function y4(n){return typeof FormData<"u"&&n instanceof FormData}function mne(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var v4="Content-Type",b4="Accept",w4="text/plain",x4="application/json",gne=`${x4}, ${w4}, */*`,i0=class n{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;credentials;keepalive=!1;cache;priority;mode;redirect;referrer;integrity;referrerPolicy;responseType="json";method;params;urlWithParams;transferCache;timeout;constructor(t,e,i,r){this.url=e,this.method=t.toUpperCase();let o;if(pne(this.method)||r?(this.body=i!==void 0?i:null,o=r):o=i,o){if(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.keepalive=!!o.keepalive,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=o.headers),o.context&&(this.context=o.context),o.params&&(this.params=o.params),o.priority&&(this.priority=o.priority),o.cache&&(this.cache=o.cache),o.credentials&&(this.credentials=o.credentials),typeof o.timeout=="number"){if(o.timeout<1||!Number.isInteger(o.timeout))throw new Je(2822,"");this.timeout=o.timeout}o.mode&&(this.mode=o.mode),o.redirect&&(this.redirect=o.redirect),o.integrity&&(this.integrity=o.integrity),o.referrer&&(this.referrer=o.referrer),o.referrerPolicy&&(this.referrerPolicy=o.referrerPolicy),this.transferCache=o.transferCache}if(this.headers??=new Kf,this.context??=new Y1,!this.params)this.params=new Bd,this.urlWithParams=e;else{let d=this.params.toString();if(d.length===0)this.urlWithParams=e;else{let m=e.indexOf("?"),b=m===-1?"?":m<e.length-1?"&":"";this.urlWithParams=e+b+d}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||g4(this.body)||_4(this.body)||y4(this.body)||mne(this.body)?this.body:this.body instanceof Bd?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||y4(this.body)?null:_4(this.body)?this.body.type||null:g4(this.body)?null:typeof this.body=="string"?w4:this.body instanceof Bd?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?x4:null}clone(t={}){let e=t.method||this.method,i=t.url||this.url,r=t.responseType||this.responseType,o=t.keepalive??this.keepalive,d=t.priority||this.priority,m=t.cache||this.cache,b=t.mode||this.mode,T=t.redirect||this.redirect,A=t.credentials||this.credentials,N=t.referrer||this.referrer,q=t.integrity||this.integrity,J=t.referrerPolicy||this.referrerPolicy,K=t.transferCache??this.transferCache,xe=t.timeout??this.timeout,Te=t.body!==void 0?t.body:this.body,Ge=t.withCredentials??this.withCredentials,Et=t.reportProgress??this.reportProgress,kt=t.headers||this.headers,Ue=t.params||this.params,Oe=t.context??this.context;return t.setHeaders!==void 0&&(kt=Object.keys(t.setHeaders).reduce((Qe,ct)=>Qe.set(ct,t.setHeaders[ct]),kt)),t.setParams&&(Ue=Object.keys(t.setParams).reduce((Qe,ct)=>Qe.set(ct,t.setParams[ct]),Ue)),new n(e,i,Te,{params:Ue,headers:kt,context:Oe,reportProgress:Et,responseType:r,withCredentials:Ge,transferCache:K,keepalive:o,cache:m,priority:d,timeout:xe,mode:b,redirect:T,credentials:A,referrer:N,integrity:q,referrerPolicy:J})}},Ig=(function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n})(Ig||{}),Mg=class{headers;status;statusText;url;ok;type;redirected;responseType;constructor(t,e=200,i="OK"){this.headers=t.headers||new Kf,this.status=t.status!==void 0?t.status:e,this.statusText=t.statusText||i,this.url=t.url||null,this.redirected=t.redirected,this.responseType=t.responseType,this.ok=this.status>=200&&this.status<300}},Q1=class n extends Mg{constructor(t={}){super(t)}type=Ig.ResponseHeader;clone(t={}){return new n({headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}},J1=class n extends Mg{body;constructor(t={}){super(t),this.body=t.body!==void 0?t.body:null}type=Ig.Response;clone(t={}){return new n({body:t.body!==void 0?t.body:this.body,headers:t.headers||this.headers,status:t.status!==void 0?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0,redirected:t.redirected??this.redirected,responseType:t.responseType??this.responseType})}},r0=class extends Mg{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${t.url||"(unknown url)"}`:this.message=`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}},_ne=200,yne=204;var vne=new rt("");var bne=/^\)\]\}',?\n/;var uR=(()=>{class n{xhrFactory;tracingService=se(mu,{optional:!0});constructor(e){this.xhrFactory=e}maybePropagateTrace(e){return this.tracingService?.propagate?this.tracingService.propagate(e):e}handle(e){if(e.method==="JSONP")throw new Je(-2800,!1);let i=this.xhrFactory;return Jt(null).pipe(Kr(()=>new Kt(o=>{let d=i.build();if(d.open(e.method,e.urlWithParams),e.withCredentials&&(d.withCredentials=!0),e.headers.forEach((Te,Ge)=>d.setRequestHeader(Te,Ge.join(","))),e.headers.has(b4)||d.setRequestHeader(b4,gne),!e.headers.has(v4)){let Te=e.detectContentTypeHeader();Te!==null&&d.setRequestHeader(v4,Te)}if(e.timeout&&(d.timeout=e.timeout),e.responseType){let Te=e.responseType.toLowerCase();d.responseType=Te!=="json"?Te:"text"}let m=e.serializeBody(),b=null,T=()=>{if(b!==null)return b;let Te=d.statusText||"OK",Ge=new Kf(d.getAllResponseHeaders()),Et=d.responseURL||e.url;return b=new Q1({headers:Ge,status:d.status,statusText:Te,url:Et}),b},A=this.maybePropagateTrace(()=>{let{headers:Te,status:Ge,statusText:Et,url:kt}=T(),Ue=null;Ge!==yne&&(Ue=typeof d.response>"u"?d.responseText:d.response),Ge===0&&(Ge=Ue?_ne:0);let Oe=Ge>=200&&Ge<300;if(e.responseType==="json"&&typeof Ue=="string"){let Qe=Ue;Ue=Ue.replace(bne,"");try{Ue=Ue!==""?JSON.parse(Ue):null}catch(ct){Ue=Qe,Oe&&(Oe=!1,Ue={error:ct,text:Ue})}}Oe?(o.next(new J1({body:Ue,headers:Te,status:Ge,statusText:Et,url:kt||void 0})),o.complete()):o.error(new r0({error:Ue,headers:Te,status:Ge,statusText:Et,url:kt||void 0}))}),N=this.maybePropagateTrace(Te=>{let{url:Ge}=T(),Et=new r0({error:Te,status:d.status||0,statusText:d.statusText||"Unknown Error",url:Ge||void 0});o.error(Et)}),q=N;e.timeout&&(q=this.maybePropagateTrace(Te=>{let{url:Ge}=T(),Et=new r0({error:new DOMException("Request timed out","TimeoutError"),status:d.status||0,statusText:d.statusText||"Request timeout",url:Ge||void 0});o.error(Et)}));let J=!1,K=this.maybePropagateTrace(Te=>{J||(o.next(T()),J=!0);let Ge={type:Ig.DownloadProgress,loaded:Te.loaded};Te.lengthComputable&&(Ge.total=Te.total),e.responseType==="text"&&d.responseText&&(Ge.partialText=d.responseText),o.next(Ge)}),xe=this.maybePropagateTrace(Te=>{let Ge={type:Ig.UploadProgress,loaded:Te.loaded};Te.lengthComputable&&(Ge.total=Te.total),o.next(Ge)});return d.addEventListener("load",A),d.addEventListener("error",N),d.addEventListener("timeout",q),d.addEventListener("abort",N),e.reportProgress&&(d.addEventListener("progress",K),m!==null&&d.upload&&d.upload.addEventListener("progress",xe)),d.send(m),o.next({type:Ig.Sent}),()=>{d.removeEventListener("error",N),d.removeEventListener("abort",N),d.removeEventListener("load",A),d.removeEventListener("timeout",q),e.reportProgress&&(d.removeEventListener("progress",K),m!==null&&d.upload&&d.upload.removeEventListener("progress",xe)),d.readyState!==d.DONE&&d.abort()}})))}static \u0275fac=function(i){return new(i||n)(vt(Zf))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function wne(n,t){return t(n)}function xne(n,t,e){return(i,r)=>so(e,()=>t(i,o=>n(o,r)))}var E4=new rt("",{factory:()=>[]}),Ene=new rt(""),C4=new rt("",{factory:()=>!0});var dR=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:function(i){let r=null;return i?r=new(i||n):r=vt(uR),r},providedIn:"root"})}return n})();var eC=(()=>{class n{backend;injector;chain=null;pendingTasks=se(VE);contributeToStability=se(C4);constructor(e,i){this.backend=e,this.injector=i}handle(e){if(this.chain===null){let i=Array.from(new Set([...this.injector.get(E4),...this.injector.get(Ene,[])]));this.chain=i.reduceRight((r,o)=>xne(r,o,this.injector),wne)}if(this.contributeToStability){let i=this.pendingTasks.add();return this.chain(e,r=>this.backend.handle(r)).pipe(sv(i))}else return this.chain(e,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||n)(vt(dR),vt(si))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),hR=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:function(i){let r=null;return i?r=new(i||n):r=vt(eC),r},providedIn:"root"})}return n})();function cR(n,t){return{body:t,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,credentials:n.credentials,transferCache:n.transferCache,timeout:n.timeout,keepalive:n.keepalive,priority:n.priority,cache:n.cache,mode:n.mode,redirect:n.redirect,integrity:n.integrity,referrer:n.referrer,referrerPolicy:n.referrerPolicy}}var Cne=(()=>{class n{handler;constructor(e){this.handler=e}request(e,i,r={}){let o;if(e instanceof i0)o=e;else{let b;r.headers instanceof Kf?b=r.headers:b=new Kf(r.headers);let T;r.params&&(r.params instanceof Bd?T=r.params:T=new Bd({fromObject:r.params})),o=new i0(e,i,r.body!==void 0?r.body:null,{headers:b,context:r.context,params:T,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache,keepalive:r.keepalive,priority:r.priority,cache:r.cache,mode:r.mode,redirect:r.redirect,credentials:r.credentials,referrer:r.referrer,referrerPolicy:r.referrerPolicy,integrity:r.integrity,timeout:r.timeout})}let d=Jt(o).pipe(Ed(b=>this.handler.handle(b)));if(e instanceof i0||r.observe==="events")return d;let m=d.pipe(mi(b=>b instanceof J1));switch(r.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return m.pipe(Tn(b=>{if(b.body!==null&&!(b.body instanceof ArrayBuffer))throw new Je(2806,!1);return b.body}));case"blob":return m.pipe(Tn(b=>{if(b.body!==null&&!(b.body instanceof Blob))throw new Je(2807,!1);return b.body}));case"text":return m.pipe(Tn(b=>{if(b.body!==null&&typeof b.body!="string")throw new Je(2808,!1);return b.body}));default:return m.pipe(Tn(b=>b.body))}case"response":return m;default:throw new Je(2809,!1)}}delete(e,i={}){return this.request("DELETE",e,i)}get(e,i={}){return this.request("GET",e,i)}head(e,i={}){return this.request("HEAD",e,i)}jsonp(e,i){return this.request("JSONP",e,{params:new Bd().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,i={}){return this.request("OPTIONS",e,i)}patch(e,i,r={}){return this.request("PATCH",e,cR(r,i))}post(e,i,r={}){return this.request("POST",e,cR(r,i))}put(e,i,r={}){return this.request("PUT",e,cR(r,i))}static \u0275fac=function(i){return new(i||n)(vt(hR))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Tne=new rt("",{factory:()=>!0}),Sne="XSRF-TOKEN",Dne=new rt("",{factory:()=>Sne}),Ine="X-XSRF-TOKEN",Mne=new rt("",{factory:()=>Ine}),Ane=(()=>{class n{cookieName=se(Dne);doc=se(Ht);lastCookieString="";lastToken=null;parseCount=0;getToken(){let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Yv(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),T4=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:function(i){let r=null;return i?r=new(i||n):r=vt(Ane),r},providedIn:"root"})}return n})();function kne(n,t){if(!se(Tne)||n.method==="GET"||n.method==="HEAD")return t(n);try{let r=se(yu).href,{origin:o}=new URL(r),{origin:d}=new URL(n.url,o);if(o!==d)return t(n)}catch(r){return t(n)}let e=se(T4).getToken(),i=se(Mne);return e!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,e)})),t(n)}function fR(...n){let t=[Cne,eC,{provide:hR,useExisting:eC},{provide:dR,useFactory:()=>se(vne,{optional:!0})??se(uR)},{provide:E4,useValue:kne,multi:!0}];for(let e of n)t.push(...e.\u0275providers);return dl(t)}var S4=(()=>{class n{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(i){return new(i||n)(vt(Ht))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var pR=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:function(i){let r=null;return i?r=new(i||n):r=vt(Rne),r},providedIn:"root"})}return n})(),Rne=(()=>{class n extends pR{_doc;constructor(e){super(),this._doc=e}sanitize(e,i){if(i==null)return null;switch(e){case la.NONE:return i;case la.HTML:return fu(i,"HTML")?La(i):mk(this._doc,String(i)).toString();case la.STYLE:return fu(i,"Style")?La(i):i;case la.SCRIPT:if(fu(i,"Script"))return La(i);throw new Je(5200,!1);case la.URL:return fu(i,"URL")?La(i):Ov(String(i));case la.RESOURCE_URL:if(fu(i,"ResourceURL"))return La(i);throw new Je(5201,!1);default:throw new Je(5202,!1)}}bypassSecurityTrustHtml(e){return uk(e)}bypassSecurityTrustStyle(e){return dk(e)}bypassSecurityTrustScript(e){return hk(e)}bypassSecurityTrustUrl(e){return fk(e)}bypassSecurityTrustResourceUrl(e){return pk(e)}static \u0275fac=function(i){return new(i||n)(vt(Ht))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var kn=(function(n){return n[n.State=0]="State",n[n.Transition=1]="Transition",n[n.Sequence=2]="Sequence",n[n.Group=3]="Group",n[n.Animate=4]="Animate",n[n.Keyframes=5]="Keyframes",n[n.Style=6]="Style",n[n.Trigger=7]="Trigger",n[n.Reference=8]="Reference",n[n.AnimateChild=9]="AnimateChild",n[n.AnimateRef=10]="AnimateRef",n[n.Query=11]="Query",n[n.Stagger=12]="Stagger",n})(kn||{}),xl="*";function D4(n,t=null){return{type:kn.Sequence,steps:n,options:t}}function mR(n){return{type:kn.Style,styles:n,offset:null}}var wu=class{_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_originalOnDoneFns=[];_originalOnStartFns=[];_started=!1;_destroyed=!1;_finished=!1;_position=0;parentPlayer=null;totalTime;constructor(t=0,e=0){this.totalTime=t+e}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(t=>t()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(t){this._position=this.totalTime?t*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},Ag=class{_onDoneFns=[];_onStartFns=[];_finished=!1;_started=!1;_destroyed=!1;_onDestroyFns=[];parentPlayer=null;totalTime=0;players;constructor(t){this.players=t;let e=0,i=0,r=0,o=this.players.length;o==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(d=>{d.onDone(()=>{++e==o&&this._onFinish()}),d.onDestroy(()=>{++i==o&&this._onDestroy()}),d.onStart(()=>{++r==o&&this._onStart()})}),this.totalTime=this.players.reduce((d,m)=>Math.max(d,m.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this.players.forEach(t=>t.init())}onStart(t){this._onStartFns.push(t)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(t=>t()),this._onStartFns=[])}onDone(t){this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(t=>t.play())}pause(){this.players.forEach(t=>t.pause())}restart(){this.players.forEach(t=>t.restart())}finish(){this._onFinish(),this.players.forEach(t=>t.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(t=>t.destroy()),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}reset(){this.players.forEach(t=>t.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(t){let e=t*this.totalTime;this.players.forEach(i=>{let r=i.totalTime?Math.min(1,e/i.totalTime):1;i.setPosition(r)})}getPosition(){let t=this.players.reduce((e,i)=>e===null||i.totalTime>e.totalTime?i:e,null);return t!=null?t.getPosition():0}beforeDestroy(){this.players.forEach(t=>{t.beforeDestroy&&t.beforeDestroy()})}triggerCallback(t){let e=t=="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},o0="!";function I4(n){return new Je(3e3,!1)}function Nne(){return new Je(3100,!1)}function One(){return new Je(3101,!1)}function Fne(n){return new Je(3001,!1)}function Lne(n){return new Je(3003,!1)}function Bne(n){return new Je(3004,!1)}function A4(n,t){return new Je(3005,!1)}function k4(){return new Je(3006,!1)}function R4(){return new Je(3007,!1)}function P4(n,t){return new Je(3008,!1)}function N4(n){return new Je(3002,!1)}function O4(n,t,e,i,r){return new Je(3010,!1)}function F4(){return new Je(3011,!1)}function L4(){return new Je(3012,!1)}function B4(){return new Je(3200,!1)}function V4(){return new Je(3202,!1)}function j4(){return new Je(3013,!1)}function z4(n){return new Je(3014,!1)}function U4(n){return new Je(3015,!1)}function $4(n){return new Je(3016,!1)}function H4(n,t){return new Je(3404,!1)}function Vne(n){return new Je(3502,!1)}function G4(n){return new Je(3503,!1)}function q4(){return new Je(3300,!1)}function W4(n){return new Je(3504,!1)}function Z4(n){return new Je(3301,!1)}function K4(n,t){return new Je(3302,!1)}function Y4(n){return new Je(3303,!1)}function X4(n,t){return new Je(3400,!1)}function Q4(n){return new Je(3401,!1)}function J4(n){return new Je(3402,!1)}function e5(n,t){return new Je(3505,!1)}function xu(n){switch(n.length){case 0:return new wu;case 1:return n[0];default:return new Ag(n)}}function vR(n,t,e=new Map,i=new Map){let r=[],o=[],d=-1,m=null;if(t.forEach(b=>{let T=b.get("offset"),A=T==d,N=A&&m||new Map;b.forEach((q,J)=>{let K=J,xe=q;if(J!=="offset")switch(K=n.normalizePropertyName(K,r),xe){case o0:xe=e.get(J);break;case xl:xe=i.get(J);break;default:xe=n.normalizeStyleValue(J,K,xe,r);break}N.set(K,xe)}),A||o.push(N),m=N,d=T}),r.length)throw Vne(r);return o}function tC(n,t,e,i){switch(t){case"start":n.onStart(()=>i(e&&gR(e,"start",n)));break;case"done":n.onDone(()=>i(e&&gR(e,"done",n)));break;case"destroy":n.onDestroy(()=>i(e&&gR(e,"destroy",n)));break}}function gR(n,t,e){let i=e.totalTime,r=!!e.disabled,o=nC(n.element,n.triggerName,n.fromState,n.toState,t||n.phaseName,i??n.totalTime,r),d=n._data;return d!=null&&(o._data=d),o}function nC(n,t,e,i,r="",o=0,d){return{element:n,triggerName:t,fromState:e,toState:i,phaseName:r,totalTime:o,disabled:!!d}}function zs(n,t,e){let i=n.get(t);return i||n.set(t,i=e),i}function bR(n){let t=n.indexOf(":"),e=n.substring(1,t),i=n.slice(t+1);return[e,i]}var jne=typeof document>"u"?null:document.documentElement;function iC(n){let t=n.parentNode||n.host||null;return t===jne?null:t}function zne(n){return n.substring(1,6)=="ebkit"}var Yf=null,M4=!1;function t5(n){Yf||(Yf=Une()||{},M4=Yf.style?"WebkitAppearance"in Yf.style:!1);let t=!0;return Yf.style&&!zne(n)&&(t=n in Yf.style,!t&&M4&&(t="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in Yf.style)),t}function Une(){return typeof document<"u"?document.body:null}function wR(n,t){for(;t;){if(t===n)return!0;t=iC(t)}return!1}function xR(n,t,e){if(e)return Array.from(n.querySelectorAll(t));let i=n.querySelector(t);return i?[i]:[]}var $ne=1e3,ER="{{",Hne="}}",CR="ng-enter",rC="ng-leave",s0="ng-trigger",a0=".ng-trigger",TR="ng-animating",oC=".ng-animating";function fc(n){if(typeof n=="number")return n;let t=n.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:_R(parseFloat(t[1]),t[2])}function _R(n,t){return t==="s"?n*$ne:n}function l0(n,t,e){return n.hasOwnProperty("duration")?n:qne(n,t,e)}var Gne=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i;function qne(n,t,e){let i,r=0,o="";if(typeof n=="string"){let d=n.match(Gne);if(d===null)return t.push(I4(n)),{duration:0,delay:0,easing:""};i=_R(parseFloat(d[1]),d[2]);let m=d[3];m!=null&&(r=_R(parseFloat(m),d[4]));let b=d[5];b&&(o=b)}else i=n;if(!e){let d=!1,m=t.length;i<0&&(t.push(Nne()),d=!0),r<0&&(t.push(One()),d=!0),d&&t.splice(m,0,I4(n))}return{duration:i,delay:r,easing:o}}function n5(n){return n.length?n[0]instanceof Map?n:n.map(t=>new Map(Object.entries(t))):[]}function El(n,t,e){t.forEach((i,r)=>{let o=sC(r);e&&!e.has(r)&&e.set(r,n.style[o]),n.style[o]=i})}function Vd(n,t){t.forEach((e,i)=>{let r=sC(i);n.style[r]=""})}function kg(n){return Array.isArray(n)?n.length==1?n[0]:D4(n):n}function i5(n,t,e){let i=t.params||{},r=SR(n);r.length&&r.forEach(o=>{i.hasOwnProperty(o)||e.push(Fne(o))})}var yR=new RegExp(`${ER}\\s*(.+?)\\s*${Hne}`,"g");function SR(n){let t=[];if(typeof n=="string"){let e;for(;e=yR.exec(n);)t.push(e[1]);yR.lastIndex=0}return t}function Rg(n,t,e){let i=`${n}`,r=i.replace(yR,(o,d)=>{let m=t[d];return m==null&&(e.push(Lne(d)),m=""),m.toString()});return r==i?n:r}var Wne=/-+([a-z0-9])/g;function sC(n){return n.replace(Wne,(...t)=>t[1].toUpperCase())}function r5(n,t){return n===0||t===0}function o5(n,t,e){if(e.size&&t.length){let i=t[0],r=[];if(e.forEach((o,d)=>{i.has(d)||r.push(d),i.set(d,o)}),r.length)for(let o=1;o<t.length;o++){let d=t[o];r.forEach(m=>d.set(m,aC(n,m)))}}return t}function Us(n,t,e){switch(t.type){case kn.Trigger:return n.visitTrigger(t,e);case kn.State:return n.visitState(t,e);case kn.Transition:return n.visitTransition(t,e);case kn.Sequence:return n.visitSequence(t,e);case kn.Group:return n.visitGroup(t,e);case kn.Animate:return n.visitAnimate(t,e);case kn.Keyframes:return n.visitKeyframes(t,e);case kn.Style:return n.visitStyle(t,e);case kn.Reference:return n.visitReference(t,e);case kn.AnimateChild:return n.visitAnimateChild(t,e);case kn.AnimateRef:return n.visitAnimateRef(t,e);case kn.Query:return n.visitQuery(t,e);case kn.Stagger:return n.visitStagger(t,e);default:throw Bne(t.type)}}function aC(n,t){return window.getComputedStyle(n)[t]}var $R=(()=>{class n{validateStyleProperty(e){return t5(e)}containsElement(e,i){return wR(e,i)}getParentElement(e){return iC(e)}query(e,i,r){return xR(e,i,r)}computeStyle(e,i,r){return r||""}animate(e,i,r,o,d,m=[],b){return new wu(r,o)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),Qf=class{static NOOP=new $R},Jf=class{};var Zne=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),hC=class extends Jf{normalizePropertyName(t,e){return sC(t)}normalizeStyleValue(t,e,i,r){let o="",d=i.toString().trim();if(Zne.has(e)&&i!==0&&i!=="0")if(typeof i=="number")o="px";else{let m=i.match(/^[+-]?[\d\.]+([a-z]*)$/);m&&m[1].length==0&&r.push(A4(t,i))}return d+o}};var fC="*";function Kne(n,t){let e=[];return typeof n=="string"?n.split(/\s*,\s*/).forEach(i=>Yne(i,e,t)):e.push(n),e}function Yne(n,t,e){if(n[0]==":"){let b=Xne(n,e);if(typeof b=="function"){t.push(b);return}n=b}let i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(i==null||i.length<4)return e.push(U4(n)),t;let r=i[1],o=i[2],d=i[3];t.push(s5(r,d));let m=r==fC&&d==fC;o[0]=="<"&&!m&&t.push(s5(d,r))}function Xne(n,t){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,i)=>parseFloat(i)>parseFloat(e);case":decrement":return(e,i)=>parseFloat(i)<parseFloat(e);default:return t.push($4(n)),"* => *"}}var lC=new Set(["true","1"]),cC=new Set(["false","0"]);function s5(n,t){let e=lC.has(n)||cC.has(n),i=lC.has(t)||cC.has(t);return(r,o)=>{let d=n==fC||n==r,m=t==fC||t==o;return!d&&e&&typeof r=="boolean"&&(d=r?lC.has(n):cC.has(n)),!m&&i&&typeof o=="boolean"&&(m=o?lC.has(t):cC.has(t)),d&&m}}var g5=":self",Qne=new RegExp(`s*${g5}s*,?`,"g");function _5(n,t,e,i){return new RR(n).build(t,e,i)}var a5="",RR=class{_driver;constructor(t){this._driver=t}build(t,e,i){let r=new PR(e);return this._resetContextStyleTimingState(r),Us(this,kg(t),r)}_resetContextStyleTimingState(t){t.currentQuerySelector=a5,t.collectedStyles=new Map,t.collectedStyles.set(a5,new Map),t.currentTime=0}visitTrigger(t,e){let i=e.queryCount=0,r=e.depCount=0,o=[],d=[];return t.name.charAt(0)=="@"&&e.errors.push(k4()),t.definitions.forEach(m=>{if(this._resetContextStyleTimingState(e),m.type==kn.State){let b=m,T=b.name;T.toString().split(/\s*,\s*/).forEach(A=>{b.name=A,o.push(this.visitState(b,e))}),b.name=T}else if(m.type==kn.Transition){let b=this.visitTransition(m,e);i+=b.queryCount,r+=b.depCount,d.push(b)}else e.errors.push(R4())}),{type:kn.Trigger,name:t.name,states:o,transitions:d,queryCount:i,depCount:r,options:null}}visitState(t,e){let i=this.visitStyle(t.styles,e),r=t.options&&t.options.params||null;if(i.containsDynamicStyles){let o=new Set,d=r||{};i.styles.forEach(m=>{m instanceof Map&&m.forEach(b=>{SR(b).forEach(T=>{d.hasOwnProperty(T)||o.add(T)})})}),o.size&&e.errors.push(P4(t.name,[...o.values()]))}return{type:kn.State,name:t.name,style:i,options:r?{params:r}:null}}visitTransition(t,e){e.queryCount=0,e.depCount=0;let i=Us(this,kg(t.animation),e),r=Kne(t.expr,e.errors);return{type:kn.Transition,matchers:r,animation:i,queryCount:e.queryCount,depCount:e.depCount,options:Xf(t.options)}}visitSequence(t,e){return{type:kn.Sequence,steps:t.steps.map(i=>Us(this,i,e)),options:Xf(t.options)}}visitGroup(t,e){let i=e.currentTime,r=0,o=t.steps.map(d=>{e.currentTime=i;let m=Us(this,d,e);return r=Math.max(r,e.currentTime),m});return e.currentTime=r,{type:kn.Group,steps:o,options:Xf(t.options)}}visitAnimate(t,e){let i=nie(t.timings,e.errors);e.currentAnimateTimings=i;let r,o=t.styles?t.styles:mR({});if(o.type==kn.Keyframes)r=this.visitKeyframes(o,e);else{let d=t.styles,m=!1;if(!d){m=!0;let T={};i.easing&&(T.easing=i.easing),d=mR(T)}e.currentTime+=i.duration+i.delay;let b=this.visitStyle(d,e);b.isEmptyStep=m,r=b}return e.currentAnimateTimings=null,{type:kn.Animate,timings:i,style:r,options:null}}visitStyle(t,e){let i=this._makeStyleAst(t,e);return this._validateStyleAst(i,e),i}_makeStyleAst(t,e){let i=[],r=Array.isArray(t.styles)?t.styles:[t.styles];for(let m of r)typeof m=="string"?m===xl?i.push(m):e.errors.push(N4(m)):i.push(new Map(Object.entries(m)));let o=!1,d=null;return i.forEach(m=>{if(m instanceof Map&&(m.has("easing")&&(d=m.get("easing"),m.delete("easing")),!o)){for(let b of m.values())if(b.toString().indexOf(ER)>=0){o=!0;break}}}),{type:kn.Style,styles:i,easing:d,offset:t.offset,containsDynamicStyles:o,options:null}}_validateStyleAst(t,e){let i=e.currentAnimateTimings,r=e.currentTime,o=e.currentTime;i&&o>0&&(o-=i.duration+i.delay),t.styles.forEach(d=>{typeof d!="string"&&d.forEach((m,b)=>{let T=e.collectedStyles.get(e.currentQuerySelector),A=T.get(b),N=!0;A&&(o!=r&&o>=A.startTime&&r<=A.endTime&&(e.errors.push(O4(b,A.startTime,A.endTime,o,r)),N=!1),o=A.startTime),N&&T.set(b,{startTime:o,endTime:r}),e.options&&i5(m,e.options,e.errors)})})}visitKeyframes(t,e){let i={type:kn.Keyframes,styles:[],options:null};if(!e.currentAnimateTimings)return e.errors.push(F4()),i;let r=1,o=0,d=[],m=!1,b=!1,T=0,A=t.steps.map(Ge=>{let Et=this._makeStyleAst(Ge,e),kt=Et.offset!=null?Et.offset:tie(Et.styles),Ue=0;return kt!=null&&(o++,Ue=Et.offset=kt),b=b||Ue<0||Ue>1,m=m||Ue<T,T=Ue,d.push(Ue),Et});b&&e.errors.push(L4()),m&&e.errors.push(B4());let N=t.steps.length,q=0;o>0&&o<N?e.errors.push(V4()):o==0&&(q=r/(N-1));let J=N-1,K=e.currentTime,xe=e.currentAnimateTimings,Te=xe.duration;return A.forEach((Ge,Et)=>{let kt=q>0?Et==J?1:q*Et:d[Et],Ue=kt*Te;e.currentTime=K+xe.delay+Ue,xe.duration=Ue,this._validateStyleAst(Ge,e),Ge.offset=kt,i.styles.push(Ge)}),i}visitReference(t,e){return{type:kn.Reference,animation:Us(this,kg(t.animation),e),options:Xf(t.options)}}visitAnimateChild(t,e){return e.depCount++,{type:kn.AnimateChild,options:Xf(t.options)}}visitAnimateRef(t,e){return{type:kn.AnimateRef,animation:this.visitReference(t.animation,e),options:Xf(t.options)}}visitQuery(t,e){let i=e.currentQuerySelector,r=t.options||{};e.queryCount++,e.currentQuery=t;let[o,d]=Jne(t.selector);e.currentQuerySelector=i.length?i+" "+o:o,zs(e.collectedStyles,e.currentQuerySelector,new Map);let m=Us(this,kg(t.animation),e);return e.currentQuery=null,e.currentQuerySelector=i,{type:kn.Query,selector:o,limit:r.limit||0,optional:!!r.optional,includeSelf:d,animation:m,originalSelector:t.selector,options:Xf(t.options)}}visitStagger(t,e){e.currentQuery||e.errors.push(j4());let i=t.timings==="full"?{duration:0,delay:0,easing:"full"}:l0(t.timings,e.errors,!0);return{type:kn.Stagger,animation:Us(this,kg(t.animation),e),timings:i,options:null}}};function Jne(n){let t=!!n.split(/\s*,\s*/).find(e=>e==g5);return t&&(n=n.replace(Qne,"")),n=n.replace(/@\*/g,a0).replace(/@\w+/g,e=>a0+"-"+e.slice(1)).replace(/:animating/g,oC),[n,t]}function eie(n){return n?Be({},n):null}var PR=class{errors;queryCount=0;depCount=0;currentTransition=null;currentQuery=null;currentQuerySelector=null;currentAnimateTimings=null;currentTime=0;collectedStyles=new Map;options=null;unsupportedCSSPropertiesFound=new Set;constructor(t){this.errors=t}};function tie(n){if(typeof n=="string")return null;let t=null;if(Array.isArray(n))n.forEach(e=>{if(e instanceof Map&&e.has("offset")){let i=e;t=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){let e=n;t=parseFloat(e.get("offset")),e.delete("offset")}return t}function nie(n,t){if(n.hasOwnProperty("duration"))return n;if(typeof n=="number"){let o=l0(n,t).duration;return DR(o,0,"")}let e=n;if(e.split(/\s+/).some(o=>o.charAt(0)=="{"&&o.charAt(1)=="{")){let o=DR(0,0,"");return o.dynamic=!0,o.strValue=e,o}let r=l0(e,t);return DR(r.duration,r.delay,r.easing)}function Xf(n){return n?(n=Be({},n),n.params&&(n.params=eie(n.params))):n={},n}function DR(n,t,e){return{duration:n,delay:t,easing:e}}function HR(n,t,e,i,r,o,d=null,m=!1){return{type:1,element:n,keyframes:t,preStyleProps:e,postStyleProps:i,duration:r,delay:o,totalTime:r+o,easing:d,subTimeline:m}}var u0=class{_map=new Map;get(t){return this._map.get(t)||[]}append(t,e){let i=this._map.get(t);i||this._map.set(t,i=[]),i.push(...e)}has(t){return this._map.has(t)}clear(){this._map.clear()}},iie=1,rie=":enter",oie=new RegExp(rie,"g"),sie=":leave",aie=new RegExp(sie,"g");function y5(n,t,e,i,r,o=new Map,d=new Map,m,b,T=[]){return new NR().buildKeyframes(n,t,e,i,r,o,d,m,b,T)}var NR=class{buildKeyframes(t,e,i,r,o,d,m,b,T,A=[]){T=T||new u0;let N=new OR(t,e,T,r,o,A,[]);N.options=b;let q=b.delay?fc(b.delay):0;N.currentTimeline.delayNextStep(q),N.currentTimeline.setStyles([d],null,N.errors,b),Us(this,i,N);let J=N.timelines.filter(K=>K.containsAnimation());if(J.length&&m.size){let K;for(let xe=J.length-1;xe>=0;xe--){let Te=J[xe];if(Te.element===e){K=Te;break}}K&&!K.allowOnlyTimelineStyles()&&K.setStyles([m],null,N.errors,b)}return J.length?J.map(K=>K.buildKeyframes()):[HR(e,[],[],[],0,q,"",!1)]}visitTrigger(t,e){}visitState(t,e){}visitTransition(t,e){}visitAnimateChild(t,e){let i=e.subInstructions.get(e.element);if(i){let r=e.createSubContext(t.options),o=e.currentTimeline.currentTime,d=this._visitSubInstructions(i,r,r.options);o!=d&&e.transformIntoNewTimeline(d)}e.previousNode=t}visitAnimateRef(t,e){let i=e.createSubContext(t.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([t.options,t.animation.options],e,i),this.visitReference(t.animation,i),e.transformIntoNewTimeline(i.currentTimeline.currentTime),e.previousNode=t}_applyAnimationRefDelays(t,e,i){for(let r of t){let o=r?.delay;if(o){let d=typeof o=="number"?o:fc(Rg(o,r?.params??{},e.errors));i.delayNextStep(d)}}}_visitSubInstructions(t,e,i){let o=e.currentTimeline.currentTime,d=i.duration!=null?fc(i.duration):null,m=i.delay!=null?fc(i.delay):null;return d!==0&&t.forEach(b=>{let T=e.appendInstructionToTimeline(b,d,m);o=Math.max(o,T.duration+T.delay)}),o}visitReference(t,e){e.updateOptions(t.options,!0),Us(this,t.animation,e),e.previousNode=t}visitSequence(t,e){let i=e.subContextCount,r=e,o=t.options;if(o&&(o.params||o.delay)&&(r=e.createSubContext(o),r.transformIntoNewTimeline(),o.delay!=null)){r.previousNode.type==kn.Style&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=pC);let d=fc(o.delay);r.delayNextStep(d)}t.steps.length&&(t.steps.forEach(d=>Us(this,d,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),e.previousNode=t}visitGroup(t,e){let i=[],r=e.currentTimeline.currentTime,o=t.options&&t.options.delay?fc(t.options.delay):0;t.steps.forEach(d=>{let m=e.createSubContext(t.options);o&&m.delayNextStep(o),Us(this,d,m),r=Math.max(r,m.currentTimeline.currentTime),i.push(m.currentTimeline)}),i.forEach(d=>e.currentTimeline.mergeTimelineCollectedStyles(d)),e.transformIntoNewTimeline(r),e.previousNode=t}_visitTiming(t,e){if(t.dynamic){let i=t.strValue,r=e.params?Rg(i,e.params,e.errors):i;return l0(r,e.errors)}else return{duration:t.duration,delay:t.delay,easing:t.easing}}visitAnimate(t,e){let i=e.currentAnimateTimings=this._visitTiming(t.timings,e),r=e.currentTimeline;i.delay&&(e.incrementTime(i.delay),r.snapshotCurrentStyles());let o=t.style;o.type==kn.Keyframes?this.visitKeyframes(o,e):(e.incrementTime(i.duration),this.visitStyle(o,e),r.applyStylesToKeyframe()),e.currentAnimateTimings=null,e.previousNode=t}visitStyle(t,e){let i=e.currentTimeline,r=e.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();let o=r&&r.easing||t.easing;t.isEmptyStep?i.applyEmptyStep(o):i.setStyles(t.styles,o,e.errors,e.options),e.previousNode=t}visitKeyframes(t,e){let i=e.currentAnimateTimings,r=e.currentTimeline.duration,o=i.duration,m=e.createSubContext().currentTimeline;m.easing=i.easing,t.styles.forEach(b=>{let T=b.offset||0;m.forwardTime(T*o),m.setStyles(b.styles,b.easing,e.errors,e.options),m.applyStylesToKeyframe()}),e.currentTimeline.mergeTimelineCollectedStyles(m),e.transformIntoNewTimeline(r+o),e.previousNode=t}visitQuery(t,e){let i=e.currentTimeline.currentTime,r=t.options||{},o=r.delay?fc(r.delay):0;o&&(e.previousNode.type===kn.Style||i==0&&e.currentTimeline.hasCurrentStyleProperties())&&(e.currentTimeline.snapshotCurrentStyles(),e.previousNode=pC);let d=i,m=e.invokeQuery(t.selector,t.originalSelector,t.limit,t.includeSelf,!!r.optional,e.errors);e.currentQueryTotal=m.length;let b=null;m.forEach((T,A)=>{e.currentQueryIndex=A;let N=e.createSubContext(t.options,T);o&&N.delayNextStep(o),T===e.element&&(b=N.currentTimeline),Us(this,t.animation,N),N.currentTimeline.applyStylesToKeyframe();let q=N.currentTimeline.currentTime;d=Math.max(d,q)}),e.currentQueryIndex=0,e.currentQueryTotal=0,e.transformIntoNewTimeline(d),b&&(e.currentTimeline.mergeTimelineCollectedStyles(b),e.currentTimeline.snapshotCurrentStyles()),e.previousNode=t}visitStagger(t,e){let i=e.parentContext,r=e.currentTimeline,o=t.timings,d=Math.abs(o.duration),m=d*(e.currentQueryTotal-1),b=d*e.currentQueryIndex;switch(o.duration<0?"reverse":o.easing){case"reverse":b=m-b;break;case"full":b=i.currentStaggerTime;break}let A=e.currentTimeline;b&&A.delayNextStep(b);let N=A.currentTime;Us(this,t.animation,e),e.previousNode=t,i.currentStaggerTime=r.currentTime-N+(r.startTime-i.currentTimeline.startTime)}},pC={},OR=class n{_driver;element;subInstructions;_enterClassName;_leaveClassName;errors;timelines;parentContext=null;currentTimeline;currentAnimateTimings=null;previousNode=pC;subContextCount=0;options={};currentQueryIndex=0;currentQueryTotal=0;currentStaggerTime=0;constructor(t,e,i,r,o,d,m,b){this._driver=t,this.element=e,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=o,this.errors=d,this.timelines=m,this.currentTimeline=b||new mC(this._driver,e,0),m.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(t,e){if(!t)return;let i=t,r=this.options;i.duration!=null&&(r.duration=fc(i.duration)),i.delay!=null&&(r.delay=fc(i.delay));let o=i.params;if(o){let d=r.params;d||(d=this.options.params={}),Object.keys(o).forEach(m=>{(!e||!d.hasOwnProperty(m))&&(d[m]=Rg(o[m],d,this.errors))})}}_copyOptions(){let t={};if(this.options){let e=this.options.params;if(e){let i=t.params={};Object.keys(e).forEach(r=>{i[r]=e[r]})}}return t}createSubContext(t=null,e,i){let r=e||this.element,o=new n(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(t),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}transformIntoNewTimeline(t){return this.previousNode=pC,this.currentTimeline=this.currentTimeline.fork(this.element,t),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(t,e,i){let r={duration:e??t.duration,delay:this.currentTimeline.currentTime+(i??0)+t.delay,easing:""},o=new FR(this._driver,t.element,t.keyframes,t.preStyleProps,t.postStyleProps,r,t.stretchStartingKeyframe);return this.timelines.push(o),r}incrementTime(t){this.currentTimeline.forwardTime(this.currentTimeline.duration+t)}delayNextStep(t){t>0&&this.currentTimeline.delayNextStep(t)}invokeQuery(t,e,i,r,o,d){let m=[];if(r&&m.push(this.element),t.length>0){t=t.replace(oie,"."+this._enterClassName),t=t.replace(aie,"."+this._leaveClassName);let b=i!=1,T=this._driver.query(this.element,t,b);i!==0&&(T=i<0?T.slice(T.length+i,T.length):T.slice(0,i)),m.push(...T)}return!o&&m.length==0&&d.push(z4(e)),m}},mC=class n{_driver;element;startTime;_elementTimelineStylesLookup;duration=0;easing=null;_previousKeyframe=new Map;_currentKeyframe=new Map;_keyframes=new Map;_styleSummary=new Map;_localTimelineStyles=new Map;_globalTimelineStyles;_pendingStyles=new Map;_backFill=new Map;_currentEmptyStepKeyframe=null;constructor(t,e,i,r){this._driver=t,this.element=e,this.startTime=i,this._elementTimelineStylesLookup=r,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(e),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(e,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(t){let e=this._keyframes.size===1&&this._pendingStyles.size;this.duration||e?(this.forwardTime(this.currentTime+t),e&&this.snapshotCurrentStyles()):this.startTime+=t}fork(t,e){return this.applyStylesToKeyframe(),new n(this._driver,t,e||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=iie,this._loadKeyframe()}forwardTime(t){this.applyStylesToKeyframe(),this.duration=t,this._loadKeyframe()}_updateStyle(t,e){this._localTimelineStyles.set(t,e),this._globalTimelineStyles.set(t,e),this._styleSummary.set(t,{time:this.currentTime,value:e})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(t){t&&this._previousKeyframe.set("easing",t);for(let[e,i]of this._globalTimelineStyles)this._backFill.set(e,i||xl),this._currentKeyframe.set(e,xl);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(t,e,i,r){e&&this._previousKeyframe.set("easing",e);let o=r&&r.params||{},d=lie(t,this._globalTimelineStyles);for(let[m,b]of d){let T=Rg(b,o,i);this._pendingStyles.set(m,T),this._localTimelineStyles.has(m)||this._backFill.set(m,this._globalTimelineStyles.get(m)??xl),this._updateStyle(m,T)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((t,e)=>{this._currentKeyframe.set(e,t)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((t,e)=>{this._currentKeyframe.has(e)||this._currentKeyframe.set(e,t)}))}snapshotCurrentStyles(){for(let[t,e]of this._localTimelineStyles)this._pendingStyles.set(t,e),this._updateStyle(t,e)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let t=[];for(let e in this._currentKeyframe)t.push(e);return t}mergeTimelineCollectedStyles(t){t._styleSummary.forEach((e,i)=>{let r=this._styleSummary.get(i);(!r||e.time>r.time)&&this._updateStyle(i,e.value)})}buildKeyframes(){this.applyStylesToKeyframe();let t=new Set,e=new Set,i=this._keyframes.size===1&&this.duration===0,r=[];this._keyframes.forEach((m,b)=>{let T=new Map([...this._backFill,...m]);T.forEach((A,N)=>{A===o0?t.add(N):A===xl&&e.add(N)}),i||T.set("offset",b/this.duration),r.push(T)});let o=[...t.values()],d=[...e.values()];if(i){let m=r[0],b=new Map(m);m.set("offset",0),b.set("offset",1),r=[m,b]}return HR(this.element,r,o,d,this.duration,this.startTime,this.easing,!1)}},FR=class extends mC{keyframes;preStyleProps;postStyleProps;_stretchStartingKeyframe;timings;constructor(t,e,i,r,o,d,m=!1){super(t,e,d.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=o,this._stretchStartingKeyframe=m,this.timings={duration:d.duration,delay:d.delay,easing:d.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let t=this.keyframes,{delay:e,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&e){let o=[],d=i+e,m=e/d,b=new Map(t[0]);b.set("offset",0),o.push(b);let T=new Map(t[0]);T.set("offset",l5(m)),o.push(T);let A=t.length-1;for(let N=1;N<=A;N++){let q=new Map(t[N]),J=q.get("offset"),K=e+J*i;q.set("offset",l5(K/d)),o.push(q)}i=d,e=0,r="",t=o}return HR(this.element,t,this.preStyleProps,this.postStyleProps,i,e,r,!0)}};function l5(n,t=3){let e=Math.pow(10,t-1);return Math.round(n*e)/e}function lie(n,t){let e=new Map,i;return n.forEach(r=>{if(r==="*"){i??=t.keys();for(let o of i)e.set(o,xl)}else for(let[o,d]of r)e.set(o,d)}),e}function c5(n,t,e,i,r,o,d,m,b,T,A,N,q){return{type:0,element:n,triggerName:t,isRemovalTransition:r,fromState:e,fromStyles:o,toState:i,toStyles:d,timelines:m,queriedElements:b,preStyleProps:T,postStyleProps:A,totalTime:N,errors:q}}var IR={},gC=class{_triggerName;ast;_stateStyles;constructor(t,e,i){this._triggerName=t,this.ast=e,this._stateStyles=i}match(t,e,i,r){return cie(this.ast.matchers,t,e,i,r)}buildStyles(t,e,i){let r=this._stateStyles.get("*");return t!==void 0&&(r=this._stateStyles.get(t?.toString())||r),r?r.buildStyles(e,i):new Map}build(t,e,i,r,o,d,m,b,T,A){let N=[],q=this.ast.options&&this.ast.options.params||IR,J=m&&m.params||IR,K=this.buildStyles(i,J,N),xe=b&&b.params||IR,Te=this.buildStyles(r,xe,N),Ge=new Set,Et=new Map,kt=new Map,Ue=r==="void",Oe={params:v5(xe,q),delay:this.ast.options?.delay},Qe=A?[]:y5(t,e,this.ast.animation,o,d,K,Te,Oe,T,N),ct=0;return Qe.forEach(bt=>{ct=Math.max(bt.duration+bt.delay,ct)}),N.length?c5(e,this._triggerName,i,r,Ue,K,Te,[],[],Et,kt,ct,N):(Qe.forEach(bt=>{let Gt=bt.element,Bt=zs(Et,Gt,new Set);bt.preStyleProps.forEach($n=>Bt.add($n));let jn=zs(kt,Gt,new Set);bt.postStyleProps.forEach($n=>jn.add($n)),Gt!==e&&Ge.add(Gt)}),c5(e,this._triggerName,i,r,Ue,K,Te,Qe,[...Ge.values()],Et,kt,ct))}};function cie(n,t,e,i,r){return n.some(o=>o(t,e,i,r))}function v5(n,t){let e=Be({},t);return Object.entries(n).forEach(([i,r])=>{r!=null&&(e[i]=r)}),e}var LR=class{styles;defaultParams;normalizer;constructor(t,e,i){this.styles=t,this.defaultParams=e,this.normalizer=i}buildStyles(t,e){let i=new Map,r=v5(t,this.defaultParams);return this.styles.styles.forEach(o=>{typeof o!="string"&&o.forEach((d,m)=>{d&&(d=Rg(d,r,e));let b=this.normalizer.normalizePropertyName(m,e);d=this.normalizer.normalizeStyleValue(m,b,d,e),i.set(m,d)})}),i}};function uie(n,t,e){return new BR(n,t,e)}var BR=class{name;ast;_normalizer;transitionFactories=[];fallbackTransition;states=new Map;constructor(t,e,i){this.name=t,this.ast=e,this._normalizer=i,e.states.forEach(r=>{let o=r.options&&r.options.params||{};this.states.set(r.name,new LR(r.style,o,i))}),u5(this.states,"true","1"),u5(this.states,"false","0"),e.transitions.forEach(r=>{this.transitionFactories.push(new gC(t,r,this.states))}),this.fallbackTransition=die(t,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(t,e,i,r){return this.transitionFactories.find(d=>d.match(t,e,i,r))||null}matchStyles(t,e,i){return this.fallbackTransition.buildStyles(t,e,i)}};function die(n,t,e){let i=[(d,m)=>!0],r={type:kn.Sequence,steps:[],options:null},o={type:kn.Transition,animation:r,matchers:i,options:null,queryCount:0,depCount:0};return new gC(n,o,t)}function u5(n,t,e){n.has(t)?n.has(e)||n.set(e,n.get(t)):n.has(e)&&n.set(t,n.get(e))}var hie=new u0,VR=class{bodyNode;_driver;_normalizer;_animations=new Map;_playersById=new Map;players=[];constructor(t,e,i){this.bodyNode=t,this._driver=e,this._normalizer=i}register(t,e){let i=[],r=[],o=_5(this._driver,e,i,r);if(i.length)throw G4(i);this._animations.set(t,o)}_buildPlayer(t,e,i){let r=t.element,o=vR(this._normalizer,t.keyframes,e,i);return this._driver.animate(r,o,t.duration,t.delay,t.easing,[],!0)}create(t,e,i={}){let r=[],o=this._animations.get(t),d,m=new Map;if(o?(d=y5(this._driver,e,o,CR,rC,new Map,new Map,i,hie,r),d.forEach(A=>{let N=zs(m,A.element,new Map);A.postStyleProps.forEach(q=>N.set(q,null))})):(r.push(q4()),d=[]),r.length)throw W4(r);m.forEach((A,N)=>{A.forEach((q,J)=>{A.set(J,this._driver.computeStyle(N,J,xl))})});let b=d.map(A=>{let N=m.get(A.element);return this._buildPlayer(A,new Map,N)}),T=xu(b);return this._playersById.set(t,T),T.onDestroy(()=>this.destroy(t)),this.players.push(T),T}destroy(t){let e=this._getPlayer(t);e.destroy(),this._playersById.delete(t);let i=this.players.indexOf(e);i>=0&&this.players.splice(i,1)}_getPlayer(t){let e=this._playersById.get(t);if(!e)throw Z4(t);return e}listen(t,e,i,r){let o=nC(e,"","","");return tC(this._getPlayer(t),i,o,r),()=>{}}command(t,e,i,r){if(i=="register"){this.register(t,r[0]);return}if(i=="create"){let d=r[0]||{};this.create(t,e,d);return}let o=this._getPlayer(t);switch(i){case"play":o.play();break;case"pause":o.pause();break;case"reset":o.reset();break;case"restart":o.restart();break;case"finish":o.finish();break;case"init":o.init();break;case"setPosition":o.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(t);break}}},d5="ng-animate-queued",fie=".ng-animate-queued",MR="ng-animate-disabled",pie=".ng-animate-disabled",mie="ng-star-inserted",gie=".ng-star-inserted",_ie=[],b5={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},yie={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Cl="__ng_removed",d0=class{namespaceId;value;options;get params(){return this.options.params}constructor(t,e=""){this.namespaceId=e;let i=t&&t.hasOwnProperty("value"),r=i?t.value:t;if(this.value=bie(r),i){let o=t,{value:d}=o,m=Ky(o,["value"]);this.options=m}else this.options={};this.options.params||(this.options.params={})}absorbOptions(t){let e=t.params;if(e){let i=this.options.params;Object.keys(e).forEach(r=>{i[r]==null&&(i[r]=e[r])})}}},c0="void",AR=new d0(c0),jR=class{id;hostElement;_engine;players=[];_triggers=new Map;_queue=[];_elementListeners=new Map;_hostClassName;constructor(t,e,i){this.id=t,this.hostElement=e,this._engine=i,this._hostClassName="ng-tns-"+t,ja(e,this._hostClassName)}listen(t,e,i,r){if(!this._triggers.has(e))throw K4(i,e);if(i==null||i.length==0)throw Y4(e);if(!wie(i))throw X4(i,e);let o=zs(this._elementListeners,t,[]),d={name:e,phase:i,callback:r};o.push(d);let m=zs(this._engine.statesByElement,t,new Map);return m.has(e)||(ja(t,s0),ja(t,s0+"-"+e),m.set(e,AR)),()=>{this._engine.afterFlush(()=>{let b=o.indexOf(d);b>=0&&o.splice(b,1),this._triggers.has(e)||m.delete(e)})}}register(t,e){return this._triggers.has(t)?!1:(this._triggers.set(t,e),!0)}_getTrigger(t){let e=this._triggers.get(t);if(!e)throw Q4(t);return e}trigger(t,e,i,r=!0){let o=this._getTrigger(e),d=new h0(this.id,e,t),m=this._engine.statesByElement.get(t);m||(ja(t,s0),ja(t,s0+"-"+e),this._engine.statesByElement.set(t,m=new Map));let b=m.get(e),T=new d0(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&b&&T.absorbOptions(b.options),m.set(e,T),b||(b=AR),!(T.value===c0)&&b.value===T.value){if(!Cie(b.params,T.params)){let xe=[],Te=o.matchStyles(b.value,b.params,xe),Ge=o.matchStyles(T.value,T.params,xe);xe.length?this._engine.reportError(xe):this._engine.afterFlush(()=>{Vd(t,Te),El(t,Ge)})}return}let q=zs(this._engine.playersByElement,t,[]);q.forEach(xe=>{xe.namespaceId==this.id&&xe.triggerName==e&&xe.queued&&xe.destroy()});let J=o.matchTransition(b.value,T.value,t,T.params),K=!1;if(!J){if(!r)return;J=o.fallbackTransition,K=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:e,transition:J,fromState:b,toState:T,player:d,isFallbackTransition:K}),K||(ja(t,d5),d.onStart(()=>{Pg(t,d5)})),d.onDone(()=>{let xe=this.players.indexOf(d);xe>=0&&this.players.splice(xe,1);let Te=this._engine.playersByElement.get(t);if(Te){let Ge=Te.indexOf(d);Ge>=0&&Te.splice(Ge,1)}}),this.players.push(d),q.push(d),d}deregister(t){this._triggers.delete(t),this._engine.statesByElement.forEach(e=>e.delete(t)),this._elementListeners.forEach((e,i)=>{this._elementListeners.set(i,e.filter(r=>r.name!=t))})}clearElementCache(t){this._engine.statesByElement.delete(t),this._elementListeners.delete(t);let e=this._engine.playersByElement.get(t);e&&(e.forEach(i=>i.destroy()),this._engine.playersByElement.delete(t))}_signalRemovalForInnerTriggers(t,e){let i=this._engine.driver.query(t,a0,!0);i.forEach(r=>{if(r[Cl])return;let o=this._engine.fetchNamespacesByElement(r);o.size?o.forEach(d=>d.triggerLeaveAnimation(r,e,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(t,e,i,r){let o=this._engine.statesByElement.get(t),d=new Map;if(o){let m=[];if(o.forEach((b,T)=>{if(d.set(T,b.value),this._triggers.has(T)){let A=this.trigger(t,T,c0,r);A&&m.push(A)}}),m.length)return this._engine.markElementAsRemoved(this.id,t,!0,e,d),i&&xu(m).onDone(()=>this._engine.processLeaveNode(t)),!0}return!1}prepareLeaveAnimationListeners(t){let e=this._elementListeners.get(t),i=this._engine.statesByElement.get(t);if(e&&i){let r=new Set;e.forEach(o=>{let d=o.name;if(r.has(d))return;r.add(d);let b=this._triggers.get(d).fallbackTransition,T=i.get(d)||AR,A=new d0(c0),N=new h0(this.id,d,t);this._engine.totalQueuedPlayers++,this._queue.push({element:t,triggerName:d,transition:b,fromState:T,toState:A,player:N,isFallbackTransition:!0})})}}removeNode(t,e){let i=this._engine;if(t.childElementCount&&this._signalRemovalForInnerTriggers(t,e),this.triggerLeaveAnimation(t,e,!0))return;let r=!1;if(i.totalAnimations){let o=i.players.length?i.playersByQueriedElement.get(t):[];if(o&&o.length)r=!0;else{let d=t;for(;d=d.parentNode;)if(i.statesByElement.get(d)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(t),r)i.markElementAsRemoved(this.id,t,!1,e);else{let o=t[Cl];(!o||o===b5)&&(i.afterFlush(()=>this.clearElementCache(t)),i.destroyInnerAnimations(t),i._onRemovalComplete(t,e))}}insertNode(t,e){ja(t,this._hostClassName)}drainQueuedTransitions(t){let e=[];return this._queue.forEach(i=>{let r=i.player;if(r.destroyed)return;let o=i.element,d=this._elementListeners.get(o);d&&d.forEach(m=>{if(m.name==i.triggerName){let b=nC(o,i.triggerName,i.fromState.value,i.toState.value);b._data=t,tC(i.player,m.phase,b,m.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):e.push(i)}),this._queue=[],e.sort((i,r)=>{let o=i.transition.ast.depCount,d=r.transition.ast.depCount;return o==0||d==0?o-d:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(t){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,t)}},zR=class{bodyNode;driver;_normalizer;players=[];newHostElements=new Map;playersByElement=new Map;playersByQueriedElement=new Map;statesByElement=new Map;disabledNodes=new Set;totalAnimations=0;totalQueuedPlayers=0;_namespaceLookup={};_namespaceList=[];_flushFns=[];_whenQuietFns=[];namespacesByHostElement=new Map;collectedEnterElements=[];collectedLeaveElements=[];onRemovalComplete=(t,e)=>{};_onRemovalComplete(t,e){this.onRemovalComplete(t,e)}constructor(t,e,i){this.bodyNode=t,this.driver=e,this._normalizer=i}get queuedPlayers(){let t=[];return this._namespaceList.forEach(e=>{e.players.forEach(i=>{i.queued&&t.push(i)})}),t}createNamespace(t,e){let i=new jR(t,e,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,e)?this._balanceNamespaceList(i,e):(this.newHostElements.set(e,i),this.collectEnterElement(e)),this._namespaceLookup[t]=i}_balanceNamespaceList(t,e){let i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let d=!1,m=this.driver.getParentElement(e);for(;m;){let b=r.get(m);if(b){let T=i.indexOf(b);i.splice(T+1,0,t),d=!0;break}m=this.driver.getParentElement(m)}d||i.unshift(t)}else i.push(t);return r.set(e,t),t}register(t,e){let i=this._namespaceLookup[t];return i||(i=this.createNamespace(t,e)),i}registerTrigger(t,e,i){let r=this._namespaceLookup[t];r&&r.register(e,i)&&this.totalAnimations++}destroy(t,e){t&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let i=this._fetchNamespace(t);this.namespacesByHostElement.delete(i.hostElement);let r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1),i.destroy(e),delete this._namespaceLookup[t]}))}_fetchNamespace(t){return this._namespaceLookup[t]}fetchNamespacesByElement(t){let e=new Set,i=this.statesByElement.get(t);if(i){for(let r of i.values())if(r.namespaceId){let o=this._fetchNamespace(r.namespaceId);o&&e.add(o)}}return e}trigger(t,e,i,r){if(uC(e)){let o=this._fetchNamespace(t);if(o)return o.trigger(e,i,r),!0}return!1}insertNode(t,e,i,r){if(!uC(e))return;let o=e[Cl];if(o&&o.setForRemoval){o.setForRemoval=!1,o.setForMove=!0;let d=this.collectedLeaveElements.indexOf(e);d>=0&&this.collectedLeaveElements.splice(d,1)}if(t){let d=this._fetchNamespace(t);d&&d.insertNode(e,i)}r&&this.collectEnterElement(e)}collectEnterElement(t){this.collectedEnterElements.push(t)}markElementAsDisabled(t,e){e?this.disabledNodes.has(t)||(this.disabledNodes.add(t),ja(t,MR)):this.disabledNodes.has(t)&&(this.disabledNodes.delete(t),Pg(t,MR))}removeNode(t,e,i){if(uC(e)){let r=t?this._fetchNamespace(t):null;r?r.removeNode(e,i):this.markElementAsRemoved(t,e,!1,i);let o=this.namespacesByHostElement.get(e);o&&o.id!==t&&o.removeNode(e,i)}else this._onRemovalComplete(e,i)}markElementAsRemoved(t,e,i,r,o){this.collectedLeaveElements.push(e),e[Cl]={namespaceId:t,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:o}}listen(t,e,i,r,o){return uC(e)?this._fetchNamespace(t).listen(e,i,r,o):()=>{}}_buildInstruction(t,e,i,r,o){return t.transition.build(this.driver,t.element,t.fromState.value,t.toState.value,i,r,t.fromState.options,t.toState.options,e,o)}destroyInnerAnimations(t){let e=this.driver.query(t,a0,!0);e.forEach(i=>this.destroyActiveAnimationsForElement(i)),this.playersByQueriedElement.size!=0&&(e=this.driver.query(t,oC,!0),e.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(t){let e=this.playersByElement.get(t);e&&e.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(t){let e=this.playersByQueriedElement.get(t);e&&e.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(t=>{if(this.players.length)return xu(this.players).onDone(()=>t());t()})}processLeaveNode(t){let e=t[Cl];if(e&&e.setForRemoval){if(t[Cl]=b5,e.namespaceId){this.destroyInnerAnimations(t);let i=this._fetchNamespace(e.namespaceId);i&&i.clearElementCache(t)}this._onRemovalComplete(t,e.setForRemoval)}t.classList?.contains(MR)&&this.markElementAsDisabled(t,!1),this.driver.query(t,pie,!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(t=-1){let e=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++){let r=this.collectedEnterElements[i];ja(r,mie)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let i=[];try{e=this._flushAnimations(i,t)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++){let r=this.collectedLeaveElements[i];this.processLeaveNode(r)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){let i=this._whenQuietFns;this._whenQuietFns=[],e.length?xu(e).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(t){throw J4(t)}_flushAnimations(t,e){let i=new u0,r=[],o=new Map,d=[],m=new Map,b=new Map,T=new Map,A=new Set;this.disabledNodes.forEach(Ct=>{A.add(Ct);let ft=this.driver.query(Ct,fie,!0);for(let Lt=0;Lt<ft.length;Lt++)A.add(ft[Lt])});let N=this.bodyNode,q=Array.from(this.statesByElement.keys()),J=p5(q,this.collectedEnterElements),K=new Map,xe=0;J.forEach((Ct,ft)=>{let Lt=CR+xe++;K.set(ft,Lt),Ct.forEach(hn=>ja(hn,Lt))});let Te=[],Ge=new Set,Et=new Set;for(let Ct=0;Ct<this.collectedLeaveElements.length;Ct++){let ft=this.collectedLeaveElements[Ct],Lt=ft[Cl];Lt&&Lt.setForRemoval&&(Te.push(ft),Ge.add(ft),Lt.hasAnimation?this.driver.query(ft,gie,!0).forEach(hn=>Ge.add(hn)):Et.add(ft))}let kt=new Map,Ue=p5(q,Array.from(Ge));Ue.forEach((Ct,ft)=>{let Lt=rC+xe++;kt.set(ft,Lt),Ct.forEach(hn=>ja(hn,Lt))}),t.push(()=>{J.forEach((Ct,ft)=>{let Lt=K.get(ft);Ct.forEach(hn=>Pg(hn,Lt))}),Ue.forEach((Ct,ft)=>{let Lt=kt.get(ft);Ct.forEach(hn=>Pg(hn,Lt))}),Te.forEach(Ct=>{this.processLeaveNode(Ct)})});let Oe=[],Qe=[];for(let Ct=this._namespaceList.length-1;Ct>=0;Ct--)this._namespaceList[Ct].drainQueuedTransitions(e).forEach(Lt=>{let hn=Lt.player,di=Lt.element;if(Oe.push(hn),this.collectedEnterElements.length){let mn=di[Cl];if(mn&&mn.setForMove){if(mn.previousTriggersValues&&mn.previousTriggersValues.has(Lt.triggerName)){let Ti=mn.previousTriggersValues.get(Lt.triggerName),Yn=this.statesByElement.get(Lt.element);if(Yn&&Yn.has(Lt.triggerName)){let Ar=Yn.get(Lt.triggerName);Ar.value=Ti,Yn.set(Lt.triggerName,Ar)}}hn.destroy();return}}let yr=!N||!this.driver.containsElement(N,di),_i=kt.get(di),cr=K.get(di),ln=this._buildInstruction(Lt,i,cr,_i,yr);if(ln.errors&&ln.errors.length){Qe.push(ln);return}if(yr){hn.onStart(()=>Vd(di,ln.fromStyles)),hn.onDestroy(()=>El(di,ln.toStyles)),r.push(hn);return}if(Lt.isFallbackTransition){hn.onStart(()=>Vd(di,ln.fromStyles)),hn.onDestroy(()=>El(di,ln.toStyles)),r.push(hn);return}let ls=[];ln.timelines.forEach(mn=>{mn.stretchStartingKeyframe=!0,this.disabledNodes.has(mn.element)||ls.push(mn)}),ln.timelines=ls,i.append(di,ln.timelines);let ur={instruction:ln,player:hn,element:di};d.push(ur),ln.queriedElements.forEach(mn=>zs(m,mn,[]).push(hn)),ln.preStyleProps.forEach((mn,Ti)=>{if(mn.size){let Yn=b.get(Ti);Yn||b.set(Ti,Yn=new Set),mn.forEach((Ar,Fl)=>Yn.add(Fl))}}),ln.postStyleProps.forEach((mn,Ti)=>{let Yn=T.get(Ti);Yn||T.set(Ti,Yn=new Set),mn.forEach((Ar,Fl)=>Yn.add(Fl))})});if(Qe.length){let Ct=[];Qe.forEach(ft=>{Ct.push(e5(ft.triggerName,ft.errors))}),Oe.forEach(ft=>ft.destroy()),this.reportError(Ct)}let ct=new Map,bt=new Map;d.forEach(Ct=>{let ft=Ct.element;i.has(ft)&&(bt.set(ft,ft),this._beforeAnimationBuild(Ct.player.namespaceId,Ct.instruction,ct))}),r.forEach(Ct=>{let ft=Ct.element;this._getPreviousPlayers(ft,!1,Ct.namespaceId,Ct.triggerName,null).forEach(hn=>{zs(ct,ft,[]).push(hn),hn.destroy()})});let Gt=Te.filter(Ct=>m5(Ct,b,T)),Bt=new Map;f5(Bt,this.driver,Et,T,xl).forEach(Ct=>{m5(Ct,b,T)&&Gt.push(Ct)});let $n=new Map;J.forEach((Ct,ft)=>{f5($n,this.driver,new Set(Ct),b,o0)}),Gt.forEach(Ct=>{let ft=Bt.get(Ct),Lt=$n.get(Ct);Bt.set(Ct,new Map([...ft?.entries()??[],...Lt?.entries()??[]]))});let Ji=[],Ao=[],zn={};d.forEach(Ct=>{let{element:ft,player:Lt,instruction:hn}=Ct;if(i.has(ft)){if(A.has(ft)){Lt.onDestroy(()=>El(ft,hn.toStyles)),Lt.disabled=!0,Lt.overrideTotalTime(hn.totalTime),r.push(Lt);return}let di=zn;if(bt.size>1){let _i=ft,cr=[];for(;_i=_i.parentNode;){let ln=bt.get(_i);if(ln){di=ln;break}cr.push(_i)}cr.forEach(ln=>bt.set(ln,di))}let yr=this._buildAnimation(Lt.namespaceId,hn,ct,o,$n,Bt);if(Lt.setRealPlayer(yr),di===zn)Ji.push(Lt);else{let _i=this.playersByElement.get(di);_i&&_i.length&&(Lt.parentPlayer=xu(_i)),r.push(Lt)}}else Vd(ft,hn.fromStyles),Lt.onDestroy(()=>El(ft,hn.toStyles)),Ao.push(Lt),A.has(ft)&&r.push(Lt)}),Ao.forEach(Ct=>{let ft=o.get(Ct.element);if(ft&&ft.length){let Lt=xu(ft);Ct.setRealPlayer(Lt)}}),r.forEach(Ct=>{Ct.parentPlayer?Ct.syncPlayerEvents(Ct.parentPlayer):Ct.destroy()});for(let Ct=0;Ct<Te.length;Ct++){let ft=Te[Ct],Lt=ft[Cl];if(Pg(ft,rC),Lt&&Lt.hasAnimation)continue;let hn=[];if(m.size){let yr=m.get(ft);yr&&yr.length&&hn.push(...yr);let _i=this.driver.query(ft,oC,!0);for(let cr=0;cr<_i.length;cr++){let ln=m.get(_i[cr]);ln&&ln.length&&hn.push(...ln)}}let di=hn.filter(yr=>!yr.destroyed);di.length?xie(this,ft,di):this.processLeaveNode(ft)}return Te.length=0,Ji.forEach(Ct=>{this.players.push(Ct),Ct.onDone(()=>{Ct.destroy();let ft=this.players.indexOf(Ct);this.players.splice(ft,1)}),Ct.play()}),Ji}afterFlush(t){this._flushFns.push(t)}afterFlushAnimationsDone(t){this._whenQuietFns.push(t)}_getPreviousPlayers(t,e,i,r,o){let d=[];if(e){let m=this.playersByQueriedElement.get(t);m&&(d=m)}else{let m=this.playersByElement.get(t);if(m){let b=!o||o==c0;m.forEach(T=>{T.queued||!b&&T.triggerName!=r||d.push(T)})}}return(i||r)&&(d=d.filter(m=>!(i&&i!=m.namespaceId||r&&r!=m.triggerName))),d}_beforeAnimationBuild(t,e,i){let r=e.triggerName,o=e.element,d=e.isRemovalTransition?void 0:t,m=e.isRemovalTransition?void 0:r;for(let b of e.timelines){let T=b.element,A=T!==o,N=zs(i,T,[]);this._getPreviousPlayers(T,A,d,m,e.toState).forEach(J=>{let K=J.getRealPlayer();K.beforeDestroy&&K.beforeDestroy(),J.destroy(),N.push(J)})}Vd(o,e.fromStyles)}_buildAnimation(t,e,i,r,o,d){let m=e.triggerName,b=e.element,T=[],A=new Set,N=new Set,q=e.timelines.map(K=>{let xe=K.element;A.add(xe);let Te=xe[Cl];if(Te&&Te.removedBeforeQueried)return new wu(K.duration,K.delay);let Ge=xe!==b,Et=Eie((i.get(xe)||_ie).map(ct=>ct.getRealPlayer())).filter(ct=>{let bt=ct;return bt.element?bt.element===xe:!1}),kt=o.get(xe),Ue=d.get(xe),Oe=vR(this._normalizer,K.keyframes,kt,Ue),Qe=this._buildPlayer(K,Oe,Et);if(K.subTimeline&&r&&N.add(xe),Ge){let ct=new h0(t,m,xe);ct.setRealPlayer(Qe),T.push(ct)}return Qe});T.forEach(K=>{zs(this.playersByQueriedElement,K.element,[]).push(K),K.onDone(()=>vie(this.playersByQueriedElement,K.element,K))}),A.forEach(K=>ja(K,TR));let J=xu(q);return J.onDestroy(()=>{A.forEach(K=>Pg(K,TR)),El(b,e.toStyles)}),N.forEach(K=>{zs(r,K,[]).push(J)}),J}_buildPlayer(t,e,i){return e.length>0?this.driver.animate(t.element,e,t.duration,t.delay,t.easing,i):new wu(t.duration,t.delay)}},h0=class{namespaceId;triggerName;element;_player=new wu;_containsRealPlayer=!1;_queuedCallbacks=new Map;destroyed=!1;parentPlayer=null;markedForDestroy=!1;disabled=!1;queued=!0;totalTime=0;constructor(t,e,i){this.namespaceId=t,this.triggerName=e,this.element=i}setRealPlayer(t){this._containsRealPlayer||(this._player=t,this._queuedCallbacks.forEach((e,i)=>{e.forEach(r=>tC(t,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(t.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(t){this.totalTime=t}syncPlayerEvents(t){let e=this._player;e.triggerCallback&&t.onStart(()=>e.triggerCallback("start")),t.onDone(()=>this.finish()),t.onDestroy(()=>this.destroy())}_queueEvent(t,e){zs(this._queuedCallbacks,t,[]).push(e)}onDone(t){this.queued&&this._queueEvent("done",t),this._player.onDone(t)}onStart(t){this.queued&&this._queueEvent("start",t),this._player.onStart(t)}onDestroy(t){this.queued&&this._queueEvent("destroy",t),this._player.onDestroy(t)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(t){this.queued||this._player.setPosition(t)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(t){let e=this._player;e.triggerCallback&&e.triggerCallback(t)}};function vie(n,t,e){let i=n.get(t);if(i){if(i.length){let r=i.indexOf(e);i.splice(r,1)}i.length==0&&n.delete(t)}return i}function bie(n){return n??null}function uC(n){return n&&n.nodeType===1}function wie(n){return n=="start"||n=="done"}function h5(n,t){let e=n.style.display;return n.style.display=t??"none",e}function f5(n,t,e,i,r){let o=[];e.forEach(b=>o.push(h5(b)));let d=[];i.forEach((b,T)=>{let A=new Map;b.forEach(N=>{let q=t.computeStyle(T,N,r);A.set(N,q),(!q||q.length==0)&&(T[Cl]=yie,d.push(T))}),n.set(T,A)});let m=0;return e.forEach(b=>h5(b,o[m++])),d}function p5(n,t){let e=new Map;if(n.forEach(m=>e.set(m,[])),t.length==0)return e;let i=1,r=new Set(t),o=new Map;function d(m){if(!m)return i;let b=o.get(m);if(b)return b;let T=m.parentNode;return e.has(T)?b=T:r.has(T)?b=i:b=d(T),o.set(m,b),b}return t.forEach(m=>{let b=d(m);b!==i&&e.get(b).push(m)}),e}function ja(n,t){n.classList?.add(t)}function Pg(n,t){n.classList?.remove(t)}function xie(n,t,e){xu(e).onDone(()=>n.processLeaveNode(t))}function Eie(n){let t=[];return w5(n,t),t}function w5(n,t){for(let e=0;e<n.length;e++){let i=n[e];i instanceof Ag?w5(i.players,t):t.push(i)}}function Cie(n,t){let e=Object.keys(n),i=Object.keys(t);if(e.length!=i.length)return!1;for(let r=0;r<e.length;r++){let o=e[r];if(!t.hasOwnProperty(o)||n[o]!==t[o])return!1}return!0}function m5(n,t,e){let i=e.get(n);if(!i)return!1;let r=t.get(n);return r?i.forEach(o=>r.add(o)):t.set(n,i),e.delete(n),!0}var Ng=class{_driver;_normalizer;_transitionEngine;_timelineEngine;_triggerCache={};onRemovalComplete=(t,e)=>{};constructor(t,e,i){this._driver=e,this._normalizer=i,this._transitionEngine=new zR(t.body,e,i),this._timelineEngine=new VR(t.body,e,i),this._transitionEngine.onRemovalComplete=(r,o)=>this.onRemovalComplete(r,o)}registerTrigger(t,e,i,r,o){let d=t+"-"+r,m=this._triggerCache[d];if(!m){let b=[],T=[],A=_5(this._driver,o,b,T);if(b.length)throw H4(r,b);m=uie(r,A,this._normalizer),this._triggerCache[d]=m}this._transitionEngine.registerTrigger(e,r,m)}register(t,e){this._transitionEngine.register(t,e)}destroy(t,e){this._transitionEngine.destroy(t,e)}onInsert(t,e,i,r){this._transitionEngine.insertNode(t,e,i,r)}onRemove(t,e,i){this._transitionEngine.removeNode(t,e,i)}disableAnimations(t,e){this._transitionEngine.markElementAsDisabled(t,e)}process(t,e,i,r){if(i.charAt(0)=="@"){let[o,d]=bR(i),m=r;this._timelineEngine.command(o,e,d,m)}else this._transitionEngine.trigger(t,e,i,r)}listen(t,e,i,r,o){if(i.charAt(0)=="@"){let[d,m]=bR(i);return this._timelineEngine.listen(d,e,m,o)}return this._transitionEngine.listen(t,e,i,r,o)}flush(t=-1){this._transitionEngine.flush(t)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(t){this._transitionEngine.afterFlushAnimationsDone(t)}};function Tie(n,t){let e=null,i=null;return Array.isArray(t)&&t.length?(e=kR(t[0]),t.length>1&&(i=kR(t[t.length-1]))):t instanceof Map&&(e=kR(t)),e||i?new Sie(n,e,i):null}var Sie=(()=>{class n{_element;_startStyles;_endStyles;static initialStylesByElement=new WeakMap;_state=0;_initialStyles;constructor(e,i,r){this._element=e,this._startStyles=i,this._endStyles=r;let o=n.initialStylesByElement.get(e);o||n.initialStylesByElement.set(e,o=new Map),this._initialStyles=o}start(){this._state<1&&(this._startStyles&&El(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(El(this._element,this._initialStyles),this._endStyles&&(El(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(Vd(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Vd(this._element,this._endStyles),this._endStyles=null),El(this._element,this._initialStyles),this._state=3)}}return n})();function kR(n){let t=null;return n.forEach((e,i)=>{Die(i)&&(t=t||new Map,t.set(i,e))}),t}function Die(n){return n==="display"||n==="position"}var _C=class{element;keyframes;options;_specialStyles;_onDoneFns=[];_onStartFns=[];_onDestroyFns=[];_duration;_delay;_initialized=!1;_finished=!1;_started=!1;_destroyed=!1;_finalKeyframe;_originalOnDoneFns=[];_originalOnStartFns=[];domPlayer=null;time=0;parentPlayer=null;currentSnapshot=new Map;constructor(t,e,i,r){this.element=t,this.keyframes=e,this.options=i,this._specialStyles=r,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(t=>t()),this._onDoneFns=[])}init(){this._buildPlayer()&&this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return this.domPlayer;this._initialized=!0;let t=this.keyframes,e=this._triggerWebAnimation(this.element,t,this.options);if(!e)return this._onFinish(),null;this.domPlayer=e,this._finalKeyframe=t.length?t[t.length-1]:new Map;let i=()=>this._onFinish();return e.addEventListener("finish",i),this.onDestroy(()=>{e.removeEventListener("finish",i)}),e}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer?.pause()}_convertKeyframesToObject(t){let e=[];return t.forEach(i=>{e.push(Object.fromEntries(i))}),e}_triggerWebAnimation(t,e,i){let r=this._convertKeyframesToObject(e);try{return t.animate(r,i)}catch(o){return null}}onStart(t){this._originalOnStartFns.push(t),this._onStartFns.push(t)}onDone(t){this._originalOnDoneFns.push(t),this._onDoneFns.push(t)}onDestroy(t){this._onDestroyFns.push(t)}play(){let t=this._buildPlayer();t&&(this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),t.play())}pause(){this.init(),this.domPlayer?.pause()}finish(){this.init(),this.domPlayer&&(this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish())}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer?.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(t=>t()),this._onDestroyFns=[])}setPosition(t){this.domPlayer||this.init(),this.domPlayer&&(this.domPlayer.currentTime=t*this.time)}getPosition(){return this.domPlayer?+(this.domPlayer.currentTime??0)/this.time:this._initialized?1:0}get totalTime(){return this._delay+this._duration}beforeDestroy(){let t=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{r!=="offset"&&t.set(r,this._finished?i:aC(this.element,r))}),this.currentSnapshot=t}triggerCallback(t){let e=t==="start"?this._onStartFns:this._onDoneFns;e.forEach(i=>i()),e.length=0}},yC=class{validateStyleProperty(t){return!0}validateAnimatableStyleProperty(t){return!0}containsElement(t,e){return wR(t,e)}getParentElement(t){return iC(t)}query(t,e,i){return xR(t,e,i)}computeStyle(t,e,i){return aC(t,e)}animate(t,e,i,r,o,d=[]){let m=r==0?"both":"forwards",b={duration:i,delay:r,fill:m};o&&(b.easing=o);let T=new Map,A=d.filter(J=>J instanceof _C);r5(i,r)&&A.forEach(J=>{J.currentSnapshot.forEach((K,xe)=>T.set(xe,K))});let N=n5(e).map(J=>new Map(J));N=o5(t,N,T);let q=Tie(t,N);return new _C(t,N,b,q)}};var dC="@",x5="@.disabled",vC=class{namespaceId;delegate;engine;_onDestroy;\u0275type=0;constructor(t,e,i,r){this.namespaceId=t,this.delegate=e,this.engine=i,this._onDestroy=r}get data(){return this.delegate.data}destroyNode(t){this.delegate.destroyNode?.(t)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(t,e){return this.delegate.createElement(t,e)}createComment(t){return this.delegate.createComment(t)}createText(t){return this.delegate.createText(t)}appendChild(t,e){this.delegate.appendChild(t,e),this.engine.onInsert(this.namespaceId,e,t,!1)}insertBefore(t,e,i,r=!0){this.delegate.insertBefore(t,e,i),this.engine.onInsert(this.namespaceId,e,t,r)}removeChild(t,e,i,r){if(r){this.delegate.removeChild(t,e,i,r);return}this.parentNode(e)&&this.engine.onRemove(this.namespaceId,e,this.delegate)}selectRootElement(t,e){return this.delegate.selectRootElement(t,e)}parentNode(t){return this.delegate.parentNode(t)}nextSibling(t){return this.delegate.nextSibling(t)}setAttribute(t,e,i,r){this.delegate.setAttribute(t,e,i,r)}removeAttribute(t,e,i){this.delegate.removeAttribute(t,e,i)}addClass(t,e){this.delegate.addClass(t,e)}removeClass(t,e){this.delegate.removeClass(t,e)}setStyle(t,e,i,r){this.delegate.setStyle(t,e,i,r)}removeStyle(t,e,i){this.delegate.removeStyle(t,e,i)}setProperty(t,e,i){e.charAt(0)==dC&&e==x5?this.disableAnimations(t,!!i):this.delegate.setProperty(t,e,i)}setValue(t,e){this.delegate.setValue(t,e)}listen(t,e,i,r){return this.delegate.listen(t,e,i,r)}disableAnimations(t,e){this.engine.disableAnimations(t,e)}},UR=class extends vC{factory;constructor(t,e,i,r,o){super(e,i,r,o),this.factory=t,this.namespaceId=e}setProperty(t,e,i){e.charAt(0)==dC?e.charAt(1)=="."&&e==x5?(i=i===void 0?!0:!!i,this.disableAnimations(t,i)):this.engine.process(this.namespaceId,t,e.slice(1),i):this.delegate.setProperty(t,e,i)}listen(t,e,i,r){if(e.charAt(0)==dC){let o=Iie(t),d=e.slice(1),m="";return d.charAt(0)!=dC&&([d,m]=Mie(d)),this.engine.listen(this.namespaceId,o,d,m,b=>{let T=b._data||-1;this.factory.scheduleListenerCallback(T,i,b)})}return this.delegate.listen(t,e,i,r)}};function Iie(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}function Mie(n){let t=n.indexOf("."),e=n.substring(0,t),i=n.slice(t+1);return[e,i]}var bC=class{delegate;engine;_zone;_currentId=0;_microtaskId=1;_animationCallbacksBuffer=[];_rendererCache=new Map;_cdRecurDepth=0;constructor(t,e,i){this.delegate=t,this.engine=e,this._zone=i,e.onRemovalComplete=(r,o)=>{o?.removeChild(null,r)}}createRenderer(t,e){let r=this.delegate.createRenderer(t,e);if(!t||!e?.data?.animation){let T=this._rendererCache,A=T.get(r);if(!A){let N=()=>T.delete(r);A=new vC("",r,this.engine,N),T.set(r,A)}return A}let o=e.id,d=e.id+"-"+this._currentId;this._currentId++,this.engine.register(d,t);let m=T=>{Array.isArray(T)?T.forEach(m):this.engine.registerTrigger(o,d,t,T.name,T)};return e.data.animation.forEach(m),new UR(this,d,r,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(t,e,i){if(t>=0&&t<this._microtaskId){this._zone.run(()=>e(i));return}let r=this._animationCallbacksBuffer;r.length==0&&queueMicrotask(()=>{this._zone.run(()=>{r.forEach(o=>{let[d,m]=o;d(m)}),this._animationCallbacksBuffer=[]})}),r.push([e,i])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}componentReplaced(t){this.engine.flush(),this.delegate.componentReplaced?.(t)}};var kie=(()=>{class n extends Ng{constructor(e,i,r){super(e,i,r)}ngOnDestroy(){this.flush()}static \u0275fac=function(i){return new(i||n)(vt(Ht),vt(Qf),vt(Jf))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})();function Rie(){return new hC}function Pie(){return new bC(se(t0),se(Ng),se(jt))}var E5=[{provide:Jf,useFactory:Rie},{provide:Ng,useClass:kie},{provide:pr,useFactory:Pie}],N2e=[{provide:Qf,useClass:$R},{provide:Od,useValue:"NoopAnimations"},...E5],Nie=[{provide:Qf,useFactory:()=>new yC},{provide:Od,useFactory:()=>"BrowserAnimations"},...E5];function C5(){return ca("NgEagerAnimations"),[...Nie]}var vn="primary",x0=Symbol("RouteTitle"),KR=class{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){let e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function np(n){return new KR(n)}function GR(n,t,e){for(let i=0;i<n.length;i++){let r=n[i],o=t[i];if(r[0]===":")e[r.substring(1)]=o;else if(r!==o.path)return!1}return!0}function P5(n,t,e){let i=e.path.split("/"),r=i.indexOf("**");if(r===-1){if(i.length>n.length||e.pathMatch==="full"&&(t.hasChildren()||i.length<n.length))return null;let b={},T=n.slice(0,i.length);return GR(i,T,b)?{consumed:T,posParams:b}:null}if(r!==i.lastIndexOf("**"))return null;let o=i.slice(0,r),d=i.slice(r+1);if(o.length+d.length>n.length||e.pathMatch==="full"&&t.hasChildren()&&e.path!=="**")return null;let m={};return!GR(o,n.slice(0,o.length),m)||!GR(d,n.slice(n.length-d.length),m)?null:{consumed:n,posParams:m}}function SC(n){return new Promise((t,e)=>{n.pipe(su()).subscribe({next:i=>t(i),error:i=>e(i)})})}function Oie(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;++e)if(!pc(n[e],t[e]))return!1;return!0}function pc(n,t){let e=n?YR(n):void 0,i=t?YR(t):void 0;if(!e||!i||e.length!=i.length)return!1;let r;for(let o=0;o<e.length;o++)if(r=e[o],!N5(n[r],t[r]))return!1;return!0}function YR(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function N5(n,t){if(Array.isArray(n)&&Array.isArray(t)){if(n.length!==t.length)return!1;let e=[...n].sort(),i=[...t].sort();return e.every((r,o)=>i[o]===r)}else return n===t}function Fie(n){return n.length>0?n[n.length-1]:null}function rp(n){return rv(n)?n:Ld(n)?Bi(Promise.resolve(n)):Jt(n)}function O5(n){return rv(n)?SC(n):Promise.resolve(n)}var Lie={exact:L5,subset:B5},F5={exact:Bie,subset:Vie,ignored:()=>!0};function uP(n,t,e){let i=n instanceof fa?n:t.parseUrl(n);return xi(()=>XR(t.lastSuccessfulNavigation()?.finalUrl??new fa,i,e))}function XR(n,t,e){return Lie[e.paths](n.root,t.root,e.matrixParams)&&F5[e.queryParams](n.queryParams,t.queryParams)&&!(e.fragment==="exact"&&n.fragment!==t.fragment)}function Bie(n,t){return pc(n,t)}function L5(n,t,e){if(!ep(n.segments,t.segments)||!EC(n.segments,t.segments,e)||n.numberOfChildren!==t.numberOfChildren)return!1;for(let i in t.children)if(!n.children[i]||!L5(n.children[i],t.children[i],e))return!1;return!0}function Vie(n,t){return Object.keys(t).length<=Object.keys(n).length&&Object.keys(t).every(e=>N5(n[e],t[e]))}function B5(n,t,e){return V5(n,t,t.segments,e)}function V5(n,t,e,i){if(n.segments.length>e.length){let r=n.segments.slice(0,e.length);return!(!ep(r,e)||t.hasChildren()||!EC(r,e,i))}else if(n.segments.length===e.length){if(!ep(n.segments,e)||!EC(n.segments,e,i))return!1;for(let r in t.children)if(!n.children[r]||!B5(n.children[r],t.children[r],i))return!1;return!0}else{let r=e.slice(0,n.segments.length),o=e.slice(n.segments.length);return!ep(n.segments,r)||!EC(n.segments,r,i)||!n.children[vn]?!1:V5(n.children[vn],t,o,i)}}function EC(n,t,e){return t.every((i,r)=>F5[e](n[r].parameters,i.parameters))}var fa=class{root;queryParams;fragment;_queryParamMap;constructor(t=new Qn([],{}),e={},i=null){this.root=t,this.queryParams=e,this.fragment=i}get queryParamMap(){return this._queryParamMap??=np(this.queryParams),this._queryParamMap}toString(){return Uie.serialize(this)}},Qn=class{segments;children;parent=null;constructor(t,e){this.segments=t,this.children=e,Object.values(e).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return CC(this)}},jd=class{path;parameters;_parameterMap;constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap??=np(this.parameters),this._parameterMap}toString(){return z5(this)}};function jie(n,t){return ep(n,t)&&n.every((e,i)=>pc(e.parameters,t[i].parameters))}function ep(n,t){return n.length!==t.length?!1:n.every((e,i)=>e.path===t[i].path)}function zie(n,t){let e=[];return Object.entries(n.children).forEach(([i,r])=>{i===vn&&(e=e.concat(t(r,i)))}),Object.entries(n.children).forEach(([i,r])=>{i!==vn&&(e=e.concat(t(r,i)))}),e}var op=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>new Cu,providedIn:"root"})}return n})(),Cu=class{parse(t){let e=new JR(t);return new fa(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){let e=`/${f0(t.root,!0)}`,i=Gie(t.queryParams),r=typeof t.fragment=="string"?`#${$ie(t.fragment)}`:"";return`${e}${i}${r}`}},Uie=new Cu;function CC(n){return n.segments.map(t=>z5(t)).join("/")}function f0(n,t){if(!n.hasChildren())return CC(n);if(t){let e=n.children[vn]?f0(n.children[vn],!1):"",i=[];return Object.entries(n.children).forEach(([r,o])=>{r!==vn&&i.push(`${r}:${f0(o,!1)}`)}),i.length>0?`${e}(${i.join("//")})`:e}else{let e=zie(n,(i,r)=>r===vn?[f0(n.children[vn],!1)]:[`${r}:${f0(i,!1)}`]);return Object.keys(n.children).length===1&&n.children[vn]!=null?`${CC(n)}/${e[0]}`:`${CC(n)}/(${e.join("//")})`}}function j5(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function wC(n){return j5(n).replace(/%3B/gi,";")}function $ie(n){return encodeURI(n)}function QR(n){return j5(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function TC(n){return decodeURIComponent(n)}function T5(n){return TC(n.replace(/\+/g,"%20"))}function z5(n){return`${QR(n.path)}${Hie(n.parameters)}`}function Hie(n){return Object.entries(n).map(([t,e])=>`;${QR(t)}=${QR(e)}`).join("")}function Gie(n){let t=Object.entries(n).map(([e,i])=>Array.isArray(i)?i.map(r=>`${wC(e)}=${wC(r)}`).join("&"):`${wC(e)}=${wC(i)}`).filter(e=>e);return t.length?`?${t.join("&")}`:""}var qie=/^[^\/()?;#]+/;function qR(n){let t=n.match(qie);return t?t[0]:""}var Wie=/^[^\/()?;=#]+/;function Zie(n){let t=n.match(Wie);return t?t[0]:""}var Kie=/^[^=?&#]+/;function Yie(n){let t=n.match(Kie);return t?t[0]:""}var Xie=/^[^&#]+/;function Qie(n){let t=n.match(Xie);return t?t[0]:""}var JR=class{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Qn([],{}):new Qn([],this.parseChildren())}parseQueryParams(){let t={};if(this.consumeOptional("?"))do this.parseQueryParam(t);while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(i[vn]=new Qn(t,e)),i}parseSegment(){let t=qR(this.remaining);if(t===""&&this.peekStartsWith(";"))throw new Je(4009,!1);return this.capture(t),new jd(TC(t),this.parseMatrixParams())}parseMatrixParams(){let t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){let e=Zie(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let r=qR(this.remaining);r&&(i=r,this.capture(i))}t[TC(e)]=TC(i)}parseQueryParam(t){let e=Yie(this.remaining);if(!e)return;this.capture(e);let i="";if(this.consumeOptional("=")){let d=Qie(this.remaining);d&&(i=d,this.capture(i))}let r=T5(e),o=T5(i);if(t.hasOwnProperty(r)){let d=t[r];Array.isArray(d)||(d=[d],t[r]=d),d.push(o)}else t[r]=o}parseParens(t){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let i=qR(this.remaining),r=this.remaining[i.length];if(r!=="/"&&r!==")"&&r!==";")throw new Je(4010,!1);let o;i.indexOf(":")>-1?(o=i.slice(0,i.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=vn);let d=this.parseChildren();e[o??vn]=Object.keys(d).length===1&&d[vn]?d[vn]:new Qn([],d),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return this.peekStartsWith(t)?(this.remaining=this.remaining.substring(t.length),!0):!1}capture(t){if(!this.consumeOptional(t))throw new Je(4011,!1)}};function U5(n){return n.segments.length>0?new Qn([],{[vn]:n}):n}function $5(n){let t={};for(let[i,r]of Object.entries(n.children)){let o=$5(r);if(i===vn&&o.segments.length===0&&o.hasChildren())for(let[d,m]of Object.entries(o.children))t[d]=m;else(o.segments.length>0||o.hasChildren())&&(t[i]=o)}let e=new Qn(n.segments,t);return Jie(e)}function Jie(n){if(n.numberOfChildren===1&&n.children[vn]){let t=n.children[vn];return new Qn(n.segments.concat(t.segments),t.children)}return n}function zd(n){return n instanceof fa}function H5(n,t,e=null,i=null,r=new Cu){let o=G5(n);return q5(o,t,e,i,r)}function G5(n){let t;function e(o){let d={};for(let b of o.children){let T=e(b);d[b.outlet]=T}let m=new Qn(o.url,d);return o===n&&(t=m),m}let i=e(n.root),r=U5(i);return t??r}function q5(n,t,e,i,r){let o=n;for(;o.parent;)o=o.parent;if(t.length===0)return WR(o,o,o,e,i,r);let d=ere(t);if(d.toRoot())return WR(o,o,new Qn([],{}),e,i,r);let m=tre(d,o,n),b=m.processChildren?m0(m.segmentGroup,m.index,d.commands):Z5(m.segmentGroup,m.index,d.commands);return WR(o,m.segmentGroup,b,e,i,r)}function DC(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function _0(n){return typeof n=="object"&&n!=null&&n.outlets}function S5(n,t,e){n||="\u0275";let i=new fa;return i.queryParams={[n]:t},e.parse(e.serialize(i)).queryParams[n]}function WR(n,t,e,i,r,o){let d={};for(let[T,A]of Object.entries(i??{}))d[T]=Array.isArray(A)?A.map(N=>S5(T,N,o)):S5(T,A,o);let m;n===t?m=e:m=W5(n,t,e);let b=U5($5(m));return new fa(b,d,r)}function W5(n,t,e){let i={};return Object.entries(n.children).forEach(([r,o])=>{o===t?i[r]=e:i[r]=W5(o,t,e)}),new Qn(n.segments,i)}var IC=class{isAbsolute;numberOfDoubleDots;commands;constructor(t,e,i){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=i,t&&i.length>0&&DC(i[0]))throw new Je(4003,!1);let r=i.find(_0);if(r&&r!==Fie(i))throw new Je(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ere(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new IC(!0,0,n);let t=0,e=!1,i=n.reduce((r,o,d)=>{if(typeof o=="object"&&o!=null){if(o.outlets){let m={};return Object.entries(o.outlets).forEach(([b,T])=>{m[b]=typeof T=="string"?T.split("/"):T}),[...r,{outlets:m}]}if(o.segmentPath)return[...r,o.segmentPath]}return typeof o!="string"?[...r,o]:d===0?(o.split("/").forEach((m,b)=>{b==0&&m==="."||(b==0&&m===""?e=!0:m===".."?t++:m!=""&&r.push(m))}),r):[...r,o]},[]);return new IC(e,t,i)}var Fg=class{segmentGroup;processChildren;index;constructor(t,e,i){this.segmentGroup=t,this.processChildren=e,this.index=i}};function tre(n,t,e){if(n.isAbsolute)return new Fg(t,!0,0);if(!e)return new Fg(t,!1,NaN);if(e.parent===null)return new Fg(e,!0,0);let i=DC(n.commands[0])?0:1,r=e.segments.length-1+i;return nre(e,r,n.numberOfDoubleDots)}function nre(n,t,e){let i=n,r=t,o=e;for(;o>r;){if(o-=r,i=i.parent,!i)throw new Je(4005,!1);r=i.segments.length}return new Fg(i,!1,r-o)}function ire(n){return _0(n[0])?n[0].outlets:{[vn]:n}}function Z5(n,t,e){if(n??=new Qn([],{}),n.segments.length===0&&n.hasChildren())return m0(n,t,e);let i=rre(n,t,e),r=e.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){let o=new Qn(n.segments.slice(0,i.pathIndex),{});return o.children[vn]=new Qn(n.segments.slice(i.pathIndex),n.children),m0(o,0,r)}else return i.match&&r.length===0?new Qn(n.segments,{}):i.match&&!n.hasChildren()?eP(n,t,e):i.match?m0(n,0,r):eP(n,t,e)}function m0(n,t,e){if(e.length===0)return new Qn(n.segments,{});{let i=ire(e),r={};if(Object.keys(i).some(o=>o!==vn)&&n.children[vn]&&n.numberOfChildren===1&&n.children[vn].segments.length===0){let o=m0(n.children[vn],t,e);return new Qn(n.segments,o.children)}return Object.entries(i).forEach(([o,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(r[o]=Z5(n.children[o],t,d))}),Object.entries(n.children).forEach(([o,d])=>{i[o]===void 0&&(r[o]=d)}),new Qn(n.segments,r)}}function rre(n,t,e){let i=0,r=t,o={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=e.length)return o;let d=n.segments[r],m=e[i];if(_0(m))break;let b=`${m}`,T=i<e.length-1?e[i+1]:null;if(r>0&&b===void 0)break;if(b&&T&&typeof T=="object"&&T.outlets===void 0){if(!I5(b,T,d))return o;i+=2}else{if(!I5(b,{},d))return o;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}function eP(n,t,e){let i=n.segments.slice(0,t),r=0;for(;r<e.length;){let o=e[r];if(_0(o)){let b=ore(o.outlets);return new Qn(i,b)}if(r===0&&DC(e[0])){let b=n.segments[t];i.push(new jd(b.path,D5(e[0]))),r++;continue}let d=_0(o)?o.outlets[vn]:`${o}`,m=r<e.length-1?e[r+1]:null;d&&m&&DC(m)?(i.push(new jd(d,D5(m))),r+=2):(i.push(new jd(d,{})),r++)}return new Qn(i,{})}function ore(n){let t={};return Object.entries(n).forEach(([e,i])=>{typeof i=="string"&&(i=[i]),i!==null&&(t[e]=eP(new Qn([],{}),0,i))}),t}function D5(n){let t={};return Object.entries(n).forEach(([e,i])=>t[e]=`${i}`),t}function I5(n,t,e){return n==e.path&&pc(t,e.parameters)}var Lg="imperative",po=(function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n})(po||{}),pa=class{id;url;constructor(t,e){this.id=t,this.url=e}},Ud=class extends pa{type=po.NavigationStart;navigationTrigger;restoredState;constructor(t,e,i="imperative",r=null){super(t,e),this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ma=class extends pa{urlAfterRedirects;type=po.NavigationEnd;constructor(t,e,i){super(t,e),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},es=(function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n[n.Aborted=4]="Aborted",n})(es||{}),Vg=(function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n})(Vg||{}),za=class extends pa{reason;code;type=po.NavigationCancel;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}};function K5(n){return n instanceof za&&(n.code===es.Redirect||n.code===es.SupersededByNewNavigation)}var mc=class extends pa{reason;code;type=po.NavigationSkipped;constructor(t,e,i,r){super(t,e),this.reason=i,this.code=r}},ip=class extends pa{error;target;type=po.NavigationError;constructor(t,e,i,r){super(t,e),this.error=i,this.target=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},jg=class extends pa{urlAfterRedirects;state;type=po.RoutesRecognized;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},MC=class extends pa{urlAfterRedirects;state;type=po.GuardsCheckStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},AC=class extends pa{urlAfterRedirects;state;shouldActivate;type=po.GuardsCheckEnd;constructor(t,e,i,r,o){super(t,e),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=o}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},kC=class extends pa{urlAfterRedirects;state;type=po.ResolveStart;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},RC=class extends pa{urlAfterRedirects;state;type=po.ResolveEnd;constructor(t,e,i,r){super(t,e),this.urlAfterRedirects=i,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},PC=class{route;type=po.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},NC=class{route;type=po.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},OC=class{snapshot;type=po.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},FC=class{snapshot;type=po.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},LC=class{snapshot;type=po.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},BC=class{snapshot;type=po.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},zg=class{routerEvent;position;anchor;scrollBehavior;type=po.Scroll;constructor(t,e,i,r){this.routerEvent=t,this.position=e,this.anchor=i,this.scrollBehavior=r}toString(){let t=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${t}')`}},Ug=class{},$g=class{url;navigationBehaviorOptions;constructor(t,e){this.url=t,this.navigationBehaviorOptions=e}};function sre(n){return!(n instanceof Ug)&&!(n instanceof $g)}var VC=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return this.route?.snapshot._environmentInjector??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new sp(this.rootInjector)}},sp=(()=>{class n{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,i){let r=this.getOrCreateContext(e);r.outlet=i,this.contexts.set(e,r)}onChildOutletDestroyed(e){let i=this.getContext(e);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let i=this.getContext(e);return i||(i=new VC(this.rootInjector),this.contexts.set(e,i)),i}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(i){return new(i||n)(vt(si))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),jC=class{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){let e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){let e=tP(t,this._root);return e?e.children.map(i=>i.value):[]}firstChild(t){let e=tP(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){let e=nP(t,this._root);return e.length<2?[]:e[e.length-2].children.map(r=>r.value).filter(r=>r!==t)}pathFromRoot(t){return nP(t,this._root).map(e=>e.value)}};function tP(n,t){if(n===t.value)return t;for(let e of t.children){let i=tP(n,e);if(i)return i}return null}function nP(n,t){if(n===t.value)return[t];for(let e of t.children){let i=nP(n,e);if(i.length)return i.unshift(t),i}return[]}var ha=class{value;children;constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}};function Og(n){let t={};return n&&n.children.forEach(e=>t[e.value.outlet]=e),t}var y0=class extends jC{snapshot;constructor(t,e){super(t),this.snapshot=e,dP(this,t)}toString(){return this.snapshot.toString()}};function Y5(n,t){let e=are(n,t),i=new Fr([new jd("",{})]),r=new Fr({}),o=new Fr({}),d=new Fr({}),m=new Fr(""),b=new Ua(i,r,d,m,o,vn,n,e.root);return b.snapshot=e.root,new y0(new ha(b,[]),e)}function are(n,t){let e={},i={},r={},d=new tp([],e,r,"",i,vn,n,null,{},t);return new v0("",new ha(d,[]))}var Ua=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,e,i,r,o,d,m,b){this.urlSubject=t,this.paramsSubject=e,this.queryParamsSubject=i,this.fragmentSubject=r,this.dataSubject=o,this.outlet=d,this.component=m,this._futureSnapshot=b,this.title=this.dataSubject?.pipe(Tn(T=>T[x0]))??Jt(void 0),this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Tn(t=>np(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Tn(t=>np(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function zC(n,t,e="emptyOnly"){let i,{routeConfig:r}=n;return t!==null&&(e==="always"||r?.path===""||!t.component&&!t.routeConfig?.loadComponent)?i={params:Be(Be({},t.params),n.params),data:Be(Be({},t.data),n.data),resolve:Be(Be(Be(Be({},n.data),t.data),r?.data),n._resolvedData)}:i={params:Be({},n.params),data:Be({},n.data),resolve:Be(Be({},n.data),n._resolvedData??{})},r&&Q5(r)&&(i.resolve[x0]=r.title),i}var tp=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;_environmentInjector;get title(){return this.data?.[x0]}constructor(t,e,i,r,o,d,m,b,T,A){this.url=t,this.params=e,this.queryParams=i,this.fragment=r,this.data=o,this.outlet=d,this.component=m,this.routeConfig=b,this._resolve=T,this._environmentInjector=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=np(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=np(this.queryParams),this._queryParamMap}toString(){let t=this.url.map(i=>i.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${t}', path:'${e}')`}},v0=class extends jC{url;constructor(t,e){super(e),this.url=t,dP(this,e)}toString(){return X5(this._root)}};function dP(n,t){t.value._routerState=n,t.children.forEach(e=>dP(n,e))}function X5(n){let t=n.children.length>0?` { ${n.children.map(X5).join(", ")} } `:"";return`${n.value}${t}`}function ZR(n){if(n.snapshot){let t=n.snapshot,e=n._futureSnapshot;n.snapshot=e,pc(t.queryParams,e.queryParams)||n.queryParamsSubject.next(e.queryParams),t.fragment!==e.fragment&&n.fragmentSubject.next(e.fragment),pc(t.params,e.params)||n.paramsSubject.next(e.params),Oie(t.url,e.url)||n.urlSubject.next(e.url),pc(t.data,e.data)||n.dataSubject.next(e.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function iP(n,t){let e=pc(n.params,t.params)&&jie(n.url,t.url),i=!n.parent!=!t.parent;return e&&!i&&(!n.parent||iP(n.parent,t.parent))}function Q5(n){return typeof n.title=="string"||n.title===null}var J5=new rt(""),E0=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=vn;activateEvents=new xn;deactivateEvents=new xn;attachEvents=new xn;detachEvents=new xn;routerOutletData=LU();parentContexts=se(sp);location=se(ua);changeDetector=se(Uo);inputBinder=se(C0,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:i,previousValue:r}=e.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Je(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Je(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Je(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,i){this.activated=e,this._activatedRoute=i,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,i){if(this.isActivated)throw new Je(4013,!1);this._activatedRoute=e;let r=this.location,d=e.snapshot.component,m=this.parentContexts.getOrCreateContext(this.name).children,b=new rP(e,m,r.injector,this.routerOutletData);this.activated=r.createComponent(d,{index:r.length,injector:b,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Co]})}return n})(),rP=class{route;childContexts;parent;outletData;constructor(t,e,i,r){this.route=t,this.childContexts=e,this.parent=i,this.outletData=r}get(t,e){return t===Ua?this.route:t===sp?this.childContexts:t===J5?this.outletData:this.parent.get(t,e)}},C0=new rt(""),hP=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(e){this.unsubscribeFromRouteData(e),this.subscribeToRouteData(e)}unsubscribeFromRouteData(e){this.outletDataSubscriptions.get(e)?.unsubscribe(),this.outletDataSubscriptions.delete(e)}subscribeToRouteData(e){let{activatedRoute:i}=e,r=tg([i.queryParams,i.params,i.data]).pipe(Kr(([o,d,m],b)=>(m=Be(Be(Be({},o),d),m),b===0?Jt(m):Promise.resolve(m)))).subscribe(o=>{if(!e.isActivated||!e.activatedComponentRef||e.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(e);return}let d=zU(i.component);if(!d){this.unsubscribeFromRouteData(e);return}for(let{templateName:m}of d.inputs)e.activatedComponentRef.setInput(m,o[m])});this.outletDataSubscriptions.set(e,r)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),fP=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,r){i&1&&st(0,"router-outlet")},dependencies:[E0],encapsulation:2})}return n})();function pP(n){let t=n.children&&n.children.map(pP),e=t?Mt(Be({},n),{children:t}):Be({},n);return!e.component&&!e.loadComponent&&(t||e.loadChildren)&&e.outlet&&e.outlet!==vn&&(e.component=fP),e}function lre(n,t,e){let i=b0(n,t._root,e?e._root:void 0);return new y0(i,t)}function b0(n,t,e){if(e&&n.shouldReuseRoute(t.value,e.value.snapshot)){let i=e.value;i._futureSnapshot=t.value;let r=cre(n,t,e);return new ha(i,r)}else{if(n.shouldAttach(t.value)){let o=n.retrieve(t.value);if(o!==null){let d=o.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(m=>b0(n,m)),d}}let i=ure(t.value),r=t.children.map(o=>b0(n,o));return new ha(i,r)}}function cre(n,t,e){return t.children.map(i=>{for(let r of e.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return b0(n,i,r);return b0(n,i)})}function ure(n){return new Ua(new Fr(n.url),new Fr(n.params),new Fr(n.queryParams),new Fr(n.fragment),new Fr(n.data),n.outlet,n.component,n)}var Hg=class{redirectTo;navigationBehaviorOptions;constructor(t,e){this.redirectTo=t,this.navigationBehaviorOptions=e}},e6="ngNavigationCancelingError";function UC(n,t){let{redirectTo:e,navigationBehaviorOptions:i}=zd(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,r=t6(!1,es.Redirect);return r.url=e,r.navigationBehaviorOptions=i,r}function t6(n,t){let e=new Error(`NavigationCancelingError: ${n||""}`);return e[e6]=!0,e.cancellationCode=t,e}function dre(n){return n6(n)&&zd(n.url)}function n6(n){return!!n&&n[e6]}var oP=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,e,i,r,o){this.routeReuseStrategy=t,this.futureState=e,this.currState=i,this.forwardEvent=r,this.inputBindingEnabled=o}activate(t){let e=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,i,t),ZR(this.futureState.root),this.activateChildRoutes(e,i,t)}deactivateChildRoutes(t,e,i){let r=Og(e);t.children.forEach(o=>{let d=o.value.outlet;this.deactivateRoutes(o,r[d],i),delete r[d]}),Object.values(r).forEach(o=>{this.deactivateRouteAndItsChildren(o,i)})}deactivateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(r===o)if(r.component){let d=i.getContext(r.outlet);d&&this.deactivateChildRoutes(t,e,d.children)}else this.deactivateChildRoutes(t,e,i);else o&&this.deactivateRouteAndItsChildren(e,i)}deactivateRouteAndItsChildren(t,e){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Og(t);for(let d of Object.values(o))this.deactivateRouteAndItsChildren(d,r);if(i&&i.outlet){let d=i.outlet.detach(),m=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:m})}}deactivateRouteAndOutlet(t,e){let i=e.getContext(t.value.outlet),r=i&&t.value.component?i.children:e,o=Og(t);for(let d of Object.values(o))this.deactivateRouteAndItsChildren(d,r);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,e,i){let r=Og(e);t.children.forEach(o=>{this.activateRoutes(o,r[o.value.outlet],i),this.forwardEvent(new BC(o.value.snapshot))}),t.children.length&&this.forwardEvent(new FC(t.value.snapshot))}activateRoutes(t,e,i){let r=t.value,o=e?e.value:null;if(ZR(r),r===o)if(r.component){let d=i.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,d.children)}else this.activateChildRoutes(t,e,i);else if(r.component){let d=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){let m=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),d.children.onOutletReAttached(m.contexts),d.attachRef=m.componentRef,d.route=m.route.value,d.outlet&&d.outlet.attach(m.componentRef,m.route.value),ZR(m.route.value),this.activateChildRoutes(t,null,d.children)}else d.attachRef=null,d.route=r,d.outlet&&d.outlet.activateWith(r,d.injector),this.activateChildRoutes(t,null,d.children)}else this.activateChildRoutes(t,null,i)}},$C=class{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}},Bg=class{component;route;constructor(t,e){this.component=t,this.route=e}};function hre(n,t,e){let i=n._root,r=t?t._root:null;return p0(i,r,e,[i.value])}function fre(n){let t=n.routeConfig?n.routeConfig.canActivateChild:null;return!t||t.length===0?null:{node:n,guards:t}}function qg(n,t){let e=Symbol(),i=t.get(n,e);return i===e?typeof n=="function"&&!TM(n)?n:t.get(n):i}function p0(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=Og(t);return n.children.forEach(d=>{pre(d,o[d.value.outlet],e,i.concat([d.value]),r),delete o[d.value.outlet]}),Object.entries(o).forEach(([d,m])=>g0(m,e.getContext(d),r)),r}function pre(n,t,e,i,r={canDeactivateChecks:[],canActivateChecks:[]}){let o=n.value,d=t?t.value:null,m=e?e.getContext(n.value.outlet):null;if(d&&o.routeConfig===d.routeConfig){let b=mre(d,o,o.routeConfig.runGuardsAndResolvers);b?r.canActivateChecks.push(new $C(i)):(o.data=d.data,o._resolvedData=d._resolvedData),o.component?p0(n,t,m?m.children:null,i,r):p0(n,t,e,i,r),b&&m&&m.outlet&&m.outlet.isActivated&&r.canDeactivateChecks.push(new Bg(m.outlet.component,d))}else d&&g0(t,m,r),r.canActivateChecks.push(new $C(i)),o.component?p0(n,null,m?m.children:null,i,r):p0(n,null,e,i,r);return r}function mre(n,t,e){if(typeof e=="function")return so(t._environmentInjector,()=>e(n,t));switch(e){case"pathParamsChange":return!ep(n.url,t.url);case"pathParamsOrQueryParamsChange":return!ep(n.url,t.url)||!pc(n.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!iP(n,t)||!pc(n.queryParams,t.queryParams);default:return!iP(n,t)}}function g0(n,t,e){let i=Og(n),r=n.value;Object.entries(i).forEach(([o,d])=>{r.component?t?g0(d,t.children.getContext(o),e):g0(d,null,e):g0(d,t,e)}),r.component?t&&t.outlet&&t.outlet.isActivated?e.canDeactivateChecks.push(new Bg(t.outlet.component,r)):e.canDeactivateChecks.push(new Bg(null,r)):e.canDeactivateChecks.push(new Bg(null,r))}function T0(n){return typeof n=="function"}function gre(n){return typeof n=="boolean"}function _re(n){return n&&T0(n.canLoad)}function yre(n){return n&&T0(n.canActivate)}function vre(n){return n&&T0(n.canActivateChild)}function bre(n){return n&&T0(n.canDeactivate)}function wre(n){return n&&T0(n.canMatch)}function i6(n){return n instanceof Cf||n?.name==="EmptyError"}var xC=Symbol("INITIAL_VALUE");function Gg(){return Kr(n=>tg(n.map(t=>t.pipe(Xi(1),ra(xC)))).pipe(Tn(t=>{for(let e of t)if(e!==!0){if(e===xC)return xC;if(e===!1||xre(e))return e}return!0}),mi(t=>t!==xC),Xi(1)))}function xre(n){return zd(n)||n instanceof Hg}function r6(n){return n.aborted?Jt(void 0).pipe(Xi(1)):new Kt(t=>{let e=()=>{t.next(),t.complete()};return n.addEventListener("abort",e),()=>n.removeEventListener("abort",e)})}function o6(n){return Bo(r6(n))}function Ere(n){return Lo(t=>{let{targetSnapshot:e,currentSnapshot:i,guards:{canActivateChecks:r,canDeactivateChecks:o}}=t;return o.length===0&&r.length===0?Jt(Mt(Be({},t),{guardsResult:!0})):Cre(o,e,i).pipe(Lo(d=>d&&gre(d)?Tre(e,r,n):Jt(d)),Tn(d=>Mt(Be({},t),{guardsResult:d})))})}function Cre(n,t,e){return Bi(n).pipe(Lo(i=>Are(i.component,i.route,e,t)),su(i=>i!==!0,!0))}function Tre(n,t,e){return Bi(t).pipe(Ed(i=>xd(Dre(i.route.parent,e),Sre(i.route,e),Mre(n,i.path),Ire(n,i.route))),su(i=>i!==!0,!0))}function Sre(n,t){return n!==null&&t&&t(new LC(n)),Jt(!0)}function Dre(n,t){return n!==null&&t&&t(new OC(n)),Jt(!0)}function Ire(n,t){let e=t.routeConfig?t.routeConfig.canActivate:null;if(!e||e.length===0)return Jt(!0);let i=e.map(r=>ru(()=>{let o=t._environmentInjector,d=qg(r,o),m=yre(d)?d.canActivate(t,n):so(o,()=>d(t,n));return rp(m).pipe(su())}));return Jt(i).pipe(Gg())}function Mre(n,t){let e=t[t.length-1],r=t.slice(0,t.length-1).reverse().map(o=>fre(o)).filter(o=>o!==null).map(o=>ru(()=>{let d=o.guards.map(m=>{let b=o.node._environmentInjector,T=qg(m,b),A=vre(T)?T.canActivateChild(e,n):so(b,()=>T(e,n));return rp(A).pipe(su())});return Jt(d).pipe(Gg())}));return Jt(r).pipe(Gg())}function Are(n,t,e,i){let r=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!r||r.length===0)return Jt(!0);let o=r.map(d=>{let m=t._environmentInjector,b=qg(d,m),T=bre(b)?b.canDeactivate(n,t,e,i):so(m,()=>b(n,t,e,i));return rp(T).pipe(su())});return Jt(o).pipe(Gg())}function kre(n,t,e,i,r){let o=t.canLoad;if(o===void 0||o.length===0)return Jt(!0);let d=o.map(m=>{let b=qg(m,n),T=_re(b)?b.canLoad(t,e):so(n,()=>b(t,e)),A=rp(T);return r?A.pipe(o6(r)):A});return Jt(d).pipe(Gg(),s6(i))}function s6(n){return rM(Ia(t=>{if(typeof t!="boolean")throw UC(n,t)}),Tn(t=>t===!0))}function Rre(n,t,e,i,r){let o=t.canMatch;if(!o||o.length===0)return Jt(!0);let d=o.map(m=>{let b=qg(m,n),T=wre(b)?b.canMatch(t,e):so(n,()=>b(t,e));return rp(T).pipe(o6(r))});return Jt(d).pipe(Gg(),s6(i))}var Eu=class n extends Error{segmentGroup;constructor(t){super(),this.segmentGroup=t||null,Object.setPrototypeOf(this,n.prototype)}},w0=class n extends Error{urlTree;constructor(t){super(),this.urlTree=t,Object.setPrototypeOf(this,n.prototype)}};function Pre(n){throw new Je(4e3,!1)}function Nre(n){throw t6(!1,es.GuardRejected)}var sP=class{urlSerializer;urlTree;constructor(t,e){this.urlSerializer=t,this.urlTree=e}lineralizeSegments(t,e){return ae(this,null,function*(){let i=[],r=e.root;for(;;){if(i=i.concat(r.segments),r.numberOfChildren===0)return i;if(r.numberOfChildren>1||!r.children[vn])throw Pre(`${t.redirectTo}`);r=r.children[vn]}})}applyRedirectCommands(t,e,i,r,o){return ae(this,null,function*(){let d=yield Ore(e,r,o);if(d instanceof fa)throw new w0(d);let m=this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),t,i);if(d[0]==="/")throw new w0(m);return m})}applyRedirectCreateUrlTree(t,e,i,r){let o=this.createSegmentGroup(t,e.root,i,r);return new fa(o,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){let i={};return Object.entries(t).forEach(([r,o])=>{if(typeof o=="string"&&o[0]===":"){let m=o.substring(1);i[r]=e[m]}else i[r]=o}),i}createSegmentGroup(t,e,i,r){let o=this.createSegments(t,e.segments,i,r),d={};return Object.entries(e.children).forEach(([m,b])=>{d[m]=this.createSegmentGroup(t,b,i,r)}),new Qn(o,d)}createSegments(t,e,i,r){return e.map(o=>o.path[0]===":"?this.findPosParam(t,o,r):this.findOrReturn(o,i))}findPosParam(t,e,i){let r=i[e.path.substring(1)];if(!r)throw new Je(4001,!1);return r}findOrReturn(t,e){let i=0;for(let r of e){if(r.path===t.path)return e.splice(i),r;i++}return t}};function Ore(n,t,e){if(typeof n=="string")return Promise.resolve(n);let i=n,{queryParams:r,fragment:o,routeConfig:d,url:m,outlet:b,params:T,data:A,title:N,paramMap:q,queryParamMap:J}=t;return SC(rp(so(e,()=>i({params:T,data:A,queryParams:r,fragment:o,routeConfig:d,url:m,outlet:b,title:N,paramMap:q,queryParamMap:J}))))}function Fre(n,t){return n.providers&&!n._injector&&(n._injector=Cg(n.providers,t,`Route: ${n.path}`)),n._injector??t}function Tl(n){return n.outlet||vn}function Lre(n,t){let e=n.filter(i=>Tl(i)===t);return e.push(...n.filter(i=>Tl(i)!==t)),e}var aP={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Bre(n,t,e,i,r,o){let d=a6(n,t,e);return d.matched?(i=Fre(t,i),Rre(i,t,e,r,o).pipe(Tn(m=>m===!0?d:Be({},aP)))):Jt(d)}function a6(n,t,e){if(t.path==="")return t.pathMatch==="full"&&(n.hasChildren()||e.length>0)?Be({},aP):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let r=(t.matcher||P5)(e,n,t);if(!r)return Be({},aP);let o={};Object.entries(r.posParams??{}).forEach(([m,b])=>{o[m]=b.path});let d=r.consumed.length>0?Be(Be({},o),r.consumed[r.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:r.consumed,remainingSegments:e.slice(r.consumed.length),parameters:d,positionalParamSegments:r.posParams??{}}}function M5(n,t,e,i){return e.length>0&&zre(n,e,i)?{segmentGroup:new Qn(t,jre(i,new Qn(e,n.children))),slicedSegments:[]}:e.length===0&&Ure(n,e,i)?{segmentGroup:new Qn(n.segments,Vre(n,e,i,n.children)),slicedSegments:e}:{segmentGroup:new Qn(n.segments,n.children),slicedSegments:e}}function Vre(n,t,e,i){let r={};for(let o of e)if(GC(n,t,o)&&!i[Tl(o)]){let d=new Qn([],{});r[Tl(o)]=d}return Be(Be({},i),r)}function jre(n,t){let e={};e[vn]=t;for(let i of n)if(i.path===""&&Tl(i)!==vn){let r=new Qn([],{});e[Tl(i)]=r}return e}function zre(n,t,e){return e.some(i=>GC(n,t,i)&&Tl(i)!==vn)}function Ure(n,t,e){return e.some(i=>GC(n,t,i))}function GC(n,t,e){return(n.hasChildren()||t.length>0)&&e.pathMatch==="full"?!1:e.path===""}function $re(n,t,e){return t.length===0&&!n.children[e]}var lP=class{};function Hre(n,t,e,i,r,o,d="emptyOnly",m){return ae(this,null,function*(){return new cP(n,t,e,i,r,d,o,m).recognize()})}var Gre=31,cP=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;abortSignal;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,e,i,r,o,d,m,b){this.injector=t,this.configLoader=e,this.rootComponentType=i,this.config=r,this.urlTree=o,this.paramsInheritanceStrategy=d,this.urlSerializer=m,this.abortSignal=b,this.applyRedirects=new sP(this.urlSerializer,this.urlTree)}noMatchError(t){return new Je(4002,`'${t.segmentGroup}'`)}recognize(){return ae(this,null,function*(){let t=M5(this.urlTree.root,[],[],this.config).segmentGroup,{children:e,rootSnapshot:i}=yield this.match(t),r=new ha(i,e),o=new v0("",r),d=H5(i,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(d),{state:o,tree:d}})}match(t){return ae(this,null,function*(){let e=new tp([],Object.freeze({}),Object.freeze(Be({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),vn,this.rootComponentType,null,{},this.injector);try{return{children:yield this.processSegmentGroup(this.injector,this.config,t,vn,e),rootSnapshot:e}}catch(i){if(i instanceof w0)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof Eu?this.noMatchError(i):i}})}processSegmentGroup(t,e,i,r,o){return ae(this,null,function*(){if(i.segments.length===0&&i.hasChildren())return this.processChildren(t,e,i,o);let d=yield this.processSegment(t,e,i,i.segments,r,!0,o);return d instanceof ha?[d]:[]})}processChildren(t,e,i,r){return ae(this,null,function*(){let o=[];for(let b of Object.keys(i.children))b==="primary"?o.unshift(b):o.push(b);let d=[];for(let b of o){let T=i.children[b],A=Lre(e,b),N=yield this.processSegmentGroup(t,A,T,b,r);d.push(...N)}let m=l6(d);return qre(m),m})}processSegment(t,e,i,r,o,d,m){return ae(this,null,function*(){for(let b of e)try{return yield this.processSegmentAgainstRoute(b._injector??t,e,b,i,r,o,d,m)}catch(T){if(T instanceof Eu||i6(T))continue;throw T}if($re(i,r,o))return new lP;throw new Eu(i)})}processSegmentAgainstRoute(t,e,i,r,o,d,m,b){return ae(this,null,function*(){if(Tl(i)!==d&&(d===vn||!GC(r,o,i)))throw new Eu(r);if(i.redirectTo===void 0)return this.matchSegmentAgainstRoute(t,r,i,o,d,b);if(this.allowRedirects&&m)return this.expandSegmentAgainstRouteUsingRedirect(t,r,e,i,o,d,b);throw new Eu(r)})}expandSegmentAgainstRouteUsingRedirect(t,e,i,r,o,d,m){return ae(this,null,function*(){let{matched:b,parameters:T,consumedSegments:A,positionalParamSegments:N,remainingSegments:q}=a6(e,r,o);if(!b)throw new Eu(e);typeof r.redirectTo=="string"&&r.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Gre&&(this.allowRedirects=!1));let J=new tp(o,T,Object.freeze(Be({},this.urlTree.queryParams)),this.urlTree.fragment,A5(r),Tl(r),r.component??r._loadedComponent??null,r,k5(r),t),K=zC(J,m,this.paramsInheritanceStrategy);if(J.params=Object.freeze(K.params),J.data=Object.freeze(K.data),this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let xe=yield this.applyRedirects.applyRedirectCommands(A,r.redirectTo,N,J,t),Te=yield this.applyRedirects.lineralizeSegments(r,xe);return this.processSegment(t,i,e,Te.concat(q),d,!1,m)})}matchSegmentAgainstRoute(t,e,i,r,o,d){return ae(this,null,function*(){if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);let m=yield SC(Bre(e,i,r,t,this.urlSerializer,this.abortSignal));if(i.path==="**"&&(e.children={}),!m?.matched)throw new Eu(e);t=i._injector??t;let{routes:b}=yield this.getChildConfig(t,i,r),T=i._loadedInjector??t,{parameters:A,consumedSegments:N,remainingSegments:q}=m,J=new tp(N,A,Object.freeze(Be({},this.urlTree.queryParams)),this.urlTree.fragment,A5(i),Tl(i),i.component??i._loadedComponent??null,i,k5(i),t),K=zC(J,d,this.paramsInheritanceStrategy);J.params=Object.freeze(K.params),J.data=Object.freeze(K.data);let{segmentGroup:xe,slicedSegments:Te}=M5(e,N,q,b);if(Te.length===0&&xe.hasChildren()){let kt=yield this.processChildren(T,b,xe,J);return new ha(J,kt)}if(b.length===0&&Te.length===0)return new ha(J,[]);let Ge=Tl(i)===o,Et=yield this.processSegment(T,b,xe,Te,Ge?vn:o,!0,J);return new ha(J,Et instanceof ha?[Et]:[])})}getChildConfig(t,e,i){return ae(this,null,function*(){if(e.children)return{routes:e.children,injector:t};if(e.loadChildren){if(e._loadedRoutes!==void 0){let o=e._loadedNgModuleFactory;return o&&!e._loadedInjector&&(e._loadedInjector=o.create(t).injector),{routes:e._loadedRoutes,injector:e._loadedInjector}}if(this.abortSignal.aborted)throw new Error(this.abortSignal.reason);if(yield SC(kre(t,e,i,this.urlSerializer,this.abortSignal))){let o=yield this.configLoader.loadChildren(t,e);return e._loadedRoutes=o.routes,e._loadedInjector=o.injector,e._loadedNgModuleFactory=o.factory,o}throw Nre(e)}return{routes:[],injector:t}})}};function qre(n){n.sort((t,e)=>t.value.outlet===vn?-1:e.value.outlet===vn?1:t.value.outlet.localeCompare(e.value.outlet))}function Wre(n){let t=n.value.routeConfig;return t&&t.path===""}function l6(n){let t=[],e=new Set;for(let i of n){if(!Wre(i)){t.push(i);continue}let r=t.find(o=>i.value.routeConfig===o.value.routeConfig);r!==void 0?(r.children.push(...i.children),e.add(r)):t.push(i)}for(let i of e){let r=l6(i.children);t.push(new ha(i.value,r))}return t.filter(i=>!e.has(i))}function A5(n){return n.data||{}}function k5(n){return n.resolve||{}}function Zre(n,t,e,i,r,o,d){return Lo(m=>ae(null,null,function*(){let{state:b,tree:T}=yield Hre(n,t,e,i,m.extractedUrl,r,o,d);return Mt(Be({},m),{targetSnapshot:b,urlAfterRedirects:T})}))}function Kre(n){return Lo(t=>{let{targetSnapshot:e,guards:{canActivateChecks:i}}=t;if(!i.length)return Jt(t);let r=new Set(i.map(m=>m.route)),o=new Set;for(let m of r)if(!o.has(m))for(let b of c6(m))o.add(b);let d=0;return Bi(o).pipe(Ed(m=>r.has(m)?Yre(m,e,n):(m.data=zC(m,m.parent,n).resolve,Jt(void 0))),Ia(()=>d++),dE(1),Lo(m=>d===o.size?Jt(t):ro))})}function c6(n){let t=n.children.map(e=>c6(e)).flat();return[n,...t]}function Yre(n,t,e){let i=n.routeConfig,r=n._resolve;return i?.title!==void 0&&!Q5(i)&&(r[x0]=i.title),ru(()=>(n.data=zC(n,n.parent,e).resolve,Xre(r,n,t).pipe(Tn(o=>(n._resolvedData=o,n.data=Be(Be({},n.data),o),null)))))}function Xre(n,t,e){let i=YR(n);if(i.length===0)return Jt({});let r={};return Bi(i).pipe(Lo(o=>Qre(n[o],t,e).pipe(su(),Ia(d=>{if(d instanceof Hg)throw UC(new Cu,d);r[o]=d}))),dE(1),Tn(()=>r),ng(o=>i6(o)?ro:lM(o)))}function Qre(n,t,e){let i=t._environmentInjector,r=qg(n,i),o=r.resolve?r.resolve(t,e):so(i,()=>r(t,e));return rp(o)}function R5(n){return Kr(t=>{let e=n(t);return e?Bi(e).pipe(Tn(()=>t)):Jt(t)})}var mP=(()=>{class n{buildTitle(e){let i,r=e.root;for(;r!==void 0;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(o=>o.outlet===vn);return i}getResolvedTitleForRoute(e){return e.data[x0]}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se(u6),providedIn:"root"})}return n})(),u6=(()=>{class n extends mP{title;constructor(e){super(),this.title=e}updateTitle(e){let i=this.buildTitle(e);i!==void 0&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||n)(vt(S4))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),$d=new rt("",{factory:()=>({})}),ap=new rt(""),qC=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=se(Uk);loadComponent(e,i){return ae(this,null,function*(){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return Promise.resolve(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let r=ae(this,null,function*(){try{let o=yield O5(so(e,()=>i.loadComponent())),d=yield f6(h6(o));return this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=d,d}finally{this.componentLoaders.delete(i)}});return this.componentLoaders.set(i,r),r})}loadChildren(e,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Promise.resolve({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let r=ae(this,null,function*(){try{let o=yield d6(i,this.compiler,e,this.onLoadEndListener);return i._loadedRoutes=o.routes,i._loadedInjector=o.injector,i._loadedNgModuleFactory=o.factory,o}finally{this.childrenLoaders.delete(i)}});return this.childrenLoaders.set(i,r),r}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function d6(n,t,e,i){return ae(this,null,function*(){let r=yield O5(so(e,()=>n.loadChildren())),o=yield f6(h6(r)),d;o instanceof S1||Array.isArray(o)?d=o:d=yield t.compileModuleAsync(o),i&&i(n);let m,b,T=!1,A;return Array.isArray(d)?(b=d,T=!0):(m=d.create(e).injector,A=d,b=m.get(ap,[],{optional:!0,self:!0}).flat()),{routes:b.map(pP),injector:m,factory:A}})}function Jre(n){return n&&typeof n=="object"&&"default"in n}function h6(n){return Jre(n)?n.default:n}function f6(n){return ae(this,null,function*(){return n})}var WC=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se(eoe),providedIn:"root"})}return n})(),eoe=(()=>{class n{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,i){return e}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),gP=new rt(""),_P=new rt("");function p6(n,t,e){let i=n.get(_P),r=n.get(Ht);if(!r.startViewTransition||i.skipNextTransition)return i.skipNextTransition=!1,new Promise(T=>setTimeout(T));let o,d=new Promise(T=>{o=T}),m=r.startViewTransition(()=>(o(),toe(n)));m.updateCallbackDone.catch(T=>{}),m.ready.catch(T=>{}),m.finished.catch(T=>{});let{onViewTransitionCreated:b}=i;return b&&so(n,()=>b({transition:m,from:t,to:e})),d}function toe(n){return new Promise(t=>{co({read:()=>setTimeout(t)},{injector:n})})}var noe=()=>{},yP=new rt(""),ZC=(()=>{class n{currentNavigation=Zn(null,{equal:()=>!1});currentTransition=null;lastSuccessfulNavigation=Zn(null);events=new yt;transitionAbortWithErrorSubject=new yt;configLoader=se(qC);environmentInjector=se(si);destroyRef=se(Bs);urlSerializer=se(op);rootContexts=se(sp);location=se(hc);inputBindingEnabled=se(C0,{optional:!0})!==null;titleStrategy=se(mP);options=se($d,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=se(WC);createViewTransition=se(gP,{optional:!0});navigationErrorHandler=se(yP,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Jt(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=r=>this.events.next(new PC(r)),i=r=>this.events.next(new NC(r));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let i=++this.navigationId;Cr(()=>{this.transitions?.next(Mt(Be({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:i}))})}setupNavigations(e){return this.transitions=new Fr(null),this.transitions.pipe(mi(i=>i!==null),Kr(i=>{let r=!1,o=new AbortController,d=()=>!r&&this.currentTransition?.id===i.id;return Jt(i).pipe(Kr(m=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",es.SupersededByNewNavigation),ro;this.currentTransition=i;let b=this.lastSuccessfulNavigation();this.currentNavigation.set({id:m.id,initialUrl:m.rawUrl,extractedUrl:m.extractedUrl,targetBrowserUrl:typeof m.extras.browserUrl=="string"?this.urlSerializer.parse(m.extras.browserUrl):m.extras.browserUrl,trigger:m.source,extras:m.extras,previousNavigation:b?Mt(Be({},b),{previousNavigation:null}):null,abort:()=>o.abort()});let T=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),A=m.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!T&&A!=="reload")return this.events.next(new mc(m.id,this.urlSerializer.serialize(m.rawUrl),"",Vg.IgnoredSameUrlNavigation)),m.resolve(!1),ro;if(this.urlHandlingStrategy.shouldProcessUrl(m.rawUrl))return Jt(m).pipe(Kr(N=>(this.events.next(new Ud(N.id,this.urlSerializer.serialize(N.extractedUrl),N.source,N.restoredState)),N.id!==this.navigationId?ro:Promise.resolve(N))),Zre(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy,o.signal),Ia(N=>{i.targetSnapshot=N.targetSnapshot,i.urlAfterRedirects=N.urlAfterRedirects,this.currentNavigation.update(J=>(J.finalUrl=N.urlAfterRedirects,J));let q=new jg(N.id,this.urlSerializer.serialize(N.extractedUrl),this.urlSerializer.serialize(N.urlAfterRedirects),N.targetSnapshot);this.events.next(q)}));if(T&&this.urlHandlingStrategy.shouldProcessUrl(m.currentRawUrl)){let{id:N,extractedUrl:q,source:J,restoredState:K,extras:xe}=m,Te=new Ud(N,this.urlSerializer.serialize(q),J,K);this.events.next(Te);let Ge=Y5(this.rootComponentType,this.environmentInjector).snapshot;return this.currentTransition=i=Mt(Be({},m),{targetSnapshot:Ge,urlAfterRedirects:q,extras:Mt(Be({},xe),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.update(Et=>(Et.finalUrl=q,Et)),Jt(i)}else return this.events.next(new mc(m.id,this.urlSerializer.serialize(m.extractedUrl),"",Vg.IgnoredByUrlHandlingStrategy)),m.resolve(!1),ro}),Tn(m=>{let b=new MC(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);return this.events.next(b),this.currentTransition=i=Mt(Be({},m),{guards:hre(m.targetSnapshot,m.currentSnapshot,this.rootContexts)}),i}),Ere(m=>this.events.next(m)),Kr(m=>{if(i.guardsResult=m.guardsResult,m.guardsResult&&typeof m.guardsResult!="boolean")throw UC(this.urlSerializer,m.guardsResult);let b=new AC(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot,!!m.guardsResult);if(this.events.next(b),!d())return ro;if(!m.guardsResult)return this.cancelNavigationTransition(m,"",es.GuardRejected),ro;if(m.guards.canActivateChecks.length===0)return Jt(m);let T=new kC(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);if(this.events.next(T),!d())return ro;let A=!1;return Jt(m).pipe(Kre(this.paramsInheritanceStrategy),Ia({next:()=>{A=!0;let N=new RC(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects),m.targetSnapshot);this.events.next(N)},complete:()=>{A||this.cancelNavigationTransition(m,"",es.NoDataFromResolver)}}))}),R5(m=>{let b=A=>{let N=[];if(A.routeConfig?._loadedComponent)A.component=A.routeConfig?._loadedComponent;else if(A.routeConfig?.loadComponent){let q=A._environmentInjector;N.push(this.configLoader.loadComponent(q,A.routeConfig).then(J=>{A.component=J}))}for(let q of A.children)N.push(...b(q));return N},T=b(m.targetSnapshot.root);return T.length===0?Jt(m):Bi(Promise.all(T).then(()=>m))}),R5(()=>this.afterPreactivation()),Kr(()=>{let{currentSnapshot:m,targetSnapshot:b}=i,T=this.createViewTransition?.(this.environmentInjector,m.root,b.root);return T?Bi(T).pipe(Tn(()=>i)):Jt(i)}),Xi(1),Tn(m=>{let b=lre(e.routeReuseStrategy,m.targetSnapshot,m.currentRouterState);this.currentTransition=i=m=Mt(Be({},m),{targetRouterState:b}),this.currentNavigation.update(T=>(T.targetRouterState=b,T)),this.events.next(new Ug),d()&&(new oP(e.routeReuseStrategy,i.targetRouterState,i.currentRouterState,T=>this.events.next(T),this.inputBindingEnabled).activate(this.rootContexts),d()&&(r=!0,this.currentNavigation.update(T=>(T.abort=noe,T)),this.lastSuccessfulNavigation.set(Cr(this.currentNavigation)),this.events.next(new ma(m.id,this.urlSerializer.serialize(m.extractedUrl),this.urlSerializer.serialize(m.urlAfterRedirects))),this.titleStrategy?.updateTitle(m.targetRouterState.snapshot),m.resolve(!0)))}),Bo(r6(o.signal).pipe(mi(()=>!r&&!i.targetRouterState),Ia(()=>{this.cancelNavigationTransition(i,o.signal.reason+"",es.Aborted)}))),Ia({complete:()=>{r=!0}}),Bo(this.transitionAbortWithErrorSubject.pipe(Ia(m=>{throw m}))),sv(()=>{o.abort(),r||this.cancelNavigationTransition(i,"",es.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation.set(null),this.currentTransition=null)}),ng(m=>{if(r=!0,this.destroyed)return i.resolve(!1),ro;if(n6(m))this.events.next(new za(i.id,this.urlSerializer.serialize(i.extractedUrl),m.message,m.cancellationCode)),dre(m)?this.events.next(new $g(m.url,m.navigationBehaviorOptions)):i.resolve(!1);else{let b=new ip(i.id,this.urlSerializer.serialize(i.extractedUrl),m,i.targetSnapshot??void 0);try{let T=so(this.environmentInjector,()=>this.navigationErrorHandler?.(b));if(T instanceof Hg){let{message:A,cancellationCode:N}=UC(this.urlSerializer,T);this.events.next(new za(i.id,this.urlSerializer.serialize(i.extractedUrl),A,N)),this.events.next(new $g(T.redirectTo,T.navigationBehaviorOptions))}else throw this.events.next(b),m}catch(T){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(T)}}return ro}))}))}cancelNavigationTransition(e,i,r){let o=new za(e.id,this.urlSerializer.serialize(e.extractedUrl),i,r);this.events.next(o),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=Cr(this.currentNavigation),r=i?.targetBrowserUrl??i?.extractedUrl;return e.toString()!==r?.toString()&&!i?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ioe(n){return n!==Lg}var m6=new rt("");var g6=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se(roe),providedIn:"root"})}return n})(),HC=class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}shouldDestroyInjector(t){return!0}},roe=(()=>{class n extends HC{static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),vP=(()=>{class n{urlSerializer=se(op);options=se($d,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=se(hc);urlHandlingStrategy=se(WC);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new fa;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:e,initialUrl:i,targetBrowserUrl:r}){let o=e!==void 0?this.urlHandlingStrategy.merge(e,i):i,d=r??o;return d instanceof fa?this.urlSerializer.serialize(d):d}commitTransition({targetRouterState:e,finalUrl:i,initialUrl:r}){i&&e?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,r),this.routerState=e):this.rawUrlTree=r}routerState=Y5(null,se(si));getRouterState(){return this.routerState}_stateMemento=this.createStateMemento();get stateMemento(){return this._stateMemento}updateStateMemento(){this._stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}restoredState(){return this.location.getState()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:()=>se(ooe),providedIn:"root"})}return n})(),ooe=(()=>{class n extends vP{currentPageId=0;lastSuccessfulId=-1;get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(i=>{i.type==="popstate"&&setTimeout(()=>{e(i.url,i.state,"popstate")})})}handleRouterEvent(e,i){e instanceof Ud?this.updateStateMemento():e instanceof mc?this.commitTransition(i):e instanceof jg?this.urlUpdateStrategy==="eager"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof Ug?(this.commitTransition(i),this.urlUpdateStrategy==="deferred"&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):e instanceof za&&!K5(e)?this.restoreHistory(i):e instanceof ip?this.restoreHistory(i,!0):e instanceof ma&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,{extras:i,id:r}){let{replaceUrl:o,state:d}=i;if(this.location.isCurrentPathEqualTo(e)||o){let m=this.browserPageId,b=Be(Be({},d),this.generateNgRouterState(r,m));this.location.replaceState(e,"",b)}else{let m=Be(Be({},d),this.generateNgRouterState(r,this.browserPageId+1));this.location.go(e,"",m)}}restoreHistory(e,i=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,o=this.currentPageId-r;o!==0?this.location.historyGo(o):this.getCurrentUrlTree()===e.finalUrl&&o===0&&(this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetInternalState(e),this.resetUrlToCurrentUrlTree())}resetInternalState({finalUrl:e}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,i){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:i}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function KC(n,t){n.events.pipe(mi(e=>e instanceof ma||e instanceof za||e instanceof ip||e instanceof mc),Tn(e=>e instanceof ma||e instanceof mc?0:(e instanceof za?e.code===es.Redirect||e.code===es.SupersededByNewNavigation:!1)?2:1),mi(e=>e!==2),Xi(1)).subscribe(()=>{t()})}var bP={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},wP={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},lr=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=se(D1);stateManager=se(vP);options=se($d,{optional:!0})||{};pendingTasks=se(lc);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=se(ZC);urlSerializer=se(op);location=se(hc);urlHandlingStrategy=se(WC);injector=se(si);_events=new yt;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=se(g6);injectorCleanup=se(m6,{optional:!0});onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=se(ap,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!se(C0,{optional:!0});currentNavigation=this.navigationTransitions.currentNavigation.asReadonly();constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:e=>{}}),this.subscribeToNavigationEvents()}eventsSubscription=new Gn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(i=>{try{let r=this.navigationTransitions.currentTransition,o=Cr(this.navigationTransitions.currentNavigation);if(r!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof za&&i.code!==es.Redirect&&i.code!==es.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof ma)this.navigated=!0,this.injectorCleanup?.(this.routeReuseStrategy,this.routerState,this.config);else if(i instanceof $g){let d=i.navigationBehaviorOptions,m=this.urlHandlingStrategy.merge(i.url,r.currentRawUrl),b=Be({scroll:r.extras.scroll,browserUrl:r.extras.browserUrl,info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:r.extras.replaceUrl||this.urlUpdateStrategy==="eager"||ioe(r.source)},d);this.scheduleNavigation(m,Lg,null,b,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}sre(i)&&this._events.next(i)}catch(r){this.navigationTransitions.transitionAbortWithErrorSubject.next(r)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Lg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,i,r)=>{this.navigateToSyncWithBrowser(e,r,i)})}navigateToSyncWithBrowser(e,i,r){let o={replaceUrl:!0},d=r?.navigationId?r:null;if(r){let b=Be({},r);delete b.navigationId,delete b.\u0275routerPageId,Object.keys(b).length!==0&&(o.state=b)}let m=this.parseUrl(e);this.scheduleNavigation(m,i,d,o).catch(b=>{this.disposed||this.injector.get(aa)(b)})}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return Cr(this.navigationTransitions.currentNavigation)}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(pP),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription?.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0,this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,i={}){let{relativeTo:r,queryParams:o,fragment:d,queryParamsHandling:m,preserveFragment:b}=i,T=b?this.currentUrlTree.fragment:d,A=null;switch(m??this.options.defaultQueryParamsHandling){case"merge":A=Be(Be({},this.currentUrlTree.queryParams),o);break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=o||null}A!==null&&(A=this.removeEmptyProps(A));let N;try{let q=r?r.snapshot:this.routerState.snapshot.root;N=G5(q)}catch(q){(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),N=this.currentUrlTree.root}return q5(N,e,A,T??null,this.urlSerializer)}navigateByUrl(e,i={skipLocationChange:!1}){let r=zd(e)?e:this.parseUrl(e),o=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(o,Lg,null,i)}navigate(e,i={skipLocationChange:!1}){return soe(e),this.navigateByUrl(this.createUrlTree(e,i),i)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch(i){return this.console.warn(Ma(4018,!1)),this.urlSerializer.parse("/")}}isActive(e,i){let r;if(i===!0?r=Be({},bP):i===!1?r=Be({},wP):r=i,zd(e))return XR(this.currentUrlTree,e,r);let o=this.parseUrl(e);return XR(this.currentUrlTree,o,r)}removeEmptyProps(e){return Object.entries(e).reduce((i,[r,o])=>(o!=null&&(i[r]=o),i),{})}scheduleNavigation(e,i,r,o,d){if(this.disposed)return Promise.resolve(!1);let m,b,T;d?(m=d.resolve,b=d.reject,T=d.promise):T=new Promise((N,q)=>{m=N,b=q});let A=this.pendingTasks.add();return KC(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(A))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:o,resolve:m,reject:b,promise:T,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),T.catch(N=>Promise.reject(N))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function soe(n){for(let t=0;t<n.length;t++)if(n[t]==null)throw new Je(4008,!1)}var $s=(()=>{class n{router;route;tabIndexAttribute;renderer;el;locationStrategy;reactiveHref=Zn(null);get href(){return Cr(this.reactiveHref)}set href(e){this.reactiveHref.set(e)}target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new yt;applicationErrorHandler=se(aa);options=se($d,{optional:!0});constructor(e,i,r,o,d,m){this.router=e,this.route=i,this.tabIndexAttribute=r,this.renderer=o,this.el=d,this.locationStrategy=m,this.reactiveHref.set(se(new R1("href"),{optional:!0}));let b=d.nativeElement.tagName?.toLowerCase();this.isAnchorElement=b==="a"||b==="area"||!!(typeof customElements=="object"&&customElements.get(b)?.observedAttributes?.includes?.("href")),this.isAnchorElement&&(this.setTabIndexIfNotOnNativeEl("0"),this.subscribeToNavigationEventsIfNecessary())}subscribeToNavigationEventsIfNecessary(){this.subscription===void 0&&(this.subscription=this.router.events.subscribe(e=>{e instanceof ma&&this.updateHref()}))}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(zd(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,i,r,o,d){let m=this.urlTree;if(m===null||this.isAnchorElement&&(e!==0||i||r||o||d||typeof this.target=="string"&&this.target!="_self"))return!0;let b={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(m,b)?.catch(T=>{this.applicationErrorHandler(T)}),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.reactiveHref.set(e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e))??"":null)}applyAttributeValue(e,i){let r=this.renderer,o=this.el.nativeElement;i!==null?r.setAttribute(o,e,i):r.removeAttribute(o,e)}get urlTree(){return this.routerLinkInput===null?null:zd(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||n)(Ze(lr),Ze(Ua),Nv("tabindex"),Ze(Br),Ze(Fn),Ze(bl))};static \u0275dir=sn({type:n,selectors:[["","routerLink",""]],hostVars:2,hostBindings:function(i,r){i&1&&Fe("click",function(d){return r.onClick(d.button,d.ctrlKey,d.shiftKey,d.altKey,d.metaKey)}),i&2&&uo("href",r.reactiveHref(),gk)("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",gr],skipLocationChange:[2,"skipLocationChange","skipLocationChange",gr],replaceUrl:[2,"replaceUrl","replaceUrl",gr],routerLink:"routerLink"},features:[Co]})}return n})(),D0=(()=>{class n{router;element;renderer;cdr;links;classes=[];routerEventsSubscription;linkInputChangesSubscription;_isActive=!1;get isActive(){return this._isActive}routerLinkActiveOptions={exact:!1};ariaCurrentWhenActive;isActiveChange=new xn;link=se($s,{optional:!0});constructor(e,i,r,o){this.router=e,this.element=i,this.renderer=r,this.cdr=o,this.routerEventsSubscription=e.events.subscribe(d=>{d instanceof ma&&this.update()})}ngAfterContentInit(){Jt(this.links.changes,Jt(null)).pipe(Jl()).subscribe(e=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let e=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=Bi(e).pipe(Jl()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(e){let i=Array.isArray(e)?e:e.split(" ");this.classes=i.filter(r=>!!r)}ngOnChanges(e){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let e=this.hasActiveLinks();this.classes.forEach(i=>{e?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),e&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==e&&(this._isActive=e,this.cdr.markForCheck(),this.isActiveChange.emit(e))})}isLinkActive(e){let i=aoe(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact??!1?Be({},bP):Be({},wP);return r=>{let o=r.urlTree;return o?Cr(uP(o,e,i)):!1}}hasActiveLinks(){let e=this.isLinkActive(this.router);return this.link&&e(this.link)||this.links.some(e)}static \u0275fac=function(i){return new(i||n)(Ze(lr),Ze(Fn),Ze(Br),Ze(Uo))};static \u0275dir=sn({type:n,selectors:[["","routerLinkActive",""]],contentQueries:function(i,r,o){if(i&1&&I1(o,$s,5),i&2){let d;Do(d=Io())&&(r.links=d)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Co]})}return n})();function aoe(n){return!!n.paths}var S0=class{};var _6=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(e,i,r,o){this.router=e,this.injector=i,this.preloadingStrategy=r,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(mi(e=>e instanceof ma),Ed(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription?.unsubscribe()}processRoutes(e,i){let r=[];for(let o of i){o.providers&&!o._injector&&(o._injector=Cg(o.providers,e,""));let d=o._injector??e;o._loadedNgModuleFactory&&!o._loadedInjector&&(o._loadedInjector=o._loadedNgModuleFactory.create(d).injector);let m=o._loadedInjector??d;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&r.push(this.preloadConfig(d,o)),(o.children||o._loadedRoutes)&&r.push(this.processRoutes(m,o.children??o._loadedRoutes))}return Bi(r).pipe(Jl())}preloadConfig(e,i){return this.preloadingStrategy.preload(i,()=>{if(e.destroyed)return Jt(null);let r;i.loadChildren&&i.canLoad===void 0?r=Bi(this.loader.loadChildren(e,i)):r=Jt(null);let o=r.pipe(Lo(d=>d===null?Jt(void 0):(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,i._loadedNgModuleFactory=d.factory,this.processRoutes(d.injector??e,d.routes))));if(i.loadComponent&&!i._loadedComponent){let d=this.loader.loadComponent(e,i);return Bi([o,d]).pipe(Jl())}else return o})}static \u0275fac=function(i){return new(i||n)(vt(lr),vt(si),vt(S0),vt(qC))};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),y6=new rt(""),loe=(()=>{class n{options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource=Lg;restoredId=0;store={};urlSerializer=se(op);zone=se(jt);viewportScroller=se(tR);transitions=se(ZC);constructor(e){this.options=e,this.options.scrollPositionRestoration||="disabled",this.options.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof Ud?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof ma?(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment)):e instanceof mc&&e.code===Vg.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{if(!(e instanceof zg)||e.scrollBehavior==="manual")return;let i={behavior:"instant"};e.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0],i):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(e.position,i):e.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(e.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0])})}scheduleScrollEvent(e,i){let r=Cr(this.transitions.currentNavigation)?.extras.scroll;this.zone.runOutsideAngular(()=>ae(this,null,function*(){yield new Promise(o=>{setTimeout(o),typeof requestAnimationFrame<"u"&&requestAnimationFrame(o)}),this.zone.run(()=>{this.transitions.events.next(new zg(e,this.lastSource==="popstate"?this.store[this.restoredId]:null,i,r))})}))}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(i){kk()};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})();function EP(n,...t){return dl([{provide:ap,multi:!0,useValue:n},[],{provide:Ua,useFactory:v6},{provide:jv,multi:!0,useFactory:b6},t.map(e=>e.\u0275providers)])}function v6(){return se(lr).routerState.root}function I0(n,t){return{\u0275kind:n,\u0275providers:t}}function b6(){let n=se(en);return t=>{let e=n.get(To);if(t!==e.components[0])return;let i=n.get(lr),r=n.get(w6);n.get(CP)===1&&i.initialNavigation(),n.get(C6,null,{optional:!0})?.setUpPreloading(),n.get(y6,null,{optional:!0})?.init(),i.resetRootComponentType(e.componentTypes[0]),r.closed||(r.next(),r.complete(),r.unsubscribe())}}var w6=new rt("",{factory:()=>new yt}),CP=new rt("",{factory:()=>1});function x6(){let n=[{provide:_1,useValue:!0},{provide:CP,useValue:0},Tg(()=>{let t=se(en);return t.get(qk,Promise.resolve()).then(()=>new Promise(i=>{let r=t.get(lr),o=t.get(w6);KC(r,()=>{i(!0)}),t.get(ZC).afterPreactivation=()=>(i(!0),o.closed?Jt(void 0):o),r.initialNavigation()}))})];return I0(2,n)}function E6(){let n=[Tg(()=>{se(lr).setUpLocationChangeListener()}),{provide:CP,useValue:2}];return I0(3,n)}var C6=new rt("");function T6(n){return I0(0,[{provide:C6,useExisting:_6},{provide:S0,useExisting:n}])}function S6(){return I0(8,[hP,{provide:C0,useExisting:hP}])}function D6(n){ca("NgRouterViewTransitions");let t=[{provide:gP,useValue:p6},{provide:_P,useValue:Be({skipNextTransition:!!n?.skipInitialTransition},n)}];return I0(9,t)}var I6=[hc,{provide:op,useClass:Cu},lr,sp,{provide:Ua,useFactory:v6},qC,[]],Sl=(()=>{class n{constructor(){}static forRoot(e,i){return{ngModule:n,providers:[I6,[],{provide:ap,multi:!0,useValue:e},[],i?.errorHandler?{provide:yP,useValue:i.errorHandler}:[],{provide:$d,useValue:i||{}},i?.useHash?uoe():doe(),coe(),i?.preloadingStrategy?T6(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?hoe(i):[],i?.bindToComponentInputs?S6().\u0275providers:[],i?.enableViewTransitions?D6().\u0275providers:[],foe()]}}static forChild(e){return{ngModule:n,providers:[{provide:ap,multi:!0,useValue:e}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})();function coe(){return{provide:y6,useFactory:()=>{let n=se(tR),t=se($d);return t.scrollOffset&&n.setOffset(t.scrollOffset),new loe(t)}}}function uoe(){return{provide:bl,useClass:Xk}}function doe(){return{provide:bl,useClass:F1}}function hoe(n){return[n.initialNavigation==="disabled"?E6().\u0275providers:[],n.initialNavigation==="enabledBlocking"?x6().\u0275providers:[]]}var xP=new rt("");function foe(){return[{provide:xP,useFactory:b6},{provide:jv,multi:!0,useExisting:xP}]}function poe(n){let t=n,e=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length,r=parseInt(n.toString().replace(/^[^e]*(e([-+]?\d+))?/,"$2"))||0;return e===0||e===1?1:r===0&&e!==0&&e%1e6===0&&i===0||!(r>=0&&r<=5)?4:5}var YC=["fr",[["AM","PM"]],void 0,[["D","L","M","M","J","V","S"],["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],["di","lu","ma","me","je","ve","sa"]],void 0,[["J","F","M","A","M","J","J","A","S","O","N","D"],["janv.","f\xE9vr.","mars","avr.","mai","juin","juil.","ao\xFBt","sept.","oct.","nov.","d\xE9c."],["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"]],void 0,[["av. J.-C.","ap. J.-C."],void 0,["avant J\xE9sus-Christ","apr\xE8s J\xE9sus-Christ"]],1,[6,0],["dd/MM/y","d MMM y","d MMMM y","EEEE d MMMM y"],["HH:mm","HH:mm:ss","HH:mm:ss z","HH:mm:ss zzzz"],["{1} {0}","{1}, {0}",void 0,void 0],[",","\u202F",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0\xA0%","#,##0.00\xA0\xA4","#E0"],"EUR","\u20AC","euro",{ARS:["$AR","$"],AUD:["$AU","$"],BEF:["FB"],BMD:["$BM","$"],BND:["$BN","$"],BYN:[void 0,"\u0440."],BZD:["$BZ","$"],CAD:["$CA","$"],CLP:["$CL","$"],CNY:[void 0,"\xA5"],COP:["$CO","$"],CYP:["\xA3CY"],EGP:[void 0,"\xA3E"],FJD:["$FJ","$"],FKP:["\xA3FK","\xA3"],FRF:["F"],GBP:["\xA3GB","\xA3"],GIP:["\xA3GI","\xA3"],HKD:[void 0,"$"],IEP:["\xA3IE"],ILP:["\xA3IL"],ITL:["\u20A4IT"],JPY:[void 0,"\xA5"],KMF:[void 0,"FC"],LBP:["\xA3LB","\xA3L"],MTP:["\xA3MT"],MXN:["$MX","$"],NAD:["$NA","$"],NIO:[void 0,"$C"],NZD:["$NZ","$"],PHP:[void 0,"\u20B1"],RHD:["$RH"],RON:[void 0,"L"],RWF:[void 0,"FR"],SBD:["$SB","$"],SGD:["$SG","$"],SRD:["$SR","$"],TOP:[void 0,"$T"],TTD:["$TT","$"],TWD:[void 0,"NT$"],USD:["$US","$"],UYU:["$UY","$"],WST:["$WS"],XCD:[void 0,"$"],XPF:["FCFP"],ZMW:[void 0,"Kw"]},"ltr",poe];function lp(n){return n.buttons===0||n.detail===0}function cp(n){let t=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}var TP;function M6(){if(TP==null){let n=typeof document<"u"?document.head:null;TP=!!(n&&(n.createShadowRoot||n.attachShadow))}return TP}function up(n){if(M6()){let t=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function M0(){let n=typeof document<"u"&&document?document.activeElement:null;for(;n&&n.shadowRoot;){let t=n.shadowRoot.activeElement;if(t===n)break;n=t}return n}function mo(n){return n.composedPath?n.composedPath()[0]:n.target}var SP;try{SP=typeof Intl<"u"&&Intl.v8BreakIterator}catch(n){SP=!1}var _r=(()=>{class n{_platformId=se($f);isBrowser=this._platformId?a4(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||SP)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var A0;function A6(){if(A0==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>A0=!0}))}finally{A0=A0||!1}return A0}function Wg(n){return A6()?n:!!n.capture}function Hd(n,t=0){return k6(n)?Number(n):arguments.length===2?t:0}function k6(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}function go(n){return n instanceof Fn?n.nativeElement:n}var R6=new rt("cdk-input-modality-detector-options"),P6={ignoreKeys:[18,17,224,91,16]},N6=650,DP={passive:!0,capture:!0},O6=(()=>{class n{_platform=se(_r);_listenerCleanups;modalityDetected;modalityChanged;get mostRecentModality(){return this._modality.value}_mostRecentTarget=null;_modality=new Fr(null);_options;_lastTouchMs=0;_onKeydown=e=>{this._options?.ignoreKeys?.some(i=>i===e.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=mo(e))};_onMousedown=e=>{Date.now()-this._lastTouchMs<N6||(this._modality.next(lp(e)?"keyboard":"mouse"),this._mostRecentTarget=mo(e))};_onTouchstart=e=>{if(cp(e)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=mo(e)};constructor(){let e=se(jt),i=se(Ht),r=se(R6,{optional:!0});if(this._options=Be(Be({},P6),r),this.modalityDetected=this._modality.pipe(av(1)),this.modalityChanged=this.modalityDetected.pipe(uE()),this._platform.isBrowser){let o=se(pr).createRenderer(null,null);this._listenerCleanups=e.runOutsideAngular(()=>[o.listen(i,"keydown",this._onKeydown,DP),o.listen(i,"mousedown",this._onMousedown,DP),o.listen(i,"touchstart",this._onTouchstart,DP)])}}ngOnDestroy(){this._modality.complete(),this._listenerCleanups?.forEach(e=>e())}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),k0=(function(n){return n[n.IMMEDIATE=0]="IMMEDIATE",n[n.EVENTUAL=1]="EVENTUAL",n})(k0||{}),F6=new rt("cdk-focus-monitor-default-options"),XC=Wg({passive:!0,capture:!0}),R0=(()=>{class n{_ngZone=se(jt);_platform=se(_r);_inputModalityDetector=se(O6);_origin=null;_lastFocusOrigin=null;_windowFocused=!1;_windowFocusTimeoutId;_originTimeoutId;_originFromTouchInteraction=!1;_elementInfo=new Map;_monitoredElementCount=0;_rootNodeFocusListenerCount=new Map;_detectionMode;_windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=setTimeout(()=>this._windowFocused=!1)};_document=se(Ht);_stopInputModalityDetector=new yt;constructor(){let e=se(F6,{optional:!0});this._detectionMode=e?.detectionMode||k0.IMMEDIATE}_rootNodeFocusAndBlurListener=e=>{let i=mo(e);for(let r=i;r;r=r.parentElement)e.type==="focus"?this._onFocus(e,r):this._onBlur(e,r)};monitor(e,i=!1){let r=go(e);if(!this._platform.isBrowser||r.nodeType!==1)return Jt();let o=up(r)||this._document,d=this._elementInfo.get(r);if(d)return i&&(d.checkChildren=!0),d.subject;let m={checkChildren:i,subject:new yt,rootNode:o};return this._elementInfo.set(r,m),this._registerGlobalListeners(m),m.subject}stopMonitoring(e){let i=go(e),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(e,i,r){let o=go(e),d=this._document.activeElement;o===d?this._getClosestElementsInfo(o).forEach(([m,b])=>this._originChanged(m,i,b)):(this._setOrigin(i),typeof o.focus=="function"&&o.focus(r))}ngOnDestroy(){this._elementInfo.forEach((e,i)=>this.stopMonitoring(i))}_getWindow(){return this._document.defaultView||window}_getFocusOrigin(e){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(e)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:e&&this._isLastInteractionFromInputLabel(e)?"mouse":"program"}_shouldBeAttributedToTouch(e){return this._detectionMode===k0.EVENTUAL||!!e?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(e,i){e.classList.toggle("cdk-focused",!!i),e.classList.toggle("cdk-touch-focused",i==="touch"),e.classList.toggle("cdk-keyboard-focused",i==="keyboard"),e.classList.toggle("cdk-mouse-focused",i==="mouse"),e.classList.toggle("cdk-program-focused",i==="program")}_setOrigin(e,i=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=e,this._originFromTouchInteraction=e==="touch"&&i,this._detectionMode===k0.IMMEDIATE){clearTimeout(this._originTimeoutId);let r=this._originFromTouchInteraction?N6:1;this._originTimeoutId=setTimeout(()=>this._origin=null,r)}})}_onFocus(e,i){let r=this._elementInfo.get(i),o=mo(e);!r||!r.checkChildren&&i!==o||this._originChanged(i,this._getFocusOrigin(o),r)}_onBlur(e,i){let r=this._elementInfo.get(i);!r||r.checkChildren&&e.relatedTarget instanceof Node&&i.contains(e.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(e,i){e.subject.observers.length&&this._ngZone.run(()=>e.subject.next(i))}_registerGlobalListeners(e){if(!this._platform.isBrowser)return;let i=e.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,XC),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,XC)}),this._rootNodeFocusListenerCount.set(i,r+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Bo(this._stopInputModalityDetector)).subscribe(o=>{this._setOrigin(o,!0)}))}_removeGlobalListeners(e){let i=e.rootNode;if(this._rootNodeFocusListenerCount.has(i)){let r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,XC),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,XC),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(e,i,r){this._setClasses(e,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(e){let i=[];return this._elementInfo.forEach((r,o)=>{(o===e||r.checkChildren&&o.contains(e))&&i.push([o,r])}),i}_isLastInteractionFromInputLabel(e){let{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if(r!=="mouse"||!i||i===e||e.nodeName!=="INPUT"&&e.nodeName!=="TEXTAREA"||e.disabled)return!1;let o=e.labels;if(o){for(let d=0;d<o.length;d++)if(o[d].contains(i))return!0}return!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var QC=new WeakMap,$a=(()=>{class n{_appRef;_injector=se(en);_environmentInjector=se(si);load(e){let i=this._appRef=this._appRef||this._injector.get(To),r=QC.get(i);r||(r={loaders:new Set,refs:[]},QC.set(i,r),i.onDestroy(()=>{QC.get(i)?.refs.forEach(o=>o.destroy()),QC.delete(i)})),r.loaders.has(e)||(r.loaders.add(e),r.refs.push(P1(e,{environmentInjector:this._environmentInjector})))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var L6=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["ng-component"]],exportAs:["cdkVisuallyHidden"],decls:0,vars:0,template:function(i,r){},styles:[`.cdk-visually-hidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;outline:0;-webkit-appearance:none;-moz-appearance:none;left:0}[dir=rtl] .cdk-visually-hidden{left:auto;right:0}
`],encapsulation:2,changeDetection:0})}return n})(),JC;function goe(){if(JC===void 0&&(JC=null,typeof window<"u")){let n=window;n.trustedTypes!==void 0&&(JC=n.trustedTypes.createPolicy("angular#components",{createHTML:t=>t}))}return JC}function _oe(n){return goe()?.createHTML(n)||n}function B6(n,t,e){let i=e.sanitize(la.HTML,t);n.innerHTML=_oe(i||"")}function Gd(n){return Array.isArray(n)?n:[n]}var V6=new Set,dp,eT=(()=>{class n{_platform=se(_r);_nonce=se(xg,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):voe}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&yoe(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function yoe(n,t){if(!V6.has(n))try{dp||(dp=document.createElement("style"),t&&dp.setAttribute("nonce",t),dp.setAttribute("type","text/css"),document.head.appendChild(dp)),dp.sheet&&(dp.sheet.insertRule(`@media ${n} {body{ }}`,0),V6.add(n))}catch(e){console.error(e)}}function voe(n){return{matches:n==="all"||n==="",media:n,addListener:()=>{},removeListener:()=>{}}}var P0=(()=>{class n{_mediaMatcher=se(eT);_zone=se(jt);_queries=new Map;_destroySubject=new yt;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return j6(Gd(e)).some(r=>this._registerQuery(r).mql.matches)}observe(e){let r=j6(Gd(e)).map(d=>this._registerQuery(d).observable),o=tg(r);return o=xd(o.pipe(Xi(1)),o.pipe(av(1),uM(0))),o.pipe(Tn(d=>{let m={matches:!1,breakpoints:{}};return d.forEach(({matches:b,query:T})=>{m.matches=m.matches||b,m.breakpoints[T]=b}),m}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);let i=this._mediaMatcher.matchMedia(e),o={observable:new Kt(d=>{let m=b=>this._zone.run(()=>d.next(b));return i.addListener(m),()=>{i.removeListener(m)}}).pipe(ra(i),Tn(({matches:d})=>({query:e,matches:d})),Bo(this._destroySubject)),mql:i};return this._queries.set(e,o),o}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function j6(n){return n.map(t=>t.split(",")).reduce((t,e)=>t.concat(e)).map(t=>t.trim())}var boe=(()=>{class n{create(e){return typeof MutationObserver>"u"?null:new MutationObserver(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var z6=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[boe]})}return n})();var AP=(()=>{class n{_platform=se(_r);constructor(){}isDisabled(e){return e.hasAttribute("disabled")}isVisible(e){return xoe(e)&&getComputedStyle(e).visibility==="visible"}isTabbable(e){if(!this._platform.isBrowser)return!1;let i=woe(Aoe(e));if(i&&(U6(i)===-1||!this.isVisible(i)))return!1;let r=e.nodeName.toLowerCase(),o=U6(e);return e.hasAttribute("contenteditable")?o!==-1:r==="iframe"||r==="object"||this._platform.WEBKIT&&this._platform.IOS&&!Ioe(e)?!1:r==="audio"?e.hasAttribute("controls")?o!==-1:!1:r==="video"?o===-1?!1:o!==null?!0:this._platform.FIREFOX||e.hasAttribute("controls"):e.tabIndex>=0}isFocusable(e,i){return Moe(e)&&!this.isDisabled(e)&&(i?.ignoreVisibility||this.isVisible(e))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function woe(n){try{return n.frameElement}catch(t){return null}}function xoe(n){return!!(n.offsetWidth||n.offsetHeight||typeof n.getClientRects=="function"&&n.getClientRects().length)}function Eoe(n){let t=n.nodeName.toLowerCase();return t==="input"||t==="select"||t==="button"||t==="textarea"}function Coe(n){return Soe(n)&&n.type=="hidden"}function Toe(n){return Doe(n)&&n.hasAttribute("href")}function Soe(n){return n.nodeName.toLowerCase()=="input"}function Doe(n){return n.nodeName.toLowerCase()=="a"}function G6(n){if(!n.hasAttribute("tabindex")||n.tabIndex===void 0)return!1;let t=n.getAttribute("tabindex");return!!(t&&!isNaN(parseInt(t,10)))}function U6(n){if(!G6(n))return null;let t=parseInt(n.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}function Ioe(n){let t=n.nodeName.toLowerCase(),e=t==="input"&&n.type;return e==="text"||e==="password"||t==="select"||t==="textarea"}function Moe(n){return Coe(n)?!1:Eoe(n)||Toe(n)||n.hasAttribute("contenteditable")||G6(n)}function Aoe(n){return n.ownerDocument&&n.ownerDocument.defaultView||window}var MP=class{_element;_checker;_ngZone;_document;_injector;_startAnchor=null;_endAnchor=null;_hasAttached=!1;startAnchorListener=()=>this.focusLastTabbableElement();endAnchorListener=()=>this.focusFirstTabbableElement();get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_enabled=!0;constructor(t,e,i,r,o=!1,d){this._element=t,this._checker=e,this._ngZone=i,this._document=r,this._injector=d,o||this.attachAnchors()}destroy(){let t=this._startAnchor,e=this._endAnchor;t&&(t.removeEventListener("focus",this.startAnchorListener),t.remove()),e&&(e.removeEventListener("focus",this.endAnchorListener),e.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusInitialElement(t)))})}focusFirstTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusFirstTabbableElement(t)))})}focusLastTabbableElementWhenReady(t){return new Promise(e=>{this._executeOnStable(()=>e(this.focusLastTabbableElement(t)))})}_getRegionBoundary(t){let e=this._element.querySelectorAll(`[cdk-focus-region-${t}], [cdkFocusRegion${t}], [cdk-focus-${t}]`);return t=="start"?e.length?e[0]:this._getFirstTabbableElement(this._element):e.length?e[e.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(t){let e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(e){if(!this._checker.isFocusable(e)){let i=this._getFirstTabbableElement(e);return i?.focus(t),!!i}return e.focus(t),!0}return this.focusFirstTabbableElement(t)}focusFirstTabbableElement(t){let e=this._getRegionBoundary("start");return e&&e.focus(t),!!e}focusLastTabbableElement(t){let e=this._getRegionBoundary("end");return e&&e.focus(t),!!e}hasAttached(){return this._hasAttached}_getFirstTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children;for(let i=0;i<e.length;i++){let r=e[i].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(e[i]):null;if(r)return r}return null}_getLastTabbableElement(t){if(this._checker.isFocusable(t)&&this._checker.isTabbable(t))return t;let e=t.children;for(let i=e.length-1;i>=0;i--){let r=e[i].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(e[i]):null;if(r)return r}return null}_createAnchor(){let t=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,t),t.classList.add("cdk-visually-hidden"),t.classList.add("cdk-focus-trap-anchor"),t.setAttribute("aria-hidden","true"),t}_toggleAnchorTabIndex(t,e){t?e.setAttribute("tabindex","0"):e.removeAttribute("tabindex")}toggleAnchors(t){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(t,this._startAnchor),this._toggleAnchorTabIndex(t,this._endAnchor))}_executeOnStable(t){this._injector?co(t,{injector:this._injector}):setTimeout(t)}},kP=(()=>{class n{_checker=se(AP);_ngZone=se(jt);_document=se(Ht);_injector=se(en);constructor(){se($a).load(L6)}create(e,i=!1){return new MP(e,this._checker,this._ngZone,this._document,i,this._injector)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var q6=new rt("liveAnnouncerElement",{providedIn:"root",factory:()=>null}),W6=new rt("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),koe=0,RP=(()=>{class n{_ngZone=se(jt);_defaultOptions=se(W6,{optional:!0});_liveElement;_document=se(Ht);_sanitizer=se(pR);_previousTimeout;_currentPromise;_currentResolve;constructor(){let e=se(q6,{optional:!0});this._liveElement=e||this._createLiveElement()}announce(e,...i){let r=this._defaultOptions,o,d;return i.length===1&&typeof i[0]=="number"?d=i[0]:[o,d]=i,this.clear(),clearTimeout(this._previousTimeout),o||(o=r&&r.politeness?r.politeness:"polite"),d==null&&r&&(d=r.duration),this._liveElement.setAttribute("aria-live",o),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(m=>this._currentResolve=m)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{!e||typeof e=="string"?this._liveElement.textContent=e:B6(this._liveElement,e,this._sanitizer),typeof d=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),d)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let e="cdk-live-announcer-element",i=this._document.getElementsByClassName(e),r=this._document.createElement("div");for(let o=0;o<i.length;o++)i[o].remove();return r.classList.add(e),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),r.id=`cdk-live-announcer-${koe++}`,this._document.body.appendChild(r),r}_exposeAnnouncerToModals(e){let i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){let o=i[r],d=o.getAttribute("aria-owns");d?d.indexOf(e)===-1&&o.setAttribute("aria-owns",d+" "+e):o.setAttribute("aria-owns",e)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var qd=(function(n){return n[n.NONE=0]="NONE",n[n.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",n[n.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",n})(qd||{}),$6="cdk-high-contrast-black-on-white",H6="cdk-high-contrast-white-on-black",IP="cdk-high-contrast-active",Z6=(()=>{class n{_platform=se(_r);_hasCheckedHighContrastMode=!1;_document=se(Ht);_breakpointSubscription;constructor(){this._breakpointSubscription=se(P0).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return qd.NONE;let e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);let i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(e):null,o=(r&&r.backgroundColor||"").replace(/ /g,"");switch(e.remove(),o){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return qd.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return qd.BLACK_ON_WHITE}return qd.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let e=this._document.body.classList;e.remove(IP,$6,H6),this._hasCheckedHighContrastMode=!0;let i=this.getHighContrastMode();i===qd.BLACK_ON_WHITE?e.add(IP,$6):i===qd.WHITE_ON_BLACK&&e.add(IP,H6)}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),PP=(()=>{class n{constructor(){se(Z6)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[z6]})}return n})();var NP={},ga=class n{_appId=se(wg);static _infix=`a${Math.floor(Math.random()*1e5).toString()}`;getId(t,e=!1){return this._appId!=="ng"&&(t+=this._appId),NP.hasOwnProperty(t)||(NP[t]=0),`${t}${e?n._infix+"-":""}${NP[t]++}`}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})};function tT(n,...t){return t.length?t.some(e=>n[e]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}var hp;function K6(){if(hp==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return hp=!1,hp;if(document.documentElement?.style&&"scrollBehavior"in document.documentElement.style)hp=!0;else{let n=Element.prototype.scrollTo;n?hp=!/\{\s*\[native code\]\s*\}/.test(n.toString()):hp=!1}}return hp}function OP(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var Y6={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};var Roe=new rt("MATERIAL_ANIMATIONS"),X6=null;function Poe(){return se(Roe,{optional:!0})?.animationsDisabled||se(Od,{optional:!0})==="NoopAnimations"?"di-disabled":(X6??=se(eT).matchMedia("(prefers-reduced-motion)").matches,X6?"reduced-motion":"enabled")}function _c(){return Poe()!=="enabled"}function Vr(n){return n==null?"":typeof n=="string"?n:`${n}px`}var Ha=(function(n){return n[n.FADING_IN=0]="FADING_IN",n[n.VISIBLE=1]="VISIBLE",n[n.FADING_OUT=2]="FADING_OUT",n[n.HIDDEN=3]="HIDDEN",n})(Ha||{}),FP=class{_renderer;element;config;_animationForciblyDisabledThroughCss;state=Ha.HIDDEN;constructor(t,e,i,r=!1){this._renderer=t,this.element=e,this.config=i,this._animationForciblyDisabledThroughCss=r}fadeOut(){this._renderer.fadeOutRipple(this)}},Q6=Wg({passive:!0,capture:!0}),LP=class{_events=new Map;addHandler(t,e,i,r){let o=this._events.get(e);if(o){let d=o.get(i);d?d.add(r):o.set(i,new Set([r]))}else this._events.set(e,new Map([[i,new Set([r])]])),t.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,Q6)})}removeHandler(t,e,i){let r=this._events.get(t);if(!r)return;let o=r.get(e);o&&(o.delete(i),o.size===0&&r.delete(e),r.size===0&&(this._events.delete(t),document.removeEventListener(t,this._delegateEventHandler,Q6)))}_delegateEventHandler=t=>{let e=mo(t);e&&this._events.get(t.type)?.forEach((i,r)=>{(r===e||r.contains(e))&&i.forEach(o=>o.handleEvent(t))})}},N0={enterDuration:225,exitDuration:150},Noe=800,J6=Wg({passive:!0,capture:!0}),e$=["mousedown","touchstart"],t$=["mouseup","mouseleave","touchend","touchcancel"],Ooe=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["ng-component"]],hostAttrs:["mat-ripple-style-loader",""],decls:0,vars:0,template:function(i,r){},styles:[`.mat-ripple{overflow:hidden;position:relative}.mat-ripple:not(:empty){transform:translateZ(0)}.mat-ripple.mat-ripple-unbounded{overflow:visible}.mat-ripple-element{position:absolute;border-radius:50%;pointer-events:none;transition:opacity,transform 0ms cubic-bezier(0, 0, 0.2, 1);transform:scale3d(0, 0, 0);background-color:var(--mat-ripple-color, color-mix(in srgb, var(--mat-sys-on-surface) 10%, transparent))}@media(forced-colors: active){.mat-ripple-element{display:none}}.cdk-drag-preview .mat-ripple-element,.cdk-drag-placeholder .mat-ripple-element{display:none}
`],encapsulation:2,changeDetection:0})}return n})(),nT=class n{_target;_ngZone;_platform;_containerElement;_triggerElement=null;_isPointerDown=!1;_activeRipples=new Map;_mostRecentTransientRipple=null;_lastTouchStartEvent;_pointerUpEventsRegistered=!1;_containerRect=null;static _eventManager=new LP;constructor(t,e,i,r,o){this._target=t,this._ngZone=e,this._platform=r,r.isBrowser&&(this._containerElement=go(i)),o&&o.get($a).load(Ooe)}fadeInRipple(t,e,i={}){let r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),o=Be(Be({},N0),i.animation);i.centered&&(t=r.left+r.width/2,e=r.top+r.height/2);let d=i.radius||Foe(t,e,r),m=t-r.left,b=e-r.top,T=o.enterDuration,A=document.createElement("div");A.classList.add("mat-ripple-element"),A.style.left=`${m-d}px`,A.style.top=`${b-d}px`,A.style.height=`${d*2}px`,A.style.width=`${d*2}px`,i.color!=null&&(A.style.backgroundColor=i.color),A.style.transitionDuration=`${T}ms`,this._containerElement.appendChild(A);let N=window.getComputedStyle(A),q=N.transitionProperty,J=N.transitionDuration,K=q==="none"||J==="0s"||J==="0s, 0s"||r.width===0&&r.height===0,xe=new FP(this,A,i,K);A.style.transform="scale3d(1, 1, 1)",xe.state=Ha.FADING_IN,i.persistent||(this._mostRecentTransientRipple=xe);let Te=null;return!K&&(T||o.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Ge=()=>{Te&&(Te.fallbackTimer=null),clearTimeout(kt),this._finishRippleTransition(xe)},Et=()=>this._destroyRipple(xe),kt=setTimeout(Et,T+100);A.addEventListener("transitionend",Ge),A.addEventListener("transitioncancel",Et),Te={onTransitionEnd:Ge,onTransitionCancel:Et,fallbackTimer:kt}}),this._activeRipples.set(xe,Te),(K||!T)&&this._finishRippleTransition(xe),xe}fadeOutRipple(t){if(t.state===Ha.FADING_OUT||t.state===Ha.HIDDEN)return;let e=t.element,i=Be(Be({},N0),t.config.animation);e.style.transitionDuration=`${i.exitDuration}ms`,e.style.opacity="0",t.state=Ha.FADING_OUT,(t._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(t)}fadeOutAll(){this._getActiveRipples().forEach(t=>t.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(t=>{t.config.persistent||t.fadeOut()})}setupTriggerEvents(t){let e=go(t);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,e$.forEach(i=>{n._eventManager.addHandler(this._ngZone,i,e,this)}))}handleEvent(t){t.type==="mousedown"?this._onMousedown(t):t.type==="touchstart"?this._onTouchStart(t):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{t$.forEach(e=>{this._triggerElement.addEventListener(e,this,J6)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(t){t.state===Ha.FADING_IN?this._startFadeOutTransition(t):t.state===Ha.FADING_OUT&&this._destroyRipple(t)}_startFadeOutTransition(t){let e=t===this._mostRecentTransientRipple,{persistent:i}=t.config;t.state=Ha.VISIBLE,!i&&(!e||!this._isPointerDown)&&t.fadeOut()}_destroyRipple(t){let e=this._activeRipples.get(t)??null;this._activeRipples.delete(t),this._activeRipples.size||(this._containerRect=null),t===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),t.state=Ha.HIDDEN,e!==null&&(t.element.removeEventListener("transitionend",e.onTransitionEnd),t.element.removeEventListener("transitioncancel",e.onTransitionCancel),e.fallbackTimer!==null&&clearTimeout(e.fallbackTimer)),t.element.remove()}_onMousedown(t){let e=lp(t),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+Noe;!this._target.rippleDisabled&&!e&&!i&&(this._isPointerDown=!0,this.fadeInRipple(t.clientX,t.clientY,this._target.rippleConfig))}_onTouchStart(t){if(!this._target.rippleDisabled&&!cp(t)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let e=t.changedTouches;if(e)for(let i=0;i<e.length;i++)this.fadeInRipple(e[i].clientX,e[i].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(t=>{let e=t.state===Ha.VISIBLE||t.config.terminateOnPointerUp&&t.state===Ha.FADING_IN;!t.config.persistent&&e&&t.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let t=this._triggerElement;t&&(e$.forEach(e=>n._eventManager.removeHandler(e,t,this)),this._pointerUpEventsRegistered&&(t$.forEach(e=>t.removeEventListener(e,this,J6)),this._pointerUpEventsRegistered=!1))}};function Foe(n,t,e){let i=Math.max(Math.abs(n-e.left),Math.abs(n-e.right)),r=Math.max(Math.abs(t-e.top),Math.abs(t-e.bottom));return Math.sqrt(i*i+r*r)}var n$=new rt("mat-ripple-global-options");var Loe={capture:!0},Boe=["focus","mousedown","mouseenter","touchstart"],BP="mat-ripple-loader-uninitialized",VP="mat-ripple-loader-class-name",i$="mat-ripple-loader-centered",iT="mat-ripple-loader-disabled",r$=(()=>{class n{_document=se(Ht);_animationsDisabled=_c();_globalRippleOptions=se(n$,{optional:!0});_platform=se(_r);_ngZone=se(jt);_injector=se(en);_eventCleanups;_hosts=new Map;constructor(){let e=se(pr).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>Boe.map(i=>e.listen(this._document,i,this._onInteraction,Loe)))}ngOnDestroy(){let e=this._hosts.keys();for(let i of e)this.destroyRipple(i);this._eventCleanups.forEach(i=>i())}configureRipple(e,i){e.setAttribute(BP,this._globalRippleOptions?.namespace??""),(i.className||!e.hasAttribute(VP))&&e.setAttribute(VP,i.className||""),i.centered&&e.setAttribute(i$,""),i.disabled&&e.setAttribute(iT,"")}setDisabled(e,i){let r=this._hosts.get(e);r?(r.target.rippleDisabled=i,!i&&!r.hasSetUpEvents&&(r.hasSetUpEvents=!0,r.renderer.setupTriggerEvents(e))):i?e.setAttribute(iT,""):e.removeAttribute(iT)}_onInteraction=e=>{let i=mo(e);if(i instanceof HTMLElement){let r=i.closest(`[${BP}="${this._globalRippleOptions?.namespace??""}"]`);r&&this._createRipple(r)}};_createRipple(e){if(!this._document||this._hosts.has(e))return;e.querySelector(".mat-ripple")?.remove();let i=this._document.createElement("span");i.classList.add("mat-ripple",e.getAttribute(VP)),e.append(i);let r=this._globalRippleOptions,o=this._animationsDisabled?0:r?.animation?.enterDuration??N0.enterDuration,d=this._animationsDisabled?0:r?.animation?.exitDuration??N0.exitDuration,m={rippleDisabled:this._animationsDisabled||r?.disabled||e.hasAttribute(iT),rippleConfig:{centered:e.hasAttribute(i$),terminateOnPointerUp:r?.terminateOnPointerUp,animation:{enterDuration:o,exitDuration:d}}},b=new nT(m,this._ngZone,i,this._platform,this._injector),T=!m.rippleDisabled;T&&b.setupTriggerEvents(e),this._hosts.set(e,{target:m,renderer:b,hasSetUpEvents:T}),e.removeAttribute(BP)}destroyRipple(e){let i=this._hosts.get(e);i&&(i.renderer._removeTriggerEvents(),this._hosts.delete(e))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var o$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["structural-styles"]],decls:0,vars:0,template:function(i,r){},styles:[`.mat-focus-indicator{position:relative}.mat-focus-indicator::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;display:var(--mat-focus-indicator-display, none);border-width:var(--mat-focus-indicator-border-width, 3px);border-style:var(--mat-focus-indicator-border-style, solid);border-color:var(--mat-focus-indicator-border-color, transparent);border-radius:var(--mat-focus-indicator-border-radius, 4px)}.mat-focus-indicator:focus-visible::before{content:""}@media(forced-colors: active){html{--mat-focus-indicator-display: block}}
`],encapsulation:2,changeDetection:0})}return n})();var Voe=new rt("MAT_BUTTON_CONFIG");function s$(n){return n==null?void 0:Hv(n)}var a$=(()=>{class n{_elementRef=se(Fn);_ngZone=se(jt);_animationsDisabled=_c();_config=se(Voe,{optional:!0});_focusMonitor=se(R0);_cleanupClick;_renderer=se(Br);_rippleLoader=se(r$);_isAnchor;_isFab=!1;color;get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=e,this._updateRippleDisabled()}_disableRipple=!1;get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._updateRippleDisabled()}_disabled=!1;ariaDisabled;disabledInteractive;tabIndex;set _tabindex(e){this.tabIndex=e}constructor(){se($a).load(o$);let e=this._elementRef.nativeElement;this._isAnchor=e.tagName==="A",this.disabledInteractive=this._config?.disabledInteractive??!1,this.color=this._config?.color??null,this._rippleLoader?.configureRipple(e,{className:"mat-mdc-button-ripple"})}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0),this._isAnchor&&this._setupAsAnchor()}ngOnDestroy(){this._cleanupClick?.(),this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(e="program",i){e?this._focusMonitor.focusVia(this._elementRef.nativeElement,e,i):this._elementRef.nativeElement.focus(i)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this._isAnchor?this.disabled||null:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}_getTabIndex(){return this._isAnchor?this.disabled&&!this.disabledInteractive?-1:this.tabIndex:this.tabIndex}_setupAsAnchor(){this._cleanupClick=this._ngZone.runOutsideAngular(()=>this._renderer.listen(this._elementRef.nativeElement,"click",e=>{this.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}))}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,hostAttrs:[1,"mat-mdc-button-base"],hostVars:13,hostBindings:function(i,r){i&2&&(uo("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled())("tabindex",r._getTabIndex()),Ri(r.color?"mat-"+r.color:""),ji("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("mat-unthemed",!r.color)("_mat-animation-noopable",r._animationsDisabled))},inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",gr],disabled:[2,"disabled","disabled",gr],ariaDisabled:[2,"aria-disabled","ariaDisabled",gr],disabledInteractive:[2,"disabledInteractive","disabledInteractive",gr],tabIndex:[2,"tabIndex","tabIndex",s$],_tabindex:[2,"tabindex","_tabindex",s$]}})}return n})();var joe=new rt("cdk-dir-doc",{providedIn:"root",factory:()=>se(Ht)}),zoe=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function Uoe(n){let t=n?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?zoe.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var Wd=(()=>{class n{get value(){return this.valueSignal()}valueSignal=Zn("ltr");change=new xn;constructor(){let e=se(joe,{optional:!0});if(e){let i=e.body?e.body.dir:null,r=e.documentElement?e.documentElement.dir:null;this.valueSignal.set(Uoe(i||r||"ltr"))}}ngOnDestroy(){this.change.complete()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var _a=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})();var l$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[_a]})}return n})();var $oe=["matButton",""],Hoe=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],Goe=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var c$=new Map([["text",["mat-mdc-button"]],["filled",["mdc-button--unelevated","mat-mdc-unelevated-button"]],["elevated",["mdc-button--raised","mat-mdc-raised-button"]],["outlined",["mdc-button--outlined","mat-mdc-outlined-button"]],["tonal",["mat-tonal-button"]]]),u$=(()=>{class n extends a${get appearance(){return this._appearance}set appearance(e){this.setAppearance(e||this._config?.defaultAppearance||"text")}_appearance=null;constructor(){super();let e=qoe(this._elementRef.nativeElement);e&&this.setAppearance(e)}setAppearance(e){if(e===this._appearance)return;let i=this._elementRef.nativeElement.classList,r=this._appearance?c$.get(this._appearance):null,o=c$.get(e);r&&i.remove(...r),i.add(...o),this._appearance=e}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["button","matButton",""],["a","matButton",""],["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""],["a","mat-button",""],["a","mat-raised-button",""],["a","mat-flat-button",""],["a","mat-stroked-button",""]],hostAttrs:[1,"mdc-button"],inputs:{appearance:[0,"matButton","appearance"]},exportAs:["matButton","matAnchor"],features:[ci],attrs:$oe,ngContentSelectors:Goe,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(i,r){i&1&&(Uv(Hoe),zo(0,"span",0),Gf(1),Ot(2,"span",1),Gf(3,1),At(),Gf(4,2),zo(5,"span",2)(6,"span",3)),i&2&&ji("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:[`.mat-mdc-button-base{text-decoration:none}.mat-mdc-button-base .mat-icon{min-height:fit-content;flex-shrink:0}@media(hover: none){.mat-mdc-button-base:hover>span.mat-mdc-button-persistent-ripple::before{opacity:0}}.mdc-button{-webkit-user-select:none;user-select:none;position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0);padding:0 8px}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__label{position:relative}.mat-mdc-button{padding:0 var(--mat-button-text-horizontal-padding, 12px);height:var(--mat-button-text-container-height, 40px);font-family:var(--mat-button-text-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-text-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-text-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-text-label-text-transform);font-weight:var(--mat-button-text-label-text-weight, var(--mat-sys-label-large-weight))}.mat-mdc-button,.mat-mdc-button .mdc-button__ripple{border-radius:var(--mat-button-text-container-shape, var(--mat-sys-corner-full))}.mat-mdc-button:not(:disabled){color:var(--mat-button-text-label-text-color, var(--mat-sys-primary))}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-text-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-button-text-with-icon-horizontal-padding, 16px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-offset, -4px);margin-left:var(--mat-button-text-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-text-icon-spacing, 8px);margin-left:var(--mat-button-text-icon-offset, -4px)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-button-text-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-state-layer-color, var(--mat-sys-primary))}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-text-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-text-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-text-touch-target-size, 48px);display:var(--mat-button-text-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-filled-container-height, 40px);font-family:var(--mat-button-filled-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-filled-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-filled-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-filled-label-text-transform);font-weight:var(--mat-button-filled-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-filled-horizontal-padding, 24px)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-offset, -8px);margin-left:var(--mat-button-filled-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-filled-icon-spacing, 8px);margin-left:var(--mat-button-filled-icon-offset, -8px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-button-filled-ripple-color, color-mix(in srgb, var(--mat-sys-on-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-state-layer-color, var(--mat-sys-on-primary))}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-filled-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-unelevated-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-unelevated-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-unelevated-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-filled-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-filled-touch-target-size, 48px);display:var(--mat-button-filled-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mat-button-filled-label-text-color, var(--mat-sys-on-primary));background-color:var(--mat-button-filled-container-color, var(--mat-sys-primary))}.mat-mdc-unelevated-button,.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mat-button-filled-container-shape, var(--mat-sys-corner-full))}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-filled-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-filled-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);box-shadow:var(--mat-button-protected-container-elevation-shadow, var(--mat-sys-level1));height:var(--mat-button-protected-container-height, 40px);font-family:var(--mat-button-protected-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-protected-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-protected-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-protected-label-text-transform);font-weight:var(--mat-button-protected-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-protected-horizontal-padding, 24px)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-offset, -8px);margin-left:var(--mat-button-protected-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-protected-icon-spacing, 8px);margin-left:var(--mat-button-protected-icon-offset, -8px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-button-protected-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-state-layer-color, var(--mat-sys-primary))}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-protected-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-raised-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-raised-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-raised-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-protected-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-protected-touch-target-size, 48px);display:var(--mat-button-protected-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-raised-button:not(:disabled){color:var(--mat-button-protected-label-text-color, var(--mat-sys-primary));background-color:var(--mat-button-protected-container-color, var(--mat-sys-surface))}.mat-mdc-raised-button,.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mat-button-protected-container-shape, var(--mat-sys-corner-full))}@media(hover: hover){.mat-mdc-raised-button:hover{box-shadow:var(--mat-button-protected-hover-container-elevation-shadow, var(--mat-sys-level2))}}.mat-mdc-raised-button:focus{box-shadow:var(--mat-button-protected-focus-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mat-button-protected-pressed-container-elevation-shadow, var(--mat-sys-level1))}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-protected-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-protected-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mat-button-protected-disabled-container-elevation-shadow, var(--mat-sys-level0))}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-outlined-container-height, 40px);font-family:var(--mat-button-outlined-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-outlined-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-outlined-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-outlined-label-text-transform);font-weight:var(--mat-button-outlined-label-text-weight, var(--mat-sys-label-large-weight));border-radius:var(--mat-button-outlined-container-shape, var(--mat-sys-corner-full));border-width:var(--mat-button-outlined-outline-width, 1px);padding:0 var(--mat-button-outlined-horizontal-padding, 24px)}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-offset, -8px);margin-left:var(--mat-button-outlined-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-outlined-icon-spacing, 8px);margin-left:var(--mat-button-outlined-icon-offset, -8px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-button-outlined-ripple-color, color-mix(in srgb, var(--mat-sys-primary) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-state-layer-color, var(--mat-sys-primary))}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-outlined-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-mdc-outlined-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-mdc-outlined-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-mdc-outlined-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-outlined-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-outlined-touch-target-size, 48px);display:var(--mat-button-outlined-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-outlined-button:not(:disabled){color:var(--mat-button-outlined-label-text-color, var(--mat-sys-primary));border-color:var(--mat-button-outlined-outline-color, var(--mat-sys-outline))}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-outlined-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));border-color:var(--mat-button-outlined-disabled-outline-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);height:var(--mat-button-tonal-container-height, 40px);font-family:var(--mat-button-tonal-label-text-font, var(--mat-sys-label-large-font));font-size:var(--mat-button-tonal-label-text-size, var(--mat-sys-label-large-size));letter-spacing:var(--mat-button-tonal-label-text-tracking, var(--mat-sys-label-large-tracking));text-transform:var(--mat-button-tonal-label-text-transform);font-weight:var(--mat-button-tonal-label-text-weight, var(--mat-sys-label-large-weight));padding:0 var(--mat-button-tonal-horizontal-padding, 24px)}.mat-tonal-button:not(:disabled){color:var(--mat-button-tonal-label-text-color, var(--mat-sys-on-secondary-container));background-color:var(--mat-button-tonal-container-color, var(--mat-sys-secondary-container))}.mat-tonal-button,.mat-tonal-button .mdc-button__ripple{border-radius:var(--mat-button-tonal-container-shape, var(--mat-sys-corner-full))}.mat-tonal-button[disabled],.mat-tonal-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mat-button-tonal-disabled-label-text-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent));background-color:var(--mat-button-tonal-disabled-container-color, color-mix(in srgb, var(--mat-sys-on-surface) 12%, transparent))}.mat-tonal-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}[dir=rtl] .mat-tonal-button>.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}.mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-offset, -8px);margin-left:var(--mat-button-tonal-icon-spacing, 8px)}[dir=rtl] .mat-tonal-button .mdc-button__label+.mat-icon{margin-right:var(--mat-button-tonal-icon-spacing, 8px);margin-left:var(--mat-button-tonal-icon-offset, -8px)}.mat-tonal-button .mat-ripple-element{background-color:var(--mat-button-tonal-ripple-color, color-mix(in srgb, var(--mat-sys-on-secondary-container) calc(var(--mat-sys-pressed-state-layer-opacity) * 100%), transparent))}.mat-tonal-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-state-layer-color, var(--mat-sys-on-secondary-container))}.mat-tonal-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-button-tonal-disabled-state-layer-color, var(--mat-sys-on-surface-variant))}.mat-tonal-button:hover>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-hover-state-layer-opacity, var(--mat-sys-hover-state-layer-opacity))}.mat-tonal-button.cdk-program-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.cdk-keyboard-focused>.mat-mdc-button-persistent-ripple::before,.mat-tonal-button.mat-mdc-button-disabled-interactive:focus>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-focus-state-layer-opacity, var(--mat-sys-focus-state-layer-opacity))}.mat-tonal-button:active>.mat-mdc-button-persistent-ripple::before{opacity:var(--mat-button-tonal-pressed-state-layer-opacity, var(--mat-sys-pressed-state-layer-opacity))}.mat-tonal-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:var(--mat-button-tonal-touch-target-size, 48px);display:var(--mat-button-tonal-touch-target-display, block);left:0;right:0;transform:translateY(-50%)}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button,.mat-tonal-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-tonal-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before,.mat-tonal-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon,.mat-tonal-button .mdc-button__label,.mat-tonal-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-focus-indicator,.mat-mdc-unelevated-button .mat-focus-indicator,.mat-mdc-raised-button .mat-focus-indicator,.mat-mdc-outlined-button .mat-focus-indicator,.mat-tonal-button .mat-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit}.mat-mdc-button:focus-visible>.mat-focus-indicator::before,.mat-mdc-unelevated-button:focus-visible>.mat-focus-indicator::before,.mat-mdc-raised-button:focus-visible>.mat-focus-indicator::before,.mat-mdc-outlined-button:focus-visible>.mat-focus-indicator::before,.mat-tonal-button:focus-visible>.mat-focus-indicator::before{content:"";border-radius:inherit}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable,.mat-tonal-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon,.mat-tonal-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px}.mat-mdc-unelevated-button .mat-focus-indicator::before,.mat-tonal-button .mat-focus-indicator::before,.mat-mdc-raised-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-focus-indicator::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}
`,`@media(forced-colors: active){.mat-mdc-button:not(.mdc-button--outlined),.mat-mdc-unelevated-button:not(.mdc-button--outlined),.mat-mdc-raised-button:not(.mdc-button--outlined),.mat-mdc-outlined-button:not(.mdc-button--outlined),.mat-mdc-button-base.mat-tonal-button,.mat-mdc-icon-button.mat-mdc-icon-button,.mat-mdc-outlined-button .mdc-button__ripple{outline:solid 1px}}
`],encapsulation:2,changeDetection:0})}return n})();function qoe(n){return n.hasAttribute("mat-raised-button")?"elevated":n.hasAttribute("mat-stroked-button")?"outlined":n.hasAttribute("mat-flat-button")?"filled":n.hasAttribute("mat-button")?"text":null}var d$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[l$,_a]})}return n})();var O0=class{_attachedHost=null;attach(t){return this._attachedHost=t,t.attach(this)}detach(){let t=this._attachedHost;t!=null&&(this._attachedHost=null,t.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(t){this._attachedHost=t}},Tu=class extends O0{component;viewContainerRef;injector;projectableNodes;constructor(t,e,i,r){super(),this.component=t,this.viewContainerRef=e,this.injector=i,this.projectableNodes=r}},Zd=class extends O0{templateRef;viewContainerRef;context;injector;constructor(t,e,i,r){super(),this.templateRef=t,this.viewContainerRef=e,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(t,e=this.context){return this.context=e,super.attach(t)}detach(){return this.context=void 0,super.detach()}},jP=class extends O0{element;constructor(t){super(),this.element=t instanceof Fn?t.nativeElement:t}},Kd=class{_attachedPortal=null;_disposeFn=null;_isDisposed=!1;hasAttached(){return!!this._attachedPortal}attach(t){if(t instanceof Tu)return this._attachedPortal=t,this.attachComponentPortal(t);if(t instanceof Zd)return this._attachedPortal=t,this.attachTemplatePortal(t);if(this.attachDomPortal&&t instanceof jP)return this._attachedPortal=t,this.attachDomPortal(t)}attachDomPortal=null;detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(t){this._disposeFn=t}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}},rT=class extends Kd{outletElement;_appRef;_defaultInjector;constructor(t,e,i){super(),this.outletElement=t,this._appRef=e,this._defaultInjector=i}attachComponentPortal(t){let e;if(t.viewContainerRef){let i=t.injector||t.viewContainerRef.injector,r=i.get(dc,null,{optional:!0})||void 0;e=t.viewContainerRef.createComponent(t.component,{index:t.viewContainerRef.length,injector:i,ngModuleRef:r,projectableNodes:t.projectableNodes||void 0}),this.setDisposeFn(()=>e.destroy())}else{let i=this._appRef,r=t.injector||this._defaultInjector||en.NULL,o=r.get(si,i.injector);e=P1(t.component,{elementInjector:r,environmentInjector:o,projectableNodes:t.projectableNodes||void 0}),i.attachView(e.hostView),this.setDisposeFn(()=>{i.viewCount>0&&i.detachView(e.hostView),e.destroy()})}return this.outletElement.appendChild(this._getComponentRootNode(e)),this._attachedPortal=t,e}attachTemplatePortal(t){let e=t.viewContainerRef,i=e.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=e.indexOf(i);r!==-1&&e.remove(r)}),this._attachedPortal=t,i}attachDomPortal=t=>{let e=t.element;e.parentNode;let i=this.outletElement.ownerDocument.createComment("dom-portal");e.parentNode.insertBefore(i,e),this.outletElement.appendChild(e),this._attachedPortal=t,super.setDisposeFn(()=>{i.parentNode&&i.parentNode.replaceChild(e,i)})};dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(t){return t.hostView.rootNodes[0]}};var Yd=(()=>{class n extends Kd{_moduleRef=se(dc,{optional:!0});_document=se(Ht);_viewContainerRef=se(ua);_isInitialized=!1;_attachedRef=null;constructor(){super()}get portal(){return this._attachedPortal}set portal(e){this.hasAttached()&&!e&&!this._isInitialized||(this.hasAttached()&&super.detach(),e&&super.attach(e),this._attachedPortal=e||null)}attached=new xn;get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(e){e.setAttachedHost(this);let i=e.viewContainerRef!=null?e.viewContainerRef:this._viewContainerRef,r=i.createComponent(e.component,{index:i.length,injector:e.injector||i.injector,projectableNodes:e.projectableNodes||void 0,ngModuleRef:this._moduleRef||void 0});return i!==this._viewContainerRef&&this._getRootNode().appendChild(r.hostView.rootNodes[0]),super.setDisposeFn(()=>r.destroy()),this._attachedPortal=e,this._attachedRef=r,this.attached.emit(r),r}attachTemplatePortal(e){e.setAttachedHost(this);let i=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=e,this._attachedRef=i,this.attached.emit(i),i}attachDomPortal=e=>{let i=e.element;i.parentNode;let r=this._document.createComment("dom-portal");e.setAttachedHost(this),i.parentNode.insertBefore(r,i),this._getRootNode().appendChild(i),this._attachedPortal=e,super.setDisposeFn(()=>{r.parentNode&&r.parentNode.replaceChild(i,r)})};_getRootNode(){let e=this._viewContainerRef.element.nativeElement;return e.nodeType===e.ELEMENT_NODE?e:e.parentNode}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[ci]})}return n})(),Su=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})();var Woe=20,F0=(()=>{class n{_ngZone=se(jt);_platform=se(_r);_renderer=se(pr).createRenderer(null,null);_cleanupGlobalListener;constructor(){}_scrolled=new yt;_scrolledCount=0;scrollContainers=new Map;register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let i=this.scrollContainers.get(e);i&&(i.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=Woe){return this._platform.isBrowser?new Kt(i=>{this._cleanupGlobalListener||(this._cleanupGlobalListener=this._ngZone.runOutsideAngular(()=>this._renderer.listen("document","scroll",()=>this._scrolled.next())));let r=e>0?this._scrolled.pipe(cE(e)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||(this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0)}}):Jt()}ngOnDestroy(){this._cleanupGlobalListener?.(),this._cleanupGlobalListener=void 0,this.scrollContainers.forEach((e,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(e,i){let r=this.getAncestorScrollContainers(e);return this.scrolled(i).pipe(mi(o=>!o||r.indexOf(o)>-1))}getAncestorScrollContainers(e){let i=[];return this.scrollContainers.forEach((r,o)=>{this._scrollableContainsElement(o,e)&&i.push(o)}),i}_scrollableContainsElement(e,i){let r=go(i),o=e.getElementRef().nativeElement;do if(r==o)return!0;while(r=r.parentElement);return!1}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Zoe=20,Xd=(()=>{class n{_platform=se(_r);_listeners;_viewportSize=null;_change=new yt;_document=se(Ht);constructor(){let e=se(jt),i=se(pr).createRenderer(null,null);e.runOutsideAngular(()=>{if(this._platform.isBrowser){let r=o=>this._change.next(o);this._listeners=[i.listen("window","resize",r),i.listen("window","orientationchange",r)]}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){this._listeners?.forEach(e=>e()),this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,i=this._getWindow(),r=e.documentElement,o=r.getBoundingClientRect(),d=-o.top||e.body?.scrollTop||i.scrollY||r.scrollTop||0,m=-o.left||e.body?.scrollLeft||i.scrollX||r.scrollLeft||0;return{top:d,left:m}}change(e=Zoe){return e>0?this._change.pipe(cE(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var oT=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})(),zP=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[_a,oT,_a,oT]})}return n})();var h$=K6();function Kg(n){return new sT(n.get(Xd),n.get(Ht))}var sT=class{_viewportRuler;_previousHTMLStyles={top:"",left:""};_previousScrollPosition;_isEnabled=!1;_document;constructor(t,e){this._viewportRuler=t,this._document=e}attach(){}enable(){if(this._canBeEnabled()){let t=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=t.style.left||"",this._previousHTMLStyles.top=t.style.top||"",t.style.left=Vr(-this._previousScrollPosition.left),t.style.top=Vr(-this._previousScrollPosition.top),t.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let t=this._document.documentElement,e=this._document.body,i=t.style,r=e.style,o=i.scrollBehavior||"",d=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,t.classList.remove("cdk-global-scrollblock"),h$&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),h$&&(i.scrollBehavior=o,r.scrollBehavior=d)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let e=this._document.documentElement,i=this._viewportRuler.getViewportSize();return e.scrollHeight>i.height||e.scrollWidth>i.width}};function v$(n,t){return new aT(n.get(F0),n.get(jt),n.get(Xd),t)}var aT=class{_scrollDispatcher;_ngZone;_viewportRuler;_config;_scrollSubscription=null;_overlayRef;_initialScrollPosition;constructor(t,e,i,r){this._scrollDispatcher=t,this._ngZone=e,this._viewportRuler=i,this._config=r}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(this._scrollSubscription)return;let t=this._scrollDispatcher.scrolled(0).pipe(mi(e=>!e||!this._overlayRef.overlayElement.contains(e.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe(()=>{let e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=t.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}_detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}};var L0=class{enable(){}disable(){}attach(){}};function UP(n,t){return t.some(e=>{let i=n.bottom<e.top,r=n.top>e.bottom,o=n.right<e.left,d=n.left>e.right;return i||r||o||d})}function f$(n,t){return t.some(e=>{let i=n.top<e.top,r=n.bottom>e.bottom,o=n.left<e.left,d=n.right>e.right;return i||r||o||d})}function b$(n,t){return new lT(n.get(F0),n.get(Xd),n.get(jt),t)}var lT=class{_scrollDispatcher;_viewportRuler;_ngZone;_config;_scrollSubscription=null;_overlayRef;constructor(t,e,i,r){this._scrollDispatcher=t,this._viewportRuler=e,this._ngZone=i,this._config=r}attach(t){this._overlayRef,this._overlayRef=t}enable(){if(!this._scrollSubscription){let t=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(t).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();UP(e,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},w$=(()=>{class n{_injector=se(en);constructor(){}noop=()=>new L0;close=e=>v$(this._injector,e);block=()=>Kg(this._injector);reposition=e=>b$(this._injector,e);static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Qd=class{positionStrategy;scrollStrategy=new L0;panelClass="";hasBackdrop=!1;backdropClass="cdk-overlay-dark-backdrop";disableAnimations;width;height;minWidth;minHeight;maxWidth;maxHeight;direction;disposeOnNavigation=!1;usePopover;constructor(t){if(t){let e=Object.keys(t);for(let i of e)t[i]!==void 0&&(this[i]=t[i])}}};var cT=class{connectionPair;scrollableViewProperties;constructor(t,e){this.connectionPair=t,this.scrollableViewProperties=e}};var x$=(()=>{class n{_attachedOverlays=[];_document=se(Ht);_isAttached=!1;constructor(){}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){let i=this._attachedOverlays.indexOf(e);i>-1&&this._attachedOverlays.splice(i,1),this._attachedOverlays.length===0&&this.detach()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),E$=(()=>{class n extends x${_ngZone=se(jt);_renderer=se(pr).createRenderer(null,null);_cleanupKeydown;add(e){super.add(e),this._isAttached||(this._ngZone.runOutsideAngular(()=>{this._cleanupKeydown=this._renderer.listen("body","keydown",this._keydownListener)}),this._isAttached=!0)}detach(){this._isAttached&&(this._cleanupKeydown?.(),this._isAttached=!1)}_keydownListener=e=>{let i=this._attachedOverlays;for(let r=i.length-1;r>-1;r--)if(i[r]._keydownEvents.observers.length>0){this._ngZone.run(()=>i[r]._keydownEvents.next(e));break}};static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),C$=(()=>{class n extends x${_platform=se(_r);_ngZone=se(jt);_renderer=se(pr).createRenderer(null,null);_cursorOriginalValue;_cursorStyleIsSet=!1;_pointerDownEventTarget=null;_cleanups;add(e){if(super.add(e),!this._isAttached){let i=this._document.body,r={capture:!0},o=this._renderer;this._cleanups=this._ngZone.runOutsideAngular(()=>[o.listen(i,"pointerdown",this._pointerDownListener,r),o.listen(i,"click",this._clickListener,r),o.listen(i,"auxclick",this._clickListener,r),o.listen(i,"contextmenu",this._clickListener,r)]),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){this._isAttached&&(this._cleanups?.forEach(e=>e()),this._cleanups=void 0,this._platform.IOS&&this._cursorStyleIsSet&&(this._document.body.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1)}_pointerDownListener=e=>{this._pointerDownEventTarget=mo(e)};_clickListener=e=>{let i=mo(e),r=e.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:i;this._pointerDownEventTarget=null;let o=this._attachedOverlays.slice();for(let d=o.length-1;d>-1;d--){let m=o[d];if(m._outsidePointerEvents.observers.length<1||!m.hasAttached())continue;if(p$(m.overlayElement,i)||p$(m.overlayElement,r))break;let b=m._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>b.next(e)):b.next(e)}};static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function p$(n,t){let e=typeof ShadowRoot<"u"&&ShadowRoot,i=t;for(;i;){if(i===n)return!0;i=e&&i instanceof ShadowRoot?i.host:i.parentNode}return!1}var T$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-overlay-style-loader",""],decls:0,vars:0,template:function(i,r){},styles:[`.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed}@layer cdk-overlay{.cdk-overlay-container{z-index:1000}}.cdk-overlay-container:empty{display:none}.cdk-global-overlay-wrapper{display:flex;position:absolute}@layer cdk-overlay{.cdk-global-overlay-wrapper{z-index:1000}}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;display:flex;max-width:100%;max-height:100%}@layer cdk-overlay{.cdk-overlay-pane{z-index:1000}}.cdk-overlay-backdrop{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:auto;-webkit-tap-highlight-color:rgba(0,0,0,0);opacity:0;touch-action:manipulation}@layer cdk-overlay{.cdk-overlay-backdrop{z-index:1000;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}}@media(prefers-reduced-motion){.cdk-overlay-backdrop{transition-duration:1ms}}.cdk-overlay-backdrop-showing{opacity:1}@media(forced-colors: active){.cdk-overlay-backdrop-showing{opacity:.6}}@layer cdk-overlay{.cdk-overlay-dark-backdrop{background:rgba(0,0,0,.32)}}.cdk-overlay-transparent-backdrop{transition:visibility 1ms linear,opacity 1ms linear;visibility:hidden;opacity:1}.cdk-overlay-transparent-backdrop.cdk-overlay-backdrop-showing,.cdk-high-contrast-active .cdk-overlay-transparent-backdrop{opacity:0;visibility:visible}.cdk-overlay-backdrop-noop-animation{transition:none}.cdk-overlay-connected-position-bounding-box{position:absolute;display:flex;flex-direction:column;min-width:1px;min-height:1px}@layer cdk-overlay{.cdk-overlay-connected-position-bounding-box{z-index:1000}}.cdk-global-scrollblock{position:fixed;width:100%;overflow-y:scroll}.cdk-overlay-popover{background:none;border:none;padding:0;outline:0;overflow:visible;position:fixed;pointer-events:none;white-space:normal;color:inherit;text-decoration:none;width:100%;height:100%;inset:auto;top:0;left:0}.cdk-overlay-popover::backdrop{display:none}.cdk-overlay-popover .cdk-overlay-backdrop{position:fixed;z-index:auto}
`],encapsulation:2,changeDetection:0})}return n})(),hT=(()=>{class n{_platform=se(_r);_containerElement;_document=se(Ht);_styleLoader=se($a);constructor(){}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._loadStyles(),this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let e="cdk-overlay-container";if(this._platform.isBrowser||OP()){let r=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let o=0;o<r.length;o++)r[o].remove()}let i=this._document.createElement("div");i.classList.add(e),OP()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}_loadStyles(){this._styleLoader.load(T$)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),$P=class{_renderer;_ngZone;element;_cleanupClick;_cleanupTransitionEnd;_fallbackTimeout;constructor(t,e,i,r){this._renderer=e,this._ngZone=i,this.element=t.createElement("div"),this.element.classList.add("cdk-overlay-backdrop"),this._cleanupClick=e.listen(this.element,"click",r)}detach(){this._ngZone.runOutsideAngular(()=>{let t=this.element;clearTimeout(this._fallbackTimeout),this._cleanupTransitionEnd?.(),this._cleanupTransitionEnd=this._renderer.listen(t,"transitionend",this.dispose),this._fallbackTimeout=setTimeout(this.dispose,500),t.style.pointerEvents="none",t.classList.remove("cdk-overlay-backdrop-showing")})}dispose=()=>{clearTimeout(this._fallbackTimeout),this._cleanupClick?.(),this._cleanupTransitionEnd?.(),this._cleanupClick=this._cleanupTransitionEnd=this._fallbackTimeout=void 0,this.element.remove()}};function HP(n){return n&&n.nodeType===1}var Zg=class{_portalOutlet;_host;_pane;_config;_ngZone;_keyboardDispatcher;_document;_location;_outsideClickDispatcher;_animationsDisabled;_injector;_renderer;_backdropClick=new yt;_attachments=new yt;_detachments=new yt;_positionStrategy;_scrollStrategy;_locationChanges=Gn.EMPTY;_backdropRef=null;_detachContentMutationObserver;_detachContentAfterRenderRef;_disposed=!1;_previousHostParent;_keydownEvents=new yt;_outsidePointerEvents=new yt;_afterNextRenderRef;constructor(t,e,i,r,o,d,m,b,T,A=!1,N,q){this._portalOutlet=t,this._host=e,this._pane=i,this._config=r,this._ngZone=o,this._keyboardDispatcher=d,this._document=m,this._location=b,this._outsideClickDispatcher=T,this._animationsDisabled=A,this._injector=N,this._renderer=q,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropRef?.element||null}get hostElement(){return this._host}attach(t){if(this._disposed)return null;this._attachHost();let e=this._portalOutlet.attach(t);return this._positionStrategy?.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._afterNextRenderRef?.destroy(),this._afterNextRenderRef=co(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._completeDetachContent(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof e?.onDestroy=="function"&&e.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),e}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let t=this._portalOutlet.detach();return this._detachments.next(),this._completeDetachContent(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),t}dispose(){if(this._disposed)return;let t=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._backdropRef?.dispose(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._afterNextRenderRef?.destroy(),this._previousHostParent=this._pane=this._host=this._backdropRef=null,t&&this._detachments.next(),this._detachments.complete(),this._completeDetachContent(),this._disposed=!0}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(t){t!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=t,this.hasAttached()&&(t.attach(this),this.updatePosition()))}updateSize(t){this._config=Be(Be({},this._config),t),this._updateElementSize()}setDirection(t){this._config=Mt(Be({},this._config),{direction:t}),this._updateElementDirection()}addPanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!0)}removePanelClass(t){this._pane&&this._toggleClasses(this._pane,t,!1)}getDirection(){let t=this._config.direction;return t?typeof t=="string"?t:t.value:"ltr"}updateScrollStrategy(t){t!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=t,this.hasAttached()&&(t.attach(this),t.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let t=this._pane.style;t.width=Vr(this._config.width),t.height=Vr(this._config.height),t.minWidth=Vr(this._config.minWidth),t.minHeight=Vr(this._config.minHeight),t.maxWidth=Vr(this._config.maxWidth),t.maxHeight=Vr(this._config.maxHeight)}_togglePointerEvents(t){this._pane.style.pointerEvents=t?"":"none"}_attachHost(){if(!this._host.parentElement){let t=this._config.usePopover?this._positionStrategy?.getPopoverInsertionPoint?.():null;HP(t)?t.after(this._host):t?.type==="parent"?t.element.appendChild(this._host):this._previousHostParent?.appendChild(this._host)}if(this._config.usePopover)try{this._host.showPopover()}catch(t){}}_attachBackdrop(){let t="cdk-overlay-backdrop-showing";this._backdropRef?.dispose(),this._backdropRef=new $P(this._document,this._renderer,this._ngZone,e=>{this._backdropClick.next(e)}),this._animationsDisabled&&this._backdropRef.element.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropRef.element,this._config.backdropClass,!0),this._config.usePopover?this._host.prepend(this._backdropRef.element):this._host.parentElement.insertBefore(this._backdropRef.element,this._host),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._backdropRef?.element.classList.add(t))}):this._backdropRef.element.classList.add(t)}_updateStackingOrder(){!this._config.usePopover&&this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){this._animationsDisabled?(this._backdropRef?.dispose(),this._backdropRef=null):this._backdropRef?.detach()}_toggleClasses(t,e,i){let r=Gd(e||[]).filter(o=>!!o);r.length&&(i?t.classList.add(...r):t.classList.remove(...r))}_detachContentWhenEmpty(){let t=!1;try{this._detachContentAfterRenderRef=co(()=>{t=!0,this._detachContent()},{injector:this._injector})}catch(e){if(t)throw e;this._detachContent()}globalThis.MutationObserver&&this._pane&&(this._detachContentMutationObserver||=new globalThis.MutationObserver(()=>{this._detachContent()}),this._detachContentMutationObserver.observe(this._pane,{childList:!0}))}_detachContent(){(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),this._completeDetachContent())}_completeDetachContent(){this._detachContentAfterRenderRef?.destroy(),this._detachContentAfterRenderRef=void 0,this._detachContentMutationObserver?.disconnect()}_disposeScrollStrategy(){let t=this._scrollStrategy;t?.disable(),t?.detach?.()}},m$="cdk-overlay-connected-position-bounding-box",Koe=/([A-Za-z%]+)$/;function S$(n,t){return new uT(t,n.get(Xd),n.get(Ht),n.get(_r),n.get(hT))}var uT=class{_viewportRuler;_document;_platform;_overlayContainer;_overlayRef;_isInitialRender=!1;_lastBoundingBoxSize={width:0,height:0};_isPushed=!1;_canPush=!0;_growAfterOpen=!1;_hasFlexibleDimensions=!0;_positionLocked=!1;_originRect;_overlayRect;_viewportRect;_containerRect;_viewportMargin=0;_scrollables=[];_preferredPositions=[];_origin;_pane;_isDisposed=!1;_boundingBox=null;_lastPosition=null;_lastScrollVisibility=null;_positionChanges=new yt;_resizeSubscription=Gn.EMPTY;_offsetX=0;_offsetY=0;_transformOriginSelector;_appliedPanelClasses=[];_previousPushAmount=null;_popoverLocation="global";positionChanges=this._positionChanges;get positions(){return this._preferredPositions}constructor(t,e,i,r,o){this._viewportRuler=e,this._document=i,this._platform=r,this._overlayContainer=o,this.setOrigin(t)}attach(t){this._overlayRef&&this._overlayRef,this._validatePositions(),t.hostElement.classList.add(m$),this._overlayRef=t,this._boundingBox=t.hostElement,this._pane=t.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._getContainerRect();let t=this._originRect,e=this._overlayRect,i=this._viewportRect,r=this._containerRect,o=[],d;for(let m of this._preferredPositions){let b=this._getOriginPoint(t,r,m),T=this._getOverlayPoint(b,e,m),A=this._getOverlayFit(T,e,i,m);if(A.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(m,b);return}if(this._canFitWithFlexibleDimensions(A,T,i)){o.push({position:m,origin:b,overlayRect:e,boundingBoxRect:this._calculateBoundingBoxRect(b,m)});continue}(!d||d.overlayFit.visibleArea<A.visibleArea)&&(d={overlayFit:A,overlayPoint:T,originPoint:b,position:m,overlayRect:e})}if(o.length){let m=null,b=-1;for(let T of o){let A=T.boundingBoxRect.width*T.boundingBoxRect.height*(T.position.weight||1);A>b&&(b=A,m=T)}this._isPushed=!1,this._applyPosition(m.position,m.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(d.position,d.originPoint);return}this._applyPosition(d.position,d.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&fp(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(m$),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let t=this._lastPosition;t?(this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._getContainerRect(),this._applyPosition(t,this._getOriginPoint(this._originRect,this._containerRect,t))):this.apply()}withScrollableContainers(t){return this._scrollables=t,this}withPositions(t){return this._preferredPositions=t,t.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(t){return this._viewportMargin=t,this}withFlexibleDimensions(t=!0){return this._hasFlexibleDimensions=t,this}withGrowAfterOpen(t=!0){return this._growAfterOpen=t,this}withPush(t=!0){return this._canPush=t,this}withLockedPosition(t=!0){return this._positionLocked=t,this}setOrigin(t){return this._origin=t,this}withDefaultOffsetX(t){return this._offsetX=t,this}withDefaultOffsetY(t){return this._offsetY=t,this}withTransformOriginOn(t){return this._transformOriginSelector=t,this}withPopoverLocation(t){return this._popoverLocation=t,this}getPopoverInsertionPoint(){return this._popoverLocation==="global"?null:this._popoverLocation!=="inline"?this._popoverLocation:this._origin instanceof Fn?this._origin.nativeElement:HP(this._origin)?this._origin:null}_getOriginPoint(t,e,i){let r;if(i.originX=="center")r=t.left+t.width/2;else{let d=this._isRtl()?t.right:t.left,m=this._isRtl()?t.left:t.right;r=i.originX=="start"?d:m}e.left<0&&(r-=e.left);let o;return i.originY=="center"?o=t.top+t.height/2:o=i.originY=="top"?t.top:t.bottom,e.top<0&&(o-=e.top),{x:r,y:o}}_getOverlayPoint(t,e,i){let r;i.overlayX=="center"?r=-e.width/2:i.overlayX==="start"?r=this._isRtl()?-e.width:0:r=this._isRtl()?0:-e.width;let o;return i.overlayY=="center"?o=-e.height/2:o=i.overlayY=="top"?0:-e.height,{x:t.x+r,y:t.y+o}}_getOverlayFit(t,e,i,r){let o=_$(e),{x:d,y:m}=t,b=this._getOffset(r,"x"),T=this._getOffset(r,"y");b&&(d+=b),T&&(m+=T);let A=0-d,N=d+o.width-i.width,q=0-m,J=m+o.height-i.height,K=this._subtractOverflows(o.width,A,N),xe=this._subtractOverflows(o.height,q,J),Te=K*xe;return{visibleArea:Te,isCompletelyWithinViewport:o.width*o.height===Te,fitsInViewportVertically:xe===o.height,fitsInViewportHorizontally:K==o.width}}_canFitWithFlexibleDimensions(t,e,i){if(this._hasFlexibleDimensions){let r=i.bottom-e.y,o=i.right-e.x,d=g$(this._overlayRef.getConfig().minHeight),m=g$(this._overlayRef.getConfig().minWidth),b=t.fitsInViewportVertically||d!=null&&d<=r,T=t.fitsInViewportHorizontally||m!=null&&m<=o;return b&&T}return!1}_pushOverlayOnScreen(t,e,i){if(this._previousPushAmount&&this._positionLocked)return{x:t.x+this._previousPushAmount.x,y:t.y+this._previousPushAmount.y};let r=_$(e),o=this._viewportRect,d=Math.max(t.x+r.width-o.width,0),m=Math.max(t.y+r.height-o.height,0),b=Math.max(o.top-i.top-t.y,0),T=Math.max(o.left-i.left-t.x,0),A=0,N=0;return r.width<=o.width?A=T||-d:A=t.x<this._getViewportMarginStart()?o.left-i.left-t.x:0,r.height<=o.height?N=b||-m:N=t.y<this._getViewportMarginTop()?o.top-i.top-t.y:0,this._previousPushAmount={x:A,y:N},{x:t.x+A,y:t.y+N}}_applyPosition(t,e){if(this._setTransformOrigin(t),this._setOverlayElementStyles(e,t),this._setBoundingBoxStyles(e,t),t.panelClass&&this._addPanelClasses(t.panelClass),this._positionChanges.observers.length){let i=this._getScrollVisibility();if(t!==this._lastPosition||!this._lastScrollVisibility||!Yoe(this._lastScrollVisibility,i)){let r=new cT(t,i);this._positionChanges.next(r)}this._lastScrollVisibility=i}this._lastPosition=t,this._isInitialRender=!1}_setTransformOrigin(t){if(!this._transformOriginSelector)return;let e=this._boundingBox.querySelectorAll(this._transformOriginSelector),i,r=t.overlayY;t.overlayX==="center"?i="center":this._isRtl()?i=t.overlayX==="start"?"right":"left":i=t.overlayX==="start"?"left":"right";for(let o=0;o<e.length;o++)e[o].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(t,e){let i=this._viewportRect,r=this._isRtl(),o,d,m;if(e.overlayY==="top")d=t.y,o=i.height-d+this._getViewportMarginBottom();else if(e.overlayY==="bottom")m=i.height-t.y+this._getViewportMarginTop()+this._getViewportMarginBottom(),o=i.height-m+this._getViewportMarginTop();else{let J=Math.min(i.bottom-t.y+i.top,t.y),K=this._lastBoundingBoxSize.height;o=J*2,d=t.y-J,o>K&&!this._isInitialRender&&!this._growAfterOpen&&(d=t.y-K/2)}let b=e.overlayX==="start"&&!r||e.overlayX==="end"&&r,T=e.overlayX==="end"&&!r||e.overlayX==="start"&&r,A,N,q;if(T)q=i.width-t.x+this._getViewportMarginStart()+this._getViewportMarginEnd(),A=t.x-this._getViewportMarginStart();else if(b)N=t.x,A=i.right-t.x-this._getViewportMarginEnd();else{let J=Math.min(i.right-t.x+i.left,t.x),K=this._lastBoundingBoxSize.width;A=J*2,N=t.x-J,A>K&&!this._isInitialRender&&!this._growAfterOpen&&(N=t.x-K/2)}return{top:d,left:N,bottom:m,right:q,width:A,height:o}}_setBoundingBoxStyles(t,e){let i=this._calculateBoundingBoxRect(t,e);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));let r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right="auto",r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{let o=this._overlayRef.getConfig().maxHeight,d=this._overlayRef.getConfig().maxWidth;r.width=Vr(i.width),r.height=Vr(i.height),r.top=Vr(i.top)||"auto",r.bottom=Vr(i.bottom)||"auto",r.left=Vr(i.left)||"auto",r.right=Vr(i.right)||"auto",e.overlayX==="center"?r.alignItems="center":r.alignItems=e.overlayX==="end"?"flex-end":"flex-start",e.overlayY==="center"?r.justifyContent="center":r.justifyContent=e.overlayY==="bottom"?"flex-end":"flex-start",o&&(r.maxHeight=Vr(o)),d&&(r.maxWidth=Vr(d))}this._lastBoundingBoxSize=i,fp(this._boundingBox.style,r)}_resetBoundingBoxStyles(){fp(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){fp(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(t,e){let i={},r=this._hasExactPosition(),o=this._hasFlexibleDimensions,d=this._overlayRef.getConfig();if(r){let A=this._viewportRuler.getViewportScrollPosition();fp(i,this._getExactOverlayY(e,t,A)),fp(i,this._getExactOverlayX(e,t,A))}else i.position="static";let m="",b=this._getOffset(e,"x"),T=this._getOffset(e,"y");b&&(m+=`translateX(${b}px) `),T&&(m+=`translateY(${T}px)`),i.transform=m.trim(),d.maxHeight&&(r?i.maxHeight=Vr(d.maxHeight):o&&(i.maxHeight="")),d.maxWidth&&(r?i.maxWidth=Vr(d.maxWidth):o&&(i.maxWidth="")),fp(this._pane.style,i)}_getExactOverlayY(t,e,i){let r={top:"",bottom:""},o=this._getOverlayPoint(e,this._overlayRect,t);if(this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,i)),t.overlayY==="bottom"){let d=this._document.documentElement.clientHeight;r.bottom=`${d-(o.y+this._overlayRect.height)}px`}else r.top=Vr(o.y);return r}_getExactOverlayX(t,e,i){let r={left:"",right:""},o=this._getOverlayPoint(e,this._overlayRect,t);this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,i));let d;if(this._isRtl()?d=t.overlayX==="end"?"left":"right":d=t.overlayX==="end"?"right":"left",d==="right"){let m=this._document.documentElement.clientWidth;r.right=`${m-(o.x+this._overlayRect.width)}px`}else r.left=Vr(o.x);return r}_getScrollVisibility(){let t=this._getOriginRect(),e=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:f$(t,i),isOriginOutsideView:UP(t,i),isOverlayClipped:f$(e,i),isOverlayOutsideView:UP(e,i)}}_subtractOverflows(t,...e){return e.reduce((i,r)=>i-Math.max(r,0),t)}_getNarrowedViewportRect(){let t=this._document.documentElement.clientWidth,e=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._getViewportMarginTop(),left:i.left+this._getViewportMarginStart(),right:i.left+t-this._getViewportMarginEnd(),bottom:i.top+e-this._getViewportMarginBottom(),width:t-this._getViewportMarginStart()-this._getViewportMarginEnd(),height:e-this._getViewportMarginTop()-this._getViewportMarginBottom()}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(t,e){return e==="x"?t.offsetX==null?this._offsetX:t.offsetX:t.offsetY==null?this._offsetY:t.offsetY}_validatePositions(){}_addPanelClasses(t){this._pane&&Gd(t).forEach(e=>{e!==""&&this._appliedPanelClasses.indexOf(e)===-1&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(t=>{this._pane.classList.remove(t)}),this._appliedPanelClasses=[])}_getViewportMarginStart(){return typeof this._viewportMargin=="number"?this._viewportMargin:this._viewportMargin?.start??0}_getViewportMarginEnd(){return typeof this._viewportMargin=="number"?this._viewportMargin:this._viewportMargin?.end??0}_getViewportMarginTop(){return typeof this._viewportMargin=="number"?this._viewportMargin:this._viewportMargin?.top??0}_getViewportMarginBottom(){return typeof this._viewportMargin=="number"?this._viewportMargin:this._viewportMargin?.bottom??0}_getOriginRect(){let t=this._origin;if(t instanceof Fn)return t.nativeElement.getBoundingClientRect();if(t instanceof Element)return t.getBoundingClientRect();let e=t.width||0,i=t.height||0;return{top:t.y,bottom:t.y+i,left:t.x,right:t.x+e,height:i,width:e}}_getContainerRect(){let t=this._overlayRef.getConfig().usePopover&&this._popoverLocation!=="global",e=this._overlayContainer.getContainerElement();t&&(e.style.display="block");let i=e.getBoundingClientRect();return t&&(e.style.display=""),i}};function fp(n,t){for(let e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}function g$(n){if(typeof n!="number"&&n!=null){let[t,e]=n.split(Koe);return!e||e==="px"?parseFloat(t):null}return n||null}function _$(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}function Yoe(n,t){return n===t?!0:n.isOriginClipped===t.isOriginClipped&&n.isOriginOutsideView===t.isOriginOutsideView&&n.isOverlayClipped===t.isOverlayClipped&&n.isOverlayOutsideView===t.isOverlayOutsideView}var y$="cdk-global-overlay-wrapper";function Jd(n){return new dT}var dT=class{_overlayRef;_cssPosition="static";_topOffset="";_bottomOffset="";_alignItems="";_xPosition="";_xOffset="";_width="";_height="";_isDisposed=!1;attach(t){let e=t.getConfig();this._overlayRef=t,this._width&&!e.width&&t.updateSize({width:this._width}),this._height&&!e.height&&t.updateSize({height:this._height}),t.hostElement.classList.add(y$),this._isDisposed=!1}top(t=""){return this._bottomOffset="",this._topOffset=t,this._alignItems="flex-start",this}left(t=""){return this._xOffset=t,this._xPosition="left",this}bottom(t=""){return this._topOffset="",this._bottomOffset=t,this._alignItems="flex-end",this}right(t=""){return this._xOffset=t,this._xPosition="right",this}start(t=""){return this._xOffset=t,this._xPosition="start",this}end(t=""){return this._xOffset=t,this._xPosition="end",this}width(t=""){return this._overlayRef?this._overlayRef.updateSize({width:t}):this._width=t,this}height(t=""){return this._overlayRef?this._overlayRef.updateSize({height:t}):this._height=t,this}centerHorizontally(t=""){return this.left(t),this._xPosition="center",this}centerVertically(t=""){return this.top(t),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:o,maxWidth:d,maxHeight:m}=i,b=(r==="100%"||r==="100vw")&&(!d||d==="100%"||d==="100vw"),T=(o==="100%"||o==="100vh")&&(!m||m==="100%"||m==="100vh"),A=this._xPosition,N=this._xOffset,q=this._overlayRef.getConfig().direction==="rtl",J="",K="",xe="";b?xe="flex-start":A==="center"?(xe="center",q?K=N:J=N):q?A==="left"||A==="end"?(xe="flex-end",J=N):(A==="right"||A==="start")&&(xe="flex-start",K=N):A==="left"||A==="start"?(xe="flex-start",J=N):(A==="right"||A==="end")&&(xe="flex-end",K=N),t.position=this._cssPosition,t.marginLeft=b?"0":J,t.marginTop=T?"0":this._topOffset,t.marginBottom=this._bottomOffset,t.marginRight=b?"0":K,e.justifyContent=xe,e.alignItems=T?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let t=this._overlayRef.overlayElement.style,e=this._overlayRef.hostElement,i=e.style;e.classList.remove(y$),i.justifyContent=i.alignItems=t.marginTop=t.marginBottom=t.marginLeft=t.marginRight=t.position="",this._overlayRef=null,this._isDisposed=!0}},D$=(()=>{class n{_injector=se(en);constructor(){}global(){return Jd()}flexibleConnectedTo(e){return S$(this._injector,e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),I$=new rt("OVERLAY_DEFAULT_CONFIG");function Yg(n,t){n.get($a).load(T$);let e=n.get(hT),i=n.get(Ht),r=n.get(ga),o=n.get(To),d=n.get(Wd),m=n.get(Br,null,{optional:!0})||n.get(pr).createRenderer(null,null),b=new Qd(t),T=n.get(I$,null,{optional:!0})?.usePopover??!0;b.direction=b.direction||d.value,"showPopover"in i.body?b.usePopover=t?.usePopover??T:b.usePopover=!1;let A=i.createElement("div"),N=i.createElement("div");A.id=r.getId("cdk-overlay-"),A.classList.add("cdk-overlay-pane"),N.appendChild(A),b.usePopover&&(N.setAttribute("popover","manual"),N.classList.add("cdk-overlay-popover"));let q=b.usePopover?b.positionStrategy?.getPopoverInsertionPoint?.():null;return HP(q)?q.after(N):q?.type==="parent"?q.element.appendChild(N):e.getContainerElement().appendChild(N),new Zg(new rT(A,o,n),N,A,b,n.get(jt),n.get(E$),i,n.get(hc),n.get(C$),t?.disableAnimations??n.get(Od,null,{optional:!0})==="NoopAnimations",n.get(si),m)}var M$=(()=>{class n{scrollStrategies=se(w$);_positionBuilder=se(D$);_injector=se(en);constructor(){}create(e){return Yg(this._injector,e)}position(){return this._positionBuilder}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var pp=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[M$],imports:[_a,Su,zP,zP]})}return n})();function Xoe(n,t){if(n&1){let e=Tt();V(0,"div",1)(1,"button",2),Fe("click",function(){Ve(e);let r=_e();return je(r.action())}),Z(2),U()()}if(n&2){let e=_e();te(2),tn(" ",e.data.action," ")}}var Qoe=["label"];function Joe(n,t){}var ese=Math.pow(2,31)-1,B0=class{_overlayRef;instance;containerInstance;_afterDismissed=new yt;_afterOpened=new yt;_onAction=new yt;_durationTimeoutId;_dismissedByAction=!1;constructor(t,e){this._overlayRef=e,this.containerInstance=t,t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,ese))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},A$=new rt("MatSnackBarData"),Xg=class{politeness="polite";announcementMessage="";viewContainerRef;duration=0;panelClass;direction;data=null;horizontalPosition="center";verticalPosition="bottom"},tse=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"]})}return n})(),nse=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"]})}return n})(),ise=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"]})}return n})(),k$=(()=>{class n{snackBarRef=se(B0);data=se(A$);constructor(){}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["matButton","","matSnackBarAction","",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0),Z(1),U(),tt(2,Xoe,3,1,"div",1)),i&2&&(te(),tn(" ",r.data.message,`
`),te(),nt(r.hasAction?2:-1))},dependencies:[u$,tse,nse,ise],styles:[`.mat-mdc-simple-snack-bar{display:flex}.mat-mdc-simple-snack-bar .mat-mdc-snack-bar-label{max-height:50vh;overflow:auto}
`],encapsulation:2,changeDetection:0})}return n})(),GP="_mat-snack-bar-enter",qP="_mat-snack-bar-exit",rse=(()=>{class n extends Kd{_ngZone=se(jt);_elementRef=se(Fn);_changeDetectorRef=se(Uo);_platform=se(_r);_animationsDisabled=_c();snackBarConfig=se(Xg);_document=se(Ht);_trackedModals=new Set;_enterFallback;_exitFallback;_injector=se(en);_announceDelay=150;_announceTimeoutId;_destroyed=!1;_portalOutlet;_onAnnounce=new yt;_onExit=new yt;_onEnter=new yt;_animationState="void";_live;_label;_role;_liveElementId=se(ga).getId("mat-snack-bar-container-live-");constructor(){super();let e=this.snackBarConfig;e.politeness==="assertive"&&!e.announcementMessage?this._live="assertive":e.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(e){this._assertNotAttached();let i=this._portalOutlet.attachComponentPortal(e);return this._afterPortalAttached(),i}attachTemplatePortal(e){this._assertNotAttached();let i=this._portalOutlet.attachTemplatePortal(e);return this._afterPortalAttached(),i}attachDomPortal=e=>{this._assertNotAttached();let i=this._portalOutlet.attachDomPortal(e);return this._afterPortalAttached(),i};onAnimationEnd(e){e===qP?this._completeExit():e===GP&&(clearTimeout(this._enterFallback),this._ngZone.run(()=>{this._onEnter.next(),this._onEnter.complete()}))}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce(),this._animationsDisabled?co(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(GP)))},{injector:this._injector}):(clearTimeout(this._enterFallback),this._enterFallback=setTimeout(()=>{this._elementRef.nativeElement.classList.add("mat-snack-bar-fallback-visible"),this.onAnimationEnd(GP)},200)))}exit(){return this._destroyed?Jt(void 0):(this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId),this._animationsDisabled?co(()=>{this._ngZone.run(()=>queueMicrotask(()=>this.onAnimationEnd(qP)))},{injector:this._injector}):(clearTimeout(this._exitFallback),this._exitFallback=setTimeout(()=>this.onAnimationEnd(qP),200))}),this._onExit)}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){clearTimeout(this._exitFallback),queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let e=this._elementRef.nativeElement,i=this.snackBarConfig.panelClass;i&&(Array.isArray(i)?i.forEach(d=>e.classList.add(d)):e.classList.add(i)),this._exposeToModals();let r=this._label.nativeElement,o="mdc-snackbar__label";r.classList.toggle(o,!r.querySelector(`.${o}`))}_exposeToModals(){let e=this._liveElementId,i=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<i.length;r++){let o=i[r],d=o.getAttribute("aria-owns");this._trackedModals.add(o),d?d.indexOf(e)===-1&&o.setAttribute("aria-owns",d+" "+e):o.setAttribute("aria-owns",e)}}_clearFromModals(){this._trackedModals.forEach(e=>{let i=e.getAttribute("aria-owns");if(i){let r=i.replace(this._liveElementId,"").trim();r.length>0?e.setAttribute("aria-owns",r):e.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{if(this._destroyed)return;let e=this._elementRef.nativeElement,i=e.querySelector("[aria-hidden]"),r=e.querySelector("[aria-live]");if(i&&r){let o=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&i.contains(document.activeElement)&&(o=document.activeElement),i.removeAttribute("aria-hidden"),r.appendChild(i),o?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["mat-snack-bar-container"]],viewQuery:function(i,r){if(i&1&&ws(Yd,7)(Qoe,7),i&2){let o;Do(o=Io())&&(r._portalOutlet=o.first),Do(o=Io())&&(r._label=o.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:6,hostBindings:function(i,r){i&1&&Fe("animationend",function(d){return r.onAnimationEnd(d.animationName)})("animationcancel",function(d){return r.onAnimationEnd(d.animationName)}),i&2&&ji("mat-snack-bar-container-enter",r._animationState==="visible")("mat-snack-bar-container-exit",r._animationState==="hidden")("mat-snack-bar-container-animations-enabled",!r._animationsDisabled)},features:[ci],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(i,r){i&1&&(V(0,"div",1)(1,"div",2,0)(3,"div",3),Fd(4,Joe,0,0,"ng-template",4),U(),st(5,"div"),U()()),i&2&&(te(5),uo("aria-live",r._live)("role",r._role)("id",r._liveElementId))},dependencies:[Yd],styles:[`@keyframes _mat-snack-bar-enter{from{transform:scale(0.8);opacity:0}to{transform:scale(1);opacity:1}}@keyframes _mat-snack-bar-exit{from{opacity:1}to{opacity:0}}.mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-snack-bar-container-animations-enabled{opacity:0}.mat-snack-bar-container-animations-enabled.mat-snack-bar-fallback-visible{opacity:1}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-enter{animation:_mat-snack-bar-enter 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-snack-bar-container-animations-enabled.mat-snack-bar-container-exit{animation:_mat-snack-bar-exit 75ms cubic-bezier(0.4, 0, 1, 1) forwards}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}@media(forced-colors: active){.mat-mdc-snackbar-surface{outline:solid 1px}}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mat-snack-bar-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mat-snack-bar-container-shape, var(--mat-sys-corner-extra-small));background-color:var(--mat-snack-bar-container-color, var(--mat-sys-inverse-surface))}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mat-snack-bar-supporting-text-font, var(--mat-sys-body-medium-font));font-size:var(--mat-snack-bar-supporting-text-size, var(--mat-sys-body-medium-size));font-weight:var(--mat-snack-bar-supporting-text-weight, var(--mat-sys-body-medium-weight));line-height:var(--mat-snack-bar-supporting-text-line-height, var(--mat-sys-body-medium-line-height))}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){--mat-button-text-state-layer-color: currentColor;--mat-button-text-ripple-color: currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled).mat-unthemed{color:var(--mat-snack-bar-button-color, var(--mat-sys-inverse-primary))}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}
`],encapsulation:2})}return n})(),ose=new rt("mat-snack-bar-default-options",{providedIn:"root",factory:()=>new Xg}),Qi=(()=>{class n{_live=se(RP);_injector=se(en);_breakpointObserver=se(P0);_parentSnackBar=se(n,{optional:!0,skipSelf:!0});_defaultConfig=se(ose);_animationsDisabled=_c();_snackBarRefAtThisLevel=null;simpleSnackBarComponent=k$;snackBarContainerComponent=rse;handsetCssClass="mat-mdc-snack-bar-handset";get _openedSnackBarRef(){let e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}constructor(){}openFromComponent(e,i){return this._attach(e,i)}openFromTemplate(e,i){return this._attach(e,i)}open(e,i="",r){let o=Be(Be({},this._defaultConfig),r);return o.data={message:e,action:i},o.announcementMessage===e&&(o.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,o)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(e,i){let r=i&&i.viewContainerRef&&i.viewContainerRef.injector,o=en.create({parent:r||this._injector,providers:[{provide:Xg,useValue:i}]}),d=new Tu(this.snackBarContainerComponent,i.viewContainerRef,o),m=e.attach(d);return m.instance.snackBarConfig=i,m.instance}_attach(e,i){let r=Be(Be(Be({},new Xg),this._defaultConfig),i),o=this._createOverlay(r),d=this._attachSnackBarContainer(o,r),m=new B0(d,o);if(e instanceof Vs){let b=new Zd(e,null,{$implicit:r.data,snackBarRef:m});m.instance=d.attachTemplatePortal(b)}else{let b=this._createInjector(r,m),T=new Tu(e,void 0,b),A=d.attachComponentPortal(T);m.instance=A.instance}return this._breakpointObserver.observe(Y6.HandsetPortrait).pipe(Bo(o.detachments())).subscribe(b=>{o.overlayElement.classList.toggle(this.handsetCssClass,b.matches)}),r.announcementMessage&&d._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(m,r),this._openedSnackBarRef=m,this._openedSnackBarRef}_animateSnackBar(e,i){e.afterDismissed().subscribe(()=>{this._openedSnackBarRef==e&&(this._openedSnackBarRef=null),i.announcementMessage&&this._live.clear()}),i.duration&&i.duration>0&&e.afterOpened().subscribe(()=>e._dismissAfter(i.duration)),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{e.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):e.containerInstance.enter()}_createOverlay(e){let i=new Qd;i.direction=e.direction;let r=Jd(this._injector),o=e.direction==="rtl",d=e.horizontalPosition==="left"||e.horizontalPosition==="start"&&!o||e.horizontalPosition==="end"&&o,m=!d&&e.horizontalPosition!=="center";return d?r.left("0"):m?r.right("0"):r.centerHorizontally(),e.verticalPosition==="top"?r.top("0"):r.bottom("0"),i.positionStrategy=r,i.disableAnimations=this._animationsDisabled,Yg(this._injector,i)}_createInjector(e,i){let r=e&&e.viewContainerRef&&e.viewContainerRef.injector;return en.create({parent:r||this._injector,providers:[{provide:B0,useValue:i},{provide:A$,useValue:e.data}]})}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var R$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[Qi],imports:[pp,Su,d$,k$,_a]})}return n})();function sse(n,t){}var eh=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;closePredicate;width="";height="";minWidth;minHeight;maxWidth;maxHeight;positionStrategy;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;scrollStrategy;closeOnNavigation=!0;closeOnDestroy=!0;closeOnOverlayDetachments=!0;disableAnimations=!1;providers;container;templateContext};var ZP=(()=>{class n extends Kd{_elementRef=se(Fn);_focusTrapFactory=se(kP);_config;_interactivityChecker=se(AP);_ngZone=se(jt);_focusMonitor=se(R0);_renderer=se(Br);_changeDetectorRef=se(Uo);_injector=se(en);_platform=se(_r);_document=se(Ht);_portalOutlet;_focusTrapped=new yt;_focusTrap=null;_elementFocusedBeforeDialogWasOpened=null;_closeInteractionType=null;_ariaLabelledByQueue=[];_isDestroyed=!1;constructor(){super(),this._config=se(eh,{optional:!0})||new eh,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(e){this._ariaLabelledByQueue.push(e),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(e){let i=this._ariaLabelledByQueue.indexOf(e);i>-1&&(this._ariaLabelledByQueue.splice(i,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._focusTrapped.complete(),this._isDestroyed=!0,this._restoreFocus()}attachComponentPortal(e){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachComponentPortal(e);return this._contentAttached(),i}attachTemplatePortal(e){this._portalOutlet.hasAttached();let i=this._portalOutlet.attachTemplatePortal(e);return this._contentAttached(),i}attachDomPortal=e=>{this._portalOutlet.hasAttached();let i=this._portalOutlet.attachDomPortal(e);return this._contentAttached(),i};_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(e,i){this._interactivityChecker.isFocusable(e)||(e.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let r=()=>{o(),d(),e.removeAttribute("tabindex")},o=this._renderer.listen(e,"blur",r),d=this._renderer.listen(e,"mousedown",r)})),e.focus(i)}_focusByCssSelector(e,i){let r=this._elementRef.nativeElement.querySelector(e);r&&this._forceFocus(r,i)}_trapFocus(e){this._isDestroyed||co(()=>{let i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus(e);break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElement(e)||this._focusDialogContainer(e);break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]',e);break;default:this._focusByCssSelector(this._config.autoFocus,e);break}this._focusTrapped.next()},{injector:this._injector})}_restoreFocus(){let e=this._config.restoreFocus,i=null;if(typeof e=="string"?i=this._document.querySelector(e):typeof e=="boolean"?i=e?this._elementFocusedBeforeDialogWasOpened:null:e&&(i=e),this._config.restoreFocus&&i&&typeof i.focus=="function"){let r=M0(),o=this._elementRef.nativeElement;(!r||r===this._document.body||r===o||o.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(i,this._closeInteractionType),this._closeInteractionType=null):i.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(e){this._elementRef.nativeElement.focus?.(e)}_containsFocus(){let e=this._elementRef.nativeElement,i=M0();return e===i||e.contains(i)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=M0()))}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["cdk-dialog-container"]],viewQuery:function(i,r){if(i&1&&ws(Yd,7),i&2){let o;Do(o=Io())&&(r._portalOutlet=o.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(i,r){i&2&&uo("id",r._config.id||null)("role",r._config.role)("aria-modal",r._config.ariaModal)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null)},features:[ci],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,r){i&1&&Fd(0,sse,0,0,"ng-template",0)},dependencies:[Yd],styles:[`.cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}
`],encapsulation:2})}return n})(),V0=class{overlayRef;config;componentInstance=null;componentRef=null;containerInstance;disableClose;closed=new yt;backdropClick;keydownEvents;outsidePointerEvents;id;_detachSubscription;constructor(t,e){this.overlayRef=t,this.config=e,this.disableClose=e.disableClose,this.backdropClick=t.backdropClick(),this.keydownEvents=t.keydownEvents(),this.outsidePointerEvents=t.outsidePointerEvents(),this.id=e.id,this.keydownEvents.subscribe(i=>{i.keyCode===27&&!this.disableClose&&!tT(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{!this.disableClose&&this._canClose()?this.close(void 0,{focusOrigin:"mouse"}):this.containerInstance._recaptureFocus?.()}),this._detachSubscription=t.detachments().subscribe(()=>{e.closeOnOverlayDetachments!==!1&&this.close()})}close(t,e){if(this._canClose(t)){let i=this.closed;this.containerInstance._closeInteractionType=e?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(t),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(t="",e=""){return this.overlayRef.updateSize({width:t,height:e}),this}addPanelClass(t){return this.overlayRef.addPanelClass(t),this}removePanelClass(t){return this.overlayRef.removePanelClass(t),this}_canClose(t){let e=this.config;return!!this.containerInstance&&(!e.closePredicate||e.closePredicate(t,e,this.componentInstance))}},ase=new rt("DialogScrollStrategy",{providedIn:"root",factory:()=>{let n=se(en);return()=>Kg(n)}}),lse=new rt("DialogData"),cse=new rt("DefaultDialogConfig");function use(n){let t=Zn(n),e=new xn;return{valueSignal:t,get value(){return t()},change:e,ngOnDestroy(){e.complete()}}}var KP=(()=>{class n{_injector=se(en);_defaultOptions=se(cse,{optional:!0});_parentDialog=se(n,{optional:!0,skipSelf:!0});_overlayContainer=se(hT);_idGenerator=se(ga);_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new yt;_afterOpenedAtThisLevel=new yt;_ariaHiddenElements=new Map;_scrollStrategy=se(ase);get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}afterAllClosed=ru(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ra(void 0)));constructor(){}open(e,i){let r=this._defaultOptions||new eh;i=Be(Be({},r),i),i.id=i.id||this._idGenerator.getId("cdk-dialog-"),i.id&&this.getDialogById(i.id);let o=this._getOverlayConfig(i),d=Yg(this._injector,o),m=new V0(d,i),b=this._attachContainer(d,m,i);if(m.containerInstance=b,!this.openDialogs.length){let T=this._overlayContainer.getContainerElement();b._focusTrapped?b._focusTrapped.pipe(Xi(1)).subscribe(()=>{this._hideNonDialogContentFromAssistiveTechnology(T)}):this._hideNonDialogContentFromAssistiveTechnology(T)}return this._attachDialogContent(e,m,b,i),this.openDialogs.push(m),m.closed.subscribe(()=>this._removeOpenDialog(m,!0)),this.afterOpened.next(m),m}closeAll(){WP(this.openDialogs,e=>e.close())}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){WP(this._openDialogsAtThisLevel,e=>{e.config.closeOnDestroy===!1&&this._removeOpenDialog(e,!1)}),WP(this._openDialogsAtThisLevel,e=>e.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(e){let i=new Qd({positionStrategy:e.positionStrategy||Jd().centerHorizontally().centerVertically(),scrollStrategy:e.scrollStrategy||this._scrollStrategy(),panelClass:e.panelClass,hasBackdrop:e.hasBackdrop,direction:e.direction,minWidth:e.minWidth,minHeight:e.minHeight,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,disposeOnNavigation:e.closeOnNavigation,disableAnimations:e.disableAnimations});return e.backdropClass&&(i.backdropClass=e.backdropClass),i}_attachContainer(e,i,r){let o=r.injector||r.viewContainerRef?.injector,d=[{provide:eh,useValue:r},{provide:V0,useValue:i},{provide:Zg,useValue:e}],m;r.container?typeof r.container=="function"?m=r.container:(m=r.container.type,d.push(...r.container.providers(r))):m=ZP;let b=new Tu(m,r.viewContainerRef,en.create({parent:o||this._injector,providers:d}));return e.attach(b).instance}_attachDialogContent(e,i,r,o){if(e instanceof Vs){let d=this._createInjector(o,i,r,void 0),m={$implicit:o.data,dialogRef:i};o.templateContext&&(m=Be(Be({},m),typeof o.templateContext=="function"?o.templateContext():o.templateContext)),r.attachTemplatePortal(new Zd(e,null,m,d))}else{let d=this._createInjector(o,i,r,this._injector),m=r.attachComponentPortal(new Tu(e,o.viewContainerRef,d));i.componentRef=m,i.componentInstance=m.instance}}_createInjector(e,i,r,o){let d=e.injector||e.viewContainerRef?.injector,m=[{provide:lse,useValue:e.data},{provide:V0,useValue:i}];return e.providers&&(typeof e.providers=="function"?m.push(...e.providers(i,e,r)):m.push(...e.providers)),e.direction&&(!d||!d.get(Wd,null,{optional:!0}))&&m.push({provide:Wd,useValue:use(e.direction)}),en.create({parent:d||o,providers:m})}_removeOpenDialog(e,i){let r=this.openDialogs.indexOf(e);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((o,d)=>{o?d.setAttribute("aria-hidden",o):d.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),i&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(e){if(e.parentElement){let i=e.parentElement.children;for(let r=i.length-1;r>-1;r--){let o=i[r];o!==e&&o.nodeName!=="SCRIPT"&&o.nodeName!=="STYLE"&&!o.hasAttribute("aria-live")&&!o.hasAttribute("popover")&&(this._ariaHiddenElements.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function WP(n,t){let e=n.length;for(;e--;)t(n[e])}var N$=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[KP],imports:[pp,Su,PP,Su]})}return n})();function dse(n,t){}var pT=class{viewContainerRef;injector;id;role="dialog";panelClass="";hasBackdrop=!0;backdropClass="";disableClose=!1;closePredicate;width="";height="";minWidth;minHeight;maxWidth;maxHeight;position;data=null;direction;ariaDescribedBy=null;ariaLabelledBy=null;ariaLabel=null;ariaModal=!1;autoFocus="first-tabbable";restoreFocus=!0;delayFocusTrap=!0;scrollStrategy;closeOnNavigation=!0;enterAnimationDuration;exitAnimationDuration},YP="mdc-dialog--open",O$="mdc-dialog--opening",F$="mdc-dialog--closing",hse=150,fse=75,pse=(()=>{class n extends ZP{_animationStateChanged=new xn;_animationsEnabled=!_c();_actionSectionCount=0;_hostElement=this._elementRef.nativeElement;_enterAnimationDuration=this._animationsEnabled?B$(this._config.enterAnimationDuration)??hse:0;_exitAnimationDuration=this._animationsEnabled?B$(this._config.exitAnimationDuration)??fse:0;_animationTimer=null;_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(L$,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(O$,YP)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(YP),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(YP),this._animationsEnabled?(this._hostElement.style.setProperty(L$,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(F$)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(e){this._actionSectionCount+=e,this._changeDetectorRef.markForCheck()}_finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)};_finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})};_clearAnimationClasses(){this._hostElement.classList.remove(O$,F$)}_waitForAnimationToComplete(e,i){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(i,e)}_requestAnimationFrame(e){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(e):e()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(e){this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:e})}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer)}attachComponentPortal(e){let i=super.attachComponentPortal(e);return i.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),i}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275cmp=Pt({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(i,r){i&2&&(Sg("id",r._config.id),uo("aria-modal",r._config.ariaModal)("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),ji("_mat-animation-noopable",!r._animationsEnabled)("mat-mdc-dialog-container-with-actions",r._actionSectionCount>0))},features:[ci],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1),Fd(2,dse,0,0,"ng-template",2),U()())},dependencies:[Yd],styles:[`.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 560px);min-width:var(--mat-dialog-container-min-width, 280px)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, calc(100vw - 32px))}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, none);border-radius:var(--mat-dialog-container-shape, var(--mat-sys-corner-extra-large, 4px));background-color:var(--mat-dialog-container-color, var(--mat-sys-surface, white))}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 6px 24px 13px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mat-dialog-subhead-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mat-dialog-subhead-font, var(--mat-sys-headline-small-font, inherit));line-height:var(--mat-dialog-subhead-line-height, var(--mat-sys-headline-small-line-height, 1.5rem));font-size:var(--mat-dialog-subhead-size, var(--mat-sys-headline-small-size, 1rem));font-weight:var(--mat-dialog-subhead-weight, var(--mat-sys-headline-small-weight, 400));letter-spacing:var(--mat-dialog-subhead-tracking, var(--mat-sys-headline-small-tracking, 0.03125em))}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mat-dialog-supporting-text-color, var(--mat-sys-on-surface-variant, rgba(0, 0, 0, 0.6)));font-family:var(--mat-dialog-supporting-text-font, var(--mat-sys-body-medium-font, inherit));line-height:var(--mat-dialog-supporting-text-line-height, var(--mat-sys-body-medium-line-height, 1.5rem));font-size:var(--mat-dialog-supporting-text-size, var(--mat-sys-body-medium-size, 1rem));font-weight:var(--mat-dialog-supporting-text-weight, var(--mat-sys-body-medium-weight, 400));letter-spacing:var(--mat-dialog-supporting-text-tracking, var(--mat-sys-body-medium-tracking, 0.03125em))}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px 0)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;box-sizing:border-box;min-height:52px;margin:0;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 16px 24px);justify-content:var(--mat-dialog-actions-alignment, flex-end)}@media(forced-colors: active){.mat-mdc-dialog-actions{border-top-color:CanvasText}}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}
`],encapsulation:2})}return n})(),L$="--mat-dialog-transition-duration";function B$(n){return n==null?null:typeof n=="number"?n:n.endsWith("ms")?Hd(n.substring(0,n.length-2)):n.endsWith("s")?Hd(n.substring(0,n.length-1))*1e3:n==="0"?0:null}var fT=(function(n){return n[n.OPEN=0]="OPEN",n[n.CLOSING=1]="CLOSING",n[n.CLOSED=2]="CLOSED",n})(fT||{}),Dl=class{_ref;_config;_containerInstance;componentInstance;componentRef=null;disableClose;id;_afterOpened=new Ym(1);_beforeClosed=new Ym(1);_result;_closeFallbackTimeout;_state=fT.OPEN;_closeInteractionType;constructor(t,e,i){this._ref=t,this._config=e,this._containerInstance=i,this.disableClose=e.disableClose,this.id=t.id,t.addPanelClass("mat-mdc-dialog-panel"),i._animationStateChanged.pipe(mi(r=>r.state==="opened"),Xi(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(mi(r=>r.state==="closed"),Xi(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),t.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),Tf(this.backdropClick(),this.keydownEvents().pipe(mi(r=>r.keyCode===27&&!this.disableClose&&!tT(r)))).subscribe(r=>{this.disableClose||(r.preventDefault(),mse(this,r.type==="keydown"?"keyboard":"mouse"))})}close(t){let e=this._config.closePredicate;e&&!e(t,this._config,this.componentInstance)||(this._result=t,this._containerInstance._animationStateChanged.pipe(mi(i=>i.state==="closing"),Xi(1)).subscribe(i=>{this._beforeClosed.next(t),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),i.totalTime+100)}),this._state=fT.CLOSING,this._containerInstance._startExitAnimation())}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(t){let e=this._ref.config.positionStrategy;return t&&(t.left||t.right)?t.left?e.left(t.left):e.right(t.right):e.centerHorizontally(),t&&(t.top||t.bottom)?t.top?e.top(t.top):e.bottom(t.bottom):e.centerVertically(),this._ref.updatePosition(),this}updateSize(t="",e=""){return this._ref.updateSize(t,e),this}addPanelClass(t){return this._ref.addPanelClass(t),this}removePanelClass(t){return this._ref.removePanelClass(t),this}getState(){return this._state}_finishDialogClose(){this._state=fT.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function mse(n,t,e){return n._closeInteractionType=t,n.close(e)}var mp=new rt("MatMdcDialogData"),gse=new rt("mat-mdc-dialog-default-options"),_se=new rt("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let n=se(en);return()=>Kg(n)}}),ya=(()=>{class n{_defaultOptions=se(gse,{optional:!0});_scrollStrategy=se(_se);_parentDialog=se(n,{optional:!0,skipSelf:!0});_idGenerator=se(ga);_injector=se(en);_dialog=se(KP);_animationsDisabled=_c();_openDialogsAtThisLevel=[];_afterAllClosedAtThisLevel=new yt;_afterOpenedAtThisLevel=new yt;dialogConfigClass=pT;_dialogRefConstructor;_dialogContainerType;_dialogDataToken;get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let e=this._parentDialog;return e?e._getAfterAllClosed():this._afterAllClosedAtThisLevel}afterAllClosed=ru(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ra(void 0)));constructor(){this._dialogRefConstructor=Dl,this._dialogContainerType=pse,this._dialogDataToken=mp}open(e,i){let r;i=Be(Be({},this._defaultOptions||new pT),i),i.id=i.id||this._idGenerator.getId("mat-mdc-dialog-"),i.scrollStrategy=i.scrollStrategy||this._scrollStrategy();let o=this._dialog.open(e,Mt(Be({},i),{positionStrategy:Jd(this._injector).centerHorizontally().centerVertically(),disableClose:!0,closePredicate:void 0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,disableAnimations:this._animationsDisabled||i.enterAnimationDuration?.toLocaleString()==="0"||i.exitAnimationDuration?.toString()==="0",container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:i},{provide:eh,useValue:i}]},templateContext:()=>({dialogRef:r}),providers:(d,m,b)=>(r=new this._dialogRefConstructor(d,i,b),r.updatePosition(i?.position),[{provide:this._dialogContainerType,useValue:b},{provide:this._dialogDataToken,useValue:m.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentRef=o.componentRef,r.componentInstance=o.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{let d=this.openDialogs.indexOf(r);d>-1&&(this.openDialogs.splice(d,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(e){return this.openDialogs.find(i=>i.id===e)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(e){let i=e.length;for(;i--;)e[i].close()}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var mT=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[ya],imports:[N$,pp,Su,_a]})}return n})();var XP="Service workers are disabled or not supported by this browser",Qg=class{serviceWorker;worker;registration;events;constructor(t,e){if(this.serviceWorker=t,!t)this.worker=this.events=this.registration=new Kt(i=>i.error(new Je(5601,!1)));else{let i=null,r=new yt;this.worker=new Kt(T=>(i!==null&&T.next(i),r.subscribe(A=>T.next(A))));let o=()=>{let{controller:T}=t;T!==null&&(i=T,r.next(i))};t.addEventListener("controllerchange",o),o(),this.registration=this.worker.pipe(Kr(()=>t.getRegistration().then(T=>{if(!T)throw new Je(5601,!1);return T})));let d=new yt;this.events=d.asObservable();let m=T=>{let{data:A}=T;A?.type&&d.next(A)};t.addEventListener("message",m),e?.get(To,null,{optional:!0})?.onDestroy(()=>{t.removeEventListener("controllerchange",o),t.removeEventListener("message",m)})}}postMessage(t,e){return new Promise(i=>{this.worker.pipe(Xi(1)).subscribe(r=>{r.postMessage(Be({action:t},e)),i()})})}postMessageWithOperation(t,e,i){let r=this.waitForOperationCompleted(i),o=this.postMessage(t,e);return Promise.all([o,r]).then(([,d])=>d)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(t){let e;return typeof t=="string"?e=i=>i.type===t:e=i=>t.includes(i.type),this.events.pipe(mi(e))}nextEventOfType(t){return this.eventsOfType(t).pipe(Xi(1))}waitForOperationCompleted(t){return new Promise((e,i)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(mi(r=>r.nonce===t),Xi(1),Tn(r=>{if(r.result!==void 0)return r.result;throw new Error(r.error)})).subscribe({next:e,error:i})})}get isEnabled(){return!!this.serviceWorker}},j$=(()=>{class n{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new yt;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=ou,this.notificationClicks=ou,this.notificationCloses=ou,this.pushSubscriptionChanges=ou,this.subscription=ou;return}this.messages=this.sw.eventsOfType("PUSH").pipe(Tn(r=>r.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(Tn(r=>r.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(Tn(r=>r.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(Tn(r=>r.data)),this.pushManager=this.sw.registration.pipe(Tn(r=>r.pushManager));let i=this.pushManager.pipe(Kr(r=>r.getSubscription()));this.subscription=new Kt(r=>{let o=i.subscribe(r),d=this.subscriptionChanges.subscribe(r);return()=>{o.unsubscribe(),d.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(XP));let i={userVisibleOnly:!0},r=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(r.length));for(let d=0;d<r.length;d++)o[d]=r.charCodeAt(d);return i.applicationServerKey=o,new Promise((d,m)=>{this.pushManager.pipe(Kr(b=>b.subscribe(i)),Xi(1)).subscribe({next:b=>{this.subscriptionChanges.next(b),d(b)},error:m})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(XP));let e=i=>{if(i===null)throw new Je(5602,!1);return i.unsubscribe().then(r=>{if(!r)throw new Je(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((i,r)=>{this.subscription.pipe(Xi(1),Kr(e)).subscribe({next:i,error:r})})}decodeBase64(e){return atob(e)}static \u0275fac=function(i){return new(i||n)(vt(Qg))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),gT=(()=>{class n{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=ou,this.unrecoverable=ou;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(XP));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let e=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Je(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(i){return new(i||n)(vt(Qg))};static \u0275prov=ze({token:n,factory:n.\u0275fac})}return n})(),z$=new rt("");function yse(){let n=se(j0);if(!("serviceWorker"in navigator&&n.enabled!==!1))return;let t=se(z$),e=se(jt),i=se(To);e.runOutsideAngular(()=>{let r=navigator.serviceWorker,o=()=>r.controller?.postMessage({action:"INITIALIZE"});r.addEventListener("controllerchange",o),i.onDestroy(()=>{r.removeEventListener("controllerchange",o)})}),e.runOutsideAngular(()=>{let r,{registrationStrategy:o}=n;if(typeof o=="function")r=new Promise(d=>o().subscribe(()=>d()));else{let[d,...m]=(o||"registerWhenStable:30000").split(":");switch(d){case"registerImmediately":r=Promise.resolve();break;case"registerWithDelay":r=V$(+m[0]||0);break;case"registerWhenStable":r=Promise.race([i.whenStable(),V$(+m[0])]);break;default:throw new Je(5600,!1)}}r.then(()=>{i.destroyed||navigator.serviceWorker.register(t,{scope:n.scope,updateViaCache:n.updateViaCache,type:n.type}).catch(d=>console.error(Ma(5604,!1)))})})}function V$(n){return new Promise(t=>setTimeout(t,n))}function vse(){let n=se(j0),t=se(en),e=!0;return new Qg(e&&n.enabled!==!1?navigator.serviceWorker:void 0,t)}var j0=class{enabled;updateViaCache;type;scope;registrationStrategy};function bse(n,t={}){return dl([j$,gT,{provide:z$,useValue:n},{provide:j0,useValue:t},{provide:Qg,useFactory:vse},Tg(yse)])}var U$=(()=>{class n{static register(e,i={}){return{ngModule:n,providers:[bse(e,i)]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[j$,gT]})}return n})();var JP={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var gt=function(n,t){if(!n)throw gp(t)},gp=function(n){return new Error("Firebase Database ("+JP.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var H$=function(n){let t=[],e=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},xse=function(n){let t=[],e=0,i=0;for(;e<n.length;){let r=n[e++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let o=n[e++];t[i++]=String.fromCharCode((r&31)<<6|o&63)}else if(r>239&&r<365){let o=n[e++],d=n[e++],m=n[e++],b=((r&7)<<18|(o&63)<<12|(d&63)<<6|m&63)-65536;t[i++]=String.fromCharCode(55296+(b>>10)),t[i++]=String.fromCharCode(56320+(b&1023))}else{let o=n[e++],d=n[e++];t[i++]=String.fromCharCode((r&15)<<12|(o&63)<<6|d&63)}}return t.join("")},yT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let o=n[r],d=r+1<n.length,m=d?n[r+1]:0,b=r+2<n.length,T=b?n[r+2]:0,A=o>>2,N=(o&3)<<4|m>>4,q=(m&15)<<2|T>>6,J=T&63;b||(J=64,d||(q=64)),i.push(e[A],e[N],e[q],e[J])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(H$(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):xse(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let o=e[n.charAt(r++)],m=r<n.length?e[n.charAt(r)]:0;++r;let T=r<n.length?e[n.charAt(r)]:64;++r;let N=r<n.length?e[n.charAt(r)]:64;if(++r,o==null||m==null||T==null||N==null)throw new e2;let q=o<<2|m>>4;if(i.push(q),T!==64){let J=m<<4&240|T>>2;if(i.push(J),N!==64){let K=T<<6&192|N;i.push(K)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},e2=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},n2=function(n){let t=H$(n);return yT.encodeByteArray(t,!0)},z0=function(n){return n2(n).replace(/\./g,"")},U0=function(n){try{return yT.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function G$(n){return q$(void 0,n)}function q$(n,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:let e=t;return new Date(e.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return t}for(let e in t)!t.hasOwnProperty(e)||!Ese(e)||(n[e]=q$(n[e],t[e]));return n}function Ese(n){return n!=="__proto__"}function Cse(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Tse=()=>Cse().__FIREBASE_DEFAULTS__,Sse=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Dse=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=n&&U0(n[1]);return t&&JSON.parse(t)},i2=()=>{try{return Tse()||Sse()||Dse()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},r2=n=>{var t,e;return(e=(t=i2())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},vT=n=>{let t=r2(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},o2=()=>{var n;return(n=i2())===null||n===void 0?void 0:n.config},s2=n=>{var t;return(t=i2())===null||t===void 0?void 0:t[`_${n}`]};var Du=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}};function bT(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},i=t||"demo-project",r=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let d=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[z0(JSON.stringify(e)),z0(JSON.stringify(d)),""].join(".")}function ts(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function $0(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ts())}function W$(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Z$(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wT(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function K$(){let n=ts();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function vc(){return JP.NODE_CLIENT===!0||JP.NODE_ADMIN===!0}function xT(){try{return typeof indexedDB=="object"}catch(n){return!1}}function ET(){return new Promise((n,t)=>{try{let e=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{e=!1},r.onerror=()=>{var o;t(((o=r.error)===null||o===void 0?void 0:o.message)||"")}}catch(e){t(e)}})}function Y$(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}var Ise="FirebaseError",xs=class n extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Ise,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,va.prototype.create)}},va=class{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){let i=e[0]||{},r=`${this.service}/${t}`,o=this.errors[t],d=o?Mse(o,i):"Error",m=`${this.serviceName}: ${d} (${r}).`;return new xs(r,m,i)}};function Mse(n,t){return n.replace(Ase,(e,i)=>{let r=t[i];return r!=null?String(r):`<${i}?>`})}var Ase=/\{\$([^}]+)}/g;function Jg(n){return JSON.parse(n)}function Xr(n){return JSON.stringify(n)}var X$=function(n){let t={},e={},i={},r="";try{let o=n.split(".");t=Jg(U0(o[0])||""),e=Jg(U0(o[1])||""),r=o[2],i=e.d||{},delete e.d}catch(o){}return{header:t,claims:e,data:i,signature:r}};var Q$=function(n){let t=X$(n),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},J$=function(n){let t=X$(n).claims;return typeof t=="object"&&t.admin===!0};function Il(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function _p(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]}function H0(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function G0(n,t,e){let i={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=t.call(e,n[r],r,n));return i}function e_(n,t){if(n===t)return!0;let e=Object.keys(n),i=Object.keys(t);for(let r of e){if(!i.includes(r))return!1;let o=n[r],d=t[r];if($$(o)&&$$(d)){if(!e_(o,d))return!1}else if(o!==d)return!1}for(let r of i)if(!e.includes(r))return!1;return!0}function $$(n){return n!==null&&typeof n=="object"}function th(n){let t=[];for(let[e,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(r))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}var _T=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);let i=this.W_;if(typeof t=="string")for(let N=0;N<16;N++)i[N]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let N=0;N<16;N++)i[N]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let N=16;N<80;N++){let q=i[N-3]^i[N-8]^i[N-14]^i[N-16];i[N]=(q<<1|q>>>31)&4294967295}let r=this.chain_[0],o=this.chain_[1],d=this.chain_[2],m=this.chain_[3],b=this.chain_[4],T,A;for(let N=0;N<80;N++){N<40?N<20?(T=m^o&(d^m),A=1518500249):(T=o^d^m,A=1859775393):N<60?(T=o&d|m&(o|d),A=2400959708):(T=o^d^m,A=3395469782);let q=(r<<5|r>>>27)+T+b+A+i[N]&4294967295;b=m,m=d,d=(o<<30|o>>>2)&4294967295,o=r,r=q}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+d&4294967295,this.chain_[3]=this.chain_[3]+m&4294967295,this.chain_[4]=this.chain_[4]+b&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);let i=e-this.blockSize,r=0,o=this.buf_,d=this.inbuf_;for(;r<e;){if(d===0)for(;r<=i;)this.compress_(t,r),r+=this.blockSize;if(typeof t=="string"){for(;r<e;)if(o[d]=t.charCodeAt(r),++d,++r,d===this.blockSize){this.compress_(o),d=0;break}}else for(;r<e;)if(o[d]=t[r],++d,++r,d===this.blockSize){this.compress_(o),d=0;break}}this.inbuf_=d,this.total_+=e}digest(){let t=[],e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=e&255,e/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let o=24;o>=0;o-=8)t[i]=this.chain_[r]>>o&255,++i;return t}};function e8(n,t){let e=new t2(n,t);return e.subscribe.bind(e)}var t2=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,i){let r;if(t===void 0&&e===void 0&&i===void 0)throw new Error("Missing Observer.");kse(t,["next","error","complete"])?r=t:r={next:t,error:e,complete:i},r.next===void 0&&(r.next=QP),r.error===void 0&&(r.error=QP),r.complete===void 0&&(r.complete=QP);let o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(d){}}),this.observers.push(r),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function kse(n,t){if(typeof n!="object"||n===null)return!1;for(let e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function QP(){}function q0(n,t){return`${n} failed: ${t} argument `}var t8=function(n){let t=[],e=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){let o=r-55296;i++,gt(i<n.length,"Surrogate pair missing trail surrogate.");let d=n.charCodeAt(i)-56320;r=65536+(o<<10)+d}r<128?t[e++]=r:r<2048?(t[e++]=r>>6|192,t[e++]=r&63|128):r<65536?(t[e++]=r>>12|224,t[e++]=r>>6&63|128,t[e++]=r&63|128):(t[e++]=r>>18|240,t[e++]=r>>12&63|128,t[e++]=r>>6&63|128,t[e++]=r&63|128)}return t},W0=function(n){let t=0;for(let e=0;e<n.length;e++){let i=n.charCodeAt(e);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,e++):t+=3}return t};var mVe=14400*1e3;function Ci(n){return n&&n._delegate?n._delegate:n}var Qr=class{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var yp="[DEFAULT]";var CT=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let i=new Du;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:e});r&&i.resolve(r)}catch(r){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let i=this.normalizeInstanceIdentifier(t?.identifier),r=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(r)return null;throw o}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Pse(t))try{this.getOrInitializeService({instanceIdentifier:yp})}catch(e){}for(let[e,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let o=this.getOrInitializeService({instanceIdentifier:r});i.resolve(o)}catch(o){}}}}clearInstance(t=yp){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return ae(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=yp){return this.instances.has(t)}getOptions(t=yp){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:e});for(let[o,d]of this.instancesDeferred.entries()){let m=this.normalizeInstanceIdentifier(o);i===m&&d.resolve(r)}return r}onInit(t,e){var i;let r=this.normalizeInstanceIdentifier(e),o=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;o.add(t),this.onInitCallbacks.set(r,o);let d=this.instances.get(r);return d&&t(d,r),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){let i=this.onInitCallbacks.get(e);if(i)for(let r of i)try{r(t,e)}catch(o){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Rse(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(r){}return i||null}normalizeInstanceIdentifier(t=yp){return this.component?this.component.multipleInstances?t:yp:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function Rse(n){return n===yp?void 0:n}function Pse(n){return n.instantiationMode==="EAGER"}var Z0=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new CT(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var Nse=[],gi=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(gi||{}),Ose={debug:gi.DEBUG,verbose:gi.VERBOSE,info:gi.INFO,warn:gi.WARN,error:gi.ERROR,silent:gi.SILENT},Fse=gi.INFO,Lse={[gi.DEBUG]:"log",[gi.VERBOSE]:"log",[gi.INFO]:"info",[gi.WARN]:"warn",[gi.ERROR]:"error"},Bse=(n,t,...e)=>{if(t<n.logLevel)return;let i=new Date().toISOString(),r=Lse[t];if(r)console[r](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},nh=class{constructor(t){this.name=t,this._logLevel=Fse,this._logHandler=Bse,this._userLogHandler=null,Nse.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in gi))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ose[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,gi.DEBUG,...t),this._logHandler(this,gi.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,gi.VERBOSE,...t),this._logHandler(this,gi.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,gi.INFO,...t),this._logHandler(this,gi.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,gi.WARN,...t),this._logHandler(this,gi.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,gi.ERROR,...t),this._logHandler(this,gi.ERROR,...t)}};var Vse=(n,t)=>t.some(e=>n instanceof e),n8,i8;function jse(){return n8||(n8=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zse(){return i8||(i8=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var r8=new WeakMap,l2=new WeakMap,o8=new WeakMap,a2=new WeakMap,u2=new WeakMap;function Use(n){let t=new Promise((e,i)=>{let r=()=>{n.removeEventListener("success",o),n.removeEventListener("error",d)},o=()=>{e(Ml(n.result)),r()},d=()=>{i(n.error),r()};n.addEventListener("success",o),n.addEventListener("error",d)});return t.then(e=>{e instanceof IDBCursor&&r8.set(e,n)}).catch(()=>{}),u2.set(t,n),t}function $se(n){if(l2.has(n))return;let t=new Promise((e,i)=>{let r=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",d),n.removeEventListener("abort",d)},o=()=>{e(),r()},d=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",o),n.addEventListener("error",d),n.addEventListener("abort",d)});l2.set(n,t)}var c2={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return l2.get(n);if(t==="objectStoreNames")return n.objectStoreNames||o8.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ml(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function s8(n){c2=n(c2)}function Hse(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=n.call(TT(this),t,...e);return o8.set(i,t.sort?t.sort():[t]),Ml(i)}:zse().includes(n)?function(...t){return n.apply(TT(this),t),Ml(r8.get(this))}:function(...t){return Ml(n.apply(TT(this),t))}}function Gse(n){return typeof n=="function"?Hse(n):(n instanceof IDBTransaction&&$se(n),Vse(n,jse())?new Proxy(n,c2):n)}function Ml(n){if(n instanceof IDBRequest)return Use(n);if(a2.has(n))return a2.get(n);let t=Gse(n);return t!==n&&(a2.set(n,t),u2.set(t,n)),t}var TT=n=>u2.get(n);function vp(n,t,{blocked:e,upgrade:i,blocking:r,terminated:o}={}){let d=indexedDB.open(n,t),m=Ml(d);return i&&d.addEventListener("upgradeneeded",b=>{i(Ml(d.result),b.oldVersion,b.newVersion,Ml(d.transaction),b)}),e&&d.addEventListener("blocked",b=>e(b.oldVersion,b.newVersion,b)),m.then(b=>{o&&b.addEventListener("close",()=>o()),r&&b.addEventListener("versionchange",T=>r(T.oldVersion,T.newVersion,T))}).catch(()=>{}),m}function ST(n,{blocked:t}={}){let e=indexedDB.deleteDatabase(n);return t&&e.addEventListener("blocked",i=>t(i.oldVersion,i)),Ml(e).then(()=>{})}var qse=["get","getKey","getAll","getAllKeys","count"],Wse=["put","add","delete","clear"],d2=new Map;function a8(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(d2.get(t))return d2.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,r=Wse.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(r||qse.includes(e)))return;let o=function(d,...m){return ae(this,null,function*(){let b=this.transaction(d,r?"readwrite":"readonly"),T=b.store;return i&&(T=T.index(m.shift())),(yield Promise.all([T[e](...m),r&&b.done]))[0]})};return d2.set(t,o),o}s8(n=>Mt(Be({},n),{get:(t,e,i)=>a8(t,e)||n.get(t,e,i),has:(t,e)=>!!a8(t,e)||n.has(t,e)}));var f2=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Zse(e)){let i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}};function Zse(n){let t=n.getComponent();return t?.type==="VERSION"}var p2="@firebase/app",l8="0.10.13";var Iu=new nh("@firebase/app"),Kse="@firebase/app-compat",Yse="@firebase/analytics-compat",Xse="@firebase/analytics",Qse="@firebase/app-check-compat",Jse="@firebase/app-check",eae="@firebase/auth",tae="@firebase/auth-compat",nae="@firebase/database",iae="@firebase/data-connect",rae="@firebase/database-compat",oae="@firebase/functions",sae="@firebase/functions-compat",aae="@firebase/installations",lae="@firebase/installations-compat",cae="@firebase/messaging",uae="@firebase/messaging-compat",dae="@firebase/performance",hae="@firebase/performance-compat",fae="@firebase/remote-config",pae="@firebase/remote-config-compat",mae="@firebase/storage",gae="@firebase/storage-compat",_ae="@firebase/firestore",yae="@firebase/vertexai-preview",vae="@firebase/firestore-compat",bae="firebase",wae="10.14.1";var m2="[DEFAULT]",xae={[p2]:"fire-core",[Kse]:"fire-core-compat",[Xse]:"fire-analytics",[Yse]:"fire-analytics-compat",[Jse]:"fire-app-check",[Qse]:"fire-app-check-compat",[eae]:"fire-auth",[tae]:"fire-auth-compat",[nae]:"fire-rtdb",[iae]:"fire-data-connect",[rae]:"fire-rtdb-compat",[oae]:"fire-fn",[sae]:"fire-fn-compat",[aae]:"fire-iid",[lae]:"fire-iid-compat",[cae]:"fire-fcm",[uae]:"fire-fcm-compat",[dae]:"fire-perf",[hae]:"fire-perf-compat",[fae]:"fire-rc",[pae]:"fire-rc-compat",[mae]:"fire-gcs",[gae]:"fire-gcs-compat",[_ae]:"fire-fst",[vae]:"fire-fst-compat",[yae]:"fire-vertex","fire-js":"fire-js",[bae]:"fire-js-all"};var DT=new Map,Eae=new Map,g2=new Map;function c8(n,t){try{n.container.addComponent(t)}catch(e){Iu.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function ns(n){let t=n.name;if(g2.has(t))return Iu.debug(`There were multiple attempts to register component ${t}.`),!1;g2.set(t,n);for(let e of DT.values())c8(e,n);for(let e of Eae.values())c8(e,n);return!0}function qa(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Al(n){return n.settings!==void 0}var Cae={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ih=new va("app","Firebase",Cae);var _2=class{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Qr("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ih.create("app-deleted",{appName:this._name})}};var bc=wae;function b2(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let i=Object.assign({name:m2,automaticDataCollectionEnabled:!1},t),r=i.name;if(typeof r!="string"||!r)throw ih.create("bad-app-name",{appName:String(r)});if(e||(e=o2()),!e)throw ih.create("no-options");let o=DT.get(r);if(o){if(e_(e,o.options)&&e_(i,o.config))return o;throw ih.create("duplicate-app",{appName:r})}let d=new Z0(r);for(let b of g2.values())d.addComponent(b);let m=new _2(e,i,d);return DT.set(r,m),m}function Mu(n=m2){let t=DT.get(n);if(!t&&n===m2&&o2())return b2();if(!t)throw ih.create("no-app",{appName:n});return t}function Jr(n,t,e){var i;let r=(i=xae[n])!==null&&i!==void 0?i:n;e&&(r+=`-${e}`);let o=r.match(/\s|\//),d=t.match(/\s|\//);if(o||d){let m=[`Unable to register library "${r}" with version "${t}":`];o&&m.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&d&&m.push("and"),d&&m.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Iu.warn(m.join(" "));return}ns(new Qr(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}var Tae="firebase-heartbeat-database",Sae=1,K0="firebase-heartbeat-store",h2=null;function f8(){return h2||(h2=vp(Tae,Sae,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(K0)}catch(e){console.warn(e)}}}}).catch(n=>{throw ih.create("idb-open",{originalErrorMessage:n.message})})),h2}function Dae(n){return ae(this,null,function*(){try{let e=(yield f8()).transaction(K0),i=yield e.objectStore(K0).get(p8(n));return yield e.done,i}catch(t){if(t instanceof xs)Iu.warn(t.message);else{let e=ih.create("idb-get",{originalErrorMessage:t?.message});Iu.warn(e.message)}}})}function u8(n,t){return ae(this,null,function*(){try{let i=(yield f8()).transaction(K0,"readwrite");yield i.objectStore(K0).put(t,p8(n)),yield i.done}catch(e){if(e instanceof xs)Iu.warn(e.message);else{let i=ih.create("idb-set",{originalErrorMessage:e?.message});Iu.warn(i.message)}}})}function p8(n){return`${n.name}!${n.options.appId}`}var Iae=1024,Mae=720*60*60*1e3,y2=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new v2(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return ae(this,null,function*(){var t,e;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=d8();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(d=>d.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(d=>{let m=new Date(d.date).valueOf();return Date.now()-m<=Mae}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Iu.warn(i)}})}getHeartbeatsHeader(){return ae(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=d8(),{heartbeatsToSend:i,unsentEntries:r}=Aae(this._heartbeatsCache.heartbeats),o=z0(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(e){return Iu.warn(e),""}})}};function d8(){return new Date().toISOString().substring(0,10)}function Aae(n,t=Iae){let e=[],i=n.slice();for(let r of n){let o=e.find(d=>d.agent===r.agent);if(o){if(o.dates.push(r.date),h8(e)>t){o.dates.pop();break}}else if(e.push({agent:r.agent,dates:[r.date]}),h8(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}var v2=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return ae(this,null,function*(){return xT()?ET().then(()=>!0).catch(()=>!1):!1})}read(){return ae(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Dae(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return ae(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return u8(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return ae(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return u8(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return})}};function h8(n){return z0(JSON.stringify({version:2,heartbeats:n})).length}function kae(n){ns(new Qr("platform-logger",t=>new f2(t),"PRIVATE")),ns(new Qr("heartbeat",t=>new y2(t),"PRIVATE")),Jr(p2,l8,n),Jr(p2,l8,"esm2017"),Jr("fire-js","")}kae("");var Rae="firebase",Pae="10.14.1";Jr(Rae,Pae,"app");function IT(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e}function M8(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var A8=M8,k8=new va("auth","Firebase",M8());var NT=new nh("@firebase/auth");function Nae(n,...t){NT.logLevel<=gi.WARN&&NT.warn(`Auth (${bc}): ${n}`,...t)}function AT(n,...t){NT.logLevel<=gi.ERROR&&NT.error(`Auth (${bc}): ${n}`,...t)}function xc(n,...t){throw B2(n,...t)}function kl(n,...t){return B2(n,...t)}function L2(n,t,e){let i=Object.assign(Object.assign({},A8()),{[t]:e});return new va("auth","Firebase",i).create(t,{appName:n.name})}function oh(n){return L2(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function R8(n,t,e){let i=e;if(!(t instanceof i))throw i.name!==t.constructor.name&&xc(n,"argument-error"),L2(n,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function B2(n,...t){if(typeof n!="string"){let e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return k8.create(n,...t)}function pn(n,t,...e){if(!n)throw B2(t,...e)}function Au(n){let t="INTERNAL ASSERTION FAILED: "+n;throw AT(t),new Error(t)}function Ru(n,t){n||Au(t)}function E2(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function Oae(){return m8()==="http:"||m8()==="https:"}function m8(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function Fae(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Oae()||Z$()||"connection"in navigator)?navigator.onLine:!0}function Lae(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var bp=class{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ru(e>t,"Short delay should be less than long delay!"),this.isMobile=$0()||wT()}get(){return Fae()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function V2(n,t){Ru(n.emulator,"Emulator should always be set here");let{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}var OT=class{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Au("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Au("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Au("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Bae={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Vae=new bp(3e4,6e4);function j2(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}function r_(o,d,m,b){return ae(this,arguments,function*(n,t,e,i,r={}){return P8(n,r,()=>ae(null,null,function*(){let T={},A={};i&&(t==="GET"?A=i:T={body:JSON.stringify(i)});let N=th(Object.assign({key:n.config.apiKey},A)).slice(1),q=yield n._getAdditionalHeaders();q["Content-Type"]="application/json",n.languageCode&&(q["X-Firebase-Locale"]=n.languageCode);let J=Object.assign({method:t,headers:q},T);return W$()||(J.referrerPolicy="no-referrer"),OT.fetch()(N8(n,n.config.apiHost,e,N),J)}))})}function P8(n,t,e){return ae(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},Bae),t);try{let r=new C2(n),o=yield Promise.race([e(),r.promise]);r.clearNetworkTimeout();let d=yield o.json();if("needConfirmation"in d)throw MT(n,"account-exists-with-different-credential",d);if(o.ok&&!("errorMessage"in d))return d;{let m=o.ok?d.errorMessage:d.error.message,[b,T]=m.split(" : ");if(b==="FEDERATED_USER_ID_ALREADY_LINKED")throw MT(n,"credential-already-in-use",d);if(b==="EMAIL_EXISTS")throw MT(n,"email-already-in-use",d);if(b==="USER_DISABLED")throw MT(n,"user-disabled",d);let A=i[b]||b.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw L2(n,A,T);xc(n,A)}}catch(r){if(r instanceof xs)throw r;xc(n,"network-request-failed",{message:String(r)})}})}function jae(o,d,m,b){return ae(this,arguments,function*(n,t,e,i,r={}){let T=yield r_(n,t,e,i,r);return"mfaPendingCredential"in T&&xc(n,"multi-factor-auth-required",{_serverResponse:T}),T})}function N8(n,t,e,i){let r=`${t}${e}?${i}`;return n.config.emulator?V2(n.config,r):`${n.config.apiScheme}://${r}`}var C2=class{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(kl(this.auth,"network-request-failed")),Vae.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}};function MT(n,t,e){let i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);let r=kl(n,t,i);return r.customData._tokenResponse=e,r}function zae(n,t){return ae(this,null,function*(){return r_(n,"POST","/v1/accounts:delete",t)})}function O8(n,t){return ae(this,null,function*(){return r_(n,"POST","/v1/accounts:lookup",t)})}function Y0(n){if(n)try{let t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function F8(n,t=!1){return ae(this,null,function*(){let e=Ci(n),i=yield e.getIdToken(t),r=z2(i);pn(r&&r.exp&&r.auth_time&&r.iat,e.auth,"internal-error");let o=typeof r.firebase=="object"?r.firebase:void 0,d=o?.sign_in_provider;return{claims:r,token:i,authTime:Y0(w2(r.auth_time)),issuedAtTime:Y0(w2(r.iat)),expirationTime:Y0(w2(r.exp)),signInProvider:d||null,signInSecondFactor:o?.sign_in_second_factor||null}})}function w2(n){return Number(n)*1e3}function z2(n){let[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return AT("JWT malformed, contained fewer than 3 sections"),null;try{let r=U0(e);return r?JSON.parse(r):(AT("Failed to decode base64 JWT payload"),null)}catch(r){return AT("Caught error parsing JWT payload as JSON",r?.toString()),null}}function g8(n){let t=z2(n);return pn(t,"internal-error"),pn(typeof t.exp<"u","internal-error"),pn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}function Q0(n,t,e=!1){return ae(this,null,function*(){if(e)return t;try{return yield t}catch(i){throw i instanceof xs&&Uae(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function Uae({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var T2=class{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(t=!1){if(!this.isRunning)return;let e=this.getInterval(t);this.timerId=setTimeout(()=>ae(this,null,function*(){yield this.iteration()}),e)}iteration(){return ae(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var J0=class{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Y0(this.lastLoginAt),this.creationTime=Y0(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function FT(n){return ae(this,null,function*(){var t;let e=n.auth,i=yield n.getIdToken(),r=yield Q0(n,O8(e,{idToken:i}));pn(r?.users.length,e,"internal-error");let o=r.users[0];n._notifyReloadListener(o);let d=!((t=o.providerUserInfo)===null||t===void 0)&&t.length?B8(o.providerUserInfo):[],m=$ae(n.providerData,d),b=n.isAnonymous,T=!(n.email&&o.passwordHash)&&!m?.length,A=b?T:!1,N={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:m,metadata:new J0(o.createdAt,o.lastLoginAt),isAnonymous:A};Object.assign(n,N)})}function L8(n){return ae(this,null,function*(){let t=Ci(n);yield FT(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}function $ae(n,t){return[...n.filter(i=>!t.some(r=>r.providerId===i.providerId)),...t]}function B8(n){return n.map(t=>{var{providerId:e}=t,i=IT(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function Hae(n,t){return ae(this,null,function*(){let e=yield P8(n,{},()=>ae(null,null,function*(){let i=th({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:o}=n.config,d=N8(n,r,"/v1/token",`key=${o}`),m=yield n._getAdditionalHeaders();return m["Content-Type"]="application/x-www-form-urlencoded",OT.fetch()(d,{method:"POST",headers:m,body:i})}));return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}})}function Gae(n,t){return ae(this,null,function*(){return r_(n,"POST","/v2/accounts:revokeToken",j2(n,t))})}var X0=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){pn(t.idToken,"internal-error"),pn(typeof t.idToken<"u","internal-error"),pn(typeof t.refreshToken<"u","internal-error");let e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):g8(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){pn(t.length!==0,"internal-error");let e=g8(t);this.updateTokensAndExpiration(t,null,e)}getToken(t,e=!1){return ae(this,null,function*(){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(pn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(yield this.refresh(t,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(t,e){return ae(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:o}=yield Hae(t,e);this.updateTokensAndExpiration(i,r,Number(o))})}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){let{refreshToken:i,accessToken:r,expirationTime:o}=e,d=new n;return i&&(pn(typeof i=="string","internal-error",{appName:t}),d.refreshToken=i),r&&(pn(typeof r=="string","internal-error",{appName:t}),d.accessToken=r),o&&(pn(typeof o=="number","internal-error",{appName:t}),d.expirationTime=o),d}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Au("not implemented")}};function rh(n,t){pn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}var n_=class n{constructor(t){var{uid:e,auth:i,stsTokenManager:r}=t,o=IT(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new T2(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new J0(o.createdAt||void 0,o.lastLoginAt||void 0)}getIdToken(t){return ae(this,null,function*(){let e=yield Q0(this,this.stsTokenManager.getToken(this.auth,t));return pn(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e})}getIdTokenResult(t){return F8(this,t)}reload(){return L8(this)}_assign(t){this!==t&&(pn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){let e=new n(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){pn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(t,e=!1){return ae(this,null,function*(){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&(yield FT(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return ae(this,null,function*(){if(Al(this.auth.app))return Promise.reject(oh(this.auth));let t=yield this.getIdToken();return yield Q0(this,zae(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,r,o,d,m,b,T,A;let N=(i=e.displayName)!==null&&i!==void 0?i:void 0,q=(r=e.email)!==null&&r!==void 0?r:void 0,J=(o=e.phoneNumber)!==null&&o!==void 0?o:void 0,K=(d=e.photoURL)!==null&&d!==void 0?d:void 0,xe=(m=e.tenantId)!==null&&m!==void 0?m:void 0,Te=(b=e._redirectEventId)!==null&&b!==void 0?b:void 0,Ge=(T=e.createdAt)!==null&&T!==void 0?T:void 0,Et=(A=e.lastLoginAt)!==null&&A!==void 0?A:void 0,{uid:kt,emailVerified:Ue,isAnonymous:Oe,providerData:Qe,stsTokenManager:ct}=e;pn(kt&&ct,t,"internal-error");let bt=X0.fromJSON(this.name,ct);pn(typeof kt=="string",t,"internal-error"),rh(N,t.name),rh(q,t.name),pn(typeof Ue=="boolean",t,"internal-error"),pn(typeof Oe=="boolean",t,"internal-error"),rh(J,t.name),rh(K,t.name),rh(xe,t.name),rh(Te,t.name),rh(Ge,t.name),rh(Et,t.name);let Gt=new n({uid:kt,auth:t,email:q,emailVerified:Ue,displayName:N,isAnonymous:Oe,photoURL:K,phoneNumber:J,tenantId:xe,stsTokenManager:bt,createdAt:Ge,lastLoginAt:Et});return Qe&&Array.isArray(Qe)&&(Gt.providerData=Qe.map(Bt=>Object.assign({},Bt))),Te&&(Gt._redirectEventId=Te),Gt}static _fromIdTokenResponse(t,e,i=!1){return ae(this,null,function*(){let r=new X0;r.updateFromServerResponse(e);let o=new n({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:i});return yield FT(o),o})}static _fromGetAccountInfoResponse(t,e,i){return ae(this,null,function*(){let r=e.users[0];pn(r.localId!==void 0,"internal-error");let o=r.providerUserInfo!==void 0?B8(r.providerUserInfo):[],d=!(r.email&&r.passwordHash)&&!o?.length,m=new X0;m.updateFromIdToken(i);let b=new n({uid:r.localId,auth:t,stsTokenManager:m,isAnonymous:d}),T={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:o,metadata:new J0(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!o?.length};return Object.assign(b,T),b})}};var _8=new Map;function ku(n){Ru(n instanceof Function,"Expected a class definition");let t=_8.get(n);return t?(Ru(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,_8.set(n,t),t)}var qae=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return ae(this,null,function*(){return!0})}_set(e,i){return ae(this,null,function*(){this.storage[e]=i})}_get(e){return ae(this,null,function*(){let i=this.storage[e];return i===void 0?null:i})}_remove(e){return ae(this,null,function*(){delete this.storage[e]})}_addListener(e,i){}_removeListener(e,i){}}return n.type="NONE",n})(),S2=qae;function kT(n,t,e){return`firebase:${n}:${t}:${e}`}var LT=class n{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;let{config:r,name:o}=this.auth;this.fullUserKey=kT(this.userKey,r.apiKey,o),this.fullPersistenceKey=kT("persistence",r.apiKey,o),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}getCurrentUser(){return ae(this,null,function*(){let t=yield this.persistence._get(this.fullUserKey);return t?n_._fromJSON(this.auth,t):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(t){return ae(this,null,function*(){if(this.persistence===t)return;let e=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(t,e,i="authUser"){return ae(this,null,function*(){if(!e.length)return new n(ku(S2),t,i);let r=(yield Promise.all(e.map(T=>ae(null,null,function*(){if(yield T._isAvailable())return T})))).filter(T=>T),o=r[0]||ku(S2),d=kT(i,t.config.apiKey,t.name),m=null;for(let T of e)try{let A=yield T._get(d);if(A){let N=n_._fromJSON(t,A);T!==o&&(m=N),o=T;break}}catch(A){}let b=r.filter(T=>T._shouldAllowMigration);return!o._shouldAllowMigration||!b.length?new n(o,t,i):(o=b[0],m&&(yield o._set(d,m.toJSON())),yield Promise.all(e.map(T=>ae(null,null,function*(){if(T!==o)try{yield T._remove(d)}catch(A){}}))),new n(o,t,i))})}};function y8(n){let t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(U8(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(V8(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(H8(t))return"Blackberry";if(G8(t))return"Webos";if(j8(t))return"Safari";if((t.includes("chrome/")||z8(t))&&!t.includes("edge/"))return"Chrome";if($8(t))return"Android";{let e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if(i?.length===2)return i[1]}return"Other"}function V8(n=ts()){return/firefox\//i.test(n)}function j8(n=ts()){let t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function z8(n=ts()){return/crios\//i.test(n)}function U8(n=ts()){return/iemobile/i.test(n)}function $8(n=ts()){return/android/i.test(n)}function H8(n=ts()){return/blackberry/i.test(n)}function G8(n=ts()){return/webos/i.test(n)}function U2(n=ts()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Wae(n=ts()){var t;return U2(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function Zae(){return K$()&&document.documentMode===10}function q8(n=ts()){return U2(n)||$8(n)||G8(n)||H8(n)||/windows phone/i.test(n)||U8(n)}function W8(n,t=[]){let e;switch(n){case"Browser":e=y8(ts());break;case"Worker":e=`${y8(ts())}-${n}`;break;default:e=n}let i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${bc}/${i}`}var D2=class{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){let i=o=>new Promise((d,m)=>{try{let b=t(o);d(b)}catch(b){m(b)}});i.onAbort=e,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(t){return ae(this,null,function*(){if(this.auth.currentUser===t)return;let e=[];try{for(let i of this.queue)yield i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(let r of e)try{r()}catch(o){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function Kae(e){return ae(this,arguments,function*(n,t={}){return r_(n,"GET","/v2/passwordPolicy",j2(n,t))})}var Yae=6,I2=class{constructor(t){var e,i,r,o;let d=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=d.minPasswordLength)!==null&&e!==void 0?e:Yae,d.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=d.maxPasswordLength),d.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=d.containsLowercaseCharacter),d.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=d.containsUppercaseCharacter),d.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=d.containsNumericCharacter),d.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=d.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(o=t.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,r,o,d,m;let b={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,b),this.validatePasswordCharacterOptions(t,b),b.isValid&&(b.isValid=(e=b.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),b.isValid&&(b.isValid=(i=b.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),b.isValid&&(b.isValid=(r=b.containsLowercaseLetter)!==null&&r!==void 0?r:!0),b.isValid&&(b.isValid=(o=b.containsUppercaseLetter)!==null&&o!==void 0?o:!0),b.isValid&&(b.isValid=(d=b.containsNumericCharacter)!==null&&d!==void 0?d:!0),b.isValid&&(b.isValid=(m=b.containsNonAlphanumericCharacter)!==null&&m!==void 0?m:!0),b}validatePasswordLengthOptions(t,e){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),r&&(e.meetsMaxPasswordLength=t.length<=r)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let r=0;r<t.length;r++)i=t.charAt(r),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,r,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}};var M2=class{constructor(t,e,i,r){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new BT(this),this.idTokenSubscription=new BT(this),this.beforeStateQueue=new D2(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=k8,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=ku(e)),this._initializationPromise=this.queue(()=>ae(this,null,function*(){var i,r;if(!this._deleted&&(this.persistenceManager=yield LT.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(o){}yield this.initializeCurrentUser(e),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return ae(this,null,function*(){if(this._deleted)return;let t=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(t,!0)}})}initializeCurrentUserFromIdToken(t){return ae(this,null,function*(){try{let e=yield O8(this,{idToken:t}),i=yield n_._fromGetAccountInfoResponse(this,e,t);yield this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(t){return ae(this,null,function*(){var e;if(Al(this.app)){let d=this.app.settings.authIdToken;return d?new Promise(m=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(d).then(m,m))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,o=!1;if(t&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let d=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,m=r?._redirectEventId,b=yield this.tryRedirectSignIn(t);(!d||d===m)&&b?.user&&(r=b.user,o=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(o)try{yield this.beforeStateQueue.runMiddleware(r)}catch(d){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(d))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return pn(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(t){return ae(this,null,function*(){let e=null;try{e=yield this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(i){yield this._setRedirectUser(null)}return e})}reloadAndSetCurrentUserOrClear(t){return ae(this,null,function*(){try{yield FT(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)})}useDeviceLanguage(){this.languageCode=Lae()}_delete(){return ae(this,null,function*(){this._deleted=!0})}updateCurrentUser(t){return ae(this,null,function*(){if(Al(this.app))return Promise.reject(oh(this));let e=t?Ci(t):null;return e&&pn(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))})}_updateCurrentUser(t,e=!1){return ae(this,null,function*(){if(!this._deleted)return t&&pn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||(yield this.beforeStateQueue.runMiddleware(t)),this.queue(()=>ae(this,null,function*(){yield this.directlySetCurrentUser(t),this.notifyAuthListeners()}))})}signOut(){return ae(this,null,function*(){return Al(this.app)?Promise.reject(oh(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(t){return Al(this.app)?Promise.reject(oh(this)):this.queue(()=>ae(this,null,function*(){yield this.assertedPersistence.setPersistence(ku(t))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(t){return ae(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return ae(this,null,function*(){let t=yield Kae(this),e=new I2(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new va("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{let i=this.onAuthStateChanged(()=>{i(),t()},e)}})}revokeAccessToken(t){return ae(this,null,function*(){if(this.currentUser){let e=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),yield Gae(this,i)}})}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}_setRedirectUser(t,e){return ae(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)})}getOrInitRedirectPersistenceManager(t){return ae(this,null,function*(){if(!this.redirectPersistenceManager){let e=t&&ku(t)||this._popupRedirectResolver;pn(e,this,"argument-error"),this.redirectPersistenceManager=yield LT.create(this,[ku(e._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(t){return ae(this,null,function*(){var e,i;return this._isInitialized&&(yield this.queue(()=>ae(this,null,function*(){}))),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null})}_persistUserIfCurrent(t){return ae(this,null,function*(){if(t===this.currentUser)return this.queue(()=>ae(this,null,function*(){return this.directlySetCurrentUser(t)}))})}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,r){if(this._deleted)return()=>{};let o=typeof e=="function"?e:e.next.bind(e),d=!1,m=this._isInitialized?Promise.resolve():this._initializationPromise;if(pn(m,this,"internal-error"),m.then(()=>{d||o(this.currentUser)}),typeof e=="function"){let b=t.addObserver(e,i,r);return()=>{d=!0,b()}}else{let b=t.addObserver(e);return()=>{d=!0,b()}}}directlySetCurrentUser(t){return ae(this,null,function*(){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?yield this.assertedPersistence.setCurrentUser(t):yield this.assertedPersistence.removeCurrentUser()})}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return pn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=W8(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return ae(this,null,function*(){var t;let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader();i&&(e["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e})}_getAppCheckToken(){return ae(this,null,function*(){var t;let e=yield(t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken();return e?.error&&Nae(`Error while retrieving App Check token: ${e.error}`),e?.token})}};function o_(n){return Ci(n)}var BT=class{constructor(t){this.auth=t,this.observer=null,this.addObserver=e8(e=>this.observer=e)}get next(){return pn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var $2={loadJS(){return ae(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Xae(n){$2=n}function Qae(n){return $2.loadJS(n)}function Jae(){return $2.gapiScript}function Z8(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function K8(n,t){let e=qa(n,"auth");if(e.isInitialized()){let r=e.getImmediate(),o=e.getOptions();if(e_(o,t??{}))return r;xc(r,"already-initialized")}return e.initialize({options:t})}function ele(n,t){let e=t?.persistence||[],i=(Array.isArray(e)?e:[e]).map(ku);t?.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t?.popupRedirectResolver)}function Y8(n,t,e){let i=o_(n);pn(i._canInitEmulator,i,"emulator-config-failed"),pn(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=!!e?.disableWarnings,o=X8(t),{host:d,port:m}=tle(t),b=m===null?"":`:${m}`;i.config.emulator={url:`${o}//${d}${b}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:d,port:m,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||nle()}function X8(n){let t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function tle(n){let t=X8(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};let i=e[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let o=r[1];return{host:o,port:v8(i.substr(o.length+1))}}else{let[o,d]=i.split(":");return{host:o,port:v8(d)}}}function v8(n){if(!n)return null;let t=Number(n);return isNaN(t)?null:t}function nle(){function n(){let t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}var eb=class{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Au("not implemented")}_getIdTokenResponse(t){return Au("not implemented")}_linkToIdToken(t,e){return Au("not implemented")}_getReauthenticationResolver(t){return Au("not implemented")}};function t_(n,t){return ae(this,null,function*(){return jae(n,"POST","/v1/accounts:signInWithIdp",j2(n,t))})}var ile="http://localhost",VT=class n extends eb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){let e=new n(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):xc("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){let e=typeof t=="string"?JSON.parse(t):t,{providerId:i,signInMethod:r}=e,o=IT(e,["providerId","signInMethod"]);if(!i||!r)return null;let d=new n(i,r);return d.idToken=o.idToken||void 0,d.accessToken=o.accessToken||void 0,d.secret=o.secret,d.nonce=o.nonce,d.pendingToken=o.pendingToken||null,d}_getIdTokenResponse(t){let e=this.buildRequest();return t_(t,e)}_linkToIdToken(t,e){let i=this.buildRequest();return i.idToken=e,t_(t,i)}_getReauthenticationResolver(t){let e=this.buildRequest();return e.autoCreate=!1,t_(t,e)}buildRequest(){let t={requestUri:ile,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{let e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=th(e)}return t}};var i_=class{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}};var jT=class extends i_{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}};var ib=(()=>{class n extends jT{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return VT._fromParams({providerId:n.PROVIDER_ID,signInMethod:n.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return n.credentialFromTaggedObject(e)}static credentialFromError(e){return n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:i,oauthAccessToken:r}=e;if(!i&&!r)return null;try{return n.credential(i,r)}catch(o){return null}}}n.GOOGLE_SIGN_IN_METHOD="google.com",n.PROVIDER_ID="google.com";return n})();var tb=class n{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static _fromIdTokenResponse(t,e,i,r=!1){return ae(this,null,function*(){let o=yield n_._fromIdTokenResponse(t,i,r),d=b8(i);return new n({user:o,providerId:d,_tokenResponse:i,operationType:e})})}static _forOperation(t,e,i){return ae(this,null,function*(){yield t._updateTokensIfNecessary(i,!0);let r=b8(i);return new n({user:t,providerId:r,_tokenResponse:i,operationType:e})})}};function b8(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}var A2=class n extends xs{constructor(t,e,i,r){var o;super(e.code,e.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,n.prototype),this.customData={appName:t.name,tenantId:(o=t.tenantId)!==null&&o!==void 0?o:void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,r){return new n(t,e,i,r)}};function Q8(n,t,e,i){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(o=>{throw o.code==="auth/multi-factor-auth-required"?A2._fromErrorAndOperation(n,o,t,i):o})}function rle(n,t,e=!1){return ae(this,null,function*(){let i=yield Q0(n,t._linkToIdToken(n.auth,yield n.getIdToken()),e);return tb._forOperation(n,"link",i)})}function ole(n,t,e=!1){return ae(this,null,function*(){let{auth:i}=n;if(Al(i.app))return Promise.reject(oh(i));let r="reauthenticate";try{let o=yield Q0(n,Q8(i,r,t,n),e);pn(o.idToken,i,"internal-error");let d=z2(o.idToken);pn(d,i,"internal-error");let{sub:m}=d;return pn(n.uid===m,i,"user-mismatch"),tb._forOperation(n,r,o)}catch(o){throw o?.code==="auth/user-not-found"&&xc(i,"user-mismatch"),o}})}function sle(n,t,e=!1){return ae(this,null,function*(){if(Al(n.app))return Promise.reject(oh(n));let i="signIn",r=yield Q8(n,i,t),o=yield tb._fromIdTokenResponse(n,i,r);return e||(yield n._updateCurrentUser(o.user)),o})}function J8(n,t,e,i){return Ci(n).onIdTokenChanged(t,e,i)}function eH(n,t,e){return Ci(n).beforeAuthStateChanged(t,e)}function Pu(n,t,e,i){return Ci(n).onAuthStateChanged(t,e,i)}function H2(n){return Ci(n).signOut()}var zT="__sak";var UT=class{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(zT,"1"),this.storage.removeItem(zT),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){let e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}};var ale=1e3,lle=10,cle=(()=>{class n extends UT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=q8(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let i of Object.keys(this.listeners)){let r=this.storage.getItem(i),o=this.localCache[i];r!==o&&e(i,o,r)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((m,b,T)=>{this.notifyListeners(m,T)});return}let r=e.key;i?this.detachListener():this.stopPolling();let o=()=>{let m=this.storage.getItem(r);!i&&this.localCache[r]===m||this.notifyListeners(r,m)},d=this.storage.getItem(r);Zae()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(o,lle):o()}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let o of Array.from(r))o(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:r}),!0)})},ale)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(e,i){return ae(this,null,function*(){yield vf(n.prototype,this,"_set").call(this,e,i),this.localCache[e]=JSON.stringify(i)})}_get(e){return ae(this,null,function*(){let i=yield vf(n.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(i),i})}_remove(e){return ae(this,null,function*(){yield vf(n.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}return n.type="LOCAL",n})(),tH=cle;var ule=(()=>{class n extends UT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}return n.type="SESSION",n})(),G2=ule;function dle(n){return Promise.all(n.map(t=>ae(null,null,function*(){try{return{fulfilled:!0,value:yield t}}catch(e){return{fulfilled:!1,reason:e}}})))}var hle=(()=>{class n{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let i=this.receivers.find(o=>o.isListeningto(e));if(i)return i;let r=new n(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}handleEvent(e){return ae(this,null,function*(){let i=e,{eventId:r,eventType:o,data:d}=i.data,m=this.handlersMap[o];if(!m?.size)return;i.ports[0].postMessage({status:"ack",eventId:r,eventType:o});let b=Array.from(m).map(A=>ae(this,null,function*(){return A(i.origin,d)})),T=yield dle(b);i.ports[0].postMessage({status:"done",eventId:r,eventType:o,response:T})})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}n.receivers=[];return n})();function q2(n="",t=10){let e="";for(let i=0;i<t;i++)e+=Math.floor(Math.random()*10);return n+e}var k2=class{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}_send(t,e,i=50){return ae(this,null,function*(){let r=typeof MessageChannel<"u"?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let o,d;return new Promise((m,b)=>{let T=q2("",20);r.port1.start();let A=setTimeout(()=>{b(new Error("unsupported_event"))},i);d={messageChannel:r,onMessage(N){let q=N;if(q.data.eventId===T)switch(q.data.status){case"ack":clearTimeout(A),o=setTimeout(()=>{b(new Error("timeout"))},3e3);break;case"done":clearTimeout(o),m(q.data.response);break;default:clearTimeout(A),clearTimeout(o),b(new Error("invalid_response"));break}}},this.handlers.add(d),r.port1.addEventListener("message",d.onMessage),this.target.postMessage({eventType:t,eventId:T,data:e},[r.port2])}).finally(()=>{d&&this.removeMessageHandler(d)})})}};function wc(){return window}function fle(n){wc().location.href=n}function nH(){return typeof wc().WorkerGlobalScope<"u"&&typeof wc().importScripts=="function"}function ple(){return ae(this,null,function*(){if(!navigator?.serviceWorker)return null;try{return(yield navigator.serviceWorker.ready).active}catch(n){return null}})}function mle(){var n;return((n=navigator?.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function gle(){return nH()?self:null}var iH="firebaseLocalStorageDb",_le=1,$T="firebaseLocalStorage",rH="fbase_key",wp=class{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}};function qT(n,t){return n.transaction([$T],t?"readwrite":"readonly").objectStore($T)}function yle(){let n=indexedDB.deleteDatabase(iH);return new wp(n).toPromise()}function R2(){let n=indexedDB.open(iH,_le);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{let i=n.result;try{i.createObjectStore($T,{keyPath:rH})}catch(r){e(r)}}),n.addEventListener("success",()=>ae(null,null,function*(){let i=n.result;i.objectStoreNames.contains($T)?t(i):(i.close(),yield yle(),t(yield R2()))}))})}function w8(n,t,e){return ae(this,null,function*(){let i=qT(n,!0).put({[rH]:t,value:e});return new wp(i).toPromise()})}function vle(n,t){return ae(this,null,function*(){let e=qT(n,!1).get(t),i=yield new wp(e).toPromise();return i===void 0?null:i.value})}function x8(n,t){let e=qT(n,!0).delete(t);return new wp(e).toPromise()}var ble=800,wle=3,xle=(()=>{class n{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return ae(this,null,function*(){return this.db?this.db:(this.db=yield R2(),this.db)})}_withRetries(e){return ae(this,null,function*(){let i=0;for(;;)try{let r=yield this._openDb();return yield e(r)}catch(r){if(i++>wle)throw r;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return ae(this,null,function*(){return nH()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return ae(this,null,function*(){this.receiver=hle._getInstance(gle()),this.receiver._subscribe("keyChanged",(e,i)=>ae(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(i.key)}})),this.receiver._subscribe("ping",(e,i)=>ae(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return ae(this,null,function*(){var e,i;if(this.activeServiceWorker=yield ple(),!this.activeServiceWorker)return;this.sender=new k2(this.activeServiceWorker);let r=yield this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((i=r[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return ae(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||mle()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(i){}})}_isAvailable(){return ae(this,null,function*(){try{if(!indexedDB)return!1;let e=yield R2();return yield w8(e,zT,"1"),yield x8(e,zT),!0}catch(e){}return!1})}_withPendingWrite(e){return ae(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,i){return ae(this,null,function*(){return this._withPendingWrite(()=>ae(this,null,function*(){return yield this._withRetries(r=>w8(r,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)}))})}_get(e){return ae(this,null,function*(){let i=yield this._withRetries(r=>vle(r,e));return this.localCache[e]=i,i})}_remove(e){return ae(this,null,function*(){return this._withPendingWrite(()=>ae(this,null,function*(){return yield this._withRetries(i=>x8(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return ae(this,null,function*(){let e=yield this._withRetries(o=>{let d=qT(o,!1).getAll();return new wp(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];let i=[],r=new Set;if(e.length!==0)for(let{fbase_key:o,value:d}of e)r.add(o),JSON.stringify(this.localCache[o])!==JSON.stringify(d)&&(this.notifyListeners(o,d),i.push(o));for(let o of Object.keys(this.localCache))this.localCache[o]&&!r.has(o)&&(this.notifyListeners(o,null),i.push(o));return i})}notifyListeners(e,i){this.localCache[e]=i;let r=this.listeners[e];if(r)for(let o of Array.from(r))o(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>ae(this,null,function*(){return this._poll()}),ble)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}return n.type="LOCAL",n})(),oH=xle;var ZVe=Z8("rcb"),KVe=new bp(3e4,6e4);function W2(n,t){return t?ku(t):(pn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}var nb=class extends eb{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return t_(t,this._buildIdpRequest())}_linkToIdToken(t,e){return t_(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return t_(t,this._buildIdpRequest())}_buildIdpRequest(t){let e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}};function Ele(n){return sle(n.auth,new nb(n),n.bypassAuthState)}function Cle(n){let{auth:t,user:e}=n;return pn(e,t,"internal-error"),ole(e,new nb(n),n.bypassAuthState)}function Tle(n){return ae(this,null,function*(){let{auth:t,user:e}=n;return pn(e,t,"internal-error"),rle(e,new nb(n),n.bypassAuthState)})}var HT=class{constructor(t,e,i,r,o=!1){this.auth=t,this.resolver=i,this.user=r,this.bypassAuthState=o,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((t,e)=>ae(this,null,function*(){this.pendingPromise={resolve:t,reject:e};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}}))}onAuthEvent(t){return ae(this,null,function*(){let{urlResponse:e,sessionId:i,postBody:r,tenantId:o,error:d,type:m}=t;if(d){this.reject(d);return}let b={auth:this.auth,requestUri:e,sessionId:i,tenantId:o||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(m)(b))}catch(T){this.reject(T)}})}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Ele;case"linkViaPopup":case"linkViaRedirect":return Tle;case"reauthViaPopup":case"reauthViaRedirect":return Cle;default:xc(this.auth,"internal-error")}}resolve(t){Ru(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ru(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}};var Sle=new bp(2e3,1e4);function Z2(n,t,e){return ae(this,null,function*(){if(Al(n.app))return Promise.reject(kl(n,"operation-not-supported-in-this-environment"));let i=o_(n);R8(n,t,i_);let r=W2(i,e);return new Dle(i,"signInViaPopup",t,r).executeNotNull()})}var Dle=(()=>{class n extends HT{constructor(e,i,r,o,d){super(e,i,o,d),this.provider=r,this.authWindow=null,this.pollId=null,n.currentPopupAction&&n.currentPopupAction.cancel(),n.currentPopupAction=this}executeNotNull(){return ae(this,null,function*(){let e=yield this.execute();return pn(e,this.auth,"internal-error"),e})}onExecution(){return ae(this,null,function*(){Ru(this.filter.length===1,"Popup operations only handle one event");let e=q2();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(kl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(kl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,n.currentPopupAction=null}pollUserCancellation(){let e=()=>{var i,r;if(!((r=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(kl(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Sle.get())};e()}}n.currentPopupAction=null;return n})(),Ile="pendingRedirect",RT=new Map,P2=class n extends HT{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}execute(){return ae(this,null,function*(){let t=RT.get(this.auth._key());if(!t){try{let i=(yield Mle(this.resolver,this.auth))?yield vf(n.prototype,this,"execute").call(this):null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}RT.set(this.auth._key(),t)}return this.bypassAuthState||RT.set(this.auth._key(),()=>Promise.resolve(null)),t()})}onAuthEvent(t){return ae(this,null,function*(){if(t.type==="signInViaRedirect")return vf(n.prototype,this,"onAuthEvent").call(this,t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){let e=yield this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,vf(n.prototype,this,"onAuthEvent").call(this,t);this.resolve(null)}})}onExecution(){return ae(this,null,function*(){})}cleanUp(){}};function Mle(n,t){return ae(this,null,function*(){let e=aH(t),i=sH(n);if(!(yield i._isAvailable()))return!1;let r=(yield i._get(e))==="true";return yield i._remove(e),r})}function Ale(n,t){return ae(this,null,function*(){return sH(n)._set(aH(t),"true")})}function kle(n,t){RT.set(n._key(),t)}function sH(n){return ku(n._redirectPersistence)}function aH(n){return kT(Ile,n.config.apiKey,n.name)}function K2(n,t,e){return Rle(n,t,e)}function Rle(n,t,e){return ae(this,null,function*(){if(Al(n.app))return Promise.reject(oh(n));let i=o_(n);R8(n,t,i_),yield i._initializationPromise;let r=W2(i,e);return yield Ale(r,i),r._openRedirect(i,t,"signInViaRedirect")})}function Y2(n,t){return ae(this,null,function*(){return yield o_(n)._initializationPromise,lH(n,t,!1)})}function lH(n,t,e=!1){return ae(this,null,function*(){if(Al(n.app))return Promise.reject(oh(n));let i=o_(n),r=W2(i,t),d=yield new P2(i,r,e).execute();return d&&!e&&(delete d.user._redirectEventId,yield i._persistUserIfCurrent(d.user),yield i._setRedirectUser(null,t)),d})}var Ple=600*1e3,N2=class{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Nle(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var i;if(t.error&&!cH(t)){let r=((i=t.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";e.onError(kl(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){let i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Ple&&this.cachedEventUids.clear(),this.cachedEventUids.has(E8(t))}saveEventToCache(t){this.cachedEventUids.add(E8(t)),this.lastProcessedEventTime=Date.now()}};function E8(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function cH({type:n,error:t}){return n==="unknown"&&t?.code==="auth/no-auth-event"}function Nle(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return cH(n);default:return!1}}function Ole(e){return ae(this,arguments,function*(n,t={}){return r_(n,"GET","/v1/projects",t)})}var Fle=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Lle=/^https?/;function Ble(n){return ae(this,null,function*(){if(n.config.emulator)return;let{authorizedDomains:t}=yield Ole(n);for(let e of t)try{if(Vle(e))return}catch(i){}xc(n,"unauthorized-domain")})}function Vle(n){let t=E2(),{protocol:e,hostname:i}=new URL(t);if(n.startsWith("chrome-extension://")){let d=new URL(n);return d.hostname===""&&i===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&d.hostname===i}if(!Lle.test(e))return!1;if(Fle.test(n))return i===n;let r=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}var jle=new bp(3e4,6e4);function C8(){let n=wc().___jsl;if(n?.H){for(let t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function zle(n){return new Promise((t,e)=>{var i,r,o;function d(){C8(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{C8(),e(kl(n,"network-request-failed"))},timeout:jle.get()})}if(!((r=(i=wc().gapi)===null||i===void 0?void 0:i.iframes)===null||r===void 0)&&r.Iframe)t(gapi.iframes.getContext());else if(!((o=wc().gapi)===null||o===void 0)&&o.load)d();else{let m=Z8("iframefcb");return wc()[m]=()=>{gapi.load?d():e(kl(n,"network-request-failed"))},Qae(`${Jae()}?onload=${m}`).catch(b=>e(b))}}).catch(t=>{throw PT=null,t})}var PT=null;function Ule(n){return PT=PT||zle(n),PT}var $le=new bp(5e3,15e3),Hle="__/auth/iframe",Gle="emulator/auth/iframe",qle={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Wle=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zle(n){let t=n.config;pn(t.authDomain,n,"auth-domain-config-required");let e=t.emulator?V2(t,Gle):`https://${n.config.authDomain}/${Hle}`,i={apiKey:t.apiKey,appName:n.name,v:bc},r=Wle.get(n.config.apiHost);r&&(i.eid=r);let o=n._getFrameworks();return o.length&&(i.fw=o.join(",")),`${e}?${th(i).slice(1)}`}function Kle(n){return ae(this,null,function*(){let t=yield Ule(n),e=wc().gapi;return pn(e,n,"internal-error"),t.open({where:document.body,url:Zle(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qle,dontclear:!0},i=>new Promise((r,o)=>ae(null,null,function*(){yield i.restyle({setHideOnLeave:!1});let d=kl(n,"network-request-failed"),m=wc().setTimeout(()=>{o(d)},$le.get());function b(){wc().clearTimeout(m),r(i)}i.ping(b).then(b,()=>{o(d)})})))})}var Yle={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Xle=500,Qle=600,Jle="_blank",ece="http://localhost",GT=class{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}};function tce(n,t,e,i=Xle,r=Qle){let o=Math.max((window.screen.availHeight-r)/2,0).toString(),d=Math.max((window.screen.availWidth-i)/2,0).toString(),m="",b=Object.assign(Object.assign({},Yle),{width:i.toString(),height:r.toString(),top:o,left:d}),T=ts().toLowerCase();e&&(m=z8(T)?Jle:e),V8(T)&&(t=t||ece,b.scrollbars="yes");let A=Object.entries(b).reduce((q,[J,K])=>`${q}${J}=${K},`,"");if(Wae(T)&&m!=="_self")return nce(t||"",m),new GT(null);let N=window.open(t||"",m,A);pn(N,n,"popup-blocked");try{N.focus()}catch(q){}return new GT(N)}function nce(n,t){let e=document.createElement("a");e.href=n,e.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(i)}var ice="__/auth/handler",rce="emulator/auth/handler",oce=encodeURIComponent("fac");function T8(n,t,e,i,r,o){return ae(this,null,function*(){pn(n.config.authDomain,n,"auth-domain-config-required"),pn(n.config.apiKey,n,"invalid-api-key");let d={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:i,v:bc,eventId:r};if(t instanceof i_){t.setDefaultLanguage(n.languageCode),d.providerId=t.providerId||"",H0(t.getCustomParameters())||(d.customParameters=JSON.stringify(t.getCustomParameters()));for(let[A,N]of Object.entries(o||{}))d[A]=N}if(t instanceof jT){let A=t.getScopes().filter(N=>N!=="");A.length>0&&(d.scopes=A.join(","))}n.tenantId&&(d.tid=n.tenantId);let m=d;for(let A of Object.keys(m))m[A]===void 0&&delete m[A];let b=yield n._getAppCheckToken(),T=b?`#${oce}=${encodeURIComponent(b)}`:"";return`${sce(n)}?${th(m).slice(1)}${T}`})}function sce({config:n}){return n.emulator?V2(n,rce):`https://${n.authDomain}/${ice}`}var x2="webStorageSupport",O2=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=G2,this._completeRedirectFn=lH,this._overrideRedirectResult=kle}_openPopup(t,e,i,r){return ae(this,null,function*(){var o;Ru((o=this.eventManagers[t._key()])===null||o===void 0?void 0:o.manager,"_initialize() not called before _openPopup()");let d=yield T8(t,e,i,E2(),r);return tce(t,d,q2())})}_openRedirect(t,e,i,r){return ae(this,null,function*(){yield this._originValidation(t);let o=yield T8(t,e,i,E2(),r);return fle(o),new Promise(()=>{})})}_initialize(t){let e=t._key();if(this.eventManagers[e]){let{manager:r,promise:o}=this.eventManagers[e];return r?Promise.resolve(r):(Ru(o,"If manager is not set, promise should be"),o)}let i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch(()=>{delete this.eventManagers[e]}),i}initAndGetManager(t){return ae(this,null,function*(){let e=yield Kle(t),i=new N2(t);return e.register("authEvent",r=>(pn(r?.authEvent,t,"invalid-auth-event"),{status:i.onEvent(r.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i})}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(x2,{type:x2},r=>{var o;let d=(o=r?.[0])===null||o===void 0?void 0:o[x2];d!==void 0&&e(!!d),xc(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){let e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Ble(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return q8()||j8()||U2()}},uH=O2;var S8="@firebase/auth",D8="1.7.9";var F2=class{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}getToken(t){return ae(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(t)}:null})}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;let e=this.auth.onIdTokenChanged(i=>{t(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();let e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){pn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function ace(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function lce(n){ns(new Qr("auth",(t,{options:e})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:d,authDomain:m}=i.options;pn(d&&!d.includes(":"),"invalid-api-key",{appName:i.name});let b={apiKey:d,authDomain:m,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:W8(n)},T=new M2(i,r,o,b);return ele(T,e),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),ns(new Qr("auth-internal",t=>{let e=o_(t.getProvider("auth").getImmediate());return(i=>new F2(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),Jr(S8,D8,ace(n)),Jr(S8,D8,"esm2017")}var cce=300,uce=s2("authIdTokenMaxAge")||cce,I8=null,dce=n=>t=>ae(null,null,function*(){let e=t&&(yield t.getIdTokenResult()),i=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(i&&i>uce)return;let r=e?.token;I8!==r&&(I8=r,yield fetch(n,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});function X2(n=Mu()){let t=qa(n,"auth");if(t.isInitialized())return t.getImmediate();let e=K8(n,{popupRedirectResolver:uH,persistence:[oH,tH,G2]}),i=s2("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){let o=new URL(i,location.origin);if(location.origin===o.origin){let d=dce(o.toString());eH(e,d,()=>d(e.currentUser)),J8(e,m=>d(m))}}let r=r2("auth");return r&&Y8(e,`http://${r}`),e}function hce(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}Xae({loadJS(n){return new Promise((t,e)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=t,i.onerror=r=>{let o=kl("internal-error");o.customData=r,e(o)},i.type="text/javascript",i.charset="UTF-8",hce().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});lce("Browser");var dH="@firebase/database",hH="1.0.8";var tO="";function fce(n){tO=n}var oN=class{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Xr(e))}get(t){let e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:Jg(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}};var sN=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return Il(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}};var $H=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new oN(t)}}catch(t){}return new sN},Ep=$H("localStorage"),aN=$H("sessionStorage");var l_=new nh("@firebase/database"),pce=(function(){let n=1;return function(){return n++}})(),HH=function(n){let t=t8(n),e=new _T;e.update(t);let i=e.digest();return yT.encodeByteArray(i)},Tb=function(...n){let t="";for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?t+=Tb.apply(null,i):typeof i=="object"?t+=Xr(i):t+=i,t+=" "}return t},Cp=null,fH=!0,mce=function(n,t){gt(!t||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(l_.logLevel=gi.VERBOSE,Cp=l_.log.bind(l_),t&&aN.set("logging_enabled",!0)):typeof n=="function"?Cp=n:(Cp=null,aN.remove("logging_enabled"))},$o=function(...n){if(fH===!0&&(fH=!1,Cp===null&&aN.get("logging_enabled")===!0&&mce(!0)),Cp){let t=Tb.apply(null,n);Cp(t)}},Sb=function(n){return function(...t){$o(n,...t)}},lN=function(...n){let t="FIREBASE INTERNAL ERROR: "+Tb(...n);l_.error(t)},Nu=function(...n){let t=`FIREBASE FATAL ERROR: ${Tb(...n)}`;throw l_.error(t),new Error(t)},Cs=function(...n){let t="FIREBASE WARNING: "+Tb(...n);l_.warn(t)},gce=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Cs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},nO=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},_ce=function(n){if(vc()||document.readyState==="complete")n();else{let t=!1,e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},u_="[MIN_NAME]",Tp="[MAX_NAME]",Dp=function(n,t){if(n===t)return 0;if(n===u_||t===Tp)return-1;if(t===u_||n===Tp)return 1;{let e=pH(n),i=pH(t);return e!==null?i!==null?e-i===0?n.length-t.length:e-i:-1:i!==null?1:n<t?-1:1}},yce=function(n,t){return n===t?0:n<t?-1:1},rb=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+Xr(t))},iO=function(n){if(typeof n!="object"||n===null)return Xr(n);let t=[];for(let i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)i!==0&&(e+=","),e+=Xr(t[i]),e+=":",e+=iO(n[t[i]]);return e+="}",e},GH=function(n,t){let e=n.length;if(e<=t)return[n];let i=[];for(let r=0;r<e;r+=t)r+t>e?i.push(n.substring(r,e)):i.push(n.substring(r,r+t));return i};function Ho(n,t){for(let e in n)n.hasOwnProperty(e)&&t(e,n[e])}var qH=function(n){gt(!nO(n),"Invalid JSON number");let t=11,e=52,i=(1<<t-1)-1,r,o,d,m,b;n===0?(o=0,d=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(m=Math.min(Math.floor(Math.log(n)/Math.LN2),i),o=m+i,d=Math.round(n*Math.pow(2,e-m)-Math.pow(2,e))):(o=0,d=Math.round(n/Math.pow(2,1-i-e))));let T=[];for(b=e;b;b-=1)T.push(d%2?1:0),d=Math.floor(d/2);for(b=t;b;b-=1)T.push(o%2?1:0),o=Math.floor(o/2);T.push(r?1:0),T.reverse();let A=T.join(""),N="";for(b=0;b<64;b+=8){let q=parseInt(A.substr(b,8),2).toString(16);q.length===1&&(q="0"+q),N=N+q}return N.toLowerCase()},vce=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bce=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function wce(n,t){let e="Unknown Error";n==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?e="Client doesn't have permission to access the desired data.":n==="unavailable"&&(e="The service is unavailable");let i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}var xce=new RegExp("^-?(0*)\\d{1,10}$"),Ece=-2147483648,Cce=2147483647,pH=function(n){if(xce.test(n)){let t=Number(n);if(t>=Ece&&t<=Cce)return t}return null},v_=function(n){try{n()}catch(t){setTimeout(()=>{let e=t.stack||"";throw Cs("Exception was thrown by user callback.",e),t},Math.floor(0))}},Tce=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},cb=function(n,t){let e=setTimeout(n,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};var cN=class{constructor(t,e){this.appName_=t,this.appCheckProvider=e,this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;(e=this.appCheckProvider)===null||e===void 0||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){Cs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var uN=class{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?($o("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Cs(t)}},ub=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),ZT="5",WH="v",ZH="s",KH="r",YH="f",XH=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,QH="ls",JH="p",dN="ac",eG="websocket",tG="long_polling";var KT=class{constructor(t,e,i,r,o=!1,d="",m=!1,b=!1){this.secure=e,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=d,this.includeNamespaceInQueryParams=m,this.isUsingEmulator=b,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ep.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ep.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){let t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}};function Sce(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function nG(n,t,e){gt(typeof t=="string","typeof type must == string"),gt(typeof e=="object","typeof params must == object");let i;if(t===eG)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(t===tG)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);Sce(n)&&(e.ns=n.namespace);let r=[];return Ho(e,(o,d)=>{r.push(o+"="+d)}),i+r.join("&")}var hN=class{constructor(){this.counters_={}}incrementCounter(t,e=1){Il(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return G$(this.counters_)}};var Q2={},J2={};function rO(n){let t=n.toString();return Q2[t]||(Q2[t]=new hN),Q2[t]}function Dce(n,t){let e=n.toString();return J2[e]||(J2[e]=t()),J2[e]}var fN=class{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&v_(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var mH="start",Ice="close",Mce="pLPCommand",Ace="pRTLPCB",iG="id",rG="pw",oG="ser",kce="cb",Rce="seg",Pce="ts",Nce="d",Oce="dframe",sG=1870,aG=30,Fce=sG-aG,Lce=25e3,Bce=3e4,pN=class n{constructor(t,e,i,r,o,d,m){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.transportSessionId=d,this.lastSessionId=m,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Sb(t),this.stats_=rO(e),this.urlFn=b=>(this.appCheckToken&&(b[dN]=this.appCheckToken),nG(e,tG,b))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new fN(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Bce)),_ce(()=>{if(this.isClosed_)return;this.scriptTagHolder=new mN((...o)=>{let[d,m,b,T,A]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,d===mH)this.id=m,this.password=b;else if(d===Ice)m?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(m,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+d)},(...o)=>{let[d,m]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(d,m)},()=>{this.onClosed_()},this.urlFn);let i={};i[mH]="t",i[oG]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[kce]=this.scriptTagHolder.uniqueCallbackIdentifier),i[WH]=ZT,this.transportSessionId&&(i[ZH]=this.transportSessionId),this.lastSessionId&&(i[QH]=this.lastSessionId),this.applicationId&&(i[JH]=this.applicationId),this.appCheckToken&&(i[dN]=this.appCheckToken),typeof location<"u"&&location.hostname&&XH.test(location.hostname)&&(i[KH]=YH);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return vc()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!vce()&&!bce()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){let e=Xr(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);let i=n2(e),r=GH(i,Fce);for(let o=0;o<r.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[o]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(vc())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Oce]="t",i[iG]=t,i[rG]=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){let e=Xr(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}},mN=class n{constructor(t,e,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,vc())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=pce(),window[Mce+this.uniqueCallbackIdentifier]=t,window[Ace+this.uniqueCallbackIdentifier]=e,this.myIFrame=n.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');let d="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(d),this.myIFrame.doc.close()}catch(m){$o("frame writing exception"),m.stack&&$o(m.stack),$o(m)}}}static createIFrame_(){let t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||$o("No IE domain setting required")}catch(e){let i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let t={};t[iG]=this.myID,t[rG]=this.myPW,t[oG]=this.currentSerial;let e=this.urlFn(t),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+aG+i.length<=sG;){let d=this.pendingSegs.shift();i=i+"&"+Rce+r+"="+d.seg+"&"+Pce+r+"="+d.ts+"&"+Nce+r+"="+d.d,r++}return e=e+i,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);let i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},r=setTimeout(i,Math.floor(Lce)),o=()=>{clearTimeout(r),i()};this.addTag(t,o)}addTag(t,e){vc()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{$o("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch(i){}},Math.floor(1))}};var Vce=16384,jce=45e3,YT=null;typeof MozWebSocket<"u"?YT=MozWebSocket:typeof WebSocket<"u"&&(YT=WebSocket);var ob=(()=>{class n{constructor(e,i,r,o,d,m,b){this.connId=e,this.applicationId=r,this.appCheckToken=o,this.authToken=d,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Sb(this.connId),this.stats_=rO(i),this.connURL=n.connectionURL_(i,m,b,o,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,r,o,d){let m={};return m[WH]=ZT,!vc()&&typeof location<"u"&&location.hostname&&XH.test(location.hostname)&&(m[KH]=YH),i&&(m[ZH]=i),r&&(m[QH]=r),o&&(m[dN]=o),d&&(m[JH]=d),nG(e,eG,m)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ep.set("previous_websocket_failure",!0);try{let r;if(vc()){let o=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${ZT}/${tO}/${process.platform}/${o}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let d=process.env,m=this.connURL.indexOf("wss://")===0?d.HTTPS_PROXY||d.https_proxy:d.HTTP_PROXY||d.http_proxy;m&&(r.proxy={origin:m})}this.mySock=new YT(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let o=r.message||r.data;o&&this.log_(o),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let o=r.message||r.data;o&&this.log_(o),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&YT!==null&&!n.forceDisallow_}static previouslyFailed(){return Ep.isInMemoryStorage||Ep.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ep.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=Jg(i);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(gt(this.frames===null,"We already have a frame buffer"),e.length<=6){let i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();let i=Xr(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=GH(i,Vce);r.length>1&&this.sendString_(String(r.length));for(let o=0;o<r.length;o++)this.sendString_(r[o])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(jce))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),zce=(()=>{class n{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[pN,ob]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){let i=ob&&ob.isAvailable(),r=i&&!ob.previouslyFailed();if(e.webSocketOnly&&(i||Cs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ob];else{let o=this.transports_=[];for(let d of n.ALL_TRANSPORTS)d&&d.isAvailable()&&o.push(d);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Uce=6e4,$ce=5e3,Hce=10*1024,Gce=100*1024,eN="t",gH="d",qce="s",_H="r",Wce="e",yH="o",vH="a",bH="n",wH="p",Zce="h",gN=class{constructor(t,e,i,r,o,d,m,b,T,A){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=d,this.onReady_=m,this.onDisconnect_=b,this.onKill_=T,this.lastSessionId=A,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Sb("c:"+this.id+":"),this.transportManager_=new zce(e),this.log_("Connection created"),this.start_()}start_(){let t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));let r=t.healthyTimeout||0;r>0&&(this.healthyTimeout_=cb(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Gce?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Hce?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){let e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(eN in t){let e=t[eN];e===vH?this.upgradeIfSecondaryHealthy_():e===_H?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===yH&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){let e=rb("t",t),i=rb("d",t);if(e==="c")this.onSecondaryControl_(i);else if(e==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:wH,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:vH,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:bH,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){let e=rb("t",t),i=rb("d",t);e==="c"?this.onControl_(i):e==="d"&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){let e=rb(eN,t);if(gH in t){let i=t[gH];if(e===Zce){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(e===bH){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===qce?this.onConnectionShutdown_(i):e===_H?this.onReset_(i):e===Wce?lN("Server Error: "+i):e===yH?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):lN("Unknown control packet command: "+e)}}onHandshake_(t){let e=t.ts,i=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),ZT!==i&&Cs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),cb(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Uce))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):cb(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor($ce))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:wH,d:{}}}))}onSecondaryConnectionLost_(){let t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ep.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var XT=class{put(t,e,i,r){}merge(t,e,i,r){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}};var QT=class{constructor(t){this.allowedEvents_=t,this.listeners_={},gt(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){let i=[...this.listeners_[t]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});let r=this.getInitialEvent(t);r&&e.apply(i,r)}off(t,e,i){this.validateEventType_(t);let r=this.listeners_[t]||[];for(let o=0;o<r.length;o++)if(r[o].callback===e&&(!i||i===r[o].context)){r.splice(o,1);return}}validateEventType_(t){gt(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}};var JT=class n extends QT{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!$0()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(t){return gt(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}};var xH=32,EH=768,ui=class{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}};function Kn(){return new ui("")}function Nn(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ch(n){return n.pieces_.length-n.pieceNum_}function $i(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new ui(n.pieces_,t)}function oO(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Kce(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)n.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}function pb(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function lG(n){if(n.pieceNum_>=n.pieces_.length)return null;let t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new ui(t,0)}function Sr(n,t){let e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof ui)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{let i=t.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&e.push(i[r])}return new ui(e,0)}function Ln(n){return n.pieceNum_>=n.pieces_.length}function Es(n,t){let e=Nn(n),i=Nn(t);if(e===null)return t;if(e===i)return Es($i(n),$i(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Yce(n,t){let e=pb(n,0),i=pb(t,0);for(let r=0;r<e.length&&r<i.length;r++){let o=Dp(e[r],i[r]);if(o!==0)return o}return e.length===i.length?0:e.length<i.length?-1:1}function sO(n,t){if(ch(n)!==ch(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function Wa(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(ch(n)>ch(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}var _N=class{constructor(t,e){this.errorPrefix_=e,this.parts_=pb(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=W0(this.parts_[i]);cG(this)}};function Xce(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=W0(t),cG(n)}function Qce(n){let t=n.parts_.pop();n.byteLength_-=W0(t),n.parts_.length>0&&(n.byteLength_-=1)}function cG(n){if(n.byteLength_>EH)throw new Error(n.errorPrefix_+"has a key path longer than "+EH+" bytes ("+n.byteLength_+").");if(n.parts_.length>xH)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+xH+") or object contains a cycle "+xp(n))}function xp(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var yN=class n extends QT{constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{let i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(t){return gt(t==="visible","Unknown event type: "+t),[this.visible_]}};var sb=1e3,Jce=300*1e3,CH=30*1e3,eue=1.3,tue=3e4,nue="server_kill",TH=3,aO=(()=>{class n extends XT{constructor(e,i,r,o,d,m,b,T){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=o,this.onServerInfoUpdate_=d,this.authTokenProvider_=m,this.appCheckTokenProvider_=b,this.authOverride_=T,this.id=n.nextPersistentConnectionId_++,this.log_=Sb("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=sb,this.maxReconnectDelay_=Jce,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,T&&!vc())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");yN.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&JT.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,r){let o=++this.requestNumber_,d={r:o,a:e,b:i};this.log_(Xr(d)),gt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(d),r&&(this.requestCBHash_[o]=r)}get(e){this.initConnection_();let i=new Du,o={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:m=>{let b=m.d;m.s==="ok"?i.resolve(b):i.reject(b)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;let d=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(d),i.promise}listen(e,i,r,o){this.initConnection_();let d=e._queryIdentifier,m=e._path.toString();this.log_("Listen called for "+m+" "+d),this.listens.has(m)||this.listens.set(m,new Map),gt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),gt(!this.listens.get(m).has(d),"listen() called twice for same path/queryId.");let b={onComplete:o,hashFn:i,query:e,tag:r};this.listens.get(m).set(d,b),this.connected_&&this.sendListen_(b)}sendGet_(e){let i=this.outstandingGets_[e];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(e){let i=e.query,r=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+r+" for "+o);let d={p:r},m="q";e.tag&&(d.q=i._queryObject,d.t=e.tag),d.h=e.hashFn(),this.sendRequest(m,d,b=>{let T=b.d,A=b.s;n.warnOnListenWarnings_(T,i),(this.listens.get(r)&&this.listens.get(r).get(o))===e&&(this.log_("listen response",b),A!=="ok"&&this.removeListen_(r,o),e.onComplete&&e.onComplete(A,T))})}static warnOnListenWarnings_(e,i){if(e&&typeof e=="object"&&Il(e,"w")){let r=_p(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let o='".indexOn": "'+i._queryParams.getIndex().toString()+'"',d=i._path.toString();Cs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${o} at ${d} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||J$(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=CH)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,i=Q$(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,o=>{let d=o.s,m=o.d||"error";this.authToken_===e&&(d==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(d,m))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let i=e.s,r=e.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(e,i){let r=e._path.toString(),o=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+o),gt(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,o)&&this.connected_&&this.sendUnlisten_(r,o,e._queryObject,i)}sendUnlisten_(e,i,r,o){this.log_("Unlisten on "+e+" for "+i);let d={p:e},m="n";o&&(d.q=r,d.t=o),this.sendRequest(m,d)}onDisconnectPut(e,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:r})}onDisconnectMerge(e,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:r})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,r,o){let d={p:i,d:r};this.log_("onDisconnect "+e,d),this.sendRequest(e,d,m=>{o&&setTimeout(()=>{o(m.s,m.d)},Math.floor(0))})}put(e,i,r,o){this.putInternal("p",e,i,r,o)}merge(e,i,r,o){this.putInternal("m",e,i,r,o)}putInternal(e,i,r,o,d){this.initConnection_();let m={p:i,d:r};d!==void 0&&(m.h=d),this.outstandingPuts_.push({action:e,request:m,onComplete:o}),this.outstandingPutCount_++;let b=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(b):this.log_("Buffering put: "+i)}sendPut_(e){let i=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,o=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,r,d=>{this.log_(i+" response",d),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),o&&o(d.s,d.d)})}reportStats(e){if(this.connected_){let i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let d=r.d;this.log_("reportStats","Error sending stats: "+d)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Xr(e));let i=e.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),e==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):e==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):e==="c"?this.onListenRevoked_(i.p,i.q):e==="ac"?this.onAuthRevoked_(i.s,i.d):e==="apc"?this.onAppCheckRevoked_(i.s,i.d):e==="sd"?this.onSecurityDebugPacket_(i):lN("Unrecognized action received from server: "+Xr(e)+`
Are you using the latest client?`)}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){gt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=sb,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=sb,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>tue&&(this.reconnectDelay_=sb),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*eue)}this.onConnectStatus_(!1)}establishConnection_(){return ae(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+n.nextConnectionId_++,d=this.lastSessionId,m=!1,b=null,T=function(){b?b.close():(m=!0,r())},A=function(q){gt(b,"sendRequest call when we're not connected not allowed."),b.sendRequest(q)};this.realtime_={close:T,sendRequest:A};let N=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[q,J]=yield Promise.all([this.authTokenProvider_.getToken(N),this.appCheckTokenProvider_.getToken(N)]);m?$o("getToken() completed but was canceled"):($o("getToken() completed. Creating connection."),this.authToken_=q&&q.accessToken,this.appCheckToken_=J&&J.token,b=new gN(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,i,r,K=>{Cs(K+" ("+this.repoInfo_.toString()+")"),this.interrupt(nue)},d))}catch(q){this.log_("Failed to get token: "+q),m||(this.repoInfo_.nodeAdmin&&Cs(q),T())}}})}interrupt(e){$o("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){$o("Resuming connection for reason: "+e),delete this.interruptReasons_[e],H0(this.interruptReasons_)&&(this.reconnectDelay_=sb,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let i=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let r;i?r=i.map(d=>iO(d)).join("$"):r="default";let o=this.removeListen_(e,r);o&&o.onComplete&&o.onComplete("permission_denied")}removeListen_(e,i){let r=new ui(e).toString(),o;if(this.listens.has(r)){let d=this.listens.get(r);o=d.get(i),d.delete(i),d.size===0&&this.listens.delete(r)}else o=void 0;return o}onAuthRevoked_(e,i){$o("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=TH&&(this.reconnectDelay_=CH,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){$o("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=TH&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},i="js";vc()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),e["sdk."+i+"."+tO.replace(/\./g,"-")]=1,$0()?e["framework.cordova"]=1:wT()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=JT.getInstance().currentlyOnline();return H0(this.interruptReasons_)&&e}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),On=class n{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new n(t,e)}};var d_=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){let i=new On(u_,t),r=new On(u_,e);return this.compare(i,r)!==0}minPost(){return On.MIN}};var WT,eS=class extends d_{static get __EMPTY_NODE(){return WT}static set __EMPTY_NODE(t){WT=t}compare(t,e){return Dp(t.name,e.name)}isDefinedOn(t){throw gp("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return On.MIN}maxPost(){return new On(Tp,WT)}makePost(t,e){return gt(typeof t=="string","KeyIndex indexValue must always be a string."),new On(t,WT)}toString(){return".key"}},c_=new eS;var a_=class{constructor(t,e,i,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let d=1;for(;!t.isEmpty();)if(t=t,d=e?i(t.key,e):1,r&&(d*=-1),d<0)this.isReverse_?t=t.left:t=t.right;else if(d===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}},Rl=(()=>{class n{constructor(e,i,r,o,d){this.key=e,this.value=i,this.color=r??n.RED,this.left=o??Za.EMPTY_NODE,this.right=d??Za.EMPTY_NODE}copy(e,i,r,o,d){return new n(e??this.key,i??this.value,r??this.color,o??this.left,d??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,r){let o=this,d=r(e,o.key);return d<0?o=o.copy(null,null,null,o.left.insert(e,i,r),null):d===0?o=o.copy(null,i,null,null,null):o=o.copy(null,null,null,null,o.right.insert(e,i,r)),o.fixUp_()}removeMin_(){if(this.left.isEmpty())return Za.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let r,o;if(r=this,i(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(e,r.key)===0){if(r.right.isEmpty())return Za.EMPTY_NODE;o=r.right.min_(),r=r.copy(o.key,o.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),vN=class{copy(t,e,i,r,o){return this}insert(t,e,i){return new Rl(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Za=class n{constructor(t,e=n.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Rl.BLACK,null,null))}remove(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Rl.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),e===0)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,r=null;for(;!i.isEmpty();)if(e=this.comparator_(t,i.key),e===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else e<0?i=i.left:e>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new a_(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new a_(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new a_(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new a_(this.root_,null,this.comparator_,!0,t)}};Za.EMPTY_NODE=new vN;function iue(n,t){return Dp(n.name,t.name)}function lO(n,t){return Dp(n,t)}var bN;function rue(n){bN=n}var uG=function(n){return typeof n=="number"?"number:"+qH(n):"string:"+n},dG=function(n){if(n.isLeafNode()){let t=n.val();gt(typeof t=="string"||typeof t=="number"||typeof t=="object"&&Il(t,".sv"),"Priority must be a string or number.")}else gt(n===bN||n.isEmpty(),"priority of unexpected type.");gt(n===bN||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var SH,h_=(()=>{class n{constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,gt(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dG(this.priorityNode_)}static set __childrenNodeConstructor(e){SH=e}static get __childrenNodeConstructor(){return SH}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ln(e)?this:Nn(e)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return e===".priority"?this.updatePriority(i):i.isEmpty()&&e!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){let r=Nn(e);return r===null?i:i.isEmpty()&&r!==".priority"?this:(gt(r!==".priority"||ch(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild($i(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+uG(this.priorityNode_.val())+":");let i=typeof this.value_;e+=i+":",i==="number"?e+=qH(this.value_):e+=this.value_,this.lazyHash_=HH(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:(gt(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let i=typeof e.value_,r=typeof this.value_,o=n.VALUE_TYPE_ORDER.indexOf(i),d=n.VALUE_TYPE_ORDER.indexOf(r);return gt(o>=0,"Unknown leaf type: "+i),gt(d>=0,"Unknown leaf type: "+r),o===d?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:d-o}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let i=e;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),hG,fG;function oue(n){hG=n}function sue(n){fG=n}var wN=class extends d_{compare(t,e){let i=t.node.getPriority(),r=e.node.getPriority(),o=i.compareTo(r);return o===0?Dp(t.name,e.name):o}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return On.MIN}maxPost(){return new On(Tp,new h_("[PRIORITY-POST]",fG))}makePost(t,e){let i=hG(t);return new On(e,new h_("[PRIORITY-POST]",i))}toString(){return".priority"}},Dr=new wN;var aue=Math.log(2),xN=class{constructor(t){let e=o=>parseInt(Math.log(o)/aue,10),i=o=>parseInt(Array(o+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;let r=i(this.count);this.bits_=t+1&r}nextBitIsOne(){let t=!(this.bits_&1<<this.current_);return this.current_--,t}},tS=function(n,t,e,i){n.sort(t);let r=function(b,T){let A=T-b,N,q;if(A===0)return null;if(A===1)return N=n[b],q=e?e(N):N,new Rl(q,N.node,Rl.BLACK,null,null);{let J=parseInt(A/2,10)+b,K=r(b,J),xe=r(J+1,T);return N=n[J],q=e?e(N):N,new Rl(q,N.node,Rl.BLACK,K,xe)}},o=function(b){let T=null,A=null,N=n.length,q=function(K,xe){let Te=N-K,Ge=N;N-=K;let Et=r(Te+1,Ge),kt=n[Te],Ue=e?e(kt):kt;J(new Rl(Ue,kt.node,xe,null,Et))},J=function(K){T?(T.left=K,T=K):(A=K,T=K)};for(let K=0;K<b.count;++K){let xe=b.nextBitIsOne(),Te=Math.pow(2,b.count-(K+1));xe?q(Te,Rl.BLACK):(q(Te,Rl.BLACK),q(Te,Rl.RED))}return A},d=new xN(n.length),m=o(d);return new Za(i||t,m)};var tN,s_={},f_=class n{constructor(t,e){this.indexes_=t,this.indexSet_=e}static get Default(){return gt(s_&&Dr,"ChildrenNode.ts has not been loaded"),tN=tN||new n({".priority":s_},{".priority":Dr}),tN}get(t){let e=_p(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Za?e:null}hasIndex(t){return Il(this.indexSet_,t.toString())}addIndex(t,e){gt(t!==c_,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,o=e.getIterator(On.Wrap),d=o.getNext();for(;d;)r=r||t.isDefinedOn(d.node),i.push(d),d=o.getNext();let m;r?m=tS(i,t.getCompare()):m=s_;let b=t.toString(),T=Object.assign({},this.indexSet_);T[b]=t;let A=Object.assign({},this.indexes_);return A[b]=m,new n(A,T)}addToIndexes(t,e){let i=G0(this.indexes_,(r,o)=>{let d=_p(this.indexSet_,o);if(gt(d,"Missing index implementation for "+o),r===s_)if(d.isDefinedOn(t.node)){let m=[],b=e.getIterator(On.Wrap),T=b.getNext();for(;T;)T.name!==t.name&&m.push(T),T=b.getNext();return m.push(t),tS(m,d.getCompare())}else return s_;else{let m=e.get(t.name),b=r;return m&&(b=b.remove(new On(t.name,m))),b.insert(t,t.node)}});return new n(i,this.indexSet_)}removeFromIndexes(t,e){let i=G0(this.indexes_,r=>{if(r===s_)return r;{let o=e.get(t.name);return o?r.remove(new On(t.name,o)):r}});return new n(i,this.indexSet_)}};var ab,Cn=(()=>{class n{constructor(e,i,r){this.children_=e,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&dG(this.priorityNode_),this.children_.isEmpty()&&gt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ab||(ab=new n(new Za(lO),null,f_.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ab}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let i=this.children_.get(e);return i===null?ab:i}}getChild(e){let i=Nn(e);return i===null?this:this.getImmediateChild(i).getChild($i(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,i){if(gt(i,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(i);{let r=new On(e,i),o,d;i.isEmpty()?(o=this.children_.remove(e),d=this.indexMap_.removeFromIndexes(r,this.children_)):(o=this.children_.insert(e,i),d=this.indexMap_.addToIndexes(r,this.children_));let m=o.isEmpty()?ab:this.priorityNode_;return new n(o,m,d)}}updateChild(e,i){let r=Nn(e);if(r===null)return i;{gt(Nn(e)!==".priority"||ch(e)===1,".priority must be the last token in a path");let o=this.getImmediateChild(r).updateChild($i(e),i);return this.updateImmediateChild(r,o)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let i={},r=0,o=0,d=!0;if(this.forEachChild(Dr,(m,b)=>{i[m]=b.val(e),r++,d&&n.INTEGER_REGEXP_.test(m)?o=Math.max(o,Number(m)):d=!1}),!e&&d&&o<2*r){let m=[];for(let b in i)m[b]=i[b];return m}else return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+uG(this.getPriority().val())+":"),this.forEachChild(Dr,(i,r)=>{let o=r.hash();o!==""&&(e+=":"+i+":"+o)}),this.lazyHash_=e===""?"":HH(e)}return this.lazyHash_}getPredecessorChildName(e,i,r){let o=this.resolveIndex_(r);if(o){let d=o.getPredecessorKey(new On(e,i));return d?d.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let i=this.resolveIndex_(e);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){let i=this.getFirstChildName(e);return i?new On(i,this.children_.get(i)):null}getLastChildName(e){let i=this.resolveIndex_(e);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){let i=this.getLastChildName(e);return i?new On(i,this.children_.get(i)):null}forEachChild(e,i){let r=this.resolveIndex_(e);return r?r.inorderTraversal(o=>i(o.name,o.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(e,o=>o);{let o=this.children_.getIteratorFrom(e.name,On.Wrap),d=o.peek();for(;d!=null&&i.compare(d,e)<0;)o.getNext(),d=o.peek();return o}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(e,o=>o);{let o=this.children_.getReverseIteratorFrom(e.name,On.Wrap),d=o.peek();for(;d!=null&&i.compare(d,e)>0;)o.getNext(),d=o.peek();return o}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Db?-1:0}withIndex(e){if(e===c_||this.indexMap_.hasIndex(e))return this;{let i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===c_||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let i=e;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(Dr),o=i.getIterator(Dr),d=r.getNext(),m=o.getNext();for(;d&&m;){if(d.name!==m.name||!d.node.equals(m.node))return!1;d=r.getNext(),m=o.getNext()}return d===null&&m===null}else return!1;else return!1}}resolveIndex_(e){return e===c_?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),EN=class extends Cn{constructor(){super(new Za(lO),Cn.EMPTY_NODE,f_.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Cn.EMPTY_NODE}isEmpty(){return!1}},Db=new EN;Object.defineProperties(On,{MIN:{value:new On(u_,Cn.EMPTY_NODE)},MAX:{value:new On(Tp,Db)}});eS.__EMPTY_NODE=Cn.EMPTY_NODE;h_.__childrenNodeConstructor=Cn;rue(Db);sue(Db);var lue=!0;function _o(n,t=null){if(n===null)return Cn.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(t=n[".priority"]),gt(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let e=n;return new h_(e,_o(t))}if(!(n instanceof Array)&&lue){let e=[],i=!1;if(Ho(n,(d,m)=>{if(d.substring(0,1)!=="."){let b=_o(m);b.isEmpty()||(i=i||!b.getPriority().isEmpty(),e.push(new On(d,b)))}}),e.length===0)return Cn.EMPTY_NODE;let o=tS(e,iue,d=>d.name,lO);if(i){let d=tS(e,Dr.getCompare());return new Cn(o,_o(t),new f_({".priority":d},{".priority":Dr}))}else return new Cn(o,_o(t),f_.Default)}else{let e=Cn.EMPTY_NODE;return Ho(n,(i,r)=>{if(Il(n,i)&&i.substring(0,1)!=="."){let o=_o(r);(o.isLeafNode()||!o.isEmpty())&&(e=e.updateImmediateChild(i,o))}}),e.updatePriority(_o(t))}}oue(_o);var CN=class extends d_{constructor(t){super(),this.indexPath_=t,gt(!Ln(t)&&Nn(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){let i=this.extractChild(t.node),r=this.extractChild(e.node),o=i.compareTo(r);return o===0?Dp(t.name,e.name):o}makePost(t,e){let i=_o(t),r=Cn.EMPTY_NODE.updateChild(this.indexPath_,i);return new On(e,r)}maxPost(){let t=Cn.EMPTY_NODE.updateChild(this.indexPath_,Db);return new On(Tp,t)}toString(){return pb(this.indexPath_,0).join("/")}};var TN=class extends d_{compare(t,e){let i=t.node.compareTo(e.node);return i===0?Dp(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return On.MIN}maxPost(){return On.MAX}makePost(t,e){let i=_o(t);return new On(e,i)}toString(){return".value"}},cue=new TN;function pG(n){return{type:"value",snapshotNode:n}}function p_(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function mb(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function gb(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}function uue(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}var _b=class{constructor(t){this.index_=t}updateChild(t,e,i,r,o,d){gt(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");let m=t.getImmediateChild(e);return m.getChild(r).equals(i.getChild(r))&&m.isEmpty()===i.isEmpty()||(d!=null&&(i.isEmpty()?t.hasChild(e)?d.trackChildChange(mb(e,m)):gt(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):m.isEmpty()?d.trackChildChange(p_(e,i)):d.trackChildChange(gb(e,i,m))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return i!=null&&(t.isLeafNode()||t.forEachChild(Dr,(r,o)=>{e.hasChild(r)||i.trackChildChange(mb(r,o))}),e.isLeafNode()||e.forEachChild(Dr,(r,o)=>{if(t.hasChild(r)){let d=t.getImmediateChild(r);d.equals(o)||i.trackChildChange(gb(r,o,d))}else i.trackChildChange(p_(r,o))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?Cn.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var nS=class n{constructor(t){this.indexedFilter_=new _b(t.getIndex()),this.index_=t.getIndex(),this.startPost_=n.getStartPost_(t),this.endPost_=n.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){let e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,r,o,d){return this.matches(new On(e,i))||(i=Cn.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,r,o,d)}updateFullNode(t,e,i){e.isLeafNode()&&(e=Cn.EMPTY_NODE);let r=e.withIndex(this.index_);r=r.updatePriority(Cn.EMPTY_NODE);let o=this;return e.forEachChild(Dr,(d,m)=>{o.matches(new On(d,m))||(r=r.updateImmediateChild(d,Cn.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){let e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){let e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}};var SN=class{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{let i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new nS(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,r,o,d){return this.rangedFilter_.matches(new On(e,i))||(i=Cn.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,r,o,d):this.fullLimitUpdateChild_(t,e,i,o,d)}updateFullNode(t,e,i){let r;if(e.isLeafNode()||e.isEmpty())r=Cn.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){r=Cn.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let d=0;for(;o.hasNext()&&d<this.limit_;){let m=o.getNext();if(this.withinDirectionalStart(m))if(this.withinDirectionalEnd(m))r=r.updateImmediateChild(m.name,m.node),d++;else break;else continue}}else{r=e.withIndex(this.index_),r=r.updatePriority(Cn.EMPTY_NODE);let o;this.reverse_?o=r.getReverseIterator(this.index_):o=r.getIterator(this.index_);let d=0;for(;o.hasNext();){let m=o.getNext();d<this.limit_&&this.withinDirectionalStart(m)&&this.withinDirectionalEnd(m)?d++:r=r.updateImmediateChild(m.name,Cn.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,r,o){let d;if(this.reverse_){let N=this.index_.getCompare();d=(q,J)=>N(J,q)}else d=this.index_.getCompare();let m=t;gt(m.numChildren()===this.limit_,"");let b=new On(e,i),T=this.reverse_?m.getFirstChild(this.index_):m.getLastChild(this.index_),A=this.rangedFilter_.matches(b);if(m.hasChild(e)){let N=m.getImmediateChild(e),q=r.getChildAfterChild(this.index_,T,this.reverse_);for(;q!=null&&(q.name===e||m.hasChild(q.name));)q=r.getChildAfterChild(this.index_,q,this.reverse_);let J=q==null?1:d(q,b);if(A&&!i.isEmpty()&&J>=0)return o?.trackChildChange(gb(e,i,N)),m.updateImmediateChild(e,i);{o?.trackChildChange(mb(e,N));let xe=m.updateImmediateChild(e,Cn.EMPTY_NODE);return q!=null&&this.rangedFilter_.matches(q)?(o?.trackChildChange(p_(q.name,q.node)),xe.updateImmediateChild(q.name,q.node)):xe}}else return i.isEmpty()?t:A&&d(T,b)>=0?(o!=null&&(o.trackChildChange(mb(T.name,T.node)),o.trackChildChange(p_(e,i))),m.updateImmediateChild(e,i).updateImmediateChild(T.name,Cn.EMPTY_NODE)):t}};var DN=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Dr}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return gt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return gt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:u_}hasEnd(){return this.endSet_}getIndexEndValue(){return gt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return gt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Tp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return gt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Dr}copy(){let t=new n;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function due(n){return n.loadsAllData()?new _b(n.getIndex()):n.hasLimit()?new SN(n):new nS(n)}function hue(n,t){let e=n.copy();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="r",e}function DH(n){let t={};if(n.isDefault())return t;let e;if(n.index_===Dr?e="$priority":n.index_===cue?e="$value":n.index_===c_?e="$key":(gt(n.index_ instanceof CN,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=Xr(e),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";t[i]=Xr(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+Xr(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";t[i]=Xr(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+Xr(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function IH(n){let t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;e===""&&(n.isViewFromLeft()?e="l":e="r"),t.vf=e}return n.index_!==Dr&&(t.i=n.index_.toString()),t}var IN=class n extends XT{constructor(t,e,i,r){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=Sb("p:rest:"),this.listens_={}}reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(gt(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}listen(t,e,i,r){let o=t._path.toString();this.log_("Listen called for "+o+" "+t._queryIdentifier);let d=n.getListenId_(t,i),m={};this.listens_[d]=m;let b=DH(t._queryParams);this.restRequest_(o+".json",b,(T,A)=>{let N=A;if(T===404&&(N=null,T=null),T===null&&this.onDataUpdate_(o,N,!1,i),_p(this.listens_,d)===m){let q;T?T===401?q="permission_denied":q="rest_error:"+T:q="ok",r(q,null)}})}unlisten(t,e){let i=n.getListenId_(t,e);delete this.listens_[i]}get(t){let e=DH(t._queryParams),i=t._path.toString(),r=new Du;return this.restRequest_(i+".json",e,(o,d)=>{let m=d;o===404&&(m=null,o=null),o===null?(this.onDataUpdate_(i,m,!1,null),r.resolve(m)):r.reject(new Error(m))}),r.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,o])=>{r&&r.accessToken&&(e.auth=r.accessToken),o&&o.token&&(e.ac=o.token);let d=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+th(e);this.log_("Sending REST request for "+d);let m=new XMLHttpRequest;m.onreadystatechange=()=>{if(i&&m.readyState===4){this.log_("REST Response for "+d+" received. status:",m.status,"response:",m.responseText);let b=null;if(m.status>=200&&m.status<300){try{b=Jg(m.responseText)}catch(T){Cs("Failed to parse JSON response for "+d+": "+m.responseText)}i(null,b)}else m.status!==401&&m.status!==404&&Cs("Got unsuccessful REST response for "+d+" Status: "+m.status),i(m.status);i=null}},m.open("GET",d,!0),m.send()})}};var MN=class{constructor(){this.rootNode_=Cn.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}};function iS(){return{value:null,children:new Map}}function mG(n,t,e){if(Ln(t))n.value=e,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(t,e);else{let i=Nn(t);n.children.has(i)||n.children.set(i,iS());let r=n.children.get(i);t=$i(t),mG(r,t,e)}}function AN(n,t,e){n.value!==null?e(t,n.value):fue(n,(i,r)=>{let o=new ui(t.toString()+"/"+i);AN(r,o,e)})}function fue(n,t){n.children.forEach((e,i)=>{t(i,e)})}var kN=class{constructor(t){this.collection_=t,this.last_=null}get(){let t=this.collection_.get(),e=Object.assign({},t);return this.last_&&Ho(this.last_,(i,r)=>{e[i]=e[i]-r}),this.last_=t,e}};var MH=10*1e3,pue=30*1e3,mue=300*1e3,RN=class{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new kN(t);let i=MH+(pue-MH)*Math.random();cb(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let t=this.statsListener_.get(),e={},i=!1;Ho(t,(r,o)=>{o>0&&Il(this.statsToReport_,r)&&(e[r]=o,i=!0)}),i&&this.server_.reportStats(e),cb(this.reportStats_.bind(this),Math.floor(Math.random()*2*mue))}};var Ec=(function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n})(Ec||{});function cO(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function uO(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function dO(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var PN=class n{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=Ec.ACK_USER_WRITE,this.source=cO()}operationForChild(t){if(Ln(this.path)){if(this.affectedTree.value!=null)return gt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let e=this.affectedTree.subtree(new ui(t));return new n(Kn(),e,this.revert)}}else return gt(Nn(this.path)===t,"operationForChild called for unrelated child."),new n($i(this.path),this.affectedTree,this.revert)}};var rS=class n{constructor(t,e){this.source=t,this.path=e,this.type=Ec.LISTEN_COMPLETE}operationForChild(t){return Ln(this.path)?new n(this.source,Kn()):new n(this.source,$i(this.path))}};var m_=class n{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=Ec.OVERWRITE}operationForChild(t){return Ln(this.path)?new n(this.source,Kn(),this.snap.getImmediateChild(t)):new n(this.source,$i(this.path),this.snap)}};var yb=class n{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=Ec.MERGE}operationForChild(t){if(Ln(this.path)){let e=this.children.subtree(new ui(t));return e.isEmpty()?null:e.value?new m_(this.source,Kn(),e.value):new n(this.source,Kn(),e)}else return gt(Nn(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,$i(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Cc=class{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Ln(t))return this.isFullyInitialized()&&!this.filtered_;let e=Nn(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}};var NN=class{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}};function gue(n,t,e,i){let r=[],o=[];return t.forEach(d=>{d.type==="child_changed"&&n.index_.indexedValueChanged(d.oldSnap,d.snapshotNode)&&o.push(uue(d.childName,d.snapshotNode))}),lb(n,r,"child_removed",t,i,e),lb(n,r,"child_added",t,i,e),lb(n,r,"child_moved",o,i,e),lb(n,r,"child_changed",t,i,e),lb(n,r,"value",t,i,e),r}function lb(n,t,e,i,r,o){let d=i.filter(m=>m.type===e);d.sort((m,b)=>yue(n,m,b)),d.forEach(m=>{let b=_ue(n,m,o);r.forEach(T=>{T.respondsTo(m.type)&&t.push(T.createEvent(b,n.query_))})})}function _ue(n,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}function yue(n,t,e){if(t.childName==null||e.childName==null)throw gp("Should only compare child_ events.");let i=new On(t.childName,t.snapshotNode),r=new On(e.childName,e.snapshotNode);return n.index_.compare(i,r)}function yS(n,t){return{eventCache:n,serverCache:t}}function db(n,t,e,i){return yS(new Cc(t,e,i),n.serverCache)}function gG(n,t,e,i){return yS(n.eventCache,new Cc(t,e,i))}function oS(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Sp(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var nN,vue=()=>(nN||(nN=new Za(yce)),nN),Ts=class n{constructor(t,e=vue()){this.value=t,this.children=e}static fromObject(t){let e=new n(null);return Ho(t,(i,r)=>{e=e.set(new ui(i),r)}),e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:Kn(),value:this.value};if(Ln(t))return null;{let i=Nn(t),r=this.children.get(i);if(r!==null){let o=r.findRootMostMatchingPathAndValue($i(t),e);return o!=null?{path:Sr(new ui(i),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(Ln(t))return this;{let e=Nn(t),i=this.children.get(e);return i!==null?i.subtree($i(t)):new n(null)}}set(t,e){if(Ln(t))return new n(e,this.children);{let i=Nn(t),o=(this.children.get(i)||new n(null)).set($i(t),e),d=this.children.insert(i,o);return new n(this.value,d)}}remove(t){if(Ln(t))return this.children.isEmpty()?new n(null):new n(null,this.children);{let e=Nn(t),i=this.children.get(e);if(i){let r=i.remove($i(t)),o;return r.isEmpty()?o=this.children.remove(e):o=this.children.insert(e,r),this.value===null&&o.isEmpty()?new n(null):new n(this.value,o)}else return this}}get(t){if(Ln(t))return this.value;{let e=Nn(t),i=this.children.get(e);return i?i.get($i(t)):null}}setTree(t,e){if(Ln(t))return e;{let i=Nn(t),o=(this.children.get(i)||new n(null)).setTree($i(t),e),d;return o.isEmpty()?d=this.children.remove(i):d=this.children.insert(i,o),new n(this.value,d)}}fold(t){return this.fold_(Kn(),t)}fold_(t,e){let i={};return this.children.inorderTraversal((r,o)=>{i[r]=o.fold_(Sr(t,r),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,Kn(),e)}findOnPath_(t,e,i){let r=this.value?i(e,this.value):!1;if(r)return r;if(Ln(t))return null;{let o=Nn(t),d=this.children.get(o);return d?d.findOnPath_($i(t),Sr(e,o),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Kn(),e)}foreachOnPath_(t,e,i){if(Ln(t))return this;{this.value&&i(e,this.value);let r=Nn(t),o=this.children.get(r);return o?o.foreachOnPath_($i(t),Sr(e,r),i):new n(null)}}foreach(t){this.foreach_(Kn(),t)}foreach_(t,e){this.children.inorderTraversal((i,r)=>{r.foreach_(Sr(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}};var Pl=class n{constructor(t){this.writeTree_=t}static empty(){return new n(new Ts(null))}};function hb(n,t,e){if(Ln(t))return new Pl(new Ts(e));{let i=n.writeTree_.findRootMostValueAndPath(t);if(i!=null){let r=i.path,o=i.value,d=Es(r,t);return o=o.updateChild(d,e),new Pl(n.writeTree_.set(r,o))}else{let r=new Ts(e),o=n.writeTree_.setTree(t,r);return new Pl(o)}}}function ON(n,t,e){let i=n;return Ho(e,(r,o)=>{i=hb(i,Sr(t,r),o)}),i}function AH(n,t){if(Ln(t))return Pl.empty();{let e=n.writeTree_.setTree(t,new Ts(null));return new Pl(e)}}function FN(n,t){return Ip(n,t)!=null}function Ip(n,t){let e=n.writeTree_.findRootMostValueAndPath(t);return e!=null?n.writeTree_.get(e.path).getChild(Es(e.path,t)):null}function kH(n){let t=[],e=n.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(Dr,(i,r)=>{t.push(new On(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&t.push(new On(i,r.value))}),t}function ah(n,t){if(Ln(t))return n;{let e=Ip(n,t);return e!=null?new Pl(new Ts(e)):new Pl(n.writeTree_.subtree(t))}}function LN(n){return n.writeTree_.isEmpty()}function g_(n,t){return _G(Kn(),n.writeTree_,t)}function _G(n,t,e){if(t.value!=null)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((r,o)=>{r===".priority"?(gt(o.value!==null,"Priority writes must always be leaf nodes"),i=o.value):e=_G(Sr(n,r),o,e)}),!e.getChild(n).isEmpty()&&i!==null&&(e=e.updateChild(Sr(n,".priority"),i)),e}}function vS(n,t){return wG(t,n)}function bue(n,t,e,i,r){gt(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:r}),r&&(n.visibleWrites=hb(n.visibleWrites,t,e)),n.lastWriteId=i}function wue(n,t,e,i){gt(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:t,children:e,writeId:i,visible:!0}),n.visibleWrites=ON(n.visibleWrites,t,e),n.lastWriteId=i}function xue(n,t){for(let e=0;e<n.allWrites.length;e++){let i=n.allWrites[e];if(i.writeId===t)return i}return null}function Eue(n,t){let e=n.allWrites.findIndex(m=>m.writeId===t);gt(e>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[e];n.allWrites.splice(e,1);let r=i.visible,o=!1,d=n.allWrites.length-1;for(;r&&d>=0;){let m=n.allWrites[d];m.visible&&(d>=e&&Cue(m,i.path)?r=!1:Wa(i.path,m.path)&&(o=!0)),d--}if(r){if(o)return Tue(n),!0;if(i.snap)n.visibleWrites=AH(n.visibleWrites,i.path);else{let m=i.children;Ho(m,b=>{n.visibleWrites=AH(n.visibleWrites,Sr(i.path,b))})}return!0}else return!1}function Cue(n,t){if(n.snap)return Wa(n.path,t);for(let e in n.children)if(n.children.hasOwnProperty(e)&&Wa(Sr(n.path,e),t))return!0;return!1}function Tue(n){n.visibleWrites=yG(n.allWrites,Sue,Kn()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Sue(n){return n.visible}function yG(n,t,e){let i=Pl.empty();for(let r=0;r<n.length;++r){let o=n[r];if(t(o)){let d=o.path,m;if(o.snap)Wa(e,d)?(m=Es(e,d),i=hb(i,m,o.snap)):Wa(d,e)&&(m=Es(d,e),i=hb(i,Kn(),o.snap.getChild(m)));else if(o.children){if(Wa(e,d))m=Es(e,d),i=ON(i,m,o.children);else if(Wa(d,e))if(m=Es(d,e),Ln(m))i=ON(i,Kn(),o.children);else{let b=_p(o.children,Nn(m));if(b){let T=b.getChild($i(m));i=hb(i,Kn(),T)}}}else throw gp("WriteRecord should have .snap or .children")}}return i}function vG(n,t,e,i,r){if(!i&&!r){let o=Ip(n.visibleWrites,t);if(o!=null)return o;{let d=ah(n.visibleWrites,t);if(LN(d))return e;if(e==null&&!FN(d,Kn()))return null;{let m=e||Cn.EMPTY_NODE;return g_(d,m)}}}else{let o=ah(n.visibleWrites,t);if(!r&&LN(o))return e;if(!r&&e==null&&!FN(o,Kn()))return null;{let d=function(T){return(T.visible||r)&&(!i||!~i.indexOf(T.writeId))&&(Wa(T.path,t)||Wa(t,T.path))},m=yG(n.allWrites,d,t),b=e||Cn.EMPTY_NODE;return g_(m,b)}}}function Due(n,t,e){let i=Cn.EMPTY_NODE,r=Ip(n.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Dr,(o,d)=>{i=i.updateImmediateChild(o,d)}),i;if(e){let o=ah(n.visibleWrites,t);return e.forEachChild(Dr,(d,m)=>{let b=g_(ah(o,new ui(d)),m);i=i.updateImmediateChild(d,b)}),kH(o).forEach(d=>{i=i.updateImmediateChild(d.name,d.node)}),i}else{let o=ah(n.visibleWrites,t);return kH(o).forEach(d=>{i=i.updateImmediateChild(d.name,d.node)}),i}}function Iue(n,t,e,i,r){gt(i||r,"Either existingEventSnap or existingServerSnap must exist");let o=Sr(t,e);if(FN(n.visibleWrites,o))return null;{let d=ah(n.visibleWrites,o);return LN(d)?r.getChild(e):g_(d,r.getChild(e))}}function Mue(n,t,e,i){let r=Sr(t,e),o=Ip(n.visibleWrites,r);if(o!=null)return o;if(i.isCompleteForChild(e)){let d=ah(n.visibleWrites,r);return g_(d,i.getNode().getImmediateChild(e))}else return null}function Aue(n,t){return Ip(n.visibleWrites,t)}function kue(n,t,e,i,r,o,d){let m,b=ah(n.visibleWrites,t),T=Ip(b,Kn());if(T!=null)m=T;else if(e!=null)m=g_(b,e);else return[];if(m=m.withIndex(d),!m.isEmpty()&&!m.isLeafNode()){let A=[],N=d.getCompare(),q=o?m.getReverseIteratorFrom(i,d):m.getIteratorFrom(i,d),J=q.getNext();for(;J&&A.length<r;)N(J,i)!==0&&A.push(J),J=q.getNext();return A}else return[]}function Rue(){return{visibleWrites:Pl.empty(),allWrites:[],lastWriteId:-1}}function sS(n,t,e,i){return vG(n.writeTree,n.treePath,t,e,i)}function hO(n,t){return Due(n.writeTree,n.treePath,t)}function RH(n,t,e,i){return Iue(n.writeTree,n.treePath,t,e,i)}function aS(n,t){return Aue(n.writeTree,Sr(n.treePath,t))}function Pue(n,t,e,i,r,o){return kue(n.writeTree,n.treePath,t,e,i,r,o)}function fO(n,t,e){return Mue(n.writeTree,n.treePath,t,e)}function bG(n,t){return wG(Sr(n.treePath,t),n.writeTree)}function wG(n,t){return{treePath:n,writeTree:t}}var BN=class{constructor(){this.changeMap=new Map}trackChildChange(t){let e=t.type,i=t.childName;gt(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),gt(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let o=r.type;if(e==="child_added"&&o==="child_removed")this.changeMap.set(i,gb(i,t.snapshotNode,r.snapshotNode));else if(e==="child_removed"&&o==="child_added")this.changeMap.delete(i);else if(e==="child_removed"&&o==="child_changed")this.changeMap.set(i,mb(i,r.oldSnap));else if(e==="child_changed"&&o==="child_added")this.changeMap.set(i,p_(i,t.snapshotNode));else if(e==="child_changed"&&o==="child_changed")this.changeMap.set(i,gb(i,t.snapshotNode,r.oldSnap));else throw gp("Illegal combination of changes: "+t+" occurred after "+r)}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}};var VN=class{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}},xG=new VN,vb=class{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){let e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{let i=this.optCompleteServerCache_!=null?new Cc(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fO(this.writes_,t,i)}}getChildAfterChild(t,e,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Sp(this.viewCache_),o=Pue(this.writes_,r,e,1,i,t);return o.length===0?null:o[0]}};function Nue(n){return{filter:n}}function Oue(n,t){gt(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),gt(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Fue(n,t,e,i,r){let o=new BN,d,m;if(e.type===Ec.OVERWRITE){let T=e;T.source.fromUser?d=jN(n,t,T.path,T.snap,i,r,o):(gt(T.source.fromServer,"Unknown source."),m=T.source.tagged||t.serverCache.isFiltered()&&!Ln(T.path),d=lS(n,t,T.path,T.snap,i,r,m,o))}else if(e.type===Ec.MERGE){let T=e;T.source.fromUser?d=Bue(n,t,T.path,T.children,i,r,o):(gt(T.source.fromServer,"Unknown source."),m=T.source.tagged||t.serverCache.isFiltered(),d=zN(n,t,T.path,T.children,i,r,m,o))}else if(e.type===Ec.ACK_USER_WRITE){let T=e;T.revert?d=zue(n,t,T.path,i,r,o):d=Vue(n,t,T.path,T.affectedTree,i,r,o)}else if(e.type===Ec.LISTEN_COMPLETE)d=jue(n,t,e.path,i,o);else throw gp("Unknown operation type: "+e.type);let b=o.getChanges();return Lue(t,d,b),{viewCache:d,changes:b}}function Lue(n,t,e){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),o=oS(n);(e.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(o)||!i.getNode().getPriority().equals(o.getPriority()))&&e.push(pG(oS(t)))}}function EG(n,t,e,i,r,o){let d=t.eventCache;if(aS(i,e)!=null)return t;{let m,b;if(Ln(e))if(gt(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let T=Sp(t),A=T instanceof Cn?T:Cn.EMPTY_NODE,N=hO(i,A);m=n.filter.updateFullNode(t.eventCache.getNode(),N,o)}else{let T=sS(i,Sp(t));m=n.filter.updateFullNode(t.eventCache.getNode(),T,o)}else{let T=Nn(e);if(T===".priority"){gt(ch(e)===1,"Can't have a priority with additional path components");let A=d.getNode();b=t.serverCache.getNode();let N=RH(i,e,A,b);N!=null?m=n.filter.updatePriority(A,N):m=d.getNode()}else{let A=$i(e),N;if(d.isCompleteForChild(T)){b=t.serverCache.getNode();let q=RH(i,e,d.getNode(),b);q!=null?N=d.getNode().getImmediateChild(T).updateChild(A,q):N=d.getNode().getImmediateChild(T)}else N=fO(i,T,t.serverCache);N!=null?m=n.filter.updateChild(d.getNode(),T,N,A,r,o):m=d.getNode()}}return db(t,m,d.isFullyInitialized()||Ln(e),n.filter.filtersNodes())}}function lS(n,t,e,i,r,o,d,m){let b=t.serverCache,T,A=d?n.filter:n.filter.getIndexedFilter();if(Ln(e))T=A.updateFullNode(b.getNode(),i,null);else if(A.filtersNodes()&&!b.isFiltered()){let J=b.getNode().updateChild(e,i);T=A.updateFullNode(b.getNode(),J,null)}else{let J=Nn(e);if(!b.isCompleteForPath(e)&&ch(e)>1)return t;let K=$i(e),Te=b.getNode().getImmediateChild(J).updateChild(K,i);J===".priority"?T=A.updatePriority(b.getNode(),Te):T=A.updateChild(b.getNode(),J,Te,K,xG,null)}let N=gG(t,T,b.isFullyInitialized()||Ln(e),A.filtersNodes()),q=new vb(r,N,o);return EG(n,N,e,r,q,m)}function jN(n,t,e,i,r,o,d){let m=t.eventCache,b,T,A=new vb(r,t,o);if(Ln(e))T=n.filter.updateFullNode(t.eventCache.getNode(),i,d),b=db(t,T,!0,n.filter.filtersNodes());else{let N=Nn(e);if(N===".priority")T=n.filter.updatePriority(t.eventCache.getNode(),i),b=db(t,T,m.isFullyInitialized(),m.isFiltered());else{let q=$i(e),J=m.getNode().getImmediateChild(N),K;if(Ln(q))K=i;else{let xe=A.getCompleteChild(N);xe!=null?oO(q)===".priority"&&xe.getChild(lG(q)).isEmpty()?K=xe:K=xe.updateChild(q,i):K=Cn.EMPTY_NODE}if(J.equals(K))b=t;else{let xe=n.filter.updateChild(m.getNode(),N,K,q,A,d);b=db(t,xe,m.isFullyInitialized(),n.filter.filtersNodes())}}}return b}function PH(n,t){return n.eventCache.isCompleteForChild(t)}function Bue(n,t,e,i,r,o,d){let m=t;return i.foreach((b,T)=>{let A=Sr(e,b);PH(t,Nn(A))&&(m=jN(n,m,A,T,r,o,d))}),i.foreach((b,T)=>{let A=Sr(e,b);PH(t,Nn(A))||(m=jN(n,m,A,T,r,o,d))}),m}function NH(n,t,e){return e.foreach((i,r)=>{t=t.updateChild(i,r)}),t}function zN(n,t,e,i,r,o,d,m){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let b=t,T;Ln(e)?T=i:T=new Ts(null).setTree(e,i);let A=t.serverCache.getNode();return T.children.inorderTraversal((N,q)=>{if(A.hasChild(N)){let J=t.serverCache.getNode().getImmediateChild(N),K=NH(n,J,q);b=lS(n,b,new ui(N),K,r,o,d,m)}}),T.children.inorderTraversal((N,q)=>{let J=!t.serverCache.isCompleteForChild(N)&&q.value===null;if(!A.hasChild(N)&&!J){let K=t.serverCache.getNode().getImmediateChild(N),xe=NH(n,K,q);b=lS(n,b,new ui(N),xe,r,o,d,m)}}),b}function Vue(n,t,e,i,r,o,d){if(aS(r,e)!=null)return t;let m=t.serverCache.isFiltered(),b=t.serverCache;if(i.value!=null){if(Ln(e)&&b.isFullyInitialized()||b.isCompleteForPath(e))return lS(n,t,e,b.getNode().getChild(e),r,o,m,d);if(Ln(e)){let T=new Ts(null);return b.getNode().forEachChild(c_,(A,N)=>{T=T.set(new ui(A),N)}),zN(n,t,e,T,r,o,m,d)}else return t}else{let T=new Ts(null);return i.foreach((A,N)=>{let q=Sr(e,A);b.isCompleteForPath(q)&&(T=T.set(A,b.getNode().getChild(q)))}),zN(n,t,e,T,r,o,m,d)}}function jue(n,t,e,i,r){let o=t.serverCache,d=gG(t,o.getNode(),o.isFullyInitialized()||Ln(e),o.isFiltered());return EG(n,d,e,i,xG,r)}function zue(n,t,e,i,r,o){let d;if(aS(i,e)!=null)return t;{let m=new vb(i,t,r),b=t.eventCache.getNode(),T;if(Ln(e)||Nn(e)===".priority"){let A;if(t.serverCache.isFullyInitialized())A=sS(i,Sp(t));else{let N=t.serverCache.getNode();gt(N instanceof Cn,"serverChildren would be complete if leaf node"),A=hO(i,N)}A=A,T=n.filter.updateFullNode(b,A,o)}else{let A=Nn(e),N=fO(i,A,t.serverCache);N==null&&t.serverCache.isCompleteForChild(A)&&(N=b.getImmediateChild(A)),N!=null?T=n.filter.updateChild(b,A,N,$i(e),m,o):t.eventCache.getNode().hasChild(A)?T=n.filter.updateChild(b,A,Cn.EMPTY_NODE,$i(e),m,o):T=b,T.isEmpty()&&t.serverCache.isFullyInitialized()&&(d=sS(i,Sp(t)),d.isLeafNode()&&(T=n.filter.updateFullNode(T,d,o)))}return d=t.serverCache.isFullyInitialized()||aS(i,Kn())!=null,db(t,T,d,n.filter.filtersNodes())}}var UN=class{constructor(t,e){this.query_=t,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new _b(i.getIndex()),o=due(i);this.processor_=Nue(o);let d=e.serverCache,m=e.eventCache,b=r.updateFullNode(Cn.EMPTY_NODE,d.getNode(),null),T=o.updateFullNode(Cn.EMPTY_NODE,m.getNode(),null),A=new Cc(b,d.isFullyInitialized(),r.filtersNodes()),N=new Cc(T,m.isFullyInitialized(),o.filtersNodes());this.viewCache_=yS(N,A),this.eventGenerator_=new NN(this.query_)}get query(){return this.query_}};function Uue(n){return n.viewCache_.serverCache.getNode()}function $ue(n){return oS(n.viewCache_)}function Hue(n,t){let e=Sp(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!Ln(t)&&!e.getImmediateChild(Nn(t)).isEmpty())?e.getChild(t):null}function OH(n){return n.eventRegistrations_.length===0}function Gue(n,t){n.eventRegistrations_.push(t)}function FH(n,t,e){let i=[];if(e){gt(t==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(o=>{let d=o.createCancelEvent(e,r);d&&i.push(d)})}if(t){let r=[];for(let o=0;o<n.eventRegistrations_.length;++o){let d=n.eventRegistrations_[o];if(!d.matches(t))r.push(d);else if(t.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(o+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function LH(n,t,e,i){t.type===Ec.MERGE&&t.source.queryId!==null&&(gt(Sp(n.viewCache_),"We should always have a full cache before handling merges"),gt(oS(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,o=Fue(n.processor_,r,t,e,i);return Oue(n.processor_,o.viewCache),gt(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=o.viewCache,CG(n,o.changes,o.viewCache.eventCache.getNode(),null)}function que(n,t){let e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(Dr,(o,d)=>{i.push(p_(o,d))}),e.isFullyInitialized()&&i.push(pG(e.getNode())),CG(n,i,e.getNode(),t)}function CG(n,t,e,i){let r=i?[i]:n.eventRegistrations_;return gue(n.eventGenerator_,t,e,r)}var cS,uS=class{constructor(){this.views=new Map}};function Wue(n){gt(!cS,"__referenceConstructor has already been defined"),cS=n}function Zue(){return gt(cS,"Reference.ts has not been loaded"),cS}function Kue(n){return n.views.size===0}function pO(n,t,e,i){let r=t.source.queryId;if(r!==null){let o=n.views.get(r);return gt(o!=null,"SyncTree gave us an op for an invalid query."),LH(o,t,e,i)}else{let o=[];for(let d of n.views.values())o=o.concat(LH(d,t,e,i));return o}}function TG(n,t,e,i,r){let o=t._queryIdentifier,d=n.views.get(o);if(!d){let m=sS(e,r?i:null),b=!1;m?b=!0:i instanceof Cn?(m=hO(e,i),b=!1):(m=Cn.EMPTY_NODE,b=!1);let T=yS(new Cc(m,b,!1),new Cc(i,r,!1));return new UN(t,T)}return d}function Yue(n,t,e,i,r,o){let d=TG(n,t,i,r,o);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,d),Gue(d,e),que(d,e)}function Xue(n,t,e,i){let r=t._queryIdentifier,o=[],d=[],m=uh(n);if(r==="default")for(let[b,T]of n.views.entries())d=d.concat(FH(T,e,i)),OH(T)&&(n.views.delete(b),T.query._queryParams.loadsAllData()||o.push(T.query));else{let b=n.views.get(r);b&&(d=d.concat(FH(b,e,i)),OH(b)&&(n.views.delete(r),b.query._queryParams.loadsAllData()||o.push(b.query)))}return m&&!uh(n)&&o.push(new(Zue())(t._repo,t._path)),{removed:o,events:d}}function SG(n){let t=[];for(let e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function lh(n,t){let e=null;for(let i of n.views.values())e=e||Hue(i,t);return e}function DG(n,t){if(t._queryParams.loadsAllData())return bS(n);{let i=t._queryIdentifier;return n.views.get(i)}}function IG(n,t){return DG(n,t)!=null}function uh(n){return bS(n)!=null}function bS(n){for(let t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}var dS;function Que(n){gt(!dS,"__referenceConstructor has already been defined"),dS=n}function Jue(){return gt(dS,"Reference.ts has not been loaded"),dS}var ede=1,hS=class{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Ts(null),this.pendingWriteTree_=Rue(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function MG(n,t,e,i,r){return bue(n.pendingWriteTree_,t,e,i,r),r?b_(n,new m_(cO(),t,e)):[]}function tde(n,t,e,i){wue(n.pendingWriteTree_,t,e,i);let r=Ts.fromObject(e);return b_(n,new yb(cO(),t,r))}function sh(n,t,e=!1){let i=xue(n.pendingWriteTree_,t);if(Eue(n.pendingWriteTree_,t)){let o=new Ts(null);return i.snap!=null?o=o.set(Kn(),!0):Ho(i.children,d=>{o=o.set(new ui(d),!0)}),b_(n,new PN(i.path,o,e))}else return[]}function Ib(n,t,e){return b_(n,new m_(uO(),t,e))}function nde(n,t,e){let i=Ts.fromObject(e);return b_(n,new yb(uO(),t,i))}function ide(n,t){return b_(n,new rS(uO(),t))}function rde(n,t,e){let i=gO(n,e);if(i){let r=_O(i),o=r.path,d=r.queryId,m=Es(o,t),b=new rS(dO(d),m);return yO(n,o,b)}else return[]}function fS(n,t,e,i,r=!1){let o=t._path,d=n.syncPointTree_.get(o),m=[];if(d&&(t._queryIdentifier==="default"||IG(d,t))){let b=Xue(d,t,e,i);Kue(d)&&(n.syncPointTree_=n.syncPointTree_.remove(o));let T=b.removed;if(m=b.events,!r){let A=T.findIndex(q=>q._queryParams.loadsAllData())!==-1,N=n.syncPointTree_.findOnPath(o,(q,J)=>uh(J));if(A&&!N){let q=n.syncPointTree_.subtree(o);if(!q.isEmpty()){let J=ade(q);for(let K=0;K<J.length;++K){let xe=J[K],Te=xe.query,Ge=PG(n,xe);n.listenProvider_.startListening(fb(Te),bb(n,Te),Ge.hashFn,Ge.onComplete)}}}!N&&T.length>0&&!i&&(A?n.listenProvider_.stopListening(fb(t),null):T.forEach(q=>{let J=n.queryToTagMap.get(wS(q));n.listenProvider_.stopListening(fb(q),J)}))}lde(n,T)}return m}function AG(n,t,e,i){let r=gO(n,i);if(r!=null){let o=_O(r),d=o.path,m=o.queryId,b=Es(d,t),T=new m_(dO(m),b,e);return yO(n,d,T)}else return[]}function ode(n,t,e,i){let r=gO(n,i);if(r){let o=_O(r),d=o.path,m=o.queryId,b=Es(d,t),T=Ts.fromObject(e),A=new yb(dO(m),b,T);return yO(n,d,A)}else return[]}function $N(n,t,e,i=!1){let r=t._path,o=null,d=!1;n.syncPointTree_.foreachOnPath(r,(q,J)=>{let K=Es(q,r);o=o||lh(J,K),d=d||uh(J)});let m=n.syncPointTree_.get(r);m?(d=d||uh(m),o=o||lh(m,Kn())):(m=new uS,n.syncPointTree_=n.syncPointTree_.set(r,m));let b;o!=null?b=!0:(b=!1,o=Cn.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((J,K)=>{let xe=lh(K,Kn());xe&&(o=o.updateImmediateChild(J,xe))}));let T=IG(m,t);if(!T&&!t._queryParams.loadsAllData()){let q=wS(t);gt(!n.queryToTagMap.has(q),"View does not exist, but we have a tag");let J=cde();n.queryToTagMap.set(q,J),n.tagToQueryMap.set(J,q)}let A=vS(n.pendingWriteTree_,r),N=Yue(m,t,e,A,o,b);if(!T&&!d&&!i){let q=DG(m,t);N=N.concat(ude(n,t,q))}return N}function mO(n,t,e){let r=n.pendingWriteTree_,o=n.syncPointTree_.findOnPath(t,(d,m)=>{let b=Es(d,t),T=lh(m,b);if(T)return T});return vG(r,t,o,e,!0)}function sde(n,t){let e=t._path,i=null;n.syncPointTree_.foreachOnPath(e,(T,A)=>{let N=Es(T,e);i=i||lh(A,N)});let r=n.syncPointTree_.get(e);r?i=i||lh(r,Kn()):(r=new uS,n.syncPointTree_=n.syncPointTree_.set(e,r));let o=i!=null,d=o?new Cc(i,!0,!1):null,m=vS(n.pendingWriteTree_,t._path),b=TG(r,t,m,o?d.getNode():Cn.EMPTY_NODE,o);return $ue(b)}function b_(n,t){return kG(t,n.syncPointTree_,null,vS(n.pendingWriteTree_,Kn()))}function kG(n,t,e,i){if(Ln(n.path))return RG(n,t,e,i);{let r=t.get(Kn());e==null&&r!=null&&(e=lh(r,Kn()));let o=[],d=Nn(n.path),m=n.operationForChild(d),b=t.children.get(d);if(b&&m){let T=e?e.getImmediateChild(d):null,A=bG(i,d);o=o.concat(kG(m,b,T,A))}return r&&(o=o.concat(pO(r,n,i,e))),o}}function RG(n,t,e,i){let r=t.get(Kn());e==null&&r!=null&&(e=lh(r,Kn()));let o=[];return t.children.inorderTraversal((d,m)=>{let b=e?e.getImmediateChild(d):null,T=bG(i,d),A=n.operationForChild(d);A&&(o=o.concat(RG(A,m,b,T)))}),r&&(o=o.concat(pO(r,n,i,e))),o}function PG(n,t){let e=t.query,i=bb(n,e);return{hashFn:()=>(Uue(t)||Cn.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?rde(n,e._path,i):ide(n,e._path);{let o=wce(r,e);return fS(n,e,null,o)}}}}function bb(n,t){let e=wS(t);return n.queryToTagMap.get(e)}function wS(n){return n._path.toString()+"$"+n._queryIdentifier}function gO(n,t){return n.tagToQueryMap.get(t)}function _O(n){let t=n.indexOf("$");return gt(t!==-1&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new ui(n.substr(0,t))}}function yO(n,t,e){let i=n.syncPointTree_.get(t);gt(i,"Missing sync point for query tag that we're tracking");let r=vS(n.pendingWriteTree_,t);return pO(i,e,r,null)}function ade(n){return n.fold((t,e,i)=>{if(e&&uh(e))return[bS(e)];{let r=[];return e&&(r=SG(e)),Ho(i,(o,d)=>{r=r.concat(d)}),r}})}function fb(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Jue())(n._repo,n._path):n}function lde(n,t){for(let e=0;e<t.length;++e){let i=t[e];if(!i._queryParams.loadsAllData()){let r=wS(i),o=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(o)}}}function cde(){return ede++}function ude(n,t,e){let i=t._path,r=bb(n,t),o=PG(n,e),d=n.listenProvider_.startListening(fb(t),r,o.hashFn,o.onComplete),m=n.syncPointTree_.subtree(i);if(r)gt(!uh(m.value),"If we're adding a query, it shouldn't be shadowed");else{let b=m.fold((T,A,N)=>{if(!Ln(T)&&A&&uh(A))return[bS(A).query];{let q=[];return A&&(q=q.concat(SG(A).map(J=>J.query))),Ho(N,(J,K)=>{q=q.concat(K)}),q}});for(let T=0;T<b.length;++T){let A=b[T];n.listenProvider_.stopListening(fb(A),bb(n,A))}}return d}var HN=class n{constructor(t){this.node_=t}getImmediateChild(t){let e=this.node_.getImmediateChild(t);return new n(e)}node(){return this.node_}},GN=class n{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){let e=Sr(this.path_,t);return new n(this.syncTree_,e)}node(){return mO(this.syncTree_,this.path_)}},dde=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},BH=function(n,t,e){if(!n||typeof n!="object")return n;if(gt(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return hde(n[".sv"],t,e);if(typeof n[".sv"]=="object")return fde(n[".sv"],t);gt(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},hde=function(n,t,e){if(n==="timestamp")return e.timestamp;gt(!1,"Unexpected server value: "+n)},fde=function(n,t,e){n.hasOwnProperty("increment")||gt(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&gt(!1,"Unexpected increment value: "+i);let r=t.node();if(gt(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let d=r.getValue();return typeof d!="number"?i:d+i},NG=function(n,t,e,i){return vO(t,new GN(e,n),i)},OG=function(n,t,e){return vO(n,new HN(t),e)};function vO(n,t,e){let i=n.getPriority().val(),r=BH(i,t.getImmediateChild(".priority"),e),o;if(n.isLeafNode()){let d=n,m=BH(d.getValue(),t,e);return m!==d.getValue()||r!==d.getPriority().val()?new h_(m,_o(r)):n}else{let d=n;return o=d,r!==d.getPriority().val()&&(o=o.updatePriority(new h_(r))),d.forEachChild(Dr,(m,b)=>{let T=vO(b,t.getImmediateChild(m),e);T!==b&&(o=o.updateImmediateChild(m,T))}),o}}var wb=class{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}};function bO(n,t){let e=t instanceof ui?t:new ui(t),i=n,r=Nn(e);for(;r!==null;){let o=_p(i.node.children,r)||{children:{},childCount:0};i=new wb(r,i,o),e=$i(e),r=Nn(e)}return i}function w_(n){return n.node.value}function FG(n,t){n.node.value=t,qN(n)}function LG(n){return n.node.childCount>0}function pde(n){return w_(n)===void 0&&!LG(n)}function xS(n,t){Ho(n.node.children,(e,i)=>{t(new wb(e,n,i))})}function BG(n,t,e,i){e&&!i&&t(n),xS(n,r=>{BG(r,t,!0,i)}),e&&i&&t(n)}function mde(n,t,e){let i=e?n:n.parent;for(;i!==null;){if(t(i))return!0;i=i.parent}return!1}function Mb(n){return new ui(n.parent===null?n.name:Mb(n.parent)+"/"+n.name)}function qN(n){n.parent!==null&&gde(n.parent,n.name,n)}function gde(n,t,e){let i=pde(e),r=Il(n.node.children,t);i&&r?(delete n.node.children[t],n.node.childCount--,qN(n)):!i&&!r&&(n.node.children[t]=e.node,n.node.childCount++,qN(n))}var _de=/[\[\].#$\/\u0000-\u001F\u007F]/,yde=/[\[\].#$\u0000-\u001F\u007F]/,iN=10*1024*1024,wO=function(n){return typeof n=="string"&&n.length!==0&&!_de.test(n)},VG=function(n){return typeof n=="string"&&n.length!==0&&!yde.test(n)},vde=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),VG(n)},bde=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!nO(n)||n&&typeof n=="object"&&Il(n,".sv")},jG=function(n,t,e,i){i&&t===void 0||ES(q0(n,"value"),t,e)},ES=function(n,t,e){let i=e instanceof ui?new _N(e,n):e;if(t===void 0)throw new Error(n+"contains undefined "+xp(i));if(typeof t=="function")throw new Error(n+"contains a function "+xp(i)+" with contents = "+t.toString());if(nO(t))throw new Error(n+"contains "+t.toString()+" "+xp(i));if(typeof t=="string"&&t.length>iN/3&&W0(t)>iN)throw new Error(n+"contains a string greater than "+iN+" utf8 bytes "+xp(i)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let r=!1,o=!1;if(Ho(t,(d,m)=>{if(d===".value")r=!0;else if(d!==".priority"&&d!==".sv"&&(o=!0,!wO(d)))throw new Error(n+" contains an invalid key ("+d+") "+xp(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Xce(i,d),ES(n,m,i),Qce(i)}),r&&o)throw new Error(n+' contains ".value" child '+xp(i)+" in addition to actual children.")}},wde=function(n,t){let e,i;for(e=0;e<t.length;e++){i=t[e];let o=pb(i);for(let d=0;d<o.length;d++)if(!(o[d]===".priority"&&d===o.length-1)){if(!wO(o[d]))throw new Error(n+"contains an invalid key ("+o[d]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(Yce);let r=null;for(e=0;e<t.length;e++){if(i=t[e],r!==null&&Wa(r,i))throw new Error(n+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},xde=function(n,t,e,i){if(i&&t===void 0)return;let r=q0(n,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(r+" must be an object containing the children to replace.");let o=[];Ho(t,(d,m)=>{let b=new ui(d);if(ES(r,m,Sr(e,b)),oO(b)===".priority"&&!bde(m))throw new Error(r+"contains an invalid value for '"+b.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(b)}),wde(r,o)};var zG=function(n,t,e,i){if(!(i&&e===void 0)&&!VG(e))throw new Error(q0(n,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Ede=function(n,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),zG(n,t,e,i)},xO=function(n,t){if(Nn(t)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Cde=function(n,t){let e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!wO(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!vde(e))throw new Error(q0(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var WN=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function CS(n,t){let e=null;for(let i=0;i<t.length;i++){let r=t[i],o=r.getPath();e!==null&&!sO(o,e.path)&&(n.eventLists_.push(e),e=null),e===null&&(e={events:[],path:o}),e.events.push(r)}e&&n.eventLists_.push(e)}function UG(n,t,e){CS(n,e),$G(n,i=>sO(i,t))}function Ka(n,t,e){CS(n,e),$G(n,i=>Wa(i,t)||Wa(t,i))}function $G(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let o=r.path;t(o)?(Tde(n.eventLists_[i]),n.eventLists_[i]=null):e=!1}}e&&(n.eventLists_=[]),n.recursionDepth_--}function Tde(n){for(let t=0;t<n.events.length;t++){let e=n.events[t];if(e!==null){n.events[t]=null;let i=e.getEventRunner();Cp&&$o("event: "+e.toString()),v_(i)}}}var Sde="repo_interrupt",Dde=25,ZN=class{constructor(t,e,i,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new WN,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=iS(),this.transactionQueueTree_=new wb,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Ide(n,t,e){if(n.stats_=rO(n.repoInfo_),n.forceRestClient_||Tce())n.server_=new IN(n.repoInfo_,(i,r,o,d)=>{VH(n,i,r,o,d)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>jH(n,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Xr(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new aO(n.repoInfo_,t,(i,r,o,d)=>{VH(n,i,r,o,d)},i=>{jH(n,i)},i=>{Mde(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Dce(n.repoInfo_,()=>new RN(n.stats_,n.server_)),n.infoData_=new MN,n.infoSyncTree_=new hS({startListening:(i,r,o,d)=>{let m=[],b=n.infoData_.getNode(i._path);return b.isEmpty()||(m=Ib(n.infoSyncTree_,i._path,b),setTimeout(()=>{d("ok")},0)),m},stopListening:()=>{}}),EO(n,"connected",!1),n.serverSyncTree_=new hS({startListening:(i,r,o,d)=>(n.server_.listen(i,o,r,(m,b)=>{let T=d(m,b);Ka(n.eventQueue_,i._path,T)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function HG(n){let e=n.infoData_.getNode(new ui(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function TS(n){return dde({timestamp:HG(n)})}function VH(n,t,e,i,r){n.dataUpdateCount++;let o=new ui(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let d=[];if(r)if(i){let b=G0(e,T=>_o(T));d=ode(n.serverSyncTree_,o,b,r)}else{let b=_o(e);d=AG(n.serverSyncTree_,o,b,r)}else if(i){let b=G0(e,T=>_o(T));d=nde(n.serverSyncTree_,o,b)}else{let b=_o(e);d=Ib(n.serverSyncTree_,o,b)}let m=o;d.length>0&&(m=__(n,o)),Ka(n.eventQueue_,m,d)}function jH(n,t){EO(n,"connected",t),t===!1&&Pde(n)}function Mde(n,t){Ho(t,(e,i)=>{EO(n,e,i)})}function EO(n,t,e){let i=new ui("/.info/"+t),r=_o(e);n.infoData_.updateSnapshot(i,r);let o=Ib(n.infoSyncTree_,i,r);Ka(n.eventQueue_,i,o)}function CO(n){return n.nextWriteId_++}function Ade(n,t,e){let i=sde(n.serverSyncTree_,t);return i!=null?Promise.resolve(i):n.server_.get(t).then(r=>{let o=_o(r).withIndex(t._queryParams.getIndex());$N(n.serverSyncTree_,t,e,!0);let d;if(t._queryParams.loadsAllData())d=Ib(n.serverSyncTree_,t._path,o);else{let m=bb(n.serverSyncTree_,t);d=AG(n.serverSyncTree_,t._path,o,m)}return Ka(n.eventQueue_,t._path,d),fS(n.serverSyncTree_,t,e,null,!0),o},r=>(Ab(n,"get for query "+Xr(t)+" failed: "+r),Promise.reject(new Error(r))))}function kde(n,t,e,i,r){Ab(n,"set",{path:t.toString(),value:e,priority:i});let o=TS(n),d=_o(e,i),m=mO(n.serverSyncTree_,t),b=OG(d,m,o),T=CO(n),A=MG(n.serverSyncTree_,t,b,T,!0);CS(n.eventQueue_,A),n.server_.put(t.toString(),d.val(!0),(q,J)=>{let K=q==="ok";K||Cs("set at "+t+" failed: "+q);let xe=sh(n.serverSyncTree_,T,!K);Ka(n.eventQueue_,t,xe),YN(n,r,q,J)});let N=SO(n,t);__(n,N),Ka(n.eventQueue_,N,[])}function Rde(n,t,e,i){Ab(n,"update",{path:t.toString(),value:e});let r=!0,o=TS(n),d={};if(Ho(e,(m,b)=>{r=!1,d[m]=NG(Sr(t,m),_o(b),n.serverSyncTree_,o)}),r)$o("update() called with empty data.  Don't do anything."),YN(n,i,"ok",void 0);else{let m=CO(n),b=tde(n.serverSyncTree_,t,d,m);CS(n.eventQueue_,b),n.server_.merge(t.toString(),e,(T,A)=>{let N=T==="ok";N||Cs("update at "+t+" failed: "+T);let q=sh(n.serverSyncTree_,m,!N),J=q.length>0?__(n,t):t;Ka(n.eventQueue_,J,q),YN(n,i,T,A)}),Ho(e,T=>{let A=SO(n,Sr(t,T));__(n,A)}),Ka(n.eventQueue_,t,[])}}function Pde(n){Ab(n,"onDisconnectEvents");let t=TS(n),e=iS();AN(n.onDisconnect_,Kn(),(r,o)=>{let d=NG(r,o,n.serverSyncTree_,t);mG(e,r,d)});let i=[];AN(e,Kn(),(r,o)=>{i=i.concat(Ib(n.serverSyncTree_,r,o));let d=SO(n,r);__(n,d)}),n.onDisconnect_=iS(),Ka(n.eventQueue_,Kn(),i)}function Nde(n,t,e){let i;Nn(t._path)===".info"?i=$N(n.infoSyncTree_,t,e):i=$N(n.serverSyncTree_,t,e),UG(n.eventQueue_,t._path,i)}function KN(n,t,e){let i;Nn(t._path)===".info"?i=fS(n.infoSyncTree_,t,e):i=fS(n.serverSyncTree_,t,e),UG(n.eventQueue_,t._path,i)}function Ode(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Sde)}function Ab(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),$o(e,...t)}function YN(n,t,e,i){t&&v_(()=>{if(e==="ok")t(null);else{let r=(e||"error").toUpperCase(),o=r;i&&(o+=": "+i);let d=new Error(o);d.code=r,t(d)}})}function GG(n,t,e){return mO(n.serverSyncTree_,t,e)||Cn.EMPTY_NODE}function TO(n,t=n.transactionQueueTree_){if(t||SS(n,t),w_(t)){let e=WG(n,t);gt(e.length>0,"Sending zero length transaction queue"),e.every(r=>r.status===0)&&Fde(n,Mb(t),e)}else LG(t)&&xS(t,e=>{TO(n,e)})}function Fde(n,t,e){let i=e.map(T=>T.currentWriteId),r=GG(n,t,i),o=r,d=r.hash();for(let T=0;T<e.length;T++){let A=e[T];gt(A.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),A.status=1,A.retryCount++;let N=Es(t,A.path);o=o.updateChild(N,A.currentOutputSnapshotRaw)}let m=o.val(!0),b=t;n.server_.put(b.toString(),m,T=>{Ab(n,"transaction put response",{path:b.toString(),status:T});let A=[];if(T==="ok"){let N=[];for(let q=0;q<e.length;q++)e[q].status=2,A=A.concat(sh(n.serverSyncTree_,e[q].currentWriteId)),e[q].onComplete&&N.push(()=>e[q].onComplete(null,!0,e[q].currentOutputSnapshotResolved)),e[q].unwatcher();SS(n,bO(n.transactionQueueTree_,t)),TO(n,n.transactionQueueTree_),Ka(n.eventQueue_,t,A);for(let q=0;q<N.length;q++)v_(N[q])}else{if(T==="datastale")for(let N=0;N<e.length;N++)e[N].status===3?e[N].status=4:e[N].status=0;else{Cs("transaction at "+b.toString()+" failed: "+T);for(let N=0;N<e.length;N++)e[N].status=4,e[N].abortReason=T}__(n,t)}},d)}function __(n,t){let e=qG(n,t),i=Mb(e),r=WG(n,e);return Lde(n,r,i),i}function Lde(n,t,e){if(t.length===0)return;let i=[],r=[],d=t.filter(m=>m.status===0).map(m=>m.currentWriteId);for(let m=0;m<t.length;m++){let b=t[m],T=Es(e,b.path),A=!1,N;if(gt(T!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),b.status===4)A=!0,N=b.abortReason,r=r.concat(sh(n.serverSyncTree_,b.currentWriteId,!0));else if(b.status===0)if(b.retryCount>=Dde)A=!0,N="maxretry",r=r.concat(sh(n.serverSyncTree_,b.currentWriteId,!0));else{let q=GG(n,b.path,d);b.currentInputSnapshot=q;let J=t[m].update(q.val());if(J!==void 0){ES("transaction failed: Data returned ",J,b.path);let K=_o(J);typeof J=="object"&&J!=null&&Il(J,".priority")||(K=K.updatePriority(q.getPriority()));let Te=b.currentWriteId,Ge=TS(n),Et=OG(K,q,Ge);b.currentOutputSnapshotRaw=K,b.currentOutputSnapshotResolved=Et,b.currentWriteId=CO(n),d.splice(d.indexOf(Te),1),r=r.concat(MG(n.serverSyncTree_,b.path,Et,b.currentWriteId,b.applyLocally)),r=r.concat(sh(n.serverSyncTree_,Te,!0))}else A=!0,N="nodata",r=r.concat(sh(n.serverSyncTree_,b.currentWriteId,!0))}Ka(n.eventQueue_,e,r),r=[],A&&(t[m].status=2,(function(q){setTimeout(q,Math.floor(0))})(t[m].unwatcher),t[m].onComplete&&(N==="nodata"?i.push(()=>t[m].onComplete(null,!1,t[m].currentInputSnapshot)):i.push(()=>t[m].onComplete(new Error(N),!1,null))))}SS(n,n.transactionQueueTree_);for(let m=0;m<i.length;m++)v_(i[m]);TO(n,n.transactionQueueTree_)}function qG(n,t){let e,i=n.transactionQueueTree_;for(e=Nn(t);e!==null&&w_(i)===void 0;)i=bO(i,e),t=$i(t),e=Nn(t);return i}function WG(n,t){let e=[];return ZG(n,t,e),e.sort((i,r)=>i.order-r.order),e}function ZG(n,t,e){let i=w_(t);if(i)for(let r=0;r<i.length;r++)e.push(i[r]);xS(t,r=>{ZG(n,r,e)})}function SS(n,t){let e=w_(t);if(e){let i=0;for(let r=0;r<e.length;r++)e[r].status!==2&&(e[i]=e[r],i++);e.length=i,FG(t,e.length>0?e:void 0)}xS(t,i=>{SS(n,i)})}function SO(n,t){let e=Mb(qG(n,t)),i=bO(n.transactionQueueTree_,t);return mde(i,r=>{rN(n,r)}),rN(n,i),BG(i,r=>{rN(n,r)}),e}function rN(n,t){let e=w_(t);if(e){let i=[],r=[],o=-1;for(let d=0;d<e.length;d++)e[d].status===3||(e[d].status===1?(gt(o===d-1,"All SENT items should be at beginning of queue."),o=d,e[d].status=3,e[d].abortReason="set"):(gt(e[d].status===0,"Unexpected transaction status in abort"),e[d].unwatcher(),r=r.concat(sh(n.serverSyncTree_,e[d].currentWriteId,!0)),e[d].onComplete&&i.push(e[d].onComplete.bind(null,new Error("set"),!1,null))));o===-1?FG(t,void 0):e.length=o+1,Ka(n.eventQueue_,Mb(t),r);for(let d=0;d<i.length;d++)v_(i[d])}}function Bde(n){let t="",e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let r=e[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(o){}t+="/"+r}return t}function Vde(n){let t={};n.charAt(0)==="?"&&(n=n.substring(1));for(let e of n.split("&")){if(e.length===0)continue;let i=e.split("=");i.length===2?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Cs(`Invalid query segment '${e}' in query '${n}'`)}return t}var zH=function(n,t){let e=jde(n),i=e.namespace;e.domain==="firebase.com"&&Nu(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&e.domain!=="localhost"&&Nu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||gce();let r=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new KT(e.host,e.secure,i,r,t,"",i!==e.subdomain),path:new ui(e.pathString)}},jde=function(n){let t="",e="",i="",r="",o="",d=!0,m="https",b=443;if(typeof n=="string"){let T=n.indexOf("//");T>=0&&(m=n.substring(0,T-1),n=n.substring(T+2));let A=n.indexOf("/");A===-1&&(A=n.length);let N=n.indexOf("?");N===-1&&(N=n.length),t=n.substring(0,Math.min(A,N)),A<N&&(r=Bde(n.substring(A,N)));let q=Vde(n.substring(Math.min(n.length,N)));T=t.indexOf(":"),T>=0?(d=m==="https"||m==="wss",b=parseInt(t.substring(T+1),10)):T=t.length;let J=t.slice(0,T);if(J.toLowerCase()==="localhost")e="localhost";else if(J.split(".").length<=2)e=J;else{let K=t.indexOf(".");i=t.substring(0,K).toLowerCase(),e=t.substring(K+1),o=i}"ns"in q&&(o=q.ns)}return{host:t,port:b,domain:e,subdomain:i,secure:d,scheme:m,pathString:r,namespace:o}};var UH="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",zde=(function(){let n=0,t=[];return function(e){let i=e===n;n=e;let r,o=new Array(8);for(r=7;r>=0;r--)o[r]=UH.charAt(e%64),e=Math.floor(e/64);gt(e===0,"Cannot push at time == 0");let d=o.join("");if(i){for(r=11;r>=0&&t[r]===63;r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)d+=UH.charAt(t[r]);return gt(d.length===20,"nextPushId: Length should be 20."),d}})();var pS=class{constructor(t,e,i,r){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=r}getPath(){let t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Xr(this.snapshot.exportVal())}},mS=class{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var xb=class{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return gt(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}};var gS=class n{constructor(t,e,i,r){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=r}get key(){return Ln(this._path)?null:oO(this._path)}get ref(){return new Tc(this._repo,this._path)}get _queryIdentifier(){let t=IH(this._queryParams),e=iO(t);return e==="{}"?"default":e}get _queryObject(){return IH(this._queryParams)}isEqual(t){if(t=Ci(t),!(t instanceof n))return!1;let e=this._repo===t._repo,i=sO(this._path,t._path),r=this._queryIdentifier===t._queryIdentifier;return e&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Kce(this._path)}};var Tc=class n extends gS{constructor(t,e){super(t,e,new DN,!1)}get parent(){let t=lG(this._path);return t===null?null:new n(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}},Eb=class n{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){let e=new ui(t),i=y_(this.ref,t);return new n(this._node.getChild(e),i,Dr)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>t(new n(r,y_(this.ref,i),Dr)))}hasChild(t){let e=new ui(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function zt(n,t){return n=Ci(n),n._checkNotDeleted("ref"),t!==void 0?y_(n._root,t):n._root}function y_(n,t){return n=Ci(n),Nn(n._path)===null?Ede("child","path",t,!1):zG("child","path",t,!1),new Tc(n._repo,Sr(n._path,t))}function ba(n,t){n=Ci(n),xO("push",n._path),jG("push",t,n._path,!0);let e=HG(n._repo),i=zde(e),r=y_(n,i),o=y_(n,i),d;return t!=null?d=Mo(o,t).then(()=>o):d=Promise.resolve(o),r.then=d.then.bind(d),r.catch=d.then.bind(d,void 0),r}function Ss(n){return xO("remove",n._path),Mo(n,null)}function Mo(n,t){n=Ci(n),xO("set",n._path),jG("set",t,n._path,!1);let e=new Du;return kde(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function is(n,t){xde("update",t,n._path,!1);let e=new Du;return Rde(n._repo,n._path,t,e.wrapCallback(()=>{})),e.promise}function Ds(n){n=Ci(n);let t=new xb(()=>{}),e=new Cb(t);return Ade(n._repo,n,e).then(i=>new Eb(i,new Tc(n._repo,n._path),n._queryParams.getIndex()))}var Cb=class n{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){let i=e._queryParams.getIndex();return new pS("value",this,new Eb(t.snapshotNode,new Tc(e._repo,e._path),i))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new mS(this,t,e):null}matches(t){return t instanceof n?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},_S=class n{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e=t==="children_added"?"child_added":t;return e=e==="children_removed"?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new mS(this,t,e):null}createEvent(t,e){gt(t.childName!=null,"Child events should have a childName.");let i=y_(new Tc(e._repo,e._path),t.childName),r=e._queryParams.getIndex();return new pS(t.type,this,new Eb(t.snapshotNode,i,r),t.prevName)}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof n?this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Ude(n,t,e,i,r){let o;if(typeof i=="object"&&(o=void 0,r=i),typeof i=="function"&&(o=i),r&&r.onlyOnce){let b=e,T=(A,N)=>{KN(n._repo,n,m),b(A,N)};T.userCallback=e.userCallback,T.context=e.context,e=T}let d=new xb(e,o||void 0),m=t==="value"?new Cb(d):new _S(t,d);return Nde(n._repo,n,m),()=>KN(n._repo,n,m)}function rs(n,t,e,i){return Ude(n,"value",t,e,i)}function dh(n,t,e){let i=null,r=e?new xb(e):null;t==="value"?i=new Cb(r):t&&(i=new _S(t,r)),KN(n._repo,n,i)}var XN=class{};var QN=class extends XN{constructor(t){super(),this._limit=t,this.type="limitToLast"}_apply(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new gS(t._repo,t._path,hue(t._queryParams,this._limit),t._orderByCalled)}};function DO(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new QN(n)}function IO(n,...t){let e=Ci(n);for(let i of t)e=i._apply(e);return e}Wue(Tc);Que(Tc);var $de="FIREBASE_DATABASE_EMULATOR_HOST",JN={},Hde=!1;function Gde(n,t,e,i){n.repoInfo_=new KT(`${t}:${e}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function qde(n,t,e,i,r){let o=i||n.options.databaseURL;o===void 0&&(n.options.projectId||Nu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),$o("Using default host for project ",n.options.projectId),o=`${n.options.projectId}-default-rtdb.firebaseio.com`);let d=zH(o,r),m=d.repoInfo,b,T;typeof process<"u"&&process.env&&(T=process.env[$de]),T?(b=!0,o=`http://${T}?ns=${m.namespace}`,d=zH(o,r),m=d.repoInfo):b=!d.repoInfo.secure;let A=r&&b?new ub(ub.OWNER):new uN(n.name,n.options,t);Cde("Invalid Firebase Database URL",d),Ln(d.path)||Nu("Database URL must point to the root of a Firebase Database (not including a child path).");let N=Zde(m,n,A,new cN(n.name,e));return new eO(N,n)}function Wde(n,t){let e=JN[t];(!e||e[n.key]!==n)&&Nu(`Database ${t}(${n.repoInfo_}) has already been deleted.`),Ode(n),delete e[n.key]}function Zde(n,t,e,i){let r=JN[t.name];r||(r={},JN[t.name]=r);let o=r[n.toURLString()];return o&&Nu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new ZN(n,Hde,e,i),r[n.toURLString()]=o,o}var eO=class{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ide(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Tc(this._repo,Kn())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Wde(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&Nu("Cannot call "+t+" on a deleted database.")}};function KG(n=Mu(),t){let e=qa(n,"database").getImmediate({identifier:t});if(!e._instanceStarted){let i=vT("database");i&&Kde(e,...i)}return e}function Kde(n,t,e,i={}){n=Ci(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Nu("Cannot call useEmulator() after instance has already been initialized.");let r=n._repoInternal,o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Nu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ub(ub.OWNER);else if(i.mockUserToken){let d=typeof i.mockUserToken=="string"?i.mockUserToken:bT(i.mockUserToken,n.app.options.projectId);o=new ub(d)}Gde(r,t,e,o)}function Yde(n){fce(bc),ns(new Qr("database",(t,{instanceIdentifier:e})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return qde(i,r,o,e)},"PUBLIC").setMultipleInstances(!0)),Jr(dH,hH,n),Jr(dH,hH,"esm2017")}aO.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)};aO.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)};Yde();var nq="firebasestorage.googleapis.com",iq="storageBucket",Xde=120*1e3,Qde=600*1e3;var Ir=class n extends xs{constructor(t,e,i=0){super(MO(t),`Firebase Storage: ${e} (${MO(t)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,n.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return MO(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},jr=(function(n){return n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment",n})(jr||{});function MO(n){return"storage/"+n}function OO(){let n="An unknown error occurred, please check the error payload for server response.";return new Ir(jr.UNKNOWN,n)}function Jde(n){return new Ir(jr.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function ehe(n){return new Ir(jr.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function the(){let n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Ir(jr.UNAUTHENTICATED,n)}function nhe(){return new Ir(jr.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function ihe(n){return new Ir(jr.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function rhe(){return new Ir(jr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function ohe(){return new Ir(jr.CANCELED,"User canceled the upload/download.")}function she(n){return new Ir(jr.INVALID_URL,"Invalid URL '"+n+"'.")}function ahe(n){return new Ir(jr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function lhe(){return new Ir(jr.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+iq+"' property when initializing the app?")}function che(){return new Ir(jr.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function uhe(){return new Ir(jr.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function dhe(n){return new Ir(jr.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function AO(n){return new Ir(jr.INVALID_ARGUMENT,n)}function rq(){return new Ir(jr.APP_DELETED,"The Firebase app was deleted.")}function hhe(n){return new Ir(jr.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Rb(n,t){return new Ir(jr.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function kb(n){throw new Ir(jr.INTERNAL_ERROR,"Internal error: "+n)}var Nl=class n{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let i;try{i=n.makeFromUrl(t,e)}catch(r){return new n(t,"")}if(i.path==="")return i;throw ahe(t)}static makeFromUrl(t,e){let i=null,r="([A-Za-z0-9.\\-_]+)";function o(Ue){Ue.path.charAt(Ue.path.length-1)==="/"&&(Ue.path_=Ue.path_.slice(0,-1))}let d="(/(.*))?$",m=new RegExp("^gs://"+r+d,"i"),b={bucket:1,path:3};function T(Ue){Ue.path_=decodeURIComponent(Ue.path)}let A="v[A-Za-z0-9_]+",N=e.replace(/[.]/g,"\\."),q="(/([^?#]*).*)?$",J=new RegExp(`^https?://${N}/${A}/b/${r}/o${q}`,"i"),K={bucket:1,path:3},xe=e===nq?"(?:storage.googleapis.com|storage.cloud.google.com)":e,Te="([^?#]*)",Ge=new RegExp(`^https?://${xe}/${r}/${Te}`,"i"),kt=[{regex:m,indices:b,postModify:o},{regex:J,indices:K,postModify:T},{regex:Ge,indices:{bucket:1,path:2},postModify:T}];for(let Ue=0;Ue<kt.length;Ue++){let Oe=kt[Ue],Qe=Oe.regex.exec(t);if(Qe){let ct=Qe[Oe.indices.bucket],bt=Qe[Oe.indices.path];bt||(bt=""),i=new n(ct,bt),Oe.postModify(i);break}}if(i==null)throw she(t);return i}},kO=class{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}};function fhe(n,t,e){let i=1,r=null,o=null,d=!1,m=0;function b(){return m===2}let T=!1;function A(...Te){T||(T=!0,t.apply(null,Te))}function N(Te){r=setTimeout(()=>{r=null,n(J,b())},Te)}function q(){o&&clearTimeout(o)}function J(Te,...Ge){if(T){q();return}if(Te){q(),A.call(null,Te,...Ge);return}if(b()||d){q(),A.call(null,Te,...Ge);return}i<64&&(i*=2);let kt;m===1?(m=2,kt=0):kt=(i+Math.random())*1e3,N(kt)}let K=!1;function xe(Te){K||(K=!0,q(),!T&&(r!==null?(Te||(m=2),clearTimeout(r),N(0)):Te||(m=1)))}return N(0),o=setTimeout(()=>{d=!0,xe(!0)},e),xe}function phe(n){n(!1)}function mhe(n){return n!==void 0}function ghe(n){return typeof n=="object"&&!Array.isArray(n)}function FO(n){return typeof n=="string"||n instanceof String}function YG(n){return LO()&&n instanceof Blob}function LO(){return typeof Blob<"u"}function XG(n,t,e,i){if(i<t)throw AO(`Invalid value for '${n}'. Expected ${t} or greater.`);if(i>e)throw AO(`Invalid value for '${n}'. Expected ${e} or less.`)}function AS(n,t,e){let i=t;return e==null&&(i=`https://${t}`),`${e}://${i}/v0${n}`}function oq(n){let t=encodeURIComponent,e="?";for(let i in n)if(n.hasOwnProperty(i)){let r=t(i)+"="+t(n[i]);e=e+r+"&"}return e=e.slice(0,-1),e}var E_=(function(n){return n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT",n})(E_||{});function _he(n,t){let e=n>=500&&n<600,r=[408,429].indexOf(n)!==-1,o=t.indexOf(n)!==-1;return e||r||o}var RO=class{constructor(t,e,i,r,o,d,m,b,T,A,N,q=!0){this.url_=t,this.method_=e,this.headers_=i,this.body_=r,this.successCodes_=o,this.additionalRetryCodes_=d,this.callback_=m,this.errorCallback_=b,this.timeout_=T,this.progressCallback_=A,this.connectionFactory_=N,this.retry=q,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((J,K)=>{this.resolve_=J,this.reject_=K,this.start_()})}start_(){let t=(i,r)=>{if(r){i(!1,new x_(!1,null,!0));return}let o=this.connectionFactory_();this.pendingConnection_=o;let d=m=>{let b=m.loaded,T=m.lengthComputable?m.total:-1;this.progressCallback_!==null&&this.progressCallback_(b,T)};this.progressCallback_!==null&&o.addUploadProgressListener(d),o.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&o.removeUploadProgressListener(d),this.pendingConnection_=null;let m=o.getErrorCode()===E_.NO_ERROR,b=o.getStatus();if(!m||_he(b,this.additionalRetryCodes_)&&this.retry){let A=o.getErrorCode()===E_.ABORT;i(!1,new x_(!1,null,A));return}let T=this.successCodes_.indexOf(b)!==-1;i(!0,new x_(T,o))})},e=(i,r)=>{let o=this.resolve_,d=this.reject_,m=r.connection;if(r.wasSuccessCode)try{let b=this.callback_(m,m.getResponse());mhe(b)?o(b):o()}catch(b){d(b)}else if(m!==null){let b=OO();b.serverResponse=m.getErrorText(),this.errorCallback_?d(this.errorCallback_(m,b)):d(b)}else if(r.canceled){let b=this.appDelete_?rq():ohe();d(b)}else{let b=rhe();d(b)}};this.canceled_?e(!1,new x_(!1,null,!0)):this.backoffId_=fhe(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&phe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},x_=class{constructor(t,e,i){this.wasSuccessCode=t,this.connection=e,this.canceled=!!i}};function yhe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function vhe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function bhe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function whe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function xhe(n,t,e,i,r,o,d=!0){let m=oq(n.urlParams),b=n.url+m,T=Object.assign({},n.headers);return bhe(T,t),yhe(T,e),vhe(T,o),whe(T,i),new RO(b,n.method,T,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,r,d)}function Ehe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Che(...n){let t=Ehe();if(t!==void 0){let e=new t;for(let i=0;i<n.length;i++)e.append(n[i]);return e.getBlob()}else{if(LO())return new Blob(n);throw new Ir(jr.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function The(n,t,e){return n.webkitSlice?n.webkitSlice(t,e):n.mozSlice?n.mozSlice(t,e):n.slice?n.slice(t,e):null}function She(n){if(typeof atob>"u")throw dhe("base-64");return atob(n)}var Sc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},Pb=class{constructor(t,e){this.data=t,this.contentType=e||null}};function Dhe(n,t){switch(n){case Sc.RAW:return new Pb(sq(t));case Sc.BASE64:case Sc.BASE64URL:return new Pb(aq(n,t));case Sc.DATA_URL:return new Pb(Mhe(t),Ahe(t))}throw OO()}function sq(n){let t=[];for(let e=0;e<n.length;e++){let i=n.charCodeAt(e);if(i<=127)t.push(i);else if(i<=2047)t.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(e<n.length-1&&(n.charCodeAt(e+1)&64512)===56320))t.push(239,191,189);else{let o=i,d=n.charCodeAt(++e);i=65536|(o&1023)<<10|d&1023,t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(t)}function Ihe(n){let t;try{t=decodeURIComponent(n)}catch(e){throw Rb(Sc.DATA_URL,"Malformed data URL.")}return sq(t)}function aq(n,t){switch(n){case Sc.BASE64:{let r=t.indexOf("-")!==-1,o=t.indexOf("_")!==-1;if(r||o)throw Rb(n,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?");break}case Sc.BASE64URL:{let r=t.indexOf("+")!==-1,o=t.indexOf("/")!==-1;if(r||o)throw Rb(n,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let e;try{e=She(t)}catch(r){throw r.message.includes("polyfill")?r:Rb(n,"Invalid character found")}let i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i}var IS=class{constructor(t){this.base64=!1,this.contentType=null;let e=t.match(/^data:([^,]+)?,/);if(e===null)throw Rb(Sc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let i=e[1]||null;i!=null&&(this.base64=khe(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=t.substring(t.indexOf(",")+1)}};function Mhe(n){let t=new IS(n);return t.base64?aq(Sc.BASE64,t.rest):Ihe(t.rest)}function Ahe(n){return new IS(n).contentType}function khe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}var MS=class n{constructor(t,e){let i=0,r="";YG(t)?(this.data_=t,i=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),i=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),i=t.length),this.size_=i,this.type_=r}size(){return this.size_}type(){return this.type_}slice(t,e){if(YG(this.data_)){let i=this.data_,r=The(i,t,e);return r===null?null:new n(r)}else{let i=new Uint8Array(this.data_.buffer,t,e-t);return new n(i,!0)}}static getBlob(...t){if(LO()){let e=t.map(i=>i instanceof n?i.data_:i);return new n(Che.apply(null,e))}else{let e=t.map(d=>FO(d)?Dhe(Sc.RAW,d).data:d.data_),i=0;e.forEach(d=>{i+=d.byteLength});let r=new Uint8Array(i),o=0;return e.forEach(d=>{for(let m=0;m<d.length;m++)r[o++]=d[m]}),new n(r,!0)}}uploadData(){return this.data_}};function lq(n){let t;try{t=JSON.parse(n)}catch(e){return null}return ghe(t)?t:null}function Rhe(n){if(n.length===0)return null;let t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function Phe(n,t){let e=t.split("/").filter(i=>i.length>0).join("/");return n.length===0?e:n+"/"+e}function cq(n){let t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}function Nhe(n,t){return t}var Go=class{constructor(t,e,i,r){this.server=t,this.local=e||t,this.writable=!!i,this.xform=r||Nhe}},DS=null;function Ohe(n){return!FO(n)||n.length<2?n:cq(n)}function uq(){if(DS)return DS;let n=[];n.push(new Go("bucket")),n.push(new Go("generation")),n.push(new Go("metageneration")),n.push(new Go("name","fullPath",!0));function t(o,d){return Ohe(d)}let e=new Go("name");e.xform=t,n.push(e);function i(o,d){return d!==void 0?Number(d):d}let r=new Go("size");return r.xform=i,n.push(r),n.push(new Go("timeCreated")),n.push(new Go("updated")),n.push(new Go("md5Hash",null,!0)),n.push(new Go("cacheControl",null,!0)),n.push(new Go("contentDisposition",null,!0)),n.push(new Go("contentEncoding",null,!0)),n.push(new Go("contentLanguage",null,!0)),n.push(new Go("contentType",null,!0)),n.push(new Go("metadata","customMetadata",!0)),DS=n,DS}function Fhe(n,t){function e(){let i=n.bucket,r=n.fullPath,o=new Nl(i,r);return t._makeStorageReference(o)}Object.defineProperty(n,"ref",{get:e})}function Lhe(n,t,e){let i={};i.type="file";let r=e.length;for(let o=0;o<r;o++){let d=e[o];i[d.local]=d.xform(i,t[d.server])}return Fhe(i,n),i}function dq(n,t,e){let i=lq(t);return i===null?null:Lhe(n,i,e)}function Bhe(n,t,e,i){let r=lq(t);if(r===null||!FO(r.downloadTokens))return null;let o=r.downloadTokens;if(o.length===0)return null;let d=encodeURIComponent;return o.split(",").map(T=>{let A=n.bucket,N=n.fullPath,q="/b/"+d(A)+"/o/"+d(N),J=AS(q,e,i),K=oq({alt:"media",token:T});return J+K})[0]}function Vhe(n,t){let e={},i=t.length;for(let r=0;r<i;r++){let o=t[r];o.writable&&(e[o.server]=n[o.local])}return JSON.stringify(e)}var Nb=class{constructor(t,e,i,r){this.url=t,this.method=e,this.handler=i,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function hq(n){if(!n)throw OO()}function jhe(n,t){function e(i,r){let o=dq(n,r,t);return hq(o!==null),o}return e}function zhe(n,t){function e(i,r){let o=dq(n,r,t);return hq(o!==null),Bhe(o,r,n.host,n._protocol)}return e}function fq(n){function t(e,i){let r;return e.getStatus()===401?e.getErrorText().includes("Firebase App Check token is invalid")?r=nhe():r=the():e.getStatus()===402?r=ehe(n.bucket):e.getStatus()===403?r=ihe(n.path):r=i,r.status=e.getStatus(),r.serverResponse=i.serverResponse,r}return t}function pq(n){let t=fq(n);function e(i,r){let o=t(i,r);return i.getStatus()===404&&(o=Jde(n.path)),o.serverResponse=r.serverResponse,o}return e}function Uhe(n,t,e){let i=t.fullServerUrl(),r=AS(i,n.host,n._protocol),o="GET",d=n.maxOperationRetryTime,m=new Nb(r,o,zhe(n,e),d);return m.errorHandler=pq(t),m}function $he(n,t){let e=t.fullServerUrl(),i=AS(e,n.host,n._protocol),r="DELETE",o=n.maxOperationRetryTime;function d(b,T){}let m=new Nb(i,r,d,o);return m.successCodes=[200,204],m.errorHandler=pq(t),m}function Hhe(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function Ghe(n,t,e){let i=Object.assign({},e);return i.fullPath=n.path,i.size=t.size(),i.contentType||(i.contentType=Hhe(null,t)),i}function qhe(n,t,e,i,r){let o=t.bucketOnlyServerUrl(),d={"X-Goog-Upload-Protocol":"multipart"};function m(){let kt="";for(let Ue=0;Ue<2;Ue++)kt=kt+Math.random().toString().slice(2);return kt}let b=m();d["Content-Type"]="multipart/related; boundary="+b;let T=Ghe(t,i,r),A=Vhe(T,e),N="--"+b+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+A+`\r
--`+b+`\r
Content-Type: `+T.contentType+`\r
\r
`,q=`\r
--`+b+"--",J=MS.getBlob(N,i,q);if(J===null)throw che();let K={name:T.fullPath},xe=AS(o,n.host,n._protocol),Te="POST",Ge=n.maxUploadRetryTime,Et=new Nb(xe,Te,jhe(n,e),Ge);return Et.urlParams=K,Et.headers=d,Et.body=J.uploadData(),Et.errorHandler=fq(t),Et}var Sje=256*1024;var QG=null,PO=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=E_.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=E_.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=E_.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,e,i,r){if(this.sent_)throw kb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),r!==void 0)for(let o in r)r.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,r[o].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw kb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw kb("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw kb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw kb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}},NO=class extends PO{initXhr(){this.xhr_.responseType="text"}};function BO(){return QG?QG():new NO}var C_=class n{constructor(t,e){this._service=t,e instanceof Nl?this._location=e:this._location=Nl.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new n(t,e)}get root(){let t=new Nl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return cq(this._location.path)}get storage(){return this._service}get parent(){let t=Rhe(this._location.path);if(t===null)return null;let e=new Nl(this._location.bucket,t);return new n(this._service,e)}_throwIfRoot(t){if(this._location.path==="")throw hhe(t)}};function Whe(n,t,e){n._throwIfRoot("uploadBytes");let i=qhe(n.storage,n._location,uq(),new MS(t,!0),e);return n.storage.makeRequestWithTokens(i,BO).then(r=>({metadata:r,ref:n}))}function Zhe(n){n._throwIfRoot("getDownloadURL");let t=Uhe(n.storage,n._location,uq());return n.storage.makeRequestWithTokens(t,BO).then(e=>{if(e===null)throw uhe();return e})}function Khe(n){n._throwIfRoot("deleteObject");let t=$he(n.storage,n._location);return n.storage.makeRequestWithTokens(t,BO)}function Yhe(n,t){let e=Phe(n._location.path,t),i=new Nl(n._location.bucket,e);return new C_(n.storage,i)}function Xhe(n){return/^[A-Za-z]+:\/\//.test(n)}function Qhe(n,t){return new C_(n,t)}function mq(n,t){if(n instanceof Ob){let e=n;if(e._bucket==null)throw lhe();let i=new C_(e,e._bucket);return t!=null?mq(i,t):i}else return t!==void 0?Yhe(n,t):n}function Jhe(n,t){if(t&&Xhe(t)){if(n instanceof Ob)return Qhe(n,t);throw AO("To use ref(service, url), the first argument must be a Storage instance.")}else return mq(n,t)}function JG(n,t){let e=t?.[iq];return e==null?null:Nl.makeFromBucketSpec(e,n)}function efe(n,t,e,i={}){n.host=`${t}:${e}`,n._protocol="http";let{mockUserToken:r}=i;r&&(n._overrideAuthToken=typeof r=="string"?r:bT(r,n.app.options.projectId))}var Ob=class{constructor(t,e,i,r,o){this.app=t,this._authProvider=e,this._appCheckProvider=i,this._url=r,this._firebaseVersion=o,this._bucket=null,this._host=nq,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Xde,this._maxUploadRetryTime=Qde,this._requests=new Set,r!=null?this._bucket=Nl.makeFromBucketSpec(r,this._host):this._bucket=JG(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Nl.makeFromBucketSpec(this._url,t):this._bucket=JG(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){XG("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){XG("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return ae(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let t=this._authProvider.getImmediate({optional:!0});if(t){let e=yield t.getToken();if(e!==null)return e.accessToken}return null})}_getAppCheckToken(){return ae(this,null,function*(){let t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new C_(this,t)}_makeRequest(t,e,i,r,o=!0){if(this._deleted)return new kO(rq());{let d=xhe(t,this._appId,i,r,e,this._firebaseVersion,o);return this._requests.add(d),d.getPromise().then(()=>this._requests.delete(d),()=>this._requests.delete(d)),d}}makeRequestWithTokens(t,e){return ae(this,null,function*(){let[i,r]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,i,r).getPromise()})}},eq="@firebase/storage",tq="0.13.2";var gq="storage";function T_(n,t,e){return n=Ci(n),Whe(n,t,e)}function S_(n){return n=Ci(n),Zhe(n)}function kS(n){return n=Ci(n),Khe(n)}function hh(n,t){return n=Ci(n),Jhe(n,t)}function _q(n=Mu(),t){n=Ci(n);let i=qa(n,gq).getImmediate({identifier:t}),r=vT("storage");return r&&tfe(i,...r),i}function tfe(n,t,e,i={}){efe(n,t,e,i)}function nfe(n,{instanceIdentifier:t}){let e=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),r=n.getProvider("app-check-internal");return new Ob(e,i,r,t,bc)}function ife(){ns(new Qr(gq,nfe,"PUBLIC").setMultipleInstances(!0)),Jr(eq,tq,""),Jr(eq,tq,"esm2017")}ife();var bq="@firebase/installations",UO="0.6.9";var wq=1e4,xq=`w:${UO}`,Eq="FIS_v2",rfe="https://firebaseinstallations.googleapis.com/v1",ofe=3600*1e3,sfe="installations",afe="Installations";var lfe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ap=new va(sfe,afe,lfe);function Cq(n){return n instanceof xs&&n.code.includes("request-failed")}function Tq({projectId:n}){return`${rfe}/projects/${n}/installations`}function Sq(n){return{token:n.token,requestStatus:2,expiresIn:ufe(n.expiresIn),creationTime:Date.now()}}function Dq(n,t){return ae(this,null,function*(){let i=(yield t.json()).error;return Ap.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})})}function Iq({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function cfe(n,{refreshToken:t}){let e=Iq(n);return e.append("Authorization",dfe(t)),e}function Mq(n){return ae(this,null,function*(){let t=yield n();return t.status>=500&&t.status<600?n():t})}function ufe(n){return Number(n.replace("s","000"))}function dfe(n){return`${Eq} ${n}`}function hfe(i,r){return ae(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},{fid:e}){let o=Tq(n),d=Iq(n),m=t.getImmediate({optional:!0});if(m){let N=yield m.getHeartbeatsHeader();N&&d.append("x-firebase-client",N)}let b={fid:e,authVersion:Eq,appId:n.appId,sdkVersion:xq},T={method:"POST",headers:d,body:JSON.stringify(b)},A=yield Mq(()=>fetch(o,T));if(A.ok){let N=yield A.json();return{fid:N.fid||e,registrationStatus:2,refreshToken:N.refreshToken,authToken:Sq(N.authToken)}}else throw yield Dq("Create Installation",A)})}function Aq(n){return new Promise(t=>{setTimeout(t,n)})}function ffe(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}var pfe=/^[cdef][\w-]{21}$/,zO="";function mfe(){try{let n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;let e=gfe(n);return pfe.test(e)?e:zO}catch(n){return zO}}function gfe(n){return ffe(n).substr(0,22)}function PS(n){return`${n.appName}!${n.appId}`}var kq=new Map;function Rq(n,t){let e=PS(n);Pq(e,t),_fe(e,t)}function Pq(n,t){let e=kq.get(n);if(e)for(let i of e)i(t)}function _fe(n,t){let e=yfe();e&&e.postMessage({key:n,fid:t}),vfe()}var Mp=null;function yfe(){return!Mp&&"BroadcastChannel"in self&&(Mp=new BroadcastChannel("[Firebase] FID Change"),Mp.onmessage=n=>{Pq(n.data.key,n.data.fid)}),Mp}function vfe(){kq.size===0&&Mp&&(Mp.close(),Mp=null)}var bfe="firebase-installations-database",wfe=1,kp="firebase-installations-store",VO=null;function $O(){return VO||(VO=vp(bfe,wfe,{upgrade:(n,t)=>{t===0&&n.createObjectStore(kp)}})),VO}function RS(n,t){return ae(this,null,function*(){let e=PS(n),r=(yield $O()).transaction(kp,"readwrite"),o=r.objectStore(kp),d=yield o.get(e);return yield o.put(t,e),yield r.done,(!d||d.fid!==t.fid)&&Rq(n,t.fid),t})}function Nq(n){return ae(this,null,function*(){let t=PS(n),i=(yield $O()).transaction(kp,"readwrite");yield i.objectStore(kp).delete(t),yield i.done})}function NS(n,t){return ae(this,null,function*(){let e=PS(n),r=(yield $O()).transaction(kp,"readwrite"),o=r.objectStore(kp),d=yield o.get(e),m=t(d);return m===void 0?yield o.delete(e):yield o.put(m,e),yield r.done,m&&(!d||d.fid!==m.fid)&&Rq(n,m.fid),m})}function HO(n){return ae(this,null,function*(){let t,e=yield NS(n.appConfig,i=>{let r=xfe(i),o=Efe(n,r);return t=o.registrationPromise,o.installationEntry});return e.fid===zO?{installationEntry:yield t}:{installationEntry:e,registrationPromise:t}})}function xfe(n){let t=n||{fid:mfe(),registrationStatus:0};return Oq(t)}function Efe(n,t){if(t.registrationStatus===0){if(!navigator.onLine){let r=Promise.reject(Ap.create("app-offline"));return{installationEntry:t,registrationPromise:r}}let e={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=Cfe(n,e);return{installationEntry:e,registrationPromise:i}}else return t.registrationStatus===1?{installationEntry:t,registrationPromise:Tfe(n)}:{installationEntry:t}}function Cfe(n,t){return ae(this,null,function*(){try{let e=yield hfe(n,t);return RS(n.appConfig,e)}catch(e){throw Cq(e)&&e.customData.serverCode===409?yield Nq(n.appConfig):yield RS(n.appConfig,{fid:t.fid,registrationStatus:0}),e}})}function Tfe(n){return ae(this,null,function*(){let t=yield yq(n.appConfig);for(;t.registrationStatus===1;)yield Aq(100),t=yield yq(n.appConfig);if(t.registrationStatus===0){let{installationEntry:e,registrationPromise:i}=yield HO(n);return i||e}return t})}function yq(n){return NS(n,t=>{if(!t)throw Ap.create("installation-not-found");return Oq(t)})}function Oq(n){return Sfe(n)?{fid:n.fid,registrationStatus:0}:n}function Sfe(n){return n.registrationStatus===1&&n.registrationTime+wq<Date.now()}function Dfe(i,r){return ae(this,arguments,function*({appConfig:n,heartbeatServiceProvider:t},e){let o=Ife(n,e),d=cfe(n,e),m=t.getImmediate({optional:!0});if(m){let N=yield m.getHeartbeatsHeader();N&&d.append("x-firebase-client",N)}let b={installation:{sdkVersion:xq,appId:n.appId}},T={method:"POST",headers:d,body:JSON.stringify(b)},A=yield Mq(()=>fetch(o,T));if(A.ok){let N=yield A.json();return Sq(N)}else throw yield Dq("Generate Auth Token",A)})}function Ife(n,{fid:t}){return`${Tq(n)}/${t}/authTokens:generate`}function GO(n,t=!1){return ae(this,null,function*(){let e,i=yield NS(n.appConfig,o=>{if(!Fq(o))throw Ap.create("not-registered");let d=o.authToken;if(!t&&kfe(d))return o;if(d.requestStatus===1)return e=Mfe(n,t),o;{if(!navigator.onLine)throw Ap.create("app-offline");let m=Pfe(o);return e=Afe(n,m),m}});return e?yield e:i.authToken})}function Mfe(n,t){return ae(this,null,function*(){let e=yield vq(n.appConfig);for(;e.authToken.requestStatus===1;)yield Aq(100),e=yield vq(n.appConfig);let i=e.authToken;return i.requestStatus===0?GO(n,t):i})}function vq(n){return NS(n,t=>{if(!Fq(t))throw Ap.create("not-registered");let e=t.authToken;return Nfe(e)?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}function Afe(n,t){return ae(this,null,function*(){try{let e=yield Dfe(n,t),i=Object.assign(Object.assign({},t),{authToken:e});return yield RS(n.appConfig,i),e}catch(e){if(Cq(e)&&(e.customData.serverCode===401||e.customData.serverCode===404))yield Nq(n.appConfig);else{let i=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});yield RS(n.appConfig,i)}throw e}})}function Fq(n){return n!==void 0&&n.registrationStatus===2}function kfe(n){return n.requestStatus===2&&!Rfe(n)}function Rfe(n){let t=Date.now();return t<n.creationTime||n.creationTime+n.expiresIn<t+ofe}function Pfe(n){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:t})}function Nfe(n){return n.requestStatus===1&&n.requestTime+wq<Date.now()}function Ofe(n){return ae(this,null,function*(){let t=n,{installationEntry:e,registrationPromise:i}=yield HO(t);return i?i.catch(console.error):GO(t).catch(console.error),e.fid})}function Ffe(n,t=!1){return ae(this,null,function*(){let e=n;return yield Lfe(e),(yield GO(e,t)).token})}function Lfe(n){return ae(this,null,function*(){let{registrationPromise:t}=yield HO(n);t&&(yield t)})}function Bfe(n){if(!n||!n.options)throw jO("App Configuration");if(!n.name)throw jO("App Name");let t=["projectId","apiKey","appId"];for(let e of t)if(!n.options[e])throw jO(e);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function jO(n){return Ap.create("missing-app-config-values",{valueName:n})}var Lq="installations",Vfe="installations-internal",jfe=n=>{let t=n.getProvider("app").getImmediate(),e=Bfe(t),i=qa(t,"heartbeat");return{app:t,appConfig:e,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},zfe=n=>{let t=n.getProvider("app").getImmediate(),e=qa(t,Lq).getImmediate();return{getId:()=>Ofe(e),getToken:r=>Ffe(e,r)}};function Ufe(){ns(new Qr(Lq,jfe,"PUBLIC")),ns(new Qr(Vfe,zfe,"PRIVATE"))}Ufe();Jr(bq,UO);Jr(bq,UO,"esm2017");var $fe="/firebase-messaging-sw.js",Hfe="/firebase-cloud-messaging-push-scope",$q="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Gfe="https://fcmregistrations.googleapis.com/v1",Hq="google.c.a.c_id",qfe="google.c.a.c_l",Wfe="google.c.a.ts",Zfe="google.c.a.e";var OS=(function(n){return n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked",n})(OS||{});function Ou(n){let t=new Uint8Array(n);return btoa(String.fromCharCode(...t)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Kfe(n){let t="=".repeat((4-n.length%4)%4),e=(n+t).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(e),r=new Uint8Array(i.length);for(let o=0;o<i.length;++o)r[o]=i.charCodeAt(o);return r}var qO="fcm_token_details_db",Yfe=5,Bq="fcm_token_object_Store";function Xfe(n){return ae(this,null,function*(){if("databases"in indexedDB&&!(yield indexedDB.databases()).map(o=>o.name).includes(qO))return null;let t=null;return(yield vp(qO,Yfe,{upgrade:(i,r,o,d)=>ae(null,null,function*(){var m;if(r<2||!i.objectStoreNames.contains(Bq))return;let b=d.objectStore(Bq),T=yield b.index("fcmSenderId").get(n);if(yield b.clear(),!!T){if(r===2){let A=T;if(!A.auth||!A.p256dh||!A.endpoint)return;t={token:A.fcmToken,createTime:(m=A.createTime)!==null&&m!==void 0?m:Date.now(),subscriptionOptions:{auth:A.auth,p256dh:A.p256dh,endpoint:A.endpoint,swScope:A.swScope,vapidKey:typeof A.vapidKey=="string"?A.vapidKey:Ou(A.vapidKey)}}}else if(r===3){let A=T;t={token:A.fcmToken,createTime:A.createTime,subscriptionOptions:{auth:Ou(A.auth),p256dh:Ou(A.p256dh),endpoint:A.endpoint,swScope:A.swScope,vapidKey:Ou(A.vapidKey)}}}else if(r===4){let A=T;t={token:A.fcmToken,createTime:A.createTime,subscriptionOptions:{auth:Ou(A.auth),p256dh:Ou(A.p256dh),endpoint:A.endpoint,swScope:A.swScope,vapidKey:Ou(A.vapidKey)}}}}})})).close(),yield ST(qO),yield ST("fcm_vapid_details_db"),yield ST("undefined"),Qfe(t)?t:null})}function Qfe(n){if(!n||!n.subscriptionOptions)return!1;let{subscriptionOptions:t}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof t.auth=="string"&&t.auth.length>0&&typeof t.p256dh=="string"&&t.p256dh.length>0&&typeof t.endpoint=="string"&&t.endpoint.length>0&&typeof t.swScope=="string"&&t.swScope.length>0&&typeof t.vapidKey=="string"&&t.vapidKey.length>0}var Jfe="firebase-messaging-database",epe=1,Fb="firebase-messaging-store",WO=null;function Gq(){return WO||(WO=vp(Jfe,epe,{upgrade:(n,t)=>{t===0&&n.createObjectStore(Fb)}})),WO}function tpe(n){return ae(this,null,function*(){let t=qq(n),i=yield(yield Gq()).transaction(Fb).objectStore(Fb).get(t);if(i)return i;{let r=yield Xfe(n.appConfig.senderId);if(r)return yield YO(n,r),r}})}function YO(n,t){return ae(this,null,function*(){let e=qq(n),r=(yield Gq()).transaction(Fb,"readwrite");return yield r.objectStore(Fb).put(t,e),yield r.done,t})}function qq({appConfig:n}){return n.appId}var npe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},os=new va("messaging","Messaging",npe);function ipe(n,t){return ae(this,null,function*(){let e=yield QO(n),i=Wq(t),r={method:"POST",headers:e,body:JSON.stringify(i)},o;try{o=yield(yield fetch(XO(n.appConfig),r)).json()}catch(d){throw os.create("token-subscribe-failed",{errorInfo:d?.toString()})}if(o.error){let d=o.error.message;throw os.create("token-subscribe-failed",{errorInfo:d})}if(!o.token)throw os.create("token-subscribe-no-token");return o.token})}function rpe(n,t){return ae(this,null,function*(){let e=yield QO(n),i=Wq(t.subscriptionOptions),r={method:"PATCH",headers:e,body:JSON.stringify(i)},o;try{o=yield(yield fetch(`${XO(n.appConfig)}/${t.token}`,r)).json()}catch(d){throw os.create("token-update-failed",{errorInfo:d?.toString()})}if(o.error){let d=o.error.message;throw os.create("token-update-failed",{errorInfo:d})}if(!o.token)throw os.create("token-update-no-token");return o.token})}function ope(n,t){return ae(this,null,function*(){let i={method:"DELETE",headers:yield QO(n)};try{let o=yield(yield fetch(`${XO(n.appConfig)}/${t}`,i)).json();if(o.error){let d=o.error.message;throw os.create("token-unsubscribe-failed",{errorInfo:d})}}catch(r){throw os.create("token-unsubscribe-failed",{errorInfo:r?.toString()})}})}function XO({projectId:n}){return`${Gfe}/projects/${n}/registrations`}function QO(e){return ae(this,arguments,function*({appConfig:n,installations:t}){let i=yield t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${i}`})})}function Wq({p256dh:n,auth:t,endpoint:e,vapidKey:i}){let r={web:{endpoint:e,auth:t,p256dh:n}};return i!==$q&&(r.web.applicationPubKey=i),r}var spe=10080*60*1e3;function ape(n){return ae(this,null,function*(){let t=yield cpe(n.swRegistration,n.vapidKey),e={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:t.endpoint,auth:Ou(t.getKey("auth")),p256dh:Ou(t.getKey("p256dh"))},i=yield tpe(n.firebaseDependencies);if(i){if(upe(i.subscriptionOptions,e))return Date.now()>=i.createTime+spe?lpe(n,{token:i.token,createTime:Date.now(),subscriptionOptions:e}):i.token;try{yield ope(n.firebaseDependencies,i.token)}catch(r){console.warn(r)}return Vq(n.firebaseDependencies,e)}else return Vq(n.firebaseDependencies,e)})}function lpe(n,t){return ae(this,null,function*(){try{let e=yield rpe(n.firebaseDependencies,t),i=Object.assign(Object.assign({},t),{token:e,createTime:Date.now()});return yield YO(n.firebaseDependencies,i),e}catch(e){throw e}})}function Vq(n,t){return ae(this,null,function*(){let i={token:yield ipe(n,t),createTime:Date.now(),subscriptionOptions:t};return yield YO(n,i),i.token})}function cpe(n,t){return ae(this,null,function*(){let e=yield n.pushManager.getSubscription();return e||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Kfe(t)})})}function upe(n,t){let e=t.vapidKey===n.vapidKey,i=t.endpoint===n.endpoint,r=t.auth===n.auth,o=t.p256dh===n.p256dh;return e&&i&&r&&o}function jq(n){let t={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return dpe(t,n),hpe(t,n),fpe(t,n),t}function dpe(n,t){if(!t.notification)return;n.notification={};let e=t.notification.title;e&&(n.notification.title=e);let i=t.notification.body;i&&(n.notification.body=i);let r=t.notification.image;r&&(n.notification.image=r);let o=t.notification.icon;o&&(n.notification.icon=o)}function hpe(n,t){t.data&&(n.data=t.data)}function fpe(n,t){var e,i,r,o,d;if(!t.fcmOptions&&!(!((e=t.notification)===null||e===void 0)&&e.click_action))return;n.fcmOptions={};let m=(r=(i=t.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&r!==void 0?r:(o=t.notification)===null||o===void 0?void 0:o.click_action;m&&(n.fcmOptions.link=m);let b=(d=t.fcmOptions)===null||d===void 0?void 0:d.analytics_label;b&&(n.fcmOptions.analyticsLabel=b)}function ppe(n){return typeof n=="object"&&!!n&&Hq in n}mpe("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function mpe(n,t){let e=[];for(let i=0;i<n.length;i++)e.push(n.charAt(i)),i<t.length&&e.push(t.charAt(i));return e.join("")}function gpe(n){if(!n||!n.options)throw ZO("App Configuration Object");if(!n.name)throw ZO("App Name");let t=["projectId","apiKey","appId","messagingSenderId"],{options:e}=n;for(let i of t)if(!e[i])throw ZO(i);return{appName:n.name,projectId:e.projectId,apiKey:e.apiKey,appId:e.appId,senderId:e.messagingSenderId}}function ZO(n){return os.create("missing-app-config-values",{valueName:n})}var KO=class{constructor(t,e,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;let r=gpe(t);this.firebaseDependencies={app:t,appConfig:r,installations:e,analyticsProvider:i}}_delete(){return Promise.resolve()}};function _pe(n){return ae(this,null,function*(){try{n.swRegistration=yield navigator.serviceWorker.register($fe,{scope:Hfe}),n.swRegistration.update().catch(()=>{})}catch(t){throw os.create("failed-service-worker-registration",{browserErrorMessage:t?.message})}})}function ype(n,t){return ae(this,null,function*(){if(!t&&!n.swRegistration&&(yield _pe(n)),!(!t&&n.swRegistration)){if(!(t instanceof ServiceWorkerRegistration))throw os.create("invalid-sw-registration");n.swRegistration=t}})}function vpe(n,t){return ae(this,null,function*(){t?n.vapidKey=t:n.vapidKey||(n.vapidKey=$q)})}function Zq(n,t){return ae(this,null,function*(){if(!navigator)throw os.create("only-available-in-window");if(Notification.permission==="default"&&(yield Notification.requestPermission()),Notification.permission!=="granted")throw os.create("permission-blocked");return yield vpe(n,t?.vapidKey),yield ype(n,t?.serviceWorkerRegistration),ape(n)})}function bpe(n,t,e){return ae(this,null,function*(){let i=wpe(t);(yield n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:e[Hq],message_name:e[qfe],message_time:e[Wfe],message_device_time:Math.floor(Date.now()/1e3)})})}function wpe(n){switch(n){case OS.NOTIFICATION_CLICKED:return"notification_open";case OS.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}function xpe(n,t){return ae(this,null,function*(){let e=t.data;if(!e.isFirebaseMessaging)return;n.onMessageHandler&&e.messageType===OS.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(jq(e)):n.onMessageHandler.next(jq(e)));let i=e.data;ppe(i)&&i[Zfe]==="1"&&(yield bpe(n,e.messageType,i))})}var zq="@firebase/messaging",Uq="0.12.12";var Epe=n=>{let t=new KO(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>xpe(t,e)),t},Cpe=n=>{let t=n.getProvider("messaging").getImmediate();return{getToken:i=>Zq(t,i)}};function Tpe(){ns(new Qr("messaging",Epe,"PUBLIC")),ns(new Qr("messaging-internal",Cpe,"PRIVATE")),Jr(zq,Uq),Jr(zq,Uq,"esm2017")}function JO(){return ae(this,null,function*(){try{yield ET()}catch(n){return!1}return typeof window<"u"&&xT()&&Y$()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")})}function Spe(n,t){if(!navigator)throw os.create("only-available-in-window");return n.onMessageHandler=t,()=>{n.onMessageHandler=null}}function Kq(n=Mu()){return JO().then(t=>{if(!t)throw os.create("unsupported-browser")},t=>{throw os.create("indexed-db-unsupported")}),qa(Ci(n),"messaging").getImmediate()}function Yq(n,t){return ae(this,null,function*(){return n=Ci(n),Zq(n,t)})}function Xq(n,t){return n=Ci(n),Spe(n,t)}Tpe();var Dpe={apiKey:"AIzaSyB4DkZu3SqYLJCrxFGS7DybGGKUBrlJqaI",authDomain:"familyapp-e83b7.firebaseapp.com",databaseURL:"https://familyapp-e83b7-default-rtdb.europe-west1.firebasedatabase.app",projectId:"familyapp-e83b7",storageBucket:"familyapp-e83b7.appspot.com",messagingSenderId:"728695329604",appId:"1:728695329604:web:c0a1ef7ebf32de4bcd7d11"},LS=b2(Dpe),an=X2(LS),Ut=KG(LS),fh=_q(LS),FS=null;function Qq(){return ae(this,null,function*(){return FS||((yield JO())&&(FS=Kq(LS)),FS)})}var ph=(()=>{class n{constructor(){this.messagesRef=zt(Ut,"/chat/messages"),this._unreadCount=Zn(0),this.unreadCount=this._unreadCount.asReadonly(),this.lastReadTimestamp=0,this.isOnChatPage=!1,this.unsubUnread=null,this.loadLastRead()}loadLastRead(){let e=localStorage.getItem("chat_last_read");this.lastReadTimestamp=e?parseInt(e,10):0}markAsRead(){this.lastReadTimestamp=Date.now(),localStorage.setItem("chat_last_read",this.lastReadTimestamp.toString()),this._unreadCount.set(0),this.updateAppBadge(0),this.isOnChatPage=!0}leaveChatPage(){this.isOnChatPage=!1}startUnreadListener(){if(this.unsubUnread)return;let e=IO(this.messagesRef,DO(100));rs(e,i=>{if(this.isOnChatPage){this._unreadCount.set(0);return}let r=i.val();if(!r){this._unreadCount.set(0);return}let o=Object.values(r).filter(d=>d.timestamp>this.lastReadTimestamp&&d.uid!==an.currentUser?.uid).length;this._unreadCount.set(o),this.updateAppBadge(o)}),this.unsubUnread=()=>dh(e)}updateAppBadge(e){"setAppBadge"in navigator&&(e>0?navigator.setAppBadge(e):navigator.clearAppBadge())}stopUnreadListener(){this.unsubUnread?.(),this.unsubUnread=null}listenMessages(e){let i=IO(this.messagesRef,DO(100)),r=an.currentUser?.uid;return rs(i,o=>{let d=o.val();if(!d){e([]);return}let m=Object.keys(d).map(b=>{let T=Mt(Be({},d[b]),{id:b});return T._likeCount=T.likes?Object.keys(T.likes).length:0,T._liked=r?!!T.likes?.[r]:!1,T.comments?(T._comments=Object.keys(T.comments).map(A=>Mt(Be({},T.comments[A]),{id:A})).sort((A,N)=>A.timestamp-N.timestamp),T._commentCount=T._comments.length):(T._comments=[],T._commentCount=0),T}).sort((b,T)=>T.timestamp-b.timestamp);e(m)}),()=>dh(i)}sendMessage(e,i){return ae(this,null,function*(){let r=an.currentUser;if(!r||!e.trim()&&!i)return;let o;i&&(o=yield this.uploadImage(i));let d=ba(this.messagesRef);yield Mo(d,Be({id:d.key,text:e.trim(),uid:r.uid,displayName:r.displayName||"",photoURL:r.photoURL||"",timestamp:Date.now()},o&&{imageURL:o}))})}uploadImage(e){return ae(this,null,function*(){let i=yield this.compressImage(e),r=`${Date.now()}_${Math.random().toString(36).substring(2,11)}.jpg`,o=hh(fh,`feed/${r}`),d=yield T_(o,i,{contentType:"image/jpeg"});return S_(d.ref)})}compressImage(e,i=1200,r=.7){return new Promise((o,d)=>{let m=new Image,b=new FileReader;b.onload=T=>{m.onload=()=>{let A=document.createElement("canvas"),N=m.width,q=m.height;N>i&&(q=Math.round(q*i/N),N=i),A.width=N,A.height=q,A.getContext("2d").drawImage(m,0,0,N,q),A.toBlob(K=>K?o(K):d("Compression failed"),"image/jpeg",r)},m.onerror=d,m.src=T.target?.result},b.onerror=d,b.readAsDataURL(e)})}toggleLike(e){return ae(this,null,function*(){let i=an.currentUser?.uid;if(!i)return;let r=zt(Ut,`/chat/messages/${e}/likes/${i}`);(yield Ds(r)).val()?yield Ss(r):yield Mo(r,!0)})}addComment(e,i){return ae(this,null,function*(){let r=an.currentUser;if(!r||!i.trim())return;let o=ba(zt(Ut,`/chat/messages/${e}/comments`));yield Mo(o,{text:i.trim(),uid:r.uid,displayName:r.displayName||"",photoURL:r.photoURL||"",timestamp:Date.now()})})}deleteComment(e,i){return ae(this,null,function*(){yield Ss(zt(Ut,`/chat/messages/${e}/comments/${i}`))})}deleteMessage(e){return ae(this,null,function*(){if(e.imageURL)try{let i=hh(fh,e.imageURL);yield kS(i)}catch(i){console.log("Image not found or already deleted")}yield Ss(zt(Ut,`/chat/messages/${e.id}`))})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var mh=(()=>{class n{constructor(){}getUserData(){return new Kt(e=>Pu(an,r=>{r?Ds(zt(Ut,"/users/"+r.uid)).then(o=>{let d=o.val();e.next(d)}).catch(o=>{e.error(o)}):e.next(null)},r=>{e.error(r)},()=>{e.complete()}))}updateUserData(e,i){return is(zt(Ut,`/users/${e}`),i)}deleteOldAvatar(e){return!e||!e.includes("firebasestorage.googleapis.com")?Promise.resolve():kS(hh(fh,e)).catch(()=>{})}compressImage(e,i=400,r=.7){return new Promise((o,d)=>{let m=new Image,b=new FileReader;b.onload=T=>{m.onload=()=>{let A=document.createElement("canvas"),N=m.width,q=m.height;N>i&&(q=Math.round(q*i/N),N=i),A.width=N,A.height=q,A.getContext("2d").drawImage(m,0,0,N,q),A.toBlob(K=>K?o(K):d("Compression echouee"),"image/jpeg",r)},m.onerror=d,m.src=T.target?.result},b.onerror=d,b.readAsDataURL(e)})}uploadFile(e){return this.compressImage(e).then(i=>{let r=Date.now().toString(),o=hh(fh,"/avatars/"+r+".jpg");return T_(o,i,{contentType:"image/jpeg"}).then(d=>S_(d.ref))})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var eo=(()=>{class n{constructor(){this.googleToken$=new yt,this.isAndroidWebView=/Android/.test(navigator.userAgent)&&/wv/.test(navigator.userAgent),this.allUsers=[],this.redirectReady=this.handleRedirectResult()}handleRedirectResult(){return ae(this,null,function*(){try{let e=yield Y2(an);if(e){let i=ib.credentialFromResult(e);i?.accessToken&&this.googleToken$.next(i.accessToken),yield this.saveUserData(e.user)}}catch(e){console.error("Redirect result error:",e)}})}saveUserData(e){return ae(this,null,function*(){let i=zt(Ut,"/users/"+e.uid),o=(yield Ds(i)).val()||{},d=o.photoURL,m=o.displayName,b=d&&d.trim()!=="",T=m&&m.trim()!=="",A={email:e.email||"",uid:e.uid,displayName:T?m:e.displayName||"",photoURL:b?d:e.photoURL||""};yield is(i,A)})}signInWithGoogle(){return ae(this,null,function*(){let e=new ib;if(e.addScope("https://www.googleapis.com/auth/calendar"),e.addScope("https://www.googleapis.com/auth/drive"),this.isAndroidWebView)yield K2(an,e);else{let i=yield Z2(an,e),r=ib.credentialFromResult(i);r?.accessToken&&this.googleToken$.next(r.accessToken),yield this.saveUserData(i.user)}})}signOutUser(){H2(an)}getAllUsers(){return Ds(zt(Ut,"/users")).then(e=>{let i=e.val();return i?this.allUsers=Object.keys(i).map(r=>Be({id:r},i[r])):this.allUsers=[],this.allUsers})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Ipe(n,t){if(n&1&&(V(0,"span",6),Z(1),U()),n&2){let e=_e();te(),tn(" ",e.chatService.unreadCount()>99?"99+":e.chatService.unreadCount()," ")}}var eW=(()=>{class n{constructor(e,i){this.editProfileService=e,this.authService=i,this.chatService=se(ph),this.userName="",this.userPhoto=""}ngOnInit(){this.userSubscription=this.editProfileService.getUserData().subscribe(e=>{e&&(this.userName=e.displayName||"",this.userPhoto=e.photoURL||"https://i.pinimg.com/originals/2f/15/f2/2f15f2e8c688b3120d3d26467b06330c.jpg")})}onSignOut(){this.authService.signOutUser()}ngOnDestroy(){this.userSubscription&&this.userSubscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(Ze(mh),Ze(eo))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-sidebar"]],decls:28,vars:1,consts:[[1,"w-64","h-screen","bg-white/80","backdrop-blur-lg","border-r","border-warm-100","flex","flex-col","p-4","sticky","top-0"],[1,"flex","items-center","gap-3","px-3","py-4","mb-6"],[1,"font-display","font-extrabold","text-xl","text-gradient"],[1,"flex-1","space-y-1"],["routerLink","/home","routerLinkActive","bg-gradient-to-r from-family-pink/10 to-family-orange/10 text-family-pink",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/chat","routerLinkActive","bg-gradient-to-r from-family-coral/10 to-family-orange/10 text-family-coral",1,"flex","items-center","justify-between","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],[1,"min-w-[20px]","h-[20px]","flex","items-center","justify-center","bg-red-500","text-white","text-[10px]","font-bold","rounded-full","px-1"],["routerLink","/add-task","routerLinkActive","bg-gradient-to-r from-family-purple/10 to-family-lavender/10 text-family-purple",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/shopping","routerLinkActive","bg-gradient-to-r from-family-green/10 to-family-green/10 text-family-green",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/recipes","routerLinkActive","bg-gradient-to-r from-family-orange/10 to-family-coral/10 text-family-orange",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/map","routerLinkActive","bg-gradient-to-r from-family-sky/10 to-family-sky/10 text-family-sky",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/calendar","routerLinkActive","bg-gradient-to-r from-family-yellow/10 to-family-orange/10 text-family-orange",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/documents","routerLinkActive","bg-gradient-to-r from-family-purple/10 to-family-lavender/10 text-family-purple",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],["routerLink","/vacances","routerLinkActive","bg-gradient-to-r from-family-coral/10 to-family-orange/10 text-family-coral",1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-600","hover:bg-warm-50","transition-all","font-medium"],[1,"border-t","border-warm-100","pt-4"],[1,"flex","items-center","gap-3","px-4","py-3","rounded-xl","text-gray-400","hover:bg-red-50","hover:text-red-400","transition-all","font-medium","w-full","text-left",3,"click"]],template:function(i,r){i&1&&(V(0,"aside",0)(1,"div",1)(2,"h1",2),Z(3,"Family App"),U()(),V(4,"nav",3)(5,"a",4),Z(6," Tableau de bord "),U(),V(7,"a",5)(8,"span"),Z(9,"Fil d'actu"),U(),tt(10,Ipe,2,1,"span",6),U(),V(11,"a",7),Z(12," Nouvelle tache "),U(),V(13,"a",8),Z(14," Courses "),U(),V(15,"a",9),Z(16," Recettes "),U(),V(17,"a",10),Z(18," Carte "),U(),V(19,"a",11),Z(20," Calendrier "),U(),V(21,"a",12),Z(22," Documents "),U(),V(23,"a",13),Z(24," Vacances "),U()(),V(25,"div",14)(26,"button",15),Fe("click",function(){return r.onSignOut()}),Z(27," Deconnexion "),U()()()),i&2&&(te(10),nt(r.chatService.unreadCount()>0?10:-1))},dependencies:[Sl,$s,D0],encapsulation:2})}}return n})();var Mpe=()=>({exact:!1});function Ape(n,t){if(n&1&&(V(0,"span",6),Z(1),U()),n&2){let e=_e();te(),tn(" ",e.chatService.unreadCount()>99?"99+":e.chatService.unreadCount()," ")}}function kpe(n,t){if(n&1){let e=Tt();V(0,"div",11)(1,"a",13),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),V(2,"span"),Z(3,"\u270F\uFE0F"),U(),Z(4," Taches "),U(),V(5,"a",14),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),V(6,"span"),Z(7,"\u{1F4C5}"),U(),Z(8," Agenda "),U(),V(9,"a",15),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),V(10,"span"),Z(11,"\u{1F4C1}"),U(),Z(12," Docs "),U(),V(13,"a",16),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),V(14,"span"),Z(15,"\u{1F37D}\uFE0F"),U(),Z(16," Recettes "),U(),V(17,"a",17),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),V(18,"span"),Z(19,"\u{1F3D6}\uFE0F"),U(),Z(20," Vacances "),U()()}}function Rpe(n,t){if(n&1){let e=Tt();V(0,"div",18),Fe("click",function(){Ve(e);let r=_e();return je(r.showMore=!1)}),U()}}var tW=(()=>{class n{constructor(){this.chatService=se(ph),this.showMore=!1}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-bottom-nav"]],decls:31,vars:7,consts:[[1,"fixed","bottom-0","left-0","right-0","bg-white/90","backdrop-blur-lg","border-t","border-warm-100","pb-safe","z-50"],[1,"flex","justify-around","items-center","h-16"],["routerLink","/home","routerLinkActive","text-family-pink",1,"flex","flex-col","items-center","justify-center","gap-0.5","text-gray-400","transition-all","active:scale-90",3,"routerLinkActiveOptions"],[1,"text-lg"],[1,"text-[9px]","font-medium"],["routerLink","/chat","routerLinkActive","text-family-coral",1,"relative","flex","flex-col","items-center","justify-center","gap-0.5","text-gray-400","transition-all","active:scale-90"],[1,"absolute","-top-1","-right-1","min-w-[18px]","h-[18px]","flex","items-center","justify-center","bg-red-500","text-white","text-[10px]","font-bold","rounded-full","px-1"],["routerLink","/map","routerLinkActive","text-family-sky",1,"flex","flex-col","items-center","justify-center","gap-0.5","text-gray-400","transition-all","active:scale-90"],["routerLink","/shopping","routerLinkActive","text-family-green",1,"flex","flex-col","items-center","justify-center","gap-0.5","text-gray-400","transition-all","active:scale-90"],[1,"relative"],[3,"click"],[1,"absolute","bottom-14","right-0","bg-white","rounded-2xl","shadow-lg","border","border-gray-100","p-2","min-w-[140px]","z-50"],[1,"fixed","inset-0","z-40"],["routerLink","/add-task","routerLinkActive","text-family-purple",1,"flex","items-center","gap-3","px-3","py-2.5","rounded-xl","text-gray-600","hover:bg-gray-50","transition-all","text-sm",3,"click"],["routerLink","/calendar","routerLinkActive","text-family-orange",1,"flex","items-center","gap-3","px-3","py-2.5","rounded-xl","text-gray-600","hover:bg-gray-50","transition-all","text-sm",3,"click"],["routerLink","/documents","routerLinkActive","text-family-purple",1,"flex","items-center","gap-3","px-3","py-2.5","rounded-xl","text-gray-600","hover:bg-gray-50","transition-all","text-sm",3,"click"],["routerLink","/recipes","routerLinkActive","text-family-orange",1,"flex","items-center","gap-3","px-3","py-2.5","rounded-xl","text-gray-600","hover:bg-gray-50","transition-all","text-sm",3,"click"],["routerLink","/vacances","routerLinkActive","text-family-coral",1,"flex","items-center","gap-3","px-3","py-2.5","rounded-xl","text-gray-600","hover:bg-gray-50","transition-all","text-sm",3,"click"],[1,"fixed","inset-0","z-40",3,"click"]],template:function(i,r){i&1&&(V(0,"nav",0)(1,"div",1)(2,"a",2)(3,"span",3),Z(4,"\u{1F3E0}"),U(),V(5,"span",4),Z(6,"Accueil"),U()(),V(7,"a",5)(8,"span",3),Z(9,"\u{1F4F1}"),U(),tt(10,Ape,2,1,"span",6),V(11,"span",4),Z(12,"Fil"),U()(),V(13,"a",7)(14,"span",3),Z(15,"\u{1F5FA}\uFE0F"),U(),V(16,"span",4),Z(17,"Carte"),U()(),V(18,"a",8)(19,"span",3),Z(20,"\u{1F6D2}"),U(),V(21,"span",4),Z(22,"Courses"),U()(),V(23,"div",9)(24,"button",10),Fe("click",function(){return r.showMore=!r.showMore}),V(25,"span",3),Z(26,"\u2022\u2022\u2022"),U(),V(27,"span",4),Z(28,"Plus"),U()(),tt(29,kpe,21,0,"div",11),U()()(),tt(30,Rpe,1,0,"div",12)),i&2&&(te(2),Ft("routerLinkActiveOptions",zk(6,Mpe)),te(8),nt(r.chatService.unreadCount()>0?10:-1),te(14),Ri(r.showMore?"flex flex-col items-center justify-center gap-0.5 text-family-pink transition-all active:scale-90":"flex flex-col items-center justify-center gap-0.5 text-gray-400 transition-all active:scale-90"),te(5),nt(r.showMore?29:-1),te(),nt(r.showMore?30:-1))},dependencies:[Sl,$s,D0,Ui],encapsulation:2})}}return n})();function Ppe(n,t){if(n&1&&(V(0,"a",0),st(1,"img",1),V(2,"span",2),Z(3),U()()),n&2){let e=_e();te(),Ft("src",e.fileUrl,Vi),te(2),ht(e.user.displayName)}}var nW=(()=>{class n{constructor(e){this.editProfileService=e,this.user=null}ngOnInit(){this.userSubscription=this.editProfileService.getUserData().subscribe(e=>{this.user=e,this.fileUrl=this.user?.photoURL||"https://i.pinimg.com/originals/2f/15/f2/2f15f2e8c688b3120d3d26467b06330c.jpg"},e=>{console.error(e)})}ngOnDestroy(){this.userSubscription&&this.userSubscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(Ze(mh))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-user-avatar"]],decls:1,vars:1,consts:[["routerLink","/user-profile",1,"flex","items-center","gap-2","hover:opacity-80","transition-opacity"],["alt","Photo de profil","referrerpolicy","no-referrer",1,"w-9","h-9","rounded-full","object-cover","ring-2","ring-family-pink/30",3,"src"],[1,"font-medium","text-sm","text-gray-700","hidden","md:inline"]],template:function(i,r){i&1&&tt(0,Ppe,4,2,"a",0),i&2&&nt(r.user?0:-1)},dependencies:[Sl,$s],encapsulation:2})}}return n})();var iW=(()=>{class n{constructor(e){this.authService=e}onSignOut(){this.authService.signOutUser()}static{this.\u0275fac=function(i){return new(i||n)(Ze(eo))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-top-bar"]],decls:9,vars:0,consts:[[1,"flex","items-center","justify-between","px-4","md:px-6","py-3","bg-white/60","backdrop-blur-sm","border-b","border-warm-100"],[1,"flex","items-center","gap-2","md:hidden"],[1,"font-display","font-bold","text-lg","text-gradient"],[1,"hidden","md:block"],[1,"flex","items-center","gap-3"],[1,"md:hidden","text-gray-400","hover:text-red-400","transition-colors","text-sm","font-medium",3,"click"]],template:function(i,r){i&1&&(V(0,"header",0)(1,"div",1)(2,"span",2),Z(3,"Family App"),U()(),st(4,"div",3),V(5,"div",4),st(6,"app-user-avatar"),V(7,"button",5),Fe("click",function(){return r.onSignOut()}),Z(8," Deconnexion "),U()()())},dependencies:[nW],encapsulation:2})}}return n})();var BS=(()=>{class n{constructor(){this.watchId=null,this.visibilityHandler=null}startTracking(){!navigator.geolocation||!an.currentUser||(this.sendPositionOnce(),this.watchId=navigator.geolocation.watchPosition(i=>{this.savePosition(i)},()=>{},{enableHighAccuracy:!0,maximumAge:3e4,timeout:1e4}),this.visibilityHandler=()=>{document.visibilityState==="visible"&&this.sendPositionOnce()},document.addEventListener("visibilitychange",this.visibilityHandler))}sendPositionOnce(){navigator.geolocation.getCurrentPosition(e=>this.savePosition(e),()=>{},{enableHighAccuracy:!0,timeout:1e4})}savePosition(e){let i=an.currentUser;if(!i)return;let r=zt(Ut,`/locations/${i.uid}`);Mo(r,{lat:e.coords.latitude,lng:e.coords.longitude,timestamp:Date.now(),displayName:i.displayName||"",photoURL:i.photoURL||""})}stopTracking(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.visibilityHandler&&(document.removeEventListener("visibilitychange",this.visibilityHandler),this.visibilityHandler=null)}listenAllLocations(e){let i=zt(Ut,"/locations"),r=rs(i,o=>{e(o.val()||{})});return()=>dh(i)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var oW=(()=>{class n{constructor(e,i){this.swUpdate=e,this.snackBar=i}init(){this.swUpdate.isEnabled&&(setTimeout(()=>{this.swUpdate.checkForUpdate().catch(()=>{})},1e4),ov(1800*1e3).subscribe(()=>{this.swUpdate.checkForUpdate().catch(()=>{})}),this.swUpdate.versionUpdates.pipe(mi(e=>e.type==="VERSION_READY")).subscribe(()=>{this.showUpdateNotification()}))}showUpdateNotification(){this.snackBar.open("\u{1F680} Nouvelle version disponible !","Mettre \xE0 jour",{duration:0,horizontalPosition:"center",verticalPosition:"bottom",panelClass:["update-snackbar"]}).onAction().subscribe(()=>{this.applyUpdate()})}applyUpdate(){this.swUpdate.activateUpdate().then(()=>{window.location.reload()})}static{this.\u0275fac=function(i){return new(i||n)(vt(gT),vt(Qi))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ss={production:!0,vapidKey:"BFfHf8Dtrh3o5IQF4GYi5mHZSVW0mDvnsxPrCJkXbUCAq9VJ0ea_wgSc9pC0ZnWf8uBs3IGWcWM7L9A49orsKFg",googleCalendar:{apiKey:"AIzaSyB4DkZu3SqYLJCrxFGS7DybGGKUBrlJqaI",clientId:"728695329604-70417p57psoofhqlsio6qjv705a0ieqf.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest","https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],scopes:"https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/drive",familyCalendarId:"family12498967542838679084@group.calendar.google.com",familyDriveFolderId:"1yWZtCJZGlt2wfqmkcrJThLuY8m-aI0TW"}};var sW=(()=>{class n{constructor(e,i){this.snackBar=e,this.router=i,this.initialized=!1}init(){return ae(this,null,function*(){if(this.initialized)return;this.initialized=!0;let e=yield Qq();if(e){try{if((yield Notification.requestPermission())!=="granted")return;let r=yield navigator.serviceWorker.register("/firebase-messaging-sw.js"),o=yield Yq(e,{vapidKey:ss.vapidKey,serviceWorkerRegistration:r});o&&(yield this.saveToken(o))}catch(i){console.error("Notification init failed:",i)}Xq(e,i=>{let r=i.data||{},o=r.title||"FamilyApp",d=r.body||"";this.playNotificationSound(),this.snackBar.open(`${o}: ${d}`,"Voir",{duration:5e3}).onAction().subscribe(()=>{let b=r.url;b&&this.router.navigateByUrl(b)})})}})}playNotificationSound(){try{let e=new AudioContext,i=e.createOscillator(),r=e.createGain();i.connect(r),r.connect(e.destination),i.type="sine",i.frequency.setValueAtTime(880,e.currentTime),i.frequency.setValueAtTime(1108,e.currentTime+.15),r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.3),i.start(e.currentTime),i.stop(e.currentTime+.3)}catch(e){}}saveToken(e){return ae(this,null,function*(){let i=an.currentUser?.uid;i&&(yield Mo(zt(Ut,`/users/${i}/fcmToken`),e))})}removeToken(){return ae(this,null,function*(){let e=an.currentUser?.uid;e&&(yield Ss(zt(Ut,`/users/${e}/fcmToken`)),this.initialized=!1)})}static{this.\u0275fac=function(i){return new(i||n)(vt(Qi),vt(lr))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Fpe(n,t){n&1&&(V(0,"div",0),st(1,"app-sidebar",1),V(2,"div",2),st(3,"app-top-bar"),V(4,"main",3),st(5,"router-outlet"),U(),st(6,"app-bottom-nav",4),U()())}function Lpe(n,t){n&1&&st(0,"router-outlet")}var aW=(()=>{class n{constructor(e,i,r,o){this.locationService=e,this.updateService=i,this.chatService=r,this.notificationService=o,this.title="FamilyApp",this.isAuth=!1}ngOnInit(){this.updateService.init(),Pu(an,e=>{this.isAuth=!!e,e?(this.locationService.startTracking(),this.chatService.startUnreadListener(),this.notificationService.init()):(this.locationService.stopTracking(),this.chatService.stopUnreadListener(),this.notificationService.removeToken())})}static{this.\u0275fac=function(i){return new(i||n)(Ze(BS),Ze(oW),Ze(ph),Ze(sW))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-root"]],decls:2,vars:1,consts:[[1,"flex","h-screen"],[1,"hidden","md:flex","flex-shrink-0"],[1,"flex-1","flex","flex-col","min-h-screen","overflow-hidden"],[1,"flex-1","overflow-y-auto","p-4","md:p-6","pb-20","md:pb-6"],[1,"md:hidden"]],template:function(i,r){i&1&&tt(0,Fpe,7,0,"div",0)(1,Lpe,1,0,"router-outlet"),i&2&&nt(r.isAuth?0:1)},dependencies:[E0,eW,tW,iW],encapsulation:2})}}return n})();var _W=(()=>{class n{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,i){this._renderer=e,this._elementRef=i}setProperty(e,i){this._renderer.setProperty(this._elementRef.nativeElement,e,i)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(i){return new(i||n)(Ze(Br),Ze(Fn))};static \u0275dir=sn({type:n})}return n})(),$b=(()=>{class n extends _W{static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,features:[ci]})}return n})(),Np=new rt(""),Bpe={provide:Np,useExisting:jo(()=>sF),multi:!0},sF=(()=>{class n extends $b{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,r){i&1&&Fe("change",function(d){return r.onChange(d.target.checked)})("blur",function(){return r.onTouched()})},standalone:!1,features:[fo([Bpe]),ci]})}return n})(),Vpe={provide:Np,useExisting:jo(()=>Mr),multi:!0};function jpe(){let n=Ba()?Ba().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var zpe=new rt(""),Mr=(()=>{class n extends _W{_compositionMode;_composing=!1;constructor(e,i,r){super(e,i),this._compositionMode=r,this._compositionMode==null&&(this._compositionMode=!jpe())}writeValue(e){let i=e??"";this.setProperty("value",i)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(i){return new(i||n)(Ze(Br),Ze(Fn),Ze(zpe,8))};static \u0275dir=sn({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,r){i&1&&Fe("input",function(d){return r._handleInput(d.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(d){return r._compositionEnd(d.target.value)})},standalone:!1,features:[fo([Vpe]),ci]})}return n})();function aF(n){return n==null||lF(n)===0}function lF(n){return n==null?null:Array.isArray(n)||typeof n=="string"?n.length:n instanceof Set?n.size:null}var A_=new rt(""),cF=new rt(""),Upe=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,as=class{static min(t){return yW(t)}static max(t){return vW(t)}static required(t){return bW(t)}static requiredTrue(t){return $pe(t)}static email(t){return Hpe(t)}static minLength(t){return Gpe(t)}static maxLength(t){return qpe(t)}static pattern(t){return Wpe(t)}static nullValidator(t){return jS()}static compose(t){return SW(t)}static composeAsync(t){return IW(t)}};function yW(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e<n?{min:{min:n,actual:t.value}}:null}}function vW(n){return t=>{if(t.value==null||n==null)return null;let e=parseFloat(t.value);return!isNaN(e)&&e>n?{max:{max:n,actual:t.value}}:null}}function bW(n){return aF(n.value)?{required:!0}:null}function $pe(n){return n.value===!0?null:{required:!0}}function Hpe(n){return aF(n.value)||Upe.test(n.value)?null:{email:!0}}function Gpe(n){return t=>{let e=t.value?.length??lF(t.value);return e===null||e===0?null:e<n?{minlength:{requiredLength:n,actualLength:e}}:null}}function qpe(n){return t=>{let e=t.value?.length??lF(t.value);return e!==null&&e>n?{maxlength:{requiredLength:n,actualLength:e}}:null}}function Wpe(n){if(!n)return jS;let t,e;return typeof n=="string"?(e="",n.charAt(0)!=="^"&&(e+="^"),e+=n,n.charAt(n.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=n.toString(),t=n),i=>{if(aF(i.value))return null;let r=i.value;return t.test(r)?null:{pattern:{requiredPattern:e,actualValue:r}}}}function jS(n){return null}function wW(n){return n!=null}function xW(n){return Ld(n)?Bi(n):n}function EW(n){let t={};return n.forEach(e=>{t=e!=null?Be(Be({},t),e):t}),Object.keys(t).length===0?null:t}function CW(n,t){return t.map(e=>e(n))}function Zpe(n){return!n.validate}function TW(n){return n.map(t=>Zpe(t)?t:e=>t.validate(e))}function SW(n){if(!n)return null;let t=n.filter(wW);return t.length==0?null:function(e){return EW(CW(e,t))}}function DW(n){return n!=null?SW(TW(n)):null}function IW(n){if(!n)return null;let t=n.filter(wW);return t.length==0?null:function(e){let i=CW(e,t).map(xW);return cM(i).pipe(Tn(EW))}}function MW(n){return n!=null?IW(TW(n)):null}function lW(n,t){return n===null?[t]:Array.isArray(n)?[...n,t]:[n,t]}function AW(n){return n._rawValidators}function kW(n){return n._rawAsyncValidators}function tF(n){return n?Array.isArray(n)?n:[n]:[]}function zS(n,t){return Array.isArray(n)?n.includes(t):n===t}function cW(n,t){let e=tF(t);return tF(n).forEach(r=>{zS(e,r)||e.push(r)}),e}function uW(n,t){return tF(t).filter(e=>!zS(n,e))}var US=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=DW(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=MW(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},Rp=class extends US{name;get formDirective(){return null}get path(){return null}},Pp=class extends US{_parent=null;name=null;valueAccessor=null},$S=class{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}};var to=(()=>{class n extends $S{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(Ze(Pp,2))};static \u0275dir=sn({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,r){i&2&&ji("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},standalone:!1,features:[ci]})}return n})(),_h=(()=>{class n extends $S{constructor(e){super(e)}static \u0275fac=function(i){return new(i||n)(Ze(Rp,10))};static \u0275dir=sn({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["","formArray",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,r){i&2&&ji("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},standalone:!1,features:[ci]})}return n})();var Lb="VALID",VS="INVALID",D_="PENDING",Bb="DISABLED",gh=class{},HS=class extends gh{value;source;constructor(t,e){super(),this.value=t,this.source=e}},Vb=class extends gh{pristine;source;constructor(t,e){super(),this.pristine=t,this.source=e}},jb=class extends gh{touched;source;constructor(t,e){super(),this.touched=t,this.source=e}},I_=class extends gh{status;source;constructor(t,e){super(),this.status=t,this.source=e}},nF=class extends gh{source;constructor(t){super(),this.source=t}},Ub=class extends gh{source;constructor(t){super(),this.source=t}};function uF(n){return(ZS(n)?n.validators:n)||null}function Kpe(n){return Array.isArray(n)?DW(n):n||null}function dF(n,t){return(ZS(t)?t.asyncValidators:n)||null}function Ype(n){return Array.isArray(n)?MW(n):n||null}function ZS(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function RW(n,t,e){let i=n.controls;if(!(t?Object.keys(i):i).length)throw new Je(1e3,"");if(!i[e])throw new Je(1001,"")}function PW(n,t,e){n._forEachChild((i,r)=>{if(e[r]===void 0)throw new Je(1002,"")})}var M_=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,e){this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Cr(this.statusReactive)}set status(t){Cr(()=>this.statusReactive.set(t))}_status=xi(()=>this.statusReactive());statusReactive=Zn(void 0);get valid(){return this.status===Lb}get invalid(){return this.status===VS}get pending(){return this.status==D_}get disabled(){return this.status===Bb}get enabled(){return this.status!==Bb}errors;get pristine(){return Cr(this.pristineReactive)}set pristine(t){Cr(()=>this.pristineReactive.set(t))}_pristine=xi(()=>this.pristineReactive());pristineReactive=Zn(!0);get dirty(){return!this.pristine}get touched(){return Cr(this.touchedReactive)}set touched(t){Cr(()=>this.touchedReactive.set(t))}_touched=xi(()=>this.touchedReactive());touchedReactive=Zn(!1);get untouched(){return!this.touched}_events=new yt;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(cW(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(cW(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(uW(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(uW(t,this._rawAsyncValidators))}hasValidator(t){return zS(this._rawValidators,t)}hasAsyncValidator(t){return zS(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(Mt(Be({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new jb(!0,i))}markAllAsDirty(t={}){this.markAsDirty({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsDirty(t))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),e&&t.emitEvent!==!1&&this._events.next(new jb(!1,i))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(Mt(Be({},t),{sourceControl:i})),e&&t.emitEvent!==!1&&this._events.next(new Vb(!1,i))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let i=t.sourceControl??this;this._forEachChild(r=>{r.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),e&&t.emitEvent!==!1&&this._events.next(new Vb(!0,i))}markAsPending(t={}){this.status=D_;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new I_(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(Mt(Be({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Bb,this.errors=null,this._forEachChild(r=>{r.disable(Mt(Be({},t),{onlySelf:!0}))}),this._updateValue();let i=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new HS(this.value,i)),this._events.next(new I_(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Mt(Be({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Lb,this._forEachChild(i=>{i.enable(Mt(Be({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Mt(Be({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Lb||this.status===D_)&&this._runAsyncValidator(i,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new HS(this.value,e)),this._events.next(new I_(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(Mt(Be({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Bb:Lb}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=D_,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1,shouldHaveEmitted:t!==!1};let i=xW(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(r=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(r,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=(this._hasOwnPendingAsyncValidator?.emitEvent||this._hasOwnPendingAsyncValidator?.shouldHaveEmitted)??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((i,r)=>i&&i._find(r),this)}getError(t,e){let i=e?this.get(e):this;return i&&i.errors?i.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new I_(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,i)}_initObservables(){this.valueChanges=new xn,this.statusChanges=new xn}_calculateStatus(){return this._allControlsDisabled()?Bb:this.errors?VS:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(D_)?D_:this._anyControlsHaveStatus(VS)?VS:Lb}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let i=!this._anyControlsDirty(),r=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),r&&this._events.next(new Vb(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new jb(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){ZS(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=Kpe(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Ype(this._rawAsyncValidators)}},GS=class extends M_{constructor(t,e,i){super(uF(e),dF(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,i={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){PW(this,!0,t),Object.keys(t).forEach(i=>{RW(this,!0,i),this.controls[i].setValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(i=>{let r=this.controls[i];r&&r.patchValue(t[i],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((i,r)=>{i.reset(t?t[r]:null,Mt(Be({},e),{onlySelf:!0}))}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Ub(this))}getRawValue(){return this._reduceChildren({},(t,e,i)=>(t[i]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,i)=>i._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let i=this.controls[e];i&&t(i,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,i]of Object.entries(this.controls))if(this.contains(e)&&t(i))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,i,r)=>((i.enabled||this.disabled)&&(e[r]=i.value),e))}_reduceChildren(t,e){let i=t;return this._forEachChild((r,o)=>{i=e(i,r,o)}),i}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var iF=class extends GS{};var KS=new rt("",{factory:()=>YS}),YS="always";function NW(n,t){return[...t.path,n]}function rF(n,t,e=YS){hF(n,t),t.valueAccessor.writeValue(n.value),(n.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(n.disabled),Qpe(n,t),eme(n,t),Jpe(n,t),Xpe(n,t)}function dW(n,t,e=!0){let i=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(i),t.valueAccessor.registerOnTouched(i)),WS(n,t),n&&(t._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function qS(n,t){n.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Xpe(n,t){if(t.valueAccessor.setDisabledState){let e=i=>{t.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(e),t._registerOnDestroy(()=>{n._unregisterOnDisabledChange(e)})}}function hF(n,t){let e=AW(n);t.validator!==null?n.setValidators(lW(e,t.validator)):typeof e=="function"&&n.setValidators([e]);let i=kW(n);t.asyncValidator!==null?n.setAsyncValidators(lW(i,t.asyncValidator)):typeof i=="function"&&n.setAsyncValidators([i]);let r=()=>n.updateValueAndValidity();qS(t._rawValidators,r),qS(t._rawAsyncValidators,r)}function WS(n,t){let e=!1;if(n!==null){if(t.validator!==null){let r=AW(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(d=>d!==t.validator);o.length!==r.length&&(e=!0,n.setValidators(o))}}if(t.asyncValidator!==null){let r=kW(n);if(Array.isArray(r)&&r.length>0){let o=r.filter(d=>d!==t.asyncValidator);o.length!==r.length&&(e=!0,n.setAsyncValidators(o))}}}let i=()=>{};return qS(t._rawValidators,i),qS(t._rawAsyncValidators,i),e}function Qpe(n,t){t.valueAccessor.registerOnChange(e=>{n._pendingValue=e,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&OW(n,t)})}function Jpe(n,t){t.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&OW(n,t),n.updateOn!=="submit"&&n.markAsTouched()})}function OW(n,t){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function eme(n,t){let e=(i,r)=>{t.valueAccessor.writeValue(i),r&&t.viewToModelUpdate(i)};n.registerOnChange(e),t._registerOnDestroy(()=>{n._unregisterOnChange(e)})}function tme(n,t){n==null,hF(n,t)}function nme(n,t){return WS(n,t)}function FW(n,t){if(!n.hasOwnProperty("model"))return!1;let e=n.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function ime(n){return Object.getPrototypeOf(n.constructor)===$b}function rme(n,t){n._syncPendingControls(),t.forEach(e=>{let i=e.control;i.updateOn==="submit"&&i._pendingChange&&(e.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}function LW(n,t){if(!t)return null;Array.isArray(t);let e,i,r;return t.forEach(o=>{o.constructor===Mr?e=o:ime(o)?i=o:r=o}),r||i||e||null}function ome(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function hW(n,t){let e=n.indexOf(t);e>-1&&n.splice(e,1)}function fW(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var zb=class extends M_{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,e,i){super(uF(e),dF(i,e)),this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ZS(e)&&(e.nonNullable||e.initialValueIsDefault)&&(fW(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(i=>i(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),e.overwriteDefaultValue&&(this.defaultValue=this.value),this._pendingChange=!1,e?.emitEvent!==!1&&this._events.next(new Ub(this))}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){hW(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){hW(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){fW(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var sme=n=>n instanceof zb;var ame={provide:Pp,useExisting:jo(()=>wa)},pW=Promise.resolve(),wa=(()=>{class n extends Pp{_changeDetectorRef;callSetDisabledState;control=new zb;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new xn;constructor(e,i,r,o,d,m){super(),this._changeDetectorRef=d,this.callSetDisabledState=m,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=LW(this,o)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let i=e.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),FW(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){rF(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){pW.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let i=e.isDisabled.currentValue,r=i!==0&&gr(i);pW.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?NW(e,this._parent):[e]}static \u0275fac=function(i){return new(i||n)(Ze(Rp,9),Ze(A_,10),Ze(cF,10),Ze(Np,10),Ze(Uo,8),Ze(KS,8))};static \u0275dir=sn({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[fo([ame]),ci,Co]})}return n})();var yh=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return n})(),lme={provide:Np,useExisting:jo(()=>fF),multi:!0},fF=(()=>{class n extends $b{writeValue(e){let i=e??"";this.setProperty("value",i)}registerOnChange(e){this.onChange=i=>{e(i==""?null:parseFloat(i))}}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(i,r){i&1&&Fe("input",function(d){return r.onChange(d.target.value)})("blur",function(){return r.onTouched()})},standalone:!1,features:[fo([lme]),ci]})}return n})();var oF=class extends M_{constructor(t,e,i){super(uF(e),dF(i,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){Array.isArray(t)?t.forEach(i=>{this.controls.push(i),this._registerControl(i)}):(this.controls.push(t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,i={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:i.emitEvent})}removeAt(t,e={}){let i=this._adjustIndex(t);i<0&&(i=0),this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),this.controls.splice(i,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,i={}){let r=this._adjustIndex(t);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),e&&(this.controls.splice(r,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){PW(this,!1,t),t.forEach((i,r)=>{RW(this,!1,r),this.at(r).setValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((i,r)=>{this.at(r)&&this.at(r).patchValue(i,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((i,r)=>{i.reset(t[r],Mt(Be({},e),{onlySelf:!0}))}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e),e?.emitEvent!==!1&&this._events.next(new Ub(this))}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,i)=>i._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,i)=>{t(e,i)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};var cme=(()=>{class n extends Rp{callSetDisabledState;get submitted(){return Cr(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=xi(()=>this._submittedReactive());_submittedReactive=Zn(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];constructor(e,i,r){super(),this.callSetDisabledState=r,this._setValidators(e),this._setAsyncValidators(i)}ngOnChanges(e){this.onChanges(e)}ngOnDestroy(){this.onDestroy()}onChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}onDestroy(){this.form&&(WS(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get path(){return[]}addControl(e){let i=this.form.get(e.path);return rF(i,e,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),i}getControl(e){return this.form.get(e.path)}removeControl(e){dW(e.control||null,e,!1),ome(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}getFormArray(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}updateModel(e,i){this.form.get(e.path).setValue(i)}onReset(){this.resetForm()}resetForm(e=void 0,i={}){this.form.reset(e,i),this._submittedReactive.set(!1)}onSubmit(e){return this.submitted=!0,rme(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new nF(this.control)),e?.target?.method==="dialog"}_updateDomValue(){this.directives.forEach(e=>{let i=e.control,r=this.form.get(e.path);i!==r&&(dW(i||null,e),sme(r)&&(rF(r,e,this.callSetDisabledState),e.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let i=this.form.get(e.path);tme(i,e),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let i=this.form.get(e.path);i&&nme(i,e)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){hF(this.form,this),this._oldForm&&WS(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(i){return new(i||n)(Ze(A_,10),Ze(cF,10),Ze(KS,8))};static \u0275dir=sn({type:n,features:[ci,Co]})}return n})();var BW=new rt("");var ume={provide:Pp,useExisting:jo(()=>Lu)},Lu=(()=>{class n extends Pp{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new xn;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,i,r,o,d){super(),this._ngModelWarningConfig=d,this._parent=e,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=LW(this,o)}ngOnChanges(e){this._added||this._setUpControl(),FW(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return NW(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(i){return new(i||n)(Ze(Rp,13),Ze(A_,10),Ze(cF,10),Ze(Np,10),Ze(BW,8))};static \u0275dir=sn({type:n,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[fo([ume]),ci,Co]})}return n})();var dme={provide:Rp,useExisting:jo(()=>Bu)},Bu=(()=>{class n extends cme{form=null;ngSubmit=new xn;get control(){return this.form}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["","formGroup",""]],hostBindings:function(i,r){i&1&&Fe("submit",function(d){return r.onSubmit(d)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[fo([dme]),ci]})}return n})(),hme={provide:Np,useExisting:jo(()=>Ya),multi:!0};function VW(n,t){return n==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function fme(n){return n.split(":")[0]}var Ya=(()=>{class n extends $b{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;appRefInjector=se(To).injector;destroyRef=se(Bs);cdr=se(Uo);_queuedWrite=!1;_writeValueAfterRender(){this._queuedWrite||this.appRefInjector.destroyed||(this._queuedWrite=!0,co({write:()=>{this.destroyRef.destroyed||(this._queuedWrite=!1,this.writeValue(this.value))}},{injector:this.appRefInjector}))}writeValue(e){this.cdr.markForCheck(),this.value=e;let i=this._getOptionId(e),r=VW(i,e);this.setProperty("value",r)}registerOnChange(e){this.onChange=i=>{this.value=this._getOptionValue(i),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),e))return i;return null}_getOptionValue(e){let i=fme(e);return this._optionMap.has(i)?this._optionMap.get(i):e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,r){i&1&&Fe("change",function(d){return r.onChange(d.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[fo([hme]),ci]})}return n})(),Dc=(()=>{class n{_element;_renderer;_select;id;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(VW(this.id,e)),this._select._writeValueAfterRender())}set value(e){this._setElementValue(e),this._select&&this._select._writeValueAfterRender()}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select._writeValueAfterRender())}static \u0275fac=function(i){return new(i||n)(Ze(Fn),Ze(Br),Ze(Ya,9))};static \u0275dir=sn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})(),pme={provide:Np,useExisting:jo(()=>jW),multi:!0};function mW(n,t){return n==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${n}: ${t}`.slice(0,50))}function mme(n){return n.split(":")[0]}var jW=(()=>{class n extends $b{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let i;if(Array.isArray(e)){let r=e.map(o=>this._getOptionId(o));i=(o,d)=>{o._setSelected(r.indexOf(d.toString())>-1)}}else i=(r,o)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(e){this.onChange=i=>{let r=[],o=i.selectedOptions;if(o!==void 0){let d=o;for(let m=0;m<d.length;m++){let b=d[m],T=this._getOptionValue(b.value);r.push(T)}}else{let d=i.options;for(let m=0;m<d.length;m++){let b=d[m];if(b.selected){let T=this._getOptionValue(b.value);r.push(T)}}}this.value=r,e(r)}}_registerOption(e){let i=(this._idCounter++).toString();return this._optionMap.set(i,e),i}_getOptionId(e){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,e))return i;return null}_getOptionValue(e){let i=mme(e);return this._optionMap.has(i)?this._optionMap.get(i)._value:e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,r){i&1&&Fe("change",function(d){return r.onChange(d.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[fo([pme]),ci]})}return n})(),Ic=(()=>{class n{_element;_renderer;_select;id;_value;constructor(e,i,r){this._element=e,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(mW(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(mW(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(i){return new(i||n)(Ze(Fn),Ze(Br),Ze(jW,9))};static \u0275dir=sn({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return n})();function zW(n){return typeof n=="number"?n:parseFloat(n)}var pF=(()=>{class n{_validator=jS;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let i=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(i),this._validator=this._enabled?this.createValidator(i):jS,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,features:[Co]})}return n})(),gme={provide:A_,useExisting:jo(()=>mF),multi:!0},mF=(()=>{class n extends pF{max;inputName="max";normalizeInput=e=>zW(e);createValidator=e=>vW(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&uo("max",r._enabled?r.max:null)},inputs:{max:"max"},standalone:!1,features:[fo([gme]),ci]})}return n})(),_me={provide:A_,useExisting:jo(()=>gF),multi:!0},gF=(()=>{class n extends pF{min;inputName="min";normalizeInput=e=>zW(e);createValidator=e=>yW(e);static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(i,r){i&2&&uo("min",r._enabled?r.min:null)},inputs:{min:"min"},standalone:!1,features:[fo([_me]),ci]})}return n})(),yme={provide:A_,useExisting:jo(()=>Op),multi:!0};var Op=(()=>{class n extends pF{required;inputName="required";normalizeInput=gr;createValidator=e=>bW;enabled(e){return e}static \u0275fac=(()=>{let e;return function(r){return(e||(e=ao(n)))(r||n)}})();static \u0275dir=sn({type:n,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(i,r){i&2&&uo("required",r._enabled?"":null)},inputs:{required:"required"},standalone:!1,features:[fo([yme]),ci]})}return n})();var UW=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({})}return n})();function gW(n){return!!n&&(n.asyncValidators!==void 0||n.validators!==void 0||n.updateOn!==void 0)}var vh=(()=>{class n{useNonNullable=!1;get nonNullable(){let e=new n;return e.useNonNullable=!0,e}group(e,i=null){let r=this._reduceControls(e),o={};return gW(i)?o=i:i!==null&&(o.validators=i.validator,o.asyncValidators=i.asyncValidator),new GS(r,o)}record(e,i=null){let r=this._reduceControls(e);return new iF(r,i)}control(e,i,r){let o={};return this.useNonNullable?(gW(i)?o=i:(o.validators=i,o.asyncValidators=r),new zb(e,Mt(Be({},o),{nonNullable:!0}))):new zb(e,i,r)}array(e,i,r){let o=e.map(d=>this._createControl(d));return new oF(o,i,r)}_reduceControls(e){let i={};return Object.keys(e).forEach(r=>{i[r]=this._createControl(e[r])}),i}_createControl(e){if(e instanceof zb)return e;if(e instanceof M_)return e;if(Array.isArray(e)){let i=e[0],r=e.length>1?e[1]:null,o=e.length>2?e[2]:null;return this.control(i,r,o)}else return this.control(e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Xa=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:KS,useValue:e.callSetDisabledState??YS}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[UW]})}return n})(),bh=(()=>{class n{static withConfig(e){return{ngModule:n,providers:[{provide:BW,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:KS,useValue:e.callSetDisabledState??YS}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({imports:[UW]})}return n})();var XS=class{constructor(t,e,i,r,o,d,m){this.id=t,this.name=e,this.urg=i,this.title=r,this.descriptif=o,this.statut=d,this.createdDate=m}};var Ac=(()=>{class n{constructor(){this._tasks=Zn([]),this.tasks=this._tasks.asReadonly(),this.todoTasks=xi(()=>this._tasks().filter(e=>e.statut==="todo")),this.inProgressTasks=xi(()=>this._tasks().filter(e=>e.statut==="inProgress")),this.doneTasks=xi(()=>this._tasks().filter(e=>e.statut==="done")),this.initListener()}initListener(){rs(zt(Ut,"/tasks"),e=>{this._tasks.set(e.val()?e.val():[])})}saveTasks(){Mo(zt(Ut,"/tasks"),this._tasks())}generateUniqueId(){return`${Date.now()}-${Math.random().toString(36).substring(2,15)}`}createNewTask(e){e.id=this.generateUniqueId(),this._tasks.update(i=>[...i,e]),this.saveTasks()}removeTask(e){this._tasks().some(r=>r.id===e)&&(this._tasks.update(r=>r.filter(o=>o.id!==e)),this.saveTasks())}getTaskById(e){return this._tasks().find(i=>i.id===e)||null}updateTaskById(e,i){this._tasks().some(o=>o.id===e)&&(this._tasks.update(o=>o.map(d=>d.id===e?i:d)),this.saveTasks())}updateTaskStatus(e){this._tasks.update(i=>i.map(r=>r.id===e.id?e:r)),this.saveTasks()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var vme=(n,t)=>t.uid;function bme(n,t){n&1&&(on(),V(0,"svg",7),st(1,"path",24),U())}function wme(n,t){n&1&&(on(),V(0,"svg",25),st(1,"path",24),U())}function xme(n,t){if(n&1&&st(0,"img",26),n&2){let e=_e().$implicit;Ft("src",e.photoURL,Vi)}}function Eme(n,t){if(n&1){let e=Tt();V(0,"button",6),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.toggleUser(r.displayName||r.email||""))}),V(1,"div"),tt(2,wme,2,0,":svg:svg",25),U(),tt(3,xme,1,1,"img",26),V(4,"span",27),Z(5),U()()}if(n&2){let e=t.$implicit,i=_e();Ri(i.isUserSelected(e.displayName||e.email||"")?"flex items-center gap-2 p-2.5 rounded-xl bg-family-purple/10 border-2 border-family-purple transition-all":"flex items-center gap-2 p-2.5 rounded-xl bg-gray-50 border-2 border-transparent hover:border-gray-200 transition-all"),te(),Ri(i.isUserSelected(e.displayName||e.email||"")?"w-4 h-4 rounded flex-shrink-0 bg-family-purple flex items-center justify-center":"w-4 h-4 rounded flex-shrink-0 border-2 border-gray-300"),te(),nt(i.isUserSelected(e.displayName||e.email||"")?2:-1),te(),nt(e.photoURL?3:-1),te(2),ht(e.displayName||e.email)}}var $W=(()=>{class n{constructor(e,i,r,o,d){this.formBuilder=e,this.ts=i,this.router=r,this._snackBar=o,this.userService=d,this.allUsers=[],this.selectedUsers=new Set,this.selectAll=!1}ngOnInit(){this.userService.getAllUsers().then(e=>{this.allUsers=e}).catch(()=>{this._snackBar.open("Erreur lors du chargement des utilisateurs","",{duration:5e3})}),this.initForm()}initForm(){this.addTaskForm=this.formBuilder.group({urg:["",[as.required]],title:["",[as.required]],descriptif:[""]})}toggleUser(e){this.selectedUsers.has(e)?this.selectedUsers.delete(e):this.selectedUsers.add(e),this.selectAll=!1}toggleSelectAll(){this.selectAll=!this.selectAll,this.selectAll&&this.selectedUsers.clear()}isUserSelected(e){return this.selectedUsers.has(e)}get hasSelection(){return this.selectAll||this.selectedUsers.size>0}goBack(){this.router.navigate(["/home"])}onSubmit(){if(!this.hasSelection){this._snackBar.open("S\xE9lectionne au moins une personne","",{duration:3e3});return}let e=this.selectAll?"Tout le monde":Array.from(this.selectedUsers).join(", "),i=this.addTaskForm.get("urg")?.value,r=this.addTaskForm.get("title")?.value,o=this.addTaskForm.get("descriptif")?.value,d="Nouveau",m=new Date().toISOString(),b=new XS("",e,i,r,o,d,m);this.ts.createNewTask(b),this._snackBar.open("Tache ajout\xE9e","avec succ\xE8s !!",{duration:5e3}),this.router.navigate(["/home"])}static{this.\u0275fac=function(i){return new(i||n)(Ze(vh),Ze(Ac),Ze(lr),Ze(Qi),Ze(eo))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-add-task"]],decls:42,vars:7,consts:[[1,"flex","justify-center"],[1,"card-fun","p-6","w-full","max-w-lg"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"block","mb-2","text-sm","font-medium","text-gray-600"],[1,"space-y-2"],["type","button",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"w-3","h-3","text-white"],[1,"font-medium","text-gray-700"],[1,"grid","grid-cols-2","gap-2"],["type","button",3,"class"],["for","urg",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","urg","id","urg","required","",1,"input-fun","w-full"],["value","","disabled",""],["value","Urgent"],["value","Relativement urgent"],["value","Pas urgent"],["for","title",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","title","id","title","placeholder","Ex. Mon titre...","required","",1,"input-fun","w-full"],[1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","descriptif","rows","5","placeholder","Decrivez la tache...",1,"input-fun","w-full","resize-y"],[1,"flex","justify-end","gap-3","pt-2"],["type","button",1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","font-medium","text-sm",3,"click"],["type","submit",1,"btn-gradient","px-6","py-2","text-sm","font-medium",3,"disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"w-2.5","h-2.5","text-white"],["referrerpolicy","no-referrer",1,"w-6","h-6","rounded-full","object-cover",3,"src"],[1,"text-sm","font-medium","text-gray-700","truncate"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1)(2,"h3",2),Z(3,"\u270F\uFE0F Ajouter une Tache"),U(),V(4,"form",3),Fe("ngSubmit",function(){return r.onSubmit()}),V(5,"div")(6,"label",4),Z(7,"Tache pour"),U(),V(8,"div",5)(9,"button",6),Fe("click",function(){return r.toggleSelectAll()}),V(10,"div"),tt(11,bme,2,0,":svg:svg",7),U(),V(12,"span",8),Z(13,"Tout le monde"),U()(),V(14,"div",9),qt(15,Eme,6,7,"button",10,vme),U()()(),V(17,"div")(18,"label",11),Z(19,"Priorite"),U(),V(20,"select",12)(21,"option",13),Z(22,"Choisir..."),U(),V(23,"option",14),Z(24,"Urgent !"),U(),V(25,"option",15),Z(26,"Relativement urgent"),U(),V(27,"option",16),Z(28,"Pas Urgent"),U()()(),V(29,"div")(30,"label",17),Z(31,"Titre"),U(),st(32,"input",18),U(),V(33,"div")(34,"label",19),Z(35,"Descriptif"),U(),st(36,"textarea",20),U(),V(37,"div",21)(38,"button",22),Fe("click",function(){return r.goBack()}),Z(39,"Retour"),U(),V(40,"button",23),Z(41,"Ajouter"),U()()()()()),i&2&&(te(4),Ft("formGroup",r.addTaskForm),te(5),Ri(r.selectAll?"w-full flex items-center gap-3 p-3 rounded-xl bg-gradient-to-r from-family-purple/10 to-family-pink/10 border-2 border-family-purple transition-all":"w-full flex items-center gap-3 p-3 rounded-xl bg-gray-50 border-2 border-transparent hover:border-gray-200 transition-all"),te(),Ri(r.selectAll?"w-5 h-5 rounded-full bg-family-purple flex items-center justify-center":"w-5 h-5 rounded-full border-2 border-gray-300"),te(),nt(r.selectAll?11:-1),te(4),Wt(r.allUsers),te(25),Ft("disabled",r.addTaskForm.invalid||!r.hasSelection))},dependencies:[bh,yh,Dc,Ic,Mr,Ya,to,_h,Op,Bu,Lu,Ui],styles:[".card[_ngcontent-%COMP%]{box-sizing:border-box;width:80%;margin:20px auto;padding:10px 30px}@media only screen and (min-width:1224px){.mat-card[_ngcontent-%COMP%]{width:80%}}"]})}}return n})();var HW={name:"familyapp",version:"21.2.1",scripts:{ng:"ng",start:"ng serve",build:"ng build",watch:"ng build --watch --configuration development",test:"ng test",deploy:"ng build --configuration production --base-href /Family_app/ && npx angular-cli-ghpages --dir=dist/familyapp/browser"},private:!0,dependencies:{"@angular/animations":"~21.1.2","@angular/cdk":"^21.1.2","@angular/common":"~21.1.2","@angular/compiler":"~21.1.2","@angular/core":"~21.1.2","@angular/forms":"~21.1.2","@angular/material":"^21.1.2","@angular/platform-browser":"~21.1.2","@angular/platform-browser-dynamic":"~21.1.2","@angular/router":"~21.1.2","@angular/service-worker":"~21.1.2","@capacitor/android":"^8.0.2","@capacitor/cli":"^8.0.2","@capacitor/core":"^8.0.2","@maplibre/maplibre-gl-geocoder":"^1.5.0",firebase:"^10.14.1","maplibre-gl":"^5.17.0",rxjs:"~7.4.0",tslib:"^2.3.0","zone.js":"~0.15.1"},devDependencies:{"@angular-devkit/build-angular":"~21.1.2","@angular/cli":"~21.1.2","@angular/compiler-cli":"~21.1.2","@types/geojson":"^7946.0.13","@types/jasmine":"~3.10.0","@types/node":"^12.11.1","angular-cli-ghpages":"^3.0.2",autoprefixer:"^10.4.16","jasmine-core":"~3.10.0",karma:"~6.3.0","karma-chrome-launcher":"~3.1.0","karma-coverage":"~2.0.3","karma-jasmine":"~4.0.0","karma-jasmine-html-reporter":"~1.7.0",postcss:"^8.4.31",tailwindcss:"^3.3.5",typescript:"^5.8.3"}};function Tme(n,t){if(n&1&&(Ot(0,"p",14),Z(1),At()),n&2){let e=_e();te(),ht(e.errorMessage)}}var GW=(()=>{class n{constructor(e,i){this.authService=e,this.router=i,this.errorMessage="",this.appVersion=HW.version}signInWithGoogle(){this.authService.signInWithGoogle().then(()=>{this.router.navigate(["/home"])},e=>{console.error("Google Sign-In error:",e);let i=e?.code||"";i==="auth/popup-closed-by-user"||i==="auth/cancelled-popup-request"?this.errorMessage="":this.errorMessage=`Erreur lors de la connexion Google (${i})`})}static{this.\u0275fac=function(i){return new(i||n)(Ze(eo),Ze(lr))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-signin"]],decls:22,vars:2,consts:[[1,"min-h-screen","flex","flex-col","items-center","justify-center","bg-gradient-to-br","from-family-pink","via-family-coral","to-family-orange","p-4"],[1,"w-full","max-w-md","flex-1","flex","flex-col","items-center","justify-center"],[1,"text-center","mb-8"],[1,"text-6xl","block","mb-2"],[1,"font-display","font-extrabold","text-3xl","text-white"],[1,"text-white/80","mt-1"],[1,"bg-white","rounded-3xl","shadow-fun","p-8","w-full"],[1,"font-display","font-bold","text-xl","text-center","text-gray-800","mb-6"],[1,"w-full","flex","items-center","justify-center","gap-3","px-6","py-3","rounded-2xl","border-2","border-gray-200","bg-white","hover:bg-gray-50","transition-all","hover:shadow-md","text-gray-700","font-semibold",3,"click"],["viewBox","0 0 24 24",1,"w-5","h-5"],["fill","#4285F4","d","M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"],["fill","#34A853","d","M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"],["fill","#FBBC05","d","M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"],["fill","#EA4335","d","M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"],[1,"mt-4","text-red-400","text-center","text-sm"],[1,"text-center","text-white/60","text-xs","font-bold","pb-4"]],template:function(i,r){i&1&&(Ot(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),Z(4,"\u{1F468}\u200D\u{1F469}\u200D\u{1F467}\u200D\u{1F466}"),At(),Ot(5,"h1",4),Z(6,"Family App"),At(),Ot(7,"p",5),Z(8,"Votre espace famille"),At()(),Ot(9,"div",6)(10,"h2",7),Z(11,"Connexion \u{1F44B}"),At(),Ot(12,"button",8),ho("click",function(){return r.signInWithGoogle()}),on(),Ot(13,"svg",9),zo(14,"path",10)(15,"path",11)(16,"path",12)(17,"path",13),At(),Z(18," Se connecter avec Google "),At(),tt(19,Tme,2,1,"p",14),At()(),ai(),Ot(20,"p",15),Z(21),At()()),i&2&&(te(19),nt(r.errorMessage?19:-1),te(2),tn("v",r.appVersion))},styles:["mat-card[_ngcontent-%COMP%]{width:300px;margin-top:20px}"]})}}return n})();function vF(n){let t=n.cloneNode(!0),e=t.querySelectorAll("[id]"),i=n.nodeName.toLowerCase();t.removeAttribute("id");for(let r=0;r<e.length;r++)e[r].removeAttribute("id");return i==="canvas"?ZW(n,t):(i==="input"||i==="select"||i==="textarea")&&WW(n,t),qW("canvas",n,t,ZW),qW("input, textarea, select",n,t,WW),t}function qW(n,t,e,i){let r=t.querySelectorAll(n);if(r.length){let o=e.querySelectorAll(n);for(let d=0;d<r.length;d++)i(r[d],o[d])}}var Sme=0;function WW(n,t){t.type!=="file"&&(t.value=n.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${Sme++}`)}function ZW(n,t){let e=t.getContext("2d");if(e)try{e.drawImage(n,0,0)}catch(i){}}function SF(n){let t=n.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function bF(n,t,e){let{top:i,bottom:r,left:o,right:d}=n;return e>=i&&e<=r&&t>=o&&t<=d}function Dme(n,t){let e=t.left<n.left,i=t.left+t.width>n.right,r=t.top<n.top,o=t.top+t.height>n.bottom;return e||i||r||o}function qb(n,t,e){n.top+=t,n.bottom=n.top+n.height,n.left+=e,n.right=n.left+n.width}function KW(n,t,e,i){let{top:r,right:o,bottom:d,left:m,width:b,height:T}=n,A=b*t,N=T*t;return i>r-N&&i<d+N&&e>m-A&&e<o+A}var JS=class{_document;positions=new Map;constructor(t){this._document=t}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:SF(e)})})}handleScroll(t){let e=mo(t),i=this.positions.get(e);if(!i)return null;let r=i.scrollPosition,o,d;if(e===this._document){let T=this.getViewportScrollPosition();o=T.top,d=T.left}else o=e.scrollTop,d=e.scrollLeft;let m=r.top-o,b=r.left-d;return this.positions.forEach((T,A)=>{T.clientRect&&e!==A&&e.contains(A)&&qb(T.clientRect,m,b)}),r.top=o,r.left=d,{top:m,left:b}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function a7(n,t){let e=n.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let i=t.createElement("div");return e.forEach(r=>i.appendChild(r)),i}function DF(n,t,e){for(let i in t)if(t.hasOwnProperty(i)){let r=t[i];r?n.setProperty(i,r,e?.has(i)?"important":""):n.removeProperty(i)}return n}function k_(n,t){let e=t?"":"none";DF(n.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function YW(n,t,e){DF(n.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function eD(n,t){return t&&t!="none"?n+" "+t:n}function XW(n,t){n.style.width=`${t.width}px`,n.style.height=`${t.height}px`,n.style.transform=Wb(t.left,t.top)}function Wb(n,t){return`translate3d(${Math.round(n)}px, ${Math.round(t)}px, 0)`}var Hb={capture:!0},_F={passive:!1,capture:!0},Ime=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=Pt({type:n,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],decls:0,vars:0,template:function(i,r){},styles:[`@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}
`],encapsulation:2,changeDetection:0})}return n})(),IF=(()=>{class n{_ngZone=se(jt);_document=se(Ht);_styleLoader=se($a);_renderer=se(pr).createRenderer(null,null);_cleanupDocumentTouchmove;_scroll=new yt;_dropInstances=new Set;_dragInstances=new Set;_activeDragInstances=Zn([]);_globalListeners;_draggingPredicate=e=>e.isDragging();_domNodesToDirectives=null;pointerMove=new yt;pointerUp=new yt;constructor(){}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._cleanupDocumentTouchmove?.(),this._cleanupDocumentTouchmove=this._renderer.listen(this._document,"touchmove",this._persistentTouchmoveListener,_F)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._cleanupDocumentTouchmove?.()}startDragging(e,i){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._styleLoader.load(Ime),this._activeDragInstances.update(r=>[...r,e]),this._activeDragInstances().length===1)){let r=i.type.startsWith("touch"),o=m=>this.pointerUp.next(m),d=[["scroll",m=>this._scroll.next(m),Hb],["selectstart",this._preventDefaultWhileDragging,_F]];r?d.push(["touchend",o,Hb],["touchcancel",o,Hb]):d.push(["mouseup",o,Hb]),r||d.push(["mousemove",m=>this.pointerMove.next(m),_F]),this._ngZone.runOutsideAngular(()=>{this._globalListeners=d.map(([m,b,T])=>this._renderer.listen(this._document,m,b,T))})}}stopDragging(e){this._activeDragInstances.update(i=>{let r=i.indexOf(e);return r>-1?(i.splice(r,1),[...i]):i}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let i=[this._scroll];return e&&e!==this._document&&i.push(new Kt(r=>this._ngZone.runOutsideAngular(()=>{let o=this._renderer.listen(e,"scroll",d=>{this._activeDragInstances().length&&r.next(d)},Hb);return()=>{o()}}))),Tf(...i)}registerDirectiveNode(e,i){this._domNodesToDirectives??=new WeakMap,this._domNodesToDirectives.set(e,i)}removeDirectiveNode(e){this._domNodesToDirectives?.delete(e)}getDragDirectiveForNode(e){return this._domNodesToDirectives?.get(e)||null}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._domNodesToDirectives=null,this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_preventDefaultWhileDragging=e=>{this._activeDragInstances().length>0&&e.preventDefault()};_persistentTouchmoveListener=e=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&e.preventDefault(),this.pointerMove.next(e))};_clearGlobalListeners(){this._globalListeners?.forEach(e=>e()),this._globalListeners=void 0}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function QW(n){let t=n.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(n)*t}function Mme(n){let t=getComputedStyle(n),e=yF(t,"transition-property"),i=e.find(m=>m==="transform"||m==="all");if(!i)return 0;let r=e.indexOf(i),o=yF(t,"transition-duration"),d=yF(t,"transition-delay");return QW(o[r])+QW(d[r])}function yF(n,t){return n.getPropertyValue(t).split(",").map(i=>i.trim())}var Ame=new Set(["position"]),wF=class{_document;_rootElement;_direction;_initialDomRect;_previewTemplate;_previewClass;_pickupPositionOnPage;_initialTransform;_zIndex;_renderer;_previewEmbeddedView=null;_preview;get element(){return this._preview}constructor(t,e,i,r,o,d,m,b,T,A){this._document=t,this._rootElement=e,this._direction=i,this._initialDomRect=r,this._previewTemplate=o,this._previewClass=d,this._pickupPositionOnPage=m,this._initialTransform=b,this._zIndex=T,this._renderer=A}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),JW(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return Mme(this._preview)}addEventListener(t,e){return this._renderer.listen(this._preview,t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,i=t?t.template:null,r;if(i&&t){let o=t.matchSize?this._initialDomRect:null,d=t.viewContainer.createEmbeddedView(i,t.context);d.detectChanges(),r=a7(d,this._document),this._previewEmbeddedView=d,t.matchSize?XW(r,o):r.style.transform=Wb(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else r=vF(this._rootElement),XW(r,this._initialDomRect),this._initialTransform&&(r.style.transform=this._initialTransform);return DF(r.style,{"pointer-events":"none",margin:JW(r)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Ame),k_(r,!1),r.classList.add("cdk-drag-preview"),r.setAttribute("popover","manual"),r.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(o=>r.classList.add(o)):r.classList.add(e)),r}};function JW(n){return"showPopover"in n}var kme={passive:!0},e7={passive:!1},Rme={passive:!1,capture:!0},Pme=800,t7="cdk-drag-placeholder",n7=new Set(["position"]);function l7(n,t,e={dragStartThreshold:5,pointerDirectionChangeThreshold:5}){let i=n.get(Br,null,{optional:!0})||n.get(pr).createRenderer(null,null);return new xF(t,e,n.get(Ht),n.get(jt),n.get(Xd),n.get(IF),i)}var xF=class{_config;_document;_ngZone;_viewportRuler;_dragDropRegistry;_renderer;_rootElementCleanups;_cleanupShadowRootSelectStart;_preview=null;_previewContainer;_placeholderRef=null;_placeholder;_pickupPositionInElement;_pickupPositionOnPage;_marker;_anchor=null;_passiveTransform={x:0,y:0};_activeTransform={x:0,y:0};_initialTransform;_hasStartedDragging=Zn(!1);_hasMoved=!1;_initialContainer;_initialIndex;_parentPositions;_moveEvents=new yt;_pointerDirectionDelta;_pointerPositionAtLastDirectionChange;_lastKnownPointerPosition;_rootElement;_ownerSVGElement=null;_rootElementTapHighlight;_pointerMoveSubscription=Gn.EMPTY;_pointerUpSubscription=Gn.EMPTY;_scrollSubscription=Gn.EMPTY;_resizeSubscription=Gn.EMPTY;_lastTouchEventTime;_dragStartTime;_boundaryElement=null;_nativeInteractionsEnabled=!0;_initialDomRect;_previewRect;_boundaryRect;_previewTemplate;_placeholderTemplate;_handles=[];_disabledHandles=new Set;_dropContainer;_direction="ltr";_parentDragRef=null;_cachedShadowRoot;lockAxis=null;dragStartDelay=0;previewClass;scale=1;get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>k_(e,t)))}_disabled=!1;beforeStarted=new yt;started=new yt;released=new yt;ended=new yt;entered=new yt;exited=new yt;dropped=new yt;moved=this._moveEvents;data;constrainPosition;constructor(t,e,i,r,o,d,m){this._config=e,this._document=i,this._ngZone=r,this._viewportRuler=o,this._dragDropRegistry=d,this._renderer=m,this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new JS(i),d.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(i=>go(i)),this._handles.forEach(i=>k_(i,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&e.add(i)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=go(t);if(e!==this._rootElement){this._removeRootElementListeners();let i=this._renderer;this._rootElementCleanups=this._ngZone.runOutsideAngular(()=>[i.listen(e,"mousedown",this._pointerDown,e7),i.listen(e,"touchstart",this._pointerDown,kme),i.listen(e,"dragstart",this._nativeDragStart,e7)]),this._initialTransform=void 0,this._rootElement=e}return typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?go(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(),this.isDragging()&&this._rootElement?.remove(),this._marker?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._marker=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}resetToBoundary(){if(this._boundaryElement&&this._rootElement&&Dme(this._boundaryElement.getBoundingClientRect(),this._rootElement.getBoundingClientRect())){let t=this._boundaryElement.getBoundingClientRect(),e=this._rootElement.getBoundingClientRect(),i=0,r=0;e.left<t.left?i=t.left-e.left:e.right>t.right&&(i=t.right-e.right),e.top<t.top?r=t.top-e.top:e.bottom>t.bottom&&(r=t.bottom-e.bottom);let o=this._activeTransform.x,d=this._activeTransform.y,m=o+i,b=d+r;this._rootElement.style.transform=Wb(m,b),this._activeTransform={x:m,y:b},this._passiveTransform={x:m,y:b}}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),k_(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),k_(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._cleanupShadowRootSelectStart?.(),this._cleanupShadowRootSelectStart=void 0}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._anchor?.remove(),this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._anchor=this._placeholderRef=null}_pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)};_pointerMove=t=>{let e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging()){let r=Math.abs(e.x-this._pickupPositionOnPage.x),o=Math.abs(e.y-this._pickupPositionOnPage.y);if(r+o>=this._config.dragStartThreshold){let m=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),b=this._dropContainer;if(!m){this._endDragSequence(t);return}(!b||!b.isDragging()&&!b.isReceiving())&&(t.cancelable&&t.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(t)))}return}t.cancelable&&t.preventDefault();let i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{let r=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,o=this._activeTransform;o.x=i.x-r.x+this._passiveTransform.x,o.y=i.y-r.y+this._passiveTransform.y,this._applyRootElementTransform(o.x,o.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})};_pointerUp=t=>{this._endDragSequence(t)};_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){Gb(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),i=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{this._cleanupShadowRootSelectStart=this._renderer.listen(e,"selectstart",Nme,Rme)}),i){let r=this._rootElement,o=r.parentNode,d=this._placeholder=this._createPlaceholderElement(),m=this._marker=this._marker||this._document.createComment("");o.insertBefore(m,r),this._initialTransform=r.style.transform||"",this._preview=new wF(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3,this._renderer),this._preview.attach(this._getPreviewInsertionPoint(o,e)),YW(r,!1,n7),this._document.body.appendChild(o.replaceChild(d,r)),this.started.next({source:this,event:t}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let i=this.isDragging(),r=Gb(e),o=!r&&e.button!==0,d=this._rootElement,m=mo(e),b=!r&&this._lastTouchEventTime&&this._lastTouchEventTime+Pme>Date.now(),T=r?cp(e):lp(e);if(m&&m.draggable&&e.type==="mousedown"&&e.preventDefault(),i||o||b||T)return;if(this._handles.length){let q=d.style;this._rootElementTapHighlight=q.webkitTapHighlightColor||"",q.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(q=>this._updateOnScroll(q)),this._boundaryElement&&(this._boundaryRect=SF(this._boundaryElement));let A=this._previewTemplate;this._pickupPositionInElement=A&&A.template&&!A.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let N=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:N.x,y:N.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){YW(this._rootElement,!0,n7),this._marker.parentNode.replaceChild(this._rootElement,this._marker),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,i=e.getItemIndex(this),r=this._getPointerPositionOnPage(t),o=this._getDragDistance(r),d=e._isOverContainer(r.x,r.y);this.ended.next({source:this,distance:o,dropPoint:r,event:t}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:d,distance:o,dropPoint:r,event:t}),e.drop(this,i,this._initialIndex,this._initialContainer,d,o,r,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:r}){let o=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!o&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(o=this._initialContainer),o&&o!==this._dropContainer&&this._ngZone.run(()=>{let d=this._dropContainer.getItemIndex(this),m=this._dropContainer.getItemAtIndex(d+1)?.getVisibleElement()||null;this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._conditionallyInsertAnchor(o,this._dropContainer,m),this._dropContainer=o,this._dropContainer.enter(this,t,e,o===this._initialContainer&&o.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:o,currentIndex:o.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,r),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let r=m=>{(!m||this._preview&&mo(m)===this._preview.element&&m.propertyName==="transform")&&(d(),i(),clearTimeout(o))},o=setTimeout(r,e*1.5),d=this._preview.addEventListener("transitionend",r)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=a7(this._placeholderRef,this._document)):i=vF(this._rootElement),i.style.pointerEvents="none",i.classList.add(t7),i}_getPointerPositionInElement(t,e,i){let r=e===this._rootElement?null:e,o=r?r.getBoundingClientRect():t,d=Gb(i)?i.targetTouches[0]:i,m=this._getViewportScrollPosition(),b=d.pageX-o.left-m.left,T=d.pageY-o.top-m.top;return{x:o.left-t.left+b,y:o.top-t.top+T}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),i=Gb(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,r=i.pageX-e.left,o=i.pageY-e.top;if(this._ownerSVGElement){let d=this._ownerSVGElement.getScreenCTM();if(d){let m=this._ownerSVGElement.createSVGPoint();return m.x=r,m.y=o,m.matrixTransform(d.inverse())}}return{x:r,y:o}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:r}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?r=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:o,y:d}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,m=this._boundaryRect,{width:b,height:T}=this._getPreviewRect(),A=m.top+d,N=m.bottom-(T-d),q=m.left+o,J=m.right-(b-o);i=i7(i,q,J),r=i7(r,A,N)}return{x:i,y:r}}_updatePointerDirectionDelta(t){let{x:e,y:i}=t,r=this._pointerDirectionDelta,o=this._pointerPositionAtLastDirectionChange,d=Math.abs(e-o.x),m=Math.abs(i-o.y);return d>this._config.pointerDirectionChangeThreshold&&(r.x=e>o.x?1:-1,o.x=e),m>this._config.pointerDirectionChangeThreshold&&(r.y=i>o.y?1:-1,o.y=i),r}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,k_(this._rootElement,t))}_removeRootElementListeners(){this._rootElementCleanups?.forEach(t=>t()),this._rootElementCleanups=void 0}_applyRootElementTransform(t,e){let i=1/this.scale,r=Wb(t*i,e*i),o=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=o.transform&&o.transform!="none"?o.transform:""),o.transform=eD(r,this._initialTransform)}_applyPreviewTransform(t,e){let i=this._previewTemplate?.template?void 0:this._initialTransform,r=Wb(t,e);this._preview.setTransform(eD(r,i))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),r=this._boundaryElement.getBoundingClientRect();if(r.width===0&&r.height===0||i.width===0&&i.height===0)return;let o=r.left-i.left,d=i.right-r.right,m=r.top-i.top,b=i.bottom-r.bottom;r.width>i.width?(o>0&&(t+=o),d>0&&(t-=d)):t=0,r.height>i.height?(m>0&&(e+=m),b>0&&(e-=b)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:Gb(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let i=mo(t);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&qb(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=up(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let i=this._previewContainer||"global";if(i==="parent")return t;if(i==="global"){let r=this._document;return e||r.fullscreenElement||r.webkitFullscreenElement||r.mozFullScreenElement||r.msFullscreenElement||r.body}return go(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_nativeDragStart=t=>{if(this._handles.length){let e=this._getTargetHandle(t);e&&!this._disabledHandles.has(e)&&!this.disabled&&t.preventDefault()}else this.disabled||t.preventDefault()};_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}_conditionallyInsertAnchor(t,e,i){if(t===this._initialContainer)this._anchor?.remove(),this._anchor=null;else if(e===this._initialContainer&&e.hasAnchor){let r=this._anchor??=vF(this._placeholder);r.classList.remove(t7),r.classList.add("cdk-drag-anchor"),r.style.transform="",i?i.before(r):go(e.element).appendChild(r)}}};function i7(n,t,e){return Math.max(t,Math.min(e,n))}function Gb(n){return n.type[0]==="t"}function Nme(n){n.preventDefault()}function nD(n,t,e){let i=r7(t,n.length-1),r=r7(e,n.length-1);if(i===r)return;let o=n[i],d=r<i?-1:1;for(let m=i;m!==r;m+=d)n[m]=n[m+d];n[r]=o}function r7(n,t){return Math.max(0,Math.min(t,n))}var tD=class{_dragDropRegistry;_element;_sortPredicate;_itemPositions=[];_activeDraggables;orientation="vertical";direction="ltr";constructor(t){this._dragDropRegistry=t}_previousSwap={drag:null,delta:0,overlaps:!1};start(t){this.withItems(t)}sort(t,e,i,r){let o=this._itemPositions,d=this._getItemIndexFromPointerPosition(t,e,i,r);if(d===-1&&o.length>0)return null;let m=this.orientation==="horizontal",b=o.findIndex(Te=>Te.drag===t),T=o[d],A=o[b].clientRect,N=T.clientRect,q=b>d?1:-1,J=this._getItemOffsetPx(A,N,q),K=this._getSiblingOffsetPx(b,o,q),xe=o.slice();return nD(o,b,d),o.forEach((Te,Ge)=>{if(xe[Ge]===Te)return;let Et=Te.drag===t,kt=Et?J:K,Ue=Et?t.getPlaceholderElement():Te.drag.getRootElement();Te.offset+=kt;let Oe=Math.round(Te.offset*(1/Te.drag.scale));m?(Ue.style.transform=eD(`translate3d(${Oe}px, 0, 0)`,Te.initialTransform),qb(Te.clientRect,0,kt)):(Ue.style.transform=eD(`translate3d(0, ${Oe}px, 0)`,Te.initialTransform),qb(Te.clientRect,kt,0))}),this._previousSwap.overlaps=bF(N,e,i),this._previousSwap.drag=T.drag,this._previousSwap.delta=m?r.x:r.y,{previousIndex:b,currentIndex:d}}enter(t,e,i,r){let o=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r,d=this._activeDraggables,m=d.indexOf(t),b=t.getPlaceholderElement(),T=d[o];if(T===t&&(T=d[o+1]),!T&&(o==null||o===-1||o<d.length-1)&&this._shouldEnterAsFirstChild(e,i)&&(T=d[0]),m>-1&&d.splice(m,1),T&&!this._dragDropRegistry.isDragging(T)){let A=T.getRootElement();A.parentElement.insertBefore(b,A),d.splice(o,0,t)}else this._element.appendChild(b),d.push(t);b.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let i=this._itemPositions.find(r=>r.drag===t)?.initialTransform;e.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return this._getVisualItemPositions().findIndex(e=>e.drag===t)}getItemAtIndex(t){return this._getVisualItemPositions()[t]?.drag||null}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:i})=>{qb(i,t,e)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let i=e.getVisibleElement();return{drag:e,offset:0,initialTransform:i.style.transform||"",clientRect:SF(i)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_getVisualItemPositions(){return this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions}_getItemOffsetPx(t,e,i){let r=this.orientation==="horizontal",o=r?e.left-t.left:e.top-t.top;return i===-1&&(o+=r?e.width-t.width:e.height-t.height),o}_getSiblingOffsetPx(t,e,i){let r=this.orientation==="horizontal",o=e[t].clientRect,d=e[t+i*-1],m=o[r?"width":"height"]*i;if(d){let b=r?"left":"top",T=r?"right":"bottom";i===-1?m-=d.clientRect[b]-o[T]:m+=o[b]-d.clientRect[T]}return m}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,r=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let d=i[i.length-1].clientRect;return r?t>=d.right:e>=d.bottom}else{let d=i[0].clientRect;return r?t<=d.left:e<=d.top}}_getItemIndexFromPointerPosition(t,e,i,r){let o=this.orientation==="horizontal",d=this._itemPositions.findIndex(({drag:m,clientRect:b})=>{if(m===t)return!1;if(r){let T=o?r.x:r.y;if(m===this._previousSwap.drag&&this._previousSwap.overlaps&&T===this._previousSwap.delta)return!1}return o?e>=Math.floor(b.left)&&e<Math.floor(b.right):i>=Math.floor(b.top)&&i<Math.floor(b.bottom)});return d===-1||!this._sortPredicate(d,t)?-1:d}},EF=class{_document;_dragDropRegistry;_element;_sortPredicate;_rootNode;_activeItems;_previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1};_relatedNodes=[];constructor(t,e){this._document=t,this._dragDropRegistry=e}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let i=0;i<e.length;i++){let r=e[i];this._relatedNodes.push([r,r.nextSibling])}this.withItems(t)}sort(t,e,i,r){let o=this._getItemIndexFromPointerPosition(t,e,i),d=this._previousSwap;if(o===-1||this._activeItems[o]===t)return null;let m=this._activeItems[o];if(d.drag===m&&d.overlaps&&d.deltaX===r.x&&d.deltaY===r.y)return null;let b=this.getItemIndex(t),T=t.getPlaceholderElement(),A=m.getRootElement();o>b?A.after(T):A.before(T),nD(this._activeItems,b,o);let N=this._getRootNode().elementFromPoint(e,i);return d.deltaX=r.x,d.deltaY=r.y,d.drag=m,d.overlaps=A===N||A.contains(N),{previousIndex:b,currentIndex:o}}enter(t,e,i,r){let o=this._activeItems.indexOf(t);o>-1&&this._activeItems.splice(o,1);let d=r==null||r<0?this._getItemIndexFromPointerPosition(t,e,i):r;d===-1&&(d=this._getClosestItemIndexToPointer(t,e,i));let m=this._activeItems[d];m&&!this._dragDropRegistry.isDragging(m)?(this._activeItems.splice(d,0,t),m.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let i=this._relatedNodes.length-1;i>-1;i--){let[r,o]=this._relatedNodes[i];r.parentNode===t&&r.nextSibling!==o&&(o===null?t.appendChild(r):o.parentNode===t&&t.insertBefore(r,o))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}getItemAtIndex(t){return this._activeItems[t]||null}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,i){let r=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(i)),o=r?this._activeItems.findIndex(d=>{let m=d.getRootElement();return r===m||m.contains(r)}):-1;return o===-1||!this._sortPredicate(o,t)?-1:o}_getRootNode(){return this._rootNode||(this._rootNode=up(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,i){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let r=1/0,o=-1;for(let d=0;d<this._activeItems.length;d++){let m=this._activeItems[d];if(m!==t){let{x:b,y:T}=m.getRootElement().getBoundingClientRect(),A=Math.hypot(e-b,i-T);A<r&&(r=A,o=d)}}return o}},o7=.05,c7=.05,Qa=(function(n){return n[n.NONE=0]="NONE",n[n.UP=1]="UP",n[n.DOWN=2]="DOWN",n})(Qa||{}),Is=(function(n){return n[n.NONE=0]="NONE",n[n.LEFT=1]="LEFT",n[n.RIGHT=2]="RIGHT",n})(Is||{});function u7(n,t){return new CF(t,n.get(IF),n.get(Ht),n.get(jt),n.get(Xd))}var CF=class{_dragDropRegistry;_ngZone;_viewportRuler;element;disabled=!1;sortingDisabled=!1;lockAxis=null;autoScrollDisabled=!1;autoScrollStep=2;hasAnchor=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;beforeStarted=new yt;entered=new yt;exited=new yt;dropped=new yt;sorted=new yt;receivingStarted=new yt;receivingStopped=new yt;data;_container;_isDragging=!1;_parentPositions;_sortStrategy;_domRect;_draggables=[];_siblings=[];_activeSiblings=new Set;_viewportScrollSubscription=Gn.EMPTY;_verticalScrollDirection=Qa.NONE;_horizontalScrollDirection=Is.NONE;_scrollNode;_stopScrollTimers=new yt;_cachedShadowRoot=null;_document;_scrollableElements=[];_initialScrollSnap;_direction="ltr";constructor(t,e,i,r,o){this._dragDropRegistry=e,this._ngZone=r,this._viewportRuler=o;let d=this.element=go(t);this._document=i,this.withOrientation("vertical").withElementContainer(d),e.registerDropContainer(this),this._parentPositions=new JS(i)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,r){this._draggingStarted(),r==null&&this.sortingDisabled&&(r=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,i,r),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,r,o,d,m,b={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:r,isPointerOverContainer:o,distance:d,dropPoint:m,event:b})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(e.filter(r=>r.isDragging()).every(r=>t.indexOf(r)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof tD&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new EF(this._document,this._dragDropRegistry);else{let e=new tD(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,i)=>this.sortPredicate(e,i,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=go(this.element),i=this._scrollableElements.indexOf(this._container),r=this._scrollableElements.indexOf(t);return i>-1&&this._scrollableElements.splice(i,1),r>-1&&this._scrollableElements.splice(r,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}getItemAtIndex(t){return this._isDragging?this._sortStrategy.getItemAtIndex(t):this._draggables[t]||null}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,r){if(this.sortingDisabled||!this._domRect||!KW(this._domRect,o7,e,i))return;let o=this._sortStrategy.sort(t,e,i,r);o&&this.sorted.next({previousIndex:o.previousIndex,currentIndex:o.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,r=Qa.NONE,o=Is.NONE;if(this._parentPositions.positions.forEach((d,m)=>{m===this._document||!d.clientRect||i||KW(d.clientRect,o7,t,e)&&([r,o]=Ome(m,d.clientRect,this._direction,t,e),(r||o)&&(i=m))}),!r&&!o){let{width:d,height:m}=this._viewportRuler.getViewportSize(),b={width:d,height:m,top:0,right:d,bottom:m,left:0};r=d7(b,e),o=h7(b,t),i=window}i&&(r!==this._verticalScrollDirection||o!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=r,this._horizontalScrollDirection=o,this._scrollNode=i,(r||o)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_startScrollInterval=()=>{this._stopScrolling(),ov(0,jx).pipe(Bo(this._stopScrollTimers)).subscribe(()=>{let t=this._scrollNode,e=this.autoScrollStep;this._verticalScrollDirection===Qa.UP?t.scrollBy(0,-e):this._verticalScrollDirection===Qa.DOWN&&t.scrollBy(0,e),this._horizontalScrollDirection===Is.LEFT?t.scrollBy(-e,0):this._horizontalScrollDirection===Is.RIGHT&&t.scrollBy(e,0)})};_isOverContainer(t,e){return this._domRect!=null&&bF(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(r=>r._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._domRect||!bF(this._domRect,e,i)||!this.enterPredicate(t,this))return!1;let r=this._getShadowRoot().elementFromPoint(e,i);return r?r===this._container||this._container.contains(r):!1}_startReceiving(t,e){let i=this._activeSiblings;!i.has(t)&&e.every(r=>this.enterPredicate(r,this)||this._draggables.indexOf(r)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=up(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function d7(n,t){let{top:e,bottom:i,height:r}=n,o=r*c7;return t>=e-o&&t<=e+o?Qa.UP:t>=i-o&&t<=i+o?Qa.DOWN:Qa.NONE}function h7(n,t){let{left:e,right:i,width:r}=n,o=r*c7;return t>=e-o&&t<=e+o?Is.LEFT:t>=i-o&&t<=i+o?Is.RIGHT:Is.NONE}function Ome(n,t,e,i,r){let o=d7(t,r),d=h7(t,i),m=Qa.NONE,b=Is.NONE;if(o){let T=n.scrollTop;o===Qa.UP?T>0&&(m=Qa.UP):n.scrollHeight-T>n.clientHeight&&(m=Qa.DOWN)}if(d){let T=n.scrollLeft;e==="rtl"?d===Is.RIGHT?T<0&&(b=Is.RIGHT):n.scrollWidth+T>n.clientWidth&&(b=Is.LEFT):d===Is.LEFT?T>0&&(b=Is.LEFT):n.scrollWidth-T>n.clientWidth&&(b=Is.RIGHT)}return[m,b]}var Fme=(()=>{class n{_injector=se(en);constructor(){}createDrag(e,i){return l7(this._injector,e,i)}createDropList(e){return u7(this._injector,e)}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),s7=new rt("CDK_DRAG_PARENT");var Lme=new rt("CdkDragHandle");var f7=new rt("CDK_DRAG_CONFIG"),p7=new rt("CdkDropList"),m7=(()=>{class n{element=se(Fn);dropContainer=se(p7,{optional:!0,skipSelf:!0});_ngZone=se(jt);_viewContainerRef=se(ua);_dir=se(Wd,{optional:!0});_changeDetectorRef=se(Uo);_selfHandle=se(Lme,{optional:!0,self:!0});_parentDrag=se(s7,{optional:!0,skipSelf:!0});_dragDropRegistry=se(IF);_destroyed=new yt;_handles=new Fr([]);_previewTemplate=null;_placeholderTemplate=null;_dragRef;data;lockAxis=null;rootElementSelector;boundaryElement;dragStartDelay;freeDragPosition;get disabled(){return this._disabled||!!(this.dropContainer&&this.dropContainer.disabled)}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}_disabled=!1;constrainPosition;previewClass;previewContainer;scale=1;started=new xn;released=new xn;ended=new xn;entered=new xn;exited=new xn;dropped=new xn;moved=new Kt(e=>{let i=this._dragRef.moved.pipe(Tn(r=>({source:this,pointerPosition:r.pointerPosition,event:r.event,delta:r.delta,distance:r.distance}))).subscribe(e);return()=>{i.unsubscribe()}});_injector=se(en);constructor(){let e=this.dropContainer,i=se(f7,{optional:!0});this._dragRef=l7(this._injector,this.element,{dragStartThreshold:i&&i.dragStartThreshold!=null?i.dragStartThreshold:5,pointerDirectionChangeThreshold:i&&i.pointerDirectionChangeThreshold!=null?i.pointerDirectionChangeThreshold:5,zIndex:i?.zIndex}),this._dragRef.data=this,this._dragDropRegistry.registerDirectiveNode(this.element.nativeElement,this),i&&this._assignDefaults(i),e&&(e.addItem(this),e._dropListRef.beforeStarted.pipe(Bo(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}resetToBoundary(){this._dragRef.resetToBoundary()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){co(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let i=e.rootElementSelector,r=e.freeDragPosition;i&&!i.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this),this._dragDropRegistry.removeDirectiveNode(this.element.nativeElement),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let i=this._handles.getValue();i.push(e),this._handles.next(i)}_removeHandle(e){let i=this._handles.getValue(),r=i.indexOf(e);r>-1&&(i.splice(r,1),this._handles.next(i))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,i=e;this.rootElementSelector&&(i=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(i||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):go(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let i=this._dir,r=this.dragStartDelay,o=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,d=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof r=="object"&&r?r:Hd(r),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(o).withPreviewTemplate(d).withPreviewContainer(this.previewContainer||"global"),i&&e.withDirection(i.value)}}),e.beforeStarted.pipe(Xi(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let i=this.element.nativeElement.parentElement;for(;i;){let r=this._dragDropRegistry.getDragDirectiveForNode(i);if(r){e.withParent(r._dragRef);break}i=i.parentElement}})}_handleEvents(e){e.started.subscribe(i=>{this.started.emit({source:this,event:i.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(i=>{this.released.emit({source:this,event:i.event})}),e.ended.subscribe(i=>{this.ended.emit({source:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:i.container.data,item:this,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:i.container.data,item:this})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,isPointerOverContainer:i.isPointerOverContainer,item:this,distance:i.distance,dropPoint:i.dropPoint,event:i.event})})}_assignDefaults(e){let{lockAxis:i,dragStartDelay:r,constrainPosition:o,previewClass:d,boundaryElement:m,draggingDisabled:b,rootElementSelector:T,previewContainer:A}=e;this.disabled=b??!1,this.dragStartDelay=r||0,this.lockAxis=i||null,o&&(this.constrainPosition=o),d&&(this.previewClass=d),m&&(this.boundaryElement=m),T&&(this.rootElementSelector=T),A&&(this.previewContainer=A)}_setupHandlesListener(){this._handles.pipe(Ia(e=>{let i=e.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&i.push(this.element),this._dragRef.withHandles(i)}),Kr(e=>Tf(...e.map(i=>i._stateChanges.pipe(ra(i))))),Bo(this._destroyed)).subscribe(e=>{let i=this._dragRef,r=e.element.nativeElement;e.disabled?i.disableHandle(r):i.enableHandle(r)})}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(i,r){i&2&&ji("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",gr],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Hv]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],features:[fo([{provide:s7,useExisting:n}]),Co]})}return n})(),TF=new rt("CdkDropListGroup"),g7=(()=>{class n{_items=new Set;disabled=!1;ngOnDestroy(){this._items.clear()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","cdkDropListGroup",""]],inputs:{disabled:[2,"cdkDropListGroupDisabled","disabled",gr]},exportAs:["cdkDropListGroup"],features:[fo([{provide:TF,useExisting:n}])]})}return n})(),_7=(()=>{class n{element=se(Fn);_changeDetectorRef=se(Uo);_scrollDispatcher=se(F0);_dir=se(Wd,{optional:!0});_group=se(TF,{optional:!0,skipSelf:!0});_latestSortedRefs;_destroyed=new yt;_scrollableParentsResolved=!1;static _dropLists=[];_dropListRef;connectedTo=[];data;orientation="vertical";id=se(ga).getId("cdk-drop-list-");lockAxis=null;get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}_disabled=!1;sortingDisabled=!1;enterPredicate=()=>!0;sortPredicate=()=>!0;autoScrollDisabled=!1;autoScrollStep;elementContainerSelector=null;hasAnchor=!1;dropped=new xn;entered=new xn;exited=new xn;sorted=new xn;_unsortedItems=new Set;constructor(){let e=se(f7,{optional:!0}),i=se(en);this._dropListRef=u7(i,this.element),this._dropListRef.data=this,e&&this._assignDefaults(e),this._dropListRef.enterPredicate=(r,o)=>this.enterPredicate(r.data,o.data),this._dropListRef.sortPredicate=(r,o,d)=>this.sortPredicate(r,o.data,d.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),n._dropLists.push(this),this._group&&this._group._items.add(this)}addItem(e){this._unsortedItems.add(e),e._dragRef._withDropContainer(this._dropListRef),this._dropListRef.isDragging()&&this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef))}removeItem(e){if(this._unsortedItems.delete(e),this._latestSortedRefs){let i=this._latestSortedRefs.indexOf(e._dragRef);i>-1&&(this._latestSortedRefs.splice(i,1),this._syncItemsWithRef(this._latestSortedRefs))}}getSortedItems(){return Array.from(this._unsortedItems).sort((e,i)=>e._dragRef.getVisibleElement().compareDocumentPosition(i._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=n._dropLists.indexOf(this);e>-1&&n._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._latestSortedRefs=void 0,this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(ra(this._dir.value),Bo(this._destroyed)).subscribe(i=>e.withDirection(i)),e.beforeStarted.subscribe(()=>{let i=Gd(this.connectedTo).map(r=>{if(typeof r=="string"){let o=n._dropLists.find(d=>d.id===r);return o}return r});if(this._group&&this._group._items.forEach(r=>{i.indexOf(r)===-1&&i.push(r)}),!this._scrollableParentsResolved){let r=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(o=>o.getElementRef().nativeElement);this._dropListRef.withScrollableParents(r),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let r=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(r)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Hd(this.autoScrollStep,2),e.hasAnchor=this.hasAnchor,e.connectedTo(i.filter(r=>r&&r!==this).map(r=>r._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(this.getSortedItems().map(i=>i._dragRef)),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(i=>{this.entered.emit({container:this,item:i.item.data,currentIndex:i.currentIndex})}),e.exited.subscribe(i=>{this.exited.emit({container:this,item:i.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(i=>{this.sorted.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,container:this,item:i.item.data})}),e.dropped.subscribe(i=>{this.dropped.emit({previousIndex:i.previousIndex,currentIndex:i.currentIndex,previousContainer:i.previousContainer.data,container:i.container.data,item:i.item.data,isPointerOverContainer:i.isPointerOverContainer,distance:i.distance,dropPoint:i.dropPoint,event:i.event}),this._changeDetectorRef.markForCheck()}),Tf(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:i,draggingDisabled:r,sortingDisabled:o,listAutoScrollDisabled:d,listOrientation:m}=e;this.disabled=r??!1,this.sortingDisabled=o??!1,this.autoScrollDisabled=d??!1,this.orientation=m||"vertical",this.lockAxis=i||null}_syncItemsWithRef(e){this._latestSortedRefs=e,this._dropListRef.withItems(e)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=sn({type:n,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(i,r){i&2&&(uo("id",r.id),ji("cdk-drop-list-disabled",r.disabled)("cdk-drop-list-dragging",r._dropListRef.isDragging())("cdk-drop-list-receiving",r._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",gr],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",gr],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",gr],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"],hasAnchor:[2,"cdkDropListHasAnchor","hasAnchor",gr]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],features:[fo([{provide:TF,useValue:void 0},{provide:p7,useExisting:n}])]})}return n})();var y7=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=In({type:n});static \u0275inj=Dn({providers:[Fme],imports:[oT]})}return n})();var v7=(()=>{class n{constructor(e){this.tasksService=e}transferTask(e,i,r,o){let d=Mt(Be({},i),{statut:o});this.tasksService.updateTaskStatus(d),e.splice(e.indexOf(i),1),r.push(d)}static{this.\u0275fac=function(i){return new(i||n)(vt(Ac))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function jme(n,t){if(n&1&&st(0,"img",24),n&2){let e=t.$implicit;Ft("src",e,Vi)}}function zme(n,t){if(n&1){let e=Tt();V(0,"div",10)(1,"div",19),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.onEdit(r.id))}),V(2,"span",20),Z(3),U(),V(4,"h4",21),Z(5),U(),V(6,"div",22)(7,"div",23),qt(8,jme,1,1,"img",24,So),U(),V(10,"span",25),Z(11),U()()()()}if(n&2){let e=t.$implicit,i=_e();te(2),Ft("ngClass",i.getUrgencyClass(e.urg)),te(),ht(e.urg),te(2),ht(e.title),te(3),Wt(i.getAssigneeAvatars(e)),te(3),ht(e.name)}}function Ume(n,t){if(n&1&&st(0,"img",24),n&2){let e=t.$implicit;Ft("src",e,Vi)}}function $me(n,t){if(n&1){let e=Tt();V(0,"div",10)(1,"div",26),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.onEdit(r.id))}),V(2,"span",20),Z(3),U(),V(4,"h4",21),Z(5),U(),V(6,"div",22)(7,"div",23),qt(8,Ume,1,1,"img",24,So),U(),V(10,"span",25),Z(11),U()()()()}if(n&2){let e=t.$implicit,i=_e();te(2),Ft("ngClass",i.getUrgencyClass(e.urg)),te(),ht(e.urg),te(2),ht(e.title),te(3),Wt(i.getAssigneeAvatars(e)),te(3),ht(e.name)}}function Hme(n,t){if(n&1&&st(0,"img",24),n&2){let e=t.$implicit;Ft("src",e,Vi)}}function Gme(n,t){if(n&1){let e=Tt();V(0,"div",10)(1,"div",27),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.onEdit(r.id))}),V(2,"span",20),Z(3),U(),V(4,"h4",21),Z(5),U(),V(6,"div",22)(7,"div",23),qt(8,Hme,1,1,"img",24,So),U(),V(10,"span",25),Z(11),U()()()()}if(n&2){let e=t.$implicit,i=_e();te(2),Ft("ngClass",i.getUrgencyClass(e.urg)),te(),ht(e.urg),te(2),ht(e.title),te(3),Wt(i.getAssigneeAvatars(e)),te(3),ht(e.name)}}function qme(n,t){if(n&1&&st(0,"img",29),n&2){let e=t.$implicit;Ft("src",e,Vi)}}function Wme(n,t){if(n&1){let e=Tt();V(0,"div",10)(1,"div",28),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.onEdit(r.id))}),V(2,"span",20),Z(3),U(),V(4,"h4",21),Z(5),U(),V(6,"div",22)(7,"div",23),qt(8,qme,1,1,"img",29,So),U(),V(10,"span",25),Z(11),U()()()()}if(n&2){let e=t.$implicit,i=_e();te(2),Ft("ngClass",i.getUrgencyClass(e.urg)),te(),ht(e.urg),te(2),ht(e.title),te(3),Wt(i.getAssigneeAvatars(e)),te(3),ht(e.name)}}function Zme(n,t){if(n&1&&st(0,"img",29),n&2){let e=t.$implicit;Ft("src",e,Vi)}}function Kme(n,t){if(n&1){let e=Tt();V(0,"div",10)(1,"div",30),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.onEdit(r.id))}),V(2,"span",20),Z(3),U(),V(4,"h4",21),Z(5),U(),V(6,"div",22)(7,"div",23),qt(8,Zme,1,1,"img",29,So),U(),V(10,"span",25),Z(11),U()()()()}if(n&2){let e=t.$implicit,i=_e();te(2),Ft("ngClass",i.getUrgencyClass(e.urg)),te(),ht(e.urg),te(2),ht(e.title),te(3),Wt(i.getAssigneeAvatars(e)),te(3),ht(e.name)}}var b7=(()=>{class n{constructor(e,i,r,o,d,m){this.ts=e,this.dialog=i,this.router=r,this.kanbanService=o,this.authService=d,this.snackBar=m,this.userAvatars={},this.allUserAvatars=[],this.new=[],this.en_cours=[],this.fait=[],this.bloquer=[],this.archiver=[],fg(()=>{let b=this.ts.tasks();this.new=b.filter(T=>T.statut==="Nouveau"),this.en_cours=b.filter(T=>T.statut==="En cours"),this.fait=b.filter(T=>T.statut==="Fait"),this.bloquer=b.filter(T=>T.statut==="Bloque"),this.archiver=b.filter(T=>T.statut==="Archive")})}ngOnInit(){this.authService.getAllUsers().then(e=>{e.forEach(i=>{i.displayName&&i.photoURL&&(this.userAvatars[i.displayName]=i.photoURL,this.allUserAvatars.push(i.photoURL))})})}isForEveryone(e){return e.name==="Tout le monde"}getAssigneeAvatars(e){return this.isForEveryone(e)?this.allUserAvatars:e.name.split(",").map(r=>r.trim()).map(r=>this.userAvatars[r]).filter(r=>r!=null)}drop(e){if(e.previousContainer===e.container)nD(e.container.data,e.previousIndex,e.currentIndex);else{let i=e.previousContainer.data[e.previousIndex],r=this.getStatusFromContainer(e.container.id);this.kanbanService.transferTask(e.previousContainer.data,i,e.container.data,r),this.snackBar.open(`T\xE2che d\xE9plac\xE9e \u2192 ${r}`,"",{duration:2e3})}}getStatusFromContainer(e){switch(e){case"newContainer":return"Nouveau";case"inProgressContainer":return"En cours";case"doneContainer":return"Fait";case"bloqueContainer":return"Bloque";case"archiveContainer":return"Archive";default:return"Nouveau"}}getUrgencyClass(e){switch(e){case"Urgent":return"flex h-6 items-center rounded-full bg-red-100 px-3 text-xs font-semibold text-red-600";case"Relativement urgent":return"flex h-6 items-center rounded-full bg-yellow-100 px-3 text-xs font-semibold text-yellow-600";case"Pas urgent":return"flex h-6 items-center rounded-full bg-green-100 px-3 text-xs font-semibold text-green-600";default:return"flex h-6 items-center rounded-full bg-gray-100 px-3 text-xs font-semibold text-gray-600"}}onEdit(e){this.router.navigate(["/task/edit",e])}static{this.\u0275fac=function(i){return new(i||n)(Ze(Ac),Ze(ya),Ze(lr),Ze(v7),Ze(eo),Ze(Qi))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-kanban"]],decls:50,vars:10,consts:[["cdkDropListGroup","",1,"flex","flex-col"],[1,"flex","flex-grow","space-x-4","overflow-x-auto","pb-4"],[1,"flex","w-64","flex-shrink-0","flex-col"],[1,"flex","items-center","px-2","mb-3"],[1,"font-display","font-bold","text-gray-700"],[1,"ml-2","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-family-sky/20","text-xs","font-bold","text-family-sky"],["routerLink","/add-task",1,"ml-auto","text-family-pink","hover:text-family-coral","transition-colors"],["fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6v12m6-6H6"],["id","newContainer","cdkDropList","",1,"flex-1","space-y-3","min-h-[60px]",3,"cdkDropListDropped","cdkDropListData"],["cdkDrag",""],[1,"ml-2","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-family-orange/20","text-xs","font-bold","text-family-orange"],["id","inProgressContainer","cdkDropList","",1,"flex-1","space-y-3","min-h-[60px]",3,"cdkDropListDropped","cdkDropListData"],[1,"ml-2","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-family-green/20","text-xs","font-bold","text-family-green"],["id","doneContainer","cdkDropList","",1,"flex-1","space-y-3","min-h-[60px]",3,"cdkDropListDropped","cdkDropListData"],[1,"ml-2","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-red-100","text-xs","font-bold","text-red-500"],["id","bloqueContainer","cdkDropList","",1,"flex-1","space-y-3","min-h-[60px]",3,"cdkDropListDropped","cdkDropListData"],[1,"ml-2","flex","h-5","w-5","items-center","justify-center","rounded-full","bg-family-purple/20","text-xs","font-bold","text-family-purple"],["id","archiveContainer","cdkDropList","",1,"flex-1","space-y-3","min-h-[60px]",3,"cdkDropListDropped","cdkDropListData"],[1,"card-fun","p-4","cursor-pointer","border-l-4","border-family-sky","hover:shadow-card-hover","transition-shadow",3,"click"],[3,"ngClass"],[1,"mt-2","text-sm","font-semibold","text-gray-700"],[1,"flex","items-center","gap-1.5","mt-1"],[1,"flex","-space-x-1.5"],["referrerpolicy","no-referrer",1,"w-4","h-4","rounded-full","object-cover","ring-1","ring-white",3,"src"],[1,"text-xs","text-gray-400","truncate"],[1,"card-fun","p-4","cursor-pointer","border-l-4","border-family-orange","hover:shadow-card-hover","transition-shadow",3,"click"],[1,"card-fun","p-4","cursor-pointer","border-l-4","border-family-green","hover:shadow-card-hover","transition-shadow",3,"click"],[1,"card-fun","p-4","cursor-pointer","border-l-4","border-red-400","hover:shadow-card-hover","transition-shadow",3,"click"],["referrerpolicy","no-referrer",1,"w-5","h-5","rounded-full","object-cover","ring-1","ring-white",3,"src"],[1,"card-fun","p-4","cursor-pointer","border-l-4","border-family-purple","hover:shadow-card-hover","transition-shadow",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"span",4),Z(5,"\u{1F195} Nouveau"),U(),V(6,"span",5),Z(7),U(),V(8,"button",6),on(),V(9,"svg",7),st(10,"path",8),U()()(),ai(),V(11,"div",9),Fe("cdkDropListDropped",function(d){return r.drop(d)}),qt(12,zme,12,4,"div",10,So),U()(),V(14,"div",2)(15,"div",3)(16,"span",4),Z(17,"\u{1F504} En cours"),U(),V(18,"span",11),Z(19),U()(),V(20,"div",12),Fe("cdkDropListDropped",function(d){return r.drop(d)}),qt(21,$me,12,4,"div",10,So),U()(),V(23,"div",2)(24,"div",3)(25,"span",4),Z(26,"\u2705 Fait"),U(),V(27,"span",13),Z(28),U()(),V(29,"div",14),Fe("cdkDropListDropped",function(d){return r.drop(d)}),qt(30,Gme,12,4,"div",10,So),U()(),V(32,"div",2)(33,"div",3)(34,"span",4),Z(35,"\u{1F6AB} Bloque"),U(),V(36,"span",15),Z(37),U()(),V(38,"div",16),Fe("cdkDropListDropped",function(d){return r.drop(d)}),qt(39,Wme,12,4,"div",10,So),U()(),V(41,"div",2)(42,"div",3)(43,"span",4),Z(44,"\u{1F4E6} Archive"),U(),V(45,"span",17),Z(46),U()(),V(47,"div",18),Fe("cdkDropListDropped",function(d){return r.drop(d)}),qt(48,Kme,12,4,"div",10,So),U()()()()),i&2&&(te(7),ht(r.new.length||0),te(4),Ft("cdkDropListData",r.new),te(),Wt(r.new),te(7),ht(r.en_cours.length),te(),Ft("cdkDropListData",r.en_cours),te(),Wt(r.en_cours),te(7),ht(r.fait.length),te(),Ft("cdkDropListData",r.fait),te(),Wt(r.fait),te(7),ht(r.bloquer.length),te(),Ft("cdkDropListData",r.bloquer),te(),Wt(r.bloquer),te(7),ht(r.archiver.length),te(),Ft("cdkDropListData",r.archiver),te(),Wt(r.archiver))},dependencies:[Ui,Qk,y7,_7,g7,m7,Sl,$s],styles:[".drop-container[_ngcontent-%COMP%]{min-height:100vh;border:1px dashed #ccc}"]})}}return n})();var iD=(()=>{class n{constructor(){this._vacations=Zn([]),this.vacations=this._vacations.asReadonly(),this.upcomingVacations=xi(()=>{let e=new Date;return this._vacations().filter(i=>new Date(i.startDate)>e)}),this.nextVacation=xi(()=>this.upcomingVacations()[0]||null),this.vacationsRef=zt(Ut,"/vacations"),this.initListener()}initListener(){rs(this.vacationsRef,e=>{let i=e.val();if(!i){this._vacations.set([]);return}let r=Object.keys(i).map(o=>Mt(Be({},i[o]),{id:o}));r.sort((o,d)=>new Date(o.startDate).getTime()-new Date(d.startDate).getTime()),this._vacations.set(r)})}addVacation(e){return ae(this,null,function*(){let i=ba(this.vacationsRef);return yield Mo(i,Mt(Be({},e),{id:i.key})),i.key})}updateVacation(e,i){return ae(this,null,function*(){yield is(zt(Ut,`/vacations/${e}`),i)})}deleteVacation(e){return ae(this,null,function*(){yield Ss(zt(Ut,`/vacations/${e}`))})}listenChecklist(e,i){let r=zt(Ut,`/vacations/${e}/checklist`);return rs(r,o=>{let d=o.val();if(!d){i([]);return}i(Object.keys(d).map(m=>Mt(Be({},d[m]),{id:m})))}),()=>dh(r)}addChecklistItem(e,i){return ae(this,null,function*(){let r=an.currentUser,o=ba(zt(Ut,`/vacations/${e}/checklist`));yield Mo(o,{id:o.key,text:i,checked:!1,addedBy:r?.displayName||""})})}toggleChecklistItem(e,i,r){return ae(this,null,function*(){yield is(zt(Ut,`/vacations/${e}/checklist/${i}`),{checked:r})})}deleteChecklistItem(e,i){return ae(this,null,function*(){yield Ss(zt(Ut,`/vacations/${e}/checklist/${i}`))})}listenPhotos(e,i){let r=zt(Ut,`/vacations/${e}/photos`);return rs(r,o=>{let d=o.val();if(!d){i([]);return}let m=Object.keys(d).map(b=>Mt(Be({},d[b]),{id:b}));m.sort((b,T)=>new Date(T.addedAt).getTime()-new Date(b.addedAt).getTime()),i(m)}),()=>dh(r)}uploadPhoto(e,i,r){return ae(this,null,function*(){let o=an.currentUser;if(!o)return;let d=`vacations/${e}/${Date.now()}_${i.name}`,m=hh(fh,d);yield T_(m,i);let b=yield S_(m),T=ba(zt(Ut,`/vacations/${e}/photos`));yield Mo(T,{id:T.key,url:b,caption:r||"",addedBy:o.uid,addedByName:o.displayName||"",addedAt:new Date().toISOString()})})}deletePhoto(e,i){return ae(this,null,function*(){yield Ss(zt(Ut,`/vacations/${e}/photos/${i.id}`))})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function Yme(n,t){if(n&1&&(V(0,"a",14)(1,"div",17),Z(2,"\u{1F3D6}\uFE0F"),U(),V(3,"div",18)(4,"div",19),Z(5),U(),V(6,"div",20),Z(7),U()(),V(8,"div",21)(9,"div",22),Z(10),U()()()),n&2){let e=t,i=_e();te(5),ht(e.title),te(2),ht(e.destination),te(3),tn("J-",i.daysUntil(e.startDate))}}var x7=(()=>{class n{constructor(e,i){this.vacService=e,this.router=i,this.nextVacation=this.vacService.nextVacation}daysUntil(e){let i=new Date(e).getTime()-Date.now();return Math.max(0,Math.ceil(i/(1e3*60*60*24)))}onEdit(e){this.router.navigate(["/task/edit",e])}static{this.\u0275fac=function(i){return new(i||n)(Ze(iD),Ze(lr))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-home"]],decls:51,vars:1,consts:[[1,"card-fun","bg-gradient-to-r","from-family-pink","via-family-coral","to-family-orange","p-6","mb-6","text-white"],[1,"font-display","text-2xl","font-bold"],[1,"mt-1","opacity-90"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4","mb-6"],["routerLink","/chat",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],[1,"text-3xl","mb-2"],[1,"font-display","font-semibold","text-gray-700","text-sm"],["routerLink","/add-task",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/shopping",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/map",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/calendar",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/documents",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/vacances",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/recipes",1,"card-fun","p-4","text-center","hover:shadow-card-hover","transition-shadow","cursor-pointer"],["routerLink","/vacances",1,"card-fun","p-4","mb-6","flex","items-center","gap-4","hover:shadow-card-hover","transition-shadow","cursor-pointer","bg-gradient-to-r","from-family-coral/5","to-family-orange/5"],[1,"card-fun","p-4"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-4"],[1,"text-3xl"],[1,"flex-1"],[1,"font-display","font-bold","text-gray-700"],[1,"text-sm","text-gray-500"],[1,"text-center"],[1,"text-2xl","font-display","font-extrabold","text-family-pink"]],template:function(i,r){if(i&1&&(V(0,"div",0)(1,"h1",1),Z(2,"Bonjour la famille ! \u{1F44B}"),U(),V(3,"p",2),Z(4,"Bienvenue sur votre espace"),U()(),V(5,"div",3)(6,"a",4)(7,"div",5),Z(8,"\u{1F4F1}"),U(),V(9,"div",6),Z(10,"Fil d'actu"),U()(),V(11,"a",7)(12,"div",5),Z(13,"\u270F\uFE0F"),U(),V(14,"div",6),Z(15,"Nouvelle tache"),U()(),V(16,"a",8)(17,"div",5),Z(18,"\u{1F6D2}"),U(),V(19,"div",6),Z(20,"Courses"),U()(),V(21,"a",9)(22,"div",5),Z(23,"\u{1F5FA}\uFE0F"),U(),V(24,"div",6),Z(25,"Carte"),U()(),V(26,"a",10)(27,"div",5),Z(28,"\u{1F4C5}"),U(),V(29,"div",6),Z(30,"Calendrier"),U()(),V(31,"a",11)(32,"div",5),Z(33,"\u{1F4C1}"),U(),V(34,"div",6),Z(35,"Documents"),U()(),V(36,"a",12)(37,"div",5),Z(38,"\u{1F3D6}\uFE0F"),U(),V(39,"div",6),Z(40,"Vacances"),U()(),V(41,"a",13)(42,"div",5),Z(43,"\u{1F37D}\uFE0F"),U(),V(44,"div",6),Z(45,"Recettes"),U()()(),tt(46,Yme,11,3,"a",14),V(47,"div",15)(48,"h2",16),Z(49,"\u{1F4CB} Tableau des taches"),U(),st(50,"app-kanban"),U()),i&2){let o;te(46),nt((o=r.nextVacation())?46:-1,o)}},dependencies:[b7,Sl,$s],styles:[".card[_ngcontent-%COMP%]{box-sizing:border-box;width:300px;margin:20px auto;padding:10px 30px}h1[_ngcontent-%COMP%]{margin:10px}.close-button[_ngcontent-%COMP%], .edit-button[_ngcontent-%COMP%]{float:right;top:-14px;right:-30px}"]})}}return n})();var uD=Sx(rD()),R_=Sx(rD());function kF(n,t,e,i){function r(o){return o instanceof e?o:new e(function(d){d(o)})}return new(e||(e=Promise))(function(o,d){function m(A){try{T(i.next(A))}catch(N){d(N)}}function b(A){try{T(i.throw(A))}catch(N){d(N)}}function T(A){A.done?o(A.value):r(A.value).then(m,b)}T((i=i.apply(n,t||[])).next())})}var oD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cD(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var RF,C7;function P7(){if(C7)return RF;C7=1,RF=t;var n=Object.prototype.hasOwnProperty;function t(){for(var e={},i=0;i<arguments.length;i++){var r=arguments[i];for(var o in r)n.call(r,o)&&(e[o]=r[o])}return e}return RF}var PF={exports:{}},T7;function Xme(){return T7||(T7=1,(function(n,t){(function(){var e={};n.exports=e,e.simpleFilter=function(i,r){return r.filter(function(o){return e.test(i,o)})},e.test=function(i,r){return e.match(i,r)!==null},e.match=function(i,r,o){o=o||{};var d=0,m=[],b=r.length,T=0,A=0,N=o.pre||"",q=o.post||"",J=o.caseSensitive&&r||r.toLowerCase(),K;i=o.caseSensitive&&i||i.toLowerCase();for(var xe=0;xe<b;xe++)K=r[xe],J[xe]===i[d]?(K=N+K+q,d+=1,A+=1+A):A=0,T+=A,m[m.length]=K;return d===i.length?(T=J===i?1/0:T,{rendered:m.join(""),score:T}):null},e.filter=function(i,r,o){return!r||r.length===0?[]:typeof i!="string"?r:(o=o||{},r.reduce(function(d,m,b,T){var A=m;o.extract&&(A=o.extract(m));var N=e.match(i,A,o);return N!=null&&(d[d.length]={string:N.rendered,score:N.score,index:b,original:m}),d},[]).sort(function(d,m){var b=m.score-d.score;return b||d.index-m.index}))}})()})(PF)),PF.exports}var NF,S7;function Qme(){if(S7)return NF;S7=1;var n=function(t){return this.component=t,this.items=[],this.active=t.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};return n.prototype.show=function(){this.element.style.display="block"},n.prototype.hide=function(){this.element.style.display="none"},n.prototype.add=function(t){this.items.push(t)},n.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},n.prototype.isEmpty=function(){return!this.items.length},n.prototype.isVisible=function(){return this.element.style.display==="block"},n.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()},n.prototype.drawItem=function(t,e){var i=document.createElement("li"),r=document.createElement("a");e&&(i.className+=" active"),r.innerHTML=t.string,i.appendChild(r),this.element.appendChild(i),i.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),i.addEventListener("mouseup",function(){this.handleMouseUp.call(this,t)}.bind(this))},n.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()},n.prototype.move=function(t){this.active=t,this.draw()},n.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},n.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},n.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()},NF=n,NF}var OF,D7;function Jme(){if(D7)return OF;D7=1;var n=P7(),t=Xme(),e=Qme(),i=function(r,o,d){return d=d||{},this.options=n({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},d),this.el=r,this.data=o||[],this.list=new e(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(m){this.handleKeyUp(m.keyCode,m)}.bind(this),!1),this.el.addEventListener("keydown",function(m){this.handleKeyDown(m)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(m){this.handlePaste(m)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return i.prototype.handleKeyUp=function(r,o){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),o.stopPropagation());return}this.handleInputChange(this.el.value)}},i.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},i.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},i.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var o=this;setTimeout(function(){o.handleInputChange(r.target.value)},100)}},i.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(o){for(var d=0;d<o.length&&(this.list.add(o[d]),d!==this.options.limit-1);d++);this.list.draw()}.bind(this))},i.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},i.prototype.update=function(r){this.data=r,this.handleKeyUp()},i.prototype.clear=function(){this.data=[],this.list.clear()},i.prototype.normalize=function(r){return r=r.toLowerCase(),r},i.prototype.match=function(r,o){return r.indexOf(o)>-1},i.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var o=document.createEvent("HTMLEvents");o.initEvent("change",!0,!1),this.el.dispatchEvent(o)}else this.el.fireEvent("onchange")},i.prototype.getCandidates=function(r){var o={pre:"<strong>",post:"</strong>",extract:function(m){return this.getItemValue(m)}.bind(this)},d;this.options.filter?(d=t.filter(this.query,this.data,o),d=d.map(function(m){return{original:m.original,string:this.render(m.original,m.string)}}.bind(this))):d=this.data.map(function(m){var b=this.render(m);return{original:m,string:b}}.bind(this)),r(d)},i.prototype.getItemValue=function(r){return r},i.prototype.render=function(r,o){if(o)return o;for(var d=r.original?this.getItemValue(r.original):this.getItemValue(r),m=this.normalize(d),b=m.lastIndexOf(this.query);b>-1;){var T=b+this.query.length;d=d.slice(0,b)+"<strong>"+d.slice(b,T)+"</strong>"+d.slice(T),b=m.slice(0,b).lastIndexOf(this.query)}return d},i.prototype.renderError=function(r){this.list.drawError(r)},OF=i,OF}var FF,I7;function ege(){if(I7)return FF;I7=1;var n=Jme();return FF=n,typeof window<"u"&&(window.Suggestions=n),FF}var tge=ege(),nge=cD(tge),aD={exports:{}},ige=aD.exports,M7;function rge(){return M7||(M7=1,(function(n){(function(t,e,i){n.exports?n.exports=i():t[e]=i()})(ige,"subtag",function(){var t="",e=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(b){return b.match(e)||[]}function r(b){return i(b).filter(function(T,A){return T&&A})}function o(b){return b=i(b),{language:b[1]||t,extlang:b[2]||t,script:b[3]||t,region:b[4]||t}}function d(b,T,A){Object.defineProperty(b,T,{value:A,enumerable:!0})}function m(b,T,A){function N(q){return i(q)[b]||t}d(N,"pattern",T),d(o,A,N)}return m(1,/^[a-zA-Z]{2,3}$/,"language"),m(2,/^[a-zA-Z]{3}$/,"extlang"),m(3,/^[a-zA-Z]{4}$/,"script"),m(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),d(o,"split",r),o})})(aD)),aD.exports}var oge=rge(),sge=cD(oge),LF,A7;function age(){if(A7)return LF;A7=1;var n="Expected a function",t=NaN,e="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,d=/^0o[0-7]+$/i,m=parseInt,b=typeof oD=="object"&&oD&&oD.Object===Object&&oD,T=typeof self=="object"&&self&&self.Object===Object&&self,A=b||T||Function("return this")(),N=Object.prototype,q=N.toString,J=Math.max,K=Math.min,xe=function(){return A.Date.now()};function Te(Oe,Qe,ct){var bt,Gt,Bt,jn,$n,Ji,Ao=0,zn=!1,Ct=!1,ft=!0;if(typeof Oe!="function")throw new TypeError(n);Qe=Ue(Qe)||0,Ge(ct)&&(zn=!!ct.leading,Ct="maxWait"in ct,Bt=Ct?J(Ue(ct.maxWait)||0,Qe):Bt,ft="trailing"in ct?!!ct.trailing:ft);function Lt(mn){var Ti=bt,Yn=Gt;return bt=Gt=void 0,Ao=mn,jn=Oe.apply(Yn,Ti),jn}function hn(mn){return Ao=mn,$n=setTimeout(_i,Qe),zn?Lt(mn):jn}function di(mn){var Ti=mn-Ji,Yn=mn-Ao,Ar=Qe-Ti;return Ct?K(Ar,Bt-Yn):Ar}function yr(mn){var Ti=mn-Ji,Yn=mn-Ao;return Ji===void 0||Ti>=Qe||Ti<0||Ct&&Yn>=Bt}function _i(){var mn=xe();if(yr(mn))return cr(mn);$n=setTimeout(_i,di(mn))}function cr(mn){return $n=void 0,ft&&bt?Lt(mn):(bt=Gt=void 0,jn)}function ln(){$n!==void 0&&clearTimeout($n),Ao=0,bt=Ji=Gt=$n=void 0}function ls(){return $n===void 0?jn:cr(xe())}function ur(){var mn=xe(),Ti=yr(mn);if(bt=arguments,Gt=this,Ji=mn,Ti){if($n===void 0)return hn(Ji);if(Ct)return $n=setTimeout(_i,Qe),Lt(Ji)}return $n===void 0&&($n=setTimeout(_i,Qe)),jn}return ur.cancel=ln,ur.flush=ls,ur}function Ge(Oe){var Qe=typeof Oe;return!!Oe&&(Qe=="object"||Qe=="function")}function Et(Oe){return!!Oe&&typeof Oe=="object"}function kt(Oe){return typeof Oe=="symbol"||Et(Oe)&&q.call(Oe)==e}function Ue(Oe){if(typeof Oe=="number")return Oe;if(kt(Oe))return t;if(Ge(Oe)){var Qe=typeof Oe.valueOf=="function"?Oe.valueOf():Oe;Oe=Ge(Qe)?Qe+"":Qe}if(typeof Oe!="string")return Oe===0?Oe:+Oe;Oe=Oe.replace(i,"");var ct=o.test(Oe);return ct||d.test(Oe)?m(Oe.slice(2),ct?2:8):r.test(Oe)?t:+Oe}return LF=Te,LF}var lge=age(),cge=cD(lge),uge=P7(),Ol=cD(uge),sD={exports:{}},k7;function dge(){if(k7)return sD.exports;k7=1;var n=typeof Reflect=="object"?Reflect:null,t=n&&typeof n.apply=="function"?n.apply:function(Oe,Qe,ct){return Function.prototype.apply.call(Oe,Qe,ct)},e;n&&typeof n.ownKeys=="function"?e=n.ownKeys:Object.getOwnPropertySymbols?e=function(Oe){return Object.getOwnPropertyNames(Oe).concat(Object.getOwnPropertySymbols(Oe))}:e=function(Oe){return Object.getOwnPropertyNames(Oe)};function i(Ue){console&&console.warn&&console.warn(Ue)}var r=Number.isNaN||function(Oe){return Oe!==Oe};function o(){o.init.call(this)}sD.exports=o,sD.exports.once=Ge,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var d=10;function m(Ue){if(typeof Ue!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Ue)}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(Ue){if(typeof Ue!="number"||Ue<0||r(Ue))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Ue+".");d=Ue}}),o.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(Oe){if(typeof Oe!="number"||Oe<0||r(Oe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Oe+".");return this._maxListeners=Oe,this};function b(Ue){return Ue._maxListeners===void 0?o.defaultMaxListeners:Ue._maxListeners}o.prototype.getMaxListeners=function(){return b(this)},o.prototype.emit=function(Oe){for(var Qe=[],ct=1;ct<arguments.length;ct++)Qe.push(arguments[ct]);var bt=Oe==="error",Gt=this._events;if(Gt!==void 0)bt=bt&&Gt.error===void 0;else if(!bt)return!1;if(bt){var Bt;if(Qe.length>0&&(Bt=Qe[0]),Bt instanceof Error)throw Bt;var jn=new Error("Unhandled error."+(Bt?" ("+Bt.message+")":""));throw jn.context=Bt,jn}var $n=Gt[Oe];if($n===void 0)return!1;if(typeof $n=="function")t($n,this,Qe);else for(var Ji=$n.length,Ao=K($n,Ji),ct=0;ct<Ji;++ct)t(Ao[ct],this,Qe);return!0};function T(Ue,Oe,Qe,ct){var bt,Gt,Bt;if(m(Qe),Gt=Ue._events,Gt===void 0?(Gt=Ue._events=Object.create(null),Ue._eventsCount=0):(Gt.newListener!==void 0&&(Ue.emit("newListener",Oe,Qe.listener?Qe.listener:Qe),Gt=Ue._events),Bt=Gt[Oe]),Bt===void 0)Bt=Gt[Oe]=Qe,++Ue._eventsCount;else if(typeof Bt=="function"?Bt=Gt[Oe]=ct?[Qe,Bt]:[Bt,Qe]:ct?Bt.unshift(Qe):Bt.push(Qe),bt=b(Ue),bt>0&&Bt.length>bt&&!Bt.warned){Bt.warned=!0;var jn=new Error("Possible EventEmitter memory leak detected. "+Bt.length+" "+String(Oe)+" listeners added. Use emitter.setMaxListeners() to increase limit");jn.name="MaxListenersExceededWarning",jn.emitter=Ue,jn.type=Oe,jn.count=Bt.length,i(jn)}return Ue}o.prototype.addListener=function(Oe,Qe){return T(this,Oe,Qe,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(Oe,Qe){return T(this,Oe,Qe,!0)};function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function N(Ue,Oe,Qe){var ct={fired:!1,wrapFn:void 0,target:Ue,type:Oe,listener:Qe},bt=A.bind(ct);return bt.listener=Qe,ct.wrapFn=bt,bt}o.prototype.once=function(Oe,Qe){return m(Qe),this.on(Oe,N(this,Oe,Qe)),this},o.prototype.prependOnceListener=function(Oe,Qe){return m(Qe),this.prependListener(Oe,N(this,Oe,Qe)),this},o.prototype.removeListener=function(Oe,Qe){var ct,bt,Gt,Bt,jn;if(m(Qe),bt=this._events,bt===void 0)return this;if(ct=bt[Oe],ct===void 0)return this;if(ct===Qe||ct.listener===Qe)--this._eventsCount===0?this._events=Object.create(null):(delete bt[Oe],bt.removeListener&&this.emit("removeListener",Oe,ct.listener||Qe));else if(typeof ct!="function"){for(Gt=-1,Bt=ct.length-1;Bt>=0;Bt--)if(ct[Bt]===Qe||ct[Bt].listener===Qe){jn=ct[Bt].listener,Gt=Bt;break}if(Gt<0)return this;Gt===0?ct.shift():xe(ct,Gt),ct.length===1&&(bt[Oe]=ct[0]),bt.removeListener!==void 0&&this.emit("removeListener",Oe,jn||Qe)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(Oe){var Qe,ct,bt;if(ct=this._events,ct===void 0)return this;if(ct.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ct[Oe]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ct[Oe]),this;if(arguments.length===0){var Gt=Object.keys(ct),Bt;for(bt=0;bt<Gt.length;++bt)Bt=Gt[bt],Bt!=="removeListener"&&this.removeAllListeners(Bt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Qe=ct[Oe],typeof Qe=="function")this.removeListener(Oe,Qe);else if(Qe!==void 0)for(bt=Qe.length-1;bt>=0;bt--)this.removeListener(Oe,Qe[bt]);return this};function q(Ue,Oe,Qe){var ct=Ue._events;if(ct===void 0)return[];var bt=ct[Oe];return bt===void 0?[]:typeof bt=="function"?Qe?[bt.listener||bt]:[bt]:Qe?Te(bt):K(bt,bt.length)}o.prototype.listeners=function(Oe){return q(this,Oe,!0)},o.prototype.rawListeners=function(Oe){return q(this,Oe,!1)},o.listenerCount=function(Ue,Oe){return typeof Ue.listenerCount=="function"?Ue.listenerCount(Oe):J.call(Ue,Oe)},o.prototype.listenerCount=J;function J(Ue){var Oe=this._events;if(Oe!==void 0){var Qe=Oe[Ue];if(typeof Qe=="function")return 1;if(Qe!==void 0)return Qe.length}return 0}o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function K(Ue,Oe){for(var Qe=new Array(Oe),ct=0;ct<Oe;++ct)Qe[ct]=Ue[ct];return Qe}function xe(Ue,Oe){for(;Oe+1<Ue.length;Oe++)Ue[Oe]=Ue[Oe+1];Ue.pop()}function Te(Ue){for(var Oe=new Array(Ue.length),Qe=0;Qe<Oe.length;++Qe)Oe[Qe]=Ue[Qe].listener||Ue[Qe];return Oe}function Ge(Ue,Oe){return new Promise(function(Qe,ct){function bt(Bt){Ue.removeListener(Oe,Gt),ct(Bt)}function Gt(){typeof Ue.removeListener=="function"&&Ue.removeListener("error",bt),Qe([].slice.call(arguments))}kt(Ue,Oe,Gt,{once:!0}),Oe!=="error"&&Et(Ue,bt,{once:!0})})}function Et(Ue,Oe,Qe){typeof Ue.on=="function"&&kt(Ue,"error",Oe,Qe)}function kt(Ue,Oe,Qe,ct){if(typeof Ue.on=="function")ct.once?Ue.once(Oe,Qe):Ue.on(Oe,Qe);else if(typeof Ue.addEventListener=="function")Ue.addEventListener(Oe,function bt(Gt){ct.once&&Ue.removeEventListener(Oe,bt),Qe(Gt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Ue)}return sD.exports}var hge=dge(),R7={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},fge={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A",es:"Buscar"},pge={en:"No results found",de:"Keine Ergebnisse gefunden",es:"No hay resultados",fr:"Aucun r\xE9sultat trouv\xE9"},mge={en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen",es:"Error al conectarse al servidor",fr:"Une erreur est survenue lors de la connexion au serveur"},Zb={placeholder:fge,errorNoResults:pge,errorConnectionFailed:mge},gge=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/,lD=class{constructor(t,e,i=(r,o,d)=>new nge(r,o,d)){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:r=>r.text!=null?r.text:r.place_name,render:r=>{if(!("geometry"in r)){let d=r.text,m=d.toLowerCase().indexOf(this._typeahead.query.toLowerCase()),b=this._typeahead.query.length,T=d.substring(0,m),A=d.substring(m,m+b),N=d.substring(m+b);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+T+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+A+"</span>"+N+"</div></div></div>"}let o=r.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+o[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+o.splice(1,o.length).join(",")+"</div></div></div>"},popupRender:r=>{let o=r.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+o[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+o.splice(1,o.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new hge.EventEmitter,this.options=Ol({},this.options,e),this.fresh=!0,this.lastSelected=null,this.geocoderApi=t,this.typeaheadFactory=i}addTo(t){function e(i,r){if(!document.body.contains(r))throw new Error("Element provided to #addTo() exists, but is not in the DOM");let o=i.onAdd();r.appendChild(o)}if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){let i=document.querySelectorAll(t);if(i.length===0)throw new Error("Element "+t+"not found.");if(i.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,i[0])}else if("addControl"in t)t.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);let e=this.container=document.createElement("div");e.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";let i=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="search",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",cge(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);let r=document.createElement("div");r.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";let o=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(o),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(i),e.appendChild(this._inputEl),e.appendChild(r),this._typeahead=this.typeaheadFactory(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.container.addEventListener("click",()=>{this._typeahead.update(this._typeahead.data)}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e}createIcon(t,e){let i=document.createElementNS("http://www.w3.org/2000/svg","svg");if(i.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+t),i.setAttribute("viewBox","0 0 18 18"),i.setAttribute("xml:space","preserve"),i.setAttribute("width","18"),i.setAttribute("height","18"),"innerHTML"in i)i.innerHTML=e;else{let r=document.createElement("div");r.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";let o=r.firstChild,d=o.firstChild;i.appendChild(d)}return i}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(t){let e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)}_onKeyDown(t){if(t.key==="Escape"&&this.options.clearAndBlurOnEsc){this._clear(t),this._inputEl.blur();return}let e=this._inputEl.value;if(!e){this.fresh=!0,t.key!=="Tab"&&this.clear(t),this._clearEl.style.display="none";return}if(!(t.metaKey||t.key==="Tab"||t.key==="Escape"||t.key==="ArrowLeft"||t.key==="ArrowRight"||t.key==="ArrowUp"||t.key==="ArrowDown")){if(t.key==="Enter")if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(e);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(e,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()}_onChange(){var t;let e=this._typeahead.selected;if(e){if(!("geometry"in e)){e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);return}if(JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let i;if(this._removeResultMarkers(),e.properties&&R7[e.properties.short_code])i=Ol({},this.options.flyTo),this._map&&this._map.fitBounds(R7[e.properties.short_code].bbox,i);else if(e.bbox){let r=e.bbox;i=Ol({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],i)}else{let r={zoom:this.options.zoom};i=Ol({},r,this.options.flyTo),e.center?i.center=e.center:((t=e.geometry)===null||t===void 0?void 0:t.type)==="Point"&&e.geometry.coordinates&&(i.center=e.geometry.coordinates),this._map&&this._map.flyTo(i)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((i,r)=>(this.options[r]&&(["countries","types","language"].indexOf(r)>-1?i[r]=this.options[r].split(/[\s,]+/):i[r]=this.options[r],r==="proximity"&&this.options[r]&&typeof this.options[r].longitude=="number"&&typeof this.options[r].latitude=="number"&&(i[r]=[this.options[r].longitude,this.options[r].latitude])),i),{})}_geocode(t){return kF(this,arguments,void 0,function*(e,i=!1,r=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:e});let o=this._getConfigForRequest(),d=this._createGeocodeRequest(o,e,i,r),m=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[];try{let b=yield d;yield this._handleGeocodeResponse(b,o,e,i,m)}catch(b){this._handleGeocodeErrorResponse(b,m)}return d})}_createGeocodeRequest(t,e,i,r){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&gge.test(e)?this._createReverseGeocodeRequest(e,t):(t.query=e,this.geocoderApi.getSuggestions?i?this.geocoderApi.searchByPlaceId&&r?this.geocoderApi.searchByPlaceId(t):this.geocoderApi.forwardGeocode(t):this.geocoderApi.getSuggestions(t):this.geocoderApi.forwardGeocode(t))}_createReverseGeocodeRequest(t,e){let i=t.split(/[\s(,)?]+/).map(r=>parseFloat(r)).reverse();return e.query=i,e.limit=1,"proximity"in e&&delete e.proximity,this.geocoderApi.reverseGeocode(e)}_handleGeocodeResponse(t,e,i,r,o){return kF(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let d={};t?d=t:d={type:"FeatureCollection",features:[]},d.config=e,this.fresh&&(this.fresh=!1),d.features=d.features?o.concat(d.features):o;let m=this.options.externalGeocoder?this.options.externalGeocoder(i,d.features,e)||Promise.resolve([]):Promise.resolve([]);try{let T=yield m;d.features=d.features?T.concat(d.features):T}catch(T){}this.options.filter&&d.features.length&&(d.features=d.features.filter(this.options.filter));let b=[];"suggestions"in d?b=d.suggestions:"place"in d?b=Array.isArray(d.place)?d.place:[d.place]:b=d.features,b.length?(this._clearEl.style.display="block",this._typeahead.update(b),(!this.options.showResultsWhileTyping||r)&&this.options.showResultMarkers&&(d.features.length>0||"place"in d)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",d)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",d))})}_handleGeocodeErrorResponse(t,e){this._loadingEl.style.display="none",e.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(e)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:e}),this._eventEmitter.emit("error",{error:t})}_clear(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(t){this._clear(t),this._inputEl.focus()}_clearOnBlur(t){t.relatedTarget&&this._clear(t)}_onQueryResult(t){if(!("features"in t)||!t.features.length)return;let e=t.features[0];this._typeahead.selected=e,this._inputEl.value=e.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){let t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(t){return kF(this,void 0,void 0,function*(){let e=yield this._geocode(t);this._onQueryResult(e)})}_renderError(){let t=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(t)}_renderNoResults(){let t=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(t)}_renderMessage(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)}_localize(t){let e=sge.language(this.options.language.split(",")[0]);return this.options.language&&Zb?.[t][e]?Zb[t][e]:Zb[t].en}_fitBoundsForMarkers(){var t;if(this._typeahead.data.length<1)return;let e=this._typeahead.data.filter(i=>typeof i!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){let r=Ol({},{padding:100},this.options.flyTo),o=new this._maplibregl.LngLatBounds;for(let d of e)"geometry"in d&&((t=d.geometry)===null||t===void 0?void 0:t.type)==="Point"&&o.extend(d.geometry.coordinates);this._map.fitBounds(o,r)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}setInput(t){return this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t),this}setProximity(t){return this.options.proximity=t,this}getProximity(){return this.options.proximity}setRenderFunction(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this}getRenderFunction(){return this._typeahead.render}setLanguage(t){return this.options.language=t||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(t){return this.options.zoom=t,this}getFlyTo(){return this.options.flyTo}setFlyTo(t){return this.options.flyTo=t,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(t){return this.options.placeholder=t||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this}getBbox(){return this.options.bbox}setBbox(t){return this.options.bbox=t,this}getCountries(){return this.options.countries}setCountries(t){return this.options.countries=t,this}getTypes(){return this.options.types}setTypes(t){return this.options.types=t,this}getMinLength(){return this.options.minLength}setMinLength(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this}getLimit(){return this.options.limit}setLimit(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this}getFilter(){return this.options.filter}setFilter(t){return this.options.filter=t,this}setGeocoderApi(t){return this.geocoderApi=t,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(t){var e;if(!this._map)return;this._removeMarker();let r=Ol({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(r);let o=null;if(this.options.popup){let m=Ol({},{},this.options.popup);o=new this._maplibregl.Popup(m).setHTML(this.options.popupRender(t))}return t.center?(this.mapMarker.setLngLat(t.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(o)):((e=t.geometry)===null||e===void 0?void 0:e.type)==="Point"&&t.geometry.coordinates&&(this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(o)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(t){if(!this._map)return;this._removeResultMarkers();let i=Ol({},{color:"#4668F2"},this.options.showResultMarkers);for(let r of t){let o;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(o=this.options.showResultMarkers.element.cloneNode(!0),i=Ol(i,{element:o}));let d=new this._maplibregl.Marker(Ol({},i,{element:o})),m;if(this.options.popup){let T=Ol({},{},this.options.popup);m=new this._maplibregl.Popup(T).setHTML(this.options.popupRender(r))}r.center?(d.setLngLat(r.center).addTo(this._map),this.options.popup&&d.setPopup(m)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(d.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&d.setPopup(m)),this.resultMarkers.push(d)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(t){t.remove()}),this.resultMarkers=[])}on(t,e){return this._eventEmitter.on(t,e),this}once(t){return new Promise(e=>{this._eventEmitter.once(t,e)})}off(t,e){return this._eventEmitter.removeListener(t,e),this}};var _ge=["map"],N7=(()=>{class n{constructor(e){this.locationService=e,this.markers={},this.unsubscribeLocations=null,this.centeredOnSelf=!1,this.geocoderApi={forwardGeocode:i=>ae(this,null,function*(){let r=[];try{let o=`https://nominatim.openstreetmap.org/search?q=${i.query}&format=geojson&polygon_geojson=1&addressdetails=1`,m=yield(yield fetch(o)).json();for(let b of m.features){let T=[b.bbox[0]+(b.bbox[2]-b.bbox[0])/2,b.bbox[1]+(b.bbox[3]-b.bbox[1])/2],A={type:"Feature",geometry:{type:"Point",coordinates:T},place_name:b.properties.display_name,properties:b.properties,text:b.properties.display_name,place_type:["place"],center:T};r.push(A)}}catch(o){console.error(`Failed to forwardGeocode with error: ${o}`)}return{type:"FeatureCollection",features:r}})}}ngAfterViewInit(){let e="793f93202015411eaa6fceaeadaad99c",i="https://maps.geoapify.com/v1/styles/maptiler-3d/style.json",r={lng:2.213749,lat:46.227638,zoom:5};this.map=new R_.Map({container:this.mapContainer.nativeElement,style:`${i}?apiKey=${e}`,center:[r.lng,r.lat],zoom:r.zoom}),this.map.addControl(new uD.default.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0})),this.map.addControl(new uD.default.FullscreenControl),this.map.addControl(new lD(this.geocoderApi,{maplibregl:uD.default}),"top-left"),this.map.on("load",()=>{this.unsubscribeLocations=this.locationService.listenAllLocations(o=>{this.updateFamilyMarkers(o);let d=an.currentUser?.uid;d&&o[d]&&!this.centeredOnSelf&&(this.map.flyTo({center:[o[d].lng,o[d].lat],zoom:14}),this.centeredOnSelf=!0)})})}updateFamilyMarkers(e){let i=an.currentUser?.uid,r=new Set;for(let[o,d]of Object.entries(e)){r.add(o);let m=o===i;if(this.markers[o])this.markers[o].setLngLat([d.lng,d.lat]),this.markers[o].getPopup()?.setHTML(this.buildPopupHtml(d));else{let b=document.createElement("div");b.className="family-marker";let T=m?"#3b82f6":"#ec4899";if(b.style.cssText=`width:40px;height:40px;border-radius:50%;border:3px solid ${T};overflow:hidden;background:#fff;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.3);`,d.photoURL){let N=document.createElement("img");N.src=d.photoURL,N.style.cssText="width:100%;height:100%;object-fit:cover;",N.referrerPolicy="no-referrer",b.appendChild(N)}else b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.fontSize="14px",b.style.fontWeight="bold",b.style.color="#ec4899",b.textContent=(d.displayName||"?")[0].toUpperCase();let A=new R_.Popup({offset:25}).setHTML(this.buildPopupHtml(d));this.markers[o]=new R_.Marker({element:b}).setLngLat([d.lng,d.lat]).setPopup(A).addTo(this.map)}}for(let o of Object.keys(this.markers))r.has(o)||(this.markers[o].remove(),delete this.markers[o])}buildPopupHtml(e){let r=new Date(e.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});return`<div style="font-family:sans-serif;text-align:center;">
      <strong>${e.displayName||"Membre"}</strong><br>
      <span style="color:#888;font-size:12px;">${r}</span>
    </div>`}ngOnDestroy(){this.unsubscribeLocations&&this.unsubscribeLocations(),Object.values(this.markers).forEach(e=>e.remove())}static{this.\u0275fac=function(i){return new(i||n)(Ze(BS))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-map"]],viewQuery:function(i,r){if(i&1&&ws(_ge,5),i&2){let o;Do(o=Io())&&(r.mapContainer=o.first)}},decls:5,vars:0,consts:[["map",""],[1,"card-fun","p-4","h-[calc(100dvh-13rem)]","md:h-[calc(100vh-8rem)]","flex","flex-col","overflow-hidden"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-3","shrink-0"],[1,"map-container","rounded-xl","overflow-hidden","flex-1","min-h-0"]],template:function(i,r){i&1&&(Ot(0,"div",1)(1,"h2",2),Z(2,"\u{1F5FA}\uFE0F Carte"),At(),zo(3,"div",3,0),At())},styles:[".map-container[_ngcontent-%COMP%]{height:100%}"]})}}return n})();var Hs=(()=>{class n{constructor(e,i){this.router=e,this.authService=i}canActivate(){return this.authService.redirectReady.then(()=>new Promise(e=>{Pu(an,i=>{i?e(!0):(this.router.navigate(["/auth","signin"]),e(!1))})}))}static{this.\u0275fac=function(i){return new(i||n)(vt(lr),vt(eo))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac})}}return n})();var dD=[{key:"fruits_legumes",label:"Fruits & L\xE9gumes",icon:"\u{1F966}"},{key:"produits_laitiers",label:"Produits laitiers",icon:"\u{1F9C0}"},{key:"viandes",label:"Viandes & Poissons",icon:"\u{1F969}"},{key:"epicerie",label:"\xC9picerie",icon:"\u{1F35D}"},{key:"boissons",label:"Boissons",icon:"\u{1F964}"},{key:"surgeles",label:"Surgel\xE9s",icon:"\u{1F9CA}"},{key:"hygiene",label:"Hygi\xE8ne & Maison",icon:"\u{1F9F4}"},{key:"autre",label:"Autre",icon:"\u{1F4E6}"}],O7=["\u{1F6D2}","\u{1F3E0}","\u{1F389}","\u{1F37D}\uFE0F","\u{1F382}","\u{1F3D5}\uFE0F","\u{1F384}","\u{1F415}","\u{1F476}","\u{1F4BC}"];var Ms=(()=>{class n{constructor(e,i){this.dialogRef=e,this.data=i,this.customMessage=i.customMessage}static{this.\u0275fac=function(i){return new(i||n)(Ze(Dl),Ze(mp))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-confirm-dialog"]],decls:8,vars:1,consts:[[1,"p-6","max-w-sm"],[1,"font-display","text-lg","font-semibold","text-gray-700"],[1,"flex","justify-end","gap-3","mt-6"],[1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","font-medium","text-sm",3,"click"],[1,"btn-gradient","px-6","py-2",3,"click"]],template:function(i,r){i&1&&(Ot(0,"div",0)(1,"h2",1),Z(2),At(),Ot(3,"div",2)(4,"button",3),ho("click",function(){return r.dialogRef.close()}),Z(5,"Non"),At(),Ot(6,"button",4),ho("click",function(){return r.dialogRef.close(!0)}),Z(7,"Oui"),At()()()),i&2&&(te(2),ht(r.customMessage))},encapsulation:2})}}return n})();var P_=(()=>{class n{constructor(){this._lists=Zn([]),this._activeListId=Zn(null),this._items=Zn([]),this._migrationDone=!1,this.lists=this._lists.asReadonly(),this.activeListId=this._activeListId.asReadonly(),this.items=this._items.asReadonly(),this.activeList=xi(()=>{let e=this._activeListId();return this._lists().find(i=>i.id===e)||null}),this.uncheckedItems=xi(()=>this._items().filter(e=>!e.checked)),this.checkedItems=xi(()=>this._items().filter(e=>e.checked)),this.totalUnchecked=xi(()=>this.uncheckedItems().length),this.itemsUnsubscribe=null,this.initListsListener()}initListsListener(){return ae(this,null,function*(){yield this.checkAndMigrate(),rs(zt(Ut,"/shopping_lists"),e=>{let i=e.val();if(i){let r=Object.keys(i).map(o=>({id:o,name:i[o].name||"Liste",icon:i[o].icon||"\u{1F6D2}",createdBy:i[o].createdBy||"",createdAt:i[o].createdAt||""}));this._lists.set(r),!this._activeListId()&&r.length>0&&this.setActiveList(r[0].id)}else this._lists.set([]),this._activeListId.set(null),this._items.set([])})})}checkAndMigrate(){return ae(this,null,function*(){if(this._migrationDone||(this._migrationDone=!0,(yield Ds(zt(Ut,"/shopping_lists"))).exists()))return;let i=yield Ds(zt(Ut,"/shopping"));if(!i.exists())return;let r=i.val(),o=Object.keys(r).map(N=>Mt(Be({},r[N]),{id:N}));if(o.length===0)return;let d=an.currentUser,b=ba(zt(Ut,"/shopping_lists")).key,T={name:"Courses",icon:"\u{1F6D2}",createdBy:d?.uid||"",createdAt:new Date().toISOString()},A={};A[`/shopping_lists/${b}/name`]=T.name,A[`/shopping_lists/${b}/icon`]=T.icon,A[`/shopping_lists/${b}/createdBy`]=T.createdBy,A[`/shopping_lists/${b}/createdAt`]=T.createdAt,o.forEach(N=>{let K=N,{id:q}=K,J=Ky(K,["id"]);A[`/shopping_lists/${b}/items/${q}`]=J}),A["/shopping"]=null,yield is(zt(Ut),A)})}setActiveList(e){this._activeListId.set(e),this.itemsUnsubscribe&&this.itemsUnsubscribe();let i=rs(zt(Ut,`/shopping_lists/${e}/items`),r=>{let o=r.val();o?this._items.set(Object.keys(o).map(d=>Mt(Be({},o[d]),{id:d}))):this._items.set([])});this.itemsUnsubscribe=i}createList(e,i){return ae(this,null,function*(){let r=an.currentUser,o=ba(zt(Ut,"/shopping_lists")),d=o.key;return yield Mo(o,{name:e,icon:i,createdBy:r?.uid||"",createdAt:new Date().toISOString()}),d})}deleteList(e){return ae(this,null,function*(){if(yield Ss(zt(Ut,`/shopping_lists/${e}`)),this._activeListId()===e){let i=this._lists().filter(r=>r.id!==e);i.length>0?this.setActiveList(i[0].id):(this._activeListId.set(null),this._items.set([]))}})}addItem(e){let i=this._activeListId();i&&ba(zt(Ut,`/shopping_lists/${i}/items`),e)}removeItem(e){let i=this._activeListId();i&&Ss(zt(Ut,`/shopping_lists/${i}/items/${e}`))}toggleChecked(e,i){let r=this._activeListId();r&&is(zt(Ut,`/shopping_lists/${r}/items/${e}`),{checked:i})}clearChecked(){let e=this._activeListId();if(!e)return;let i=this._items().filter(o=>o.checked),r={};i.forEach(o=>r[`/shopping_lists/${e}/items/${o.id}`]=null),is(zt(Ut),r)}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var VF=(n,t)=>t.id,F7=(n,t)=>t.key;function yge(n,t){if(n&1&&(V(0,"h1",9),Z(1),U(),V(2,"p",10),Z(3),U()),n&2){let e=_e();te(),Tr("",e.activeList().icon," ",e.activeList().name),te(2),Dg("",e.totalItems()," article",e.totalItems()>1?"s":""," restant",e.totalItems()>1?"s":"")}}function vge(n,t){n&1&&(V(0,"h1",9),Z(1,"\u{1F6D2} Liste de courses"),U(),V(2,"p",10),Z(3,"Aucune liste s\xE9lectionn\xE9e"),U())}function bge(n,t){if(n&1){let e=Tt();V(0,"button",11),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.selectList(r.id))}),Z(1),U()}if(n&2){let e,i=t.$implicit,r=_e();Ri(((e=r.activeList())==null?null:e.id)===i.id?"flex-shrink-0 px-4 py-2 rounded-full bg-gradient-to-r from-family-purple to-family-pink text-white font-medium text-sm shadow-md":"flex-shrink-0 px-4 py-2 rounded-full bg-white border border-gray-200 text-gray-600 font-medium text-sm hover:border-family-purple transition-colors"),te(),Tr(" ",i.icon," ",i.name," ")}}function wge(n,t){if(n&1){let e=Tt();V(0,"button",18),Fe("click",function(){Ve(e);let r=_e(2);return je(r.showAddForm=!0)}),on(),V(1,"svg",19),st(2,"path",6),U(),ai(),V(3,"span",20),Z(4,"Ajouter un article"),U()()}}function xge(n,t){if(n&1&&(V(0,"option",26),Z(1),U()),n&2){let e=t.$implicit;Ft("value",e.key),te(),Tr("",e.icon," ",e.label)}}function Ege(n,t){if(n&1){let e=Tt();V(0,"div",15)(1,"div",21)(2,"input",22),wi("ngModelChange",function(r){Ve(e);let o=_e(2);return Pi(o.newItemName,r)||(o.newItemName=r),je(r)}),Fe("keyup.enter",function(){Ve(e);let r=_e(2);return je(r.addItem())}),U(),V(3,"div",23)(4,"input",24),wi("ngModelChange",function(r){Ve(e);let o=_e(2);return Pi(o.newItemQuantity,r)||(o.newItemQuantity=r),je(r)}),U(),V(5,"select",25),wi("ngModelChange",function(r){Ve(e);let o=_e(2);return Pi(o.newItemCategory,r)||(o.newItemCategory=r),je(r)}),qt(6,xge,2,3,"option",26,F7),U()(),V(8,"div",27)(9,"button",28),Fe("click",function(){Ve(e);let r=_e(2);return je(r.showAddForm=!1)}),Z(10,"Annuler"),U(),V(11,"button",29),Fe("click",function(){Ve(e);let r=_e(2);return je(r.addItem())}),Z(12,"Ajouter"),U()()()()}if(n&2){let e=_e(2);te(2),bi("ngModel",e.newItemName),te(2),bi("ngModel",e.newItemQuantity),te(),bi("ngModel",e.newItemCategory),te(),Wt(e.categories),te(5),Ft("disabled",!e.newItemName.trim())}}function Cge(n,t){if(n&1&&(V(0,"span",36),Z(1),U()),n&2){let e=_e().$implicit;te(),tn("x",e.quantity)}}function Tge(n,t){if(n&1&&st(0,"img",41),n&2){let e=_e(2).$implicit;Ft("src",e.addedByPhoto,Vi)}}function Sge(n,t){if(n&1&&(V(0,"div",37),tt(1,Tge,1,1,"img",41),V(2,"span",42),Z(3),U()()),n&2){let e=_e().$implicit;te(),nt(e.addedByPhoto?1:-1),te(2),ht(e.addedByName)}}function Dge(n,t){if(n&1){let e=Tt();V(0,"div",32)(1,"button",33),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.toggleChecked(r))}),U(),V(2,"div",34)(3,"span",35),Z(4),U(),tt(5,Cge,2,1,"span",36),tt(6,Sge,4,2,"div",37),U(),V(7,"button",38),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.confirmRemoveItem(r))}),on(),V(8,"svg",39),st(9,"path",40),U()()()}if(n&2){let e=t.$implicit;te(4),ht(e.nom),te(),nt(e.quantity&&e.quantity!=="1"?5:-1),te(),nt(e.addedByName?6:-1)}}function Ige(n,t){if(n&1&&(V(0,"div",16)(1,"h3",30)(2,"span"),Z(3),U(),Z(4),U(),V(5,"div",31),qt(6,Dge,10,3,"div",32,VF),U()()),n&2){let e=t.$implicit;te(3),ht(e.icon),te(),tn(" ",e.label," "),te(2),Wt(e.items)}}function Mge(n,t){if(n&1){let e=Tt();V(0,"div",47)(1,"button",48),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.toggleChecked(r))}),on(),V(2,"svg",49),st(3,"path",50),U()(),ai(),V(4,"span",51),Z(5),U()()}if(n&2){let e=t.$implicit;te(5),ht(e.nom)}}function Age(n,t){if(n&1){let e=Tt();V(0,"div",17)(1,"div",43)(2,"h3",44)(3,"span"),Z(4,"\u2705"),U(),Z(5),U(),V(6,"button",45),Fe("click",function(){Ve(e);let r=_e(2);return je(r.confirmClearChecked())}),Z(7," Vider le panier "),U()(),V(8,"div",46),qt(9,Mge,6,1,"div",47,VF),U()()}if(n&2){let e=_e(2);te(5),tn(" Dans le panier (",e.checkedItems().length,") "),te(4),Wt(e.checkedItems())}}function kge(n,t){n&1&&(V(0,"div",7)(1,"div",52),Z(2,"\u{1F6D2}"),U(),V(3,"p",20),Z(4,"Liste vide"),U(),V(5,"p",53),Z(6,"Ajoute ton premier article !"),U()())}function Rge(n,t){if(n&1){let e=Tt();V(0,"div",12)(1,"button",13),Fe("click",function(){Ve(e);let r=_e();return je(r.openDeleteListModal())}),Z(2," Supprimer cette liste "),U()(),tt(3,wge,5,0,"button",14),tt(4,Ege,13,4,"div",15),qt(5,Ige,8,2,"div",16,F7),tt(7,Age,11,1,"div",17),tt(8,kge,7,0,"div",7)}if(n&2){let e=_e();te(3),nt(e.showAddForm?-1:3),te(),nt(e.showAddForm?4:-1),te(),Wt(e.uncheckedByCategory()),te(2),nt(e.checkedItems().length>0?7:-1),te(),nt(e.uncheckedByCategory().length===0&&e.checkedItems().length===0?8:-1)}}function Pge(n,t){if(n&1){let e=Tt();V(0,"div",7)(1,"div",52),Z(2,"\u{1F4DD}"),U(),V(3,"p",20),Z(4,"Aucune liste"),U(),V(5,"p",54),Z(6,"Cr\xE9e ta premi\xE8re liste de courses !"),U(),V(7,"button",55),Fe("click",function(){Ve(e);let r=_e();return je(r.openNewListModal())}),Z(8," Cr\xE9er une liste "),U()()}}function Nge(n,t){if(n&1){let e=Tt();V(0,"button",11),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.newListIcon=r)}),Z(1),U()}if(n&2){let e=t.$implicit,i=_e(2);Ri(i.newListIcon===e?"w-10 h-10 rounded-xl bg-family-purple/10 text-xl flex items-center justify-center ring-2 ring-family-purple":"w-10 h-10 rounded-xl bg-gray-100 text-xl flex items-center justify-center hover:bg-gray-200 transition-colors"),te(),tn(" ",e," ")}}function Oge(n,t){if(n&1){let e=Tt();V(0,"div",8)(1,"div",56)(2,"div",57)(3,"h2",58),Z(4,"Nouvelle liste"),U(),V(5,"div",59)(6,"input",60),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.newListName,r)||(o.newListName=r),je(r)}),Fe("keyup.enter",function(){Ve(e);let r=_e();return je(r.createList())}),U(),V(7,"div")(8,"label",61),Z(9,"Ic\xF4ne"),U(),V(10,"div",62),qt(11,Nge,2,3,"button",3,So),U()()(),V(13,"div",63)(14,"button",64),Fe("click",function(){Ve(e);let r=_e();return je(r.closeNewListModal())}),Z(15," Annuler "),U(),V(16,"button",65),Fe("click",function(){Ve(e);let r=_e();return je(r.createList())}),Z(17," Cr\xE9er "),U()()()()()}if(n&2){let e=_e();te(6),bi("ngModel",e.newListName),te(5),Wt(e.listIcons),te(5),Ft("disabled",!e.newListName.trim())}}function Fge(n,t){if(n&1){let e=Tt();V(0,"div",8)(1,"div",56)(2,"div",57)(3,"div",1)(4,"div",66),Z(5,"\u{1F5D1}\uFE0F"),U(),V(6,"h2",67),Z(7,"Supprimer la liste ?"),U(),V(8,"p",68),Z(9),U()(),V(10,"div",23)(11,"button",64),Fe("click",function(){Ve(e);let r=_e();return je(r.closeDeleteListModal())}),Z(12," Annuler "),U(),V(13,"button",69),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmDeleteList())}),Z(14," Supprimer "),U()()()()()}if(n&2){let e,i=_e();te(9),Tr(' "',(e=i.activeList())==null?null:e.icon," ",(e=i.activeList())==null?null:e.name,'" et tous ses articles seront supprim\xE9s d\xE9finitivement. ')}}var L7=(()=>{class n{constructor(e,i,r){this.shoppingService=e,this.snackBar=i,this.dialog=r,this.categories=dD,this.listIcons=O7,this.newItemName="",this.newItemCategory="autre",this.newItemQuantity="",this.showAddForm=!1,this.showNewListModal=!1,this.newListName="",this.newListIcon="\u{1F6D2}",this.showDeleteListModal=!1,this.lists=this.shoppingService.lists,this.activeList=this.shoppingService.activeList,this.items=this.shoppingService.items,this.uncheckedByCategory=xi(()=>{let o=this.shoppingService.items();return this.categories.map(d=>Mt(Be({},d),{items:o.filter(m=>!m.checked&&m.category===d.key)})).filter(d=>d.items.length>0)}),this.checkedItems=xi(()=>this.shoppingService.items().filter(o=>o.checked)),this.totalItems=xi(()=>this.shoppingService.items().filter(o=>!o.checked).length)}selectList(e){this.shoppingService.setActiveList(e)}openNewListModal(){this.newListName="",this.newListIcon="\u{1F6D2}",this.showNewListModal=!0}closeNewListModal(){this.showNewListModal=!1}createList(){return ae(this,null,function*(){let e=this.newListName.trim();if(!e)return;let i=yield this.shoppingService.createList(e,this.newListIcon);this.shoppingService.setActiveList(i),this.closeNewListModal(),this.snackBar.open("Liste cr\xE9\xE9e !","",{duration:3e3})})}openDeleteListModal(){this.showDeleteListModal=!0}closeDeleteListModal(){this.showDeleteListModal=!1}confirmDeleteList(){return ae(this,null,function*(){let e=this.activeList();e&&(yield this.shoppingService.deleteList(e.id),this.closeDeleteListModal(),this.snackBar.open("Liste supprim\xE9e","",{duration:3e3}))})}addItem(){return ae(this,null,function*(){let e=this.newItemName.trim();if(!e)return;let i=an.currentUser,r="",o="";if(i){let m=(yield Ds(zt(Ut,`/users/${i.uid}`))).val()||{};r=m.displayName||i.displayName||"",o=m.photoURL||i.photoURL||""}this.shoppingService.addItem({nom:e,category:this.newItemCategory,quantity:this.newItemQuantity.trim()||"1",checked:!1,addedBy:i?.uid||"",addedByName:r,addedByPhoto:o,addedAt:new Date().toISOString()}),this.newItemName="",this.newItemQuantity="",this.newItemCategory="autre",this.showAddForm=!1,this.snackBar.open("Article ajout\xE9 !","",{duration:2e3})})}toggleChecked(e){this.shoppingService.toggleChecked(e.id,!e.checked)}confirmRemoveItem(e){this.dialog.open(Ms,{data:{customMessage:`Supprimer "${e.nom}" de la liste ?`}}).afterClosed().subscribe(i=>{i&&(this.shoppingService.removeItem(e.id),this.snackBar.open("Article supprim\xE9","",{duration:2e3}))})}confirmClearChecked(){this.dialog.open(Ms,{data:{customMessage:"Vider le panier ?"}}).afterClosed().subscribe(e=>{e&&(this.shoppingService.clearChecked(),this.snackBar.open("Panier vid\xE9","",{duration:2e3}))})}getCategoryIcon(e){return this.categories.find(i=>i.key===e)?.icon||"\u{1F4E6}"}static{this.\u0275fac=function(i){return new(i||n)(Ze(P_),Ze(Qi),Ze(ya))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-shopping"]],decls:14,vars:4,consts:[[1,"max-w-2xl","mx-auto","px-4"],[1,"text-center","mb-4"],[1,"flex","items-center","gap-2","mb-6","overflow-x-auto","pb-2","scrollbar-hide"],[3,"class"],[1,"flex-shrink-0","min-w-10","w-10","h-10","aspect-square","rounded-full","bg-white","border-2","border-dashed","border-gray-300","flex","items-center","justify-center","text-gray-400","hover:border-family-purple","hover:text-family-purple","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4v16m8-8H4"],[1,"text-center","py-12","text-gray-400"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4"],[1,"font-display","text-2xl","font-bold","text-gradient"],[1,"text-sm","text-gray-400","mt-1"],[3,"click"],[1,"flex","justify-end","mb-4"],[1,"text-xs","text-gray-400","hover:text-red-400","transition-colors",3,"click"],[1,"w-full","card-fun","p-4","mb-6","flex","items-center","justify-center","gap-2","text-gray-500","hover:text-family-green","transition-colors"],[1,"card-fun","p-4","mb-6"],[1,"mb-4"],[1,"mt-6"],[1,"w-full","card-fun","p-4","mb-6","flex","items-center","justify-center","gap-2","text-gray-500","hover:text-family-green","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],[1,"font-medium"],[1,"space-y-3"],["placeholder","Nom de l'article...","autofocus","",1,"input-fun","w-full",3,"ngModelChange","keyup.enter","ngModel"],[1,"flex","gap-3"],["placeholder","Qt\xE9 (ex: 2, 500g...)",1,"input-fun","flex-1",3,"ngModelChange","ngModel"],[1,"input-fun","flex-1",3,"ngModelChange","ngModel"],[3,"value"],[1,"flex","justify-end","gap-2"],[1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","text-sm","font-medium",3,"click"],[1,"btn-gradient","text-sm","px-6","py-2",3,"click","disabled"],[1,"font-display","font-bold","text-sm","text-gray-500","mb-2","flex","items-center","gap-1.5"],[1,"card-fun","overflow-hidden","divide-y","divide-gray-100"],[1,"flex","items-center","gap-3","px-4","py-3","hover:bg-gray-50","transition-colors"],[1,"w-6","h-6","rounded-full","border-2","border-gray-300","flex-shrink-0","hover:border-family-green","transition-colors",3,"click"],[1,"flex-1","min-w-0"],[1,"font-medium","text-gray-700"],[1,"text-xs","text-gray-400","ml-2"],[1,"flex","items-center","gap-1.5","mt-0.5"],[1,"text-gray-300","hover:text-red-400","transition-colors","flex-shrink-0",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],["referrerpolicy","no-referrer",1,"w-4","h-4","rounded-full","object-cover",3,"src"],[1,"text-xs","text-gray-400","truncate"],[1,"flex","items-center","justify-between","mb-2"],[1,"font-display","font-bold","text-sm","text-gray-400","flex","items-center","gap-1.5"],[1,"text-xs","text-red-400","hover:text-red-500","transition-colors","font-medium",3,"click"],[1,"card-fun","overflow-hidden","divide-y","divide-gray-100","opacity-60"],[1,"flex","items-center","gap-3","px-4","py-3"],[1,"w-6","h-6","rounded-full","bg-family-green","flex-shrink-0","flex","items-center","justify-center",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"w-3.5","h-3.5","text-white"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],[1,"flex-1","line-through","text-gray-400"],[1,"text-4xl","mb-3"],[1,"text-sm"],[1,"text-sm","mb-4"],[1,"btn-gradient","text-sm","px-6","py-2",3,"click"],[1,"bg-white","rounded-2xl","shadow-xl","max-w-sm","w-full"],[1,"p-6"],[1,"font-display","text-xl","font-bold","text-gray-800","mb-4"],[1,"space-y-4"],["placeholder","Nom de la liste...","autofocus","",1,"input-fun","w-full",3,"ngModelChange","keyup.enter","ngModel"],[1,"text-sm","text-gray-500","mb-2","block"],[1,"flex","flex-wrap","gap-2"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","rounded-xl","border","border-gray-200","text-gray-600","font-medium","hover:bg-gray-50","transition-colors",3,"click"],[1,"flex-1","btn-gradient","py-2.5",3,"click","disabled"],[1,"text-4xl","mb-2"],[1,"font-display","text-xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500","mt-2"],[1,"flex-1","px-4","py-2.5","rounded-xl","bg-red-500","text-white","font-medium","hover:bg-red-600","transition-colors",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1),tt(2,yge,4,5)(3,vge,4,0),U(),V(4,"div",2),qt(5,bge,2,4,"button",3,VF),V(7,"button",4),Fe("click",function(){return r.openNewListModal()}),on(),V(8,"svg",5),st(9,"path",6),U()()(),tt(10,Rge,9,4)(11,Pge,9,0,"div",7),U(),tt(12,Oge,18,2,"div",8),tt(13,Fge,15,2,"div",8)),i&2&&(te(2),nt(r.activeList()?2:3),te(3),Wt(r.lists()),te(5),nt(r.activeList()?10:11),te(2),nt(r.showNewListModal?12:-1),te(),nt(r.showDeleteListModal?13:-1))},dependencies:[Ui,Xa,Dc,Ic,Mr,Ya,to,wa],styles:[`select.input-fun[_ngcontent-%COMP%]{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}`]})}}return n})();var Lge=(n,t)=>t.uid;function Bge(n,t){n&1&&(on(),V(0,"svg",7),st(1,"path",31),U())}function Vge(n,t){n&1&&(on(),V(0,"svg",32),st(1,"path",31),U())}function jge(n,t){if(n&1&&st(0,"img",33),n&2){let e=_e().$implicit;Ft("src",e.photoURL,Vi)}}function zge(n,t){if(n&1){let e=Tt();V(0,"button",6),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.toggleUser(r.displayName||r.email||""))}),V(1,"div"),tt(2,Vge,2,0,":svg:svg",32),U(),tt(3,jge,1,1,"img",33),V(4,"span",34),Z(5),U()()}if(n&2){let e=t.$implicit,i=_e();Ri(i.isUserSelected(e.displayName||e.email||"")?"flex items-center gap-2 p-2.5 rounded-xl bg-family-purple/10 border-2 border-family-purple transition-all":"flex items-center gap-2 p-2.5 rounded-xl bg-gray-50 border-2 border-transparent hover:border-gray-200 transition-all"),te(),Ri(i.isUserSelected(e.displayName||e.email||"")?"w-4 h-4 rounded flex-shrink-0 bg-family-purple flex items-center justify-center":"w-4 h-4 rounded flex-shrink-0 border-2 border-gray-300"),te(),nt(i.isUserSelected(e.displayName||e.email||"")?2:-1),te(),nt(e.photoURL?3:-1),te(2),ht(e.displayName||e.email)}}var B7=(()=>{class n{constructor(e,i,r,o,d,m,b){this.route=e,this.tasksService=i,this.formBuilder=r,this._snackBar=o,this.router=d,this.dialog=m,this.userService=b,this.taskToEdit=null,this.allUsers=[],this.selectedUsers=new Set,this.selectAll=!1,fg(()=>{if(this.taskToEdit)return;let T=this.route.snapshot.params.id,A=this.tasksService.tasks().find(N=>N.id===T);A&&(this.taskToEdit=A,this.editTaskForm=this.formBuilder.group({id:[A.id,[as.required]],urg:[A.urg,[as.required]],title:[A.title,[as.required]],descriptif:[A.descriptif],createdDate:[A.createdDate||""],statut:[A.statut||""]}),A.name==="Tout le monde"?this.selectAll=!0:A.name.split(", ").map(q=>q.trim()).filter(q=>q).forEach(q=>this.selectedUsers.add(q)))})}onDelete(e){this.dialog.open(Ms,{data:{customMessage:"Etes-vous sur(e) de vouloir supprimer la tache"}}).afterClosed().subscribe(r=>{r===!0&&(this.tasksService.removeTask(e.id),this.router.navigate(["/home"]))})}ngOnInit(){this.userService.getAllUsers().then(e=>this.allUsers=e).catch(()=>this._snackBar.open("Erreur lors du chargement des utilisateurs","",{duration:5e3}))}toggleUser(e){this.selectedUsers.has(e)?this.selectedUsers.delete(e):this.selectedUsers.add(e),this.selectAll=!1}toggleSelectAll(){this.selectAll=!this.selectAll,this.selectAll&&this.selectedUsers.clear()}isUserSelected(e){return this.selectedUsers.has(e)}get hasSelection(){return this.selectAll||this.selectedUsers.size>0}editTask(){if(!this.hasSelection){this._snackBar.open("Selectionne au moins une personne","",{duration:3e3});return}this.dialog.open(Ms,{data:{customMessage:"Etes-vous sur(e) de vouloir modifier la tache"}}).afterClosed().subscribe(i=>{if(i===!0){let r=this.selectAll?"Tout le monde":Array.from(this.selectedUsers).join(", "),o=Mt(Be({},this.editTaskForm.value),{name:r}),d=this.route.snapshot.params.id;this.tasksService.updateTaskById(d,o),this.router.navigate(["/home"]),this._snackBar.open("Tache modifiee","avec succes !!",{duration:5e3})}})}goBack(){this.router.navigate(["/home"])}static{this.\u0275fac=function(i){return new(i||n)(Ze(Ua),Ze(Ac),Ze(vh),Ze(Qi),Ze(lr),Ze(ya),Ze(eo))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-edit-task"]],decls:56,vars:7,consts:[[1,"flex","justify-center"],[1,"card-fun","p-6","w-full","max-w-lg"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-4"],[1,"space-y-4",3,"formGroup"],[1,"block","mb-2","text-sm","font-medium","text-gray-600"],[1,"space-y-2"],["type","button",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"w-3","h-3","text-white"],[1,"font-medium","text-gray-700"],[1,"grid","grid-cols-2","gap-2"],["type","button",3,"class"],["for","statut",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","statut","id","statut","required","",1,"input-fun","w-full"],["value","Nouveau"],["value","En cours"],["value","Fait"],["value","Bloque"],["value","Archive"],["for","urg",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","urg","id","urg","required","",1,"input-fun","w-full"],["value","Urgent"],["value","Relativement urgent"],["value","Pas urgent"],["for","title",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","title","id","title","placeholder","Ex. Mon titre...","required","",1,"input-fun","w-full"],[1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","descriptif","rows","5","placeholder","Decrivez la tache...",1,"input-fun","w-full","resize-y"],[1,"flex","justify-end","gap-3","pt-2"],["type","button",1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","font-medium","text-sm",3,"click"],["type","button",1,"px-4","py-2","rounded-xl","bg-red-50","text-red-500","hover:bg-red-100","transition-colors","font-medium","text-sm",3,"click"],["type","submit",1,"btn-gradient","px-6","py-2","text-sm","font-medium",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","d","M5 13l4 4L19 7"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","3",1,"w-2.5","h-2.5","text-white"],["referrerpolicy","no-referrer",1,"w-6","h-6","rounded-full","object-cover",3,"src"],[1,"text-sm","font-medium","text-gray-700","truncate"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1)(2,"h3",2),Z(3,"\u{1F4DD} Editer la Tache"),U(),V(4,"form",3)(5,"div")(6,"label",4),Z(7,"Tache pour"),U(),V(8,"div",5)(9,"button",6),Fe("click",function(){return r.toggleSelectAll()}),V(10,"div"),tt(11,Bge,2,0,":svg:svg",7),U(),V(12,"span",8),Z(13,"Tout le monde"),U()(),V(14,"div",9),qt(15,zge,6,7,"button",10,Lge),U()()(),V(17,"div")(18,"label",11),Z(19,"Statut"),U(),V(20,"select",12)(21,"option",13),Z(22,"Nouveau"),U(),V(23,"option",14),Z(24,"En cours"),U(),V(25,"option",15),Z(26,"Fait"),U(),V(27,"option",16),Z(28,"Bloque"),U(),V(29,"option",17),Z(30,"Archive"),U()()(),V(31,"div")(32,"label",18),Z(33,"Priorite"),U(),V(34,"select",19)(35,"option",20),Z(36,"Urgent !"),U(),V(37,"option",21),Z(38,"Relativement urgent"),U(),V(39,"option",22),Z(40,"Pas Urgent"),U()()(),V(41,"div")(42,"label",23),Z(43,"Titre"),U(),st(44,"input",24),U(),V(45,"div")(46,"label",25),Z(47,"Descriptif"),U(),st(48,"textarea",26),U(),V(49,"div",27)(50,"button",28),Fe("click",function(){return r.goBack()}),Z(51,"Retour"),U(),V(52,"button",29),Fe("click",function(){return r.onDelete(r.taskToEdit)}),Z(53,"Supprimer"),U(),V(54,"button",30),Fe("click",function(){return r.editTask()}),Z(55,"Modifier"),U()()()()()),i&2&&(te(4),Ft("formGroup",r.editTaskForm),te(5),Ri(r.selectAll?"w-full flex items-center gap-3 p-3 rounded-xl bg-gradient-to-r from-family-purple/10 to-family-pink/10 border-2 border-family-purple transition-all":"w-full flex items-center gap-3 p-3 rounded-xl bg-gray-50 border-2 border-transparent hover:border-gray-200 transition-all"),te(),Ri(r.selectAll?"w-5 h-5 rounded-full bg-family-purple flex items-center justify-center":"w-5 h-5 rounded-full border-2 border-gray-300"),te(),nt(r.selectAll?11:-1),te(4),Wt(r.allUsers),te(39),Ft("disabled",r.editTaskForm.invalid||!r.hasSelection))},dependencies:[bh,yh,Dc,Ic,Mr,Ya,to,_h,Op,Bu,Lu,Ui],encapsulation:2})}}return n})();var Uge=["previewImg"];function $ge(n,t){n&1&&(V(0,"span",15),Z(1,"Charge !"),U())}function Hge(n,t){if(n&1){let e=Tt();V(0,"div",7)(1,"h3",8),Z(2,"\u270F\uFE0F Modifier le profil"),U(),V(3,"form",9),Fe("ngSubmit",function(){Ve(e);let r=_e();return je(r.onSubmitProfileForm())}),V(4,"div",10),st(5,"img",11),V(6,"label",12)(7,"span",13),Z(8,"Choisir une photo"),U(),V(9,"input",14),Fe("change",function(r){Ve(e);let o=_e();return je(o.detectFiles(r))}),U()(),tt(10,$ge,2,0,"span",15),U(),V(11,"div")(12,"label",16),Z(13,"Prenom"),U(),st(14,"input",17),U(),V(15,"div")(16,"label",18),Z(17,"Telephone"),U(),st(18,"input",19),U(),V(19,"div")(20,"label",20),Z(21,"Email"),U(),st(22,"input",21),U(),V(23,"div")(24,"label",22),Z(25,"Anniversaire"),U(),st(26,"input",23),U(),V(27,"button",24),Z(28,"Enregistrer"),U()()(),V(29,"div",25)(30,"h3",8),Z(31,"\u{1F4C5} Google Calendar"),U(),V(32,"div",26),st(33,"div",27),V(34,"span",28),Z(35,"Connecte automatiquement via votre compte Google"),U()()()}if(n&2){let e=_e();te(3),Ft("formGroup",e.profileForm),te(2),Ft("src",e.fileUrl,Vi),te(5),nt(e.fileUploaded?10:-1),te(17),Ft("disabled",e.profileForm.invalid)}}var V7=(()=>{class n{constructor(e,i,r){this.editProfileService=e,this._snackBar=i,this.formBuilder=r,this.user=null,this.fileIsUploading=!1,this.fileUploaded=!1}ngOnInit(){this.userSubscription=this.editProfileService.getUserData().subscribe(e=>{this.user=e,this.user&&this.initForm(this.user)},()=>{this._snackBar.open("Erreur lors du chargement du profil","",{duration:5e3})})}initForm(e){this.profileForm=this.formBuilder.group({emailControl:[{value:e?.email||"",disabled:!0},[as.required,as.email]],displayNameControl:[e?.displayName||""],phoneNumberControl:[e?.phoneNumber||""],photoURLControl:[""],dateBirthControl:[e?.dateBirth?e.dateBirth.substring(0,10):""]}),this.fileUrl=this.user?.photoURL||"https://i.pinimg.com/originals/2f/15/f2/2f15f2e8c688b3120d3d26467b06330c.jpg"}loadFile(e){this.fileIsUploading=!0;let i=this.user?.photoURL||"";this.editProfileService.deleteOldAvatar(i).then(()=>this.editProfileService.uploadFile(e)).then(r=>{this.fileUrl=r,this.profileForm.get("photoURLControl")?.setValue(""),this.fileIsUploading=!1,this.fileUploaded=!0})}detectFiles(e){let i=e.target;i.files?.[0]&&this.loadFile(i.files[0])}onSubmitProfileForm(){let e=this.user?.uid;if(!e)return;let i=this.profileForm.value,r={displayName:i.displayNameControl||"",phoneNumber:i.phoneNumberControl||"",photoURL:this.fileUrl,dateBirth:i.dateBirthControl||""};this.editProfileService.updateUserData(e,r).then(()=>this._snackBar.open("Profil mis a jour","avec succes !!",{duration:5e3})).catch(()=>this._snackBar.open("Erreur lors de la mise a jour","",{duration:5e3}))}ngOnDestroy(){this.userSubscription&&this.userSubscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(Ze(mh),Ze(Qi),Ze(vh))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-user-profile"]],viewQuery:function(i,r){if(i&1&&ws(Uge,5),i&2){let o;Do(o=Io())&&(r.previewImg=o.first)}},decls:10,vars:4,consts:[[1,"card-fun","overflow-hidden","mb-6"],[1,"h-24","bg-gradient-to-r","from-family-pink","via-family-coral","to-family-orange"],[1,"px-6","pb-6","-mt-10","flex","items-end","gap-4"],["alt","Photo de profil","referrerpolicy","no-referrer",1,"h-20","w-20","rounded-full","object-cover","ring-4","ring-white","shadow-lg",3,"src"],[1,"pb-1"],[1,"font-display","text-xl","font-bold","text-gray-700"],[1,"text-sm","text-gray-400"],[1,"card-fun","p-6","max-w-lg","mx-auto"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-4"],[1,"space-y-4",3,"ngSubmit","formGroup"],[1,"flex","items-center","gap-4"],["alt","Avatar","referrerpolicy","no-referrer",1,"h-14","w-14","rounded-full","object-cover","ring-2","ring-family-pink/30",3,"src"],[1,"block"],[1,"sr-only"],["formControlName","photoURLControl","type","file","accept","image/*",1,"block","w-full","text-sm","text-gray-500","file:mr-3","file:py-2","file:px-4","file:rounded-full","file:border-0","file:text-sm","file:font-semibold","file:bg-family-pink/10","file:text-family-pink","hover:file:bg-family-pink/20","transition-colors",3,"change"],[1,"text-family-green","text-sm","font-medium"],["for","prenom",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["type","text","id","prenom","formControlName","displayNameControl","placeholder","Prenom",1,"input-fun","w-full"],["for","phone",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["type","tel","id","phone","formControlName","phoneNumberControl","placeholder","Votre numero",1,"input-fun","w-full"],["for","email",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["type","email","id","email","formControlName","emailControl","placeholder","Votre email",1,"input-fun","w-full"],["for","dateBirth",1,"block","mb-1","text-sm","font-medium","text-gray-600"],["type","date","id","dateBirth","formControlName","dateBirthControl",1,"input-fun","w-full"],["type","submit",1,"btn-gradient","w-full",3,"disabled"],[1,"card-fun","p-6","max-w-lg","mx-auto","mt-6"],[1,"flex","items-center","gap-3"],[1,"w-3","h-3","rounded-full","bg-family-green"],[1,"text-sm","text-gray-600"]],template:function(i,r){i&1&&(V(0,"div",0),st(1,"div",1),V(2,"div",2),st(3,"img",3),V(4,"div",4)(5,"h2",5),Z(6),U(),V(7,"p",6),Z(8),U()()()(),tt(9,Hge,36,4)),i&2&&(te(3),Ft("src",r.fileUrl,Vi),te(3),ht((r.user==null?null:r.user.displayName)||"Mon Profil"),te(2),ht(r.user==null?null:r.user.email),te(),nt(r.profileForm?9:-1))},dependencies:[bh,yh,Mr,to,_h,Bu,Lu],encapsulation:2})}}return n})();var Gge=(n,t)=>t.id;function qge(n,t){if(n&1&&(V(0,"option",16),Z(1),U()),n&2){let e=t.$implicit;Ft("value",e.id),te(),ht(e.summary)}}function Wge(n,t){if(n&1&&(V(0,"div")(1,"label",3),Z(2,"Agenda"),U(),V(3,"select",15),qt(4,qge,2,2,"option",16,Gge),U()()),n&2){let e=_e();te(4),Wt(e.data.calendars)}}function Zge(n,t){n&1&&(V(0,"div",9)(1,"div")(2,"label",3),Z(3,"Heure debut"),U(),st(4,"input",17),U(),V(5,"div")(6,"label",3),Z(7,"Heure fin"),U(),st(8,"input",18),U()())}var j7=(()=>{class n{constructor(e,i,r){this.fb=e,this.dialogRef=i,this.data=r;let o=this.formatLocalDate(r.date),d=ss.googleCalendar.familyCalendarId,m=r.calendars?.find(b=>b.id===d)?.id||r.calendars?.find(b=>b.primary)?.id||"primary";this.eventForm=this.fb.group({title:["",as.required],description:[""],calendarId:[m],allDay:[!0],startDate:[o,as.required],endDate:[o,as.required],startTime:["09:00"],endTime:["10:00"]})}onCancel(){this.dialogRef.close()}onSubmit(){if(this.eventForm.invalid)return;let e=this.eventForm.value,i=e.endDate;if(e.allDay){let o=new Date(e.endDate+"T00:00:00");o.setDate(o.getDate()+1),i=this.formatLocalDate(o)}let r={id:"",title:e.title,description:e.description,allDay:e.allDay,calendarId:e.calendarId||"primary",startDate:e.allDay?e.startDate:`${e.startDate}T${e.startTime}:00`,endDate:e.allDay?i:`${e.endDate}T${e.endTime}:00`};this.dialogRef.close(r)}formatLocalDate(e){let i=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${i}-${r}-${o}`}static{this.\u0275fac=function(i){return new(i||n)(Ze(vh),Ze(Dl),Ze(mp))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-add-event-dialog"]],decls:32,vars:4,consts:[[1,"p-6"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-4"],[1,"space-y-4",3,"formGroup"],[1,"block","mb-1","text-sm","font-medium","text-gray-600"],["formControlName","title","placeholder","Ex. Reunion famille...","required","",1,"input-fun","w-full"],["formControlName","description","rows","3","placeholder","Details...",1,"input-fun","w-full","resize-y"],[1,"flex","items-center","gap-2","mb-2"],["type","checkbox","formControlName","allDay","id","allDay",1,"rounded"],["for","allDay",1,"text-sm","text-gray-600"],[1,"grid","grid-cols-2","gap-3"],["formControlName","startDate","type","date",1,"input-fun","w-full"],["formControlName","endDate","type","date",1,"input-fun","w-full"],[1,"flex","justify-end","gap-3","pt-2"],["type","button",1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","font-medium","text-sm",3,"click"],["type","button",1,"btn-gradient","px-6","py-2",3,"click","disabled"],["formControlName","calendarId",1,"input-fun","w-full"],[3,"value"],["formControlName","startTime","type","time",1,"input-fun","w-full"],["formControlName","endTime","type","time",1,"input-fun","w-full"]],template:function(i,r){if(i&1&&(V(0,"div",0)(1,"h2",1),Z(2,"Nouvel evenement"),U(),V(3,"form",2)(4,"div")(5,"label",3),Z(6,"Titre"),U(),st(7,"input",4),U(),tt(8,Wge,6,0,"div"),V(9,"div")(10,"label",3),Z(11,"Description"),U(),st(12,"textarea",5),U(),V(13,"div",6),st(14,"input",7),V(15,"label",8),Z(16,"Toute la journee"),U()(),V(17,"div",9)(18,"div")(19,"label",3),Z(20,"Debut"),U(),st(21,"input",10),U(),V(22,"div")(23,"label",3),Z(24,"Fin"),U(),st(25,"input",11),U()(),tt(26,Zge,9,0,"div",9),V(27,"div",12)(28,"button",13),Fe("click",function(){return r.onCancel()}),Z(29," Annuler "),U(),V(30,"button",14),Fe("click",function(){return r.onSubmit()}),Z(31," Creer "),U()()()()),i&2){let o;te(3),Ft("formGroup",r.eventForm),te(5),nt(r.data.calendars&&r.data.calendars.length>1?8:-1),te(18),nt((o=r.eventForm.get("allDay"))!=null&&o.value?-1:26),te(4),Ft("disabled",r.eventForm.invalid)}},dependencies:[bh,yh,Dc,Ic,Mr,sF,Ya,to,_h,Op,Bu,Lu],encapsulation:2})}}return n})();function Kge(n,t){if(n&1&&(Ot(0,"div",5)(1,"span",6),Z(2,"\u{1F4C5}"),At(),Ot(3,"span"),Z(4),At()()),n&2){let e=_e();te(4),ht(e.data.event.calendarName)}}function Yge(n,t){if(n&1&&(Ot(0,"span"),Z(1),gu(2,"date"),At()),n&2){let e=_e();te(),tn("Toute la journee \xB7 ",_u(2,1,e.data.event.startDate,"EEEE d MMMM yyyy","","fr"))}}function Xge(n,t){if(n&1&&(Ot(0,"span"),Z(1),gu(2,"date"),gu(3,"date"),At()),n&2){let e=_e();te(),Tr("",_u(2,2,e.data.event.startDate,"EEEE d MMMM yyyy, HH:mm","","fr")," \u2014 ",_u(3,7,e.data.event.endDate,"HH:mm","","fr"))}}function Qge(n,t){if(n&1&&(Ot(0,"div",7)(1,"span",11),Z(2,"\u{1F4CD}"),At(),Ot(3,"span"),Z(4),At()()),n&2){let e=_e();te(4),ht(e.data.event.location)}}function Jge(n,t){if(n&1&&(Ot(0,"div",5)(1,"span",6),Z(2,"\u{1F464}"),At(),Ot(3,"span"),Z(4,"Cree par : "),Ot(5,"span",12),Z(6),At()()()),n&2){let e=_e();te(6),ht(e.data.event.creatorName)}}function e_e(n,t){if(n&1&&(Ot(0,"div",8),Z(1),At()),n&2){let e=_e();te(),ht(e.data.event.description)}}var z7=(()=>{class n{constructor(e,i){this.dialogRef=e,this.data=i}close(){this.dialogRef.close()}static{this.\u0275fac=function(i){return new(i||n)(Ze(Dl),Ze(mp))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-event-detail-dialog"]],decls:18,vars:8,consts:[[1,"p-6"],[1,"flex","items-center","gap-3","mb-4"],[1,"w-3","h-3","rounded-full","shrink-0"],[1,"font-display","text-lg","font-bold","text-gray-700"],[1,"space-y-3","text-sm"],[1,"flex","items-center","gap-2","text-gray-500"],[1,"w-5","text-center"],[1,"flex","items-start","gap-2","text-gray-500"],[1,"mt-3","p-3","bg-gray-50","rounded-xl","text-gray-600","text-sm","whitespace-pre-wrap"],[1,"flex","justify-end","pt-4"],[1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","font-medium","text-sm",3,"click"],[1,"w-5","text-center","shrink-0"],[1,"font-medium","text-gray-600"]],template:function(i,r){i&1&&(Ot(0,"div",0)(1,"div",1),zo(2,"div",2),Ot(3,"h2",3),Z(4),At()(),Ot(5,"div",4),tt(6,Kge,5,1,"div",5),Ot(7,"div",5)(8,"span",6),Z(9,"\u{1F550}"),At(),tt(10,Yge,3,6,"span")(11,Xge,4,12,"span"),At(),tt(12,Qge,5,1,"div",7),tt(13,Jge,7,1,"div",5),tt(14,e_e,2,1,"div",8),At(),Ot(15,"div",9)(16,"button",10),ho("click",function(){return r.close()}),Z(17," Fermer "),At()()()),i&2&&(te(2),yl("background-color",r.data.event.color||"#4285f4"),te(2),ht(r.data.event.title),te(2),nt(r.data.event.calendarName?6:-1),te(4),nt(r.data.event.allDay?10:11),te(2),nt(r.data.event.location?12:-1),te(),nt(r.data.event.creatorName?13:-1),te(),nt(r.data.event.description?14:-1))},dependencies:[Ui,Wf],encapsulation:2})}}return n})();var wh=(()=>{class n{constructor(e){this.authService=e,this.gapiLoaded=!1,this.tokenClient=null,this.accessToken=null,this.googleEmail=null,this.signInResolve=null,this.connectionChanged=new yt,this.authService.googleToken$.subscribe(i=>{this.setToken(i)}),Pu(an,i=>{i&&!this.accessToken&&setTimeout(()=>{this.accessToken||this.requestTokenSilently()},1500)})}requestTokenSilently(){return ae(this,null,function*(){try{yield this.loadGapi(),yield this.initTokenClient(),this.tokenClient&&this.tokenClient.requestAccessToken({prompt:""})}catch(e){}})}setToken(e){this.accessToken=e,this.loadGapi().then(()=>{gapi.client.setToken({access_token:e})}).catch(()=>{}),this.fetchGoogleEmail(),this.saveConnectionStatus(!0),this.connectionChanged.next(!0)}loadGapi(){return this.gapiLoaded?Promise.resolve():new Promise((e,i)=>{let r=()=>{if(typeof gapi>"u"){setTimeout(r,200);return}gapi.load("client",()=>ae(this,null,function*(){try{yield gapi.client.init({discoveryDocs:ss.googleCalendar.discoveryDocs}),this.gapiLoaded=!0,e()}catch(o){i(o)}}))};r()})}initTokenClient(){return new Promise(e=>{let i=()=>{if(typeof google>"u"||!google.accounts?.oauth2){setTimeout(i,200);return}this.tokenClient=google.accounts.oauth2.initTokenClient({client_id:ss.googleCalendar.clientId,scope:ss.googleCalendar.scopes,callback:r=>{if(r.error){this.signInResolve&&(this.signInResolve(!1),this.signInResolve=null);return}this.accessToken=r.access_token||null,this.accessToken&&(gapi.client.setToken({access_token:this.accessToken}),this.fetchGoogleEmail()),this.saveConnectionStatus(!!this.accessToken),this.connectionChanged.next(!!this.accessToken),this.signInResolve&&(this.signInResolve(!!this.accessToken),this.signInResolve=null)}}),e()};i()})}signIn(){return new Promise(e=>{if(!this.tokenClient){e(!1);return}this.signInResolve=e,this.tokenClient.requestAccessToken({prompt:"consent"})})}signOut(){if(this.accessToken){try{google.accounts.oauth2.revoke(this.accessToken)}catch(e){}try{gapi.client.setToken(null)}catch(e){}this.accessToken=null,this.googleEmail=null,this.saveConnectionStatus(!1),this.connectionChanged.next(!1)}}isConnected(){return!!this.accessToken}getAccessToken(){return this.accessToken}getGoogleEmail(){return this.googleEmail}fetchGoogleEmail(){return ae(this,null,function*(){try{let i=yield(yield fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${this.accessToken}`}})).json();this.googleEmail=i.email||null}catch(e){this.googleEmail=null}})}saveConnectionStatus(e){let i=an.currentUser?.uid;i&&is(zt(Ut,`/users/${i}`),{googleCalendar:{connected:e,calendarId:"primary"}})}static{this.\u0275fac=function(i){return new(i||n)(vt(eo))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var U7=(()=>{class n{constructor(e,i){this.googleAuth=e,this.authService=i,this.events=[],this.eventsSubject=new yt,this.calendars=[],this.calendarsSubject=new yt}emitEvents(){this.eventsSubject.next(this.events)}ensureToken(){let e=this.googleAuth.getAccessToken();e&&gapi.client.setToken({access_token:e})}getCalendars(){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return[];try{yield this.googleAuth.loadGapi(),this.ensureToken();let e=yield gapi.client.calendar.calendarList.list();console.log("Calendar list response:",e.result.items?.length,"calendars");let i=(e.result.items||[]).filter(o=>{let d=o.id||"";return!d.includes("#weeknum")&&!d.includes("#contacts")&&!d.includes("#holiday")&&!d.includes("addressbook")});this.calendars=i.map(o=>({id:o.id,summary:o.summary||o.id,backgroundColor:o.backgroundColor||"#4285f4",primary:!!o.primary}));let r=ss.googleCalendar.familyCalendarId;return r&&!this.calendars.find(o=>o.id===r)&&this.calendars.push({id:r,summary:"Famille",backgroundColor:"#e67c73"}),this.calendarsSubject.next(this.calendars),this.calendars}catch(e){return[]}})}getEvents(e,i){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return[];try{yield this.googleAuth.loadGapi(),this.ensureToken(),this.calendars.length===0&&(yield this.getCalendars());let r=an.currentUser,o=this.calendars.map(b=>ae(this,null,function*(){try{return((yield gapi.client.calendar.events.list({calendarId:b.id,timeMin:e.toISOString(),timeMax:i.toISOString(),showDeleted:!1,singleEvents:!0,orderBy:"startTime"})).result.items||[]).map(A=>({id:A.id,title:A.summary||"(Sans titre)",description:A.description||"",startDate:A.start?.dateTime||A.start?.date||"",endDate:A.end?.dateTime||A.end?.date||"",allDay:!!A.start?.date,color:b.backgroundColor,calendarId:b.id,calendarName:b.summary,location:A.location||"",creatorUid:r?.uid||"",creatorName:A.creator?.displayName||A.creator?.email||""}))}catch(T){return console.error("Error fetching events from",b.id,T),[]}})),d=yield Promise.all(o),m=[];return d.forEach(b=>m.push(...b)),console.log("Total events fetched:",m.length,"from",this.calendars.length,"calendars"),m.sort((b,T)=>b.startDate.localeCompare(T.startDate)),this.events=m,this.emitEvents(),this.events}catch(r){return[]}})}createEvent(e){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return null;try{yield this.googleAuth.loadGapi(),this.ensureToken();let i=e.calendarId||ss.googleCalendar.familyCalendarId||"primary",r={summary:e.title,description:e.description||""};e.allDay?(r.start={date:e.startDate.substring(0,10)},r.end={date:e.endDate.substring(0,10)}):(r.start={dateTime:e.startDate},r.end={dateTime:e.endDate});let o=yield gapi.client.calendar.events.insert({calendarId:i,resource:r}),d=this.calendars.find(b=>b.id===i);return{id:o.result.id,title:o.result.summary,description:o.result.description||"",startDate:o.result.start?.dateTime||o.result.start?.date||"",endDate:o.result.end?.dateTime||o.result.end?.date||"",allDay:!!o.result.start?.date,calendarId:i,calendarName:d?.summary||i,color:d?.backgroundColor}}catch(i){return null}})}deleteEvent(e,i="primary"){return ae(this,null,function*(){if(this.googleAuth.isConnected())try{yield this.googleAuth.loadGapi(),this.ensureToken(),yield gapi.client.calendar.events.delete({calendarId:i,eventId:e})}catch(r){}})}static{this.\u0275fac=function(i){return new(i||n)(vt(wh),vt(eo))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var jF=(n,t)=>t.id;function n_e(n,t){if(n&1){let e=Tt();Ot(0,"div",4)(1,"div",5),Z(2,"\u{1F4C5}"),At(),Ot(3,"h2",6),Z(4,"Chargement du calendrier..."),At(),Ot(5,"p",7),Z(6,"Connexion a Google Calendar en cours"),At(),Ot(7,"button",8),ho("click",function(){Ve(e);let r=_e();return je(r.connectGoogle())}),Z(8," Reconnecter Google Calendar "),At()()}}function i_e(n,t){if(n&1&&(Ot(0,"div",24),zo(1,"div",25),Ot(2,"span",26),Z(3),At()()),n&2){let e=t.$implicit;te(),yl("background-color",e.backgroundColor),te(2),ht(e.summary)}}function r_e(n,t){if(n&1&&(Ot(0,"div",17)(1,"div",23),qt(2,i_e,4,3,"div",24,jF),At()()),n&2){let e=_e(2);te(2),Wt(e.calendars)}}function o_e(n,t){if(n&1&&(Ot(0,"div",20),Z(1),At()),n&2){let e=t.$implicit;te(),ht(e)}}function s_e(n,t){if(n&1&&(Ot(0,"span",32),Z(1),At()),n&2){let e=_e(2).$implicit,i=_e(3);te(),tn("S",i.getWeekNumber(e))}}function a_e(n,t){if(n&1){let e=Tt();Ot(0,"div",34),ho("click",function(r){let o=Ve(e).$implicit;return _e(5).viewEvent(o),je(r.stopPropagation())}),Z(1),At()}if(n&2){let e=t.$implicit;yl("background-color",e.color||"#4285f4"),Sg("title",e.calendarName?e.calendarName+" \u2014 "+e.title:e.title),te(),tn(" ",e.title," ")}}function l_e(n,t){if(n&1){let e=Tt();Ot(0,"div",29),ho("click",function(){Ve(e);let r=_e().$implicit,o=_e(3);return je(o.openAddEvent(r))}),Ot(1,"div",30)(2,"span",31),Z(3),At(),tt(4,s_e,2,1,"span",32),At(),qt(5,a_e,2,4,"div",33,jF),At()}if(n&2){let e=_e().$implicit,i=_e(3);ji("bg-gradient-to-br",i.isToday(e))("from-family-pink/10",i.isToday(e))("to-family-orange/10",i.isToday(e))("border-family-pink",i.isToday(e))("border-gray-100",!i.isToday(e)),te(2),ji("text-family-pink",i.isToday(e))("text-gray-600",!i.isToday(e)),te(),tn(" ",e.getDate()," "),te(),nt(i.isMonday(e)?4:-1),te(),Wt(i.getEventsForDay(e))}}function c_e(n,t){n&1&&zo(0,"div",28)}function u_e(n,t){if(n&1&&tt(0,l_e,7,16,"div",27)(1,c_e,1,0,"div",28),n&2){let e=t.$implicit;nt(e?0:1)}}function d_e(n,t){if(n&1&&(Ot(0,"div",21),qt(1,u_e,2,1,null,null,Hf),At()),n&2){let e=t.$implicit;te(),Wt(e)}}function h_e(n,t){if(n&1&&(Ot(0,"span",43),Z(1),At(),Z(2," \xB7 ")),n&2){let e=_e().$implicit;te(),ht(e.calendarName)}}function f_e(n,t){if(n&1&&Z(0),n&2){let e=_e().$implicit;tn(" ",e.creatorName," \xB7 ")}}function p_e(n,t){n&1&&Z(0," Toute la journee ")}function m_e(n,t){if(n&1&&(Z(0),gu(1,"date")),n&2){let e=_e().$implicit;tn(" ",_u(1,1,e.startDate,"d MMM, HH:mm","","fr")," ")}}function g_e(n,t){if(n&1){let e=Tt();Ot(0,"button",44),ho("click",function(r){Ve(e);let o=_e().$implicit;return _e(3).confirmDeleteEvent(o),je(r.stopPropagation())}),Z(1," Supprimer "),At()}}function __e(n,t){if(n&1){let e=Tt();Ot(0,"div",37),ho("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.viewEvent(r))}),Ot(1,"div",38),zo(2,"div",39),Ot(3,"div")(4,"div",40),Z(5),At(),Ot(6,"div",41),tt(7,h_e,3,1),tt(8,f_e,1,1),tt(9,p_e,1,0)(10,m_e,2,6),At()()(),tt(11,g_e,2,0,"button",42),At()}if(n&2){let e=t.$implicit,i=_e(3);te(2),yl("background-color",e.color||"#4285f4"),te(3),ht(e.title),te(2),nt(e.calendarName?7:-1),te(),nt(e.creatorName?8:-1),te(),nt(e.allDay?9:10),te(2),nt(i.canDelete(e)?11:-1)}}function y_e(n,t){if(n&1&&(Ot(0,"div",22)(1,"h3",35),Z(2,"Prochains evenements"),At(),qt(3,__e,12,7,"div",36,jF),At()),n&2){let e=_e(2);te(3),Wt(e.events)}}function v_e(n,t){if(n&1){let e=Tt();Ot(0,"div",9)(1,"div",10)(2,"div",11)(3,"button",12),ho("click",function(){Ve(e);let r=_e();return je(r.previousMonth())}),Z(4," < "),At(),Ot(5,"h2",13),Z(6),At(),Ot(7,"button",12),ho("click",function(){Ve(e);let r=_e();return je(r.nextMonth())}),Z(8," > "),At(),Ot(9,"button",14),ho("click",function(){Ve(e);let r=_e();return je(r.goToday())}),Z(10," Aujourd'hui "),At()(),Ot(11,"div",15)(12,"button",16),ho("click",function(){Ve(e);let r=_e();return je(r.openAddEvent())}),Z(13," + Nouvel evenement "),At()()()(),tt(14,r_e,4,0,"div",17),Ot(15,"div",18)(16,"div",19),qt(17,o_e,2,1,"div",20,So),At(),qt(19,d_e,3,0,"div",21,Hf),At(),tt(21,y_e,5,0,"div",22)}if(n&2){let e=_e();te(6),tn(" ",e.monthLabel," "),te(8),nt(e.calendars.length>1?14:-1),te(3),Wt(e.weekDays),te(2),Wt(e.daysInMonth),te(2),nt(e.events.length>0?21:-1)}}var $7=(()=>{class n{constructor(e,i,r,o){this.googleAuth=e,this.calendarService=i,this.dialog=r,this.snackBar=o,this.isConnected=!1,this.currentDate=new Date,this.viewMode="month",this.events=[],this.calendars=[],this.daysInMonth=[],this.weekDays=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"]}ngOnInit(){this.eventsSubscription=this.calendarService.eventsSubject.subscribe(e=>this.events=e.filter(i=>!this.isWeekNumberEvent(i))),this.calendarsSubscription=this.calendarService.calendarsSubject.subscribe(e=>this.calendars=e),this.connectionSubscription=this.googleAuth.connectionChanged.subscribe(e=>{this.isConnected=e,e&&this.loadEvents()}),this.initGoogle(),this.buildCalendarGrid()}initGoogle(){return ae(this,null,function*(){try{yield this.googleAuth.loadGapi(),yield this.googleAuth.initTokenClient();let e=this.googleAuth.getAccessToken();e&&window.gapi.client.setToken({access_token:e}),this.isConnected=this.googleAuth.isConnected(),this.isConnected&&this.loadEvents()}catch(e){}})}connectGoogle(){this.googleAuth.signIn().then(e=>{this.isConnected=e,e&&(this.loadEvents(),this.snackBar.open("Google Calendar connecte !","",{duration:3e3}))})}disconnectGoogle(){this.googleAuth.signOut(),this.isConnected=!1,this.events=[],this.snackBar.open("Google Calendar deconnecte","",{duration:3e3})}loadEvents(){let{start:e,end:i}=this.getMonthRange();this.calendarService.getEvents(e,i)}getMonthRange(){let e=this.currentDate.getFullYear(),i=this.currentDate.getMonth();return{start:new Date(e,i,1),end:new Date(e,i+1,0,23,59,59)}}buildCalendarGrid(){let e=this.currentDate.getFullYear(),i=this.currentDate.getMonth(),r=new Date(e,i,1),o=new Date(e,i+1,0),d=r.getDay()-1;d<0&&(d=6);let m=[];for(let b=0;b<d;b++)m.push(null);for(let b=1;b<=o.getDate();b++)m.push(new Date(e,i,b));for(;m.length%7!==0;)m.push(null);this.daysInMonth=[];for(let b=0;b<m.length;b+=7)this.daysInMonth.push(m.slice(b,b+7))}isWeekNumberEvent(e){let i=e.title.trim();return/^(S|W|Wk|Semaine|Week)\s?\d{1,2}$/.test(i)||(e.calendarId?.includes("#weeknum")??!1)}getEventsForDay(e){if(!e)return[];let i=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`;return this.events.filter(r=>{let o;if(r.allDay)o=r.startDate.substring(0,10);else{let d=new Date(r.startDate);o=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`}return o===i&&!this.isWeekNumberEvent(r)})}getWeekNumber(e){if(!e)return 0;let i=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()));i.setUTCDate(i.getUTCDate()+4-(i.getUTCDay()||7));let r=new Date(Date.UTC(i.getUTCFullYear(),0,1));return Math.ceil(((i.getTime()-r.getTime())/864e5+1)/7)}isMonday(e){return!!e&&e.getDay()===1}isToday(e){if(!e)return!1;let i=new Date;return e.getDate()===i.getDate()&&e.getMonth()===i.getMonth()&&e.getFullYear()===i.getFullYear()}previousMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,1),this.buildCalendarGrid(),this.isConnected&&this.loadEvents()}nextMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,1),this.buildCalendarGrid(),this.isConnected&&this.loadEvents()}goToday(){this.currentDate=new Date,this.buildCalendarGrid(),this.isConnected&&this.loadEvents()}get monthLabel(){return this.currentDate.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}openAddEvent(e){this.dialog.open(j7,{data:{date:e||new Date,calendars:this.calendars},width:"400px"}).afterClosed().subscribe(r=>{r&&this.calendarService.createEvent(r).then(o=>{o&&(this.loadEvents(),this.snackBar.open("Evenement cree !","",{duration:3e3}))})})}viewEvent(e){this.dialog.open(z7,{data:{event:e},width:"400px"})}canDelete(e){let i=this.googleAuth.getGoogleEmail();return i?e.creatorName===i:!1}confirmDeleteEvent(e){this.dialog.open(Ms,{data:{customMessage:`Supprimer "${e.title}" ?`}}).afterClosed().subscribe(i=>{i&&this.calendarService.deleteEvent(e.id,e.calendarId||"primary").then(()=>{this.loadEvents(),this.snackBar.open("Evenement supprime","",{duration:3e3})})})}ngOnDestroy(){this.eventsSubscription&&this.eventsSubscription.unsubscribe(),this.calendarsSubscription&&this.calendarsSubscription.unsubscribe(),this.connectionSubscription&&this.connectionSubscription.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(Ze(wh),Ze(U7),Ze(ya),Ze(Qi))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-calendar"]],decls:8,vars:2,consts:[[1,"max-w-4xl","mx-auto"],[1,"card-fun","bg-gradient-to-r","from-family-sky","via-family-purple","to-family-pink","p-6","mb-6","text-white"],[1,"font-display","text-2xl","font-bold"],[1,"mt-1","opacity-90"],[1,"card-fun","p-8","text-center"],[1,"text-5xl","mb-4"],[1,"font-display","text-lg","font-bold","text-gray-700","mb-2"],[1,"text-gray-500","mb-6"],[1,"btn-gradient","px-6","py-3","text-lg",3,"click"],[1,"card-fun","p-4","mb-4"],[1,"flex","items-center","justify-between","flex-wrap","gap-3"],[1,"flex","items-center","gap-2"],[1,"p-2","rounded-xl","hover:bg-warm-50","transition-colors","text-gray-600",3,"click"],[1,"font-display","font-bold","text-gray-700","text-lg","capitalize","min-w-[180px]","text-center"],[1,"ml-2","px-3","py-1","rounded-xl","border","border-gray-200","text-sm","text-gray-600","hover:bg-warm-50","transition-colors",3,"click"],[1,"flex","gap-2"],[1,"btn-gradient","px-4","py-2","text-sm",3,"click"],[1,"card-fun","p-3","mb-4"],[1,"card-fun","p-4"],[1,"grid","grid-cols-7","gap-1","mb-2"],[1,"text-center","text-xs","font-semibold","text-gray-500","py-2"],[1,"grid","grid-cols-7","gap-1","mb-1"],[1,"card-fun","p-4","mt-4"],[1,"flex","flex-wrap","gap-3"],[1,"flex","items-center","gap-1.5"],[1,"w-3","h-3","rounded-full"],[1,"text-xs","text-gray-600","font-medium"],[1,"min-h-20","p-1","rounded-xl","border","cursor-pointer","transition-all","hover:shadow-md",3,"bg-gradient-to-br","from-family-pink/10","to-family-orange/10","border-family-pink","border-gray-100"],[1,"min-h-20","p-1","rounded-xl","bg-gray-50/50"],[1,"min-h-20","p-1","rounded-xl","border","cursor-pointer","transition-all","hover:shadow-md",3,"click"],[1,"flex","items-center","justify-between","mb-1"],[1,"text-xs","font-semibold"],[1,"text-[9px]","text-gray-300","font-medium"],[1,"text-[10px]","rounded","px-1","py-0.5","mb-0.5","truncate","text-white","cursor-pointer","hover:opacity-80","transition-opacity",3,"background-color","title"],[1,"text-[10px]","rounded","px-1","py-0.5","mb-0.5","truncate","text-white","cursor-pointer","hover:opacity-80","transition-opacity",3,"click","title"],[1,"font-display","font-bold","text-gray-700","mb-3"],[1,"flex","items-center","justify-between","p-3","rounded-xl","hover:bg-warm-50","transition-colors","mb-1","cursor-pointer"],[1,"flex","items-center","justify-between","p-3","rounded-xl","hover:bg-warm-50","transition-colors","mb-1","cursor-pointer",3,"click"],[1,"flex","items-center","gap-3"],[1,"w-2","h-2","rounded-full"],[1,"font-medium","text-gray-700","text-sm"],[1,"text-xs","text-gray-400"],[1,"text-red-300","hover:text-red-500","text-sm","transition-colors"],[1,"font-medium"],[1,"text-red-300","hover:text-red-500","text-sm","transition-colors",3,"click"]],template:function(i,r){i&1&&(Ot(0,"div",0)(1,"div",1)(2,"h1",2),Z(3,"Calendrier"),At(),Ot(4,"p",3),Z(5,"Vos evenements Google Calendar"),At()(),tt(6,n_e,9,0,"div",4),tt(7,v_e,22,3),At()),i&2&&(te(6),nt(r.isConnected?-1:6),te(),nt(r.isConnected?7:-1))},dependencies:[Ui,Wf],encapsulation:2})}}return n})();var H7=(()=>{class n{constructor(e){this.googleAuth=e,this.files=[],this.filesSubject=new yt,this.breadcrumb=[],this.breadcrumbSubject=new yt,this.rootFolderId=null,this.currentFolderId=null}ensureToken(){let e=this.googleAuth.getAccessToken();e&&gapi.client.setToken({access_token:e})}ensureRootFolder(){return ae(this,null,function*(){if(this.rootFolderId)return this.rootFolderId;if(!this.googleAuth.isConnected())throw new Error("Not connected");let e=ss.googleCalendar.familyDriveFolderId;if(e)return this.rootFolderId=e,this.rootFolderId;yield this.googleAuth.loadGapi(),this.ensureToken();let r=(yield gapi.client.drive.files.list({q:"name='FamilyApp' and mimeType='application/vnd.google-apps.folder' and trashed=false",fields:"files(id,name)",spaces:"drive"})).result.files||[];if(r.length>0)return this.rootFolderId=r[0].id,this.rootFolderId;let o=yield gapi.client.drive.files.create({resource:{name:"FamilyApp",mimeType:"application/vnd.google-apps.folder"},fields:"id"});return this.rootFolderId=o.result.id,this.rootFolderId})}listFiles(e){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return[];try{yield this.googleAuth.loadGapi(),this.ensureToken();let i=yield this.ensureRootFolder(),r=e||i;this.currentFolderId=r;let o=yield gapi.client.drive.files.list({q:`'${r}' in parents and trashed=false`,fields:"files(id,name,mimeType,webViewLink,iconLink,thumbnailLink,createdTime,properties)",orderBy:"folder,name",pageSize:100,includeItemsFromAllDrives:!0,supportsAllDrives:!0,corpora:"allDrives"});return this.files=(o.result.files||[]).map(d=>({id:d.id,name:d.name,mimeType:d.mimeType,webViewLink:d.webViewLink||"",iconLink:d.iconLink||"",thumbnailLink:d.thumbnailLink||"",createdTime:d.createdTime||"",isFolder:d.mimeType==="application/vnd.google-apps.folder",uploadedBy:d.properties?.uploadedBy||"",uploadedByName:d.properties?.uploadedByName||""})),this.filesSubject.next(this.files),this.files}catch(i){return[]}})}navigateToFolder(e,i){return ae(this,null,function*(){this.breadcrumb.push({id:e,name:i}),this.breadcrumbSubject.next(this.breadcrumb),yield this.listFiles(e)})}navigateToBreadcrumb(e){return ae(this,null,function*(){if(e<0)this.breadcrumb=[],this.breadcrumbSubject.next(this.breadcrumb),yield this.listFiles();else{let i=this.breadcrumb[e];this.breadcrumb=this.breadcrumb.slice(0,e+1),this.breadcrumbSubject.next(this.breadcrumb),yield this.listFiles(i.id)}})}navigateUp(){return ae(this,null,function*(){if(this.breadcrumb.length===0)return;this.breadcrumb.pop(),this.breadcrumbSubject.next(this.breadcrumb);let e=this.breadcrumb.length>0?this.breadcrumb[this.breadcrumb.length-1].id:void 0;yield this.listFiles(e)})}createFolder(e){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return null;try{yield this.googleAuth.loadGapi(),this.ensureToken();let i=yield this.ensureRootFolder(),r=this.currentFolderId||i,o=an.currentUser,d=yield gapi.client.drive.files.create({resource:{name:e,mimeType:"application/vnd.google-apps.folder",parents:[r],properties:{uploadedBy:o?.uid||"",uploadedByName:o?.displayName||""}},fields:"id,name,mimeType,createdTime"});return{id:d.result.id,name:d.result.name,mimeType:d.result.mimeType,webViewLink:"",iconLink:"",createdTime:d.result.createdTime||"",isFolder:!0,uploadedBy:o?.uid||"",uploadedByName:o?.displayName||""}}catch(i){return null}})}renameFile(e,i){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return!1;try{return yield this.googleAuth.loadGapi(),this.ensureToken(),yield gapi.client.drive.files.update({fileId:e,resource:{name:i}}),!0}catch(r){return!1}})}uploadFile(e){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return null;try{yield this.googleAuth.loadGapi(),this.ensureToken();let i=yield this.ensureRootFolder(),r=this.currentFolderId||i,o=an.currentUser,d={name:e.name,parents:[r],properties:{uploadedBy:o?.uid||"",uploadedByName:o?.displayName||""}},m=this.googleAuth.getAccessToken(),b=new FormData;b.append("metadata",new Blob([JSON.stringify(d)],{type:"application/json"})),b.append("file",e);let A=yield(yield fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,name,mimeType,webViewLink,iconLink,thumbnailLink,createdTime,properties",{method:"POST",headers:{Authorization:`Bearer ${m}`},body:b})).json();return{id:A.id,name:A.name,mimeType:A.mimeType,webViewLink:A.webViewLink||"",iconLink:A.iconLink||"",thumbnailLink:A.thumbnailLink||"",createdTime:A.createdTime||"",isFolder:!1,uploadedBy:o?.uid||"",uploadedByName:o?.displayName||""}}catch(i){return null}})}deleteFile(e){return ae(this,null,function*(){if(this.googleAuth.isConnected())try{yield this.googleAuth.loadGapi(),this.ensureToken(),yield gapi.client.drive.files.delete({fileId:e,supportsAllDrives:!0})}catch(i){}})}moveFile(e,i){return ae(this,null,function*(){if(!this.googleAuth.isConnected())return!1;try{yield this.googleAuth.loadGapi(),this.ensureToken();let o=(yield gapi.client.drive.files.get({fileId:e,fields:"parents"})).result.parents?.join(",")||"";return yield gapi.client.drive.files.update({fileId:e,addParents:i,removeParents:o,fields:"id, parents"}),!0}catch(r){return!1}})}static{this.\u0275fac=function(i){return new(i||n)(vt(wh))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var zF=(n,t)=>t.id;function w_e(n,t){if(n&1){let e=Tt();V(0,"div",3)(1,"div",5),Z(2,"\u{1F4C1}"),U(),V(3,"h2",6),Z(4,"Google Drive"),U(),V(5,"p",7),Z(6,"Connecte ton compte Google pour partager des documents avec la famille"),U(),V(7,"button",8),Fe("click",function(){Ve(e);let r=_e();return je(r.connectGoogle())}),Z(8,"Connecter Google Drive"),U()()}}function x_e(n,t){if(n&1){let e=Tt();V(0,"span",21),Z(1,"/"),U(),V(2,"button",22),Fe("click",function(){let r=Ve(e).$index,o=_e(2);return je(o.goToBreadcrumb(r))}),Z(3),U()}if(n&2){let e=t.$implicit,i=t.$index,r=_e(2);te(2),ji("text-family-purple",i===r.breadcrumb.length-1)("text-gray-500",i!==r.breadcrumb.length-1),te(),tn(" \u{1F4C1} ",e.name," ")}}function E_e(n,t){if(n&1){let e=Tt();V(0,"button",13),Fe("click",function(){Ve(e);let r=_e(2);return je(r.goUp())}),on(),V(1,"svg",14),st(2,"path",23),U(),Z(3," Retour "),U()}}function C_e(n,t){n&1&&(V(0,"div",19),st(1,"div",24),Z(2," Upload en cours... "),U())}function T_e(n,t){n&1&&(V(0,"div",20),st(1,"div",25),Z(2," Chargement... "),U())}function S_e(n,t){if(n&1){let e=Tt();V(0,"div",31),Fe("dragover",function(r){let o=Ve(e).$implicit,d=_e(4);return je(d.onDragOver(r,o))})("dragleave",function(){let r=Ve(e).$implicit,o=_e(4);return je(o.onDragLeave(r))})("drop",function(r){let o=Ve(e).$implicit,d=_e(4);return je(d.onDrop(r,o))}),V(1,"div",32),Fe("click",function(){let r=Ve(e).$implicit,o=_e(4);return je(o.openFolder(r))}),V(2,"span",33),Z(3,"\u{1F4C1}"),U(),V(4,"span",34),Z(5),U()(),V(6,"div",35)(7,"button",36),Fe("click",function(r){let o=Ve(e).$implicit;return _e(4).openRenameModal(o),je(r.stopPropagation())}),on(),V(8,"svg",14),st(9,"path",37),U()(),ai(),V(10,"button",38),Fe("click",function(r){let o=Ve(e).$implicit;return _e(4).openDeleteModal(o),je(r.stopPropagation())}),on(),V(11,"svg",14),st(12,"path",39),U()()()()}if(n&2){let e=t.$implicit,i=_e(4);ji("ring-2",i.dragOverFolder===e.id)("ring-family-purple",i.dragOverFolder===e.id)("bg-family-purple/5",i.dragOverFolder===e.id),te(5),ht(e.name)}}function D_e(n,t){if(n&1&&(V(0,"div",26)(1,"h3",28),Z(2,"Dossiers"),U(),V(3,"div",29),qt(4,S_e,13,7,"div",30,zF),U()()),n&2){let e=_e(3);te(4),Wt(e.folders)}}function I_e(n,t){if(n&1&&(V(0,"span"),Z(1),U()),n&2){let e=_e().$implicit;te(),tn("",e.uploadedByName," \xB7 ")}}function M_e(n,t){if(n&1){let e=Tt();V(0,"div",42),Fe("dragstart",function(r){let o=Ve(e).$implicit,d=_e(4);return je(d.onDragStart(r,o))})("dragend",function(){Ve(e);let r=_e(4);return je(r.onDragEnd())}),V(1,"span",43),Z(2),U(),V(3,"div",44),Fe("click",function(){let r=Ve(e).$implicit,o=_e(4);return je(o.openFile(r))}),V(4,"p",45),Z(5),U(),V(6,"p",46),tt(7,I_e,2,1,"span"),Z(8),gu(9,"date"),U()(),V(10,"div",47)(11,"button",36),Fe("click",function(){let r=Ve(e).$implicit,o=_e(4);return je(o.openRenameModal(r))}),on(),V(12,"svg",14),st(13,"path",37),U()(),ai(),V(14,"button",38),Fe("click",function(){let r=Ve(e).$implicit,o=_e(4);return je(o.openDeleteModal(r))}),on(),V(15,"svg",14),st(16,"path",39),U()()()()}if(n&2){let e=t.$implicit,i=_e(4);ji("opacity-50",(i.draggedFile==null?null:i.draggedFile.id)===e.id),te(2),ht(i.getFileIcon(e.mimeType)),te(3),ht(e.name),te(2),nt(e.uploadedByName?7:-1),te(),tn(" ",_u(9,6,e.createdTime,"d MMM yyyy","","fr")," ")}}function A_e(n,t){if(n&1&&(V(0,"div",26)(1,"h3",28),Z(2,"Fichiers"),U(),V(3,"div",40),qt(4,M_e,17,11,"div",41,zF),U()()),n&2){let e=_e(3);te(4),Wt(e.documents)}}function k_e(n,t){if(n&1){let e=Tt();V(0,"div",27)(1,"div",48),Z(2,"\u{1F4ED}"),U(),V(3,"p",49),Z(4,"Dossier vide"),U(),V(5,"p",50),Z(6,"Ajoute un fichier ou cr\xE9e un dossier !"),U(),V(7,"button",51),Fe("click",function(){Ve(e);let r=_e(3);return je(r.reconnectGoogle())}),Z(8," Probl\xE8me d'acc\xE8s ? Reconnecter Google Drive "),U()()}}function R_e(n,t){if(n&1&&(tt(0,D_e,6,0,"div",26),tt(1,A_e,6,0,"div",26),tt(2,k_e,9,0,"div",27)),n&2){let e=_e(2);nt(e.folders.length>0?0:-1),te(),nt(e.documents.length>0?1:-1),te(),nt(e.folders.length===0&&e.documents.length===0?2:-1)}}function P_e(n,t){if(n&1){let e=Tt();V(0,"div",9)(1,"button",10),Fe("click",function(){Ve(e);let r=_e();return je(r.goToRoot())}),Z(2," \u{1F3E0} FamilyApp "),U(),qt(3,x_e,4,5,null,null,zF),U(),V(5,"div",11),tt(6,E_e,4,0,"button",12),V(7,"button",13),Fe("click",function(){Ve(e);let r=_e();return je(r.openNewFolderModal())}),on(),V(8,"svg",14),st(9,"path",15),U(),Z(10," Nouveau dossier "),U(),ai(),V(11,"label",16),on(),V(12,"svg",14),st(13,"path",17),U(),Z(14," Ajouter fichier "),ai(),V(15,"input",18),Fe("change",function(r){Ve(e);let o=_e();return je(o.onFileSelected(r))}),U()()(),tt(16,C_e,3,0,"div",19),tt(17,T_e,3,0,"div",20),tt(18,R_e,3,3)}if(n&2){let e=_e();te(),ji("text-family-purple",e.breadcrumb.length===0)("text-gray-500",e.breadcrumb.length>0),te(2),Wt(e.breadcrumb),te(3),nt(e.breadcrumb.length>0?6:-1),te(10),nt(e.uploading?16:-1),te(),nt(e.loading?17:-1),te(),nt(e.loading?-1:18)}}function N_e(n,t){if(n&1){let e=Tt();V(0,"div",52),Fe("click",function(){Ve(e);let r=_e();return je(r.closeNewFolderModal())}),V(1,"div",53),Fe("click",function(r){return Ve(e),je(r.stopPropagation())}),V(2,"h3",54),Z(3,"Nouveau dossier"),U(),V(4,"input",55),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.newFolderName,r)||(o.newFolderName=r),je(r)}),Fe("keydown.enter",function(){Ve(e);let r=_e();return je(r.createFolder())}),U(),V(5,"div",56)(6,"button",57),Fe("click",function(){Ve(e);let r=_e();return je(r.closeNewFolderModal())}),Z(7," Annuler "),U(),V(8,"button",58),Fe("click",function(){Ve(e);let r=_e();return je(r.createFolder())}),Z(9," Cr\xE9er "),U()()()()}if(n&2){let e=_e();te(4),bi("ngModel",e.newFolderName),te(4),Ft("disabled",!e.newFolderName.trim())}}function O_e(n,t){if(n&1){let e=Tt();V(0,"div",52),Fe("click",function(){Ve(e);let r=_e();return je(r.closeRenameModal())}),V(1,"div",53),Fe("click",function(r){return Ve(e),je(r.stopPropagation())}),V(2,"h3",54),Z(3,"Renommer"),U(),V(4,"input",59),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.renameName,r)||(o.renameName=r),je(r)}),Fe("keydown.enter",function(){Ve(e);let r=_e();return je(r.confirmRename())}),U(),V(5,"div",56)(6,"button",57),Fe("click",function(){Ve(e);let r=_e();return je(r.closeRenameModal())}),Z(7," Annuler "),U(),V(8,"button",58),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmRename())}),Z(9," Renommer "),U()()()()}if(n&2){let e=_e();te(4),bi("ngModel",e.renameName),te(4),Ft("disabled",!e.renameName.trim())}}function F_e(n,t){n&1&&Z(0," Le dossier et tout son contenu seront supprim\xE9s. ")}function L_e(n,t){n&1&&Z(0," Ce fichier sera supprim\xE9 d\xE9finitivement. ")}function B_e(n,t){if(n&1){let e=Tt();V(0,"div",52),Fe("click",function(){Ve(e);let r=_e();return je(r.closeDeleteModal())}),V(1,"div",53),Fe("click",function(r){return Ve(e),je(r.stopPropagation())}),V(2,"div",60)(3,"div",61),on(),V(4,"svg",62),st(5,"path",39),U()(),ai(),V(6,"h3",63),Z(7,"Supprimer ?"),U(),V(8,"p",64),tt(9,F_e,1,0)(10,L_e,1,0),U(),V(11,"div",56)(12,"button",57),Fe("click",function(){Ve(e);let r=_e();return je(r.closeDeleteModal())}),Z(13," Annuler "),U(),V(14,"button",65),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmDelete())}),Z(15," Supprimer "),U()()()()()}if(n&2){let e=_e();te(9),nt(e.deleteTarget!=null&&e.deleteTarget.isFolder?9:10)}}$1(YC);var G7=(()=>{class n{constructor(e,i,r){this.googleAuth=e,this.driveService=i,this.snackBar=r,this.isConnected=!1,this.files=[],this.breadcrumb=[],this.loading=!1,this.uploading=!1,this.showNewFolderModal=!1,this.newFolderName="",this.showRenameModal=!1,this.renameTarget=null,this.renameName="",this.showDeleteModal=!1,this.deleteTarget=null,this.draggedFile=null,this.dragOverFolder=null}ngOnInit(){this.filesSub=this.driveService.filesSubject.subscribe(e=>this.files=e),this.breadcrumbSub=this.driveService.breadcrumbSubject.subscribe(e=>this.breadcrumb=e),this.connSub=this.googleAuth.connectionChanged.subscribe(e=>{this.isConnected=e,e&&this.loadFiles()}),this.isConnected=this.googleAuth.isConnected(),this.isConnected&&this.loadFiles()}loadFiles(){return ae(this,null,function*(){this.loading=!0,yield this.driveService.listFiles(),this.loading=!1})}get folders(){return this.files.filter(e=>e.isFolder)}get documents(){return this.files.filter(e=>!e.isFolder)}connectGoogle(){this.googleAuth.signIn().then(e=>{this.isConnected=e,e&&this.loadFiles()})}reconnectGoogle(){this.googleAuth.signIn().then(e=>{this.isConnected=e,e&&this.loadFiles()})}openFolder(e){return ae(this,null,function*(){this.loading=!0,yield this.driveService.navigateToFolder(e.id,e.name),this.loading=!1})}goToRoot(){return ae(this,null,function*(){this.loading=!0,yield this.driveService.navigateToBreadcrumb(-1),this.loading=!1})}goToBreadcrumb(e){return ae(this,null,function*(){this.loading=!0,yield this.driveService.navigateToBreadcrumb(e),this.loading=!1})}goUp(){return ae(this,null,function*(){this.loading=!0,yield this.driveService.navigateUp(),this.loading=!1})}openNewFolderModal(){this.newFolderName="",this.showNewFolderModal=!0}closeNewFolderModal(){this.showNewFolderModal=!1,this.newFolderName=""}createFolder(){return ae(this,null,function*(){if(!this.newFolderName.trim())return;let e=yield this.driveService.createFolder(this.newFolderName.trim());this.closeNewFolderModal(),e&&(yield this.driveService.listFiles(this.driveService.currentFolderId||void 0),this.snackBar.open("Dossier cr\xE9\xE9 !","",{duration:3e3}))})}openRenameModal(e){this.renameTarget=e,this.renameName=e.name,this.showRenameModal=!0}closeRenameModal(){this.showRenameModal=!1,this.renameTarget=null,this.renameName=""}confirmRename(){return ae(this,null,function*(){if(!this.renameTarget||!this.renameName.trim())return;let e=yield this.driveService.renameFile(this.renameTarget.id,this.renameName.trim());this.closeRenameModal(),e&&(yield this.driveService.listFiles(this.driveService.currentFolderId||void 0),this.snackBar.open("Renomm\xE9 !","",{duration:3e3}))})}onDragStart(e,i){this.draggedFile=i,e.dataTransfer&&(e.dataTransfer.effectAllowed="move")}onDragEnd(){this.draggedFile=null,this.dragOverFolder=null}onDragOver(e,i){e.preventDefault(),this.draggedFile&&!this.draggedFile.isFolder&&(this.dragOverFolder=i.id,e.dataTransfer&&(e.dataTransfer.dropEffect="move"))}onDragLeave(e){this.dragOverFolder===e.id&&(this.dragOverFolder=null)}onDrop(e,i){return ae(this,null,function*(){e.preventDefault(),this.dragOverFolder=null,this.draggedFile&&!this.draggedFile.isFolder&&(yield this.driveService.moveFile(this.draggedFile.id,i.id))&&(yield this.driveService.listFiles(this.driveService.currentFolderId||void 0),this.snackBar.open(`Fichier d\xE9plac\xE9 dans "${i.name}"`,"",{duration:3e3})),this.draggedFile=null})}openDeleteModal(e){this.deleteTarget=e,this.showDeleteModal=!0}closeDeleteModal(){this.showDeleteModal=!1,this.deleteTarget=null}confirmDelete(){return ae(this,null,function*(){this.deleteTarget&&(yield this.driveService.deleteFile(this.deleteTarget.id),this.closeDeleteModal(),yield this.driveService.listFiles(this.driveService.currentFolderId||void 0),this.snackBar.open("Supprim\xE9","",{duration:3e3}))})}onFileSelected(e){let i=e.target;i.files?.length&&(this.uploadFile(i.files[0]),i.value="")}uploadFile(e){return ae(this,null,function*(){this.uploading=!0;let i=yield this.driveService.uploadFile(e);this.uploading=!1,i&&(yield this.driveService.listFiles(this.driveService.currentFolderId||void 0),this.snackBar.open("Document ajout\xE9 !","",{duration:3e3}))})}openFile(e){window.open(e.webViewLink,"_blank")}getFileIcon(e){return e==="application/vnd.google-apps.folder"?"\u{1F4C1}":e.includes("pdf")?"\u{1F4C4}":e.includes("image")?"\u{1F5BC}\uFE0F":e.includes("spreadsheet")||e.includes("excel")?"\u{1F4CA}":e.includes("document")||e.includes("word")?"\u{1F4DD}":e.includes("presentation")||e.includes("powerpoint")?"\u{1F4FD}\uFE0F":"\u{1F4CE}"}ngOnDestroy(){this.filesSub&&this.filesSub.unsubscribe(),this.breadcrumbSub&&this.breadcrumbSub.unsubscribe(),this.connSub&&this.connSub.unsubscribe()}static{this.\u0275fac=function(i){return new(i||n)(Ze(wh),Ze(H7),Ze(Qi))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-documents"]],decls:9,vars:5,consts:[[1,"max-w-2xl","mx-auto","px-4"],[1,"text-center","mb-6"],[1,"font-display","text-2xl","font-bold","text-gradient"],[1,"card-fun","p-8","text-center"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4"],[1,"text-4xl","mb-4"],[1,"font-display","font-bold","text-gray-700","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[1,"btn-gradient","px-6",3,"click"],[1,"flex","items-center","gap-1","text-sm","mb-4","flex-wrap"],[1,"px-2","py-1","rounded","hover:bg-gray-100","transition-colors","font-medium",3,"click"],[1,"flex","gap-2","mb-4"],[1,"card-fun","px-3","py-2","text-sm","flex","items-center","gap-1.5","text-gray-500","hover:text-family-purple","transition-colors"],[1,"card-fun","px-3","py-2","text-sm","flex","items-center","gap-1.5","text-gray-500","hover:text-family-purple","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"],[1,"card-fun","px-3","py-2","text-sm","flex","items-center","gap-1.5","text-gray-500","hover:text-family-purple","transition-colors","cursor-pointer"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4v16m8-8H4"],["type","file",1,"hidden",3,"change"],[1,"card-fun","p-3","mb-4","flex","items-center","gap-2","text-sm","text-gray-500"],[1,"text-center","py-8","text-gray-400"],[1,"text-gray-300"],[1,"px-2","py-1","rounded","hover:bg-gray-100","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"w-4","h-4","border-2","border-family-purple","border-t-transparent","rounded-full","animate-spin"],[1,"w-6","h-6","border-2","border-family-purple","border-t-transparent","rounded-full","animate-spin","mx-auto","mb-2"],[1,"mb-4"],[1,"text-center","py-12","text-gray-400"],[1,"font-display","font-bold","text-xs","text-gray-400","uppercase","tracking-wider","mb-2"],[1,"grid","grid-cols-2","gap-2"],[1,"card-fun","p-3","cursor-pointer","hover:shadow-card-hover","transition-all","group","relative",3,"ring-2","ring-family-purple","bg-family-purple/5"],[1,"card-fun","p-3","cursor-pointer","hover:shadow-card-hover","transition-all","group","relative",3,"dragover","dragleave","drop"],[1,"flex","items-center","gap-2",3,"click"],[1,"text-2xl"],[1,"font-medium","text-gray-700","truncate","flex-1"],[1,"absolute","top-2","right-2","opacity-0","group-hover:opacity-100","transition-opacity","flex","gap-1"],[1,"p-1","text-gray-400","hover:text-family-purple",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"p-1","text-gray-400","hover:text-red-400",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"card-fun","overflow-hidden","divide-y","divide-gray-100"],["draggable","true",1,"flex","items-center","gap-3","px-4","py-3","hover:bg-gray-50","transition-colors","group","cursor-grab","active:cursor-grabbing",3,"opacity-50"],["draggable","true",1,"flex","items-center","gap-3","px-4","py-3","hover:bg-gray-50","transition-colors","group","cursor-grab","active:cursor-grabbing",3,"dragstart","dragend"],[1,"text-xl","flex-shrink-0"],[1,"flex-1","min-w-0","cursor-pointer",3,"click"],[1,"font-medium","text-gray-700","truncate","hover:text-family-purple","transition-colors"],[1,"text-xs","text-gray-400","truncate"],[1,"opacity-0","group-hover:opacity-100","transition-opacity","flex","gap-1"],[1,"text-4xl","mb-3"],[1,"font-medium"],[1,"text-sm","mb-4"],[1,"text-sm","text-family-purple","hover:underline",3,"click"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4",3,"click"],[1,"bg-white","rounded-2xl","shadow-xl","max-w-sm","w-full","p-6",3,"click"],[1,"text-lg","font-bold","text-gray-800","mb-4"],["placeholder","Nom du dossier","autofocus","",1,"input-fun","w-full","mb-4",3,"ngModelChange","keydown.enter","ngModel"],[1,"flex","gap-3"],[1,"flex-1","px-4","py-2.5","rounded-xl","border","border-gray-200","text-gray-600","font-medium","hover:bg-gray-50","transition-colors",3,"click"],[1,"flex-1","px-4","py-2.5","rounded-xl","bg-family-purple","text-white","font-medium","hover:bg-family-purple/90","disabled:opacity-40","transition-colors",3,"click","disabled"],["placeholder","Nouveau nom","autofocus","",1,"input-fun","w-full","mb-4",3,"ngModelChange","keydown.enter","ngModel"],[1,"text-center"],[1,"w-14","h-14","mx-auto","mb-4","rounded-full","bg-red-100","flex","items-center","justify-center"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-7","h-7","text-red-500"],[1,"text-lg","font-bold","text-gray-800","mb-2"],[1,"text-sm","text-gray-500","mb-6"],[1,"flex-1","px-4","py-2.5","rounded-xl","bg-red-500","text-white","font-medium","hover:bg-red-600","transition-colors",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"div",1)(2,"h1",2),Z(3,"\u{1F5C2}\uFE0F Documents famille"),U()(),tt(4,w_e,9,0,"div",3),tt(5,P_e,19,8),U(),tt(6,N_e,10,2,"div",4),tt(7,O_e,10,2,"div",4),tt(8,B_e,16,1,"div",4)),i&2&&(te(4),nt(r.isConnected?-1:4),te(),nt(r.isConnected?5:-1),te(),nt(r.showNewFolderModal?6:-1),te(),nt(r.showRenameModal?7:-1),te(),nt(r.showDeleteModal?8:-1))},dependencies:[Ui,Xa,Mr,to,wa,Wf],styles:[`select.input-fun[_ngcontent-%COMP%]{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%239ca3af' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px}`]})}}return n})();var V_e=(n,t)=>t.name;function j_e(n,t){if(n&1){let e=Tt();V(0,"button",16),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.selectDestination(r))}),Z(1),U()}if(n&2){let e=t.$implicit;te(),tn(" ",e.name," ")}}function z_e(n,t){if(n&1&&(V(0,"div",8),qt(1,j_e,2,1,"button",15,V_e),U()),n&2){let e=_e();te(),Wt(e.geoResults)}}var q7=(()=>{class n{constructor(e){this.dialogRef=e,this.title="",this.destinationQuery="",this.destination="",this.startDate="",this.endDate="",this.description="",this.geoResults=[]}get canSave(){return!!this.title.trim()&&!!this.destination&&!!this.startDate&&!!this.endDate}searchDestination(){if(clearTimeout(this.searchTimeout),this.destinationQuery.length<3){this.geoResults=[];return}this.searchTimeout=setTimeout(()=>ae(this,null,function*(){try{let i=yield(yield fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(this.destinationQuery)}&format=json&limit=5`)).json();this.geoResults=i.map(r=>({name:r.display_name,lat:parseFloat(r.lat),lng:parseFloat(r.lon)}))}catch(e){this.geoResults=[]}}),400)}selectDestination(e){this.destination=e.name,this.destinationQuery=e.name,this.lat=e.lat,this.lng=e.lng,this.geoResults=[]}save(){if(!this.canSave)return;let e=an.currentUser,i={title:this.title.trim(),destination:this.destination,lat:this.lat,lng:this.lng,startDate:this.startDate,endDate:this.endDate,description:this.description.trim()||void 0,createdBy:e?.uid||"",createdByName:e?.displayName||"",status:"planning"};this.dialogRef.close(i)}static{this.\u0275fac=function(i){return new(i||n)(Ze(Dl))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-add-vacation-dialog"]],decls:34,vars:7,consts:[[1,"p-6"],[1,"font-display","text-xl","font-bold","mb-4"],[1,"text-gradient"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-600","mb-1"],["placeholder","Ex: Vacances a Barcelone",1,"input-fun","w-full","text-sm",3,"ngModelChange","ngModel"],[1,"relative"],["placeholder","Rechercher un lieu...",1,"input-fun","w-full","text-sm",3,"ngModelChange","input","ngModel"],[1,"absolute","z-10","mt-1","w-full","bg-white","rounded-xl","shadow-lg","border","border-gray-100","max-h-48","overflow-y-auto"],[1,"grid","grid-cols-2","gap-3"],["type","date",1,"input-fun","w-full","text-sm",3,"ngModelChange","ngModel"],["rows","2","placeholder","Notes, idees...",1,"input-fun","w-full","text-sm","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","text-sm","font-medium",3,"click"],[1,"flex-1","btn-gradient","text-sm","disabled:opacity-50",3,"click","disabled"],[1,"w-full","text-left","px-4","py-2","text-sm","hover:bg-gray-50","transition-colors","truncate"],[1,"w-full","text-left","px-4","py-2","text-sm","hover:bg-gray-50","transition-colors","truncate",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0)(1,"h2",1)(2,"span"),Z(3,"\u{1F3D6}\uFE0F"),U(),V(4,"span",2),Z(5,"Nouveau voyage"),U()(),V(6,"div",3)(7,"div")(8,"label",4),Z(9,"Titre"),U(),V(10,"input",5),wi("ngModelChange",function(d){return Pi(r.title,d)||(r.title=d),d}),U()(),V(11,"div",6)(12,"label",4),Z(13,"Destination"),U(),V(14,"input",7),wi("ngModelChange",function(d){return Pi(r.destinationQuery,d)||(r.destinationQuery=d),d}),Fe("input",function(){return r.searchDestination()}),U(),tt(15,z_e,3,0,"div",8),U(),V(16,"div",9)(17,"div")(18,"label",4),Z(19,"Debut"),U(),V(20,"input",10),wi("ngModelChange",function(d){return Pi(r.startDate,d)||(r.startDate=d),d}),U()(),V(21,"div")(22,"label",4),Z(23,"Fin"),U(),V(24,"input",10),wi("ngModelChange",function(d){return Pi(r.endDate,d)||(r.endDate=d),d}),U()()(),V(25,"div")(26,"label",4),Z(27,"Description (optionnel)"),U(),V(28,"textarea",11),wi("ngModelChange",function(d){return Pi(r.description,d)||(r.description=d),d}),U()()(),V(29,"div",12)(30,"button",13),Fe("click",function(){return r.dialogRef.close()}),Z(31," Annuler "),U(),V(32,"button",14),Fe("click",function(){return r.save()}),Z(33," Creer "),U()()()),i&2&&(te(10),bi("ngModel",r.title),te(4),bi("ngModel",r.destinationQuery),te(),nt(r.geoResults.length?15:-1),te(5),bi("ngModel",r.startDate),te(4),bi("ngModel",r.endDate),te(4),bi("ngModel",r.description),te(4),Ft("disabled",!r.canSave))},dependencies:[Ui,Xa,Mr,to,wa,mT],encapsulation:2})}}return n})();var xh=Sx(rD());var U_e=["detailMap"],Kb=(n,t)=>t.id;function $_e(n,t){if(n&1){let e=Tt();V(0,"div",14),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.selectVacation(r))}),V(1,"div",15)(2,"span",16),Z(3,"En cours"),U(),V(4,"span",17),Z(5,"\u2708\uFE0F"),U()(),V(6,"h3",18),Z(7),U(),V(8,"p",19),Z(9),U(),V(10,"p",20),Z(11),U()()}if(n&2){let e=t.$implicit,i=_e(2);te(7),ht(e.title),te(2),Tr("",e.destination," \xB7 ",i.durationDays(e)," jours"),te(2),Tr("",i.formatDate(e.startDate)," \u2192 ",i.formatDate(e.endDate))}}function H_e(n,t){n&1&&(V(0,"h2",10),Z(1,"A venir"),U())}function G_e(n,t){if(n&1){let e=Tt();V(0,"div",21),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.selectVacation(r))}),V(1,"div",22)(2,"div")(3,"h3",18),Z(4),U(),V(5,"p",19),Z(6),U(),V(7,"p",20),Z(8),U()(),V(9,"div",23)(10,"div",24),Z(11),U(),V(12,"div",25),Z(13,"jours"),U()()()()}if(n&2){let e=t.$implicit,i=_e(2);te(4),ht(e.title),te(2),ht(e.destination),te(2),Tr("",i.formatDate(e.startDate)," \u2192 ",i.formatDate(e.endDate)),te(3),ht(i.daysUntil(e.startDate))}}function q_e(n,t){n&1&&(V(0,"h2",10),Z(1,"Souvenirs"),U())}function W_e(n,t){if(n&1){let e=Tt();V(0,"div",26),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.selectVacation(r))}),V(1,"h3",18),Z(2),U(),V(3,"p",19),Z(4),U(),V(5,"p",20),Z(6),U()()}if(n&2){let e=t.$implicit,i=_e(2);te(2),ht(e.title),te(2),Tr("",e.destination," \xB7 ",i.durationDays(e)," jours"),te(2),Tr("",i.formatDate(e.startDate)," \u2192 ",i.formatDate(e.endDate))}}function Z_e(n,t){n&1&&(V(0,"div",13)(1,"div",27),Z(2,"\u{1F334}"),U(),V(3,"p",8),Z(4,"Aucune vacance planifiee"),U(),V(5,"p",28),Z(6,"Planifie ton prochain voyage !"),U()())}function K_e(n,t){if(n&1){let e=Tt();V(0,"div",1)(1,"div",2)(2,"h1",3)(3,"span"),Z(4,"\u{1F3D6}\uFE0F"),U(),V(5,"span",4),Z(6,"Vacances"),U()()(),V(7,"button",5),Fe("click",function(){Ve(e);let r=_e();return je(r.openAdd())}),on(),V(8,"svg",6),st(9,"path",7),U(),ai(),V(10,"span",8),Z(11,"Planifier des vacances"),U()(),qt(12,$_e,12,5,"div",9,Kb),tt(14,H_e,2,0,"h2",10),qt(15,G_e,14,5,"div",11,Kb),tt(17,q_e,2,0,"h2",10),qt(18,W_e,7,5,"div",12,Kb),tt(20,Z_e,7,0,"div",13),U()}if(n&2){let e=_e();te(12),Wt(e.ongoing()),te(2),nt(e.upcoming().length?14:-1),te(),Wt(e.upcoming()),te(2),nt(e.past().length?17:-1),te(),Wt(e.past()),te(2),nt(e.vacations().length?-1:20)}}function Y_e(n,t){if(n&1&&(V(0,"div",35)(1,"div",42),Z(2),U(),V(3,"div",43),Z(4,"jours"),U()()),n&2){let e=_e(2);te(2),ht(e.daysUntil(e.selectedVacation.startDate))}}function X_e(n,t){if(n&1&&(V(0,"p",36),Z(1),U()),n&2){let e=_e(2);te(),ht(e.selectedVacation.description)}}function Q_e(n,t){if(n&1&&(V(0,"div",44)(1,"div",51)(2,"span"),Z(3),U(),V(4,"span"),Z(5),U()(),V(6,"div",52),st(7,"div",53),U()()),n&2){let e=_e(3);te(3),tn("",e.checklistProgress,"% complete"),te(2),tn("",e.checklist.length," elements"),te(2),yl("width",e.checklistProgress,"%")}}function J_e(n,t){if(n&1){let e=Tt();V(0,"div",49)(1,"input",54),Fe("change",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.toggleItem(r))}),U(),V(2,"span"),Z(3),U(),V(4,"button",55),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.confirmDeleteItem(r))}),on(),V(5,"svg",30),st(6,"path",56),U()()()}if(n&2){let e=t.$implicit;te(),Ft("checked",e.checked),te(),Ri(e.checked?"flex-1 text-sm text-gray-400 line-through":"flex-1 text-sm text-gray-700"),te(),tn(" ",e.text," ")}}function eye(n,t){n&1&&(V(0,"div",50)(1,"div",57),Z(2,"\u{1F4DD}"),U(),Z(3," Ajoute des elements a ta checklist "),U())}function tye(n,t){if(n&1){let e=Tt();tt(0,Q_e,8,4,"div",44),V(1,"div",45)(2,"input",46),wi("ngModelChange",function(r){Ve(e);let o=_e(2);return Pi(o.newItemText,r)||(o.newItemText=r),je(r)}),Fe("keyup.enter",function(){Ve(e);let r=_e(2);return je(r.addItem())}),U(),V(3,"button",47),Fe("click",function(){Ve(e);let r=_e(2);return je(r.addItem())}),Z(4,"+"),U()(),V(5,"div",48),qt(6,J_e,7,4,"div",49,Kb),U(),tt(8,eye,4,0,"div",50)}if(n&2){let e=_e(2);nt(e.checklist.length?0:-1),te(2),bi("ngModel",e.newItemText),te(4),Wt(e.checklist),te(2),nt(e.checklist.length?-1:8)}}function nye(n,t){n&1&&(V(0,"div",60),st(1,"div",64),Z(2," Upload en cours... "),U())}function iye(n,t){n&1&&(V(0,"div",61),Z(1,"\u{1F4F7} Ajouter une photo"),U())}function rye(n,t){if(n&1){let e=Tt();V(0,"div",63),st(1,"img",65),V(2,"div",66)(3,"p",67),Z(4),U()(),V(5,"button",68),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.confirmDeletePhoto(r))}),on(),V(6,"svg",69),st(7,"path",56),U()()()}if(n&2){let e=t.$implicit;te(),Ft("src",e.url,Vi),te(3),ht(e.addedByName)}}function oye(n,t){n&1&&(V(0,"div",50)(1,"div",57),Z(2,"\u{1F4F8}"),U(),Z(3," Ajoute des photos de tes vacances "),U())}function sye(n,t){if(n&1){let e=Tt();V(0,"label",58)(1,"input",59),Fe("change",function(r){Ve(e);let o=_e(2);return je(o.onPhotoSelected(r))}),U(),tt(2,nye,3,0,"div",60)(3,iye,2,0,"div",61),U(),V(4,"div",62),qt(5,rye,8,2,"div",63,Kb),U(),tt(7,oye,4,0,"div",50)}if(n&2){let e=_e(2);te(2),nt(e.uploading?2:3),te(3),Wt(e.photos),te(2),nt(!e.photos.length&&!e.uploading?7:-1)}}function aye(n,t){n&1&&st(0,"div",39,0)}function lye(n,t){if(n&1){let e=Tt();V(0,"div",1)(1,"button",29),Fe("click",function(){Ve(e);let r=_e();return je(r.backToList())}),on(),V(2,"svg",30),st(3,"path",31),U(),Z(4," Retour "),U(),ai(),V(5,"div",32)(6,"div",22)(7,"div")(8,"h1",33),Z(9),U(),V(10,"p",34),Z(11),U(),V(12,"p",20),Z(13),U()(),tt(14,Y_e,5,1,"div",35),U(),tt(15,X_e,2,1,"p",36),U(),V(16,"div",37)(17,"button",38),Fe("click",function(){Ve(e);let r=_e();return je(r.onTabChange("checklist"))}),Z(18," Checklist "),U(),V(19,"button",38),Fe("click",function(){Ve(e);let r=_e();return je(r.onTabChange("photos"))}),Z(20," Photos "),U(),V(21,"button",38),Fe("click",function(){Ve(e);let r=_e();return je(r.onTabChange("map"))}),Z(22," Carte "),U()(),tt(23,tye,9,3),tt(24,sye,8,2),tt(25,aye,2,0,"div",39),V(26,"div",40)(27,"button",41),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmDeleteVacation())}),Z(28," Supprimer ce voyage "),U()()()}if(n&2){let e=_e();te(9),ht(e.selectedVacation.title),te(2),tn("\u{1F4CD} ",e.selectedVacation.destination),te(2),Dg("",e.formatDate(e.selectedVacation.startDate)," \u2192 ",e.formatDate(e.selectedVacation.endDate)," \xB7 ",e.durationDays(e.selectedVacation)," jours"),te(),nt(e.daysUntil(e.selectedVacation.startDate)>0?14:-1),te(),nt(e.selectedVacation.description?15:-1),te(2),Ri(e.activeTab==="checklist"?"flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-pink shadow-sm":"flex-1 py-2 rounded-lg text-sm font-medium text-gray-500"),te(2),Ri(e.activeTab==="photos"?"flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-coral shadow-sm":"flex-1 py-2 rounded-lg text-sm font-medium text-gray-500"),te(2),Ri(e.activeTab==="map"?"flex-1 py-2 rounded-lg text-sm font-medium bg-white text-family-sky shadow-sm":"flex-1 py-2 rounded-lg text-sm font-medium text-gray-500"),te(2),nt(e.activeTab==="checklist"?23:-1),te(),nt(e.activeTab==="photos"?24:-1),te(),nt(e.activeTab==="map"?25:-1)}}var W7=(()=>{class n{constructor(e,i,r){this.vacService=e,this.dialog=i,this.snackBar=r,this.vacations=this.vacService.vacations,this.selectedVacation=null,this.activeTab="checklist",this.checklist=[],this.photos=[],this.newItemText="",this.uploading=!1,this.unsubChecklist=null,this.unsubPhotos=null,this.map=null,this.upcoming=xi(()=>{let o=new Date().toISOString().slice(0,10);return this.vacService.vacations().filter(d=>d.startDate>o)}),this.ongoing=xi(()=>{let o=new Date().toISOString().slice(0,10);return this.vacService.vacations().filter(d=>d.startDate<=o&&d.endDate>=o)}),this.past=xi(()=>{let o=new Date().toISOString().slice(0,10);return this.vacService.vacations().filter(d=>d.endDate<o)})}daysUntil(e){let i=new Date(e).getTime()-Date.now();return Math.max(0,Math.ceil(i/(1e3*60*60*24)))}durationDays(e){let i=new Date(e.endDate).getTime()-new Date(e.startDate).getTime();return Math.max(1,Math.ceil(i/(1e3*60*60*24)))}formatDate(e){return new Date(e).toLocaleDateString("fr-FR",{day:"numeric",month:"short",year:"numeric"})}openAdd(){this.dialog.open(q7,{width:"95vw",maxWidth:"500px",panelClass:"rounded-dialog"}).afterClosed().subscribe(i=>{i&&(this.vacService.addVacation(i),this.snackBar.open("Vacances ajout\xE9es !","",{duration:3e3}))})}selectVacation(e){this.selectedVacation=e,this.activeTab="checklist",this.cleanupDetail(),this.unsubChecklist=this.vacService.listenChecklist(e.id,i=>this.checklist=i),this.unsubPhotos=this.vacService.listenPhotos(e.id,i=>this.photos=i)}backToList(){this.selectedVacation=null,this.cleanupDetail()}cleanupDetail(){this.unsubChecklist?.(),this.unsubPhotos?.(),this.unsubChecklist=null,this.unsubPhotos=null,this.map?.remove(),this.map=null,this.checklist=[],this.photos=[]}addItem(){return ae(this,null,function*(){!this.newItemText.trim()||!this.selectedVacation||(yield this.vacService.addChecklistItem(this.selectedVacation.id,this.newItemText.trim()),this.newItemText="",this.snackBar.open("\xC9l\xE9ment ajout\xE9","",{duration:2e3}))})}toggleItem(e){return ae(this,null,function*(){this.selectedVacation&&(yield this.vacService.toggleChecklistItem(this.selectedVacation.id,e.id,!e.checked))})}confirmDeleteItem(e){this.dialog.open(Ms,{data:{customMessage:`Supprimer "${e.text}" de la checklist ?`}}).afterClosed().subscribe(i=>ae(this,null,function*(){i&&this.selectedVacation&&(yield this.vacService.deleteChecklistItem(this.selectedVacation.id,e.id),this.snackBar.open("\xC9l\xE9ment supprim\xE9","",{duration:2e3}))}))}get checklistProgress(){return this.checklist.length?Math.round(this.checklist.filter(e=>e.checked).length/this.checklist.length*100):0}onPhotoSelected(e){return ae(this,null,function*(){let i=e.target;!i.files?.length||!this.selectedVacation||(this.uploading=!0,yield this.vacService.uploadPhoto(this.selectedVacation.id,i.files[0]),this.uploading=!1,i.value="",this.snackBar.open("Photo ajout\xE9e !","",{duration:2e3}))})}confirmDeletePhoto(e){this.dialog.open(Ms,{data:{customMessage:"Supprimer cette photo ?"}}).afterClosed().subscribe(i=>ae(this,null,function*(){i&&this.selectedVacation&&(yield this.vacService.deletePhoto(this.selectedVacation.id,e),this.snackBar.open("Photo supprim\xE9e","",{duration:2e3}))}))}onTabChange(e){this.activeTab=e,e==="map"&&setTimeout(()=>this.initMap(),100)}initMap(){if(!this.mapContainer||!this.selectedVacation)return;this.map?.remove();let e=this.selectedVacation,i=[e.lng||2.35,e.lat||48.85];this.map=new xh.Map({container:this.mapContainer.nativeElement,style:"https://maps.geoapify.com/v1/styles/maptiler-3d/style.json?apiKey=793f93202015411eaa6fceaeadaad99c",center:i,zoom:e.lat?10:5}),e.lat&&e.lng&&new xh.Marker({color:"#ec4899"}).setLngLat([e.lng,e.lat]).setPopup(new xh.Popup().setHTML(`<strong>${e.destination}</strong>`)).addTo(this.map);for(let r of this.photos)if(r.lat&&r.lng){let o=document.createElement("div");o.style.cssText="width:30px;height:30px;border-radius:50%;border:2px solid #fff;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.3);cursor:pointer;";let d=document.createElement("img");d.src=r.url,d.style.cssText="width:100%;height:100%;object-fit:cover;",o.appendChild(d),new xh.Marker({element:o}).setLngLat([r.lng,r.lat]).setPopup(new xh.Popup().setHTML(`<img src="${r.url}" style="max-width:150px;border-radius:8px;"/>`)).addTo(this.map)}}confirmDeleteVacation(){this.dialog.open(Ms,{data:{customMessage:"Supprimer ce voyage et toutes ses donn\xE9es ?"}}).afterClosed().subscribe(e=>ae(this,null,function*(){e&&this.selectedVacation&&(yield this.vacService.deleteVacation(this.selectedVacation.id),this.snackBar.open("Vacances supprim\xE9es","",{duration:3e3}),this.backToList())}))}ngOnDestroy(){this.cleanupDetail()}static{this.\u0275fac=function(i){return new(i||n)(Ze(iD),Ze(ya),Ze(Qi))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-vacances"]],viewQuery:function(i,r){if(i&1&&ws(U_e,5),i&2){let o;Do(o=Io())&&(r.mapContainer=o.first)}},decls:2,vars:2,consts:[["detailMap",""],[1,"max-w-2xl","mx-auto","px-4"],[1,"text-center","mb-6"],[1,"font-display","text-2xl","font-bold"],[1,"text-gradient"],[1,"w-full","card-fun","p-4","mb-6","flex","items-center","justify-center","gap-2","text-gray-500","hover:text-family-pink","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4v16m8-8H4"],[1,"font-medium"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow","border-l-4","border-green-400"],[1,"font-display","font-bold","text-sm","text-gray-500","mb-2","mt-6"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow","opacity-80"],[1,"text-center","py-12","text-gray-400"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow","border-l-4","border-green-400",3,"click"],[1,"flex","items-center","gap-2","mb-1"],[1,"bg-green-100","text-green-700","text-xs","font-bold","px-2","py-0.5","rounded-full"],[1,"text-lg"],[1,"font-display","font-bold","text-gray-700"],[1,"text-sm","text-gray-500"],[1,"text-xs","text-gray-400","mt-1"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow",3,"click"],[1,"flex","justify-between","items-start"],[1,"text-center","flex-shrink-0","ml-4"],[1,"text-2xl","font-display","font-extrabold","text-family-pink"],[1,"text-[10px]","text-gray-400","font-medium"],[1,"card-fun","p-4","mb-4","cursor-pointer","hover:shadow-card-hover","transition-shadow","opacity-80",3,"click"],[1,"text-4xl","mb-3"],[1,"text-sm"],[1,"flex","items-center","gap-1","text-gray-500","hover:text-gray-700","mb-4","text-sm","font-medium",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"card-fun","p-5","mb-4"],[1,"font-display","text-xl","font-bold","text-gray-700"],[1,"text-sm","text-gray-500","mt-1"],[1,"text-center","flex-shrink-0"],[1,"text-sm","text-gray-600","mt-3"],[1,"flex","gap-1","mb-4","bg-gray-100","rounded-xl","p-1"],[3,"click"],[1,"w-full","h-80","rounded-xl","overflow-hidden","shadow-sm"],[1,"mt-8","mb-8","text-center"],[1,"text-sm","text-red-400","hover:text-red-600","transition-colors",3,"click"],[1,"text-3xl","font-display","font-extrabold","text-family-pink"],[1,"text-[10px]","text-gray-400"],[1,"mb-4"],[1,"flex","gap-2","mb-4"],["placeholder","Ajouter un element...",1,"flex-1","input-fun","text-sm",3,"ngModelChange","keyup.enter","ngModel"],[1,"btn-gradient","px-4","text-sm",3,"click"],[1,"card-fun","overflow-hidden","divide-y","divide-gray-100"],[1,"flex","items-center","gap-3","px-4","py-3"],[1,"text-center","py-8","text-gray-400","text-sm"],[1,"flex","justify-between","text-xs","text-gray-500","mb-1"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"bg-gradient-to-r","from-family-pink","to-family-coral","h-2","rounded-full","transition-all"],["type","checkbox",1,"w-4","h-4","rounded","border-gray-300","text-family-pink","focus:ring-family-pink",3,"change","checked"],[1,"text-gray-300","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"text-2xl","mb-2"],[1,"block","card-fun","p-4","mb-4","text-center","cursor-pointer","hover:shadow-card-hover","transition-shadow"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"flex","items-center","justify-center","gap-2","text-sm","text-gray-500"],[1,"text-gray-500","text-sm","font-medium"],[1,"grid","grid-cols-2","gap-3"],[1,"relative","group"],[1,"w-4","h-4","border-2","border-family-coral","border-t-transparent","rounded-full","animate-spin"],["loading","lazy",1,"w-full","aspect-square","object-cover","rounded-xl","shadow-sm",3,"src"],[1,"absolute","bottom-0","left-0","right-0","bg-gradient-to-t","from-black/50","to-transparent","p-2","rounded-b-xl"],[1,"text-white","text-xs","truncate"],[1,"absolute","top-2","right-2","w-6","h-6","bg-white/80","rounded-full","flex","items-center","justify-center","opacity-100","md:opacity-0","md:group-hover:opacity-100","transition-opacity","text-red-400",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-3","h-3"]],template:function(i,r){i&1&&(tt(0,K_e,21,3,"div",1),tt(1,lye,29,16,"div",1)),i&2&&(nt(r.selectedVacation?-1:0),te(),nt(r.selectedVacation?1:-1))},dependencies:[Ui,Xa,Mr,to,wa],encapsulation:2})}}return n})();var cye=["messagesContainer"],uye=["fileInput"],Z7=(n,t)=>t.id;function dye(n,t){n&1&&(V(0,"div",7)(1,"div",19),Z(2,"\u{1F4F1}"),U(),V(3,"p",20),Z(4,"Aucune publication"),U(),V(5,"p",21),Z(6,"Partage un moment avec ta famille !"),U()())}function hye(n,t){if(n&1&&(V(0,"div",22),st(1,"div",39),V(2,"span",40),Z(3),U(),st(4,"div",39),U()),n&2){let e=_e().$implicit,i=_e();te(3),ht(i.formatDate(e.timestamp))}}function fye(n,t){if(n&1&&st(0,"img",25),n&2){let e=_e().$implicit;Ft("src",e.photoURL,Vi)}}function pye(n,t){if(n&1&&(V(0,"div",26),Z(1),U()),n&2){let e=_e().$implicit;te(),tn(" ",(e.displayName||"?")[0].toUpperCase()," ")}}function mye(n,t){if(n&1){let e=Tt();V(0,"button",41),Fe("click",function(){Ve(e);let r=_e().$implicit,o=_e();return je(o.confirmDeleteMessage(r))}),on(),V(1,"svg",17),st(2,"path",42),U()()}}function gye(n,t){if(n&1&&st(0,"img",31),n&2){let e=_e().$implicit;Ft("src",e.imageURL,Vi)}}function _ye(n,t){if(n&1&&(V(0,"div",32)(1,"p",43),Z(2),U()()),n&2){let e=_e().$implicit;te(2),ht(e.text)}}function yye(n,t){if(n&1&&st(0,"img",49),n&2){let e=_e().$implicit;Ft("src",e.photoURL,Vi)}}function vye(n,t){if(n&1&&(V(0,"div",50),Z(1),U()),n&2){let e=_e().$implicit;te(),tn(" ",(e.displayName||"?")[0].toUpperCase()," ")}}function bye(n,t){if(n&1){let e=Tt();V(0,"button",57),Fe("click",function(){Ve(e);let r=_e().$implicit,o=_e(3).$implicit,d=_e();return je(d.confirmDeleteComment(o.id,r.id))}),Z(1," Supprimer "),U()}}function wye(n,t){if(n&1&&(V(0,"div",48),tt(1,yye,1,1,"img",49)(2,vye,2,1,"div",50),V(3,"div",27)(4,"div",51)(5,"p",52),Z(6),U(),V(7,"p",53),Z(8),U()(),V(9,"div",54)(10,"span",55),Z(11),U(),tt(12,bye,2,0,"button",56),U()()()),n&2){let e=t.$implicit,i=_e(4);te(),nt(e.photoURL?1:2),te(5),ht(e.displayName||"Anonyme"),te(2),ht(e.text),te(3),ht(i.formatTime(e.timestamp)),te(),nt(e.uid===i.currentUid?12:-1)}}function xye(n,t){if(n&1&&(V(0,"div",44),qt(1,wye,13,5,"div",48,Z7),U()),n&2){let e=_e(2).$implicit;te(),Wt(e._comments)}}function Eye(n,t){if(n&1){let e=Tt();V(0,"div",38),tt(1,xye,3,0,"div",44),V(2,"div",45)(3,"input",46),wi("ngModelChange",function(r){Ve(e);let o=_e().$implicit,d=_e();return Pi(d.commentInputs[o.id],r)||(d.commentInputs[o.id]=r),je(r)}),Fe("keydown.enter",function(){Ve(e);let r=_e().$implicit,o=_e();return je(o.addComment(r.id))}),U(),V(4,"button",47),Fe("click",function(){Ve(e);let r=_e().$implicit,o=_e();return je(o.addComment(r.id))}),on(),V(5,"svg",17),st(6,"path",18),U()()()()}if(n&2){let e=_e().$implicit,i=_e();te(),nt(e._comments&&e._comments.length>0?1:-1),te(2),bi("ngModel",i.commentInputs[e.id]),te(),Ft("disabled",!(i.commentInputs[e.id]!=null&&i.commentInputs[e.id].trim()))}}function Cye(n,t){if(n&1){let e=Tt();tt(0,hye,5,1,"div",22),V(1,"div",23)(2,"div",24),tt(3,fye,1,1,"img",25)(4,pye,2,1,"div",26),V(5,"div",27)(6,"p",28),Z(7),U(),V(8,"p",29),Z(9),U()(),tt(10,mye,3,0,"button",30),U(),tt(11,gye,1,1,"img",31),tt(12,_ye,3,1,"div",32),V(13,"div",33)(14,"button",34),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.toggleLike(r))}),V(15,"span",35),Z(16),U(),V(17,"span",36),Z(18),U()(),V(19,"button",37),Fe("click",function(){let r=Ve(e).$implicit,o=_e();return je(o.toggleComments(r.id))}),V(20,"span",35),Z(21,"\u{1F4AC}"),U(),V(22,"span",36),Z(23),U()()(),tt(24,Eye,7,3,"div",38),U()}if(n&2){let e=t.$implicit,i=t.$index,r=_e();nt(r.showDateSeparator(i)?0:-1),te(3),nt(e.photoURL?3:4),te(4),ht(e.displayName||"Anonyme"),te(2),ht(r.formatTime(e.timestamp)),te(),nt(r.isMine(e)?10:-1),te(),nt(e.imageURL?11:-1),te(),nt(e.text?12:-1),te(2),Ri(e._liked?"text-family-pink":"text-gray-400 hover:text-family-pink"),te(2),ht(e._liked?"\u2764\uFE0F":"\u{1F90D}"),te(2),ht(e._likeCount||0),te(5),ht(e._commentCount||0),te(),nt(r.isCommentsExpanded(e.id)?24:-1)}}function Tye(n,t){if(n&1){let e=Tt();V(0,"div",9),st(1,"img",58),V(2,"button",59),Fe("click",function(){Ve(e);let r=_e();return je(r.removeImage())}),on(),V(3,"svg",60),st(4,"path",61),U()()()}if(n&2){let e=_e();te(),Ft("src",e.imagePreview,Vi)}}var K7=(()=>{class n{constructor(e,i,r){this.chatService=e,this.snackBar=i,this.dialog=r,this.messages=[],this.newMessage="",this.currentUid="",this.selectedImage=null,this.imagePreview=null,this.unsubscribe=null,this.shouldScroll=!0,this.expandedComments=new Set,this.commentInputs={}}ngOnInit(){this.currentUid=an.currentUser?.uid||"",this.chatService.markAsRead(),this.unsubscribe=this.chatService.listenMessages(e=>{this.messages=e,this.shouldScroll=!0,this.chatService.markAsRead()})}ngAfterViewChecked(){this.shouldScroll&&(this.scrollToTop(),this.shouldScroll=!1)}scrollToTop(){let e=this.messagesContainer?.nativeElement;e&&(e.scrollTop=0)}isMine(e){return e.uid===this.currentUid}formatTime(e){let i=new Date(e),r=new Date,o=new Date(r);o.setDate(o.getDate()-1);let d=i.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});return i.toDateString()===r.toDateString()?`Aujourd'hui \xE0 ${d}`:i.toDateString()===o.toDateString()?`Hier \xE0 ${d}`:`${i.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})} \xE0 ${d}`}formatDate(e){let i=new Date(e),r=new Date,o=new Date(r);return o.setDate(o.getDate()-1),i.toDateString()===r.toDateString()?"Aujourd'hui":i.toDateString()===o.toDateString()?"Hier":i.toLocaleDateString("fr-FR",{day:"numeric",month:"long"})}showDateSeparator(e){if(e===0)return!0;let i=new Date(this.messages[e-1].timestamp).toDateString(),r=new Date(this.messages[e].timestamp).toDateString();return i!==r}openFilePicker(){this.fileInput.nativeElement.click()}onFileSelected(e){let i=e.target;if(i.files&&i.files[0]){this.selectedImage=i.files[0];let r=new FileReader;r.onload=o=>{this.imagePreview=o.target?.result},r.readAsDataURL(this.selectedImage)}}removeImage(){this.selectedImage=null,this.imagePreview=null,this.fileInput&&(this.fileInput.nativeElement.value="")}send(){return ae(this,null,function*(){if(!this.newMessage.trim()&&!this.selectedImage)return;let e=this.newMessage,i=this.selectedImage;this.newMessage="",this.removeImage(),yield this.chatService.sendMessage(e,i||void 0),this.snackBar.open("Publication envoy\xE9e !","",{duration:2e3})})}toggleLike(e){return ae(this,null,function*(){yield this.chatService.toggleLike(e.id)})}confirmDeleteMessage(e){e.uid===this.currentUid&&this.dialog.open(Ms,{data:{customMessage:"Supprimer cette publication ?"}}).afterClosed().subscribe(i=>ae(this,null,function*(){i&&(yield this.chatService.deleteMessage(e),this.snackBar.open("Publication supprim\xE9e","",{duration:2e3}))}))}toggleComments(e){this.expandedComments.has(e)?this.expandedComments.delete(e):this.expandedComments.add(e)}isCommentsExpanded(e){return this.expandedComments.has(e)}addComment(e){return ae(this,null,function*(){let i=this.commentInputs[e]?.trim();i&&(this.commentInputs[e]="",yield this.chatService.addComment(e,i),this.snackBar.open("Commentaire ajout\xE9","",{duration:2e3}))})}confirmDeleteComment(e,i){this.dialog.open(Ms,{data:{customMessage:"Supprimer ce commentaire ?"}}).afterClosed().subscribe(r=>ae(this,null,function*(){r&&(yield this.chatService.deleteComment(e,i),this.snackBar.open("Commentaire supprim\xE9","",{duration:2e3}))}))}ngOnDestroy(){this.chatService.leaveChatPage(),this.unsubscribe?.()}static{this.\u0275fac=function(i){return new(i||n)(Ze(ph),Ze(Qi),Ze(ya))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-chat"]],viewQuery:function(i,r){if(i&1&&ws(cye,5)(uye,5),i&2){let o;Do(o=Io())&&(r.messagesContainer=o.first),Do(o=Io())&&(r.fileInput=o.first)}},hostAttrs:[2,"display","flex","flex-direction","column","height","100%","overflow","hidden"],decls:24,vars:4,consts:[["messagesContainer",""],["fileInput",""],[1,"flex","flex-col","flex-1","min-h-0","max-w-2xl","mx-auto","w-full"],[1,"text-center","py-3","flex-shrink-0"],[1,"font-display","text-2xl","font-bold"],[1,"text-gradient"],[1,"flex-1","overflow-y-auto","px-4","space-y-4","pb-4"],[1,"text-center","py-12","text-gray-400"],[1,"flex-shrink-0","px-4","py-3","bg-white/80","backdrop-blur-sm","border-t","border-gray-100"],[1,"relative","mb-3","inline-block"],[1,"flex","gap-2","items-end"],["type","file","accept","image/*",1,"hidden",3,"change"],[1,"p-2.5","text-gray-400","hover:text-family-pink","transition-colors","flex-shrink-0",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"],["placeholder","Quoi de neuf ?","rows","1",1,"flex-1","input-fun","text-sm","resize-none","max-h-24","overflow-y-auto",3,"ngModelChange","keydown.enter","ngModel"],[1,"btn-gradient","px-4","py-2.5","rounded-xl","text-sm","disabled:opacity-40","flex-shrink-0",3,"click","disabled"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"],[1,"text-4xl","mb-3"],[1,"font-medium"],[1,"text-sm"],[1,"flex","items-center","gap-3","py-2"],[1,"card-fun","overflow-hidden"],[1,"flex","items-center","gap-3","p-3"],["referrerpolicy","no-referrer",1,"w-10","h-10","rounded-full","object-cover","border-2","border-gray-100",3,"src"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-family-pink","to-family-coral","flex","items-center","justify-center","text-white","font-bold"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-gray-700","truncate"],[1,"text-xs","text-gray-400"],[1,"text-gray-300","hover:text-red-400","transition-colors","p-1"],["loading","lazy",1,"w-full","object-contain","max-h-96","bg-gray-50",3,"src"],[1,"px-4","py-3"],[1,"flex","items-center","gap-4","px-4","py-3","border-t","border-gray-50"],[1,"flex","items-center","gap-1.5","transition-colors",3,"click"],[1,"text-lg"],[1,"text-sm","font-medium"],[1,"flex","items-center","gap-1.5","text-gray-400","hover:text-family-sky","transition-colors",3,"click"],[1,"px-4","pb-4","border-t","border-gray-50"],[1,"flex-1","h-px","bg-gray-200"],[1,"text-xs","text-gray-400","font-medium"],[1,"text-gray-300","hover:text-red-400","transition-colors","p-1",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"text-gray-700","whitespace-pre-wrap","break-words"],[1,"space-y-3","pt-3"],[1,"flex","gap-2","mt-3","pt-3","border-t","border-gray-50"],["placeholder","\xC9crire un commentaire...",1,"flex-1","text-sm","px-3","py-2","rounded-full","bg-gray-50","border-0","focus:ring-2","focus:ring-family-pink/30","outline-none",3,"ngModelChange","keydown.enter","ngModel"],[1,"px-3","py-2","text-family-pink","hover:text-family-coral","disabled:opacity-40","transition-colors",3,"click","disabled"],[1,"flex","gap-2"],["referrerpolicy","no-referrer",1,"w-7","h-7","rounded-full","object-cover","flex-shrink-0",3,"src"],[1,"w-7","h-7","rounded-full","bg-gradient-to-br","from-family-sky","to-family-purple","flex","items-center","justify-center","text-white","text-xs","font-bold","flex-shrink-0"],[1,"bg-gray-50","rounded-xl","px-3","py-2"],[1,"text-xs","font-semibold","text-gray-700"],[1,"text-sm","text-gray-600","break-words"],[1,"flex","items-center","gap-2","mt-1","px-1"],[1,"text-[10px]","text-gray-400"],[1,"text-[10px]","text-gray-400","hover:text-red-400"],[1,"text-[10px]","text-gray-400","hover:text-red-400",3,"click"],[1,"h-20","rounded-lg","object-cover",3,"src"],[1,"absolute","-top-2","-right-2","w-6","h-6","bg-red-500","text-white","rounded-full","flex","items-center","justify-center","shadow-md","hover:bg-red-600","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"]],template:function(i,r){if(i&1){let o=Tt();V(0,"div",2)(1,"div",3)(2,"h1",4)(3,"span"),Z(4,"\u{1F4F1}"),U(),V(5,"span",5),Z(6,"Fil d'actu"),U()()(),V(7,"div",6,0),tt(9,dye,7,0,"div",7),qt(10,Cye,25,13,null,null,Z7),U(),V(12,"div",8),tt(13,Tye,5,1,"div",9),V(14,"div",10)(15,"input",11,1),Fe("change",function(m){return Ve(o),je(r.onFileSelected(m))}),U(),V(17,"button",12),Fe("click",function(){return Ve(o),je(r.openFilePicker())}),on(),V(18,"svg",13),st(19,"path",14),U()(),ai(),V(20,"textarea",15),wi("ngModelChange",function(m){return Ve(o),Pi(r.newMessage,m)||(r.newMessage=m),je(m)}),Fe("keydown.enter",function(m){return Ve(o),m.preventDefault(),je(r.send())}),U(),V(21,"button",16),Fe("click",function(){return Ve(o),je(r.send())}),on(),V(22,"svg",17),st(23,"path",18),U()()()()()}i&2&&(te(9),nt(r.messages.length?-1:9),te(),Wt(r.messages),te(3),nt(r.imagePreview?13:-1),te(7),bi("ngModel",r.newMessage),te(),Ft("disabled",!r.newMessage.trim()&&!r.selectedImage))},dependencies:[Ui,Xa,Mr,to,wa],styles:["[_nghost-%COMP%]{margin-bottom:-5rem}@media(min-width:768px){[_nghost-%COMP%]{margin-bottom:0}}"]})}}return n})();var Y7=["\u{1F35D}","\u{1F355}","\u{1F354}","\u{1F957}","\u{1F372}","\u{1F35C}","\u{1F958}","\u{1F370}","\u{1F967}","\u{1F373}","\u{1F96A}","\u{1F32E}"];var X7=(()=>{class n{constructor(e){this.shoppingService=e,this._recipes=Zn([]),this.recipes=this._recipes.asReadonly(),this.initListener()}initListener(){rs(zt(Ut,"/recipes"),e=>{let i=e.val();if(i){let r=Object.keys(i).map(o=>({id:o,name:i[o].name||"",icon:i[o].icon||"\u{1F37D}\uFE0F",portions:i[o].portions||4,ingredients:i[o].ingredients||[],createdBy:i[o].createdBy||"",createdByName:i[o].createdByName||"",createdAt:i[o].createdAt||""}));this._recipes.set(r)}else this._recipes.set([])})}createRecipe(e){return ae(this,null,function*(){let i=an.currentUser,r="";i&&(r=((yield Ds(zt(Ut,`/users/${i.uid}`))).val()||{}).displayName||i.displayName||"");let d=ba(zt(Ut,"/recipes")).key;return yield is(zt(Ut,`/recipes/${d}`),Mt(Be({},e),{createdBy:i?.uid||"",createdByName:r,createdAt:new Date().toISOString()})),d})}updateRecipe(e,i){return ae(this,null,function*(){yield is(zt(Ut,`/recipes/${e}`),i)})}deleteRecipe(e){return ae(this,null,function*(){yield Ss(zt(Ut,`/recipes/${e}`))})}getRecipe(e){return this._recipes().find(i=>i.id===e)}addToShoppingList(e,i,r=1){return ae(this,null,function*(){let o=an.currentUser,d="",m="";if(o){let T=(yield Ds(zt(Ut,`/users/${o.uid}`))).val()||{};d=T.displayName||o.displayName||"",m=T.photoURL||o.photoURL||""}this.shoppingService.setActiveList(i);for(let b of e.ingredients){let T=this.adjustQuantity(b.quantity,r);this.shoppingService.addItem({nom:b.nom,category:b.category,quantity:T,checked:!1,addedBy:o?.uid||"",addedByName:d,addedByPhoto:m,addedAt:new Date().toISOString()})}})}adjustQuantity(e,i){let r=e.match(/^(\d+(?:[.,]\d+)?)\s*(.*)$/);if(r){let o=parseFloat(r[1].replace(",",".")),d=r[2],m=Math.round(o*i*10)/10;return d?`${m} ${d}`:`${m}`}return e}static{this.\u0275fac=function(i){return new(i||n)(vt(P_))}}static{this.\u0275prov=ze({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Q7=(n,t)=>t.id,Dye=(n,t)=>t.key;function Iye(n,t){if(n&1&&(V(0,"p",17),Z(1),U()),n&2){let e=_e().$implicit;te(),tn("par ",e.createdByName)}}function Mye(n,t){if(n&1){let e=Tt();V(0,"div",11)(1,"div",12)(2,"div",13),Z(3),U(),V(4,"div",14)(5,"h3",15),Z(6),U(),V(7,"p",16),Z(8),U(),tt(9,Iye,2,1,"p",17),U(),V(10,"div",18)(11,"button",19),Fe("click",function(r){let o=Ve(e).$implicit;return _e(3).openAddToListModal(o),je(r.stopPropagation())}),on(),V(12,"svg",6),st(13,"path",20),U()(),ai(),V(14,"button",21),Fe("click",function(){let r=Ve(e).$implicit,o=_e(3);return je(o.openDetail(r))}),on(),V(15,"svg",6),st(16,"path",22)(17,"path",23),U()()()()()}if(n&2){let e=t.$implicit;te(3),ht(e.icon),te(3),ht(e.name),te(2),M1(" ",e.ingredients.length," ingr\xE9dient",e.ingredients.length>1?"s":""," \u2022 ",e.portions," portion",e.portions>1?"s":""," "),te(),nt(e.createdByName?9:-1)}}function Aye(n,t){if(n&1&&(V(0,"div",9),qt(1,Mye,18,7,"div",11,Q7),U()),n&2){let e=_e(2);te(),Wt(e.recipes())}}function kye(n,t){n&1&&(V(0,"div",10)(1,"div",24),Z(2,"\u{1F468}\u200D\u{1F373}"),U(),V(3,"p",8),Z(4,"Aucune recette"),U(),V(5,"p",25),Z(6,"Cr\xE9e ta premi\xE8re recette familiale !"),U()())}function Rye(n,t){if(n&1){let e=Tt();V(0,"div",2)(1,"h1",3),Z(2,"\u{1F37D}\uFE0F Recettes"),U(),V(3,"p",4),Z(4),U()(),V(5,"button",5),Fe("click",function(){Ve(e);let r=_e();return je(r.openCreateForm())}),on(),V(6,"svg",6),st(7,"path",7),U(),ai(),V(8,"span",8),Z(9,"Cr\xE9er une recette"),U()(),tt(10,Aye,3,0,"div",9)(11,kye,7,0,"div",10)}if(n&2){let e=_e();te(4),Tr("",e.recipes().length," recette",e.recipes().length>1?"s":""),te(6),nt(e.recipes().length>0?10:11)}}function Pye(n,t){if(n&1&&(V(0,"div",42)(1,"span",43),Z(2),U(),V(3,"span",44),Z(4),U(),V(5,"span",16),Z(6),U()()),n&2){let e=t.$implicit,i=_e(2);te(2),ht(i.getCategoryIcon(e.category)),te(2),ht(e.nom),te(2),ht(e.quantity)}}function Nye(n,t){if(n&1){let e=Tt();V(0,"div",26)(1,"button",27),Fe("click",function(){Ve(e);let r=_e();return je(r.backToList())}),on(),V(2,"svg",6),st(3,"path",28),U(),Z(4," Retour "),U()(),ai(),V(5,"div",2)(6,"div",29),Z(7),U(),V(8,"h1",30),Z(9),U(),V(10,"p",31),Z(11),U()(),V(12,"div",32)(13,"button",33),Fe("click",function(){Ve(e);let r=_e();return je(r.openAddToListModal(r.selectedRecipe))}),on(),V(14,"svg",34),st(15,"path",20),U(),Z(16," Ajouter aux courses "),U(),ai(),V(17,"button",35),Fe("click",function(){Ve(e);let r=_e();return je(r.openEditForm(r.selectedRecipe))}),on(),V(18,"svg",34),st(19,"path",36),U(),Z(20," Modifier "),U(),ai(),V(21,"button",37),Fe("click",function(){Ve(e);let r=_e();return je(r.openDeleteModal(r.selectedRecipe))}),on(),V(22,"svg",34),st(23,"path",38),U()()(),ai(),V(24,"div",39)(25,"h2",40),Z(26,"Ingr\xE9dients"),U(),V(27,"div",41),qt(28,Pye,7,3,"div",42,Hf),U()()}if(n&2){let e=_e();te(7),ht(e.selectedRecipe.icon),te(2),ht(e.selectedRecipe.name),te(2),Tr("",e.selectedRecipe.portions," portion",e.selectedRecipe.portions>1?"s":""),te(17),Wt(e.selectedRecipe.ingredients)}}function Oye(n,t){if(n&1){let e=Tt();V(0,"button",64),Fe("click",function(){let r=Ve(e).$implicit,o=_e(2);return je(o.recipeIcon=r)}),Z(1),U()}if(n&2){let e=t.$implicit,i=_e(2);Ri(i.recipeIcon===e?"w-10 h-10 rounded-xl bg-family-purple/10 text-xl flex items-center justify-center ring-2 ring-family-purple":"w-10 h-10 rounded-xl bg-gray-100 text-xl flex items-center justify-center hover:bg-gray-200 transition-colors"),te(),tn(" ",e," ")}}function Fye(n,t){if(n&1){let e=Tt();V(0,"div",42)(1,"span",43),Z(2),U(),V(3,"span",44),Z(4),U(),V(5,"span",16),Z(6),U(),V(7,"button",65),Fe("click",function(){let r=Ve(e).$index,o=_e(3);return je(o.removeIngredient(r))}),on(),V(8,"svg",34),st(9,"path",66),U()()()}if(n&2){let e=t.$implicit,i=_e(3);te(2),ht(i.getCategoryIcon(e.category)),te(2),ht(e.nom),te(2),ht(e.quantity)}}function Lye(n,t){if(n&1&&(V(0,"div",55),qt(1,Fye,10,3,"div",42,Hf),U()),n&2){let e=_e(2);te(),Wt(e.recipeIngredients)}}function Bye(n,t){if(n&1&&(V(0,"option",61),Z(1),U()),n&2){let e=t.$implicit;Ft("value",e.key),te(),Tr("",e.icon," ",e.label)}}function Vye(n,t){if(n&1){let e=Tt();V(0,"div",26)(1,"button",27),Fe("click",function(){Ve(e);let r=_e();return je(r.backToList())}),on(),V(2,"svg",6),st(3,"path",28),U(),Z(4," Annuler "),U()(),ai(),V(5,"div",2)(6,"h1",3),Z(7),U()(),V(8,"div",45)(9,"div",46)(10,"input",47),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.recipeName,r)||(o.recipeName=r),je(r)}),U(),V(11,"div",48)(12,"div",49)(13,"label",50),Z(14,"Ic\xF4ne"),U(),V(15,"div",51),qt(16,Oye,2,3,"button",52,So),U()(),V(18,"div",53)(19,"label",50),Z(20,"Portions"),U(),V(21,"input",54),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.recipePortions,r)||(o.recipePortions=r),je(r)}),U()()()(),V(22,"div",39)(23,"h2",40),Z(24,"Ingr\xE9dients"),U(),tt(25,Lye,3,0,"div",55),V(26,"div",56)(27,"input",57),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.newIngredientName,r)||(o.newIngredientName=r),je(r)}),Fe("keyup.enter",function(){Ve(e);let r=_e();return je(r.addIngredient())}),U(),V(28,"div",58)(29,"input",59),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.newIngredientQuantity,r)||(o.newIngredientQuantity=r),je(r)}),U(),V(30,"select",60),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.newIngredientCategory,r)||(o.newIngredientCategory=r),je(r)}),qt(31,Bye,2,3,"option",61,Dye),U()(),V(33,"button",62),Fe("click",function(){Ve(e);let r=_e();return je(r.addIngredient())}),Z(34," + Ajouter ingr\xE9dient "),U()()(),V(35,"button",63),Fe("click",function(){Ve(e);let r=_e();return je(r.saveRecipe())}),Z(36),U()()}if(n&2){let e=_e();te(7),tn(" ",e.editMode==="create"?"Nouvelle recette":"Modifier la recette"," "),te(3),bi("ngModel",e.recipeName),te(6),Wt(e.recipeIcons),te(5),bi("ngModel",e.recipePortions),te(4),nt(e.recipeIngredients.length>0?25:-1),te(2),bi("ngModel",e.newIngredientName),te(2),bi("ngModel",e.newIngredientQuantity),te(),bi("ngModel",e.newIngredientCategory),te(),Wt(e.categories),te(2),Ft("disabled",!e.newIngredientName.trim()),te(2),Ft("disabled",!e.recipeName.trim()||e.recipeIngredients.length===0),te(),tn(" ",e.editMode==="create"?"Cr\xE9er la recette":"Enregistrer"," ")}}function jye(n,t){if(n&1&&(V(0,"option",61),Z(1),U()),n&2){let e=t.$implicit;Ft("value",e.id),te(),Tr("",e.icon," ",e.name)}}function zye(n,t){if(n&1){let e=Tt();V(0,"div",1)(1,"div",67)(2,"div",68)(3,"h2",69),Z(4,"Ajouter aux courses"),U(),V(5,"div",70)(6,"div")(7,"label",50),Z(8,"Liste de courses"),U(),V(9,"select",71),wi("ngModelChange",function(r){Ve(e);let o=_e();return Pi(o.selectedListId,r)||(o.selectedListId=r),je(r)}),qt(10,jye,2,3,"option",61,Q7),U()(),V(12,"div")(13,"label",50),Z(14),U(),V(15,"div",72)(16,"button",73),Fe("click",function(){Ve(e);let r=_e();return je(r.decreaseMultiplier())}),on(),V(17,"svg",6),st(18,"path",74),U()(),ai(),V(19,"div",75)(20,"span",76),Z(21),U(),V(22,"p",77),Z(23),U()(),V(24,"button",73),Fe("click",function(){Ve(e);let r=_e();return je(r.increaseMultiplier())}),on(),V(25,"svg",6),st(26,"path",7),U()()()(),ai(),V(27,"p",78),Z(28),U()(),V(29,"div",79)(30,"button",80),Fe("click",function(){Ve(e);let r=_e();return je(r.closeAddToListModal())}),Z(31," Annuler "),U(),V(32,"button",81),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmAddToList())}),Z(33," Ajouter "),U()()()()()}if(n&2){let e=_e();te(9),bi("ngModel",e.selectedListId),te(),Wt(e.shoppingLists()),te(4),tn(" Portions (recette: ",e.selectedRecipe.portions,") "),te(7),tn("x",e.portionMultiplier),te(2),tn("",e.selectedRecipe.portions*e.portionMultiplier," portions"),te(5),Tr(" ",e.selectedRecipe.ingredients.length," ingr\xE9dient",e.selectedRecipe.ingredients.length>1?"s":""," seront ajout\xE9s "),te(4),Ft("disabled",!e.selectedListId)}}function Uye(n,t){if(n&1){let e=Tt();V(0,"div",1)(1,"div",67)(2,"div",68)(3,"div",82)(4,"div",83),Z(5,"\u{1F5D1}\uFE0F"),U(),V(6,"h2",84),Z(7,"Supprimer la recette ?"),U(),V(8,"p",85),Z(9),U()(),V(10,"div",58)(11,"button",80),Fe("click",function(){Ve(e);let r=_e();return je(r.closeDeleteModal())}),Z(12," Annuler "),U(),V(13,"button",86),Fe("click",function(){Ve(e);let r=_e();return je(r.confirmDelete())}),Z(14," Supprimer "),U()()()()()}if(n&2){let e=_e();te(9),Tr(' "',e.recipeToDelete.icon," ",e.recipeToDelete.name,'" sera supprim\xE9e d\xE9finitivement. ')}}var J7=(()=>{class n{constructor(e,i,r){this.recipesService=e,this.shoppingService=i,this.snackBar=r,this.recipeIcons=Y7,this.categories=dD,this.recipes=this.recipesService.recipes,this.shoppingLists=this.shoppingService.lists,this.view="list",this.selectedRecipe=null,this.editMode="create",this.recipeName="",this.recipeIcon="\u{1F35D}",this.recipePortions=4,this.recipeIngredients=[],this.newIngredientName="",this.newIngredientQuantity="",this.newIngredientCategory="autre",this.showAddToListModal=!1,this.selectedListId="",this.portionMultiplier=1,this.showDeleteModal=!1,this.recipeToDelete=null}openCreateForm(){this.editMode="create",this.recipeName="",this.recipeIcon="\u{1F35D}",this.recipePortions=4,this.recipeIngredients=[],this.view="edit"}openEditForm(e){this.editMode="edit",this.selectedRecipe=e,this.recipeName=e.name,this.recipeIcon=e.icon,this.recipePortions=e.portions,this.recipeIngredients=[...e.ingredients],this.view="edit"}openDetail(e){this.selectedRecipe=e,this.view="detail"}backToList(){this.view="list",this.selectedRecipe=null}addIngredient(){let e=this.newIngredientName.trim();e&&(this.recipeIngredients.push({nom:e,quantity:this.newIngredientQuantity.trim()||"1",category:this.newIngredientCategory}),this.newIngredientName="",this.newIngredientQuantity="",this.newIngredientCategory="autre")}removeIngredient(e){this.recipeIngredients.splice(e,1)}saveRecipe(){return ae(this,null,function*(){let e=this.recipeName.trim();!e||this.recipeIngredients.length===0||(this.editMode==="create"?(yield this.recipesService.createRecipe({name:e,icon:this.recipeIcon,portions:this.recipePortions,ingredients:this.recipeIngredients}),this.snackBar.open("Recette cr\xE9\xE9e !","",{duration:3e3})):this.selectedRecipe&&(yield this.recipesService.updateRecipe(this.selectedRecipe.id,{name:e,icon:this.recipeIcon,portions:this.recipePortions,ingredients:this.recipeIngredients}),this.snackBar.open("Recette mise \xE0 jour !","",{duration:3e3})),this.backToList())})}openDeleteModal(e){this.recipeToDelete=e,this.showDeleteModal=!0}closeDeleteModal(){this.showDeleteModal=!1,this.recipeToDelete=null}confirmDelete(){return ae(this,null,function*(){this.recipeToDelete&&(yield this.recipesService.deleteRecipe(this.recipeToDelete.id),this.closeDeleteModal(),this.snackBar.open("Recette supprim\xE9e","",{duration:3e3}),this.view!=="list"&&this.backToList())})}openAddToListModal(e){this.selectedRecipe=e,this.portionMultiplier=1;let i=this.shoppingLists();this.selectedListId=i.length>0?i[0].id:"",this.showAddToListModal=!0}closeAddToListModal(){this.showAddToListModal=!1}decreaseMultiplier(){this.portionMultiplier>.5&&(this.portionMultiplier-=.5)}increaseMultiplier(){this.portionMultiplier+=.5}confirmAddToList(){return ae(this,null,function*(){if(!this.selectedRecipe||!this.selectedListId)return;yield this.recipesService.addToShoppingList(this.selectedRecipe,this.selectedListId,this.portionMultiplier);let e=this.shoppingLists().find(i=>i.id===this.selectedListId);this.snackBar.open(`${this.selectedRecipe.ingredients.length} ingr\xE9dients ajout\xE9s \xE0 "${e?.name}"`,"",{duration:3e3}),this.closeAddToListModal()})}getCategoryIcon(e){return this.categories.find(i=>i.key===e)?.icon||"\u{1F4E6}"}static{this.\u0275fac=function(i){return new(i||n)(Ze(X7),Ze(P_),Ze(Qi))}}static{this.\u0275cmp=Pt({type:n,selectors:[["app-recipes"]],decls:6,vars:5,consts:[[1,"max-w-2xl","mx-auto","px-4"],[1,"fixed","inset-0","bg-black/50","flex","items-center","justify-center","z-50","p-4"],[1,"text-center","mb-6"],[1,"font-display","text-2xl","font-bold","text-gradient"],[1,"text-sm","text-gray-400","mt-1"],[1,"w-full","card-fun","p-4","mb-6","flex","items-center","justify-center","gap-2","text-gray-500","hover:text-family-purple","transition-colors",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M12 4v16m8-8H4"],[1,"font-medium"],[1,"space-y-3"],[1,"text-center","py-12","text-gray-400"],[1,"card-fun","p-4","hover:shadow-md","transition-shadow"],[1,"flex","items-start","gap-3"],[1,"text-3xl"],[1,"flex-1","min-w-0"],[1,"font-display","font-bold","text-gray-800"],[1,"text-sm","text-gray-500"],[1,"text-xs","text-gray-400","mt-1"],[1,"flex","items-center","gap-1"],["title","Ajouter aux courses",1,"p-2","rounded-lg","text-gray-400","hover:text-family-green","hover:bg-family-green/10","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"],["title","Voir d\xE9tails",1,"p-2","rounded-lg","text-gray-400","hover:text-family-purple","hover:bg-family-purple/10","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"text-4xl","mb-3"],[1,"text-sm"],[1,"mb-4"],[1,"flex","items-center","gap-1","text-gray-500","hover:text-gray-700","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M15 19l-7-7 7-7"],[1,"text-5xl","mb-2"],[1,"font-display","text-2xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500","mt-1"],[1,"flex","justify-center","gap-3","mb-6"],[1,"btn-gradient","text-sm","px-4","py-2","flex","items-center","gap-2",3,"click"],["fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"w-4","h-4"],[1,"px-4","py-2","rounded-xl","border","border-gray-200","text-gray-600","hover:bg-gray-50","transition-colors","text-sm","font-medium","flex","items-center","gap-2",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"],[1,"px-4","py-2","rounded-xl","border","border-red-200","text-red-500","hover:bg-red-50","transition-colors","text-sm","font-medium",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"],[1,"card-fun","p-4"],[1,"font-display","font-bold","text-gray-700","mb-3"],[1,"divide-y","divide-gray-100"],[1,"flex","items-center","gap-3","py-2"],[1,"text-lg"],[1,"flex-1","text-gray-700"],[1,"space-y-6"],[1,"card-fun","p-4","space-y-4"],["placeholder","Nom de la recette...",1,"input-fun","w-full","text-lg","font-medium",3,"ngModelChange","ngModel"],[1,"flex","gap-4"],[1,"flex-1"],[1,"text-sm","text-gray-500","mb-2","block"],[1,"flex","flex-wrap","gap-2"],[3,"class"],[1,"w-32"],["type","number","min","1","max","20",1,"input-fun","w-full","text-center",3,"ngModelChange","ngModel"],[1,"divide-y","divide-gray-100","mb-4"],[1,"bg-gray-50","rounded-xl","p-3","space-y-3"],["placeholder","Nom de l'ingr\xE9dient...",1,"input-fun","w-full",3,"ngModelChange","keyup.enter","ngModel"],[1,"flex","gap-3"],["placeholder","Quantit\xE9 (ex: 200g, 2...)",1,"input-fun","flex-1",3,"ngModelChange","ngModel"],[1,"input-fun","flex-1",3,"ngModelChange","ngModel"],[3,"value"],[1,"w-full","py-2","rounded-xl","border-2","border-dashed","border-gray-300","text-gray-500","font-medium","hover:border-family-green","hover:text-family-green","transition-colors","disabled:opacity-50",3,"click","disabled"],[1,"w-full","btn-gradient","py-3","font-medium","disabled:opacity-50",3,"click","disabled"],[3,"click"],[1,"text-gray-300","hover:text-red-400","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M6 18L18 6M6 6l12 12"],[1,"bg-white","rounded-2xl","shadow-xl","max-w-sm","w-full"],[1,"p-6"],[1,"font-display","text-xl","font-bold","text-gray-800","mb-4"],[1,"space-y-4"],[1,"input-fun","w-full",3,"ngModelChange","ngModel"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-xl","bg-gray-100","flex","items-center","justify-center","hover:bg-gray-200","transition-colors",3,"click"],["stroke-linecap","round","stroke-linejoin","round","d","M20 12H4"],[1,"flex-1","text-center"],[1,"text-2xl","font-bold","text-gray-800"],[1,"text-xs","text-gray-500"],[1,"text-sm","text-gray-500","text-center"],[1,"flex","gap-3","mt-6"],[1,"flex-1","px-4","py-2.5","rounded-xl","border","border-gray-200","text-gray-600","font-medium","hover:bg-gray-50","transition-colors",3,"click"],[1,"flex-1","btn-gradient","py-2.5",3,"click","disabled"],[1,"text-center","mb-4"],[1,"text-4xl","mb-2"],[1,"font-display","text-xl","font-bold","text-gray-800"],[1,"text-sm","text-gray-500","mt-2"],[1,"flex-1","px-4","py-2.5","rounded-xl","bg-red-500","text-white","font-medium","hover:bg-red-600","transition-colors",3,"click"]],template:function(i,r){i&1&&(V(0,"div",0),tt(1,Rye,12,3),tt(2,Nye,30,4),tt(3,Vye,37,10),U(),tt(4,zye,34,7,"div",1),tt(5,Uye,15,2,"div",1)),i&2&&(te(),nt(r.view==="list"?1:-1),te(),nt(r.view==="detail"&&r.selectedRecipe?2:-1),te(),nt(r.view==="edit"?3:-1),te(),nt(r.showAddToListModal&&r.selectedRecipe?4:-1),te(),nt(r.showDeleteModal&&r.recipeToDelete?5:-1))},dependencies:[Ui,Xa,Dc,Ic,Mr,fF,Ya,to,gF,mF,wa],encapsulation:2})}}return n})();var e9=[{path:"auth/signin",component:GW},{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",canActivate:[Hs],component:x7},{path:"user-profile",canActivate:[Hs],component:V7},{path:"add-task",canActivate:[Hs],component:$W},{path:"shopping",canActivate:[Hs],component:L7},{path:"map",canActivate:[Hs],component:N7},{path:"calendar",canActivate:[Hs],component:$7},{path:"documents",canActivate:[Hs],component:G7},{path:"vacances",canActivate:[Hs],component:W7},{path:"chat",canActivate:[Hs],component:K7},{path:"recipes",canActivate:[Hs],component:J7},{path:"task/edit/:id",canActivate:[Hs],component:B7}];$1(YC);ss.production&&void 0;lR(aW,{providers:[BU(),EP(e9),C5(),fR(),DE(R$,mT,U$.register("ngsw-worker.js",{enabled:ss.production,registrationStrategy:"registerWhenStable:30000"})),eo,Hs,Ac,mh,{provide:qf,useValue:"fr-FR"}]}).catch(n=>console.error(n));
